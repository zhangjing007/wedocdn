/*!
 * LMV v7.37.0
 * 
 * Copyright 2021 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.ModelAlignment=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=657)}({12:function(e,t,n){var i=n(41),o=n(42),r=o;r.v1=i,r.v4=o,e.exports=r},23:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);e.exports=function(){return n(i),i}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},24:function(e,t){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var i=t||0,o=n;return[o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]]].join("")}},353:function(e){e.exports=JSON.parse('{"@@locale":"en","@@context":"ModelAlignment Extension","Pivot":"Pivot","From":"From","To":"To"}')},354:function(e){e.exports=JSON.parse('{"@@locale":"en","@@context":"SheetAlignment Extension","Add drawing":"Add drawing"}')},4:function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=(s=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),r=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[n].concat(r).concat([o]).join("\n")}var s;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(i[r]=!0)}for(o=0;o<e.length;o++){var s=e[o];"number"==typeof s[0]&&i[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),t.push(s))}},t}},41:function(e,t,n){var i,o,r=n(23),s=n(24),a=0,l=0;e.exports=function(e,t,n){var c=t&&n||0,u=t||[],d=(e=e||{}).node||i,h=void 0!==e.clockseq?e.clockseq:o;if(null==d||null==h){var f=r();null==d&&(d=i=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=o=16383&(f[6]<<8|f[7]))}var g=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:l+1,m=g-a+(v-l)/1e4;if(m<0&&void 0===e.clockseq&&(h=h+1&16383),(m<0||g>a)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=g,l=v,o=h;var p=(1e4*(268435455&(g+=122192928e5))+v)%4294967296;u[c++]=p>>>24&255,u[c++]=p>>>16&255,u[c++]=p>>>8&255,u[c++]=255&p;var E=g/4294967296*1e4&268435455;u[c++]=E>>>8&255,u[c++]=255&E,u[c++]=E>>>24&15|16,u[c++]=E>>>16&255,u[c++]=h>>>8|128,u[c++]=255&h;for(var y=0;y<6;++y)u[c+y]=d[y];return t||s(u)}},42:function(e,t,n){var i=n(23),o=n(24);e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[r+a]=s[a];return t||o(s)}},49:function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,"a",(function(){return o}));var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.overlayName=n,this.materialManager=t.impl.matman(),this.isVisible=!1,this.lock=!1}var t,n,o;return t=e,(n=[{key:"createBoundsPlane",value:function(){this.viewer.impl.createOverlayScene(this.overlayName);var e=new THREE.PlaneBufferGeometry(1,1),t=[];t.push(new THREE.Vector3(-.5,-.5,0)),t.push(new THREE.Vector3(-.5,.5,0)),t.push(new THREE.Vector3(.5,.5,0)),t.push(new THREE.Vector3(.5,-.5,0));var n=new THREE.Geometry,i=n.vertices;i.push(t[0]),i.push(t[1]),i.push(t[1]),i.push(t[2]),i.push(t[2]),i.push(t[3]),i.push(t[3]),i.push(t[0]),this.fillMaterial=new THREE.MeshPhongMaterial({color:13495031,specular:0,transparent:!0,opacity:.7,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:5,depthTest:!1,depthWrite:!1}),this.edgeMaterial=new THREE.LineBasicMaterial({color:0,side:THREE.DoubleSide,opacity:1,transparent:!0,depthTest:!1,depthWrite:!1}),this.fillMaterial.doNotCut=!0,this.edgeMaterial.doNotCut=!0,this.solidName=this.materialManager._getMaterialHash(null,"ModelSheetTransition.solid"),this.materialManager.addMaterial(this.solidName,this.fillMaterial,!0),this.edgesName=this.materialManager._getMaterialHash(null,"ModelSheetTransition.edges"),this.materialManager.addMaterialNonHDR(this.edgesName,this.edgeMaterial);var o=new THREE.Mesh(e,this.fillMaterial),r=new THREE.Line(n,this.edgeMaterial,THREE.LinePieces),s=new THREE.Group;return s.add(o),s.add(r),s.matrixAutoUpdate=!1,s}},{key:"getBoundsPlane",value:function(){return this.boundsPlane||(this.boundsPlane=this.createBoundsPlane()),this.boundsPlane}},{key:"setFromMatrix",value:function(e){var t=this.getBoundsPlane();t.matrix.copy(e),t.matrixWorldNeedsUpdate=!0}},{key:"setMaterialsOpacity",value:function(e){this.fillMaterial.opacity=.7*e,this.edgeMaterial.opacity=1*e,this.viewer.impl.invalidate(!1,!1,!0)}},{key:"setVisible",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.isVisible!==e){this.fadeAnim&&(this.fadeAnim.stop(),this.fadeAnim=null),this.isVisible=e;var i=this.getBoundsPlane(),o=e?0:1;if(e&&this.viewer.impl.addOverlay(this.overlayName,i),n){var r=function(e){e=Autodesk.Viewing.Private.smootherStep(e),t.setMaterialsOpacity(e)},s=function(){e||t.viewer.impl.removeOverlay(t.overlayName,i),t.fadeAnim=null};this.fadeAnim=Autodesk.Viewing.Private.fadeValue(o,1-o,.3,r,s)}else e?this.setMaterialsOpacity(1):this.viewer.impl.removeOverlay(this.overlayName,i);this.viewer.impl.invalidate(!1,!1,!0)}}},{key:"destroy",value:function(){this.setVisible(!1),this.solidName&&(this.materialManager.removeMaterial(this.solidName),this.materialManager.removeMaterial(this.edgesName)),this.viewer.impl.removeOverlayScene(this.overlayName)}}])&&i(t.prototype,n),o&&i(t,o),e}()},5:function(e,t,n){var i,o,r={},s=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=i.apply(this,arguments)),o}),a=function(e,t){return t?t.querySelector(e):document.querySelector(e)},l=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var i=a.call(this,e,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}}(),c=null,u=0,d=[],h=n(6);function f(e,t){for(var n=0;n<e.length;n++){var i=e[n],o=r[i.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](i.parts[s]);for(;s<i.parts.length;s++)o.parts.push(y(i.parts[s],t))}else{var a=[];for(s=0;s<i.parts.length;s++)a.push(y(i.parts[s],t));r[i.id]={id:i.id,refs:1,parts:a}}}}function g(e,t){for(var n=[],i={},o=0;o<e.length;o++){var r=e[o],s=t.base?r[0]+t.base:r[0],a={css:r[1],media:r[2],sourceMap:r[3]};i[s]?i[s].parts.push(a):n.push(i[s]={id:s,parts:[a]})}return n}function v(e,t){var n=l(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=d[d.length-1];if("top"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),d.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=l(e.insertAt.before,n);n.insertBefore(t,o)}}function m(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function p(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var i=function(){0;return n.nc}();i&&(e.attrs.nonce=i)}return E(t,e.attrs),v(e,t),t}function E(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function y(e,t){var n,i,o,r;if(t.transform&&e.css){if(!(r="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=r}if(t.singleton){var s=u++;n=c||(c=p(t)),i=A.bind(null,n,s,!1),o=A.bind(null,n,s,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",E(t,e.attrs),v(e,t),t}(t),i=b.bind(null,n,t),o=function(){m(n),n.href&&URL.revokeObjectURL(n.href)}):(n=p(t),i=k.bind(null,n),o=function(){m(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=g(e,t);return f(n,t),function(e){for(var i=[],o=0;o<n.length;o++){var s=n[o];(a=r[s.id]).refs--,i.push(a)}e&&f(g(e,t),t);for(o=0;o<i.length;o++){var a;if(0===(a=i[o]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete r[a.id]}}}};var T,P=(T=[],function(e,t){return T[e]=t,T.filter(Boolean).join("\n")});function A(e,t,n,i){var o=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=P(t,o);else{var r=document.createTextNode(o),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(r,s[t]):e.appendChild(r)}}function k(e,t){var n=t.css,i=t.media;if(i&&e.setAttribute("media",i),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function b(e,t,n){var i=n.css,o=n.sourceMap,r=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||r)&&(i=h(i)),o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var s=new Blob([i],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}},6:function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,i=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,r=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?e:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?n+r:i+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},637:function(e,t,n){var i=n(638);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(5)(i,o);i.locals&&(e.exports=i.locals)},638:function(e,t,n){(e.exports=n(4)(!1)).push([e.i,".model-alignment-panel .tab-header{border-bottom-color:transparent;font-size:12px;font-weight:bold;border-bottom-style:solid;border-bottom-width:3px;padding-bottom:2px}.model-alignment-panel .tab-header.selected{color:#1dc6f2;border-bottom-color:#1dc6f2}.model-alignment-panel .tab-header:hover{color:#1dc6f2}.model-alignment-panel .model-select-combo{width:calc(100% - 20px);margin:15px 10px 15px 10px;font-size:15px}\n",""])},639:function(e,t,n){var i=n(640);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(5)(i,o);i.locals&&(e.exports=i.locals)},640:function(e,t,n){(e.exports=n(4)(!1)).push([e.i,".adsk-viewing-viewer .edit2d-label.angle-to-angle{width:84px;height:84px;border-radius:100px;background:#FFFFFF;box-shadow:0px 1px 6px rgba(12,44,84,0.12);font-size:18px;line-height:20px;display:flex}.adsk-viewing-viewer .edit2d-label.angle-to-angle.visible{display:flex}.adsk-viewing-viewer .edit2d-label.angle-to-angle .edit2d-label-text{font-size:18px;line-height:20px;align-self:center;width:100%;color:black}\n",""])},657:function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t),n.d(t,"ModelAlignment",(function(){return Qe})),n.d(t,"SheetAlignment",(function(){return Ot}));var o="Autodesk.ModelAlignment_Gizmo",r={MODEL_MOVED_EVENT:"modelMoved"},s=Autodesk.Viewing,a=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s.EventDispatcher.prototype.apply(this),this.viewer=t,this.id=n,this.anchor=new THREE.Vector3,this.startPos=new THREE.Vector3,this.viewer.impl.createOverlayScene(o),this.gizmo=new THREE.TransformControls(this.viewer.impl.camera,this.viewer.canvas,"translate",i),this.target=new THREE.Object3D,this.gizmo.attach(this.target),this.active=!1,this.tmpMatrix=new THREE.Matrix4,this.onCameraChange=this.onCameraChange.bind(this)}var t,n,a;return t=e,(n=[{key:"dtor",value:function(){this.deactivate(),this.viewer.impl.removeOverlayScene(o)}},{key:"setModel",value:function(e,t,n){this.model=e,e?(t=t||this.model.getFuzzyBox({ignoreTransforms:!0}),this.anchor.copy(t.min),this.gizmo.setSpace(n?"local":"world"),this.initGizmo(),this.setGizmoVisible(!0)):this.setGizmoVisible(!1)}},{key:"setGizmoVisible",value:function(e){this.gizmo.visible=e,this.viewer.impl.invalidate(!1,!1,!0)}},{key:"initGizmo",value:function(){if(this.model){this.startPos.copy(this.anchor);var e=this.model.getModelToViewerTransform();e&&this.startPos.applyMatrix4(e),this.target.position.copy(this.startPos),"local"===this.gizmo.space&&e&&this.gizmo.setRotation(this.tmpMatrix.extractRotation(e)),this.gizmo.update(),this.viewer.impl.invalidate(!1,!1,!0)}}},{key:"getNames",value:function(){return[this.getName()]}},{key:"getName",value:function(){return"ModelTransformTool_".concat(this.id)}},{key:"activate",value:function(){this.active||(this.viewer.impl.addOverlay(o,this.gizmo),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.active=!0)}},{key:"deactivate",value:function(){this.active&&(this.viewer.impl.removeOverlay(o,this.gizmo),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.active=!1)}},{key:"onCameraChange",value:function(){this.gizmo.update(),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"handleMouseMove",value:function(e){var t=this.gizmo.onPointerMove(e),n=this.gizmo.onPointerHover(e);if(this.viewer.impl.invalidate(t,t,!0),t){var i=this.target.position.clone().sub(this.startPos),o=this.model.getPlacementTransform(),s=o.elements;s[12]+=i.x,s[13]+=i.y,s[14]+=i.z,this.viewer.impl.setPlacementTransform(this.model,o),this.fireEvent({type:r.MODEL_MOVED_EVENT})}return(n||t)&&this.viewer.impl.clearHighlight(),n||t}},{key:"handleButtonDown",value:function(e){return 0===e.button&&this.gizmo.onPointerDown(e)}},{key:"handleButtonUp",value:function(e){return 0===e.button&&this.gizmo.onPointerUp(e)}},{key:"getPriority",value:function(){return 1}}])&&i(t.prototype,n),a&&i(t,a),e}();function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){c(r,i,o,s,a,"next",e)}function a(e){c(r,i,o,s,a,"throw",e)}s(void 0)}))}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=p(e);if(t){var o=p(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return v(this,n)}}function v(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?m(e):t}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}a.Events=r;var E=Autodesk.Viewing,y=Autodesk.Viewing.Private,T=0,P=AutodeskNamespace("Autodesk.ModelAlignment"),A={MODEL_SELECTED:"modelSelected",STATE_CHANGED:"stateChanged"},k=function(e,t){return e&&t?new y.LmvMatrix4(!0).makeScale(t,t,t).multiply(e):e},b=function(e,t){return k(e,1/t.myData.scalingFactor)},S=function(e){var t=e.getDocumentNode();t.getRootNode().urn();return e.is2d()?t.name():void 0},C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(l,e);var t,n,i,o,r,s=g(l);function l(e,t){var n;return d(this,l),(n=s.call(this,e,t)).name="ModelAlignmentBase",n.onModelTransformChanged=n.onTransformChanged.bind(m(n)),n.modelTransformToolAxis=null,Autodesk.Viewing.EventDispatcher.prototype.apply(m(n)),n}return t=l,(n=[{key:"load",value:(r=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.Section");case 2:return e.next=4,this.viewer.loadExtension("Autodesk.Snapping");case 4:return e.next=6,this.viewer.loadExtension("Autodesk.Edit2D");case 6:return e.next=8,this.viewer.loadExtension("Autodesk.Edit3D");case 8:this.initTransformTool(),this.snapper=this.viewer.toolController.getTool("Snapper_ModelAlignment"),this.snapper||(this.snapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(this.viewer,{renderSnappedTopology:!0,toolName:"Snapper_ModelAlignment"}),this.viewer.toolController.registerTool(this.snapper)),this.coordPicker=this.viewer.toolController.getTool(Autodesk.Edit3D.CoordPicker.Name),this.coordPicker||(this.coordPicker=new Autodesk.Edit3D.CoordPicker(this.viewer,this.snapper),this.viewer.toolController.registerTool(this.coordPicker)),this.screenOverlay=new Autodesk.Edit2D.ScreenOverlay(this.viewer,"Autodesk.ModelAlignment.ScreenOverlay_".concat(T++)),this.model=null,this.pendingChanges={},this.syncedState={};case 17:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"initTransformTool",value:function(){var e=this;this.modelTransformTool=new a(this.viewer,this.name,this.modelTransformToolAxis),this.viewer.toolController.registerTool(this.modelTransformTool),this.modelTransformTool.addEventListener(a.Events.MODEL_MOVED_EVENT,(function(){e.modified()})),this.viewer.addEventListener(E.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged)}},{key:"destroyTransformTool",value:function(){var e;this.modelTransformTool&&(this.viewer.toolController.deregisterTool(this.modelTransformTool),this.viewer.removeEventListener(E.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged),null===(e=this.modelTransformTool)||void 0===e||e.dtor(),this.modelTransformTool=null)}},{key:"unload",value:function(){this.destroyTransformTool(),this.model=null,this.pendingChanges={},this.syncedState={}}},{key:"setAlignmentService",value:function(e){this.options.alignmentService=e}},{key:"onTransformChanged",value:function(){this.modelTransformTool.initGizmo()}},{key:"setModel",value:function(e){var t;if(this.model!==e){if(this.model=e,null===(t=this.modelTransformTool)||void 0===t||t.setModel(e),e){var n=this.getAlignmentItemKey(e);this.syncedState[n]||(this.syncedState[n]={matrix:this.model.getPlacementTransform().clone()})}this.fireEvent({type:A.MODEL_SELECTED})}}},{key:"onSaveButton",value:function(){this.options.onSaveButton&&this.options.onSaveButton()}},{key:"saveChanges",value:function(){for(var e in this.options.alignmentService||console.error("AlignmentService must be set for saving transforms"),this.pendingChanges){var t,n=this.pendingChanges[e];if(n){var i=n.model,o=n.resetPlacement?null:i.getPlacementTransform().clone();this.syncedState[e].matrix=o;var r=i.getDocumentNode().getRootNode().urn(),s=S(i);o=b(o,i),null===(t=this.options.alignmentService)||void 0===t||t.saveTransform(r,s,o)}}this.pendingChanges={}}},{key:"isAlignmentLocked",value:(o=u(regeneratorRuntime.mark((function e(t){var n,i,o,r,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=this.isAlignmentLockedSync(t))){e.next=3;break}return e.abrupt("return",n);case 3:if(i=this.options.alignmentService){e.next=7;break}return console.error("Alignment service must be set to check lock flag."),e.abrupt("return",!1);case 7:return o=t.getDocumentNode(),r=o.getRootNode().urn(),s=t.is2d()?o.name():void 0,e.next=12,i.isAlignmentLocked(r,s);case 12:return e.abrupt("return",e.sent);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"isAlignmentLockedSync",value:function(e){var t=e.getDocumentNode(),n=t.getRootNode().urn(),i=e.is2d()?t.name():void 0,o=this.options.alignmentService;return o&&o.getIsLocked(n,i)}},{key:"getAlignmentItemKey",value:function(e){var t=e.myData.urn,n=e.getDocumentNode();return t+(e.is2d()&&n?n.guid():"")}},{key:"modified",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.model){var t=this.getAlignmentItemKey(this.model);if(e&&!this.hasSavedTransform(this.model))return void delete this.pendingChanges[t];this.pendingChanges[t]=new w(this.model,e)}}},{key:"getOriginalFileTransform",value:function(e){var t=e.myData.refPointTransform||new y.LmvMatrix4(!0);return t=function(e,t){return k(e,t.myData.scalingFactor)}(t,e)}},{key:"isModelTransformDifferentThanOriginalFileTransform",value:function(e){var t=e.getPlacementTransform(),n=this.getOriginalFileTransform(e);return!t.equals(n)}},{key:"isMatrixDifferentThanLastSyncedMatrix",value:function(e,t){if(!e||!t)return!1;var n=this.getAlignmentItemKey(t),i=this.syncedState[n].matrix||this.getOriginalFileTransform(t);return!e.equals(i)}},{key:"hasSavedTransform",value:function(e){var t=this.options.alignmentService;if(!t)return console.error("Alignment service must be set first"),!1;var n=e.getDocumentNode().getRootNode().urn(),i=S(e),o=t.getTransform(n,i);return void 0===o&&console.error("Alignment service transform state should already be known."),null!==o}},{key:"hasPendingChanges",value:function(e){if(e){var t=this.getAlignmentItemKey(e);return!!this.pendingChanges[t]}return Boolean(Object.keys(this.pendingChanges).length)}},{key:"isPendingReset",value:function(e){var t=this;if(e){var n,i=this.getAlignmentItemKey(e);return Boolean(null===(n=this.pendingChanges[i])||void 0===n?void 0:n.resetPlacement)}return Boolean(Object.keys(this.pendingChanges).some((function(e){var n;return null===(n=t.pendingChanges[e])||void 0===n?void 0:n.resetPlacement})))}}])&&h(t.prototype,n),i&&h(t,i),l}(E.Extension),w=function e(t,n){d(this,e),this.model=t,this.resetPlacement=n};P.Events=A;n(637);function D(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var M={MODEL_SELECTED:"modelSelected",MODEL_HOVERED:"modelHovered"},R="ModelAlignment.ModelSelector",_=function(e,t){if(t){if(t.is3d())!function(e,t){var n=e.getVisibleModels().filter((function(e){return e.is3d()&&e.myData.urn==t})).map((function(e){return e.id}));e.impl.renderer().rollOverModelId(n)}(e,t.myData.urn);else e.impl.renderer().rollOverModelId(t.id);e.impl.invalidate(!1,!1,!0)}else e.impl.clearHighlight()},N=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;D(this,e),this.viewer=t,Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.hoverColor=new THREE.Color(.5,.5,.1),this.hoverColorNotSelectable=new THREE.Color(.5,0,0),this.modelFilter=n}var t,n,i;return t=e,(n=[{key:"getName",value:function(){return R}},{key:"getNames",value:function(){return[R]}},{key:"activate",value:function(){this.active=!0}},{key:"deactivate",value:function(){this.active=!1,this.setHoverHighlighting(null)}},{key:"register",value:function(){}},{key:"modelIdAtPixel",value:function(e,t){var n=[],i=this.viewer.impl.clientToViewport(e,t);return this.viewer.impl.renderer().idAtPixel(i.x,i.y,n),n[1]?n[1]:0}},{key:"setHoverHighlighting",value:function(e){if(e){var t=!this.modelFilter||this.modelFilter(e)?this.hoverColor:this.hoverColorNotSelectable;this.viewer.impl.renderer().setRollOverHighlightColor(t),_(this.viewer,e)}else this.viewer.impl.clearHighlight(),this.viewer.impl.renderer().setRollOverHighlightColor()}},{key:"setModelUnderMouse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.setHoverHighlighting(e);var t=this.modelUnderMouse;this.modelUnderMouse=e;var n=t!==e;n&&this.fireEvent({type:M.MODEL_HOVERED,modelBefore:t,model:e})}},{key:"handleMouseMove",value:function(e){if(0!==e.buttons)return this.setModelUnderMouse(),!1;var t=this.modelIdAtPixel(e.canvasX,e.canvasY),n=this.viewer.impl.findModel(t);return this.setModelUnderMouse(n),!0}},{key:"handleSingleClick",value:function(e,t){if(0==t){var n=this.modelIdAtPixel(e.canvasX,e.canvasY),i=n&&this.viewer.impl.findModel(n);return i&&this.modelFilter&&!this.modelFilter(i)&&(i=null),this.fireEvent({type:M.MODEL_SELECTED,model:i}),!0}}}])&&O(t.prototype,n),i&&O(t,i),e}();function x(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}N.Events=M;var V=Autodesk.Viewing.Private,L=new THREE.Vector3,H=new THREE.Vector3,I=new THREE.Quaternion,B=new THREE.Euler,F=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.model=null,this.position=new THREE.Vector3,this.rotation=new THREE.Vector3,this.scale=new THREE.Vector3,this.quaternion=new THREE.Quaternion,this.euler=new THREE.Euler,this.viewer=t}var t,n,i;return t=e,i=[{key:"readPlacementValues",value:function(e,t,n,i){var o=t||L,r=i||H,s=e.getPlacementTransform();THREE.Matrix4.prototype.decompose.call(s,o,I,r),B.setFromQuaternion(I),n&&(n.x=THREE.Math.radToDeg(B._x),n.y=THREE.Math.radToDeg(B._y),n.z=THREE.Math.radToDeg(B._z))}}],(n=[{key:"getPosition",value:function(){return this.position}},{key:"getRotationZ",value:function(){return this.rotation.z}},{key:"setPosition",value:function(e){this.position.copy(e)}},{key:"setRotationZ",value:function(e){this.rotation.z=e}},{key:"setModel",value:function(e){this.model=e}},{key:"update",value:function(){this.model&&e.readPlacementValues(this.model,this.position,this.rotation,this.scale)}},{key:"apply",value:function(){if(this.model){this.euler._x=THREE.Math.degToRad(this.rotation.x),this.euler._y=THREE.Math.degToRad(this.rotation.y),this.euler._z=THREE.Math.degToRad(this.rotation.z),this.quaternion.setFromEuler(this.euler);var e=new V.LmvMatrix4(!0).compose(this.position,this.quaternion,this.scale);this.viewer.impl.setPlacementTransform(this.model,e)}}}])&&x(t.prototype,n),i&&x(t,i),e}();function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,t,n){return(z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Q(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Q(e);if(t){var o=Q(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Y(this,n)}}function Y(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?W(e):t}function W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Z(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function q(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function X(e,t,n){return t&&q(e.prototype,t),n&&q(e,n),e}var K=Autodesk.Viewing,J=(Autodesk.Viewing.Private,{MODEL_TRANSFORM_EDITED:"transformEdited",SELECT_MODEL_PRESSED:"selectModelPressed",EDIT_POSITION_PRESSED:"editPositionPressed",TAB_CHANGED:"tabChanged",VECTOR_INPUT_VALUE_CHANGED:"vectorInputValueChanged",MODEL_SELECTED:"modelSelected",SAVE_BUTTON_PRESSED:"saveButtonPressed",FIT_TO_VIEW_BUTTON_PRESSED:"fitToViewButtonPressed",FROM_POINT_BUTTON_PRESSED:"fromPointButtonPressed",TO_POINT_BUTTON_PRESSED:"toPointButtonPressed",APPLY_PTP_PRESSED:"applyPointToPointPressed",FROM_POINT_CHANGED:"fromPointChanged",TO_POINT_CHANGED:"toPointChanged",OFFSET_CHANGED:"offsetChanged",CENTER_BUTTON_PRESSED:"centerButtonPressed",FROM_ANGLE_BUTTON_PRESSED:"fromAngleButtonPressed",TO_ANGLE_BUTTON_PRESSED:"toAngleButtonPressed",APPLY_ATA_PRESSED:"applyAngleToAnglePressed",CENTER_CHANGED:"centerChanged",OFFSET_ANGLE_CHANGED:"offsetAngleChanged",FROM_ANGLE_CHANGED:"fromAngleChanged",TO_ANGLE_CHANGED:"toAngleChanged",FROM_EDGE_BUTTON_PRESSED:"fromEdgeButtonPressed",TO_EDGE_BUTTON_PRESSED:"toEdgeButtonPressed"}),$=function(e){var t=document.createElement("div");return e.appendChild(t),t.style.height="55px",t.style.backgroundColor="rgba(34, 34, 34, 0.4)",t.style.display="flex",t.style.flexDirection="row",t.style.padding="10px",t.style.width="100%",t.style.boxSizing="border-box",t.style.alignItems="center",t.style.marginTop="15px",t},ee=function(e,t,n,i,o){var r=$(e);i&&(r.id=i);var s=document.createElement("div");if(s.textContent=t,s.style.flexGrow="90",s.style.fontWeight="bold",r.appendChild(s),!n)return r;var a=function(e){var t=e.container.style;t.backgroundColor="rgb(80,80,80)",t.flexGrow="10",t.height="15px",t.width="auto",t.textAlign="center",t.fontSize="12px"};return a(n),r.appendChild(n.container),o?(a(o),r.appendChild(o.container),r):r},te=function(e,t){var n=document.createElement("div");e.appendChild(n);var i=document.createElement("div");i.textContent=t,i.fontSize="10px",n.appendChild(i);var o=document.createElement("input");return o.type="text",n.appendChild(o),o.style.width="80px",o},ne=function(e){return!!e.match(/^-?\d*\.?\d*$/)},ie=new THREE.Vector3,oe=new THREE.Vector3,re=function(){function e(t,n){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;Z(this,e),K.EventDispatcher.prototype.apply(this),this.container=document.createElement("div"),this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.padding="0px 10px 30px 10px",this.container.style.backgroundColor="rgba(34, 34, 34, 0.4)",t.appendChild(this.container),this.input=document.createElement("input"),this.input.type="text",this.input.style.width="100px",this.container.appendChild(this.input),this.updateInput=!0,n&&(this.handleInput=function(){i.updateInput=!1,n(),i.updateInput=!0},this.input.addEventListener("input",this.handleInput)),this.input.addEventListener("blur",this.onBlur.bind(this)),this.digits=o}return X(e,[{key:"validate",value:function(e){return e.toFixed(this.digits)}},{key:"setValue",value:function(e){if(null!=e&&null!==e){var t=parseFloat(e).toFixed(this.digits);isNaN(t)||(this.updateInput&&(this.input.value=t),this.fireEvent({type:J.VECTOR_INPUT_VALUE_CHANGED}))}else this.clear()}},{key:"setRawValue",value:function(e){ne(e)&&(this.input.value=e)}},{key:"getValue",value:function(){return this.valid()?parseFloat(this.input.value):void 0}},{key:"onBlur",value:function(){this.setValue(this.input.value)}},{key:"clear",value:function(){this.input.value="",this.fireEvent({type:J.VECTOR_INPUT_VALUE_CHANGED})}},{key:"valid",value:function(){return isFinite(parseFloat(this.input.value))}}]),e}(),se=function(){function e(t,n){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;Z(this,e),K.EventDispatcher.prototype.apply(this),this.container=document.createElement("div"),this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.padding="0px 10px 30px 10px",this.container.style.backgroundColor="rgba(34, 34, 34, 0.4)",t.appendChild(this.container),this.x=te(this.container,"X"),this.y=te(this.container,"Y"),this.z=te(this.container,"Z"),this.digits=o,this._value=new THREE.Vector3,this.updateInput=!0,n&&(this.handleInput=function(){i.updateInput=!1,n(),i.updateInput=!0},this.x.addEventListener("input",this.handleInput),this.y.addEventListener("input",this.handleInput),this.z.addEventListener("input",this.handleInput)),this.x.addEventListener("blur",this.onBlur.bind(this)),this.y.addEventListener("blur",this.onBlur.bind(this)),this.z.addEventListener("blur",this.onBlur.bind(this)),this.enableEmpty=!1}return X(e,[{key:"validate",value:function(e){return e.toFixed(this.digits)}},{key:"parseValue",value:function(e){return this.enableEmpty&&!e.length?0:parseFloat(e)}},{key:"valid",value:function(){return this.enableEmpty||this.x.value.length&&this.y.value.length&&this.z.value.length}},{key:"getValue",value:function(){var e=this.parseValue(this.x.value),t=this.parseValue(this.y.value),n=this.parseValue(this.z.value);return this._value.set(e,t,n),this._value}},{key:"isZero",value:function(){var e=this.getValue();return 0==e.x&&0==e.y&&0==e.z}},{key:"setValue",value:function(e){if(e){var t=this.validate(e.x),n=this.validate(e.y),i=this.validate(e.z);isNaN(t)||isNaN(n)||isNaN(i)||(this._value.copy(e),this.updateInput&&(this.x.value=t,this.y.value=n,this.z.value=i),this.fireEvent({type:J.VECTOR_INPUT_VALUE_CHANGED}))}else this.clear()}},{key:"setRawValue",value:function(e){ne(e.x)&&ne(e.y)&&ne(e.z)&&(this.x.value=e.x,this.y.value=e.y,this.z.value=e.z)}},{key:"onBlur",value:function(){this.setValue(this._value)}},{key:"clear",value:function(){this.x.value="",this.y.value="",this.z.value="",this.fireEvent({type:J.VECTOR_INPUT_VALUE_CHANGED})}}]),e}(),ae=function(e,t,n){var i=new Autodesk.Viewing.UI.Button(t);return e.appendChild(i.container),i.container.textContent=n,i.container.style.textAlign="center",i.container.style.left="50%",i.container.style.transform="translateX(-50%)",i.container.style.width="auto",i.container.style.height="auto",i.container.style.backgroundColor="rgb(80,80,80)",i},le=function(e,t){e.container.style.boxShadow=t?"0px 0px 10px":"initial",e.highlight=t},ce={Transform:"Transform",PointToPoint:"Point-to-Point",AngleToAngle:"Angle-to-Angle"},ue=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(n,Autodesk.Viewing.UI.DockingPanel);var t=j(n);function n(e,i,o,r,s){var a;return Z(this,n),(a=t.call(this,e.container,i,o,s)).viewer=e,a.unitHandler=r,K.EventDispatcher.prototype.apply(W(a)),a.pages=[],a.selectedTabId=null,a.title.style.borderBottomColor="rgb(74, 85, 91)",a.container.classList.add("model-alignment-panel"),a.container.style.width="300px",a.container.style.height="815px",a.container.style.top="6px",a.container.style.left="6px",a.body=document.createElement("div"),a.body.style.backgroundColor="rgba(34, 34, 34, 0.9)",a.body.style.height="100%",a.body.style.padding="10px",a.container.appendChild(a.body),a.addModelSection(a.body),a.addTabHeaderSection(a.body),a.positionTab=a.addTab(ce.Transform,"Position"),a.pointToPointTab=a.addTab(ce.PointToPoint,"Move"),a.angleToAngleTab=a.addTab(ce.AngleToAngle,"Rotate"),a.initPositionTab(),a.initPointToPointTab(),a.initAngleToAngleTab(),a.selectTab(ce.Transform),a.digits=2,a}return X(n,[{key:"filterValue",value:function(e){return e.toFixed(this.digits)}},{key:"addModelSection",value:function(e){var t=this,n=document.createElement("div");n.id="ModelSection",this.selectModelButton=new Autodesk.Viewing.UI.Button("SelectModel"),this.selectModelButton.container.textContent="Select",this.selectModelButton.onClick=function(){t.fireEvent({type:J.SELECT_MODEL_PRESSED}),le(t.selectModelButton,!0)},ee(n,"Model",this.selectModelButton),this.modelCombo=document.createElement("select"),this.modelCombo.classList.add("model-select-combo"),n.appendChild(this.modelCombo),this.updateModelCombo(),this.updateModelCombo=this.updateModelCombo.bind(this),this.viewer.addEventListener(K.MODEL_ADDED_EVENT,this.updateModelCombo),this.viewer.addEventListener(K.MODEL_REMOVED_EVENT,this.updateModelCombo),this.modelCombo.addEventListener("change",(function(){var e=t.modelCombo.selectedIndex,n=t.modelCombo.items[e];t.setModel(n.model)})),e.appendChild(n)}},{key:"getSelectableModels",value:function(){var e={};return this.viewer.getVisibleModels().filter((function(t){if(t.getData().underlayRaster)return!1;if(t.is2d())return!0;var n=t.myData.urn;return!e[n]&&(e[n]=!0,!0)}))}},{key:"updateModelCombo",value:function(){var e=this;this.modelCombo.length=0;var t=[];t.push({name:"Please select",model:null}),this.getSelectableModels().forEach((function(e){var n=e.getDocumentNode().getModelName();t.push({name:n,model:e,urn:e.myData.urn})})),t.forEach((function(t,n){var i=document.createElement("option");i.value=n,i.textContent=t.name,i.addEventListener("mouseenter",(function(){return _(e.viewer,t.model)})),i.addEventListener("mouseleave",(function(){return _(e.viewer,null)})),e.modelCombo.add(i)})),this.modelCombo.items=t}},{key:"initPositionTab",value:function(){var e=this;this.positionTab.padding="10px",this.editPositionButton=this.createEventButton("EditPositionButton","Edit",J.EDIT_POSITION_PRESSED),this.fitToViewButton=this.createEventButton("FitToViewButton","Fit to View",J.FIT_TO_VIEW_BUTTON_PRESSED,null,!1),ee(this.positionTab,"Position",this.editPositionButton,"PositionHeader",this.fitToViewButton),this.position=new se(this.positionTab,(function(){return e.onTransformChanged()})),ee(this.positionTab,"Rotation"),this.rotation=new re(this.positionTab,(function(){return e.onTransformChanged()})),this.saveButton=this.createEventButton("SaveButton","Save Transforms",J.SAVE_BUTTON_PRESSED),ee(this.body,"",this.saveButton)}},{key:"initPointToPointTab",value:function(){var e=this;this.selectFromButton=this.createEventButton("SelectFromButton","Select",J.FROM_POINT_BUTTON_PRESSED),this.selectToButton=this.createEventButton("SelectToButton","Select",J.TO_POINT_BUTTON_PRESSED),ee(this.pointToPointTab,"From point",this.selectFromButton,"FromPointHeader"),this.fromPoint=new se(this.pointToPointTab,(function(){return e.onFromPointChanged(!0)})),ee(this.pointToPointTab,"To point",this.selectToButton,"ToPointHeader"),this.toPoint=new se(this.pointToPointTab,(function(){return e.onToPointChanged(!0)})),ee(this.pointToPointTab,"Offset",null,"OffsetHeader"),this.offset=new se(this.pointToPointTab,(function(){return e.onOffsetChanged(!0)})),this.offset.enableEmpty=!0;var t=$(this.pointToPointTab);this.applyPointToPointButton=ae(t,"ApplyP2P","Apply"),this.applyPointToPointButton.onClick=function(){e.clearPointToPoint(),e.fireEvent({type:J.APPLY_PTP_PRESSED})}}},{key:"initAngleToAngleTab",value:function(){var e=this;this.selectCenterButton=this.createEventButton("SelectCenterButton","Select",J.CENTER_BUTTON_PRESSED,(function(){return e.onSelectCenterButton()})),this.selectFromAngleButton=this.createEventButton("SelectFromAngleButton","Direction",J.FROM_ANGLE_BUTTON_PRESSED),this.selectToAngleButton=this.createEventButton("SelectToAngleButton","Direction",J.TO_ANGLE_BUTTON_PRESSED),this.selectFromEdgeButton=this.createEventButton("SelectFromEdgeButton","Edge",J.FROM_EDGE_BUTTON_PRESSED),this.selectToEdgeButton=this.createEventButton("SelectToEdgeButton","Edge",J.TO_EDGE_BUTTON_PRESSED),ee(this.angleToAngleTab,"Center",this.selectCenterButton,"CenterHeader"),this.center=new se(this.angleToAngleTab,(function(){return e.onCenterChanged(!0)})),ee(this.angleToAngleTab,"From angle",this.selectFromEdgeButton,"FromAngleHeader",this.selectFromAngleButton),this.fromAngle=new re(this.angleToAngleTab,(function(){return e.onFromAngleChanged(!0)})),ee(this.angleToAngleTab,"To angle",this.selectToEdgeButton,"ToPointHeader",this.selectToAngleButton),this.toAngle=new re(this.angleToAngleTab,(function(){return e.onToAngleChanged(!0)})),ee(this.angleToAngleTab,"Offset angle",null,"OffsetHeader"),this.offsetAngle=new re(this.angleToAngleTab,(function(){return e.onOffsetAngleChanged(!0)})),this.offset.enableEmpty=!0;var t=$(this.angleToAngleTab);this.applyAngleToAngleButton=ae(t,"ApplyA2A","Apply"),this.applyAngleToAngleButton.onClick=function(){e.clearAngleToAngle(),e.fireEvent({type:J.APPLY_ATA_PRESSED})}}},{key:"setModel",value:function(e){this.model=e;var t=this.modelCombo.items;this.modelCombo.selectedIndex=t.findIndex((function(t){return t.model===e})),this.updateTransformValues(),le(this.selectModelButton,!1),this.blockEvents||(this.blockEvents=!0,this.fireEvent({type:J.MODEL_SELECTED}),this.blockEvents=!1)}},{key:"updateTransformValues",value:function(){if(!this.model)return this.position.clear(),void this.rotation.clear();F.readPlacementValues(this.model,ie,oe),this.unitHandler.toDisplayUnitsVec3(this.model.getUnitString(),ie,ie),this.setPosition(ie),this.setRotation(oe.z)}},{key:"setPosition",value:function(e){this.position.setValue(e)}},{key:"setRotation",value:function(e){this.rotation.setValue(e)}},{key:"setFromPoint",value:function(e){this.fromPoint.setValue(e),this.onFromPointChanged()}},{key:"setToPoint",value:function(e){this.toPoint.setValue(e),this.onToPointChanged()}},{key:"setOffset",value:function(e){this.offset.setValue(e),this.onOffsetChanged()}},{key:"setCenter",value:function(e){this.center.setValue(e)}},{key:"setFromAngle",value:function(e){this.fromAngle.setValue(e),this.onFromAngleChanged()}},{key:"setToAngle",value:function(e){this.toAngle.setValue(e),this.onToAngleChanged()}},{key:"fromPointValid",value:function(){return this.fromPoint.valid()}},{key:"toPointValid",value:function(){return this.toPoint.valid()}},{key:"offsetValid",value:function(){return this.offset.valid()}},{key:"clearPointToPoint",value:function(){this.fromPoint.clear(),this.toPoint.clear(),this.offset.clear()}},{key:"clearAngleToAngle",value:function(){this.center.clear(),this.fromAngle.clear(),this.toAngle.clear(),this.offsetAngle.clear()}},{key:"getPosition",value:function(){return this.position.valid()&&this.position.getValue()}},{key:"getRotation",value:function(){return this.rotation.valid()&&this.rotation.getValue()}},{key:"getFromPoint",value:function(){return this.fromPoint.valid()&&this.fromPoint.getValue()}},{key:"getToPoint",value:function(){return this.toPoint.valid()&&this.toPoint.getValue()}},{key:"getOffset",value:function(){return!this.offset.isZero()&&this.offset.getValue()}},{key:"getCenter",value:function(){return this.center.valid()&&this.center.getValue()}},{key:"extractModelScale",value:function(){var e=new THREE.Vector3(1,1,1),t=this.model.getPlacementTransform();return t?e.setFromMatrixScale(t):e}},{key:"onTransformChanged",value:function(){this.model&&this.position.valid()&&this.rotation.valid()&&this.fireEvent({type:J.MODEL_TRANSFORM_EDITED})}},{key:"onFromPointChanged",value:function(e){var t=this.getFromPoint(),n=this.getToPoint(),i=this.getOffset();t&&n?this.offset.setValue(n.sub(t)):t&&i&&(this.toPoint.setValue(t.add(i)),e&&this.fireEvent({type:J.TO_POINT_CHANGED,toPoint:this.getToPoint()})),e&&this.fireEvent({type:J.FROM_POINT_CHANGED,fromPoint:this.getFromPoint()})}},{key:"onToPointChanged",value:function(e){var t=this.getFromPoint(),n=this.getToPoint(),i=this.getOffset();t&&n?(this.offset.setValue(n.sub(t)),e&&this.fireEvent({type:J.OFFSET_CHANGED,offset:this.getOffset()})):n&&i&&(this.fromPoint.setValue(n.sub(i)),e&&this.fireEvent({type:J.FROM_POINT_CHANGED,fromPoint:this.getFromPoint()})),e&&this.fireEvent({type:J.TO_POINT_CHANGED,toPoint:this.getToPoint()})}},{key:"onOffsetChanged",value:function(e){var t=this.getFromPoint(),n=this.getToPoint(),i=this.getOffset();t&&i?(this.toPoint.setValue(t.add(i)),e&&this.fireEvent({type:J.TO_POINT_CHANGED,toPoint:this.getToPoint()})):n&&i&&(this.fromPoint.setValue(n.sub(i)),e&&this.fireEvent({type:J.FROM_POINT_CHANGED,fromPoint:this.getFromPoint()})),e&&this.fireEvent({type:J.OFFSET_CHANGED,offset:this.getOffset()})}},{key:"updateFromAngle",value:function(e){var t=this.toAngle.getValue()-this.offsetAngle.getValue();this.fromAngle.setValue(t),e&&this.fireEvent({type:J.FROM_ANGLE_CHANGED,angle:t})}},{key:"updateToAngle",value:function(e){var t=this.fromAngle.getValue()+this.offsetAngle.getValue();this.toAngle.setValue(t),e&&this.fireEvent({type:J.TO_ANGLE_CHANGED,angle:t})}},{key:"updateOffsetAngle",value:function(e){var t=this.toAngle.getValue()-this.fromAngle.getValue();this.offsetAngle.setValue(t),e&&this.fireEvent({type:J.OFFSET_ANGLE_CHANGED,angle:t})}},{key:"onCenterChanged",value:function(e){e&&this.fireEvent({type:J.CENTER_CHANGED,center:this.getCenter()})}},{key:"onFromAngleChanged",value:function(e){var t=this.fromAngle.valid(),n=this.toAngle.valid(),i=this.offsetAngle.valid();t&&n?this.updateOffsetAngle(e):t&&i&&this.updateToAngle(e),e&&this.fireEvent({type:J.FROM_ANGLE_CHANGED,angle:this.fromAngle.getValue()})}},{key:"onToAngleChanged",value:function(e){var t=this.fromAngle.valid(),n=this.toAngle.valid(),i=this.offsetAngle.valid();t&&n?this.updateOffsetAngle(e):n&&i&&this.updateFromAngle(e),e&&this.fireEvent({type:J.TO_ANGLE_CHANGED,angle:this.toAngle.getValue()})}},{key:"onOffsetAngleChanged",value:function(e){var t=this.fromAngle.valid(),n=this.toAngle.valid(),i=this.offsetAngle.valid();t&&i?this.updateToAngle(e):n&&i?this.updateFromAngle(e):!i||t||n||(this.fromAngle.setValue(0),this.toAngle.setValue(this.offsetAngle.getValue()),this.updateFromAngle(e),this.updateToAngle(e)),e&&this.fireEvent({type:J.OFFSET_ANGLE_CHANGED,angle:this.offsetAngle.getValue()})}},{key:"addTabHeaderSection",value:function(e){this.tabHeaders=document.createElement("div"),this.tabHeaders.id="TabHeaders",this.tabHeaders.style.paddingTop="15px",this.tabHeaders.style.paddingLeft="10px",this.tabHeaders.style.backgroundColor="rgb(34, 34, 34, 0.94)",this.tabHeaders.style.display="flex",this.tabHeaders.style.flexDirection="row",this.tabHeaders.style.borderBottomStyle="solid",this.tabHeaders.style.borderBottomWidth="3px",this.tabHeaders.style.borderColor="rgb(34, 34, 34, 0.94)",e.appendChild(this.tabHeaders)}},{key:"addTabHeader",value:function(e,t){var n=this,i=document.createElement("div");i.style.paddingRight="10px";var o=document.createElement("span");o.textContent=t,o.classList.add("tab-header"),i.appendChild(o),i.tabId=e,i.text=o,this.tabHeaders.appendChild(i);i.addEventListener("click",(function(){return n.selectTab(e)}))}},{key:"addTab",value:function(e,t){this.addTabHeader(e,t);var n=document.createElement("div");return n.tabId=e,this.pages.push(n),this.body.append(n),n}},{key:"selectTab",value:function(e){if(this.selectedTabId!==e){for(var t=0;t<this.tabHeaders.children.length;t++){var n=this.tabHeaders.children[t];n.tabId==e?n.text.classList.add("selected"):n.text.classList.remove("selected")}for(var i=0;i<this.pages.length;i++){var o=this.pages[i],r=o.tabId===e;o.style.display=r?"block":"none"}this.selectedTabId=e,this.fireEvent({type:J.TAB_CHANGED,tabId:e})}}},{key:"onFromSelected",value:function(e){this.setFromPoint(e),le(this.selectFromButton,!1),this.fromPoint.valid()&&!this.toPoint.valid()&&(le(this.selectToButton,!0),this.fireEvent({type:J.TO_POINT_BUTTON_PRESSED}))}},{key:"onToSelected",value:function(e){this.setToPoint(e),le(this.selectToButton,!1)}},{key:"onFromHovered",value:function(e){this.setFromPoint(e)}},{key:"onToHovered",value:function(e){this.setToPoint(e)}},{key:"createEventButton",value:function(e,t,n,i){var o=this,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=new Autodesk.Viewing.UI.Button(e);return s.container.textContent=t,s.onClick=function(){i&&i(),o.fireEvent({type:n}),r&&le(s,!0)},s}},{key:"onCenterHovered",value:function(e){this.setCenter(e)}},{key:"onCenterSelected",value:function(e){this.setCenter(e),le(this.selectCenterButton,!1),this.center.valid()&&!this.fromAngle.valid()&&le(this.selectFromAngleButton,!0)}},{key:"onFromAngleHovered",value:function(e){this.setFromAngle(e)}},{key:"onFromAngleSelected",value:function(e){this.setFromAngle(e),le(this.selectFromAngleButton,!1),le(this.selectFromEdgeButton,!1),this.center.valid()&&this.fromAngle.valid()&&!this.toAngle.valid()&&le(this.selectToAngleButton,!0)}},{key:"onToAngleHovered",value:function(e){this.setToAngle(e)}},{key:"onToAngleSelected",value:function(e){this.setToAngle(e),le(this.selectToAngleButton,!1),le(this.selectToEdgeButton,!1)}},{key:"onSelectCenterButton",value:function(){this.clearAngleToAngle()}},{key:"uninitialize",value:function(){z(Q(n.prototype),"uninitialize",this).call(this),this.viewer.removeEventListener(K.MODEL_ADDED_EVENT,this.updateModelCombo),this.viewer.removeEventListener(K.MODEL_REMOVED_EVENT,this.updateModelCombo)}}]),n}();function de(e){return(de="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function he(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function fe(e,t,n){return(fe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ee(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ge(e,t){return(ge=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ve(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Ee(e);if(t){var o=Ee(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return me(this,n)}}function me(e,t){return!t||"object"!==de(t)&&"function"!=typeof t?pe(e):t}function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ee(e){return(Ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}ue.Events=J,ue.TabIds=ce;var ye=Object.assign({},Autodesk.Edit3D.TwoPointPicker.Events),Te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ge(e,t)}(r,Autodesk.Edit3D.TwoPointPicker);var t,n,i,o=ve(r);function r(e,t,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var s={backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Blue},a={draggable:!0,labels:["From","To"],labelStyles:[s,s],colors:[Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Red],connections:[{fromIndex:0,toIndex:1,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Line,color:Autodesk.Edit3D.NPointPicker.Colors.Black,getEdgeLabelText:function(){var e=Math.abs(i.points[0].x-i.points[1].x),t=Math.abs(i.points[0].y-i.points[1].y),n=Math.abs(i.points[0].z-i.points[1].z),o=i.unitHandler.lengthToString(e),r=i.unitHandler.lengthToString(t),s=i.unitHandler.lengthToString(n);return"X: ".concat(o,", Y: ").concat(r,", Z: ").concat(s)},labelStyle:{backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Black}}]};return(i=o.call(this,e,t,n,a)).unitHandler=new Autodesk.Edit2D.DefaultUnitHandler(i.viewer),i.updateGizmos=i.updateGizmos.bind(pe(i)),i.viewer.addEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,i.updateGizmos),i}return t=r,(n=[{key:"dtor",value:function(){fe(Ee(r.prototype),"dtor",this).call(this),this.viewer.removeEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,this.updateGizmos)}},{key:"start",value:function(){this.setVisible(!0),this.startSelect()}},{key:"pause",value:function(){this.cancelPointSelection(),this.isActive=!1,this.setVisible(!1)}},{key:"cancel",value:function(){this.cancelPointSelection(),this.clear(),this.setVisible(!1)}},{key:"finish",value:function(e){return this.isActive=!1,this.apply(e)}},{key:"apply",value:function(e){var t=this;return new Promise((function(n){var i=e.getPlacementTransform(),o=t.pointValid[0]&&t.pointValid[1]?t.points[1].clone().sub(t.points[0]):t.offset,r=(new THREE.Vector3).setFromMatrixPosition(i),s=r.clone().add(o),a=new THREE.Vector3,l=new THREE.Vector3;t.screenOverlay.fadeOutGizmo(t.connectors[0].gizmo),t.connectors[0].label.setOpacity(0,!0),t.markers[0].setLabelVisible(!1),t.markers[1].setLabelVisible(!1),t.anim=Autodesk.Viewing.Private.fadeValue(0,1,1,(function(n){n=THREE.Math.smootherstep(n,0,1),a.lerpVectors(r,s,n),l.lerpVectors(t.points[0],t.points[1],n),t.markers[0].setPosition(l),i.setPosition(a),t.viewer.impl.setPlacementTransform(e,i)}),(function(e){t.clear(),t.anim=null,n()}))}))}},{key:"fitModelToView",value:function(e){var t=e.getBoundingBox(),n=this.viewer.impl.camera,i=Autodesk.Viewing.UnifiedCamera.getViewParamsFromBox(t,!1,n.aspect,n.up,n.fov),o=t.center(),r=i.position.distanceTo(i.target),s=n.getWorldDirection().clone().multiplyScalar(r),a=n.position.clone().add(s),l=o.distanceTo(a),c=2*t.size().length();if(l>c){var u=Math.max(l-c,0),d=a.clone().sub(o).normalize().multiplyScalar(u),h=e.getPlacementTransform(),f=(new THREE.Vector3).setFromMatrixPosition(h);f.add(d),h.setPosition(f),this.viewer.impl.setPlacementTransform(e,h),o.add(d)}this.setPoint(0,o),this.setPoint(1,a),this.apply(e)}},{key:"skipAnim",value:function(){this.anim&&this.anim.skip()}},{key:"isAnimationActive",value:function(){return this.anim&&this.anim.isRunning}}])&&he(t.prototype,n),i&&he(t,i),r}();Te.Events=ye;n(639);function Pe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Ae={CENTER_SELECTED:"centerSelected",CENTER_HOVERED:"centerHovered",FROM_ANGLE_SELECTED:"startAngleSelected",FROM_ANGLE_HOVERED:"startAngleHovered",TO_ANGLE_SELECTED:"endAngleSelected",TO_ANGLE_HOVERED:"endAngleHovered"},ke={NotSelecting:0,SelectingCenter:1,SelectingStartAngle:2,SelectingEndAngle:3,SelectingStartAngleEdge:4,SelectingEndAngleEdge:5},be={SinglePoint:0,Edge:1},Se=new THREE.Matrix4,Ce=new THREE.Matrix4,we=new THREE.Matrix4,De=new THREE.Quaternion,Oe=(new THREE.Vector3,new THREE.Vector2),Me=function(e){return e>=0?e:e+360},Re=function(){function e(t,n,i){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=Autodesk.Edit3D.CoordPicker,s=Autodesk.Edit3D.PointMarker,a=Autodesk.Edit3D.TwoPointPicker;this.viewer=t,this.coordPicker=n,Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.mode=ke.NotSelecting,this.defaultPickingMode=be.Edge,this.center=new THREE.Vector3,this.fromEdge={a:new THREE.Vector3,b:new THREE.Vector3},this.toEdge={a:new THREE.Vector3,b:new THREE.Vector3},this.centerValid=!1,this.fromValid=!1,this.toValid=!1,this.fromPointOnPlane=new THREE.Vector3,this.toPointOnPlane=new THREE.Vector3,this.screenOverlay=i,this.angleGizmo=new Autodesk.Edit2D.AngleGizmo(this.screenOverlay.layer,{startColor:Autodesk.Edit3D.NPointPicker.Colors.Blue,endColor:Autodesk.Edit3D.NPointPicker.Colors.Red,ignoreCameraDistance:!0,hideArrowHead:!0,centerLabel:!0,labelClassName:"angle-to-angle"}),this.angleGizmo.setVisible(!0),this.axis=new THREE.Vector3(0,0,1),this.selectionPlane=new THREE.Plane,this.fromConnector=new Autodesk.Edit2D.ScreenOverlay.Line3DGizmo,this.toConnector=new Autodesk.Edit2D.ScreenOverlay.Line3DGizmo;var l=this.fromConnector.line2D.style;l.lineStyle=10,l.lineWidth=1.5,l.lineColor="rgb(255, 0, 0)",l.lineOpacity=.7,this.toConnector.line2D.style.copy(l),this.animTime=1.5,this.fadeOutAngleGizmoAfter=.7,this.angleGizmoSize=60,this.angleGizmoBottomOffset=200,this.useFirstPointAsCenter=!0,this.visible=!0,this.onDragEdgeEnd=this.onDragEdgeEnd.bind(this);var c={backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Blue},u={draggable:!0,labels:["From"],labelStyles:[c],icons:[Autodesk.Edit3D.PointMarker.Icons.Cross,Autodesk.Edit3D.PointMarker.Icons.Empty],colors:[Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Blue],connections:[{fromIndex:0,toIndex:1,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Arrow,color:Autodesk.Edit3D.NPointPicker.Colors.Blue,getEdgeLabelText:function(){return o.fromValid?Me(o.edgeToAngle(o.fromEdge.b,o.fromEdge.a,!0)).toFixed(1)+"":""},labelStyle:{backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Black}}]};this.fromEdgePicker=new a(t,n,i,u),this.fromEdgePicker.addEventListener(a.Events.POINT_SELECTED,(function(){return o.onEdgeSelected(o.fromEdgePicker)})),this.fromEdgePicker.markers[0].addEventListener(s.Events.DRAG_START,(function(){o.mode=ke.SelectingStartAngleEdge})),this.fromEdgePicker.markers[1].addEventListener(s.Events.DRAG_START,(function(){o.mode=ke.SelectingStartAngleEdge})),this.fromEdgePicker.markers[0].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.fromEdgePicker.markers[1].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),u={draggable:!0,labels:["To"],labelStyles:[c],icons:[Autodesk.Edit3D.PointMarker.Icons.Cross,Autodesk.Edit3D.PointMarker.Icons.Empty],colors:[Autodesk.Edit3D.NPointPicker.Colors.Red,Autodesk.Edit3D.NPointPicker.Colors.Red],connections:[{fromIndex:0,toIndex:1,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Arrow,color:Autodesk.Edit3D.NPointPicker.Colors.Red,getEdgeLabelText:function(){return o.toValid?Me(o.edgeToAngle(o.toEdge.b,o.toEdge.a,!0)).toFixed(1)+"":""},labelStyle:{backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Black}}]},this.toEdgePicker=new a(t,n,i,u),this.toEdgePicker.addEventListener(a.Events.POINT_SELECTED,(function(){return o.onEdgeSelected(o.toEdgePicker)})),this.toEdgePicker.markers[0].addEventListener(s.Events.DRAG_START,(function(){o.mode=ke.SelectingEndAngleEdge})),this.toEdgePicker.markers[1].addEventListener(s.Events.DRAG_START,(function(){o.mode=ke.SelectingEndAngleEdge})),this.toEdgePicker.markers[0].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.toEdgePicker.markers[1].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.onPointClicked=this.onPointClicked.bind(this),this.onPointHovered=this.onPointHovered.bind(this),this.coordPicker.addEventListener(r.Events.POINT_CLICKED,this.onPointClicked),this.coordPicker.addEventListener(r.Events.POINT_HOVERED,this.onPointHovered),this.coordPicker.addEventListener(r.Events.ESCAPE,(function(){return o.cancelPointSelection()})),this.updateGizmos=this.updateGizmos.bind(this),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.updateGizmos),this.clearOnNextStart=!1,this.updateGizmos()}var t,n,i;return t=e,(n=[{key:"dtor",value:function(){this.coordPicker.removeEventListener(Autodesk.Edit3D.CoordPicker.Events.POINT_CLICKED,this.onPointClicked),this.coordPicker.removeEventListener(Autodesk.Edit3D.CoordPicker.Events.POINT_HOVERED,this.onPointHovered),this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.updateGizmos)}},{key:"start",value:function(){this.skipAnim(),this.clearOnNextStart&&this.clear(),this.isActive=!0,this.continuePointSelectionIfNeeded()}},{key:"pause",value:function(){this.cancelPointSelection(),this.setVisible(!1),this.isActive=!1,this.updateGizmos()}},{key:"cancel",value:function(){this.setVisible(!1),this.isActive=!1,this.clear()}},{key:"finish",value:function(e){return this.clearOnNextStart=!1,this.updateGizmos(),this.apply(e)}},{key:"startSelectCenter",value:function(e){this.clear(),this.isActive=!0,this.pointBackup=this.centerValid?this.center.clone():null,this.viewer.toolController.activateTool(this.coordPicker.getName()),this.mode=ke.SelectingCenter,e&&this.coordPicker.setDragging(!0)}},{key:"startCoordPicker",value:function(e){this.viewer.toolController.activateTool(this.coordPicker.getName())}},{key:"endCoordPicker",value:function(){this.viewer.toolController.setIsLocked(!1),this.viewer.toolController.deactivateTool(this.coordPicker.getName())}},{key:"onDragCenterEnd",value:function(e){var t=e.event;this.coordPicker.getDragging()&&(this.coordPicker.handleSingleClick(t,0),this.coordPicker.setDragging(!1))}},{key:"onDragEdgeEnd",value:function(){this.useFirstPointAsCenter&&this.mode===ke.SelectingStartAngleEdge&&this.setCenter(this.fromEdgePicker.points[0]),this.mode=ke.NotSelecting,this.continuePointSelectionIfNeeded()}},{key:"startSelectFromAngle",value:function(e){this.startCoordPicker(!0),this.mode=ke.SelectingStartAngle,this.pointBackup=this.fromValid?this.fromEdge.b.clone():null}},{key:"startSelectToAngle",value:function(e){this.startCoordPicker(!0),this.mode=ke.SelectingEndAngle,this.pointBackup=this.toValid?this.toEdge.b.clone():null}},{key:"setCenter",value:function(e){e?(this.center.copy(e),this.centerValid=!0,this.selectionPlane.setFromNormalAndCoplanarPoint(this.axis,this.center)):this.centerValid=!1,this.updateGizmos()}},{key:"setFromEdge",value:function(e,t){this.fromValid=Boolean(e&&t),this.fromValid&&(this.fromEdge.a.copy(e),this.fromEdge.b.copy(t)),this.updateGizmos()}},{key:"setToEdge",value:function(e,t){this.toValid=Boolean(e&&t),this.toValid&&(this.toEdge.a.copy(e),this.toEdge.b.copy(t)),this.updateGizmos()}},{key:"edgeToAngle",value:function(e,t,n){var i=e.x-t.x,o=e.y-t.y,r=Math.atan2(o,i);return n?THREE.Math.radToDeg(r):r}},{key:"onPointHovered",value:function(e){if(this.mode!==ke.NotSelecting&&e.point)switch(this.mode){case ke.SelectingCenter:this.setCenter(e.point),this.fireEvent({type:Ae.CENTER_HOVERED,point:e.point}),this.fromValid&&this.fireEvent({type:Ae.FROM_ANGLE_HOVERED,angle:this.edgeToAngle(this.fromEdge.b,this.center,!0)}),this.toValid&&this.fireEvent({type:Ae.TO_ANGLE_HOVERED,angle:this.edgeToAngle(this.toEdge.b,this.center,!0)});break;case ke.SelectingStartAngle:this.setFromEdge(this.center,e.point),this.fireEvent({type:Ae.FROM_ANGLE_HOVERED,angle:this.edgeToAngle(e.point,!0)});break;case ke.SelectingEndAngle:this.setToEdge(this.center,e.point),this.fireEvent({type:Ae.TO_ANGLE_HOVERED,angle:this.edgeToAngle(e.point,!0)});break;case ke.SelectingStartAngleEdge:(1===this.fromEdgePicker.selectingIndex||this.fromValid)&&(this.setFromEdge(this.fromEdgePicker.points[0],this.fromEdgePicker.points[1]),this.fireEvent({type:Ae.FROM_ANGLE_HOVERED,angle:this.edgeToAngle(this.fromEdgePicker.points[1],this.fromEdgePicker.points[0])}));break;case ke.SelectingEndAngleEdge:(1===this.toEdgePicker.selectingIndex||this.toValid)&&(this.setToEdge(this.toEdgePicker.points[0],this.toEdgePicker.points[1]),this.fireEvent({type:Ae.TO_ANGLE_HOVERED,angle:this.edgeToAngle(this.toEdgePicker.points[1],this.toEdgePicker.points[0])}))}}},{key:"updateAngleGizmo",value:function(){if(this.fromValid&&this.toValid&&this.centerValid){var e=this.viewer.impl.getCanvasBoundingClientRect();this.angleGizmo.setCenter(Oe.set(e.width/2,e.height-this.angleGizmoBottomOffset));var t=Math.PI/2;this.setPointFromAngle(Oe,-t,this.angleGizmoSize,this.angleGizmo.center),this.angleGizmo.setStart(Oe);var n=t+this.getOffsetAngle();this.setPointFromAngle(Oe,-n,this.angleGizmoSize,this.angleGizmo.center),this.angleGizmo.setEnd(Oe)}else this.angleGizmo.setCenter(null),this.angleGizmo.setStart(null),this.angleGizmo.setEnd(null);this.angleGizmo.update()}},{key:"updateGizmos",value:function(){var e=this.visible&&this.isActive;this.fromEdgePicker.setVisible(e&&this.fromValid),this.toEdgePicker.setVisible(e&&this.toValid),this.fromEdgePicker.updateGizmos(),this.toEdgePicker.updateGizmos(),this.visible&&(this.fromValid||this.toValid)&&(this.isActive||this.isAnimationActive())?(this.angleGizmo.fadeTo(1),this.angleGizmo.setLabelEnabled(!0),this.mode!==ke.NotSelecting&&this.angleGizmo.skipFade(),this.updateAngleGizmo()):(this.angleGizmo.fadeTo(0),this.angleGizmo.setLabelEnabled(!1),this.angleGizmo.update()),this.screenOverlay.update()}},{key:"onPointClicked",value:function(e){var t=e.point,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.mode!==ke.NotSelecting&&this.mode!==ke.SelectingStartAngleEdge&&this.mode!=ke.SelectingEndAngleEdge){t=t||this.pointBackup,this.pointBackup=null;var i=this.mode;this.mode=ke.NotSelecting,this.endCoordPicker(),t&&(this.viewer.impl.camera.pivot.copy(t),this.viewer.impl.camera.dirty=!0);var o=t?this.edgeToAngle(t,this.center,!0):null;switch(i){case ke.SelectingCenter:this.setCenter(t),this.fireEvent({type:Ae.CENTER_SELECTED,point:t});break;case ke.SelectingStartAngle:this.setFromEdge(this.center,t),this.fireEvent({type:Ae.FROM_ANGLE_SELECTED,angle:o});break;case ke.SelectingEndAngle:this.setToEdge(this.center,t),this.fireEvent({type:Ae.TO_ANGLE_SELECTED,angle:o});break;case ke.SelectingStartAngleEdge:case ke.SelectingEndAngleEdge:break;default:console.error("Unexpeced mode")}n&&this.continuePointSelectionIfNeeded()}}},{key:"cancelPointSelection",value:function(){this.onPointClicked({},!1),this.mode===ke.SelectingStartAngleEdge?this.fromValid=!1:this.mode===ke.SelectingEndAngleEdge&&(this.toValid=!1),this.fromEdgePicker.cancelPointSelection(),this.toEdgePicker.cancelPointSelection()}},{key:"continuePointSelectionIfNeeded",value:function(){var e=this;this.isPickerActive()&&(this.setVisible(!0),setTimeout((function(){e.centerValid||e.useFirstPointAsCenter?e.fromValid?e.toValid||(e.defaultPickingMode===be.Edge?e.startSelectToAngleEdge():e.defaultPickingMode===be.SinglePoint&&e.startSelectToAngle()):e.defaultPickingMode===be.Edge?e.startSelectFromAngleEdge():e.defaultPickingMode===be.SinglePoint&&e.startSelectFromAngle():e.startSelectCenter()}),1))}},{key:"getOffsetAngle",value:function(){if(this.fromValid&&this.toValid){var e=this.edgeToAngle(this.fromEdge.b,this.fromEdge.a);return this.edgeToAngle(this.toEdge.b,this.toEdge.a)-e}return this.offset}},{key:"createRotation",value:function(e,t,n){var i=Se.makeTranslation(-n.x,-n.y,-n.z),o=Ce.makeTranslation(n.x,n.y,n.z),r=De.setFromAxisAngle(this.axis,e),s=we.makeRotationFromQuaternion(r);return t.copy(o).multiply(s).multiply(i)}},{key:"clear",value:function(){this.clearOnNextStart=!1,this.fromValid=!1,this.toValid=!1,this.centerValid=!1,this.fromEdgePicker.clear(),this.toEdgePicker.clear(),this.isActive=!1,this.updateGizmos()}},{key:"apply",value:function(e){var t=this;return new Promise((function(n){var i=t.getOffsetAngle();(i=Autodesk.Extensions.CompGeom.normalizeAngle(i))>Math.PI&&(i-=2*Math.PI);var o=e.getPlacementTransform().clone(),r=new Autodesk.Viewing.Private.LmvMatrix4(!0),s=e.getGlobalOffset(),a=s?t.center.clone().add(s):t.center;t.fromEdgePicker.markers[0].setDraggable(!1),t.fromEdgePicker.markers[1].setDraggable(!1),t.toEdgePicker.markers[0].setDraggable(!1),t.toEdgePicker.markers[1].setDraggable(!1),t.anim=Autodesk.Viewing.Private.fadeValue(0,1,t.animTime,(function(n){var s=THREE.Math.smootherstep(n,0,1)*i;r=t.createRotation(s,r,t.center);var l=Math.PI/2;t.setPointFromAngle(Oe,-(l+s),t.angleGizmoSize,t.angleGizmo.center),t.angleGizmo.setStart(Oe),t.angleGizmo.update(),n>t.fadeOutAngleGizmoAfter&&t.angleGizmo.fadeTo(0),r=t.createRotation(s,r,a).multiply(o),t.viewer.impl.setPlacementTransform(e,r)}),(function(){t.angleGizmo.setLabelEnabled(!1),t.clear(),t.anim=null,n()}))}))}},{key:"setVisible",value:function(e){e!==this.visible&&(this.visible=e,this.updateGizmos())}},{key:"setPointFromAngle",value:function(e,t,n,i){e.set(1,0,0),Autodesk.Edit2D.Math2D.rotateAround(e,t),e.multiplyScalar(n).add(i)}},{key:"changeFromAngle",value:function(e){if(this.fromValid){if(void 0!==e){var t=this.fromPointOnPlane.distanceTo(this.center);this.setPointFromAngle(this.fromEdge.b,e,t,this.center)}else this.fromValid=!1;this.updateGizmos()}}},{key:"changeToAngle",value:function(e){if(this.toValid){if(void 0!==e){var t=this.toPointOnPlane.distanceTo(this.center);this.setPointFromAngle(this.toEdge.b,e,t,this.center)}else this.toValid=!1;this.updateGizmos()}}},{key:"changeOffset",value:function(e){this.centerValid&&(this.cancelPointSelection(),this.fromValid||(this.startSelectFromAngle(),this.fromValid=!0,this.changeFromAngle(0),this.onPointClicked({point:this.fromEdge.b})),this.toValid||(this.startSelectToAngle(),this.toValid=!0,this.changeToAngle(this.edgeToAngle(this.fromEdge.b,this.fromEdge.a)+e),this.onPointClicked({point:this.toEdge.b})),this.continuePointSelectionIfNeeded())}},{key:"startSelectFromAngleEdge",value:function(){this.mode=ke.SelectingStartAngleEdge,this.fromEdgePicker.startSelect()}},{key:"startSelectToAngleEdge",value:function(){this.mode=ke.SelectingEndAngleEdge,this.toEdgePicker.startSelect()}},{key:"onEdgeSelected",value:function(e){var t=this.mode===ke.SelectingStartAngleEdge,n=this.mode===ke.SelectingEndAngleEdge;if(t||n){var i=e.points[0],o=e.points[1];if(t?(this.useFirstPointAsCenter&&this.setCenter(i),this.setFromEdge(i,o)):this.setToEdge(i,o),this.updateGizmos(),t){var r=this.edgeToAngle(o,i,!0);this.fireEvent({type:Ae.FROM_ANGLE_SELECTED,angle:r})}else{var s=this.edgeToAngle(o,i,!0);this.fireEvent({type:Ae.TO_ANGLE_SELECTED,angle:s})}e.areAllPointsSet()&&(this.mode=ke.NotSelecting,this.continuePointSelectionIfNeeded())}}},{key:"isPickerActive",value:function(){return this.isActive}},{key:"skipAnim",value:function(){this.anim&&this.anim.skip()}},{key:"isAnimationActive",value:function(){return this.anim&&this.anim.isRunning}}])&&Pe(t.prototype,n),i&&Pe(t,i),e}();Re.Events=Ae,Re.Modes=ke,Re.PickingModes=be;var _e={en:n(353)};function Ne(e){return(Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xe(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function Ve(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Le(e,t,n){return(Le="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ge(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function He(e,t){return(He=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ie(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Ge(e);if(t){var o=Ge(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return Be(this,n)}}function Be(e,t){return!t||"object"!==Ne(t)&&"function"!=typeof t?Fe(e):t}function Fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ge(e){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ze=Autodesk.Viewing,Ue=(Autodesk.Viewing.Private,AutodeskNamespace("Autodesk.ModelAlignment")),je=function(e,t){if(e.isLeaflet())e.setThemingColor(null,t);else for(var n=e.myData.fragments.fragId2dbId,i=0;i<n.length;i++){var o=n[i];if(Array.isArray(o))for(var r=0;r<o.length;r++)e.setThemingColor(o[r],t);else e.setThemingColor(o,t)}},Ye=function(e){return void 0!==e?THREE.Math.degToRad(e):void 0},We={Default:"Default",Animating:"Animating",SelectModel:"SelectModel",PointToPoint:"PointToPoint",AngleToAngle:"AngleToAngle"},Qe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&He(e,t)}(a,e);var t,n,i,o,r,s=Ie(a);function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this,e,t)).name="Autodesk.ModelAlignment",n.onPlacementChanged=n.onPlacementChanged.bind(Fe(n)),n.onSaveButton=n.onSaveButton.bind(Fe(n)),n.onTabChanged=n.onTabChanged.bind(Fe(n)),n.onStateChanged=n.onStateChanged.bind(Fe(n)),n.onDisplayUnitsChanged=n.onDisplayUnitsChanged.bind(Fe(n)),n}return t=a,(n=[{key:"load",value:(o=regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.extendLocalization(_e),e.next=3,Le(Ge(a.prototype),"load",this).call(this);case 3:this.unitHandler=new Autodesk.Edit2D.DefaultUnitHandler(this.viewer),this.panel=new ue(this.viewer,"ModelAlignmentPanel","Model Alignment",this.unitHandler),this.viewer.addPanel&&this.viewer.addPanel(this.panel),this.viewer.addEventListener(ze.MODEL_PLACEMENT_CHANGED_EVENT,this.onPlacementChanged),this.viewer.addEventListener(ze.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,this.onDisplayUnitsChanged),this.onModelPanelSelect=this.onModelPanelSelect.bind(this),this.pointToPoint=new Te(this.viewer,this.coordPicker,this.screenOverlay),this.angleToAngle=new Re(this.viewer,this.coordPicker,this.screenOverlay),this.modelSelector=new N(this.viewer,(function(e){return t.isModelSelectable(e)})),this.viewer.toolController.registerTool(this.modelSelector),this.connectModelsPanel(),this.connectPointToPoint(),this.connectAngleToAngle(),this.connectModelSelector(),this.connectModelMoveTool(),this.panel.addEventListener(ue.Events.SAVE_BUTTON_PRESSED,this.onSaveButton),this.panel.addEventListener(ue.Events.MODEL_TRANSFORM_EDITED,(function(){t.positionEditInProgress=!0;var e=t.unitHandler.fromDisplayUnitsVec3(t.model.getUnitString(),t.panel.getPosition());t.transformEdit.update(),t.transformEdit.setPosition(e),t.transformEdit.setRotationZ(t.panel.getRotation()),t.transformEdit.apply(),t.modified(),t.positionEditInProgress=!1,t.onTabChanged()})),this.panel.addEventListener(ue.Events.TAB_CHANGED,this.onTabChanged),this.selectionColor=new THREE.Vector4(1,1,0,.25),this.transformEdit=new F(this.viewer);case 23:case"end":return e.stop()}}),e,this)})),r=function(){var e=this,t=arguments;return new Promise((function(n,i){var r=o.apply(e,t);function s(e){xe(r,n,i,s,a,"next",e)}function a(e){xe(r,n,i,s,a,"throw",e)}s(void 0)}))},function(){return r.apply(this,arguments)})},{key:"unload",value:function(){Le(Ge(a.prototype),"unload",this).call(this),this.viewer.removePanel&&this.viewer.removePanel(this.panel),this.panel.uninitialize(),this.panel=null,this.viewer.removeEventListener(ze.MODEL_PLACEMENT_CHANGED_EVENT,this.onPlacementChanged),this.viewer.removeEventListener(ze.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,this.onDisplayUnitsChanged),this.onExtensionLoaded&&this.viewer.removeEventListener(Autodesk.Viewing.EXTENSION_LOADED_EVENT,this.onExtensionLoaded),this.pointToPoint&&(this.pointToPoint.dtor(),this.pointToPoint=null),this.angleToAngle&&(this.angleToAngle=null),this.disconnectModelsPanel()}},{key:"getToolMode",value:function(){return this.isAnimationActive()?We.Animating:this.isAngleToAngleActive()?We.AngleToAngle:this.isPointToPointActive()?We.PointToPoint:this.isModelSelectorActive()?We.SelectModel:We.Default}},{key:"startAngleToAngle",value:function(){this.isAngleToAngleActive()||(this.stopTools(!0),this.angleToAngle.start(),this.onStateChanged())}},{key:"pauseAngleToAngle",value:function(){this.angleToAngle.pause(),this.onStateChanged()}},{key:"cancelAngleToAngle",value:function(){this.angleToAngle.cancel(),this.onStateChanged()}},{key:"isAngleToAngleActive",value:function(){return this.angleToAngle.isActive}},{key:"finishAngleToAngle",value:function(){var e=this;this.angleToAngle.finish(this.model).then((function(){e.modified(),e.onStateChanged()})),this.onStateChanged()}},{key:"startPointToPoint",value:function(){this.isPointToPointActive()||(this.stopTools(!0),this.pointToPoint.start(),this.onStateChanged())}},{key:"pausePointToPoint",value:function(){this.pointToPoint.pause(),this.onStateChanged()}},{key:"cancelPointToPoint",value:function(){this.pointToPoint.cancel(),this.onStateChanged()}},{key:"isPointToPointActive",value:function(){return this.pointToPoint.isActive}},{key:"finishPointToPoint",value:function(){var e=this;this.pointToPoint.finish(this.model).then((function(){e.modified(),e.onStateChanged()})),this.onStateChanged()}},{key:"startModelSelector",value:function(){this.isModelSelectorActive()||(this.stopTools(!0),this.viewer.toolController.activateTool(this.modelSelector.getName()),this.onStateChanged())}},{key:"isModelSelectorActive",value:function(){return this.modelSelector.active}},{key:"stopModelSelector",value:function(){this.isModelSelectorActive()&&(this.viewer.toolController.setIsLocked(!1),this.viewer.toolController.deactivateTool(this.modelSelector.getName()))}},{key:"startFreeTransform",value:function(){this.isFreeTransformActive()||(this.stopTools(!0),this.setTransformToolActive(!0),this.onStateChanged())}},{key:"pauseFreeTransform",value:function(){this.setTransformToolActive(!1)}},{key:"isFreeTransformActive",value:function(){var e=this.modelTransformTool.getName();return this.viewer.toolController.isToolActivated(e)}},{key:"stopTools",value:function(e){this.isPointToPointActive()&&(e?this.pausePointToPoint():this.cancelPointToPoint()),this.isAngleToAngleActive()&&(e?this.pauseAngleToAngle():this.cancelAngleToAngle()),this.isFreeTransformActive()&&this.pauseFreeTransform(),this.isModelSelectorActive()&&this.stopModelSelector()}},{key:"setModel",value:function(e){Le(Ge(a.prototype),"setModel",this).call(this,e),this.panel.setModel(e),this.updateColorTheming(),this.onTabChanged(),this.transformEdit.setModel(e),e&&this.stopModelSelector()}},{key:"setHoverHighlighting",value:function(e){this.modelSelector.setHoverHighlighting(e)}},{key:"isAnimationActive",value:function(){return this.pointToPoint.isAnimationActive()||this.angleToAngle.isAnimationActive()}},{key:"isResetEnabled",value:function(){return!!this.model&&!this.isPendingReset(this.model)&&(!!this.hasPendingChanges(this.model)||this.hasSavedTransform(this.model))}},{key:"resetToOriginalFileTransform",value:function(){if(!this.isResetEnabled())return!1;var e=this.getOriginalFileTransform(this.model);return this.viewer.impl.setPlacementTransform(this.model,e),this.modified(!0),!0}},{key:"getSelectableModels",value:function(){return this.panel.getSelectableModels()}},{key:"handlePositionEdit",value:function(e){this.positionEditInProgress=!0;var t=this.unitHandler.fromDisplayUnitsVec3(this.model.getUnitString(),e);this.transformEdit.update(),this.transformEdit.setPosition(t),this.transformEdit.apply(),this.modified(),this.positionEditInProgress=!1}},{key:"handleRotationZEdit",value:function(e){this.transformEdit.update(),this.transformEdit.setRotationZ(e),this.transformEdit.apply(),this.modified()}},{key:"getEditPosition",value:function(){this.transformEdit.update();var e=this.transformEdit.getPosition();return this.unitHandler.toDisplayUnitsVec3(this.model.getUnitString(),e)}},{key:"getEditRotationZ",value:function(){return this.transformEdit.update(),this.transformEdit.getRotationZ()}},{key:"discardChanges",value:function(){for(var e in this.pendingChanges){var t=this.pendingChanges[e].model,n=t.getDocumentNode().getRootNode().urn(),i=this.options.alignmentService.getTransform(n)||this.getOriginalFileTransform(t);this.viewer.impl.setPlacementTransform(t,i)}this.pendingChanges={}}},{key:"getChangedModelNames",value:function(){return Object.values(this.pendingChanges).map((function(e){return e.model.getDocumentNode().getModelName()}))}},{key:"setModelSelectionFilter",value:function(e){this.modelSelectionFilter=e}},{key:"isModelSelectable",value:function(e){return!(this.modelSelectionFilter&&!this.modelSelectionFilter(e))&&!1===this.isAlignmentLockedSync(e)}},{key:"onStateChanged",value:function(){this.updateTransformTool(),this.fireEvent({type:Autodesk.ModelAlignment.Events.STATE_CHANGED})}},{key:"setTransformToolActive",value:function(e){if(this.isFreeTransformActive()!=e){var t=this.modelTransformTool.getName();e?this.viewer.toolController.activateTool(t):this.viewer.toolController.deactivateTool(t)}}},{key:"updateTransformTool",value:function(){var e=this.getToolMode(),t=this.model&&e===We.Default;this.setTransformToolActive(t)}},{key:"onTabChanged",value:function(){var e=this.panel.selectedTabId;this.onStateChanged(),e===ue.TabIds.PointToPoint?this.startPointToPoint():this.cancelPointToPoint(),e===ue.TabIds.AngleToAngle?this.startAngleToAngle():this.cancelAngleToAngle()}},{key:"connectModelsPanel",value:function(){var e=this,t=this.viewer.getExtension("Autodesk.ModelsPanel");if(!t)return this.onExtensionLoaded=function(t){return"Autodesk.ModelsPanel"===t.extensionId&&e.connectModelsPanel()},void this.viewer.addEventListener(Autodesk.Viewing.EXTENSION_LOADED_EVENT,this.onExtensionLoaded);this.modelsPanel=t.panel,this.modelsPanel.addEventListener(Autodesk.Viewing.UI.ListPanelEvents.ITEM_SELECT,this.onModelPanelSelect),this.modelsPanel.setModelSelectionModeEnabled(!0)}},{key:"disconnectModelsPanel",value:function(){this.modelsPanel&&(this.modelsPanel.removeEventListener(Autodesk.Viewing.UI.ListPanelEvents.ITEM_SELECT,this.onModelPanelSelect),this.modelsPanel.setModelSelectionModeEnabled(!1))}},{key:"onModelPanelSelect",value:function(e){this.setModel(e.item.model)}},{key:"connectPointToPoint",value:function(){var e=this;this.panel.addEventListener(ue.Events.FROM_POINT_CHANGED,(function(t){return e.pointToPoint.setFrom(t.fromPoint)})),this.panel.addEventListener(ue.Events.TO_POINT_CHANGED,(function(t){return e.pointToPoint.setTo(t.toPoint)})),this.panel.addEventListener(ue.Events.OFFSET_CHANGED,(function(t){return e.pointToPoint.setOffset(t.offset)})),this.panel.addEventListener(ue.Events.FROM_POINT_BUTTON_PRESSED,(function(){return e.pointToPoint.startSelectFrom()})),this.panel.addEventListener(ue.Events.TO_POINT_BUTTON_PRESSED,(function(){return e.pointToPoint.startSelectTo()})),this.panel.addEventListener(ue.Events.APPLY_PTP_PRESSED,(function(){e.pointToPoint.apply(e.panel.model),e.modified()})),this.panel.addEventListener(ue.Events.FIT_TO_VIEW_BUTTON_PRESSED,(function(){e.pointToPoint.fitModelToView(e.panel.model),e.modified()})),this.pointToPoint.addEventListener(Te.Events.FROM_POINT_SELECTED,(function(t){return e.panel.onFromSelected(t.point)})),this.pointToPoint.addEventListener(Te.Events.FROM_POINT_HOVERED,(function(t){return e.panel.onFromHovered(t.point)})),this.pointToPoint.addEventListener(Te.Events.TO_POINT_HOVERED,(function(t){return e.panel.onToHovered(t.point)})),this.pointToPoint.addEventListener(Te.Events.TO_POINT_SELECTED,(function(t){return e.panel.onToSelected(t.point)}))}},{key:"connectAngleToAngle",value:function(){var e=this;this.panel.addEventListener(ue.Events.MODEL_SELECTED,(function(){return e.setModel(e.panel.model)})),this.panel.addEventListener(ue.Events.CENTER_CHANGED,(function(t){return e.angleToAngle.setCenter(t.center)})),this.panel.addEventListener(ue.Events.FROM_ANGLE_CHANGED,(function(t){return e.angleToAngle.changeFromAngle(Ye(t.angle))})),this.panel.addEventListener(ue.Events.TO_ANGLE_CHANGED,(function(t){return e.angleToAngle.changeToAngle(Ye(t.angle))})),this.panel.addEventListener(ue.Events.OFFSET_ANGLE_CHANGED,(function(t){return e.angleToAngle.changeOffset(Ye(t.angle))})),this.panel.addEventListener(ue.Events.CENTER_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectCenter()})),this.panel.addEventListener(ue.Events.FROM_ANGLE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectFromAngle()})),this.panel.addEventListener(ue.Events.TO_ANGLE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectToAngle()})),this.panel.addEventListener(ue.Events.FROM_EDGE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectFromAngleEdge()})),this.panel.addEventListener(ue.Events.TO_EDGE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectToAngleEdge()})),this.panel.addEventListener(ue.Events.APPLY_ATA_PRESSED,(function(){e.angleToAngle.apply(e.panel.model),e.modified()})),this.angleToAngle.addEventListener(Re.Events.CENTER_HOVERED,(function(t){return e.panel.onCenterHovered(t.point)})),this.angleToAngle.addEventListener(Re.Events.CENTER_SELECTED,(function(t){return e.panel.onCenterSelected(t.point)})),this.angleToAngle.addEventListener(Re.Events.FROM_ANGLE_HOVERED,(function(t){return e.panel.onFromAngleHovered(t.angle)})),this.angleToAngle.addEventListener(Re.Events.FROM_ANGLE_SELECTED,(function(t){return e.panel.onFromAngleSelected(t.angle)})),this.angleToAngle.addEventListener(Re.Events.TO_ANGLE_HOVERED,(function(t){return e.panel.onToAngleHovered(t.angle)})),this.angleToAngle.addEventListener(Re.Events.TO_ANGLE_SELECTED,(function(t){return e.panel.onToAngleSelected(t.angle)}))}},{key:"connectModelMoveTool",value:function(){var e=this;this.panel.addEventListener(ue.Events.EDIT_POSITION_PRESSED,(function(){return e.viewer.toolController.activateTool(e.modelTransformTool.getName())}))}},{key:"connectModelSelector",value:function(){var e=this;this.panel.addEventListener(ue.Events.SELECT_MODEL_PRESSED,(function(t){e.startModelSelector()})),this.modelSelector.addEventListener(N.Events.MODEL_SELECTED,(function(t){t.model||!e.model?e.setModel(t.model):e.stopModelSelector()}))}},{key:"updateColorTheming",value:function(){for(var e=this.model&&this.model.myData.urn,t=function(t){return e&&t.myData.urn===e},n=this.viewer.getVisibleModels(),i=0;i<n.length;i++){var o=n[i];t(o)?je(o,this.selectionColor):this.viewer.clearThemingColors(o)}this.viewer.impl.invalidate(!0)}},{key:"onSaveButton",value:function(){this.pointToPoint.skipAnim(),this.angleToAngle.skipAnim(),Le(Ge(a.prototype),"onSaveButton",this).call(this)}},{key:"onPlacementChanged",value:function(e){e.model===this.model&&(this.positionEditInProgress||this.panel.updateTransformValues(),this.syncAlignments())}},{key:"syncAlignments",value:function(){if(this.model&&!this.model.is2d())for(var e=this.model.myData.urn,t=this.model.getPlacementTransform(),n=this.viewer.getVisibleModels(),i=0;i<n.length;i++){var o=n[i],r=o.myData.urn==e&&o!==this.model;o.is3d()&&r&&this.viewer.impl.setPlacementTransform(o,t)}}},{key:"onDisplayUnitsChanged",value:function(){this.panel.updateTransformValues()}}])&&Ve(t.prototype,n),i&&Ve(t,i),a}(C);Qe.ToolModes=We,Ue.ModelAlignment=Qe,Ue.ModelAlignmentPanel=ue,Ue.AngleToAngle=Re,Ue.ModelSelector=N,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.ModelAlignment",Qe);var Ze,qe,Xe,Ke,Je,$e,et,tt,nt,it,ot=(Ze=new THREE.Quaternion,qe=new THREE.Quaternion,Xe=new THREE.Quaternion,Ke=new THREE.Matrix4,Je=new THREE.Matrix4,$e=new THREE.Matrix4,et=new THREE.Vector3,tt=new THREE.Vector3,nt=new THREE.Matrix4,it=new THREE.Matrix4,function(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=o.onChange,s=o.onEnd,a=o.applyTranslation,l=void 0===a||a,c=o.applyRotation,u=void 0===c||c,d=o.applyScale,h=void 0===d||d,f=o.duration,g=void 0===f?1:f,v=o.originalMatrix?o.originalMatrix.clone():void 0,m=n.clone().sub(e),p=e.distanceTo(t),E=n.distanceTo(i),y=E/p,T=t.clone().sub(e).normalize(),P=i.clone().sub(n).normalize();Ze.setFromUnitVectors(T,P),nt.identity().setPosition(e),it.identity().setPosition(e.clone().multiplyScalar(-1));var A=function(e){if(e=THREE.Math.smootherstep(e,0,1),Je.identity(),l&&(et.lerpVectors(tt,m,e),Je.makeTranslation(et.x,et.y,et.z)),Je.multiply(nt),u&&(THREE.Quaternion.slerp(qe,Ze,Xe,e),$e.makeRotationFromQuaternion(Xe),Je.multiply($e)),h){var t=Autodesk.Viewing.Private.lerp(1,y,e);Ke.makeScale(t,t,t),Je.multiply(Ke)}Je.multiply(it),v&&Je.multiply(v),r&&r(Je)},k=Autodesk.Viewing.Private.fadeValue(0,1,g,A,s);return k}),rt=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Quaternion,r=new THREE.Quaternion,s=new THREE.Vector3,a=new THREE.Vector3,l=new THREE.Quaternion;return function(c,u,d,h){return c.decompose(e,o,n),u.decompose(t,r,i),s.lerpVectors(e,t,d),a.lerpVectors(n,i,d),THREE.Quaternion.slerp(o,r,l,d),h.compose(s,l,a),h}}();function st(e){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function at(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function lt(e,t){return(lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ct(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=dt(e);if(t){var o=dt(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return ut(this,n)}}function ut(e,t){return!t||"object"!==st(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function dt(e){return(dt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ht={SOURCE_POINT_SELECTION_STARTED:"sourcePointSelectionStarted",DEST_POINT_SELECTION_STARTED:"destPointSelectionStarted"},ft=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lt(e,t)}(r,Autodesk.Edit3D.NPointPicker);var t,n,i,o=ct(r);function r(e,t,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var s={width:"34px",height:"34px",padding:"7px",boxSizing:"border-box",borderRadius:"20px",border:"1px solid",backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.White},a=Object.assign({},s,{borderColor:Autodesk.Edit3D.NPointPicker.Colors.Blue,color:Autodesk.Edit3D.NPointPicker.Colors.Blue}),l=Object.assign({},s,{borderColor:Autodesk.Edit3D.NPointPicker.Colors.Red,color:Autodesk.Edit3D.NPointPicker.Colors.Red}),c={draggable:!0,colors:[Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Red,Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Red],icons:[Autodesk.Edit3D.PointMarker.Icons.Circle,Autodesk.Edit3D.PointMarker.Icons.Circle,Autodesk.Edit3D.PointMarker.Icons.Circle,Autodesk.Edit3D.PointMarker.Icons.Circle],labels:["1","2","1","2"],labelStyles:[a,l,a,l],connections:[{fromIndex:0,toIndex:2,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Line,color:Autodesk.Edit3D.NPointPicker.Colors.Blue},{fromIndex:1,toIndex:3,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Line,color:Autodesk.Edit3D.NPointPicker.Colors.Red}],stops:[1]};return(i=o.call(this,e,t,n,4,c)).addEventListener(Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTION_STARTED,(function(e){var t=e.index;0!==t||i.pointValid[0]?2!==t||i.pointValid[2]||i.fireEvent({type:ht.DEST_POINT_SELECTION_STARTED}):i.fireEvent({type:ht.SOURCE_POINT_SELECTION_STARTED})})),i}return t=r,(n=[{key:"apply",value:function(e,t){var n=this;if(!this.anim){var i={transform:e.getPlacementTransform().clone(),model:e,s0:this.points[0].clone(),s1:this.points[1].clone(),t0:this.points[2].clone(),t1:this.points[3].clone()},o=e.getPlacementTransform().clone(),r=this.points[0].clone(),s=this.points[1].clone(),a=this.points[2].clone(),l=this.points[3].clone();t&&(a.add(t),l.add(t)),this.anim=ot(r,s,a,l,{onChange:function(t){n.viewer.impl.setPlacementTransform(e,t.multiply(o))},onEnd:function(){n.alignmentBackup=i,n.anim=null,n.clear()}})}}},{key:"restorePreviousTransform",value:function(e){var t=this;if(this.alignmentBackup&&!this.anim){var n=this.alignmentBackup,i=n.transform,o=n.model,r=n.s0,s=n.s1,a=n.t0,l=n.t1;this.anim=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.onChange,o=n.onEnd,r=n.duration,s=void 0===r?1:r,a=new Autodesk.Viewing.Private.LmvMatrix4(t.isDoublePrecision),l=function(n){n=Autodesk.Viewing.Private.smootherStep(n),rt(e,t,n,a),i&&i(a)};return Autodesk.Viewing.Private.fadeValue(0,1,s,l,o)}(o.getPlacementTransform().clone(),i,{onChange:function(e){t.viewer.impl.setPlacementTransform(o,e)},onEnd:function(){e?(t.setPoint(0,r),t.setPoint(1,s),t.setPoint(2,a),t.setPoint(3,l),t.lastSelectedPoint=3,t.anim=null,t.clearAlignmentBackup(),t.startSelect(),t.fireEvent({type:Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTED,point:a,index:3})):(t.anim=null,t.clearAlignmentBackup())}})}}},{key:"hasAlignmentBackup",value:function(){return!!this.alignmentBackup}},{key:"clearAlignmentBackup",value:function(){this.alignmentBackup=null}},{key:"skipAnim",value:function(){var e;null===(e=this.anim)||void 0===e||e.skip()}},{key:"isSelectingSourcePointsDone",value:function(){return 0!==this.selectingIndex&&1!==this.selectingIndex&&this.pointValid[0]&&this.pointValid[1]}},{key:"isAnimationActive",value:function(){var e;return null===(e=this.anim)||void 0===e?void 0:e.isRunning}}])&&at(t.prototype,n),i&&at(t,i),r}();ft.Events=ht;var gt={en:n(354)},vt=n(12),mt=n(49);function pt(e){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Et(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function yt(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){Et(r,i,o,s,a,"next",e)}function a(e){Et(r,i,o,s,a,"throw",e)}s(void 0)}))}}function Tt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Pt(e,t,n){return(Pt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ct(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function At(e,t){return(At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function kt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Ct(e);if(t){var o=Ct(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return bt(this,n)}}function bt(e,t){return!t||"object"!==pt(t)&&"function"!=typeof t?St(e):t}function St(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ct(e){return(Ct=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var wt=AutodeskNamespace("Autodesk.SheetAlignment"),Dt={SURFACE_SELECTED:"surfaceSelected",SELECT_SHEET:"selectSheet"},Ot=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(u,e);var t,n,i,o,r,s,a,l,c=kt(u);function u(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(n=c.call(this,e,t)).name="Autodesk.SheetAlignment",n.tmpBox=new THREE.Box3,n.onCropChanged=n.onCropChanged.bind(St(n)),n.fadeDuration=.3,n.hoverColor=new THREE.Color(0,.5,1),n.modelTransformToolAxis=["X","Y","XY"],n}return t=u,(n=[{key:"load",value:(l=yt(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.extendLocalization(gt),this.model=null,this.target3DModel=null,e.next=5,Pt(Ct(u.prototype),"load",this).call(this);case 5:return e.next=7,this.viewer.loadExtension("Autodesk.Crop",{disableMoveTool:!0});case 7:this.cropExtension=e.sent,this.cropExtension.addEventListener(Autodesk.Crop.Events.CROP_MODIFIED,this.onCropChanged),this.fourPointsAlignment=new ft(this.viewer,this.coordPicker,this.screenOverlay),this.onPointSelectionStarted=this.onPointSelectionStarted.bind(this),this.onPointPicked=this.onPointPicked.bind(this),this.fourPointsAlignment.addEventListener(Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTION_STARTED,this.onPointSelectionStarted),this.fourPointsAlignment.addEventListener(Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTED,this.onPointPicked),this.onSheetSelected=this.onSheetSelected.bind(this),this.onSurfacePicked=this.onSurfacePicked.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.viewer.registerContextMenuCallback("Autodesk.SheetAlignment",this.onContextMenu),this.targetPos=null,this.targetNormal=null,this.animationHandleMap={},this.boundsPlane=new mt.a(this.viewer,"SheetAlignment_Extension_Overlay");case 22:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"unload",value:function(){Pt(Ct(u.prototype),"unload",this).call(this),this.fourPointsAlignment&&(this.fourPointsAlignment.dtor(),this.fourPointsAlignment=null),this.clearHighlight(),this.cropExtension.removeEventListener(Autodesk.Crop.Events.CROP_MODIFIED,this.onCropChanged),this.model=null,this.target3DModel=null,this.viewer.unregisterContextMenuCallback("Autodesk.SheetAlignment"),this.animationHandleMap={},this.boundsPlane.destroy(),this.boundsPlane=null}},{key:"getRightVector",value:function(e){var t=this.viewer.navigation.getWorldUpVector(),n=new THREE.Vector3;return n.crossVectors(e,t),n.lengthSq()<1e-4&&(Math.abs(e.z)>=Math.abs(e.y)?t.set(0,1,0):t.set(0,0,1),n.crossVectors(e,t)),n.normalize()}},{key:"applyInitialSheetTransform",value:function(){if(this.targetPos&&this.targetNormal){var e=this.model.getBoundingBox(!0,!0).center(),t=this.targetNormal,n=this.targetPos.sub(e).sub(t.clone().multiplyScalar(1e-4)),i=this.getRightVector(t).cross(t).normalize(),o=new THREE.Matrix4;o.lookAt(new THREE.Vector3,t,i);var r=(new THREE.Matrix4).makeTranslation(-e.x,-e.y,-e.z),s=(new THREE.Matrix4).makeTranslation(e.x,e.y,e.z),a=(new THREE.Matrix4).makeTranslation(n.x,n.y,n.z).multiply(s).multiply(o).multiply(r);this.viewer.impl.setPlacementTransform(this.model,a),this.modified(),this.targetPos=null}}},{key:"setModel",value:function(e){this.model!==e&&(this.cropExtension.setModel(e),Pt(Ct(u.prototype),"setModel",this).call(this,e))}},{key:"onSheetSelected",value:(a=yt(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSheet(t,n);case 2:if(e.sent){e.next=6;break}return this.cancel(),e.abrupt("return");case 6:this.showSheet();case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"showSheet",value:(s=yt(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.waitingForPlacementApproval=!1,this.boundsPlane.setVisible(!1),this.clearHighlight(),this.model){e.next=5;break}return e.abrupt("return");case 5:return this.cropExtension.cropToModelBounds(!0),this.viewer.impl.setDoNotCut(this.model,!0),this.fourPointsAlignment.clear(),this.fourPointsAlignment.attachPointsToModel(this.model,[0,1]),-1===this.viewer.getVisibleModels().indexOf(this.model)&&this.viewer.showModel(this.model),this.applyInitialSheetTransform(),e.next=13,this.fitCameraToSheet();case 13:null===(t=this.viewer.getExtension("Autodesk.Section"))||void 0===t||t.deactivate(!0),this.modelTransformTool.setModel(this.model,this.getMinCroppedBox(),!0),this.viewer.impl.changePaperVisibility(this.model,!1,!0,(function(){n.startPointToPointSelection(),n.show()}),1);case 16:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"setTarget3DModel",value:function(e){this.target3DModel=e,this.target3DModel&&this.fourPointsAlignment.attachPointsToModel(e,[2,3])}},{key:"onSaveButton",value:function(){this.fourPointsAlignment.skipAnim(),Pt(Ct(u.prototype),"onSaveButton",this).call(this)}},{key:"startPointToPointSelection",value:function(){this.fourPointsAlignment.startSelect()}},{key:"applyPointsToPoints",value:function(){var e;this.transformBackup=this.model.getPlacementTransform().clone();var t=null===(e=this.targetNormal)||void 0===e?void 0:e.clone().negate().multiplyScalar(1e-4);this.fourPointsAlignment.apply(this.model,t),this.modified()}},{key:"restorePreviousTransform",value:function(e){this.fourPointsAlignment.restorePreviousTransform(e)}},{key:"cancel",value:function(){var e,t;this.hide(),this.clearHighlight(),this.restorePreviousTransform(),this.fourPointsAlignment.clearAlignmentBackup(),this.fourPointsAlignment.clear(),this.cropExtension.deactivate(),this.clearSurfacePicking(),this.waitingForPlacementApproval=!1,this.boundsPlane.setVisible(!1),this.model&&(null===(e=(t=this.options).hideSheet)||void 0===e||e.call(t,this.model)),this.setModel(null),this.setTarget3DModel(null)}},{key:"areAllPointsSet",value:function(){return this.fourPointsAlignment.areAllPointsSet()}},{key:"fitCameraToSheet",value:function(){var e=this;if(this.model){this.viewer.navigation.toOrthographic();var t=this.getMinCroppedBox(),n=t.size();t.expandByVector(new THREE.Vector3(n.x*this.viewer.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN,n.y*this.viewer.navigation.FIT_TO_VIEW_VERTICAL_MARGIN,0));var i=this.model.getModelToViewerTransform()||new THREE.Matrix4,o=t.center(),r=o.clone().applyMatrix4(i),s=o;s.z-=t.size().y,s.applyMatrix4(i);var a=new THREE.Matrix4;a.extractRotation(i);var l={position:r,target:s,up:new THREE.Vector3(0,1,0).applyMatrix4(a).normalize()};return new Promise((function(t){Autodesk.Viewing.Private.flyToView(e.viewer,l,.5,t,!1)}))}}},{key:"fitCameraToTargetModel",value:function(){if(this.target3DModel){var e=(new THREE.Box3).copy(this.target3DModel.getBoundingBox());this.viewer.navigation.fitBounds(!1,e,!1)}}},{key:"show",value:function(){this.model&&!this.active&&(this.active=!0,this.fourPointsAlignment.setVisible(!0),this.fourPointsAlignment.continuePointSelectionIfNeeded(),this.cropExtension.activate(),this.viewer.toolController.isToolActivated(this.modelTransformTool.getName())||this.viewer.toolController.activateTool(this.modelTransformTool.getName()))}},{key:"hide",value:function(){this.active&&(this.active=!1,this.fourPointsAlignment.cancelPointSelection(),this.fourPointsAlignment.setVisible(!1),this.viewer.toolController.deactivateTool(this.modelTransformTool.getName()),this.clearIsolation())}},{key:"getMinCroppedBox",value:function(){var e;if(!this.model)return null;var t=this.tmpBox.copy(this.model.getBoundingBox(!0)),n=null===(e=this.cropExtension.getCurrentCropRegion())||void 0===e?void 0:e.bbox;return n&&t.intersect(n),t}},{key:"onCropChanged",value:function(){var e=this.getMinCroppedBox();this.modelTransformTool.setModel(this.model,e,!0);var t=this.cropExtension.getCurrentCropRegion();this.modified(t)}},{key:"onPointSelectionStarted",value:function(e){var t=e.index;0===t||1===t?this.isolate2DSheet():this.isolate3DModel(),this.cropExtension.activate()}},{key:"onPointPicked",value:function(){this.fourPointsAlignment.areAllPointsSet()&&this.clearIsolation()}},{key:"isolate2DSheet",value:function(){this.animateModelVisibility(this.model,!0),this.animateModelVisibility(this.target3DModel,!1)}},{key:"isolate3DModel",value:function(){this.animateModelVisibility(this.model,!1),this.animateModelVisibility(this.target3DModel,!0)}},{key:"clearIsolation",value:function(){this.animateModelVisibility(this.model,!0),this.animateModelVisibility(this.target3DModel,!0)}},{key:"isAnimationActive",value:function(){return this.fourPointsAlignment.isAnimationActive()}},{key:"animateModelVisibility",value:function(e,t){if(e)return e.is2d()?this.animateModelVisibility2D(e,t):this.animateModelVisibility3D(e,t)}},{key:"animateModelVisibility2D",value:function(e,t){var n;null===(n=e.visibilityManager)||void 0===n||n.setAllVisibility(t),this.viewer.impl.changePaperVisibility(e,!1)}},{key:"animateModelVisibility3D",value:function(e,t){var n,i=this;t&&(null===(n=e.visibilityManager)||void 0===n||n.setAllVisibility(!0));var o=this.viewer.impl.matman(),r=Object.values(o.getModelMaterials(e,!0).mats),s=this.viewer.impl.fadeMaterial.opacity,a=function(e){r.forEach((function(n){var i=n.opacity,o=t?n.origOpacity:s;n.opacity=(1-e)*i+o*e})),i.viewer.impl.invalidate(!0)};return this.animationHandleMap[e.id]&&(this.animationHandleMap[e.id].stop(),delete this.animationHandleMap[e.id]),r.forEach((function(e){void 0===e.origOpacity&&(e.origOpacity=e.opacity,e.origTransparent=e.transparent,e.transparent=!0)})),new Promise((function(n){i.animationHandleMap[e.id]=Autodesk.Viewing.Private.fadeValue(0,1,i.fadeDuration,a,(function(){var o;t?r.forEach((function(e){e.opacity=e.origOpacity,e.transparent=e.origTransparent,delete e.origOpacity,delete e.origTransparent})):null===(o=e.visibilityManager)||void 0===o||o.setAllVisibility(!1),delete i.animationHandleMap[e.id],n()}))}))}},{key:"mirrorX",value:function(){var e=this.model.getPlacementTransform(),t=new THREE.Matrix4;t.elements[5]=-1;var n=this.model.getBoundingBox(!0,!0).size(),i=(new THREE.Matrix4).makeTranslation(0,-n.y,0);e.multiply(t).multiply(i),this.viewer.impl.setPlacementTransform(this.model,e)}},{key:"mirrorY",value:function(){var e=this.model.getPlacementTransform(),t=new THREE.Matrix4;t.elements[0]=-1;var n=this.model.getBoundingBox(!0,!0).size(),i=(new THREE.Matrix4).makeTranslation(-n.x,0,0);e.multiply(t).multiply(i),this.viewer.impl.setPlacementTransform(this.model,e)}},{key:"onContextMenu",value:function(e,t){var n,i,o=this,r=this.viewer.impl.hitTest(t.canvasX,t.canvasY,!1);if((null==r||null===(n=r.model)||void 0===n?void 0:n.is3d())&&!this.fourPointsAlignment.isPickerActive()&&(null==r||null===(i=r.face)||void 0===i?void 0:i.normal)){var s=r.point,a=this.viewer.impl.getRenderProxy(r.model,r.fragId),l=(new THREE.Matrix3).getNormalMatrix(a.matrixWorld),c=r.face.normal.clone().applyMatrix3(l).normalize(),u=r.model,d={title:"Add drawing",target:function(){return o.onSurfacePicked({point:s,normal:c,modelId:u.id,dbId:r.dbId})}};e.push(d)}}},{key:"saveChanges",value:(r=yt(regeneratorRuntime.mark((function e(){var t,n,i,o,r,s,a,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.model&&this.target3DModel){e.next=2;break}return e.abrupt("return");case 2:return this.options.alignmentService||console.error("AlignmentService must be set for saving transforms"),this.cropExtension.deactivate(),this.viewer.toolController.deactivateTool(this.modelTransformTool.getName()),t=this.model.getPlacementTransform(),n=this.model.getDocumentNode(),i=n.getRootNode().urn(),o=n.lineageUrn(),r=n.name(),s=this.target3DModel.getDocumentNode(),a=s.lineageUrn(),l=this.cropExtension.getCurrentCropRegion(),this.model.regionId=this.model.regionId||Object(vt.v4)(),e.next=16,this.options.alignmentService.saveRelationship(a,encodeURIComponent(s.name()),o,encodeURIComponent(r),this.model.regionId);case 16:return e.next=18,this.options.alignmentService.saveViewport(i,r,this.model.regionId,l.bbox,t);case 18:this.pendingChanges=[],this.fourPointsAlignment.clearAlignmentBackup(),this.cancel();case 21:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearHighlight",value:function(){this.viewer.impl.renderer().setRollOverHighlightColor(),this.viewer.impl.pauseHighlight(!1),this.viewer.impl.clearHighlight()}},{key:"clearSurfacePicking",value:function(){this.coordPicker.removeEventListener(Autodesk.Edit3D.CoordPicker.Events.POINT_CLICKED,this.onSurfacePicked),this.coordPicker.setCursor(),this.viewer.toolController.setIsLocked(!1),this.viewer.toolController.deactivateTool(this.coordPicker.getName()),this.viewer.clearSelection();var e=this.isPickingSurface;return this.isPickingSurface=!1,e}},{key:"selectSheet",value:function(){var e,t=this.target3DModel.getDocumentNode().getRootNode();if(t.search(Autodesk.Viewing.BubbleNode.SHEET_NODE).length>0){var n=Autodesk.Viewing.fromUrlSafeBase64(t.urn());e={urn:n,bubbleUrn:n,fileName:t.getModelName()}}this.fireEvent({type:Dt.SELECT_SHEET,file:e,onSheetSelected:this.onSheetSelected})}},{key:"loadSheet",value:(o=yt(regeneratorRuntime.mark((function e(t,n){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this.options.loadSheet(t,n);case 4:return i=e.sent,this.setModel(i),e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"setBoundsPlane",value:function(){var e,t=(new THREE.Matrix4).makeTranslation(this.targetPos.x,this.targetPos.y,this.targetPos.z),n=this.getRightVector(this.targetNormal).cross(this.targetNormal).normalize(),i=(new THREE.Matrix4).lookAt(new THREE.Vector3,this.targetNormal,n),o=Autodesk.Viewing.Private.convertUnits("m",this.target3DModel.getUnitString(),1,1),r=null===(e=this.model)||void 0===e?void 0:e.getBoundingBox(!0,!0).size(),s=(null==r?void 0:r.x)||3*o,a=(null==r?void 0:r.y)||3*o,l=(new THREE.Matrix4).makeScale(s,a,1);t.multiply(i).multiply(l),this.boundsPlane.setFromMatrix(t),this.boundsPlane.setVisible(!0)}},{key:"onSurfacePicked",value:function(e){var t=e.point,n=e.normal,i=e.modelId;if(t&&n&&i){this.surfacePickedManually=this.clearSurfacePicking(),this.clearHighlight(),this.selectionPlane=new THREE.Plane,this.selectionPlane.setFromNormalAndCoplanarPoint(n,t),this.coordPicker.setSelectionPlane(this.selectionPlane),this.targetPos=t,this.targetNormal=n.negate();var o=this.viewer.impl.findModel(i);this.setTarget3DModel(o),this.setBoundsPlane(),this.fireEvent({type:Dt.SURFACE_SELECTED}),this.surfacePickedManually||this.selectSheet()}}},{key:"startPickingSurface",value:function(e,t){this.cancel(),e&&t&&this.loadSheet(e,t),this.viewer.toolController.activateTool(this.coordPicker.getName()),this.viewer.impl.pauseHighlight(!1),this.coordPicker.snapperOff(),this.coordPicker.setCursor("pointer"),this.coordPicker.setSelectionPlane(),this.viewer.impl.renderer().setRollOverHighlightColor(this.hoverColor),this.coordPicker.addEventListener(Autodesk.Edit3D.CoordPicker.Events.POINT_CLICKED,this.onSurfacePicked),this.isPickingSurface=!0,this.waitingForPlacementApproval=!0}}])&&Tt(t.prototype,n),i&&Tt(t,i),u}(C);wt.SheetAlignment=Ot,wt.Events=Dt,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.SheetAlignment",Ot)}});
//# sourceMappingURL=ModelAlignment.min.js.map