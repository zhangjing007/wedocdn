/*!
 * LMV v7.51.0
 * 
 * Copyright 2021 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.BimMarkups=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=781)}([,,function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var i=(o=r,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),A=r.sources.map((function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"}));return[n].concat(A).concat([i]).join("\n")}var o;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},i=0;i<this.length;i++){var A=this[i][0];"number"==typeof A&&(r[A]=!0)}for(i=0;i<e.length;i++){var o=e[i];"number"==typeof o[0]&&r[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),t.push(o))}},t}},function(e,t,n){var r,i,A={},o=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===i&&(i=r.apply(this,arguments)),i}),a=function(e,t){return t?t.querySelector(e):document.querySelector(e)},s=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var r=a.call(this,e,n);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(e){r=null}t[e]=r}return t[e]}}(),u=null,c=0,l=[],h=n(5);function d(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=A[r.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](r.parts[o]);for(;o<r.parts.length;o++)i.parts.push(m(r.parts[o],t))}else{var a=[];for(o=0;o<r.parts.length;o++)a.push(m(r.parts[o],t));A[r.id]={id:r.id,refs:1,parts:a}}}}function p(e,t){for(var n=[],r={},i=0;i<e.length;i++){var A=e[i],o=t.base?A[0]+t.base:A[0],a={css:A[1],media:A[2],sourceMap:A[3]};r[o]?r[o].parts.push(a):n.push(r[o]={id:o,parts:[a]})}return n}function f(e,t){var n=s(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=l[l.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),l.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var i=s(e.insertAt.before,n);n.insertBefore(t,i)}}function y(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=l.indexOf(e);t>=0&&l.splice(t,1)}function g(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var r=function(){0;return n.nc}();r&&(e.attrs.nonce=r)}return E(t,e.attrs),f(e,t),t}function E(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function m(e,t){var n,r,i,A;if(t.transform&&e.css){if(!(A="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=A}if(t.singleton){var o=c++;n=u||(u=g(t)),r=w.bind(null,n,o,!1),i=w.bind(null,n,o,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",E(t,e.attrs),f(e,t),t}(t),r=C.bind(null,n,t),i=function(){y(n),n.href&&URL.revokeObjectURL(n.href)}):(n=g(t),r=k.bind(null,n),i=function(){y(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else i()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=o()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=p(e,t);return d(n,t),function(e){for(var r=[],i=0;i<n.length;i++){var o=n[i];(a=A[o.id]).refs--,r.push(a)}e&&d(p(e,t),t);for(i=0;i<r.length;i++){var a;if(0===(a=r[i]).refs){for(var s=0;s<a.parts.length;s++)a.parts[s]();delete A[a.id]}}}};var B,v=(B=[],function(e,t){return B[e]=t,B.filter(Boolean).join("\n")});function w(e,t,n,r){var i=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=v(t,i);else{var A=document.createTextNode(i),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(A,o[t]):e.appendChild(A)}}function k(e,t){var n=t.css,r=t.media;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function C(e,t,n){var r=n.css,i=n.sourceMap,A=void 0===t.convertToAbsoluteUrls&&i;(t.convertToAbsoluteUrls||A)&&(r=h(r)),i&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var o=new Blob([r],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(o),a&&URL.revokeObjectURL(a)}},,function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,r=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var i,A=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(A)?e:(i=0===A.indexOf("//")?A:0===A.indexOf("/")?n+A:r+A.replace(/^\.\//,""),"url("+JSON.stringify(i)+")")}))}},,,,function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,n){var r=n(19),i="object"==typeof self&&self&&self.Object===Object&&self,A=r||i||Function("return this")();e.exports=A},,function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var r=n(10).Symbol;e.exports=r},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){var r=n(13),i=n(25),A=n(26),o=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?i(e):A(e)}},function(e,t,n){var r=n(48),i=n(49),A=i;A.v1=r,A.v4=i,e.exports=A},function(e,t,n){var r=n(15),i=n(14);e.exports=function(e){return"symbol"==typeof e||i(e)&&"[object Symbol]"==r(e)}},function(e,t,n){var r=n(9),i=n(22),A=n(20),o=Math.max,a=Math.min;e.exports=function(e,t,n){var s,u,c,l,h,d,p=0,f=!1,y=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function E(t){var n=s,r=u;return s=u=void 0,p=t,l=e.apply(r,n)}function m(e){return p=e,h=setTimeout(v,t),f?E(e):l}function B(e){var n=e-d;return void 0===d||n>=t||n<0||y&&e-p>=c}function v(){var e=i();if(B(e))return w(e);h=setTimeout(v,function(e){var n=t-(e-d);return y?a(n,c-(e-p)):n}(e))}function w(e){return h=void 0,g&&s?E(e):(s=u=void 0,l)}function k(){var e=i(),n=B(e);if(s=arguments,u=this,d=e,n){if(void 0===h)return m(d);if(y)return clearTimeout(h),h=setTimeout(v,t),E(d)}return void 0===h&&(h=setTimeout(v,t)),l}return t=A(t)||0,r(n)&&(f=!!n.leading,c=(y="maxWait"in n)?o(A(n.maxWait)||0,t):c,g="trailing"in n?!!n.trailing:g),k.cancel=function(){void 0!==h&&clearTimeout(h),p=0,s=d=u=h=void 0},k.flush=function(){return void 0===h?l:w(i())},k}},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(12))},function(e,t,n){var r=n(23),i=n(9),A=n(17),o=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,u=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(A(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var n=a.test(e);return n||s.test(e)?u(e.slice(2),n?2:8):o.test(e)?NaN:+e}},,function(e,t,n){var r=n(10);e.exports=function(){return r.Date.now()}},function(e,t,n){var r=n(24),i=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(i,""):e}},function(e,t){var n=/\s/;e.exports=function(e){for(var t=e.length;t--&&n.test(e.charAt(t)););return t}},function(e,t,n){var r=n(13),i=Object.prototype,A=i.hasOwnProperty,o=i.toString,a=r?r.toStringTag:void 0;e.exports=function(e){var t=A.call(e,a),n=e[a];try{e[a]=void 0;var r=!0}catch(e){}var i=o.call(e);return r&&(t?e[a]=n:delete e[a]),i}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},,,,,function(e,t){var n=Array.isArray;e.exports=n},,,,,function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},,,function(e,t,n){var r=n(621),i=n(624);e.exports=function(e,t){var n=i(e,t);return r(n)?n:void 0}},,,,,function(e,t,n){var r=n(18),i=n(9);e.exports=function(e,t,n){var A=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return i(n)&&(A="leading"in n?!!n.leading:A,o="trailing"in n?!!n.trailing:o),r(e,t,{leading:A,maxWait:t,trailing:o})}},function(e,t,n){var r=n(118),i=n(644),A=n(90);e.exports=function(e){return A(e)?r(e):i(e)}},function(e,t,n){var r=n(17);e.exports=function(e){if("string"==typeof e||r(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}},function(e,t,n){var r,i,A=n(36),o=n(37),a=0,s=0;e.exports=function(e,t,n){var u=t&&n||0,c=t||[],l=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:i;if(null==l||null==h){var d=A();null==l&&(l=r=[1|d[0],d[1],d[2],d[3],d[4],d[5]]),null==h&&(h=i=16383&(d[6]<<8|d[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),f=void 0!==e.nsecs?e.nsecs:s+1,y=p-a+(f-s)/1e4;if(y<0&&void 0===e.clockseq&&(h=h+1&16383),(y<0||p>a)&&void 0===e.nsecs&&(f=0),f>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=p,s=f,i=h;var g=(1e4*(268435455&(p+=122192928e5))+f)%4294967296;c[u++]=g>>>24&255,c[u++]=g>>>16&255,c[u++]=g>>>8&255,c[u++]=255&g;var E=p/4294967296*1e4&268435455;c[u++]=E>>>8&255,c[u++]=255&E,c[u++]=E>>>24&15|16,c[u++]=E>>>16&255,c[u++]=h>>>8|128,c[u++]=255&h;for(var m=0;m<6;++m)c[u+m]=l[m];return t||o(c)}},function(e,t,n){var r=n(36),i=n(37);e.exports=function(e,t,n){var A=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var a=0;a<16;++a)t[A+a]=o[a];return t||i(o)}},,,,,,,,,,,,,,function(e,t,n){var r=n(611),i=n(612),A=n(613),o=n(614),a=n(615);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=i,s.prototype.get=A,s.prototype.has=o,s.prototype.set=a,e.exports=s},function(e,t,n){var r=n(80);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},function(e,t,n){var r=n(40)(Object,"create");e.exports=r},function(e,t,n){var r=n(633);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t,n){var r=n(116),i=n(117);e.exports=function(e,t,n,A){var o=!n;n||(n={});for(var a=-1,s=t.length;++a<s;){var u=t[a],c=A?A(n[u],e[u],u,n,e):void 0;void 0===c&&(c=e[u]),o?i(n,u,c):r(n,u,c)}return n}},function(e,t,n){var r=n(655),i=n(81),A=n(656),o=n(657),a=n(658),s=n(15),u=n(115),c=u(r),l=u(i),h=u(A),d=u(o),p=u(a),f=s;(r&&"[object DataView]"!=f(new r(new ArrayBuffer(1)))||i&&"[object Map]"!=f(new i)||A&&"[object Promise]"!=f(A.resolve())||o&&"[object Set]"!=f(new o)||a&&"[object WeakMap]"!=f(new a))&&(f=function(e){var t=s(e),n="[object Object]"==t?e.constructor:void 0,r=n?u(n):"";if(r)switch(r){case c:return"[object DataView]";case l:return"[object Map]";case h:return"[object Promise]";case d:return"[object Set]";case p:return"[object WeakMap]"}return t}),e.exports=f},,,,,,function(e,t){!function(){try{return new MouseEvent("test")}catch(e){}var e=function(e,t){t=t||{bubbles:!1,cancelable:!1};var n=document.createEvent("MouseEvent");return n.initMouseEvent(e,t.bubbles,t.cancelable,window,0,t.screenX||0,t.screenY||0,t.clientX||0,t.clientY||0,t.ctrlKey||!1,t.altKey||!1,t.shiftKey||!1,t.metaKey||!1,t.button||0,t.relatedTarget||null),n};e.prototype=Event.prototype,window.MouseEvent=e}()},,,,,function(e,t,n){var r=n(63),i=n(616),A=n(617),o=n(618),a=n(619),s=n(620);function u(e){var t=this.__data__=new r(e);this.size=t.size}u.prototype.clear=i,u.prototype.delete=A,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var r=n(40)(n(10),"Map");e.exports=r},function(e,t,n){var r=n(625),i=n(632),A=n(634),o=n(635),a=n(636);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=i,s.prototype.get=A,s.prototype.has=o,s.prototype.set=a,e.exports=s},function(e,t,n){(function(e){var r=n(10),i=n(642),A=t&&!t.nodeType&&t,o=A&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===A?r.Buffer:void 0,s=(a?a.isBuffer:void 0)||i;e.exports=s}).call(this,n(84)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){var r=n(19),i=t&&!t.nodeType&&t,A=i&&"object"==typeof e&&e&&!e.nodeType&&e,o=A&&A.exports===i&&r.process,a=function(){try{var e=A&&A.require&&A.require("util").types;return e||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=a}).call(this,n(84)(e))},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t,n){var r=n(114),i=n(86);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},function(e,t,n){var r=n(118),i=n(647),A=n(90);e.exports=function(e){return A(e)?r(e,!0):i(e)}},function(e,t,n){var r=n(652),i=n(122),A=Object.prototype.propertyIsEnumerable,o=Object.getOwnPropertySymbols,a=o?function(e){return null==e?[]:(e=Object(e),r(o(e),(function(t){return A.call(e,t)})))}:i;e.exports=a},function(e,t,n){var r=n(128);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},function(e,t,n){var r=n(673),i=n(686),A=n(697),o=n(31),a=n(698);e.exports=function(e){return"function"==typeof e?e:null==e?A:"object"==typeof e?o(e)?i(e[0],e[1]):r(e):a(e)}},function(e,t,n){var r=n(96),i=n(47);e.exports=function(e,t){for(var n=0,A=(t=r(t,e)).length;null!=e&&n<A;)e=e[i(t[n++])];return n&&n==A?e:void 0}},function(e,t,n){var r=n(31),i=n(97),A=n(688),o=n(691);e.exports=function(e,t){return r(e)?e:i(e,t)?[e]:A(o(e))}},function(e,t,n){var r=n(31),i=n(17),A=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;e.exports=function(e,t){if(r(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!i(e))||(o.test(e)||!A.test(e)||null!=t&&e in Object(t))}},,,,,,,,,,,,,,,,,function(e,t,n){var r=n(15),i=n(9);e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var r=n(117),i=n(80),A=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var o=e[t];A.call(e,t)&&i(o,n)&&(void 0!==n||t in e)||r(e,t,n)}},function(e,t,n){var r=n(638);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},function(e,t,n){var r=n(640),i=n(119),A=n(31),o=n(83),a=n(85),s=n(120),u=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=A(e),c=!n&&i(e),l=!n&&!c&&o(e),h=!n&&!c&&!l&&s(e),d=n||c||l||h,p=d?r(e.length,String):[],f=p.length;for(var y in e)!t&&!u.call(e,y)||d&&("length"==y||l&&("offset"==y||"parent"==y)||h&&("buffer"==y||"byteLength"==y||"byteOffset"==y)||a(y,f))||p.push(y);return p}},function(e,t,n){var r=n(641),i=n(14),A=Object.prototype,o=A.hasOwnProperty,a=A.propertyIsEnumerable,s=r(function(){return arguments}())?r:function(e){return i(e)&&o.call(e,"callee")&&!a.call(e,"callee")};e.exports=s},function(e,t,n){var r=n(643),i=n(87),A=n(88),o=A&&A.isTypedArray,a=o?i(o):r;e.exports=a},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t){e.exports=function(){return[]}},function(e,t,n){var r=n(124),i=n(125),A=n(92),o=n(122),a=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,A(e)),e=i(e);return t}:o;e.exports=a},function(e,t){e.exports=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}},function(e,t,n){var r=n(121)(Object.getPrototypeOf,Object);e.exports=r},function(e,t,n){var r=n(127),i=n(92),A=n(46);e.exports=function(e){return r(e,A,i)}},function(e,t,n){var r=n(124),i=n(31);e.exports=function(e,t,n){var A=t(e);return i(e)?A:r(A,n(e))}},function(e,t,n){var r=n(10).Uint8Array;e.exports=r},function(e,t,n){var r=n(675),i=n(14);e.exports=function e(t,n,A,o,a){return t===n||(null==t||null==n||!i(t)&&!i(n)?t!=t&&n!=n:r(t,n,A,o,e,a))}},function(e,t,n){var r=n(676),i=n(679),A=n(680);e.exports=function(e,t,n,o,a,s){var u=1&n,c=e.length,l=t.length;if(c!=l&&!(u&&l>c))return!1;var h=s.get(e),d=s.get(t);if(h&&d)return h==t&&d==e;var p=-1,f=!0,y=2&n?new r:void 0;for(s.set(e,t),s.set(t,e);++p<c;){var g=e[p],E=t[p];if(o)var m=u?o(E,g,p,t,e,s):o(g,E,p,e,t,s);if(void 0!==m){if(m)continue;f=!1;break}if(y){if(!i(t,(function(e,t){if(!A(y,t)&&(g===e||a(g,e,n,o,s)))return y.push(t)}))){f=!1;break}}else if(g!==E&&!a(g,E,n,o,s)){f=!1;break}}return s.delete(e),s.delete(t),f}},function(e,t,n){var r=n(9);e.exports=function(e){return e==e&&!r(e)}},function(e,t){e.exports=function(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){!function(){var t=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],n="undefined"!=typeof window,r=n&&null!=window.mozInnerScreenX;function i(e,i,A){var o=e.ownerDocument,a=o.defaultView||o.parentWindow;if(!n)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var s=A&&A.debug||!1;if(s){var u=o.querySelector("#input-textarea-caret-position-mirror-div");u&&u.parentNode.removeChild(u)}var c=o.createElement("div");c.id="input-textarea-caret-position-mirror-div",o.body.appendChild(c);var l=c.style,h=a.getComputedStyle?a.getComputedStyle(e):e.currentStyle,d="INPUT"===e.nodeName;l.whiteSpace="pre-wrap",d||(l.wordWrap="break-word"),l.position="absolute",s||(l.visibility="hidden"),t.forEach((function(e){d&&"lineHeight"===e?l.lineHeight=h.height:l[e]=h[e]})),r?e.scrollHeight>parseInt(h.height)&&(l.overflowY="scroll"):l.overflow="hidden",c.textContent=e.value.substring(0,i),d&&(c.textContent=c.textContent.replace(/\s/g,"Â "));var p=o.createElement("span");p.textContent=e.value.substring(i)||".",c.appendChild(p);var f={top:p.offsetTop+parseInt(h.borderTopWidth),left:p.offsetLeft+parseInt(h.borderLeftWidth),height:parseInt(h.lineHeight)};return s?p.style.backgroundColor="#aaa":o.body.removeChild(c),f}void 0!==e.exports?e.exports=i:n&&(_window.getCaretCoordinates=i)}()},function(e,t){e.exports="\n#define MESHLINE_PATH_ROUND_CAP     2.\n#define MESHLINE_PATH_FLAT_CAP      3.\nattribute vec3 position;\nattribute vec2 previous;\nattribute vec2 next;\nattribute float side;\nattribute float width;\nattribute float counters;\nuniform mat4 projectionMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec2 resolution;\nuniform float lineWidth;\nuniform float opacity;\nvarying float vCounters;\nvarying float vPointType;\nvarying float vDistance;\nvarying float aaRange;\nvarying float totalWidth;\nvarying vec2 center;\nvarying vec2 finalPos;\nfloat when_eq(float x, float y) {\n  return 1.0 - abs(sign(x - y));\n}\nfloat when_neq(float x, float y) {\n  return abs(sign(x - y));\n}\nvoid main() {\n    float pixelsPerUnit = 0.5 * resolution.x * projectionMatrix[0][0];\n    vCounters = counters;\n    vPointType = abs(side);\n    float sideSgn = sign(side);\n    vec4 curPosition = modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    vec2 prevPos = (modelViewMatrix * vec4(previous, 0.0, 1.0)).xy;\n    vec2 nextPos = (modelViewMatrix * vec4(next, 0.0, 1.0)).xy;\n#ifdef IS_IE_11\n    aaRange = when_neq(width, 0.0) * when_eq(opacity, 1.0) * 1.0 / pixelsPerUnit;\n#else\n    aaRange = when_neq(width, 0.0) * 1.0 / pixelsPerUnit;\n#endif\n    \n    float minSize = when_neq(width, 0.0) * 0.5 / pixelsPerUnit;    \n   \n    totalWidth = lineWidth * width;\n    \n    float w = max(.5 * totalWidth, minSize) + aaRange;\n    \n    vDistance = w * sideSgn;\n    vec2 dir;\n    if (nextPos == curPosition.xy) {\n        dir = normalize(curPosition.xy - prevPos);\n    } else if (prevPos == curPosition.xy) {\n        dir = normalize(nextPos - curPosition.xy);\n    } else {\n#ifdef MITER\n        vec2 dir1 = normalize(curPosition.xy - prevPos);\n        vec2 dir2 = normalize(nextPos - curPosition.xy);\n        dir = normalize(dir1 + dir2);\n        vec2 perp = vec2(-dir1.y, dir1.x);\n        vec2 miter = vec2(-dir.y, dir.x);\n        w = clamp(w / dot(miter, perp), minSize + aaRange, 20. * w);\n#else\n        dir = normalize(curPosition.xy - prevPos);\n#endif\n    }\n    vec2 normal = vec2(-dir.y, dir.x);\n    normal *= w * sideSgn;\n    \n    if (vPointType == MESHLINE_PATH_ROUND_CAP) {\n        center = curPosition.xy;\n        curPosition.xy += normal;\n    } else  {\n        curPosition.xy += normal;\n        center = curPosition.xy;\n    }\n    \n    if (vCounters < 0.0 || vCounters > 1.0) {\n        normal = vec2(dir.x, dir.y);\n        normal *= sign(vCounters) * w;\n        curPosition.xy += normal;\n    }\n  \n    finalPos = curPosition.xy;\n    gl_Position = projectionMatrix * curPosition;\n}\n"},function(e,t){e.exports="#define MESHLINE_PATH_FLAT_CAP      3.0\nuniform vec3 color;\nuniform float opacity;\nvarying float vCounters;\nvarying float vDistance;\nvarying float aaRange;\nvarying float totalWidth;\nvarying vec2 center;\nvarying vec2 finalPos;\nvarying float vPointType;\nfloat when_eq(float x, float y) {\n  return 1.0 - abs(sign(x - y));\n}\nfloat getSmoothStep(float t, float d) {\n    return smoothstep(t - aaRange, t + aaRange, abs(d));\n}\nvoid main() {\n    float t = totalWidth / 2.0;\n    float d = vDistance;\n    float aa = 1.0;\n    if (vCounters < 0.0 || vCounters > 1.0) {\n        d = length(finalPos - center);\n        if (vPointType == MESHLINE_PATH_FLAT_CAP) {\n            t = aaRange;\n        }\n        if (d > t + aaRange) {\n            discard;\n        }\n        aa = 1.0 - getSmoothStep(t, d);       \n    }\n        \n#ifdef IS_IE_11\n    aa = (1.0 - when_eq(opacity, 1.0) * getSmoothStep(totalWidth / 2.0, vDistance)) * aa;\n#else\n    aa = (1.0 - getSmoothStep(totalWidth / 2.0, vDistance)) * aa;\n#endif\n    gl_FragColor = vec4(color, opacity * aa);\n}\n"},function(e,t,n){var r,i,A;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}
/*!
                                                                                                                                                                                                                                                                                                                                                                                * html2canvas 1.2.2 <https://html2canvas.hertzen.com>
                                                                                                                                                                                                                                                                                                                                                                                * Copyright (c) 2021 Niklas von Hertzen <https://hertzen.com>
                                                                                                                                                                                                                                                                                                                                                                                * Released under MIT License
                                                                                                                                                                                                                                                                                                                                                                                */A=function(){"use strict";
/*! *****************************************************************************
                                    Copyright (c) Microsoft Corporation.
                                      Permission to use, copy, modify, and/or distribute this software for any
                                    purpose with or without fee is hereby granted.
                                      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
                                    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
                                    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
                                    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
                                    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
                                    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
                                    PERFORMANCE OF THIS SOFTWARE.
                                    ***************************************************************************** */var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))((function(i,A){function o(e){try{s(r.next(e))}catch(e){A(e)}}function a(e){try{s(r.throw(e))}catch(e){A(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}s((r=r.apply(e,t||[])).next())}))}function i(e,t){var n,r,i,A,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return A={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(A[Symbol.iterator]=function(){return this}),A;function a(A){return function(a){return function(A){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&A[0]?r.return:A[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,A[1])).done)return i;switch(r=0,i&&(A=[2&A[0],i.value]),A[0]){case 0:case 1:i=A;break;case 4:return o.label++,{value:A[1],done:!1};case 5:o.label++,r=A[1],A=[0];continue;case 7:A=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==A[0]&&2!==A[0])){o=0;continue}if(3===A[0]&&(!i||A[1]>i[0]&&A[1]<i[3])){o.label=A[1];break}if(6===A[0]&&o.label<i[1]){o.label=i[1],i=A;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(A);break}i[2]&&o.ops.pop(),o.trys.pop();continue}A=t.call(e,o)}catch(e){A=[6,e],r=0}finally{n=i=0}if(5&A[0])throw A[1];return{value:A[0]?A[1]:void 0,done:!0}}([A,a])}}}function A(e,t,n){if(n||2===arguments.length)for(var r,i=0,A=t.length;i<A;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||t)}for(var a=function(){function e(e,t,n,r){this.left=e,this.top=t,this.width=n,this.height=r}return e.prototype.add=function(t,n,r,i){return new e(this.left+t,this.top+n,this.width+r,this.height+i)},e.fromClientRect=function(t,n){return new e(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height)},e.fromDOMRectList=function(t,n){var r=n[0];return r?new e(r.x+t.windowBounds.left,r.y+t.windowBounds.top,r.width,r.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e}(),s=function(e,t){return a.fromClientRect(e,t.getBoundingClientRect())},u=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var A=e.charCodeAt(n++);56320==(64512&A)?t.push(((1023&i)<<10)+(1023&A)+65536):(t.push(i),n--)}else t.push(i)}return t},c=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var r=[],i=-1,A="";++i<n;){var o=e[i];o<=65535?r.push(o):(o-=65536,r.push(55296+(o>>10),o%1024+56320)),(i+1===n||r.length>16384)&&(A+=String.fromCharCode.apply(String,r),r.length=0)}return A},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="undefined"==typeof Uint8Array?[]:new Uint8Array(256),d=0;d<l.length;d++)h[l.charCodeAt(d)]=d;var p,f=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},y=function(){function e(e,t,n,r,i,A){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=r,this.index=i,this.data=A}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>5])<<2)+(31&e),this.data[t];if(e<=65535)return t=((t=this.index[2048+(e-55296>>5)])<<2)+(31&e),this.data[t];if(e<this.highStart)return t=2080+(e>>11),t=this.index[t],t+=e>>5&63,t=((t=this.index[t])<<2)+(31&e),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),g=10,E=13,m=15,B=17,v=18,w=19,k=20,C=21,b=22,S=24,T=25,M=26,x=27,U=28,Q=30,L=32,F=33,R=34,H=35,_=37,D=38,O=39,I=40,P=42,N=[9001,65288],K=function(e){var t,n,r,i=function(e){var t,n,r,i,A,o=.75*e.length,a=e.length,s=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var u="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(o):new Array(o),c=Array.isArray(u)?u:new Uint8Array(u);for(t=0;t<a;t+=4)n=h[e.charCodeAt(t)],r=h[e.charCodeAt(t+1)],i=h[e.charCodeAt(t+2)],A=h[e.charCodeAt(t+3)],c[s++]=n<<2|r>>4,c[s++]=(15&r)<<4|i>>2,c[s++]=(3&i)<<6|63&A;return u}(e),A=Array.isArray(i)?function(e){for(var t=e.length,n=[],r=0;r<t;r+=4)n.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return n}(i):new Uint32Array(i),o=Array.isArray(i)?function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n.push(e[r+1]<<8|e[r]);return n}(i):new Uint16Array(i),a=f(o,12,A[4]/2),s=2===A[5]?f(o,(24+A[4])/2):(t=A,n=Math.ceil((24+A[4])/4),t.slice?t.slice(n,r):new Uint32Array(Array.prototype.slice.call(t,n,r)));return new y(A[0],A[1],A[2],A[3],a,s)}("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),V=[Q,36],G=[1,2,3,5],j=[g,8],Y=[x,M],W=G.concat(j),X=[D,O,I,R,H],J=[m,E],z=function(e,t,n,r){var i=r[n];if(Array.isArray(e)?-1!==e.indexOf(i):e===i)for(var A=n;A<=r.length;){if((s=r[++A])===t)return!0;if(s!==g)break}if(i===g)for(A=n;A>0;){var o=r[--A];if(Array.isArray(e)?-1!==e.indexOf(o):e===o)for(var a=n;a<=r.length;){var s;if((s=r[++a])===t)return!0;if(s!==g)break}if(o!==g)break}return!1},q=function(e,t){for(var n=e;n>=0;){var r=t[n];if(r!==g)return r;n--}return 0},Z=function(e,t,n,r,i){if(0===n[r])return"Ã";var A=r-1;if(Array.isArray(i)&&!0===i[A])return"Ã";var o=A-1,a=A+1,s=t[A],u=o>=0?t[o]:0,c=t[a];if(2===s&&3===c)return"Ã";if(-1!==G.indexOf(s))return"!";if(-1!==G.indexOf(c))return"Ã";if(-1!==j.indexOf(c))return"Ã";if(8===q(A,t))return"Ã·";if(11===K.get(e[A]))return"Ã";if((s===L||s===F)&&11===K.get(e[a]))return"Ã";if(7===s||7===c)return"Ã";if(9===s)return"Ã";if(-1===[g,E,m].indexOf(s)&&9===c)return"Ã";if(-1!==[B,v,w,S,U].indexOf(c))return"Ã";if(q(A,t)===b)return"Ã";if(z(23,b,A,t))return"Ã";if(z([B,v],C,A,t))return"Ã";if(z(12,12,A,t))return"Ã";if(s===g)return"Ã·";if(23===s||23===c)return"Ã";if(16===c||16===s)return"Ã·";if(-1!==[E,m,C].indexOf(c)||14===s)return"Ã";if(36===u&&-1!==J.indexOf(s))return"Ã";if(s===U&&36===c)return"Ã";if(c===k)return"Ã";if(-1!==V.indexOf(c)&&s===T||-1!==V.indexOf(s)&&c===T)return"Ã";if(s===x&&-1!==[_,L,F].indexOf(c)||-1!==[_,L,F].indexOf(s)&&c===M)return"Ã";if(-1!==V.indexOf(s)&&-1!==Y.indexOf(c)||-1!==Y.indexOf(s)&&-1!==V.indexOf(c))return"Ã";if(-1!==[x,M].indexOf(s)&&(c===T||-1!==[b,m].indexOf(c)&&t[a+1]===T)||-1!==[b,m].indexOf(s)&&c===T||s===T&&-1!==[T,U,S].indexOf(c))return"Ã";if(-1!==[T,U,S,B,v].indexOf(c))for(var l=A;l>=0;){if((h=t[l])===T)return"Ã";if(-1===[U,S].indexOf(h))break;l--}if(-1!==[x,M].indexOf(c))for(l=-1!==[B,v].indexOf(s)?o:A;l>=0;){var h;if((h=t[l])===T)return"Ã";if(-1===[U,S].indexOf(h))break;l--}if(D===s&&-1!==[D,O,R,H].indexOf(c)||-1!==[O,R].indexOf(s)&&-1!==[O,I].indexOf(c)||-1!==[I,H].indexOf(s)&&c===I)return"Ã";if(-1!==X.indexOf(s)&&-1!==[k,M].indexOf(c)||-1!==X.indexOf(c)&&s===x)return"Ã";if(-1!==V.indexOf(s)&&-1!==V.indexOf(c))return"Ã";if(s===S&&-1!==V.indexOf(c))return"Ã";if(-1!==V.concat(T).indexOf(s)&&c===b&&-1===N.indexOf(e[a])||-1!==V.concat(T).indexOf(c)&&s===v)return"Ã";if(41===s&&41===c){for(var d=n[A],p=1;d>0&&41===t[--d];)p++;if(p%2!=0)return"Ã"}return s===L&&c===F?"Ã":"Ã·"},$=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var n=function(e,t){void 0===t&&(t="strict");var n=[],r=[],i=[];return e.forEach((function(e,A){var o=K.get(e);if(o>50?(i.push(!0),o-=50):i.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return r.push(A),n.push(16);if(4===o||11===o){if(0===A)return r.push(A),n.push(Q);var a=n[A-1];return-1===W.indexOf(a)?(r.push(r[A-1]),n.push(a)):(r.push(A),n.push(Q))}return r.push(A),31===o?n.push("strict"===t?C:_):o===P||29===o?n.push(Q):43===o?e>=131072&&e<=196605||e>=196608&&e<=262141?n.push(_):n.push(Q):void n.push(o)})),[r,n,i]}(e,t.lineBreak),r=n[0],i=n[1],A=n[2];return"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(i=i.map((function(e){return-1!==[T,Q,P].indexOf(e)?_:e}))),[r,i,"keep-all"===t.wordBreak?A.map((function(t,n){return t&&e[n]>=19968&&e[n]<=40959})):void 0]},ee=function(){function e(e,t,n,r){this.codePoints=e,this.required="!"===t,this.start=n,this.end=r}return e.prototype.slice=function(){return c.apply(void 0,this.codePoints.slice(this.start,this.end))},e}();!function(e){e[e.STRING_TOKEN=0]="STRING_TOKEN",e[e.BAD_STRING_TOKEN=1]="BAD_STRING_TOKEN",e[e.LEFT_PARENTHESIS_TOKEN=2]="LEFT_PARENTHESIS_TOKEN",e[e.RIGHT_PARENTHESIS_TOKEN=3]="RIGHT_PARENTHESIS_TOKEN",e[e.COMMA_TOKEN=4]="COMMA_TOKEN",e[e.HASH_TOKEN=5]="HASH_TOKEN",e[e.DELIM_TOKEN=6]="DELIM_TOKEN",e[e.AT_KEYWORD_TOKEN=7]="AT_KEYWORD_TOKEN",e[e.PREFIX_MATCH_TOKEN=8]="PREFIX_MATCH_TOKEN",e[e.DASH_MATCH_TOKEN=9]="DASH_MATCH_TOKEN",e[e.INCLUDE_MATCH_TOKEN=10]="INCLUDE_MATCH_TOKEN",e[e.LEFT_CURLY_BRACKET_TOKEN=11]="LEFT_CURLY_BRACKET_TOKEN",e[e.RIGHT_CURLY_BRACKET_TOKEN=12]="RIGHT_CURLY_BRACKET_TOKEN",e[e.SUFFIX_MATCH_TOKEN=13]="SUFFIX_MATCH_TOKEN",e[e.SUBSTRING_MATCH_TOKEN=14]="SUBSTRING_MATCH_TOKEN",e[e.DIMENSION_TOKEN=15]="DIMENSION_TOKEN",e[e.PERCENTAGE_TOKEN=16]="PERCENTAGE_TOKEN",e[e.NUMBER_TOKEN=17]="NUMBER_TOKEN",e[e.FUNCTION=18]="FUNCTION",e[e.FUNCTION_TOKEN=19]="FUNCTION_TOKEN",e[e.IDENT_TOKEN=20]="IDENT_TOKEN",e[e.COLUMN_TOKEN=21]="COLUMN_TOKEN",e[e.URL_TOKEN=22]="URL_TOKEN",e[e.BAD_URL_TOKEN=23]="BAD_URL_TOKEN",e[e.CDC_TOKEN=24]="CDC_TOKEN",e[e.CDO_TOKEN=25]="CDO_TOKEN",e[e.COLON_TOKEN=26]="COLON_TOKEN",e[e.SEMICOLON_TOKEN=27]="SEMICOLON_TOKEN",e[e.LEFT_SQUARE_BRACKET_TOKEN=28]="LEFT_SQUARE_BRACKET_TOKEN",e[e.RIGHT_SQUARE_BRACKET_TOKEN=29]="RIGHT_SQUARE_BRACKET_TOKEN",e[e.UNICODE_RANGE_TOKEN=30]="UNICODE_RANGE_TOKEN",e[e.WHITESPACE_TOKEN=31]="WHITESPACE_TOKEN",e[e.EOF_TOKEN=32]="EOF_TOKEN"}(p||(p={}));var te=function(e){return e>=48&&e<=57},ne=function(e){return te(e)||e>=65&&e<=70||e>=97&&e<=102},re=function(e){return 10===e||9===e||32===e},ie=function(e){return function(e){return function(e){return e>=97&&e<=122}(e)||function(e){return e>=65&&e<=90}(e)}(e)||function(e){return e>=128}(e)||95===e},Ae=function(e){return ie(e)||te(e)||45===e},oe=function(e){return e>=0&&e<=8||11===e||e>=14&&e<=31||127===e},ae=function(e,t){return 92===e&&10!==t},se=function(e,t,n){return 45===e?ie(t)||ae(t,n):!!ie(e)||!(92!==e||!ae(e,t))},ue=function(e,t,n){return 43===e||45===e?!!te(t)||46===t&&te(n):te(46===e?t:e)},ce=function(e){var t=0,n=1;43!==e[t]&&45!==e[t]||(45===e[t]&&(n=-1),t++);for(var r=[];te(e[t]);)r.push(e[t++]);var i=r.length?parseInt(c.apply(void 0,r),10):0;46===e[t]&&t++;for(var A=[];te(e[t]);)A.push(e[t++]);var o=A.length,a=o?parseInt(c.apply(void 0,A),10):0;69!==e[t]&&101!==e[t]||t++;var s=1;43!==e[t]&&45!==e[t]||(45===e[t]&&(s=-1),t++);for(var u=[];te(e[t]);)u.push(e[t++]);var l=u.length?parseInt(c.apply(void 0,u),10):0;return n*(i+a*Math.pow(10,-o))*Math.pow(10,s*l)},le={type:p.LEFT_PARENTHESIS_TOKEN},he={type:p.RIGHT_PARENTHESIS_TOKEN},de={type:p.COMMA_TOKEN},pe={type:p.SUFFIX_MATCH_TOKEN},fe={type:p.PREFIX_MATCH_TOKEN},ye={type:p.COLUMN_TOKEN},ge={type:p.DASH_MATCH_TOKEN},Ee={type:p.INCLUDE_MATCH_TOKEN},me={type:p.LEFT_CURLY_BRACKET_TOKEN},Be={type:p.RIGHT_CURLY_BRACKET_TOKEN},ve={type:p.SUBSTRING_MATCH_TOKEN},we={type:p.BAD_URL_TOKEN},ke={type:p.BAD_STRING_TOKEN},Ce={type:p.CDO_TOKEN},be={type:p.CDC_TOKEN},Se={type:p.COLON_TOKEN},Te={type:p.SEMICOLON_TOKEN},Me={type:p.LEFT_SQUARE_BRACKET_TOKEN},xe={type:p.RIGHT_SQUARE_BRACKET_TOKEN},Ue={type:p.WHITESPACE_TOKEN},Qe={type:p.EOF_TOKEN},Le=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(u(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==Qe;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case 34:return this.consumeStringToken(34);case 35:var t=this.peekCodePoint(0),n=this.peekCodePoint(1),r=this.peekCodePoint(2);if(Ae(t)||ae(n,r)){var i=se(t,n,r)?2:1,A=this.consumeName();return{type:p.HASH_TOKEN,value:A,flags:i}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),pe;break;case 39:return this.consumeStringToken(39);case 40:return le;case 41:return he;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),ve;break;case 43:if(ue(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 44:return de;case 45:var o=e,a=this.peekCodePoint(0),s=this.peekCodePoint(1);if(ue(o,a,s))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(se(o,a,s))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(45===a&&62===s)return this.consumeCodePoint(),this.consumeCodePoint(),be;break;case 46:if(ue(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var u=this.consumeCodePoint();if(42===u&&47===(u=this.consumeCodePoint()))return this.consumeToken();if(-1===u)return this.consumeToken()}break;case 58:return Se;case 59:return Te;case 60:if(33===this.peekCodePoint(0)&&45===this.peekCodePoint(1)&&45===this.peekCodePoint(2))return this.consumeCodePoint(),this.consumeCodePoint(),Ce;break;case 64:var l=this.peekCodePoint(0),h=this.peekCodePoint(1),d=this.peekCodePoint(2);if(se(l,h,d))return A=this.consumeName(),{type:p.AT_KEYWORD_TOKEN,value:A};break;case 91:return Me;case 92:if(ae(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case 93:return xe;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),fe;break;case 123:return me;case 125:return Be;case 117:case 85:var f=this.peekCodePoint(0),y=this.peekCodePoint(1);return 43!==f||!ne(y)&&63!==y||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),ge;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),ye;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ee;break;case-1:return Qe}return re(e)?(this.consumeWhiteSpace(),Ue):te(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):ie(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:p.DELIM_TOKEN,value:c(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return void 0===e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();ne(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var n=!1;63===t&&e.length<6;)e.push(t),t=this.consumeCodePoint(),n=!0;if(n){var r=parseInt(c.apply(void 0,e.map((function(e){return 63===e?48:e}))),16),i=parseInt(c.apply(void 0,e.map((function(e){return 63===e?70:e}))),16);return{type:p.UNICODE_RANGE_TOKEN,start:r,end:i}}var A=parseInt(c.apply(void 0,e),16);if(45===this.peekCodePoint(0)&&ne(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var o=[];ne(t)&&o.length<6;)o.push(t),t=this.consumeCodePoint();return i=parseInt(c.apply(void 0,o),16),{type:p.UNICODE_RANGE_TOKEN,start:A,end:i}}return{type:p.UNICODE_RANGE_TOKEN,start:A,end:A}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:p.FUNCTION_TOKEN,value:e}):{type:p.IDENT_TOKEN,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),-1===this.peekCodePoint(0))return{type:p.URL_TOKEN,value:""};var t=this.peekCodePoint(0);if(39===t||34===t){var n=this.consumeStringToken(this.consumeCodePoint());return n.type===p.STRING_TOKEN&&(this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:p.URL_TOKEN,value:n.value}):(this.consumeBadUrlRemnants(),we)}for(;;){var r=this.consumeCodePoint();if(-1===r||41===r)return{type:p.URL_TOKEN,value:c.apply(void 0,e)};if(re(r))return this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:p.URL_TOKEN,value:c.apply(void 0,e)}):(this.consumeBadUrlRemnants(),we);if(34===r||39===r||40===r||oe(r))return this.consumeBadUrlRemnants(),we;if(92===r){if(!ae(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),we;e.push(this.consumeEscapedCodePoint())}else e.push(r)}},e.prototype.consumeWhiteSpace=function(){for(;re(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(41===e||-1===e)return;ae(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t="";e>0;){var n=Math.min(6e4,e);t+=c.apply(void 0,this._value.splice(0,n)),e-=n}return this._value.shift(),t},e.prototype.consumeStringToken=function(e){for(var t="",n=0;;){var r=this._value[n];if(-1===r||void 0===r||r===e)return t+=this.consumeStringSlice(n),{type:p.STRING_TOKEN,value:t};if(10===r)return this._value.splice(0,n),ke;if(92===r){var i=this._value[n+1];-1!==i&&void 0!==i&&(10===i?(t+=this.consumeStringSlice(n),n=-1,this._value.shift()):ae(r,i)&&(t+=this.consumeStringSlice(n),t+=c(this.consumeEscapedCodePoint()),n=-1))}n++}},e.prototype.consumeNumber=function(){var e=[],t=4,n=this.peekCodePoint(0);for(43!==n&&45!==n||e.push(this.consumeCodePoint());te(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(46===n&&te(r))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;te(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),r=this.peekCodePoint(1);var i=this.peekCodePoint(2);if((69===n||101===n)&&((43===r||45===r)&&te(i)||te(r)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;te(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[ce(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],n=e[1],r=this.peekCodePoint(0),i=this.peekCodePoint(1),A=this.peekCodePoint(2);if(se(r,i,A)){var o=this.consumeName();return{type:p.DIMENSION_TOKEN,number:t,flags:n,unit:o}}return 37===r?(this.consumeCodePoint(),{type:p.PERCENTAGE_TOKEN,number:t,flags:n}):{type:p.NUMBER_TOKEN,number:t,flags:n}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(ne(e)){for(var t=c(e);ne(this.peekCodePoint(0))&&t.length<6;)t+=c(this.consumeCodePoint());re(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(t,16);return 0===n||function(e){return e>=55296&&e<=57343}(n)||n>1114111?65533:n}return-1===e?65533:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(Ae(t))e+=c(t);else{if(!ae(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=c(this.consumeEscapedCodePoint())}}},e}(),Fe=function(){function e(e){this._tokens=e}return e.create=function(t){var n=new Le;return n.write(t),new e(n.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();e.type===p.WHITESPACE_TOKEN;)e=this.consumeToken();if(e.type===p.EOF_TOKEN)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(e.type===p.WHITESPACE_TOKEN);if(e.type===p.EOF_TOKEN)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(t.type===p.EOF_TOKEN)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case p.LEFT_CURLY_BRACKET_TOKEN:case p.LEFT_SQUARE_BRACKET_TOKEN:case p.LEFT_PARENTHESIS_TOKEN:return this.consumeSimpleBlock(e.type);case p.FUNCTION_TOKEN:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},n=this.consumeToken();;){if(n.type===p.EOF_TOKEN||Ke(n,e))return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue()),n=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:p.FUNCTION};;){var n=this.consumeToken();if(n.type===p.EOF_TOKEN||n.type===p.RIGHT_PARENTHESIS_TOKEN)return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return void 0===e?Qe:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),Re=function(e){return e.type===p.DIMENSION_TOKEN},He=function(e){return e.type===p.NUMBER_TOKEN},_e=function(e){return e.type===p.IDENT_TOKEN},De=function(e){return e.type===p.STRING_TOKEN},Oe=function(e,t){return _e(e)&&e.value===t},Ie=function(e){return e.type!==p.WHITESPACE_TOKEN},Pe=function(e){return e.type!==p.WHITESPACE_TOKEN&&e.type!==p.COMMA_TOKEN},Ne=function(e){var t=[],n=[];return e.forEach((function(e){if(e.type===p.COMMA_TOKEN){if(0===n.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(n),void(n=[])}e.type!==p.WHITESPACE_TOKEN&&n.push(e)})),n.length&&t.push(n),t},Ke=function(e,t){return t===p.LEFT_CURLY_BRACKET_TOKEN&&e.type===p.RIGHT_CURLY_BRACKET_TOKEN||t===p.LEFT_SQUARE_BRACKET_TOKEN&&e.type===p.RIGHT_SQUARE_BRACKET_TOKEN||t===p.LEFT_PARENTHESIS_TOKEN&&e.type===p.RIGHT_PARENTHESIS_TOKEN},Ve=function(e){return e.type===p.NUMBER_TOKEN||e.type===p.DIMENSION_TOKEN},Ge=function(e){return e.type===p.PERCENTAGE_TOKEN||Ve(e)},je=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},Ye={type:p.NUMBER_TOKEN,number:0,flags:4},We={type:p.PERCENTAGE_TOKEN,number:50,flags:4},Xe={type:p.PERCENTAGE_TOKEN,number:100,flags:4},Je=function(e,t,n){var r=e[0],i=e[1];return[ze(r,t),ze(void 0!==i?i:r,n)]},ze=function(e,t){if(e.type===p.PERCENTAGE_TOKEN)return e.number/100*t;if(Re(e))switch(e.unit){case"rem":case"em":return 16*e.number;case"px":default:return e.number}return e.number},qe=function(e,t){if(t.type===p.DIMENSION_TOKEN)switch(t.unit){case"deg":return Math.PI*t.number/180;case"grad":return Math.PI/200*t.number;case"rad":return t.number;case"turn":return 2*Math.PI*t.number}throw new Error("Unsupported angle type")},Ze=function(e){return e.type===p.DIMENSION_TOKEN&&("deg"===e.unit||"grad"===e.unit||"rad"===e.unit||"turn"===e.unit)},$e=function(e){switch(e.filter(_e).map((function(e){return e.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Ye,Ye];case"to top":case"bottom":return et(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Ye,Xe];case"to right":case"left":return et(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Xe,Xe];case"to bottom":case"top":return et(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Xe,Ye];case"to left":case"right":return et(270)}return 0},et=function(e){return Math.PI*e/180},tt=function(e,t){if(t.type===p.FUNCTION){var n=lt[t.name];if(void 0===n)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return n(e,t.values)}if(t.type===p.HASH_TOKEN){if(3===t.value.length){var r=t.value.substring(0,1),i=t.value.substring(1,2),A=t.value.substring(2,3);return it(parseInt(r+r,16),parseInt(i+i,16),parseInt(A+A,16),1)}if(4===t.value.length){r=t.value.substring(0,1),i=t.value.substring(1,2),A=t.value.substring(2,3);var o=t.value.substring(3,4);return it(parseInt(r+r,16),parseInt(i+i,16),parseInt(A+A,16),parseInt(o+o,16)/255)}if(6===t.value.length)return r=t.value.substring(0,2),i=t.value.substring(2,4),A=t.value.substring(4,6),it(parseInt(r,16),parseInt(i,16),parseInt(A,16),1);if(8===t.value.length)return r=t.value.substring(0,2),i=t.value.substring(2,4),A=t.value.substring(4,6),o=t.value.substring(6,8),it(parseInt(r,16),parseInt(i,16),parseInt(A,16),parseInt(o,16)/255)}if(t.type===p.IDENT_TOKEN){var a=dt[t.value.toUpperCase()];if(void 0!==a)return a}return dt.TRANSPARENT},nt=function(e){return 0==(255&e)},rt=function(e){var t=255&e,n=255&e>>8,r=255&e>>16,i=255&e>>24;return t<255?"rgba("+i+","+r+","+n+","+t/255+")":"rgb("+i+","+r+","+n+")"},it=function(e,t,n,r){return(e<<24|t<<16|n<<8|Math.round(255*r)<<0)>>>0},At=function(e,t){if(e.type===p.NUMBER_TOKEN)return e.number;if(e.type===p.PERCENTAGE_TOKEN){var n=3===t?1:255;return 3===t?e.number/100*n:Math.round(e.number/100*n)}return 0},ot=function(e,t){var n=t.filter(Pe);if(3===n.length){var r=n.map(At),i=r[0],A=r[1],o=r[2];return it(i,A,o,1)}if(4===n.length){var a=n.map(At),s=(i=a[0],A=a[1],o=a[2],a[3]);return it(i,A,o,s)}return 0};function at(e,t,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(t-e)*n*6+e:n<.5?t:n<2/3?6*(t-e)*(2/3-n)+e:e}var st,ut,ct=function(e,t){var n=t.filter(Pe),r=n[0],i=n[1],A=n[2],o=n[3],a=(r.type===p.NUMBER_TOKEN?et(r.number):qe(e,r))/(2*Math.PI),s=Ge(i)?i.number/100:0,u=Ge(A)?A.number/100:0,c=void 0!==o&&Ge(o)?ze(o,1):1;if(0===s)return it(255*u,255*u,255*u,1);var l=u<=.5?u*(s+1):u+s-u*s,h=2*u-l,d=at(h,l,a+1/3),f=at(h,l,a),y=at(h,l,a-1/3);return it(255*d,255*f,255*y,c)},lt={hsl:ct,hsla:ct,rgb:ot,rgba:ot},ht=function(e,t){return tt(e,Fe.create(t).parseComponentValue())},dt={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199};!function(e){e[e.VALUE=0]="VALUE",e[e.LIST=1]="LIST",e[e.IDENT_VALUE=2]="IDENT_VALUE",e[e.TYPE_VALUE=3]="TYPE_VALUE",e[e.TOKEN_VALUE=4]="TOKEN_VALUE"}(st||(st={})),function(e){e[e.BORDER_BOX=0]="BORDER_BOX",e[e.PADDING_BOX=1]="PADDING_BOX",e[e.CONTENT_BOX=2]="CONTENT_BOX"}(ut||(ut={}));var pt,ft,yt,gt={name:"background-clip",initialValue:"border-box",prefix:!1,type:st.LIST,parse:function(e,t){return t.map((function(e){if(_e(e))switch(e.value){case"padding-box":return ut.PADDING_BOX;case"content-box":return ut.CONTENT_BOX}return ut.BORDER_BOX}))}},Et={name:"background-color",initialValue:"transparent",prefix:!1,type:st.TYPE_VALUE,format:"color"},mt=function(e,t){var n=tt(e,t[0]),r=t[1];return r&&Ge(r)?{color:n,stop:r}:{color:n,stop:null}},Bt=function(e,t){var n=e[0],r=e[e.length-1];null===n.stop&&(n.stop=Ye),null===r.stop&&(r.stop=Xe);for(var i=[],A=0,o=0;o<e.length;o++){var a=e[o].stop;if(null!==a){var s=ze(a,t);s>A?i.push(s):i.push(A),A=s}else i.push(null)}var u=null;for(o=0;o<i.length;o++){var c=i[o];if(null===c)null===u&&(u=o);else if(null!==u){for(var l=o-u,h=(c-i[u-1])/(l+1),d=1;d<=l;d++)i[u+d-1]=h*d;u=null}}return e.map((function(e,n){return{color:e.color,stop:Math.max(Math.min(1,i[n]/t),0)}}))},vt=function(e,t,n){var r="number"==typeof e?e:function(e,t,n){var r=t/2,i=n/2,A=ze(e[0],t)-r,o=i-ze(e[1],n);return(Math.atan2(o,A)+2*Math.PI)%(2*Math.PI)}(e,t,n),i=Math.abs(t*Math.sin(r))+Math.abs(n*Math.cos(r)),A=t/2,o=n/2,a=i/2,s=Math.sin(r-Math.PI/2)*a,u=Math.cos(r-Math.PI/2)*a;return[i,A-u,A+u,o-s,o+s]},wt=function(e,t){return Math.sqrt(e*e+t*t)},kt=function(e,t,n,r,i){return[[0,0],[0,t],[e,0],[e,t]].reduce((function(e,t){var A=t[0],o=t[1],a=wt(n-A,r-o);return(i?a<e.optimumDistance:a>e.optimumDistance)?{optimumCorner:t,optimumDistance:a}:e}),{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},Ct=function(e,t){var n=et(180),r=[];return Ne(t).forEach((function(t,i){if(0===i){var A=t[0];if(A.type===p.IDENT_TOKEN&&-1!==["top","left","right","bottom"].indexOf(A.value))return void(n=$e(t));if(Ze(A))return void(n=(qe(e,A)+et(270))%et(360))}var o=mt(e,t);r.push(o)})),{angle:n,stops:r,type:pt.LINEAR_GRADIENT}},bt=function(e,t){var n=ft.CIRCLE,r=yt.FARTHEST_CORNER,i=[],A=[];return Ne(t).forEach((function(t,o){var a=!0;if(0===o?a=t.reduce((function(e,t){if(_e(t))switch(t.value){case"center":return A.push(We),!1;case"top":case"left":return A.push(Ye),!1;case"right":case"bottom":return A.push(Xe),!1}else if(Ge(t)||Ve(t))return A.push(t),!1;return e}),a):1===o&&(a=t.reduce((function(e,t){if(_e(t))switch(t.value){case"circle":return n=ft.CIRCLE,!1;case"ellipse":return n=ft.ELLIPSE,!1;case"contain":case"closest-side":return r=yt.CLOSEST_SIDE,!1;case"farthest-side":return r=yt.FARTHEST_SIDE,!1;case"closest-corner":return r=yt.CLOSEST_CORNER,!1;case"cover":case"farthest-corner":return r=yt.FARTHEST_CORNER,!1}else if(Ve(t)||Ge(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e}),a)),a){var s=mt(e,t);i.push(s)}})),{size:r,shape:n,stops:i,position:A,type:pt.RADIAL_GRADIENT}};!function(e){e[e.URL=0]="URL",e[e.LINEAR_GRADIENT=1]="LINEAR_GRADIENT",e[e.RADIAL_GRADIENT=2]="RADIAL_GRADIENT"}(pt||(pt={})),function(e){e[e.CIRCLE=0]="CIRCLE",e[e.ELLIPSE=1]="ELLIPSE"}(ft||(ft={})),function(e){e[e.CLOSEST_SIDE=0]="CLOSEST_SIDE",e[e.FARTHEST_SIDE=1]="FARTHEST_SIDE",e[e.CLOSEST_CORNER=2]="CLOSEST_CORNER",e[e.FARTHEST_CORNER=3]="FARTHEST_CORNER"}(yt||(yt={}));var St,Tt=function(e,t){if(t.type===p.URL_TOKEN){var n={url:t.value,type:pt.URL};return e.cache.addImage(t.value),n}if(t.type===p.FUNCTION){var r=Mt[t.name];if(void 0===r)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return r(e,t.values)}throw new Error("Unsupported image type "+t.type)},Mt={"linear-gradient":function(e,t){var n=et(180),r=[];return Ne(t).forEach((function(t,i){if(0===i){var A=t[0];if(A.type===p.IDENT_TOKEN&&"to"===A.value)return void(n=$e(t));if(Ze(A))return void(n=qe(e,A))}var o=mt(e,t);r.push(o)})),{angle:n,stops:r,type:pt.LINEAR_GRADIENT}},"-moz-linear-gradient":Ct,"-ms-linear-gradient":Ct,"-o-linear-gradient":Ct,"-webkit-linear-gradient":Ct,"radial-gradient":function(e,t){var n=ft.CIRCLE,r=yt.FARTHEST_CORNER,i=[],A=[];return Ne(t).forEach((function(t,o){var a=!0;if(0===o){var s=!1;a=t.reduce((function(e,t){if(s)if(_e(t))switch(t.value){case"center":return A.push(We),e;case"top":case"left":return A.push(Ye),e;case"right":case"bottom":return A.push(Xe),e}else(Ge(t)||Ve(t))&&A.push(t);else if(_e(t))switch(t.value){case"circle":return n=ft.CIRCLE,!1;case"ellipse":return n=ft.ELLIPSE,!1;case"at":return s=!0,!1;case"closest-side":return r=yt.CLOSEST_SIDE,!1;case"cover":case"farthest-side":return r=yt.FARTHEST_SIDE,!1;case"contain":case"closest-corner":return r=yt.CLOSEST_CORNER,!1;case"farthest-corner":return r=yt.FARTHEST_CORNER,!1}else if(Ve(t)||Ge(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e}),a)}if(a){var u=mt(e,t);i.push(u)}})),{size:r,shape:n,stops:i,position:A,type:pt.RADIAL_GRADIENT}},"-moz-radial-gradient":bt,"-ms-radial-gradient":bt,"-o-radial-gradient":bt,"-webkit-radial-gradient":bt,"-webkit-gradient":function(e,t){var n=et(180),r=[],i=pt.LINEAR_GRADIENT,A=ft.CIRCLE,o=yt.FARTHEST_CORNER;return Ne(t).forEach((function(t,n){var A=t[0];if(0===n){if(_e(A)&&"linear"===A.value)return void(i=pt.LINEAR_GRADIENT);if(_e(A)&&"radial"===A.value)return void(i=pt.RADIAL_GRADIENT)}if(A.type===p.FUNCTION)if("from"===A.name){var o=tt(e,A.values[0]);r.push({stop:Ye,color:o})}else if("to"===A.name)o=tt(e,A.values[0]),r.push({stop:Xe,color:o});else if("color-stop"===A.name){var a=A.values.filter(Pe);if(2===a.length){o=tt(e,a[1]);var s=a[0];He(s)&&r.push({stop:{type:p.PERCENTAGE_TOKEN,number:100*s.number,flags:s.flags},color:o})}}})),i===pt.LINEAR_GRADIENT?{angle:(n+et(180))%et(360),stops:r,type:i}:{size:o,shape:A,stops:r,position:[],type:i}}},xt={name:"background-image",initialValue:"none",type:st.LIST,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return n.type===p.IDENT_TOKEN&&"none"===n.value?[]:t.filter((function(e){return Pe(e)&&function(e){return!(e.type===p.IDENT_TOKEN&&"none"===e.value||e.type===p.FUNCTION&&!Mt[e.name])}(e)})).map((function(t){return Tt(e,t)}))}},Ut={name:"background-origin",initialValue:"border-box",prefix:!1,type:st.LIST,parse:function(e,t){return t.map((function(e){if(_e(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Qt={name:"background-position",initialValue:"0% 0%",type:st.LIST,prefix:!1,parse:function(e,t){return Ne(t).map((function(e){return e.filter(Ge)})).map(je)}};!function(e){e[e.REPEAT=0]="REPEAT",e[e.NO_REPEAT=1]="NO_REPEAT",e[e.REPEAT_X=2]="REPEAT_X",e[e.REPEAT_Y=3]="REPEAT_Y"}(St||(St={}));var Lt,Ft={name:"background-repeat",initialValue:"repeat",prefix:!1,type:st.LIST,parse:function(e,t){return Ne(t).map((function(e){return e.filter(_e).map((function(e){return e.value})).join(" ")})).map(Rt)}},Rt=function(e){switch(e){case"no-repeat":return St.NO_REPEAT;case"repeat-x":case"repeat no-repeat":return St.REPEAT_X;case"repeat-y":case"no-repeat repeat":return St.REPEAT_Y;case"repeat":default:return St.REPEAT}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(Lt||(Lt={}));var Ht,_t={name:"background-size",initialValue:"0",prefix:!1,type:st.LIST,parse:function(e,t){return Ne(t).map((function(e){return e.filter(Dt)}))}},Dt=function(e){return _e(e)||Ge(e)},Ot=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:st.TYPE_VALUE,format:"color"}},It=Ot("top"),Pt=Ot("right"),Nt=Ot("bottom"),Kt=Ot("left"),Vt=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:st.LIST,parse:function(e,t){return je(t.filter(Ge))}}},Gt=Vt("top-left"),jt=Vt("top-right"),Yt=Vt("bottom-right"),Wt=Vt("bottom-left");!function(e){e[e.NONE=0]="NONE",e[e.SOLID=1]="SOLID",e[e.DASHED=2]="DASHED",e[e.DOTTED=3]="DOTTED",e[e.DOUBLE=4]="DOUBLE"}(Ht||(Ht={}));var Xt,Jt=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:st.IDENT_VALUE,parse:function(e,t){switch(t){case"none":return Ht.NONE;case"dashed":return Ht.DASHED;case"dotted":return Ht.DOTTED;case"double":return Ht.DOUBLE}return Ht.SOLID}}},zt=Jt("top"),qt=Jt("right"),Zt=Jt("bottom"),$t=Jt("left"),en=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:st.VALUE,prefix:!1,parse:function(e,t){return Re(t)?t.number:0}}},tn=en("top"),nn=en("right"),rn=en("bottom"),An=en("left"),on={name:"color",initialValue:"transparent",prefix:!1,type:st.TYPE_VALUE,format:"color"},an={name:"display",initialValue:"inline-block",prefix:!1,type:st.LIST,parse:function(e,t){return t.filter(_e).reduce((function(e,t){return e|sn(t.value)}),0)}},sn=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0};!function(e){e[e.NONE=0]="NONE",e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.INLINE_START=3]="INLINE_START",e[e.INLINE_END=4]="INLINE_END"}(Xt||(Xt={}));var un,cn={name:"float",initialValue:"none",prefix:!1,type:st.IDENT_VALUE,parse:function(e,t){switch(t){case"left":return Xt.LEFT;case"right":return Xt.RIGHT;case"inline-start":return Xt.INLINE_START;case"inline-end":return Xt.INLINE_END}return Xt.NONE}},ln={name:"letter-spacing",initialValue:"0",prefix:!1,type:st.VALUE,parse:function(e,t){return t.type===p.IDENT_TOKEN&&"normal"===t.value?0:t.type===p.NUMBER_TOKEN||t.type===p.DIMENSION_TOKEN?t.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(un||(un={}));var hn,dn={name:"line-break",initialValue:"normal",prefix:!1,type:st.IDENT_VALUE,parse:function(e,t){switch(t){case"strict":return un.STRICT;case"normal":default:return un.NORMAL}}},pn={name:"line-height",initialValue:"normal",prefix:!1,type:st.TOKEN_VALUE},fn=function(e,t){return _e(e)&&"normal"===e.value?1.2*t:e.type===p.NUMBER_TOKEN?t*e.number:Ge(e)?ze(e,t):t},yn={name:"list-style-image",initialValue:"none",type:st.VALUE,prefix:!1,parse:function(e,t){return t.type===p.IDENT_TOKEN&&"none"===t.value?null:Tt(e,t)}};!function(e){e[e.INSIDE=0]="INSIDE",e[e.OUTSIDE=1]="OUTSIDE"}(hn||(hn={}));var gn,En={name:"list-style-position",initialValue:"outside",prefix:!1,type:st.IDENT_VALUE,parse:function(e,t){switch(t){case"inside":return hn.INSIDE;case"outside":default:return hn.OUTSIDE}}};!function(e){e[e.NONE=-1]="NONE",e[e.DISC=0]="DISC",e[e.CIRCLE=1]="CIRCLE",e[e.SQUARE=2]="SQUARE",e[e.DECIMAL=3]="DECIMAL",e[e.CJK_DECIMAL=4]="CJK_DECIMAL",e[e.DECIMAL_LEADING_ZERO=5]="DECIMAL_LEADING_ZERO",e[e.LOWER_ROMAN=6]="LOWER_ROMAN",e[e.UPPER_ROMAN=7]="UPPER_ROMAN",e[e.LOWER_GREEK=8]="LOWER_GREEK",e[e.LOWER_ALPHA=9]="LOWER_ALPHA",e[e.UPPER_ALPHA=10]="UPPER_ALPHA",e[e.ARABIC_INDIC=11]="ARABIC_INDIC",e[e.ARMENIAN=12]="ARMENIAN",e[e.BENGALI=13]="BENGALI",e[e.CAMBODIAN=14]="CAMBODIAN",e[e.CJK_EARTHLY_BRANCH=15]="CJK_EARTHLY_BRANCH",e[e.CJK_HEAVENLY_STEM=16]="CJK_HEAVENLY_STEM",e[e.CJK_IDEOGRAPHIC=17]="CJK_IDEOGRAPHIC",e[e.DEVANAGARI=18]="DEVANAGARI",e[e.ETHIOPIC_NUMERIC=19]="ETHIOPIC_NUMERIC",e[e.GEORGIAN=20]="GEORGIAN",e[e.GUJARATI=21]="GUJARATI",e[e.GURMUKHI=22]="GURMUKHI",e[e.HEBREW=22]="HEBREW",e[e.HIRAGANA=23]="HIRAGANA",e[e.HIRAGANA_IROHA=24]="HIRAGANA_IROHA",e[e.JAPANESE_FORMAL=25]="JAPANESE_FORMAL",e[e.JAPANESE_INFORMAL=26]="JAPANESE_INFORMAL",e[e.KANNADA=27]="KANNADA",e[e.KATAKANA=28]="KATAKANA",e[e.KATAKANA_IROHA=29]="KATAKANA_IROHA",e[e.KHMER=30]="KHMER",e[e.KOREAN_HANGUL_FORMAL=31]="KOREAN_HANGUL_FORMAL",e[e.KOREAN_HANJA_FORMAL=32]="KOREAN_HANJA_FORMAL",e[e.KOREAN_HANJA_INFORMAL=33]="KOREAN_HANJA_INFORMAL",e[e.LAO=34]="LAO",e[e.LOWER_ARMENIAN=35]="LOWER_ARMENIAN",e[e.MALAYALAM=36]="MALAYALAM",e[e.MONGOLIAN=37]="MONGOLIAN",e[e.MYANMAR=38]="MYANMAR",e[e.ORIYA=39]="ORIYA",e[e.PERSIAN=40]="PERSIAN",e[e.SIMP_CHINESE_FORMAL=41]="SIMP_CHINESE_FORMAL",e[e.SIMP_CHINESE_INFORMAL=42]="SIMP_CHINESE_INFORMAL",e[e.TAMIL=43]="TAMIL",e[e.TELUGU=44]="TELUGU",e[e.THAI=45]="THAI",e[e.TIBETAN=46]="TIBETAN",e[e.TRAD_CHINESE_FORMAL=47]="TRAD_CHINESE_FORMAL",e[e.TRAD_CHINESE_INFORMAL=48]="TRAD_CHINESE_INFORMAL",e[e.UPPER_ARMENIAN=49]="UPPER_ARMENIAN",e[e.DISCLOSURE_OPEN=50]="DISCLOSURE_OPEN",e[e.DISCLOSURE_CLOSED=51]="DISCLOSURE_CLOSED"}(gn||(gn={}));var mn,Bn={name:"list-style-type",initialValue:"none",prefix:!1,type:st.IDENT_VALUE,parse:function(e,t){switch(t){case"disc":return gn.DISC;case"circle":return gn.CIRCLE;case"square":return gn.SQUARE;case"decimal":return gn.DECIMAL;case"cjk-decimal":return gn.CJK_DECIMAL;case"decimal-leading-zero":return gn.DECIMAL_LEADING_ZERO;case"lower-roman":return gn.LOWER_ROMAN;case"upper-roman":return gn.UPPER_ROMAN;case"lower-greek":return gn.LOWER_GREEK;case"lower-alpha":return gn.LOWER_ALPHA;case"upper-alpha":return gn.UPPER_ALPHA;case"arabic-indic":return gn.ARABIC_INDIC;case"armenian":return gn.ARMENIAN;case"bengali":return gn.BENGALI;case"cambodian":return gn.CAMBODIAN;case"cjk-earthly-branch":return gn.CJK_EARTHLY_BRANCH;case"cjk-heavenly-stem":return gn.CJK_HEAVENLY_STEM;case"cjk-ideographic":return gn.CJK_IDEOGRAPHIC;case"devanagari":return gn.DEVANAGARI;case"ethiopic-numeric":return gn.ETHIOPIC_NUMERIC;case"georgian":return gn.GEORGIAN;case"gujarati":return gn.GUJARATI;case"gurmukhi":return gn.GURMUKHI;case"hebrew":return gn.HEBREW;case"hiragana":return gn.HIRAGANA;case"hiragana-iroha":return gn.HIRAGANA_IROHA;case"japanese-formal":return gn.JAPANESE_FORMAL;case"japanese-informal":return gn.JAPANESE_INFORMAL;case"kannada":return gn.KANNADA;case"katakana":return gn.KATAKANA;case"katakana-iroha":return gn.KATAKANA_IROHA;case"khmer":return gn.KHMER;case"korean-hangul-formal":return gn.KOREAN_HANGUL_FORMAL;case"korean-hanja-formal":return gn.KOREAN_HANJA_FORMAL;case"korean-hanja-informal":return gn.KOREAN_HANJA_INFORMAL;case"lao":return gn.LAO;case"lower-armenian":return gn.LOWER_ARMENIAN;case"malayalam":return gn.MALAYALAM;case"mongolian":return gn.MONGOLIAN;case"myanmar":return gn.MYANMAR;case"oriya":return gn.ORIYA;case"persian":return gn.PERSIAN;case"simp-chinese-formal":return gn.SIMP_CHINESE_FORMAL;case"simp-chinese-informal":return gn.SIMP_CHINESE_INFORMAL;case"tamil":return gn.TAMIL;case"telugu":return gn.TELUGU;case"thai":return gn.THAI;case"tibetan":return gn.TIBETAN;case"trad-chinese-formal":return gn.TRAD_CHINESE_FORMAL;case"trad-chinese-informal":return gn.TRAD_CHINESE_INFORMAL;case"upper-armenian":return gn.UPPER_ARMENIAN;case"disclosure-open":return gn.DISCLOSURE_OPEN;case"disclosure-closed":return gn.DISCLOSURE_CLOSED;case"none":default:return gn.NONE}}},vn=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:st.TOKEN_VALUE}},wn=vn("top"),kn=vn("right"),Cn=vn("bottom"),bn=vn("left");!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN",e[e.SCROLL=2]="SCROLL",e[e.AUTO=3]="AUTO"}(mn||(mn={}));var Sn,Tn={name:"overflow",initialValue:"visible",prefix:!1,type:st.LIST,parse:function(e,t){return t.filter(_e).map((function(e){switch(e.value){case"hidden":return mn.HIDDEN;case"scroll":return mn.SCROLL;case"auto":return mn.AUTO;case"visible":default:return mn.VISIBLE}}))}};!function(e){e.NORMAL="normal",e.BREAK_WORD="break-word"}(Sn||(Sn={}));var Mn,xn={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:st.IDENT_VALUE,parse:function(e,t){switch(t){case"break-word":return Sn.BREAK_WORD;case"normal":default:return Sn.NORMAL}}},Un=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:st.TYPE_VALUE,format:"length-percentage"}},Qn=Un("top"),Ln=Un("right"),Fn=Un("bottom"),Rn=Un("left");!function(e){e[e.LEFT=0]="LEFT",e[e.CENTER=1]="CENTER",e[e.RIGHT=2]="RIGHT"}(Mn||(Mn={}));var Hn,_n={name:"text-align",initialValue:"left",prefix:!1,type:st.IDENT_VALUE,parse:function(e,t){switch(t){case"right":return Mn.RIGHT;case"center":case"justify":return Mn.CENTER;case"left":default:return Mn.LEFT}}};!function(e){e[e.STATIC=0]="STATIC",e[e.RELATIVE=1]="RELATIVE",e[e.ABSOLUTE=2]="ABSOLUTE",e[e.FIXED=3]="FIXED",e[e.STICKY=4]="STICKY"}(Hn||(Hn={}));var Dn,On={name:"position",initialValue:"static",prefix:!1,type:st.IDENT_VALUE,parse:function(e,t){switch(t){case"relative":return Hn.RELATIVE;case"absolute":return Hn.ABSOLUTE;case"fixed":return Hn.FIXED;case"sticky":return Hn.STICKY}return Hn.STATIC}},In={name:"text-shadow",initialValue:"none",type:st.LIST,prefix:!1,parse:function(e,t){return 1===t.length&&Oe(t[0],"none")?[]:Ne(t).map((function(t){for(var n={color:dt.TRANSPARENT,offsetX:Ye,offsetY:Ye,blur:Ye},r=0,i=0;i<t.length;i++){var A=t[i];Ve(A)?(0===r?n.offsetX=A:1===r?n.offsetY=A:n.blur=A,r++):n.color=tt(e,A)}return n}))}};!function(e){e[e.NONE=0]="NONE",e[e.LOWERCASE=1]="LOWERCASE",e[e.UPPERCASE=2]="UPPERCASE",e[e.CAPITALIZE=3]="CAPITALIZE"}(Dn||(Dn={}));var Pn,Nn={name:"text-transform",initialValue:"none",prefix:!1,type:st.IDENT_VALUE,parse:function(e,t){switch(t){case"uppercase":return Dn.UPPERCASE;case"lowercase":return Dn.LOWERCASE;case"capitalize":return Dn.CAPITALIZE}return Dn.NONE}},Kn={name:"transform",initialValue:"none",prefix:!0,type:st.VALUE,parse:function(e,t){if(t.type===p.IDENT_TOKEN&&"none"===t.value)return null;if(t.type===p.FUNCTION){var n=Vn[t.name];if(void 0===n)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return n(t.values)}return null}},Vn={matrix:function(e){var t=e.filter((function(e){return e.type===p.NUMBER_TOKEN})).map((function(e){return e.number}));return 6===t.length?t:null},matrix3d:function(e){var t=e.filter((function(e){return e.type===p.NUMBER_TOKEN})).map((function(e){return e.number})),n=t[0],r=t[1];t[2],t[3];var i=t[4],A=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var o=t[12],a=t[13];return t[14],t[15],16===t.length?[n,r,i,A,o,a]:null}},Gn={type:p.PERCENTAGE_TOKEN,number:50,flags:4},jn=[Gn,Gn],Yn={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:st.LIST,parse:function(e,t){var n=t.filter(Ge);return 2!==n.length?jn:[n[0],n[1]]}};!function(e){e[e.VISIBLE=0]="VISIBLE",e[e.HIDDEN=1]="HIDDEN",e[e.COLLAPSE=2]="COLLAPSE"}(Pn||(Pn={}));var Wn,Xn={name:"visible",initialValue:"none",prefix:!1,type:st.IDENT_VALUE,parse:function(e,t){switch(t){case"hidden":return Pn.HIDDEN;case"collapse":return Pn.COLLAPSE;case"visible":default:return Pn.VISIBLE}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(Wn||(Wn={}));var Jn,zn={name:"word-break",initialValue:"normal",prefix:!1,type:st.IDENT_VALUE,parse:function(e,t){switch(t){case"break-all":return Wn.BREAK_ALL;case"keep-all":return Wn.KEEP_ALL;case"normal":default:return Wn.NORMAL}}},qn={name:"z-index",initialValue:"auto",prefix:!1,type:st.VALUE,parse:function(e,t){if(t.type===p.IDENT_TOKEN)return{auto:!0,order:0};if(He(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},Zn={name:"opacity",initialValue:"1",type:st.VALUE,prefix:!1,parse:function(e,t){return He(t)?t.number:1}},$n={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:st.TYPE_VALUE,format:"color"},er={name:"text-decoration-line",initialValue:"none",prefix:!1,type:st.LIST,parse:function(e,t){return t.filter(_e).map((function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(e){return 0!==e}))}},tr={name:"font-family",initialValue:"",prefix:!1,type:st.LIST,parse:function(e,t){var n=[],r=[];return t.forEach((function(e){switch(e.type){case p.IDENT_TOKEN:case p.STRING_TOKEN:n.push(e.value);break;case p.NUMBER_TOKEN:n.push(e.number.toString());break;case p.COMMA_TOKEN:r.push(n.join(" ")),n.length=0}})),n.length&&r.push(n.join(" ")),r.map((function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"}))}},nr={name:"font-size",initialValue:"0",prefix:!1,type:st.TYPE_VALUE,format:"length"},rr={name:"font-weight",initialValue:"normal",type:st.VALUE,prefix:!1,parse:function(e,t){if(He(t))return t.number;if(_e(t))switch(t.value){case"bold":return 700;case"normal":default:return 400}return 400}},ir={name:"font-variant",initialValue:"none",type:st.LIST,prefix:!1,parse:function(e,t){return t.filter(_e).map((function(e){return e.value}))}};!function(e){e.NORMAL="normal",e.ITALIC="italic",e.OBLIQUE="oblique"}(Jn||(Jn={}));var Ar,or={name:"font-style",initialValue:"normal",prefix:!1,type:st.IDENT_VALUE,parse:function(e,t){switch(t){case"oblique":return Jn.OBLIQUE;case"italic":return Jn.ITALIC;case"normal":default:return Jn.NORMAL}}},ar=function(e,t){return 0!=(e&t)},sr={name:"content",initialValue:"none",type:st.LIST,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return n.type===p.IDENT_TOKEN&&"none"===n.value?[]:t}},ur={name:"counter-increment",initialValue:"none",prefix:!0,type:st.LIST,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(n.type===p.IDENT_TOKEN&&"none"===n.value)return null;for(var r=[],i=t.filter(Ie),A=0;A<i.length;A++){var o=i[A],a=i[A+1];if(o.type===p.IDENT_TOKEN){var s=a&&He(a)?a.number:1;r.push({counter:o.value,increment:s})}}return r}},cr={name:"counter-reset",initialValue:"none",prefix:!0,type:st.LIST,parse:function(e,t){if(0===t.length)return[];for(var n=[],r=t.filter(Ie),i=0;i<r.length;i++){var A=r[i],o=r[i+1];if(_e(A)&&"none"!==A.value){var a=o&&He(o)?o.number:0;n.push({counter:A.value,reset:a})}}return n}},lr={name:"quotes",initialValue:"none",prefix:!0,type:st.LIST,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(n.type===p.IDENT_TOKEN&&"none"===n.value)return null;var r=[],i=t.filter(De);if(i.length%2!=0)return null;for(var A=0;A<i.length;A+=2){var o=i[A].value,a=i[A+1].value;r.push({open:o,close:a})}return r}},hr=function(e,t,n){if(!e)return"";var r=e[Math.min(t,e.length-1)];return r?n?r.open:r.close:""},dr={name:"box-shadow",initialValue:"none",type:st.LIST,prefix:!1,parse:function(e,t){return 1===t.length&&Oe(t[0],"none")?[]:Ne(t).map((function(t){for(var n={color:255,offsetX:Ye,offsetY:Ye,blur:Ye,spread:Ye,inset:!1},r=0,i=0;i<t.length;i++){var A=t[i];Oe(A,"inset")?n.inset=!0:Ve(A)?(0===r?n.offsetX=A:1===r?n.offsetY=A:2===r?n.blur=A:n.spread=A,r++):n.color=tt(e,A)}return n}))}};!function(e){e[e.FILL=0]="FILL",e[e.STROKE=1]="STROKE",e[e.MARKERS=2]="MARKERS"}(Ar||(Ar={}));var pr,fr={name:"paint-order",initialValue:"normal",prefix:!1,type:st.LIST,parse:function(e,t){var n=[Ar.FILL,Ar.STROKE,Ar.MARKERS],r=[];return t.filter(_e).forEach((function(e){switch(e.value){case"stroke":r.push(Ar.STROKE);break;case"fill":r.push(Ar.FILL);break;case"markers":r.push(Ar.MARKERS)}})),n.forEach((function(e){-1===r.indexOf(e)&&r.push(e)})),r}},yr={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:st.TYPE_VALUE,format:"color"},gr={name:"-webkit-text-stroke-width",initialValue:"0",type:st.VALUE,prefix:!1,parse:function(e,t){return Re(t)?t.number:0}},Er=function(){function e(e,t){var n,r;this.backgroundClip=vr(e,gt,t.backgroundClip),this.backgroundColor=vr(e,Et,t.backgroundColor),this.backgroundImage=vr(e,xt,t.backgroundImage),this.backgroundOrigin=vr(e,Ut,t.backgroundOrigin),this.backgroundPosition=vr(e,Qt,t.backgroundPosition),this.backgroundRepeat=vr(e,Ft,t.backgroundRepeat),this.backgroundSize=vr(e,_t,t.backgroundSize),this.borderTopColor=vr(e,It,t.borderTopColor),this.borderRightColor=vr(e,Pt,t.borderRightColor),this.borderBottomColor=vr(e,Nt,t.borderBottomColor),this.borderLeftColor=vr(e,Kt,t.borderLeftColor),this.borderTopLeftRadius=vr(e,Gt,t.borderTopLeftRadius),this.borderTopRightRadius=vr(e,jt,t.borderTopRightRadius),this.borderBottomRightRadius=vr(e,Yt,t.borderBottomRightRadius),this.borderBottomLeftRadius=vr(e,Wt,t.borderBottomLeftRadius),this.borderTopStyle=vr(e,zt,t.borderTopStyle),this.borderRightStyle=vr(e,qt,t.borderRightStyle),this.borderBottomStyle=vr(e,Zt,t.borderBottomStyle),this.borderLeftStyle=vr(e,$t,t.borderLeftStyle),this.borderTopWidth=vr(e,tn,t.borderTopWidth),this.borderRightWidth=vr(e,nn,t.borderRightWidth),this.borderBottomWidth=vr(e,rn,t.borderBottomWidth),this.borderLeftWidth=vr(e,An,t.borderLeftWidth),this.boxShadow=vr(e,dr,t.boxShadow),this.color=vr(e,on,t.color),this.display=vr(e,an,t.display),this.float=vr(e,cn,t.cssFloat),this.fontFamily=vr(e,tr,t.fontFamily),this.fontSize=vr(e,nr,t.fontSize),this.fontStyle=vr(e,or,t.fontStyle),this.fontVariant=vr(e,ir,t.fontVariant),this.fontWeight=vr(e,rr,t.fontWeight),this.letterSpacing=vr(e,ln,t.letterSpacing),this.lineBreak=vr(e,dn,t.lineBreak),this.lineHeight=vr(e,pn,t.lineHeight),this.listStyleImage=vr(e,yn,t.listStyleImage),this.listStylePosition=vr(e,En,t.listStylePosition),this.listStyleType=vr(e,Bn,t.listStyleType),this.marginTop=vr(e,wn,t.marginTop),this.marginRight=vr(e,kn,t.marginRight),this.marginBottom=vr(e,Cn,t.marginBottom),this.marginLeft=vr(e,bn,t.marginLeft),this.opacity=vr(e,Zn,t.opacity);var i=vr(e,Tn,t.overflow);this.overflowX=i[0],this.overflowY=i[i.length>1?1:0],this.overflowWrap=vr(e,xn,t.overflowWrap),this.paddingTop=vr(e,Qn,t.paddingTop),this.paddingRight=vr(e,Ln,t.paddingRight),this.paddingBottom=vr(e,Fn,t.paddingBottom),this.paddingLeft=vr(e,Rn,t.paddingLeft),this.paintOrder=vr(e,fr,t.paintOrder),this.position=vr(e,On,t.position),this.textAlign=vr(e,_n,t.textAlign),this.textDecorationColor=vr(e,$n,null!==(n=t.textDecorationColor)&&void 0!==n?n:t.color),this.textDecorationLine=vr(e,er,null!==(r=t.textDecorationLine)&&void 0!==r?r:t.textDecoration),this.textShadow=vr(e,In,t.textShadow),this.textTransform=vr(e,Nn,t.textTransform),this.transform=vr(e,Kn,t.transform),this.transformOrigin=vr(e,Yn,t.transformOrigin),this.visibility=vr(e,Xn,t.visibility),this.webkitTextStrokeColor=vr(e,yr,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=vr(e,gr,t.webkitTextStrokeWidth),this.wordBreak=vr(e,zn,t.wordBreak),this.zIndex=vr(e,qn,t.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===Pn.VISIBLE},e.prototype.isTransparent=function(){return nt(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return this.position!==Hn.STATIC},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return this.float!==Xt.NONE},e.prototype.isInlineLevel=function(){return ar(this.display,4)||ar(this.display,33554432)||ar(this.display,268435456)||ar(this.display,536870912)||ar(this.display,67108864)||ar(this.display,134217728)},e}(),mr=function(e,t){this.content=vr(e,sr,t.content),this.quotes=vr(e,lr,t.quotes)},Br=function(e,t){this.counterIncrement=vr(e,ur,t.counterIncrement),this.counterReset=vr(e,cr,t.counterReset)},vr=function(e,t,n){var r=new Le,i=null!=n?n.toString():t.initialValue;r.write(i);var A=new Fe(r.read());switch(t.type){case st.IDENT_VALUE:var o=A.parseComponentValue();return t.parse(e,_e(o)?o.value:t.initialValue);case st.VALUE:return t.parse(e,A.parseComponentValue());case st.LIST:return t.parse(e,A.parseComponentValues());case st.TOKEN_VALUE:return A.parseComponentValue();case st.TYPE_VALUE:switch(t.format){case"angle":return qe(e,A.parseComponentValue());case"color":return tt(e,A.parseComponentValue());case"image":return Tt(e,A.parseComponentValue());case"length":var a=A.parseComponentValue();return Ve(a)?a:Ye;case"length-percentage":var s=A.parseComponentValue();return Ge(s)?s:Ye}}},wr=function(e,t){this.context=e,this.styles=new Er(e,window.getComputedStyle(t,null)),this.textNodes=[],this.elements=[],null!==this.styles.transform&&ri(t)&&(t.style.transform="none"),this.bounds=s(this.context,t),this.flags=0},kr=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},Cr=function(e,t,n,r,i){var A="http://www.w3.org/2000/svg",o=document.createElementNS(A,"svg"),a=document.createElementNS(A,"foreignObject");return o.setAttributeNS(null,"width",e.toString()),o.setAttributeNS(null,"height",t.toString()),a.setAttributeNS(null,"width","100%"),a.setAttributeNS(null,"height","100%"),a.setAttributeNS(null,"x",n.toString()),a.setAttributeNS(null,"y",r.toString()),a.setAttributeNS(null,"externalResourcesRequired","true"),o.appendChild(a),a.appendChild(i),o},br=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},Sr={get SUPPORT_RANGE_BOUNDS(){var e=function(e){if(e.createRange){var t=e.createRange();if(t.getBoundingClientRect){var n=e.createElement("boundtest");n.style.height="123px",n.style.display="block",e.body.appendChild(n),t.selectNode(n);var r=t.getBoundingClientRect(),i=Math.round(r.height);if(e.body.removeChild(n),123===i)return!0}}return!1}(document);return Object.defineProperty(Sr,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=Sr.SUPPORT_RANGE_BOUNDS&&function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var n=e.createRange();t.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var r=t.firstChild,i=u(r.data).map((function(e){return c(e)})),A=0,o={},a=i.every((function(e,t){n.setStart(r,A),n.setEnd(r,A+e.length);var i=n.getBoundingClientRect();A+=e.length;var a=i.x>o.x||i.y>o.y;return o=i,0===t||a}));return e.body.removeChild(t),a}(document);return Object.defineProperty(Sr,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=function(e){var t=new Image,n=e.createElement("canvas"),r=n.getContext("2d");if(!r)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(t,0,0),n.toDataURL()}catch(e){return!1}return!0}(document);return Object.defineProperty(Sr,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"==typeof Array.from&&"function"==typeof window.fetch?function(e){var t=e.createElement("canvas");t.width=100,t.height=100;var n=t.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,100,100);var r=new Image,i=t.toDataURL();r.src=i;var A=Cr(100,100,0,0,r);return n.fillStyle="red",n.fillRect(0,0,100,100),br(A).then((function(t){n.drawImage(t,0,0);var r=n.getImageData(0,0,100,100).data;n.fillStyle="red",n.fillRect(0,0,100,100);var A=e.createElement("div");return A.style.backgroundImage="url("+i+")",A.style.height="100px",kr(r)?br(Cr(100,100,0,0,A)):Promise.reject(!1)})).then((function(e){return n.drawImage(e,0,0),kr(n.getImageData(0,0,100,100).data)})).catch((function(){return!1}))}(document):Promise.resolve(!1);return Object.defineProperty(Sr,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=void 0!==(new Image).crossOrigin;return Object.defineProperty(Sr,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(Sr,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Sr,"SUPPORT_CORS_XHR",{value:e}),e}},Tr=function(e,t){this.text=e,this.bounds=t},Mr=function(e,t){var n=t.ownerDocument;if(n){var r=n.createElement("html2canvaswrapper");r.appendChild(t.cloneNode(!0));var i=t.parentNode;if(i){i.replaceChild(r,t);var A=s(e,r);return r.firstChild&&i.replaceChild(r.firstChild,r),A}}return a.EMPTY},xr=function(e,t,n){var r=e.ownerDocument;if(!r)throw new Error("Node has no owner document");var i=r.createRange();return i.setStart(e,t),i.setEnd(e,t+n),i},Ur=function(e,t,n,r){return a.fromClientRect(e,xr(t,n,r).getBoundingClientRect())},Qr=function(e,t){return 0!==t.letterSpacing?u(e).map((function(e){return c(e)})):Fr(e,t)},Lr=[32,160,4961,65792,65793,4153,4241],Fr=function(e,t){for(var n,r=function(e,t){var n=u(e),r=$(n,t),i=r[0],A=r[1],o=r[2],a=n.length,s=0,c=0;return{next:function(){if(c>=a)return{done:!0,value:null};for(var e="Ã";c<a&&"Ã"===(e=Z(n,A,i,++c,o)););if("Ã"!==e||c===a){var t=new ee(n,e,s,c);return s=c,{value:t,done:!1}}return{done:!0,value:null}}}}(e,{lineBreak:t.lineBreak,wordBreak:t.overflowWrap===Sn.BREAK_WORD?"break-word":t.wordBreak}),i=[],A=function(){if(n.value){var e=n.value.slice(),t=u(e),r="";t.forEach((function(e){-1===Lr.indexOf(e)?r+=c(e):(r.length&&i.push(r),i.push(c(e)),r="")})),r.length&&i.push(r)}};!(n=r.next()).done;)A();return i},Rr=function(e,t,n){this.text=Hr(t.data,n.textTransform),this.textBounds=function(e,t,n,r){var i=Qr(t,n),A=[],o=0;return i.forEach((function(t){if(n.textDecorationLine.length||t.trim().length>0)if(Sr.SUPPORT_RANGE_BOUNDS)Sr.SUPPORT_WORD_BREAKING?A.push(new Tr(t,Ur(e,r,o,t.length))):A.push(new Tr(t,a.fromDOMRectList(e,xr(r,o,t.length).getClientRects())));else{var i=r.splitText(t.length);A.push(new Tr(t,Mr(e,r))),r=i}else Sr.SUPPORT_RANGE_BOUNDS||(r=r.splitText(t.length));o+=t.length})),A}(e,this.text,n,t)},Hr=function(e,t){switch(t){case Dn.LOWERCASE:return e.toLowerCase();case Dn.CAPITALIZE:return e.replace(_r,Dr);case Dn.UPPERCASE:return e.toUpperCase();default:return e}},_r=/(^|\s|:|-|\(|\))([a-z])/g,Dr=function(e,t,n){return e.length>0?t+n.toUpperCase():e},Or=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.src=n.currentSrc||n.src,r.intrinsicWidth=n.naturalWidth,r.intrinsicHeight=n.naturalHeight,r.context.cache.addImage(r.src),r}return t(n,e),n}(wr),Ir=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.canvas=n,r.intrinsicWidth=n.width,r.intrinsicHeight=n.height,r}return t(n,e),n}(wr),Pr=function(e){function n(t,n){var r=e.call(this,t,n)||this,i=new XMLSerializer,A=s(t,n);return n.setAttribute("width",A.width+"px"),n.setAttribute("height",A.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(i.serializeToString(n)),r.intrinsicWidth=n.width.baseVal.value,r.intrinsicHeight=n.height.baseVal.value,r.context.cache.addImage(r.svg),r}return t(n,e),n}(wr),Nr=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return t(n,e),n}(wr),Kr=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.start=n.start,r.reversed="boolean"==typeof n.reversed&&!0===n.reversed,r}return t(n,e),n}(wr),Vr=[{type:p.DIMENSION_TOKEN,flags:0,unit:"px",number:3}],Gr=[{type:p.PERCENTAGE_TOKEN,flags:0,number:50}],jr="password",Yr=function(e){function n(t,n){var r,i,A,o=e.call(this,t,n)||this;switch(o.type=n.type.toLowerCase(),o.checked=n.checked,o.value=0===(i=(r=n).type===jr?new Array(r.value.length+1).join("â¢"):r.value).length?r.placeholder||"":i,"checkbox"!==o.type&&"radio"!==o.type||(o.styles.backgroundColor=3739148031,o.styles.borderTopColor=o.styles.borderRightColor=o.styles.borderBottomColor=o.styles.borderLeftColor=2779096575,o.styles.borderTopWidth=o.styles.borderRightWidth=o.styles.borderBottomWidth=o.styles.borderLeftWidth=1,o.styles.borderTopStyle=o.styles.borderRightStyle=o.styles.borderBottomStyle=o.styles.borderLeftStyle=Ht.SOLID,o.styles.backgroundClip=[ut.BORDER_BOX],o.styles.backgroundOrigin=[0],o.bounds=(A=o.bounds).width>A.height?new a(A.left+(A.width-A.height)/2,A.top,A.height,A.height):A.width<A.height?new a(A.left,A.top+(A.height-A.width)/2,A.width,A.width):A),o.type){case"checkbox":o.styles.borderTopRightRadius=o.styles.borderTopLeftRadius=o.styles.borderBottomRightRadius=o.styles.borderBottomLeftRadius=Vr;break;case"radio":o.styles.borderTopRightRadius=o.styles.borderTopLeftRadius=o.styles.borderBottomRightRadius=o.styles.borderBottomLeftRadius=Gr}return o}return t(n,e),n}(wr),Wr=function(e){function n(t,n){var r=e.call(this,t,n)||this,i=n.options[n.selectedIndex||0];return r.value=i&&i.text||"",r}return t(n,e),n}(wr),Xr=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return t(n,e),n}(wr),Jr=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.src=n.src,r.width=parseInt(n.width,10)||0,r.height=parseInt(n.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){r.tree=Zr(t,n.contentWindow.document.documentElement);var i=n.contentWindow.document.documentElement?ht(t,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):dt.TRANSPARENT,A=n.contentWindow.document.body?ht(t,getComputedStyle(n.contentWindow.document.body).backgroundColor):dt.TRANSPARENT;r.backgroundColor=nt(i)?nt(A)?r.styles.backgroundColor:A:i}}catch(e){}return r}return t(n,e),n}(wr),zr=["OL","UL","MENU"],qr=function(e,t){return li(t)?new Or(e,t):ci(t)?new Ir(e,t):si(t)?new Pr(e,t):Ai(t)?new Nr(e,t):oi(t)?new Kr(e,t):ai(t)?new Yr(e,t):yi(t)?new Wr(e,t):fi(t)?new Xr(e,t):hi(t)?new Jr(e,t):new wr(e,t)},Zr=function(e,t){var n=qr(e,t);return n.flags|=4,function e(t,n,r,i){for(var A=n.firstChild,o=void 0;A;A=o)if(o=A.nextSibling,ti(A)&&A.data.trim().length>0)r.textNodes.push(new Rr(t,A,r.styles));else if(ni(A))if(gi(A)&&A.assignedNodes)A.assignedNodes().forEach((function(n){return e(t,n,r,i)}));else{var a=qr(t,A);a.styles.isVisible()&&($r(A,a,i)?a.flags|=4:ei(a.styles)&&(a.flags|=2),-1!==zr.indexOf(A.tagName)&&(a.flags|=8),r.elements.push(a),A.slot,A.shadowRoot?e(t,A.shadowRoot,a,i):fi(A)||si(A)||yi(A)||e(t,A,a,i))}}(e,t,n,n),n},$r=function(e,t,n){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||ui(e)&&n.styles.isTransparent()},ei=function(e){return e.isPositioned()||e.isFloating()},ti=function(e){return e.nodeType===Node.TEXT_NODE},ni=function(e){return e.nodeType===Node.ELEMENT_NODE},ri=function(e){return ni(e)&&void 0!==e.style&&!ii(e)},ii=function(e){return"object"===o(e.className)},Ai=function(e){return"LI"===e.tagName},oi=function(e){return"OL"===e.tagName},ai=function(e){return"INPUT"===e.tagName},si=function(e){return"svg"===e.tagName},ui=function(e){return"BODY"===e.tagName},ci=function(e){return"CANVAS"===e.tagName},li=function(e){return"IMG"===e.tagName},hi=function(e){return"IFRAME"===e.tagName},di=function(e){return"STYLE"===e.tagName},pi=function(e){return"SCRIPT"===e.tagName},fi=function(e){return"TEXTAREA"===e.tagName},yi=function(e){return"SELECT"===e.tagName},gi=function(e){return"SLOT"===e.tagName},Ei=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},e.prototype.pop=function(e){var t=this;e.forEach((function(e){return t.counters[e].pop()}))},e.prototype.parse=function(e){var t=this,n=e.counterIncrement,r=e.counterReset,i=!0;null!==n&&n.forEach((function(e){var n=t.counters[e.counter];n&&0!==e.increment&&(i=!1,n.length||n.push(1),n[Math.max(0,n.length-1)]+=e.increment)}));var A=[];return i&&r.forEach((function(e){var n=t.counters[e.counter];A.push(e.counter),n||(n=t.counters[e.counter]=[]),n.push(e.reset)})),A},e}(),mi={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Bi={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Ô¿","Ô¾","Ô½","Ô¼","Ô»","Ôº","Ô¹","Ô¸","Ô·","Ô¶","Ôµ","Ô´","Ô³","Ô²","Ô±"]},vi={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["××³","××³","××³","××³","××³","××³","××³","××³","××³","××³","×ª","×©","×¨","×§","×¦","×¤","×¢","×¡","× ","×","×","×","××","××","××","××","××","×","×","×","×","×","×","×","×","×","×"]},wi={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["áµ","á°","á¯","á´","á®","á­","á¬","á«","áª","á©","á¨","á§","á¦","á¥","á¤","á³","á¢","á¡","á ","á","á","á","á²","á","á","á","á","á","á","á±","á","á","á","á","á","á","á"]},ki=function(e,t,n,r,i,A){return e<t||e>n?Mi(e,i,A.length>0):r.integers.reduce((function(t,n,i){for(;e>=n;)e-=n,t+=r.values[i];return t}),"")+A},Ci=function(e,t,n,r){var i="";do{n||e--,i=r(e)+i,e/=t}while(e*t>=t);return i},bi=function(e,t,n,r,i){var A=n-t+1;return(e<0?"-":"")+(Ci(Math.abs(e),A,r,(function(e){return c(Math.floor(e%A)+t)}))+i)},Si=function(e,t,n){void 0===n&&(n=". ");var r=t.length;return Ci(Math.abs(e),r,!1,(function(e){return t[Math.floor(e%r)]}))+n},Ti=function(e,t,n,r,i,A){if(e<-9999||e>9999)return Mi(e,gn.CJK_DECIMAL,i.length>0);var o=Math.abs(e),a=i;if(0===o)return t[0]+a;for(var s=0;o>0&&s<=4;s++){var u=o%10;0===u&&ar(A,1)&&""!==a?a=t[u]+a:u>1||1===u&&0===s||1===u&&1===s&&ar(A,2)||1===u&&1===s&&ar(A,4)&&e>100||1===u&&s>1&&ar(A,8)?a=t[u]+(s>0?n[s-1]:"")+a:1===u&&s>0&&(a=n[s-1]+a),o=Math.floor(o/10)}return(e<0?r:"")+a},Mi=function(e,t,n){var r=n?". ":"",i=n?"ã":"",A=n?", ":"",o=n?" ":"";switch(t){case gn.DISC:return"â¢"+o;case gn.CIRCLE:return"â¦"+o;case gn.SQUARE:return"â¾"+o;case gn.DECIMAL_LEADING_ZERO:var a=bi(e,48,57,!0,r);return a.length<4?"0"+a:a;case gn.CJK_DECIMAL:return Si(e,"ãä¸äºä¸åäºå­ä¸å«ä¹",i);case gn.LOWER_ROMAN:return ki(e,1,3999,mi,gn.DECIMAL,r).toLowerCase();case gn.UPPER_ROMAN:return ki(e,1,3999,mi,gn.DECIMAL,r);case gn.LOWER_GREEK:return bi(e,945,969,!1,r);case gn.LOWER_ALPHA:return bi(e,97,122,!1,r);case gn.UPPER_ALPHA:return bi(e,65,90,!1,r);case gn.ARABIC_INDIC:return bi(e,1632,1641,!0,r);case gn.ARMENIAN:case gn.UPPER_ARMENIAN:return ki(e,1,9999,Bi,gn.DECIMAL,r);case gn.LOWER_ARMENIAN:return ki(e,1,9999,Bi,gn.DECIMAL,r).toLowerCase();case gn.BENGALI:return bi(e,2534,2543,!0,r);case gn.CAMBODIAN:case gn.KHMER:return bi(e,6112,6121,!0,r);case gn.CJK_EARTHLY_BRANCH:return Si(e,"å­ä¸å¯å¯è¾°å·³åæªç³éæäº¥",i);case gn.CJK_HEAVENLY_STEM:return Si(e,"ç²ä¹ä¸ä¸æå·±åºè¾å£¬ç¸",i);case gn.CJK_IDEOGRAPHIC:case gn.TRAD_CHINESE_INFORMAL:return Ti(e,"é¶ä¸äºä¸åäºå­ä¸å«ä¹","åç¾åè¬","è² ",i,14);case gn.TRAD_CHINESE_FORMAL:return Ti(e,"é¶å£¹è²³åèä¼é¸ææç","æ¾ä½°ä»è¬","è² ",i,15);case gn.SIMP_CHINESE_INFORMAL:return Ti(e,"é¶ä¸äºä¸åäºå­ä¸å«ä¹","åç¾åè¬","è´",i,14);case gn.SIMP_CHINESE_FORMAL:return Ti(e,"é¶å£¹è´°åèä¼éææç","æ¾ä½°ä»è¬","è´",i,15);case gn.JAPANESE_INFORMAL:return Ti(e,"ãä¸äºä¸åäºå­ä¸å«ä¹","åç¾åä¸","ãã¤ãã¹",i,0);case gn.JAPANESE_FORMAL:return Ti(e,"é¶å£±å¼ååä¼å­ä¸å«ä¹","æ¾ç¾åä¸","ãã¤ãã¹",i,7);case gn.KOREAN_HANGUL_FORMAL:return Ti(e,"ìì¼ì´ì¼ì¬ì¤ì¡ì¹ íêµ¬","ì­ë°±ì²ë§","ë§ì´ëì¤",A,7);case gn.KOREAN_HANJA_INFORMAL:return Ti(e,"é¶ä¸äºä¸åäºå­ä¸å«ä¹","åç¾åè¬","ë§ì´ëì¤",A,0);case gn.KOREAN_HANJA_FORMAL:return Ti(e,"é¶å£¹è²³ååäºå­ä¸å«ä¹","æ¾ç¾å","ë§ì´ëì¤",A,7);case gn.DEVANAGARI:return bi(e,2406,2415,!0,r);case gn.GEORGIAN:return ki(e,1,19999,wi,gn.DECIMAL,r);case gn.GUJARATI:return bi(e,2790,2799,!0,r);case gn.GURMUKHI:return bi(e,2662,2671,!0,r);case gn.HEBREW:return ki(e,1,10999,vi,gn.DECIMAL,r);case gn.HIRAGANA:return Si(e,"ããããããããããããããããã¡ã¤ã¦ã¨ãªã«ã¬ã­ã®ã¯ã²ãµã¸ã»ã¾ã¿ãããããããããããããããã");case gn.HIRAGANA_IROHA:return Si(e,"ããã¯ã«ã»ã¸ã¨ã¡ãã¬ããããããããã¤ã­ãªããããã®ãããã¾ããµããã¦ãããããã¿ããã²ããã");case gn.KANNADA:return bi(e,3302,3311,!0,r);case gn.KATAKANA:return Si(e,"ã¢ã¤ã¦ã¨ãªã«ã­ã¯ã±ã³ãµã·ã¹ã»ã½ã¿ããããããããããããããããã ã¡ã¢ã¤ã¦ã¨ã©ãªã«ã¬ã­ã¯ã°ã±ã²ã³",i);case gn.KATAKANA_IROHA:return Si(e,"ã¤ã­ãããããããªãã«ã²ã¯ã«ã¨ã¿ã¬ã½ãããã©ã ã¦ã°ããªã¯ã¤ãã±ãã³ã¨ãã¢ãµã­ã¦ã¡ãã·ã±ãã¢ã»ã¹",i);case gn.LAO:return bi(e,3792,3801,!0,r);case gn.MONGOLIAN:return bi(e,6160,6169,!0,r);case gn.MYANMAR:return bi(e,4160,4169,!0,r);case gn.ORIYA:return bi(e,2918,2927,!0,r);case gn.PERSIAN:return bi(e,1776,1785,!0,r);case gn.TAMIL:return bi(e,3046,3055,!0,r);case gn.TELUGU:return bi(e,3174,3183,!0,r);case gn.THAI:return bi(e,3664,3673,!0,r);case gn.TIBETAN:return bi(e,3872,3881,!0,r);case gn.DECIMAL:default:return bi(e,48,57,!0,r)}},xi=function(){function e(e,t,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=t,this.counters=new Ei,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement)}return e.prototype.toIFrame=function(e,t){var n=this,A=Qi(e,t);if(!A.contentWindow)return Promise.reject("Unable to find iframe window");var o=e.defaultView.pageXOffset,a=e.defaultView.pageYOffset,s=A.contentWindow,u=s.document,c=Ri(A).then((function(){return r(n,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return this.scrolledElements.forEach(Ii),s&&(s.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||s.scrollY===t.top&&s.scrollX===t.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(s.scrollX-t.left,s.scrollY-t.top,0,0))),e=this.options.onclone,void 0===(n=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:u.fonts&&u.fonts.ready?[4,u.fonts.ready]:[3,2];case 1:r.sent(),r.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Fi(u)]:[3,4];case 3:r.sent(),r.label=4;case 4:return"function"==typeof e?[2,Promise.resolve().then((function(){return e(u,n)})).then((function(){return A}))]:[2,A]}}))}))}));return u.open(),u.write(Di(document.doctype)+"<html></html>"),Oi(this.referenceElement.ownerDocument,o,a),u.replaceChild(u.adoptNode(this.documentElement),u.documentElement),u.close(),c},e.prototype.createElementClone=function(e){if(ci(e))return this.createCanvasClone(e);if(di(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return li(t)&&(li(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager")),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var n=[].slice.call(t.cssRules,0).reduce((function(e,t){return t&&"string"==typeof t.cssText?e+t.cssText:e}),""),r=e.cloneNode(!1);return r.textContent=n,r}}catch(e){if(this.context.logger.error("Unable to access cssRules property",e),"SecurityError"!==e.name)throw e}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){if(this.options.inlineImages&&e.ownerDocument){var t=e.ownerDocument.createElement("img");try{return t.src=e.toDataURL(),t}catch(e){this.context.logger.info("Unable to clone canvas contents, canvas is tainted")}}var n=e.cloneNode(!1);try{n.width=e.width,n.height=e.height;var r=e.getContext("2d"),i=n.getContext("2d");return i&&(r?i.putImageData(r.getImageData(0,0,e.width,e.height),0,0):i.drawImage(e,0,0)),n}catch(e){}return n},e.prototype.cloneNode=function(e){if(ti(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var t=e.ownerDocument.defaultView;if(t&&ni(e)&&(ri(e)||ii(e))){var n=this.createElementClone(e),r=t.getComputedStyle(e),i=t.getComputedStyle(e,":before"),A=t.getComputedStyle(e,":after");this.referenceElement===e&&ri(n)&&(this.clonedReferenceElement=n),ui(n)&&Ki(n);for(var o=this.counters.parse(new Br(this.context,r)),a=this.resolvePseudoContent(e,n,i,pr.BEFORE),s=e.firstChild;s;s=s.nextSibling)ni(s)&&(pi(s)||s.hasAttribute("data-html2canvas-ignore")||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(s))||this.options.copyStyles&&ni(s)&&di(s)||n.appendChild(this.cloneNode(s));a&&n.insertBefore(a,n.firstChild);var u=this.resolvePseudoContent(e,n,A,pr.AFTER);return u&&n.appendChild(u),this.counters.pop(o),r&&(this.options.copyStyles||ii(e))&&!hi(e)&&_i(r,n),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([n,e.scrollLeft,e.scrollTop]),(fi(e)||yi(e))&&(fi(n)||yi(n))&&(n.value=e.value),n}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,n,r){var i=this;if(n){var A=n.content,o=t.ownerDocument;if(o&&A&&"none"!==A&&"-moz-alt-content"!==A&&"none"!==n.display){this.counters.parse(new Br(this.context,n));var a=new mr(this.context,n),s=o.createElement("html2canvaspseudoelement");_i(n,s),a.content.forEach((function(t){if(t.type===p.STRING_TOKEN)s.appendChild(o.createTextNode(t.value));else if(t.type===p.URL_TOKEN){var n=o.createElement("img");n.src=t.value,n.style.opacity="1",s.appendChild(n)}else if(t.type===p.FUNCTION){if("attr"===t.name){var r=t.values.filter(_e);r.length&&s.appendChild(o.createTextNode(e.getAttribute(r[0].value)||""))}else if("counter"===t.name){var A=t.values.filter(Pe),u=A[0],c=A[1];if(u&&_e(u)){var l=i.counters.getCounterValue(u.value),h=c&&_e(c)?Bn.parse(i.context,c.value):gn.DECIMAL;s.appendChild(o.createTextNode(Mi(l,h,!1)))}}else if("counters"===t.name){var d=t.values.filter(Pe),f=(u=d[0],d[1]);if(c=d[2],u&&_e(u)){var y=i.counters.getCounterValues(u.value),g=c&&_e(c)?Bn.parse(i.context,c.value):gn.DECIMAL,E=f&&f.type===p.STRING_TOKEN?f.value:"",m=y.map((function(e){return Mi(e,g,!1)})).join(E);s.appendChild(o.createTextNode(m))}}}else if(t.type===p.IDENT_TOKEN)switch(t.value){case"open-quote":s.appendChild(o.createTextNode(hr(a.quotes,i.quoteDepth++,!0)));break;case"close-quote":s.appendChild(o.createTextNode(hr(a.quotes,--i.quoteDepth,!1)));break;default:s.appendChild(o.createTextNode(t.value))}})),s.className=Pi+" "+Ni;var u=r===pr.BEFORE?" "+Pi:" "+Ni;return ii(t)?t.className.baseValue+=u:t.className+=u,s}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(pr||(pr={}));var Ui,Qi=function(e,t){var n=e.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=t.width.toString(),n.height=t.height.toString(),n.scrolling="no",n.setAttribute("data-html2canvas-ignore","true"),e.body.appendChild(n),n},Li=function(e){return new Promise((function(t){e.complete?t():e.src?(e.onload=t,e.onerror=t):t()}))},Fi=function(e){return Promise.all([].slice.call(e.images,0).map(Li))},Ri=function(e){return new Promise((function(t,n){var r=e.contentWindow;if(!r)return n("No window assigned for iframe");var i=r.document;r.onload=e.onload=function(){r.onload=e.onload=null;var n=setInterval((function(){i.body.childNodes.length>0&&"complete"===i.readyState&&(clearInterval(n),t(e))}),50)}}))},Hi=["all","d","content"],_i=function(e,t){for(var n=e.length-1;n>=0;n--){var r=e.item(n);-1===Hi.indexOf(r)&&t.style.setProperty(r,e.getPropertyValue(r))}return t},Di=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},Oi=function(e,t,n){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||n!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,n)},Ii=function(e){var t=e[0],n=e[1],r=e[2];t.scrollLeft=n,t.scrollTop=r},Pi="___html2canvas___pseudoelement_before",Ni="___html2canvas___pseudoelement_after",Ki=function(e){Vi(e,"."+Pi+':before{\n    content: "" !important;\n    display: none !important;\n}\n         .'+Ni+':after{\n    content: "" !important;\n    display: none !important;\n}')},Vi=function(e,t){var n=e.ownerDocument;if(n){var r=n.createElement("style");r.textContent=t,e.appendChild(r)}},Gi=function(){function e(){}return e.getOrigin=function(t){var n=e._link;return n?(n.href=t,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e}(),ji=function(){function e(e,t){this.context=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:Zi(e)||Ji(e)?((this._cache[e]=this.loadImage(e)).catch((function(){})),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return r(this,void 0,void 0,(function(){var t,n,r,A,o=this;return i(this,(function(i){switch(i.label){case 0:return t=Gi.isSameOrigin(e),n=!zi(e)&&!0===this._options.useCORS&&Sr.SUPPORT_CORS_IMAGES&&!t,r=!zi(e)&&!t&&!Zi(e)&&"string"==typeof this._options.proxy&&Sr.SUPPORT_CORS_XHR&&!n,t||!1!==this._options.allowTaint||zi(e)||Zi(e)||r||n?(A=e,r?[4,this.proxy(A)]:[3,2]):[2];case 1:A=i.sent(),i.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise((function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,(qi(A)||n)&&(r.crossOrigin="anonymous"),r.src=A,!0===r.complete&&setTimeout((function(){return e(r)}),500),o._options.imageTimeout>0&&setTimeout((function(){return t("Timed out ("+o._options.imageTimeout+"ms) loading image")}),o._options.imageTimeout)}))];case 3:return[2,i.sent()]}}))}))},e.prototype.has=function(e){return void 0!==this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var r=e.substring(0,256);return new Promise((function(i,A){var o=Sr.SUPPORT_RESPONSE_TYPE?"blob":"text",a=new XMLHttpRequest;a.onload=function(){if(200===a.status)if("text"===o)i(a.response);else{var e=new FileReader;e.addEventListener("load",(function(){return i(e.result)}),!1),e.addEventListener("error",(function(e){return A(e)}),!1),e.readAsDataURL(a.response)}else A("Failed to proxy resource "+r+" with status code "+a.status)},a.onerror=A;var s=n.indexOf("?")>-1?"&":"?";if(a.open("GET",""+n+s+"url="+encodeURIComponent(e)+"&responseType="+o),"text"!==o&&a instanceof XMLHttpRequest&&(a.responseType=o),t._options.imageTimeout){var u=t._options.imageTimeout;a.timeout=u,a.ontimeout=function(){return A("Timed out ("+u+"ms) proxying "+r)}}a.send()}))},e}(),Yi=/^data:image\/svg\+xml/i,Wi=/^data:image\/.*;base64,/i,Xi=/^data:image\/.*/i,Ji=function(e){return Sr.SUPPORT_SVG_DRAWING||!$i(e)},zi=function(e){return Xi.test(e)},qi=function(e){return Wi.test(e)},Zi=function(e){return"blob"===e.substr(0,4)},$i=function(e){return"svg"===e.substr(-3).toLowerCase()||Yi.test(e)};!function(e){e[e.VECTOR=0]="VECTOR",e[e.BEZIER_CURVE=1]="BEZIER_CURVE"}(Ui||(Ui={}));var eA,tA=function(e,t){return e.length===t.length&&e.some((function(e,n){return e===t[n]}))},nA=function(){function e(e,t){this.type=Ui.VECTOR,this.x=e,this.y=t}return e.prototype.add=function(t,n){return new e(this.x+t,this.y+n)},e}(),rA=function(e,t,n){return new nA(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},iA=function(){function e(e,t,n,r){this.type=Ui.BEZIER_CURVE,this.start=e,this.startControl=t,this.endControl=n,this.end=r}return e.prototype.subdivide=function(t,n){var r=rA(this.start,this.startControl,t),i=rA(this.startControl,this.endControl,t),A=rA(this.endControl,this.end,t),o=rA(r,i,t),a=rA(i,A,t),s=rA(o,a,t);return n?new e(this.start,r,o,s):new e(s,a,A,this.end)},e.prototype.add=function(t,n){return new e(this.start.add(t,n),this.startControl.add(t,n),this.endControl.add(t,n),this.end.add(t,n))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),AA=function(e){return e.type===Ui.BEZIER_CURVE},oA=function(e){var t=e.styles,n=e.bounds,r=Je(t.borderTopLeftRadius,n.width,n.height),i=r[0],A=r[1],o=Je(t.borderTopRightRadius,n.width,n.height),a=o[0],s=o[1],u=Je(t.borderBottomRightRadius,n.width,n.height),c=u[0],l=u[1],h=Je(t.borderBottomLeftRadius,n.width,n.height),d=h[0],p=h[1],f=[];f.push((i+a)/n.width),f.push((d+c)/n.width),f.push((A+p)/n.height),f.push((s+l)/n.height);var y=Math.max.apply(Math,f);y>1&&(i/=y,A/=y,a/=y,s/=y,c/=y,l/=y,d/=y,p/=y);var g=n.width-a,E=n.height-l,m=n.width-c,B=n.height-p,v=t.borderTopWidth,w=t.borderRightWidth,k=t.borderBottomWidth,C=t.borderLeftWidth,b=ze(t.paddingTop,e.bounds.width),S=ze(t.paddingRight,e.bounds.width),T=ze(t.paddingBottom,e.bounds.width),M=ze(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=i>0||A>0?aA(n.left+C/3,n.top+v/3,i-C/3,A-v/3,eA.TOP_LEFT):new nA(n.left+C/3,n.top+v/3),this.topRightBorderDoubleOuterBox=i>0||A>0?aA(n.left+g,n.top+v/3,a-w/3,s-v/3,eA.TOP_RIGHT):new nA(n.left+n.width-w/3,n.top+v/3),this.bottomRightBorderDoubleOuterBox=c>0||l>0?aA(n.left+m,n.top+E,c-w/3,l-k/3,eA.BOTTOM_RIGHT):new nA(n.left+n.width-w/3,n.top+n.height-k/3),this.bottomLeftBorderDoubleOuterBox=d>0||p>0?aA(n.left+C/3,n.top+B,d-C/3,p-k/3,eA.BOTTOM_LEFT):new nA(n.left+C/3,n.top+n.height-k/3),this.topLeftBorderDoubleInnerBox=i>0||A>0?aA(n.left+2*C/3,n.top+2*v/3,i-2*C/3,A-2*v/3,eA.TOP_LEFT):new nA(n.left+2*C/3,n.top+2*v/3),this.topRightBorderDoubleInnerBox=i>0||A>0?aA(n.left+g,n.top+2*v/3,a-2*w/3,s-2*v/3,eA.TOP_RIGHT):new nA(n.left+n.width-2*w/3,n.top+2*v/3),this.bottomRightBorderDoubleInnerBox=c>0||l>0?aA(n.left+m,n.top+E,c-2*w/3,l-2*k/3,eA.BOTTOM_RIGHT):new nA(n.left+n.width-2*w/3,n.top+n.height-2*k/3),this.bottomLeftBorderDoubleInnerBox=d>0||p>0?aA(n.left+2*C/3,n.top+B,d-2*C/3,p-2*k/3,eA.BOTTOM_LEFT):new nA(n.left+2*C/3,n.top+n.height-2*k/3),this.topLeftBorderStroke=i>0||A>0?aA(n.left+C/2,n.top+v/2,i-C/2,A-v/2,eA.TOP_LEFT):new nA(n.left+C/2,n.top+v/2),this.topRightBorderStroke=i>0||A>0?aA(n.left+g,n.top+v/2,a-w/2,s-v/2,eA.TOP_RIGHT):new nA(n.left+n.width-w/2,n.top+v/2),this.bottomRightBorderStroke=c>0||l>0?aA(n.left+m,n.top+E,c-w/2,l-k/2,eA.BOTTOM_RIGHT):new nA(n.left+n.width-w/2,n.top+n.height-k/2),this.bottomLeftBorderStroke=d>0||p>0?aA(n.left+C/2,n.top+B,d-C/2,p-k/2,eA.BOTTOM_LEFT):new nA(n.left+C/2,n.top+n.height-k/2),this.topLeftBorderBox=i>0||A>0?aA(n.left,n.top,i,A,eA.TOP_LEFT):new nA(n.left,n.top),this.topRightBorderBox=a>0||s>0?aA(n.left+g,n.top,a,s,eA.TOP_RIGHT):new nA(n.left+n.width,n.top),this.bottomRightBorderBox=c>0||l>0?aA(n.left+m,n.top+E,c,l,eA.BOTTOM_RIGHT):new nA(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=d>0||p>0?aA(n.left,n.top+B,d,p,eA.BOTTOM_LEFT):new nA(n.left,n.top+n.height),this.topLeftPaddingBox=i>0||A>0?aA(n.left+C,n.top+v,Math.max(0,i-C),Math.max(0,A-v),eA.TOP_LEFT):new nA(n.left+C,n.top+v),this.topRightPaddingBox=a>0||s>0?aA(n.left+Math.min(g,n.width-w),n.top+v,g>n.width+w?0:Math.max(0,a-w),Math.max(0,s-v),eA.TOP_RIGHT):new nA(n.left+n.width-w,n.top+v),this.bottomRightPaddingBox=c>0||l>0?aA(n.left+Math.min(m,n.width-C),n.top+Math.min(E,n.height-k),Math.max(0,c-w),Math.max(0,l-k),eA.BOTTOM_RIGHT):new nA(n.left+n.width-w,n.top+n.height-k),this.bottomLeftPaddingBox=d>0||p>0?aA(n.left+C,n.top+Math.min(B,n.height-k),Math.max(0,d-C),Math.max(0,p-k),eA.BOTTOM_LEFT):new nA(n.left+C,n.top+n.height-k),this.topLeftContentBox=i>0||A>0?aA(n.left+C+M,n.top+v+b,Math.max(0,i-(C+M)),Math.max(0,A-(v+b)),eA.TOP_LEFT):new nA(n.left+C+M,n.top+v+b),this.topRightContentBox=a>0||s>0?aA(n.left+Math.min(g,n.width+C+M),n.top+v+b,g>n.width+C+M?0:a-C+M,s-(v+b),eA.TOP_RIGHT):new nA(n.left+n.width-(w+S),n.top+v+b),this.bottomRightContentBox=c>0||l>0?aA(n.left+Math.min(m,n.width-(C+M)),n.top+Math.min(E,n.height+v+b),Math.max(0,c-(w+S)),l-(k+T),eA.BOTTOM_RIGHT):new nA(n.left+n.width-(w+S),n.top+n.height-(k+T)),this.bottomLeftContentBox=d>0||p>0?aA(n.left+C+M,n.top+B,Math.max(0,d-(C+M)),p-(k+T),eA.BOTTOM_LEFT):new nA(n.left+C+M,n.top+n.height-(k+T))};!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(eA||(eA={}));var aA=function(e,t,n,r,i){var A=(Math.sqrt(2)-1)/3*4,o=n*A,a=r*A,s=e+n,u=t+r;switch(i){case eA.TOP_LEFT:return new iA(new nA(e,u),new nA(e,u-a),new nA(s-o,t),new nA(s,t));case eA.TOP_RIGHT:return new iA(new nA(e,t),new nA(e+o,t),new nA(s,u-a),new nA(s,u));case eA.BOTTOM_RIGHT:return new iA(new nA(s,t),new nA(s,t+a),new nA(e+o,u),new nA(e,u));case eA.BOTTOM_LEFT:default:return new iA(new nA(s,u),new nA(s-o,u),new nA(e,t+a),new nA(e,t))}},sA=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},uA=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},cA=function(e,t,n){this.type=0,this.target=6,this.offsetX=e,this.offsetY=t,this.matrix=n},lA=function(e,t){this.type=1,this.target=t,this.path=e},hA=function(e){this.type=2,this.target=6,this.opacity=e},dA=function(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},pA=function(){function e(e,t){if(this.container=e,this.effects=t.slice(0),this.curves=new oA(e),e.styles.opacity<1&&this.effects.push(new hA(e.styles.opacity)),null!==e.styles.transform){var n=e.bounds.left+e.styles.transformOrigin[0].number,r=e.bounds.top+e.styles.transformOrigin[1].number,i=e.styles.transform;this.effects.push(new cA(n,r,i))}if(e.styles.overflowX!==mn.VISIBLE){var A=sA(this.curves),o=uA(this.curves);tA(A,o)?this.effects.push(new lA(A,6)):(this.effects.push(new lA(A,2)),this.effects.push(new lA(o,4)))}}return e.prototype.getParentEffects=function(){var e=this.effects.slice(0);if(this.container.styles.overflowX!==mn.VISIBLE){var t=sA(this.curves),n=uA(this.curves);tA(t,n)||e.push(new lA(n,6))}return e},e}(),fA=function(e,t){for(var n=e instanceof Kr?e.start:1,r=e instanceof Kr&&e.reversed,i=0;i<t.length;i++){var A=t[i];A.container instanceof Nr&&"number"==typeof A.container.value&&0!==A.container.value&&(n=A.container.value),A.listValue=Mi(n,A.container.styles.listStyleType,!0),n+=r?-1:1}},yA=function(e){var t=new pA(e,[]),n=new dA(t),r=[];return function e(t,n,r,i){t.container.elements.forEach((function(A){var o=ar(A.flags,4),a=ar(A.flags,2),s=new pA(A,t.getParentEffects());ar(A.styles.display,2048)&&i.push(s);var u=ar(A.flags,8)?[]:i;if(o||a){var c=o||A.styles.isPositioned()?r:n,l=new dA(s);if(A.styles.isPositioned()||A.styles.opacity<1||A.styles.isTransformed()){var h=A.styles.zIndex.order;if(h<0){var d=0;c.negativeZIndex.some((function(e,t){return h>e.element.container.styles.zIndex.order?(d=t,!1):d>0})),c.negativeZIndex.splice(d,0,l)}else if(h>0){var p=0;c.positiveZIndex.some((function(e,t){return h>=e.element.container.styles.zIndex.order?(p=t+1,!1):p>0})),c.positiveZIndex.splice(p,0,l)}else c.zeroOrAutoZIndexOrTransformedOrOpacity.push(l)}else A.styles.isFloating()?c.nonPositionedFloats.push(l):c.nonPositionedInlineLevel.push(l);e(s,l,o?l:r,u)}else A.styles.isInlineLevel()?n.inlineLevel.push(s):n.nonInlineLevel.push(s),e(s,n,r,u);ar(A.flags,8)&&fA(A,u)}))}(t,n,n,r),fA(t.container,r),n},gA=function(e,t){switch(t){case 0:return mA(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return mA(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return mA(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);case 3:default:return mA(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},EA=function(e,t){var n=[];return AA(e)?n.push(e.subdivide(.5,!1)):n.push(e),AA(t)?n.push(t.subdivide(.5,!0)):n.push(t),n},mA=function(e,t,n,r){var i=[];return AA(e)?i.push(e.subdivide(.5,!1)):i.push(e),AA(n)?i.push(n.subdivide(.5,!0)):i.push(n),AA(r)?i.push(r.subdivide(.5,!0).reverse()):i.push(r),AA(t)?i.push(t.subdivide(.5,!1).reverse()):i.push(t),i},BA=function(e){var t=e.bounds,n=e.styles;return t.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},vA=function(e){var t=e.styles,n=e.bounds,r=ze(t.paddingLeft,n.width),i=ze(t.paddingRight,n.width),A=ze(t.paddingTop,n.width),o=ze(t.paddingBottom,n.width);return n.add(r+t.borderLeftWidth,A+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+r+i),-(t.borderTopWidth+t.borderBottomWidth+A+o))},wA=function(e,t,n){var r=function(e,t){return 0===e?t.bounds:2===e?vA(t):BA(t)}(SA(e.styles.backgroundOrigin,t),e),i=function(e,t){return e===ut.BORDER_BOX?t.bounds:e===ut.CONTENT_BOX?vA(t):BA(t)}(SA(e.styles.backgroundClip,t),e),A=bA(SA(e.styles.backgroundSize,t),n,r),o=A[0],a=A[1],s=Je(SA(e.styles.backgroundPosition,t),r.width-o,r.height-a);return[TA(SA(e.styles.backgroundRepeat,t),s,A,r,i),Math.round(r.left+s[0]),Math.round(r.top+s[1]),o,a]},kA=function(e){return _e(e)&&e.value===Lt.AUTO},CA=function(e){return"number"==typeof e},bA=function(e,t,n){var r=t[0],i=t[1],A=t[2],o=e[0],a=e[1];if(!o)return[0,0];if(Ge(o)&&a&&Ge(a))return[ze(o,n.width),ze(a,n.height)];var s=CA(A);if(_e(o)&&(o.value===Lt.CONTAIN||o.value===Lt.COVER))return CA(A)?n.width/n.height<A!=(o.value===Lt.COVER)?[n.width,n.width/A]:[n.height*A,n.height]:[n.width,n.height];var u=CA(r),c=CA(i),l=u||c;if(kA(o)&&(!a||kA(a)))return u&&c?[r,i]:s||l?l&&s?[u?r:i*A,c?i:r/A]:[u?r:n.width,c?i:n.height]:[n.width,n.height];if(s){var h=0,d=0;return Ge(o)?h=ze(o,n.width):Ge(a)&&(d=ze(a,n.height)),kA(o)?h=d*A:a&&!kA(a)||(d=h/A),[h,d]}var p=null,f=null;if(Ge(o)?p=ze(o,n.width):a&&Ge(a)&&(f=ze(a,n.height)),null===p||a&&!kA(a)||(f=u&&c?p/r*i:n.height),null!==f&&kA(o)&&(p=u&&c?f/i*r:n.width),null!==p&&null!==f)return[p,f];throw new Error("Unable to calculate background-size for element")},SA=function(e,t){var n=e[t];return void 0===n?e[0]:n},TA=function(e,t,n,r,i){var A=t[0],o=t[1],a=n[0],s=n[1];switch(e){case St.REPEAT_X:return[new nA(Math.round(r.left),Math.round(r.top+o)),new nA(Math.round(r.left+r.width),Math.round(r.top+o)),new nA(Math.round(r.left+r.width),Math.round(s+r.top+o)),new nA(Math.round(r.left),Math.round(s+r.top+o))];case St.REPEAT_Y:return[new nA(Math.round(r.left+A),Math.round(r.top)),new nA(Math.round(r.left+A+a),Math.round(r.top)),new nA(Math.round(r.left+A+a),Math.round(r.height+r.top)),new nA(Math.round(r.left+A),Math.round(r.height+r.top))];case St.NO_REPEAT:return[new nA(Math.round(r.left+A),Math.round(r.top+o)),new nA(Math.round(r.left+A+a),Math.round(r.top+o)),new nA(Math.round(r.left+A+a),Math.round(r.top+o+s)),new nA(Math.round(r.left+A),Math.round(r.top+o+s))];default:return[new nA(Math.round(i.left),Math.round(i.top)),new nA(Math.round(i.left+i.width),Math.round(i.top)),new nA(Math.round(i.left+i.width),Math.round(i.height+i.top)),new nA(Math.round(i.left),Math.round(i.height+i.top))]}},MA=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var n=this._document.createElement("div"),r=this._document.createElement("img"),i=this._document.createElement("span"),A=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",A.appendChild(n),r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",i.style.fontFamily=e,i.style.fontSize=t,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode("Hidden Text")),n.appendChild(i),n.appendChild(r);var o=r.offsetTop-i.offsetTop+2;n.removeChild(i),n.appendChild(this._document.createTextNode("Hidden Text")),n.style.lineHeight="normal",r.style.verticalAlign="super";var a=r.offsetTop-n.offsetTop+2;return A.removeChild(n),{baseline:o,middle:a}},e.prototype.getMetrics=function(e,t){var n=e+" "+t;return void 0===this._data[n]&&(this._data[n]=this.parseMetrics(e,t)),this._data[n]},e}(),xA=function(e,t){this.context=e,this.options=t},UA=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r._activeEffects=[],r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),n.canvas||(r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px"),r.fontMetrics=new MA(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),r}return t(n,e),n.prototype.applyEffects=function(e,t){for(var n=this;this._activeEffects.length;)this.popEffect();e.filter((function(e){return ar(e.target,t)})).forEach((function(e){return n.applyEffect(e)}))},n.prototype.applyEffect=function(e){this.ctx.save(),function(e){return 2===e.type}(e)&&(this.ctx.globalAlpha=e.opacity),function(e){return 0===e.type}(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),function(e){return 1===e.type}(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},n.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},n.prototype.renderStack=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},n.prototype.renderNode=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},n.prototype.renderTextWithLetterSpacing=function(e,t,n){var r=this;0===t?this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+n):u(e.text).map((function(e){return c(e)})).reduce((function(t,i){return r.ctx.fillText(i,t,e.bounds.top+n),t+r.ctx.measureText(i).width}),e.bounds.left)},n.prototype.createFontStyle=function(e){var t=e.fontVariant.filter((function(e){return"normal"===e||"small-caps"===e})).join(""),n=e.fontFamily.join(", "),r=Re(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,r,n].join(" "),n,r]},n.prototype.renderTextNode=function(e,t){return r(this,void 0,void 0,(function(){var n,r,A,o,a,s,u,c,l=this;return i(this,(function(i){return n=this.createFontStyle(t),r=n[0],A=n[1],o=n[2],this.ctx.font=r,this.ctx.textBaseline="alphabetic",a=this.fontMetrics.getMetrics(A,o),s=a.baseline,u=a.middle,c=t.paintOrder,e.textBounds.forEach((function(e){c.forEach((function(n){switch(n){case Ar.FILL:l.ctx.fillStyle=rt(t.color),l.renderTextWithLetterSpacing(e,t.letterSpacing,s);var r=t.textShadow;r.length&&e.text.trim().length&&(r.slice(0).reverse().forEach((function(n){l.ctx.shadowColor=rt(n.color),l.ctx.shadowOffsetX=n.offsetX.number*l.options.scale,l.ctx.shadowOffsetY=n.offsetY.number*l.options.scale,l.ctx.shadowBlur=n.blur.number,l.renderTextWithLetterSpacing(e,t.letterSpacing,s)})),l.ctx.shadowColor="",l.ctx.shadowOffsetX=0,l.ctx.shadowOffsetY=0,l.ctx.shadowBlur=0),t.textDecorationLine.length&&(l.ctx.fillStyle=rt(t.textDecorationColor||t.color),t.textDecorationLine.forEach((function(t){switch(t){case 1:l.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+s),e.bounds.width,1);break;case 2:l.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:l.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+u),e.bounds.width,1)}})));break;case Ar.STROKE:t.webkitTextStrokeWidth&&e.text.trim().length&&(l.ctx.strokeStyle=rt(t.webkitTextStrokeColor),l.ctx.lineWidth=t.webkitTextStrokeWidth,l.ctx.lineJoin=window.chrome?"miter":"round",l.ctx.strokeText(e.text,e.bounds.left,e.bounds.top+s)),l.ctx.strokeStyle="",l.ctx.lineWidth=0,l.ctx.lineJoin="miter"}}))})),[2]}))}))},n.prototype.renderReplacedElement=function(e,t,n){if(n&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var r=vA(e),i=uA(t);this.path(i),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,e.intrinsicWidth,e.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore()}},n.prototype.renderNodeContent=function(e){return r(this,void 0,void 0,(function(){var t,r,A,o,s,u,c,l,h,d,p,f,y,g,E,m,B,v;return i(this,(function(i){switch(i.label){case 0:this.applyEffects(e.effects,4),t=e.container,r=e.curves,A=t.styles,o=0,s=t.textNodes,i.label=1;case 1:return o<s.length?(u=s[o],[4,this.renderTextNode(u,A)]):[3,4];case 2:i.sent(),i.label=3;case 3:return o++,[3,1];case 4:if(!(t instanceof Or))return[3,8];i.label=5;case 5:return i.trys.push([5,7,,8]),[4,this.context.cache.match(t.src)];case 6:return E=i.sent(),this.renderReplacedElement(t,r,E),[3,8];case 7:return i.sent(),this.context.logger.error("Error loading image "+t.src),[3,8];case 8:if(t instanceof Ir&&this.renderReplacedElement(t,r,t.canvas),!(t instanceof Pr))return[3,12];i.label=9;case 9:return i.trys.push([9,11,,12]),[4,this.context.cache.match(t.svg)];case 10:return E=i.sent(),this.renderReplacedElement(t,r,E),[3,12];case 11:return i.sent(),this.context.logger.error("Error loading svg "+t.svg.substring(0,255)),[3,12];case 12:return t instanceof Jr&&t.tree?[4,new n(this.context,{scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,width:t.width,height:t.height}).render(t.tree)]:[3,14];case 13:c=i.sent(),t.width&&t.height&&this.ctx.drawImage(c,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height),i.label=14;case 14:if(t instanceof Yr&&(l=Math.min(t.bounds.width,t.bounds.height),"checkbox"===t.type?t.checked&&(this.ctx.save(),this.path([new nA(t.bounds.left+.39363*l,t.bounds.top+.79*l),new nA(t.bounds.left+.16*l,t.bounds.top+.5549*l),new nA(t.bounds.left+.27347*l,t.bounds.top+.44071*l),new nA(t.bounds.left+.39694*l,t.bounds.top+.5649*l),new nA(t.bounds.left+.72983*l,t.bounds.top+.23*l),new nA(t.bounds.left+.84*l,t.bounds.top+.34085*l),new nA(t.bounds.left+.39363*l,t.bounds.top+.79*l)]),this.ctx.fillStyle=rt(707406591),this.ctx.fill(),this.ctx.restore()):"radio"===t.type&&t.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.bounds.left+l/2,t.bounds.top+l/2,l/4,0,2*Math.PI,!0),this.ctx.fillStyle=rt(707406591),this.ctx.fill(),this.ctx.restore())),QA(t)&&t.value.length){switch(h=this.createFontStyle(A),B=h[0],d=h[1],p=this.fontMetrics.getMetrics(B,d).baseline,this.ctx.font=B,this.ctx.fillStyle=rt(A.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=FA(t.styles.textAlign),v=vA(t),f=0,t.styles.textAlign){case Mn.CENTER:f+=v.width/2;break;case Mn.RIGHT:f+=v.width}y=v.add(f,0,0,-v.height/2+1),this.ctx.save(),this.path([new nA(v.left,v.top),new nA(v.left+v.width,v.top),new nA(v.left+v.width,v.top+v.height),new nA(v.left,v.top+v.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Tr(t.value,y),A.letterSpacing,p),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!ar(t.styles.display,2048))return[3,20];if(null===t.styles.listStyleImage)return[3,19];if((g=t.styles.listStyleImage).type!==pt.URL)return[3,18];E=void 0,m=g.url,i.label=15;case 15:return i.trys.push([15,17,,18]),[4,this.context.cache.match(m)];case 16:return E=i.sent(),this.ctx.drawImage(E,t.bounds.left-(E.width+10),t.bounds.top),[3,18];case 17:return i.sent(),this.context.logger.error("Error loading list-style-image "+m),[3,18];case 18:return[3,20];case 19:e.listValue&&t.styles.listStyleType!==gn.NONE&&(B=this.createFontStyle(A)[0],this.ctx.font=B,this.ctx.fillStyle=rt(A.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",v=new a(t.bounds.left,t.bounds.top+ze(t.styles.paddingTop,t.bounds.width),t.bounds.width,fn(A.lineHeight,A.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Tr(e.listValue,v),A.letterSpacing,fn(A.lineHeight,A.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),i.label=20;case 20:return[2]}}))}))},n.prototype.renderStackContent=function(e){return r(this,void 0,void 0,(function(){var t,n,r,A,o,a,s,u,c,l,h,d,p,f,y;return i(this,(function(i){switch(i.label){case 0:return[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:i.sent(),t=0,n=e.negativeZIndex,i.label=2;case 2:return t<n.length?(y=n[t],[4,this.renderStack(y)]):[3,5];case 3:i.sent(),i.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:i.sent(),r=0,A=e.nonInlineLevel,i.label=7;case 7:return r<A.length?(y=A[r],[4,this.renderNode(y)]):[3,10];case 8:i.sent(),i.label=9;case 9:return r++,[3,7];case 10:o=0,a=e.nonPositionedFloats,i.label=11;case 11:return o<a.length?(y=a[o],[4,this.renderStack(y)]):[3,14];case 12:i.sent(),i.label=13;case 13:return o++,[3,11];case 14:s=0,u=e.nonPositionedInlineLevel,i.label=15;case 15:return s<u.length?(y=u[s],[4,this.renderStack(y)]):[3,18];case 16:i.sent(),i.label=17;case 17:return s++,[3,15];case 18:c=0,l=e.inlineLevel,i.label=19;case 19:return c<l.length?(y=l[c],[4,this.renderNode(y)]):[3,22];case 20:i.sent(),i.label=21;case 21:return c++,[3,19];case 22:h=0,d=e.zeroOrAutoZIndexOrTransformedOrOpacity,i.label=23;case 23:return h<d.length?(y=d[h],[4,this.renderStack(y)]):[3,26];case 24:i.sent(),i.label=25;case 25:return h++,[3,23];case 26:p=0,f=e.positiveZIndex,i.label=27;case 27:return p<f.length?(y=f[p],[4,this.renderStack(y)]):[3,30];case 28:i.sent(),i.label=29;case 29:return p++,[3,27];case 30:return[2]}}))}))},n.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},n.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},n.prototype.formatPath=function(e){var t=this;e.forEach((function(e,n){var r=AA(e)?e.start:e;0===n?t.ctx.moveTo(r.x,r.y):t.ctx.lineTo(r.x,r.y),AA(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)}))},n.prototype.renderRepeat=function(e,t,n,r){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(n,r),this.ctx.fill(),this.ctx.translate(-n,-r)},n.prototype.resizeImage=function(e,t,n){var r;if(e.width===t&&e.height===n)return e;var i=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return i.width=Math.max(1,t),i.height=Math.max(1,n),i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,n),i},n.prototype.renderBackgroundImage=function(e){return r(this,void 0,void 0,(function(){var t,n,r,A,o,a;return i(this,(function(s){switch(s.label){case 0:t=e.styles.backgroundImage.length-1,n=function(n){var A,o,a,s,u,c,l,h,d,p,f,y,g,E,m,B,v,w,k,C,b,S,T,M,x,U,Q,L,F,R,H;return i(this,(function(i){switch(i.label){case 0:if(n.type!==pt.URL)return[3,5];A=void 0,o=n.url,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,r.context.cache.match(o)];case 2:return A=i.sent(),[3,4];case 3:return i.sent(),r.context.logger.error("Error loading background-image "+o),[3,4];case 4:return A&&(a=wA(e,t,[A.width,A.height,A.width/A.height]),B=a[0],S=a[1],T=a[2],k=a[3],C=a[4],E=r.ctx.createPattern(r.resizeImage(A,k,C),"repeat"),r.renderRepeat(B,E,S,T)),[3,6];case 5:n.type===pt.LINEAR_GRADIENT?(s=wA(e,t,[null,null,null]),B=s[0],S=s[1],T=s[2],k=s[3],C=s[4],u=vt(n.angle,k,C),c=u[0],l=u[1],h=u[2],d=u[3],p=u[4],(f=document.createElement("canvas")).width=k,f.height=C,y=f.getContext("2d"),g=y.createLinearGradient(l,d,h,p),Bt(n.stops,c).forEach((function(e){return g.addColorStop(e.stop,rt(e.color))})),y.fillStyle=g,y.fillRect(0,0,k,C),k>0&&C>0&&(E=r.ctx.createPattern(f,"repeat"),r.renderRepeat(B,E,S,T))):function(e){return e.type===pt.RADIAL_GRADIENT}(n)&&(m=wA(e,t,[null,null,null]),B=m[0],v=m[1],w=m[2],k=m[3],C=m[4],b=0===n.position.length?[We]:n.position,S=ze(b[0],k),T=ze(b[b.length-1],C),M=function(e,t,n,r,i){var A=0,o=0;switch(e.size){case yt.CLOSEST_SIDE:e.shape===ft.CIRCLE?A=o=Math.min(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-i)):e.shape===ft.ELLIPSE&&(A=Math.min(Math.abs(t),Math.abs(t-r)),o=Math.min(Math.abs(n),Math.abs(n-i)));break;case yt.CLOSEST_CORNER:if(e.shape===ft.CIRCLE)A=o=Math.min(wt(t,n),wt(t,n-i),wt(t-r,n),wt(t-r,n-i));else if(e.shape===ft.ELLIPSE){var a=Math.min(Math.abs(n),Math.abs(n-i))/Math.min(Math.abs(t),Math.abs(t-r)),s=kt(r,i,t,n,!0),u=s[0],c=s[1];o=a*(A=wt(u-t,(c-n)/a))}break;case yt.FARTHEST_SIDE:e.shape===ft.CIRCLE?A=o=Math.max(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-i)):e.shape===ft.ELLIPSE&&(A=Math.max(Math.abs(t),Math.abs(t-r)),o=Math.max(Math.abs(n),Math.abs(n-i)));break;case yt.FARTHEST_CORNER:if(e.shape===ft.CIRCLE)A=o=Math.max(wt(t,n),wt(t,n-i),wt(t-r,n),wt(t-r,n-i));else if(e.shape===ft.ELLIPSE){a=Math.max(Math.abs(n),Math.abs(n-i))/Math.max(Math.abs(t),Math.abs(t-r));var l=kt(r,i,t,n,!1);u=l[0],c=l[1],o=a*(A=wt(u-t,(c-n)/a))}}return Array.isArray(e.size)&&(A=ze(e.size[0],r),o=2===e.size.length?ze(e.size[1],i):A),[A,o]}(n,S,T,k,C),x=M[0],U=M[1],x>0&&U>0&&(Q=r.ctx.createRadialGradient(v+S,w+T,0,v+S,w+T,x),Bt(n.stops,2*x).forEach((function(e){return Q.addColorStop(e.stop,rt(e.color))})),r.path(B),r.ctx.fillStyle=Q,x!==U?(L=e.bounds.left+.5*e.bounds.width,F=e.bounds.top+.5*e.bounds.height,H=1/(R=U/x),r.ctx.save(),r.ctx.translate(L,F),r.ctx.transform(1,0,0,R,0,0),r.ctx.translate(-L,-F),r.ctx.fillRect(v,H*(w-F)+F,k,C*H),r.ctx.restore()):r.ctx.fill())),i.label=6;case 6:return t--,[2]}}))},r=this,A=0,o=e.styles.backgroundImage.slice(0).reverse(),s.label=1;case 1:return A<o.length?(a=o[A],[5,n(a)]):[3,4];case 2:s.sent(),s.label=3;case 3:return A++,[3,1];case 4:return[2]}}))}))},n.prototype.renderSolidBorder=function(e,t,n){return r(this,void 0,void 0,(function(){return i(this,(function(r){return this.path(gA(n,t)),this.ctx.fillStyle=rt(e),this.ctx.fill(),[2]}))}))},n.prototype.renderDoubleBorder=function(e,t,n,A){return r(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return t<3?[4,this.renderSolidBorder(e,n,A)]:[3,2];case 1:return i.sent(),[2];case 2:return r=function(e,t){switch(t){case 0:return mA(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return mA(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return mA(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);case 3:default:return mA(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}}(A,n),this.path(r),this.ctx.fillStyle=rt(e),this.ctx.fill(),o=function(e,t){switch(t){case 0:return mA(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return mA(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return mA(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);case 3:default:return mA(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}}(A,n),this.path(o),this.ctx.fill(),[2]}}))}))},n.prototype.renderNodeBackgroundAndBorders=function(e){return r(this,void 0,void 0,(function(){var t,n,r,A,o,a,s,u,c=this;return i(this,(function(i){switch(i.label){case 0:return this.applyEffects(e.effects,2),t=e.container.styles,n=!nt(t.backgroundColor)||t.backgroundImage.length,r=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],A=LA(SA(t.backgroundClip,0),e.curves),n||t.boxShadow.length?(this.ctx.save(),this.path(A),this.ctx.clip(),nt(t.backgroundColor)||(this.ctx.fillStyle=rt(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:i.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach((function(t){c.ctx.save();var n,r,i,A,o,a=sA(e.curves),s=t.inset?0:1e4,u=(n=a,r=-s+(t.inset?1:-1)*t.spread.number,i=(t.inset?1:-1)*t.spread.number,A=t.spread.number*(t.inset?-2:2),o=t.spread.number*(t.inset?-2:2),n.map((function(e,t){switch(t){case 0:return e.add(r,i);case 1:return e.add(r+A,i);case 2:return e.add(r+A,i+o);case 3:return e.add(r,i+o)}return e})));t.inset?(c.path(a),c.ctx.clip(),c.mask(u)):(c.mask(a),c.ctx.clip(),c.path(u)),c.ctx.shadowOffsetX=t.offsetX.number+s,c.ctx.shadowOffsetY=t.offsetY.number,c.ctx.shadowColor=rt(t.color),c.ctx.shadowBlur=t.blur.number,c.ctx.fillStyle=t.inset?rt(t.color):"rgba(0,0,0,1)",c.ctx.fill(),c.ctx.restore()})),i.label=2;case 2:o=0,a=0,s=r,i.label=3;case 3:return a<s.length?(u=s[a]).style!==Ht.NONE&&!nt(u.color)&&u.width>0?u.style!==Ht.DASHED?[3,5]:[4,this.renderDashedDottedBorder(u.color,u.width,o,e.curves,Ht.DASHED)]:[3,11]:[3,13];case 4:return i.sent(),[3,11];case 5:return u.style!==Ht.DOTTED?[3,7]:[4,this.renderDashedDottedBorder(u.color,u.width,o,e.curves,Ht.DOTTED)];case 6:return i.sent(),[3,11];case 7:return u.style!==Ht.DOUBLE?[3,9]:[4,this.renderDoubleBorder(u.color,u.width,o,e.curves)];case 8:return i.sent(),[3,11];case 9:return[4,this.renderSolidBorder(u.color,o,e.curves)];case 10:i.sent(),i.label=11;case 11:o++,i.label=12;case 12:return a++,[3,3];case 13:return[2]}}))}))},n.prototype.renderDashedDottedBorder=function(e,t,n,A,o){return r(this,void 0,void 0,(function(){var r,a,s,u,c,l,h,d,p,f,y,g,E,m,B,v;return i(this,(function(i){return this.ctx.save(),r=function(e,t){switch(t){case 0:return EA(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return EA(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return EA(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);case 3:default:return EA(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}}(A,n),a=gA(A,n),o===Ht.DASHED&&(this.path(a),this.ctx.clip()),AA(a[0])?(s=a[0].start.x,u=a[0].start.y):(s=a[0].x,u=a[0].y),AA(a[1])?(c=a[1].end.x,l=a[1].end.y):(c=a[1].x,l=a[1].y),h=0===n||2===n?Math.abs(s-c):Math.abs(u-l),this.ctx.beginPath(),o===Ht.DOTTED?this.formatPath(r):this.formatPath(a.slice(0,2)),d=t<3?3*t:2*t,p=t<3?2*t:t,o===Ht.DOTTED&&(d=t,p=t),f=!0,h<=2*d?f=!1:h<=2*d+p?(d*=y=h/(2*d+p),p*=y):(g=Math.floor((h+p)/(d+p)),E=(h-g*d)/(g-1),p=(m=(h-(g+1)*d)/g)<=0||Math.abs(p-E)<Math.abs(p-m)?E:m),f&&(o===Ht.DOTTED?this.ctx.setLineDash([0,d+p]):this.ctx.setLineDash([d,p])),o===Ht.DOTTED?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=rt(e),this.ctx.stroke(),this.ctx.setLineDash([]),o===Ht.DASHED&&(AA(a[0])&&(B=a[3],v=a[0],this.ctx.beginPath(),this.formatPath([new nA(B.end.x,B.end.y),new nA(v.start.x,v.start.y)]),this.ctx.stroke()),AA(a[1])&&(B=a[1],v=a[2],this.ctx.beginPath(),this.formatPath([new nA(B.end.x,B.end.y),new nA(v.start.x,v.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},n.prototype.render=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=rt(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=yA(e),[4,this.renderStack(t)];case 1:return n.sent(),this.applyEffects([],2),[2,this.canvas]}}))}))},n}(xA),QA=function(e){return e instanceof Xr||e instanceof Wr||e instanceof Yr&&"radio"!==e.type&&"checkbox"!==e.type},LA=function(e,t){switch(e){case ut.BORDER_BOX:return sA(t);case ut.CONTENT_BOX:return function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]}(t);case ut.PADDING_BOX:default:return uA(t)}},FA=function(e){switch(e){case Mn.CENTER:return"center";case Mn.RIGHT:return"right";case Mn.LEFT:default:return"left"}},RA=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=n,r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),r}return t(n,e),n.prototype.render=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t=Cr(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,HA(t)];case 1:return n=r.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=rt(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},n}(xA),HA=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},_A=function(){function e(e){var t=e.id,n=e.enabled;this.id=t,this.enabled=n,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,A([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,A([this.id,this.getTime()+"ms"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,A([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,A([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.instances={},e}(),DA=function(){function e(t,n){var r;this.windowBounds=n,this.instanceName="#"+e.instanceCount++,this.logger=new _A({id:this.instanceName,enabled:t.logging}),this.cache=null!==(r=t.cache)&&void 0!==r?r:new ji(this,t)}return e.instanceCount=1,e}();"undefined"!=typeof window&&Gi.setContext(window);var OA=function(e,t){return r(void 0,void 0,void 0,(function(){var r,A,u,c,l,h,d,p,f,y,g,E,m,B,v,w,k,C,b,S,T,M,x,U,Q,L,F,R,H,_,D,O,I,P,N,K,V;return i(this,(function(i){switch(i.label){case 0:if(!e||"object"!==o(e))return[2,Promise.reject("Invalid element provided as first argument")];if(!(r=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(A=r.defaultView))throw new Error("Document is not attached to a Window");return u={allowTaint:null!==(M=t.allowTaint)&&void 0!==M&&M,imageTimeout:null!==(x=t.imageTimeout)&&void 0!==x?x:15e3,proxy:t.proxy,useCORS:null!==(U=t.useCORS)&&void 0!==U&&U},c=n({logging:null===(Q=t.logging)||void 0===Q||Q,cache:t.cache},u),l={windowWidth:null!==(L=t.windowWidth)&&void 0!==L?L:A.innerWidth,windowHeight:null!==(F=t.windowHeight)&&void 0!==F?F:A.innerHeight,scrollX:null!==(R=t.scrollX)&&void 0!==R?R:A.pageXOffset,scrollY:null!==(H=t.scrollY)&&void 0!==H?H:A.pageYOffset},h=new a(l.scrollX,l.scrollY,l.windowWidth,l.windowHeight),d=new DA(c,h),p=null!==(_=t.foreignObjectRendering)&&void 0!==_&&_,f={onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:p,copyStyles:p},d.logger.debug("Starting document clone with size "+h.width+"x"+h.height+" scrolled to "+-h.left+","+-h.top),y=new xi(d,e,f),(g=y.clonedReferenceElement)?[4,y.toIFrame(r,h)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return E=i.sent(),m=ui(g)||"HTML"===g.tagName?function(e){var t=e.body,n=e.documentElement;if(!t||!n)throw new Error("Unable to get document size");var r=Math.max(Math.max(t.scrollWidth,n.scrollWidth),Math.max(t.offsetWidth,n.offsetWidth),Math.max(t.clientWidth,n.clientWidth)),i=Math.max(Math.max(t.scrollHeight,n.scrollHeight),Math.max(t.offsetHeight,n.offsetHeight),Math.max(t.clientHeight,n.clientHeight));return new a(0,0,r,i)}(g.ownerDocument):s(d,g),B=m.width,v=m.height,w=m.left,k=m.top,C=IA(d,g,t.backgroundColor),b={canvas:t.canvas,backgroundColor:C,scale:null!==(O=null!==(D=t.scale)&&void 0!==D?D:A.devicePixelRatio)&&void 0!==O?O:1,x:(null!==(I=t.x)&&void 0!==I?I:0)+w,y:(null!==(P=t.y)&&void 0!==P?P:0)+k,width:null!==(N=t.width)&&void 0!==N?N:Math.ceil(B),height:null!==(K=t.height)&&void 0!==K?K:Math.ceil(v)},p?(d.logger.debug("Document cloned, using foreign object rendering"),[4,new RA(d,b).render(g)]):[3,3];case 2:return S=i.sent(),[3,5];case 3:return d.logger.debug("Document cloned, element located at "+w+","+k+" with size "+B+"x"+v+" using computed rendering"),d.logger.debug("Starting DOM parsing"),T=Zr(d,g),C===T.styles.backgroundColor&&(T.styles.backgroundColor=dt.TRANSPARENT),d.logger.debug("Starting renderer for element at "+b.x+","+b.y+" with size "+b.width+"x"+b.height),[4,new UA(d,b).render(T)];case 4:S=i.sent(),i.label=5;case 5:return(null===(V=t.removeContainer)||void 0===V||V)&&(xi.destroy(E)||d.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),d.logger.debug("Finished rendering"),[2,S]}}))}))},IA=function(e,t,n){var r=t.ownerDocument,i=r.documentElement?ht(e,getComputedStyle(r.documentElement).backgroundColor):dt.TRANSPARENT,A=r.body?ht(e,getComputedStyle(r.body).backgroundColor):dt.TRANSPARENT,o="string"==typeof n?ht(e,n):null===n?dt.TRANSPARENT:4294967295;return t===r.documentElement?nt(i)?nt(A)?o:A:i:o};return function(e,t){return void 0===t&&(t={}),OA(e,t)}},"object"===o(t)&&void 0!==e?e.exports=A():void 0===(i="function"==typeof(r=A)?r.call(t,n,t,e):r)||(e.exports=i)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){var r=n(610);e.exports=function(e){return r(e,5)}},function(e,t,n){var r=n(79),i=n(637),A=n(116),o=n(639),a=n(646),s=n(649),u=n(650),c=n(651),l=n(653),h=n(126),d=n(654),p=n(68),f=n(659),y=n(660),g=n(665),E=n(31),m=n(83),B=n(667),v=n(9),w=n(669),k=n(46),C=n(91),b={};b["[object Arguments]"]=b["[object Array]"]=b["[object ArrayBuffer]"]=b["[object DataView]"]=b["[object Boolean]"]=b["[object Date]"]=b["[object Float32Array]"]=b["[object Float64Array]"]=b["[object Int8Array]"]=b["[object Int16Array]"]=b["[object Int32Array]"]=b["[object Map]"]=b["[object Number]"]=b["[object Object]"]=b["[object RegExp]"]=b["[object Set]"]=b["[object String]"]=b["[object Symbol]"]=b["[object Uint8Array]"]=b["[object Uint8ClampedArray]"]=b["[object Uint16Array]"]=b["[object Uint32Array]"]=!0,b["[object Error]"]=b["[object Function]"]=b["[object WeakMap]"]=!1,e.exports=function e(t,n,S,T,M,x){var U,Q=1&n,L=2&n,F=4&n;if(S&&(U=M?S(t,T,M,x):S(t)),void 0!==U)return U;if(!v(t))return t;var R=E(t);if(R){if(U=f(t),!Q)return u(t,U)}else{var H=p(t),_="[object Function]"==H||"[object GeneratorFunction]"==H;if(m(t))return s(t,Q);if("[object Object]"==H||"[object Arguments]"==H||_&&!M){if(U=L||_?{}:g(t),!Q)return L?l(t,a(U,t)):c(t,o(U,t))}else{if(!b[H])return M?t:{};U=y(t,H,Q)}}x||(x=new r);var D=x.get(t);if(D)return D;x.set(t,U),w(t)?t.forEach((function(r){U.add(e(r,n,S,r,t,x))})):B(t)&&t.forEach((function(r,i){U.set(i,e(r,n,S,i,t,x))}));var O=R?void 0:(F?L?d:h:L?C:k)(t);return i(O||t,(function(r,i){O&&(r=t[i=r]),A(U,i,e(r,n,S,i,t,x))})),U}},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var r=n(64),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0)&&(n==t.length-1?t.pop():i.call(t,n,1),--this.size,!0)}},function(e,t,n){var r=n(64);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var r=n(64);e.exports=function(e){return r(this.__data__,e)>-1}},function(e,t,n){var r=n(64);e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},function(e,t,n){var r=n(63);e.exports=function(){this.__data__=new r,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var r=n(63),i=n(81),A=n(82);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var o=n.__data__;if(!i||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new A(o)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var r=n(114),i=n(622),A=n(9),o=n(115),a=/^\[object .+?Constructor\]$/,s=Function.prototype,u=Object.prototype,c=s.toString,l=u.hasOwnProperty,h=RegExp("^"+c.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!A(e)||i(e))&&(r(e)?h:a).test(o(e))}},function(e,t,n){var r,i=n(623),A=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!A&&A in e}},function(e,t,n){var r=n(10)["__core-js_shared__"];e.exports=r},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var r=n(626),i=n(63),A=n(81);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(A||i),string:new r}}},function(e,t,n){var r=n(627),i=n(628),A=n(629),o=n(630),a=n(631);function s(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}s.prototype.clear=r,s.prototype.delete=i,s.prototype.get=A,s.prototype.has=o,s.prototype.set=a,e.exports=s},function(e,t,n){var r=n(65);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var r=n(65),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(t,e)?t[e]:void 0}},function(e,t,n){var r=n(65),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:i.call(t,e)}},function(e,t,n){var r=n(65);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,n){var r=n(66);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var r=n(66);e.exports=function(e){return r(this,e).get(e)}},function(e,t,n){var r=n(66);e.exports=function(e){return r(this,e).has(e)}},function(e,t,n){var r=n(66);e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}},function(e,t,n){var r=n(40),i=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},function(e,t,n){var r=n(67),i=n(46);e.exports=function(e,t){return e&&r(t,i(t),e)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},function(e,t,n){var r=n(15),i=n(14);e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},function(e,t){e.exports=function(){return!1}},function(e,t,n){var r=n(15),i=n(86),A=n(14),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,e.exports=function(e){return A(e)&&i(e.length)&&!!o[r(e)]}},function(e,t,n){var r=n(89),i=n(645),A=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var n in Object(e))A.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t,n){var r=n(121)(Object.keys,Object);e.exports=r},function(e,t,n){var r=n(67),i=n(91);e.exports=function(e,t){return e&&r(t,i(t),e)}},function(e,t,n){var r=n(9),i=n(89),A=n(648),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return A(e);var t=i(e),n=[];for(var a in e)("constructor"!=a||!t&&o.call(e,a))&&n.push(a);return n}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},function(e,t,n){(function(e){var r=n(10),i=t&&!t.nodeType&&t,A=i&&"object"==typeof e&&e&&!e.nodeType&&e,o=A&&A.exports===i?r.Buffer:void 0,a=o?o.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=a?a(n):new e.constructor(n);return e.copy(r),r}}).call(this,n(84)(e))},function(e,t){e.exports=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}},function(e,t,n){var r=n(67),i=n(92);e.exports=function(e,t){return r(e,i(e),t)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,A=[];++n<r;){var o=e[n];t(o,n,e)&&(A[i++]=o)}return A}},function(e,t,n){var r=n(67),i=n(123);e.exports=function(e,t){return r(e,i(e),t)}},function(e,t,n){var r=n(127),i=n(123),A=n(91);e.exports=function(e){return r(e,A,i)}},function(e,t,n){var r=n(40)(n(10),"DataView");e.exports=r},function(e,t,n){var r=n(40)(n(10),"Promise");e.exports=r},function(e,t,n){var r=n(40)(n(10),"Set");e.exports=r},function(e,t,n){var r=n(40)(n(10),"WeakMap");e.exports=r},function(e,t){var n=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,r=new e.constructor(t);return t&&"string"==typeof e[0]&&n.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},function(e,t,n){var r=n(93),i=n(661),A=n(662),o=n(663),a=n(664);e.exports=function(e,t,n){var s=e.constructor;switch(t){case"[object ArrayBuffer]":return r(e);case"[object Boolean]":case"[object Date]":return new s(+e);case"[object DataView]":return i(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return a(e,n);case"[object Map]":return new s;case"[object Number]":case"[object String]":return new s(e);case"[object RegExp]":return A(e);case"[object Set]":return new s;case"[object Symbol]":return o(e)}}},function(e,t,n){var r=n(93);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},function(e,t){var n=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,n.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,n){var r=n(13),i=r?r.prototype:void 0,A=i?i.valueOf:void 0;e.exports=function(e){return A?Object(A.call(e)):{}}},function(e,t,n){var r=n(93);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},function(e,t,n){var r=n(666),i=n(125),A=n(89);e.exports=function(e){return"function"!=typeof e.constructor||A(e)?{}:r(i(e))}},function(e,t,n){var r=n(9),i=Object.create,A=function(){function e(){}return function(t){if(!r(t))return{};if(i)return i(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=A},function(e,t,n){var r=n(668),i=n(87),A=n(88),o=A&&A.isMap,a=o?i(o):r;e.exports=a},function(e,t,n){var r=n(68),i=n(14);e.exports=function(e){return i(e)&&"[object Map]"==r(e)}},function(e,t,n){var r=n(670),i=n(87),A=n(88),o=A&&A.isSet,a=o?i(o):r;e.exports=a},function(e,t,n){var r=n(68),i=n(14);e.exports=function(e){return i(e)&&"[object Set]"==r(e)}},function(e,t,n){var r=n(672)(n(701));e.exports=r},function(e,t,n){var r=n(94),i=n(90),A=n(46);e.exports=function(e){return function(t,n,o){var a=Object(t);if(!i(t)){var s=r(n,3);t=A(t),n=function(e){return s(a[e],e,a)}}var u=e(t,n,o);return u>-1?a[s?t[u]:u]:void 0}}},function(e,t,n){var r=n(674),i=n(685),A=n(132);e.exports=function(e){var t=i(e);return 1==t.length&&t[0][2]?A(t[0][0],t[0][1]):function(n){return n===e||r(n,e,t)}}},function(e,t,n){var r=n(79),i=n(129);e.exports=function(e,t,n,A){var o=n.length,a=o,s=!A;if(null==e)return!a;for(e=Object(e);o--;){var u=n[o];if(s&&u[2]?u[1]!==e[u[0]]:!(u[0]in e))return!1}for(;++o<a;){var c=(u=n[o])[0],l=e[c],h=u[1];if(s&&u[2]){if(void 0===l&&!(c in e))return!1}else{var d=new r;if(A)var p=A(l,h,c,e,t,d);if(!(void 0===p?i(h,l,3,A,d):p))return!1}}return!0}},function(e,t,n){var r=n(79),i=n(130),A=n(681),o=n(684),a=n(68),s=n(31),u=n(83),c=n(120),l="[object Object]",h=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,d,p,f){var y=s(e),g=s(t),E=y?"[object Array]":a(e),m=g?"[object Array]":a(t),B=(E="[object Arguments]"==E?l:E)==l,v=(m="[object Arguments]"==m?l:m)==l,w=E==m;if(w&&u(e)){if(!u(t))return!1;y=!0,B=!1}if(w&&!B)return f||(f=new r),y||c(e)?i(e,t,n,d,p,f):A(e,t,E,n,d,p,f);if(!(1&n)){var k=B&&h.call(e,"__wrapped__"),C=v&&h.call(t,"__wrapped__");if(k||C){var b=k?e.value():e,S=C?t.value():t;return f||(f=new r),p(b,S,n,d,f)}}return!!w&&(f||(f=new r),o(e,t,n,d,p,f))}},function(e,t,n){var r=n(82),i=n(677),A=n(678);function o(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}o.prototype.add=o.prototype.push=i,o.prototype.has=A,e.exports=o},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){var r=n(13),i=n(128),A=n(80),o=n(130),a=n(682),s=n(683),u=r?r.prototype:void 0,c=u?u.valueOf:void 0;e.exports=function(e,t,n,r,u,l,h){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!l(new i(e),new i(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return A(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var d=a;case"[object Set]":var p=1&r;if(d||(d=s),e.size!=t.size&&!p)return!1;var f=h.get(e);if(f)return f==t;r|=2,h.set(e,t);var y=o(d(e),d(t),r,u,l,h);return h.delete(e),y;case"[object Symbol]":if(c)return c.call(e)==c.call(t)}return!1}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},function(e,t,n){var r=n(126),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,A,o,a){var s=1&n,u=r(e),c=u.length;if(c!=r(t).length&&!s)return!1;for(var l=c;l--;){var h=u[l];if(!(s?h in t:i.call(t,h)))return!1}var d=a.get(e),p=a.get(t);if(d&&p)return d==t&&p==e;var f=!0;a.set(e,t),a.set(t,e);for(var y=s;++l<c;){var g=e[h=u[l]],E=t[h];if(A)var m=s?A(E,g,h,t,e,a):A(g,E,h,e,t,a);if(!(void 0===m?g===E||o(g,E,n,A,a):m)){f=!1;break}y||(y="constructor"==h)}if(f&&!y){var B=e.constructor,v=t.constructor;B==v||!("constructor"in e)||!("constructor"in t)||"function"==typeof B&&B instanceof B&&"function"==typeof v&&v instanceof v||(f=!1)}return a.delete(e),a.delete(t),f}},function(e,t,n){var r=n(131),i=n(46);e.exports=function(e){for(var t=i(e),n=t.length;n--;){var A=t[n],o=e[A];t[n]=[A,o,r(o)]}return t}},function(e,t,n){var r=n(129),i=n(687),A=n(694),o=n(97),a=n(131),s=n(132),u=n(47);e.exports=function(e,t){return o(e)&&a(t)?s(u(e),t):function(n){var o=i(n,e);return void 0===o&&o===t?A(n,e):r(t,o,3)}}},function(e,t,n){var r=n(95);e.exports=function(e,t,n){var i=null==e?void 0:r(e,t);return void 0===i?n:i}},function(e,t,n){var r=n(689),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,A=/\\(\\)?/g,o=r((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(i,(function(e,n,r,i){t.push(r?i.replace(A,"$1"):n||e)})),t}));e.exports=o},function(e,t,n){var r=n(690);e.exports=function(e){var t=r(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}},function(e,t,n){var r=n(82);function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],A=n.cache;if(A.has(i))return A.get(i);var o=e.apply(this,r);return n.cache=A.set(i,o)||A,o};return n.cache=new(i.Cache||r),n}i.Cache=r,e.exports=i},function(e,t,n){var r=n(692);e.exports=function(e){return null==e?"":r(e)}},function(e,t,n){var r=n(13),i=n(693),A=n(31),o=n(17),a=r?r.prototype:void 0,s=a?a.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(A(t))return i(t,e)+"";if(o(t))return s?s.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n}},function(e,t){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}},function(e,t,n){var r=n(695),i=n(696);e.exports=function(e,t){return null!=e&&i(e,t,r)}},function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,n){var r=n(96),i=n(119),A=n(31),o=n(85),a=n(86),s=n(47);e.exports=function(e,t,n){for(var u=-1,c=(t=r(t,e)).length,l=!1;++u<c;){var h=s(t[u]);if(!(l=null!=e&&n(e,h)))break;e=e[h]}return l||++u!=c?l:!!(c=null==e?0:e.length)&&a(c)&&o(h,c)&&(A(e)||i(e))}},function(e,t){e.exports=function(e){return e}},function(e,t,n){var r=n(699),i=n(700),A=n(97),o=n(47);e.exports=function(e){return A(e)?r(o(e)):i(e)}},function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},function(e,t,n){var r=n(95);e.exports=function(e){return function(t){return r(t,e)}}},function(e,t,n){var r=n(702),i=n(94),A=n(703),o=Math.max,a=Math.min;e.exports=function(e,t,n){var s=null==e?0:e.length;if(!s)return-1;var u=s-1;return void 0!==n&&(u=A(n),u=n<0?o(s+u,0):a(u,s-1)),r(e,i(t,3),u,!0)}},function(e,t){e.exports=function(e,t,n,r){for(var i=e.length,A=n+(r?1:-1);r?A--:++A<i;)if(t(e[A],A,e))return A;return-1}},function(e,t,n){var r=n(704);e.exports=function(e){var t=r(e),n=t%1;return t==t?n?t-n:t:0}},function(e,t,n){var r=n(20);e.exports=function(e){return e?(e=r(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},function(e,t,n){var r=n(94),i=n(706);e.exports=function(e,t){var n=[];if(!e||!e.length)return n;var A=-1,o=[],a=e.length;for(t=r(t,3);++A<a;){var s=e[A];t(s,A,e)&&(n.push(s),o.push(A))}return i(e,o),n}},function(e,t,n){var r=n(707),i=n(85),A=Array.prototype.splice;e.exports=function(e,t){for(var n=e?t.length:0,o=n-1;n--;){var a=t[n];if(n==o||a!==s){var s=a;i(a)?A.call(e,a,1):r(e,a)}}return e}},function(e,t,n){var r=n(96),i=n(708),A=n(709),o=n(47);e.exports=function(e,t){return t=r(t,e),null==(e=A(e,t))||delete e[o(i(t))]}},function(e,t){e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},function(e,t,n){var r=n(95),i=n(710);e.exports=function(e,t){return t.length<2?e:r(e,i(t,0,-1))}},function(e,t){e.exports=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var A=Array(i);++r<i;)A[r]=e[r+t];return A}},function(e,t,n){var r=n(712);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(3)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,".markup-frames-container{transform:translateZ(0);left:0;top:0;position:absolute}.markup-selection-frame-container{display:none}.markup-selection-frame-container.visible{display:block}.markup-selection-frame{transform:translateZ(0);position:absolute;pointer-events:none}.markup-selection-frame.fill{display:none;background-color:rgba(6,150,215,0.05)}.markup-selection-frame.fill.ios,.markup-selection-frame.border.ios{transform:translateZ(0);-webkit-transform:rotateZ(0deg)}.markup-selection-frame.fill.visible{display:block}.markup-selection-frame.border{background-color:rgba(6,150,215,0.6)}.markup-selection-frame.segment{display:none}.markup-selection-frame.segment.visible{display:block}.markup-anchor{transform:translateZ(0);display:none;position:absolute;background:#FFFFFF;box-shadow:0 0 0 1px rgba(107,120,127,0.7);pointer-events:none;border-radius:20px;z-index:1}.markup-anchor-fill.rectangle,.markup-anchor.rectangle{border-radius:0px}.markup-anchor-fill{display:none;width:100%;margin:1px;border-radius:20px;background:#0696D7}.markup-anchor-fill.visible{display:block}.markup-anchor.visible{display:flex}.rect-selector-frame{transform:translateZ(0);position:absolute;pointer-events:none;border:#222222 dashed 1px;border-radius:5px}.rect-selector-frame.visible{display:block}\n",""])},function(e,t,n){var r=n(714);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(3)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,'.markup-links-container{transform:translateZ(0);left:0;top:0;position:absolute}.link{display:none;position:absolute;pointer-events:none;z-index:1}.link.visible{display:block}.link.transparent{opacity:0.3}.link-document-attachment{transform:translateZ(0);display:block;position:absolute;text-align:center;font-family:"Artifakt Element";background-color:#0696D7;border-radius:10.5px;color:white;cursor:pointer;font-size:13px;font-weight:500;line-height:19px;height:20px;width:40px}.link-document-attachment:before{font-family:"bimviewericon", sans-serif;content:"\\E911";font-size:11px;padding-right:4px}.link.selected .link-document-attachment{background-color:#0584BD}.link.hover .link-document-attachment{background-color:#38ABDF}.link.editable .link-document-attachment{outline:1px solid rgba(6,150,215,0.6)}\n',""])},function(e,t,n){var r=n(716);"string"==typeof r&&(r=[[e.i,r,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};n(3)(r,i);r.locals&&(e.exports=r.locals)},function(e,t,n){(e.exports=n(2)(!1)).push([e.i,".markup-text-container{left:0;top:0;width:100%;height:100%;position:absolute;pointer-events:none}.markup-text{will-change:contents;transform:translateZ(0);text-rendering:geometricPrecision;display:none;position:absolute;pointer-events:none;text-align:left;white-space:pre-wrap;overflow-wrap:break-word;word-wrap:break-word;outline:none;-webkit-user-select:none;user-select:none}.markup-text p{display:block;box-sizing:content-box;font-weight:inherit;font-size:inherit;font-family:inherit;font-style:inherit;word-wrap:inherit;white-space:inherit;line-height:inherit;text-rendering:geometricPrecision;-ms-text-size-adjust:100%;text-align:left;margin:0 0 0 0;padding:0 0 0 0;user-select:text}.markup-text.single-line br{display:none}.markup-text.visible{display:block}.markup-text-area{pointer-events:all;position:absolute;z-index:100}\n",""])},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return jl}));var r={};n.r(r),n.d(r,"COLORS",(function(){return a})),n.d(r,"DEFAULT_COLORS",(function(){return s})),n.d(r,"DEFAULT_FILL_COLORS",(function(){return u})),n.d(r,"STYLE_PROPERTIES",(function(){return c})),n.d(r,"FONT_SIZES",(function(){return l})),n.d(r,"MESHLINE_PATH_START",(function(){return h})),n.d(r,"MESHLINE_PATH_END",(function(){return d})),n.d(r,"MESHLINE_PATH_DEFAULT",(function(){return p})),n.d(r,"MESHLINE_PATH_ROUND_CAP",(function(){return f})),n.d(r,"MESHLINE_PATH_FLAT_CAP",(function(){return y})),n.d(r,"MARKUP_TYPE_ARROW",(function(){return g})),n.d(r,"MARKUP_TYPE_RECTANGLE",(function(){return E})),n.d(r,"MARKUP_TYPE_CIRCLE",(function(){return m})),n.d(r,"MARKUP_TYPE_CLOUD",(function(){return B})),n.d(r,"MARKUP_TYPE_FREEHAND",(function(){return v})),n.d(r,"MARKUP_TYPE_HIGHLIGHT",(function(){return w})),n.d(r,"MARKUP_TYPE_POLYLINE",(function(){return k})),n.d(r,"MARKUP_TYPE_POLYCLOUD",(function(){return C})),n.d(r,"MARKUP_TYPE_TEXT",(function(){return b})),n.d(r,"MARKUP_TYPE_CALLOUT",(function(){return S})),n.d(r,"MARKUP_TYPE_ARROW_CALLOUT",(function(){return T})),n.d(r,"MARKUP_TYPE_ARROW_CLOUD_CALLOUT",(function(){return M})),n.d(r,"MARKUP_TYPE_DIMENSION",(function(){return x})),n.d(r,"MARKUP_TYPE_LINE",(function(){return U})),n.d(r,"RECT_SELECTOR",(function(){return Q})),n.d(r,"MARKUP_STATUS_SAVE_FAILED",(function(){return L})),n.d(r,"MARKUP_STATUS_SAVE_SUCCEED",(function(){return F})),n.d(r,"MARKUP_STATUS_SAVING",(function(){return R})),n.d(r,"MARKUP_STATUS_DELETING",(function(){return H})),n.d(r,"MARKUP_STATUS_DELETE_SUCCEED",(function(){return _})),n.d(r,"MARKUP_STATUS_DELETE_FAILED",(function(){return D})),n.d(r,"MARKUP_STATUS_CREATED",(function(){return O})),n.d(r,"MARKUP_STATUS_OPEN",(function(){return I})),n.d(r,"MARKUP_STATUS_PRIVATE",(function(){return P})),n.d(r,"MARKUP_STATUS_PUBLISHED",(function(){return N})),n.d(r,"MARKUP_STATUS_PUBLISHING",(function(){return K})),n.d(r,"MARKUP_STATUS_CLOSED",(function(){return V})),n.d(r,"MARKUP_STATUS_ARCHIVED",(function(){return G})),n.d(r,"MARKUP_STATUS_ARCHIVING",(function(){return j})),n.d(r,"MARKUP_ATTACHMENT_LOADING",(function(){return Y})),n.d(r,"MARKUP_ATTACHMENT_SAVING",(function(){return W})),n.d(r,"MARKUP_ATTACHMENT_SAVE_SUCCEED",(function(){return X})),n.d(r,"MARKUP_ATTACHMENT_SAVE_FAILED",(function(){return J})),n.d(r,"MARKUP_ATTACHMENT_RENAMING",(function(){return z})),n.d(r,"MARKUP_ATTACHMENT_DELETEING",(function(){return q})),n.d(r,"ATTACHMENT_DATA_TYPE_BINARY",(function(){return Z})),n.d(r,"ATTACHMENT_DATA_TYPE_TEXT",(function(){return $})),n.d(r,"MARKUP_RESOURCE_TYPE_SVG",(function(){return ee})),n.d(r,"MARKUP_RESOURCE_TYPE_SCREEN_CAPTURE",(function(){return te})),n.d(r,"DEFAULT_STATUSES_TO_LOAD",(function(){return ne})),n.d(r,"LINK_TYPE_ATTACHMENTS",(function(){return re})),n.d(r,"LINK_TYPE_DOCUMENT_ATTACHMENT",(function(){return ie})),n.d(r,"DEFAULT_MARKUP",(function(){return Ae})),n.d(r,"DEFAULT_COLOR",(function(){return oe})),n.d(r,"DEFAULT_FONT_COLOR",(function(){return ae})),n.d(r,"DEFAULT_FILL_COLOR",(function(){return se})),n.d(r,"DEFAULT_THICKNESS",(function(){return ue})),n.d(r,"DEFAULT_OPACITY",(function(){return ce})),n.d(r,"DEFAULT_HIGHLIGHT_OPACITY",(function(){return le})),n.d(r,"DEFAULT_FILL_OPACITY",(function(){return he})),n.d(r,"DEFAULT_STROKE_IN_MM",(function(){return de})),n.d(r,"DEFAULT_FONT_SIZE_IN_PIXELS",(function(){return pe})),n.d(r,"DEFAULT_FONT_SIZE_IN_MM",(function(){return fe})),n.d(r,"DEFAULT_FONT_WEIGHT",(function(){return ye})),n.d(r,"DEFAULT_FONT_FAMILY",(function(){return ge})),n.d(r,"DEFAULT_FONT_STYLE",(function(){return Ee})),n.d(r,"SUB_MENU_VISIBLE_CLASS",(function(){return me})),n.d(r,"ARROW_TIP_LENGTH",(function(){return ve})),n.d(r,"EPSILON",(function(){return we})),n.d(r,"TOUCH_RADIUS",(function(){return ke})),n.d(r,"ANCHOR_RADIUS",(function(){return Ce})),n.d(r,"MIN_CHANGE_DISTANCE",(function(){return be})),n.d(r,"SNAP_DISTANCE",(function(){return Se})),n.d(r,"MIN_FREEHAND_POINT_DISTANCE",(function(){return Te})),n.d(r,"MIN_ANGLE_CHANGE",(function(){return Me})),n.d(r,"ROTATION_ANCHOR_DISTANCE",(function(){return xe})),n.d(r,"ROTATION_SNAP_DEGREES",(function(){return Ue})),n.d(r,"PASTE_OFFSET",(function(){return Qe})),n.d(r,"ARROW_MOVE_OFFSET",(function(){return Le})),n.d(r,"CONTEXTUAL_MENU_OFFSET",(function(){return Fe})),n.d(r,"LINK_POSITION_OFFSET",(function(){return Re})),n.d(r,"LINK_ICON_SIZE",(function(){return He})),n.d(r,"SELECTION_ZOOM_MARGIN",(function(){return _e})),n.d(r,"MAX_THICKNESS",(function(){return De})),n.d(r,"PERSPECTIVE_MODE_SCALE",(function(){return Oe})),n.d(r,"FRAME_SIZE_SCALE",(function(){return Ie})),n.d(r,"BOUNDING_BOX_MARGIN",(function(){return Pe})),n.d(r,"HIT_AREA_MARGIN",(function(){return Ne})),n.d(r,"TEXT_DEBOUNCE",(function(){return Ke})),n.d(r,"DIMENSION_TIP_LENGTH",(function(){return Ve})),n.d(r,"DIMENSION_THICKNESS_FACTOR",(function(){return Ge})),n.d(r,"DIMENSION_FONT_SIZE_FACTOR",(function(){return je})),n.d(r,"DISABLED_OPACITY",(function(){return Ye})),n.d(r,"MOBILE_GESTURES_MIN_THRESHOLD_TIME",(function(){return We})),n.d(r,"SCREEN_MARGIN",(function(){return Xe})),n.d(r,"TEXT_LENGTH_LIMIT",(function(){return Je})),n.d(r,"MINIMUM_THUMBNAIL_SIZE",(function(){return ze})),n.d(r,"WORLD_3D_SIZE",(function(){return qe})),n.d(r,"MAX_NORMA_PERCENTAGE",(function(){return Ze})),n.d(r,"MAX_NORMA_TEXT_PERCENTAGE",(function(){return $e})),n.d(r,"NORMA_3D",(function(){return et})),n.d(r,"NORMA_TEXT_3D",(function(){return tt})),n.d(r,"POINT_SIZE_IN_MM",(function(){return nt})),n.d(r,"TIMEOUT_TO_SELECT_AFTER_DRAWEND",(function(){return rt})),n.d(r,"MARKUP_CREATION_CURSORS",(function(){return it})),n.d(r,"MARKUP_ERRORS",(function(){return At}));var i,A={MARKUP_SESSION_START:"markup.session.start",MARKUP_SESSION_END:"markup.session.end",MARKUP_TOOL_ENABLED_CHANGED:"markup.tool.enabled.changed",MARKUP_REMOVED:"markup.removed",MARKUP_DRAWING_START:"markup.drawing.start",MARKUP_DRAWING_END:"markup.drawing.end",MARKUP_DRAWING_CANCEL:"markup.drawing.cancel",MARKUP_EDIT_START:"markup.edit.start",MARKUP_EDIT_END:"markup.edit.end",MARKUP_SELECTED:"markup.selected",MARKUP_DESELECTED:"markup.deselected",MARKUP_ENABLE_EDIT:"markup.enable.edit",MARKUP_DISABLE_EDIT:"markup.disable.edit",MARKUP_DIRTY:"markup.dirty",MARKUP_VISIBILITY_CHANGED:"markup.visibility.changed",MARKUP_VIEW_ENTERED:"markup.view.entered",MARKUP_VIEW_EXITED:"markup.view.exited",TEXT_EDITING_STARTED:"text.editing.started",TEXT_EDITING_ENDED:"text.editing.ended",LAYER_DIRTY:"layer.dirty",LAYER_SELECTED:"layer.selected",LAYER_DESELECTED:"layer.deselected",LAYER_SELECTED_FROM_DIFFERENT_SHEET:"layer.selected.from.different.sheet",LAYER_EDITED_FROM_DIFFERENT_SHEET:"layer.edited.from.different.sheet",LAYER_DELETE:"layer.delete",LAYER_DELETED:"layer.deleted",LAYER_PUBLISH:"layer.publish",LAYER_ARCHIVE:"layer.archive",LAYER_SYNCING:"layer.syncing",LAYER_SYNCED:"layer.synced",LAYER_READY_TO_SAVE:"layer.ready.to.save",LAYER_CREATED:"layer.created",DOCUMENT_ATTACHMENT_CREATION_START:"document.attachment.creation.start",DOCUMENT_ATTACHMENT_RENAME:"document.attachment.rename",DOCUMENT_ATTACHMENT_DELETE:"document.attachment.delete",LAYER_FETCHED:"layer.fetched",LAYER_RESOURCE_FETCHED:"layer.resource.fetched",LAYER_THUMBNAIL_FETCHED:"layer.thumbnail.fetched",LAYER_METADATA_FETCHED:"layer.metadata.fetched",ATTACHMENT_THUMBNAIL_LOADED:"attachment.thumbnail.loaded",ALL_MARKUPS_LOADED:"all.markups.loaded",PROJECT_USERS_FETCHED:"project.users.fetched",LINK_DIRTY:"link.dirty",LINK_SELECTED:"link.selected",LINK_DESELECTED:"link.deselected",LINK_SYNCED:"link.synced",LINK_SYNCING:"link.syncing",LINK_REMOVED:"link.removed",LINK_RENDERED:"link.rendered",FILTER_CHANGED:"filter.changed",BUTTON_DOWN:"button.down",MARKUP_CREATION_TYPE_CHANGED:"markup.creation.type.changed",MARKUP_STYLE_PROPERTY_CHANGED:"markup.style.property.changed",LAYER_DISCARD_PRESSED:"layer.discard.pressed",LAYER_PUBLISH_PRESSED:"layer.publish.pressed",LAYER_ARCHIVE_PRESSED:"layer.archive.pressed",LAYER_DELETE_PRESSED:"layer.delete.pressed",LAYER_DELETE_EMPTY_PRESSED:"layer.delete.empty.pressed",EXIT_VIEWER_PRESSED:"exit.viewer.pressed",RECT_SELECTOR_UPDATED:"rect.selector.updated",CALIBRATION_REQUIRED:"calibration.required"};function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a={RED:"#FF0000",GREEN:"#00F72C",BLUE:"#103FFB",ORANGE:"#FF9224",YELLOW:"#FEF935",CYAN:"#03FCFE",WHITE:"#FFFFFF",BLACK:"#000000",PINK:"#FF4CFC",PURPLE:"#922890",NO_COLOR:"-1"},s=[{color:a.RED,label:"Red"},{color:a.BLUE,label:"Blue"},{color:a.PURPLE,label:"Purple"},{color:a.YELLOW,label:"Yellow"},{color:a.ORANGE,label:"Orange"},{color:a.CYAN,label:"Cyan"},{color:a.PINK,label:"Pink"},{color:a.GREEN,label:"Green"},{color:a.BLACK,label:"Black"},{color:a.WHITE,label:"White"}],u=[{color:a.RED,label:"Red"},{color:a.BLUE,label:"Blue"},{color:a.PURPLE,label:"Purple"},{color:a.YELLOW,label:"Yellow"},{color:a.ORANGE,label:"Orange"},{color:a.CYAN,label:"Cyan"},{color:a.PINK,label:"Pink"},{color:a.GREEN,label:"Green"},{color:a.NO_COLOR,label:"No Fill"},{color:a.BLACK,label:"Black"},{color:a.WHITE,label:"White"}],c={COLOR:"stroke-color",FILL_COLOR:"fill-color",THICKNESS:"stroke-width",OPACITY:"stroke-opacity",FILL_OPACITY:"fill-opacity",FONT_SIZE:"font-size",FONT_WEIGHT:"font-weight",FONT_FAMILY:"font-family",FONT_STYLE:"font-style",FONT_COLOR:"font-color",STROKE_LINEJOIN:"stroke-linejoin"},l=[10,12,14,16,18,20,24,28,32,36,40,44,48,52,58,64,70,76,82,88,94,100],h=1,d=2,p=1,f=2,y=3,g="arrow",E="rectangle",m="ellipse",B="cloud",v="freehand",w="highlight",k="polyline",C="polycloud",b="label",S="callout",T="simple-arrow-callout",M="arrow-cloud-callout",x="dimension",U="line",Q="selector",L="save_failed",F="save_success",R="markup_saving",H="deleting",_="delete_success",D="delete_failed",O="created",I="open",P="private",N="published",K="publishing",V="closed",G="archived",j="archiving",Y="attachment_loading",W="attachment_saving",X="attachment_save_success",J="attachment_save_failed",z="attachment_renaming",q="attachment_deleting",Z="binary",$="text",ee="svg",te="screencapture",ne=[P,N,G].join(","),re="attachments",ie="document",Ae=v,oe=a.RED,ae=a.RED,se=a.NO_COLOR,ue=10,ce=1,le=.5,he=.5,de=.1,pe=36,fe=10,ye="normal",ge="Artifakt Element, Arial",Ee="normal",me="subMenuVisible",Be="undefined"!=typeof window&&("ontouchstart"in window||navigator.maxTouchPoints>0),ve=5,we=1e-4,ke=Be?34:4,Ce=4,be=5,Se=20,Te=1,Me=.05,xe=Be?30:20,Ue=45,Qe=20,Le=20,Fe=60,Re=10,He=20,_e=.05,De=100,Oe=1e3,Ie=20,Pe=4*window.devicePixelRatio+10,Ne=ke+10,Ke=200,Ve=8,Ge=.4,je=.6,Ye=.3,We=100,Xe=10,Je=3e3,ze=92,qe=1e3,Ze=5e-4,$e=20*Ze,et=1,tt=20*et,nt=.005,rt=700,it=(o(i={},Q,"cell"),o(i,b,"text"),o(i,S,"text"),i),At={MARKUP_SAVE_FAILED:"MARKUP_SAVE_FAILED",MARKUP_DELETE_FAILED:"MARKUP_DELETE_FAILED",MARKUP_PUBLISH_FAILED:"MARKUP_PUBLISH_FAILED",MARKUP_ARCHIVE_FAILED:"MARKUP_ARCHIVE_FAILED",MARKUP_ATTACHMENT_CREATE_FAILED:"MARKUP_ATTACHMENT_CREATE_FAILED",MARKUP_ATTACHMENT_DELETE_FAILED:"MARKUP_ATTACHMENT_DELETE_FAILED",MARKUP_ATTACHMENT_RENAME_FAILED:"MARKUP_ATTACHMENT_RENAME_FAILED",MARKUP_ATTACHMENT_UPDATE_FAILED:"MARKUP_ATTACHMENT_UPDATE_FAILED"},ot={radiansToDegrees:function(e){return e*(180/Math.PI)},degreesToRadians:function(e){return e*(Math.PI/180)},applyRotation:function(e,t,n,r){e instanceof Array||(e=[e]),e.forEach((function(e){e.sub(n),e.applyAxisAngle(r,t),e.add(n)}))},getSignedAngle:function(e,t,n){var r=e.angleTo(t),i=e.clone().cross(t).normalize();return r*(n.dot(i)>0?1:-1)},swapBoundingBoxY:function(e){var t=[e.min.y,e.max.y];return e.max.y=t[0],e.min.y=t[1],e}},at=ot,st=n(609),ut=n(671),ct=n(18),lt=n(705),ht={cloneDeep:function(e){return st(e)},findLast:function(e,t){return ut(e,t)},debounce:function(e,t,n){return ct(e,t,n)},remove:function(e,t){return lt(e,t)}},dt=ht;function pt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ft=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.actionManager=t}var t,n,r;return t=e,(n=[{key:"execute",value:function(){this.actionManager.execute(this)}},{key:"undo",value:function(){}},{key:"redo",value:function(){}}])&&pt(t.prototype,n),r&&pt(t,r),e}();function yt(e){return(yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Et(e,t){return(Et=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vt(e);if(t){var i=vt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Bt(this,n)}}function Bt(e,t){return!t||"object"!==yt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vt(e){return(vt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var wt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Et(e,t)}(A,e);var t,n,r,i=mt(A);function A(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A),(r=i.call(this,e.actionManager)).markupsManager=e,r.markup=t,r.layer=n,r}return t=A,(n=[{key:"undo",value:function(){this.markupsManager.removeMarkupFromLayer(this.markup)}},{key:"redo",value:function(){this.markupsManager.addMarkupToLayer(this.markup,this.layer)}}])&&gt(t.prototype,n),r&&gt(t,r),A}(ft);function kt(e){return(kt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ct(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bt(e,t){return(bt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function St(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Mt(e);if(t){var i=Mt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Tt(this,n)}}function Tt(e,t){return!t||"object"!==kt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Mt(e){return(Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bt(e,t)}(A,e);var t,n,r,i=St(A);function A(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A),(r=i.call(this,e.actionManager)).markupsManager=e,r.markup=t,r.layer=r.markup.layer,r.oldState=dt.cloneDeep(r.markup.getState()),r.newState=dt.cloneDeep(n),r}return t=A,(n=[{key:"undo",value:function(){this.markup.setState(this.oldState),this.markup.syncEditState()}},{key:"redo",value:function(){this.markup.setState(this.newState),this.markup.syncEditState()}}])&&Ct(t.prototype,n),r&&Ct(t,r),A}(ft);function Ut(e){return(Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Lt(e,t){return(Lt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ht(e);if(t){var i=Ht(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Rt(this,n)}}function Rt(e,t){return!t||"object"!==Ut(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ht(e){return(Ht=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var _t=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Lt(e,t)}(A,e);var t,n,r,i=Ft(A);function A(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A),(n=i.call(this,e.actionManager)).markupsManager=e,n.markup=t,n.layer=n.markup.layer,n}return t=A,(n=[{key:"undo",value:function(){this.markupsManager.addMarkupToLayer(this.markup,this.layer)}},{key:"redo",value:function(){this.markupsManager.removeMarkupFromLayer(this.markup)}}])&&Qt(t.prototype,n),r&&Qt(t,r),A}(ft),Dt=Autodesk.Viewing,Ot=function(e,t){e&&Object.keys(e).forEach((function(n){var r=e[n];r&&t(r)}))},It=function(e,t,n){return!(!e||!t)&&(n=n||we,e.distanceTo(t)<=n)},Pt=function(e){var t=[];return Ot(e,(function(e){Array.isArray(e)?e.forEach((function(e){t.push(e)})):t.push(e)})),t},Nt=function(e,t,n){var r,i=new THREE.Vector3,A=new THREE.Vector3;return i.subVectors(t,e),A.subVectors(n,t),r=i.dot(A),i.subVectors(n,t),r=-r/i.dot(i),i.subVectors(n,t),i.multiplyScalar(r),i.add(t)},Kt=function(e,t){e instanceof Array||(e=[e]),e.forEach((function(e){e.x+=t.x,e.y+=t.y,e.z+=t.z}))},Vt=function(){var e=Dt.getGlobal().document,t=e.createElement("div");t.id="text-markup-measure-div",t.style.position="absolute",t.style.visibility="hidden",t.style.pointerEvents="none",t.style.textRendering="geometricPrecision",e.body.appendChild(t);var n={};return function(e,r){var i="".concat(e,"_").concat(r.fontWeight,"_").concat(r.fontSize,"_").concat(r.fontFamily,"_").concat(r.fontStyle,"_").concat(r.width);if(n[i])return n[i];t.innerText=e,t.style.fontWeight=r.fontWeight,t.style.fontSize=r.fontSize,t.style.fontFamily=r.fontFamily,t.style.fontStyle=r.fontStyle,t.style.overflowWrap=r.overflowWrap||"break-word",t.style.wordWrap=r.wordWrap||"break-word",t.style.whiteSpace=r.whiteSpace||"pre-wrap",t.style.width=r.width||(Autodesk.Viewing.isIE11?"auto":"unset"),t.style.lineHeight=r.lineHeight||1;var A=t.getBoundingClientRect(),o=A.width,a=A.height;return n[i]={width:o,height:a},n[i]}}(),Gt=function(e,t,n,r,i,A,o,a){var s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null;a||(a=[]),e=e||0,t=t||0,n=n||0,r=r||0,i=i||0;var c=Math.abs(r-i);c>2*Math.PI&&(c-=2*Math.PI),(!A&&r>i||A&&i>r)&&(c=2*Math.PI-c),"number"!=typeof o&&(s=s||n,o=Math.max(6,2*Math.floor(6*Math.pow(s,1/3)*(c/Math.PI))));var l=c/(o=Math.max(o,3)),h=r;l*=A?-1:1;for(var d=0;d<o+1;d++){var p=e+Math.cos(h)*n,f=t+Math.sin(h)*n;a.push({x:p,y:f,z:0}),u&&(u.min.x=Math.min(u.min.x,p),u.min.y=Math.min(u.min.y,f),u.max.x=Math.max(u.max.x,p),u.max.y=Math.max(u.max.y,f)),h+=l}return a},jt=function(e,t,n,r){var i=new THREE.Vector2(e[n].x+Math.cos(e[n].end)*t,e[n].y+Math.sin(e[n].end)*t),A=new THREE.Vector2(e[r].x+Math.cos(e[r].begin)*t,e[r].y+Math.sin(e[r].begin)*t),o=i.clone().sub(A),a=o.length(),s=i.clone().add(A).divideScalar(2);o.normalize();var u=Math.sqrt(Math.max(0,t*t-a/2*(a/2))),c=new THREE.Vector2(o.y,-o.x);c.multiplyScalar(u);var l=s.clone().add(c),h=Math.atan2(i.y-l.y,i.x-l.x),d=Math.atan2(A.y-l.y,A.x-l.x),p={x:l.x,y:l.y,begin:h,end:d};return e.splice(n+1,0,p),{newCircle:p,beginPoint:i,endPoint:A}},Yt=function(e,t,n){for(var r=0;r<n.length;r++){for(var i=null,A=0,o=0;o<e.length;o++)if(e[o]["isCurrentIntersection"+r])for(var a=0;a<e.length;a++){if(e[a]["isNextIntersection"+r])Math.sqrt((e[o].x-e[a].x)*(e[o].x-e[a].x)+(e[o].y-e[a].y)*(e[o].y-e[a].y))<2*t&&(e[o].hide=!0,null===i&&(i=o-1),e[a].hide=!0,A<a+1&&(A=a+1))}n[r].begin=i,n[r].end=A}},Wt=function(e,t,n){return t.splice(function(e,t,n){if(0===t.length)return-1;for(var r=0,i=t.length,A=Math.floor(i/2);i-r>1;){var o=n(t[A],e);if(0===o)return A;o>0?i=A:r=A,A=Math.floor(r+(i-r)/2)}return n(t[A],e)>0?A-1:A}(e,t,n)+1,0,e),t},Xt=function(e,t,n,r){var i={x:null,y:null,onLine1:!1,onLine2:!1,onBothLines:!1},A=(r.y-n.y)*(t.x-e.x)-(r.x-n.x)*(t.y-e.y);if(0===A)return i;var o=e.y-n.y,a=e.x-n.x,s=(r.x-n.x)*o-(r.y-n.y)*a,u=(t.x-e.x)*o-(t.y-e.y)*a;return o=s/A,a=u/A,i.x=e.x+o*(t.x-e.x),i.y=e.y+o*(t.y-e.y),o>0&&o<1&&(i.onLine1=!0),a>0&&a<1&&(i.onLine2=!0),i.onBothLines=i.onLine1&&i.onLine2,i},Jt=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.width,i=t.height,A=t.ctx,o=t.target,a=t.screenshotCamera,s=t.onRenderDone,u=n.markupLayer,c=e.getExtension("Autodesk.BIM360.Markups");if(c){var l=e.impl.getCanvasBoundingClientRect(),h=l.width,d=l.height,p=e.impl.glrenderer();p.pushViewport(),p.setPixelRatio(1),p.setViewport(0,0,r,i),c.renderer.onResize({width:r,height:i});var f,y,g=e.impl.is2d?a:c.renderer.markupsCamera,E=c.markupsManager.getVisibleLayers();u&&E.forEach((function(e){return e!==u&&e.setVisible(!1)}));var m=function(){u&&(f=u.isVisible(),y=u.isTransparent(),u.setVisible(!0),u.changeTransparency(!1))},B=function(){u&&(u.setVisible(f),u.changeTransparency(!y))};m(),c.renderer.render(o,g),B(),p.popViewport(),p.setPixelRatio(),c.renderer.onResize({width:h,height:d});var v=A.targetToCanvas(o),w=v.canvas,k=r/h;c.renderer.textRenderer.renderTextToCanvas(w,g,k,m,B,s),u&&E.forEach((function(e){return e!==u&&e.setVisible(!0)}))}else s(A.targetToCanvas(o).canvas)},zt=function(e,t,n){if(e.length<=2)return e;function r(e,t,n){var r=t.x,i=t.y,A=n.x-r,o=n.y-i;if(0!==A||0!==o){var a=((e.x-r)*A+(e.y-i)*o)/(A*A+o*o);a>1?(r=n.x,i=n.y):a>0&&(r+=A*a,i+=o*a)}return(A=e.x-r)*A+(o=e.y-i)*o}var i=void 0!==t?t*t:1;return e=function(e,t){var n=e.length-1,i=[e[0]];return function e(t,n,i,A,o){for(var a,s=A,u=n+1;u<i;u++){var c=r(t[u],t[n],t[i]);c>s&&(a=u,s=c)}s>A&&(a-n>1&&e(t,n,a,A,o),o.push(t[a]),i-a>1&&e(t,a,i,A,o))}(e,0,n,t,i),i.push(e[n]),i}(e=n?e:function(e,t){for(var n,r,i,A,o,a=e[0],s=[a],u=1,c=e.length;u<c;u++)n=e[u],i=a,A=void 0,o=void 0,A=(r=n).x-i.x,o=r.y-i.y,A*A+o*o>t&&(s.push(n),a=n);return a!==n&&s.push(n),s}(e,i),i)};function qt(e){var t=e.length;if(3===t)return!0;for(var n=0;n<t;n++)for(var r=e[n],i=e[(n+1)%t],A=n+2;A<t;A++){var o=e[A%t],a=e[(A+1)%t];if(a===r)break;if(Xt(r,i,o,a).onBothLines)return!1}return!0}var Zt=function(e,t){e.navigation.getRequestTransition()||e.navigation.getTransitionActive()?setTimeout((function(){e.navigation.getRequestTransition()||e.navigation.getTransitionActive()?e.addEventListener(Autodesk.Viewing.CAMERA_TRANSITION_COMPLETED,(function(){t()}),{once:!0}):t()}),1):t()},$t=function(e,t){return e===t||!(!e||!t||e.length===t.length)&&(e.startsWith("(")?e==="(".concat(t,")"):t==="(".concat(e,")"))};function en(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var nn=Autodesk.Viewing,rn=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};en(this,e),this.setGlobalManager(t.globalManager),this.markupsExtension=t,this.viewer=t.viewer,this.markup=n,this.options=r}var t,n,r;return t=e,(n=[{key:"getEditState",value:function(){return this.markup.getEditState()}},{key:"setEditState",value:function(e,t){this.markup.setEditState(e,t,this)}},{key:"getAnchors",value:function(){return this.getEditState().anchors}},{key:"updateEditState",value:function(e){this.setEditState(this.getEditState(),e)}},{key:"updateEditStateAnchors",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getEditState().anchors;this.updateEditState({anchors:e})}},{key:"handleCompensation",value:function(){if(this.markup.layer){var e=this.markup.getAnchors();this.prevCenter||(this.prevCenter=this.markup.center.clone());var t=this.markup.center.clone().sub(this.prevCenter);e.forEach((function(e){e.sub(t)})),t.applyMatrix4(this.markup.scaleMatrix);var n=this.markup.getRotation();if(0!==n){var r=this.markupsExtension.renderer.getCameraEyeVector();at.applyRotation(t,n,new THREE.Vector3,r)}t.add(this.markup.editState.translation),this.updateEditState({anchors:e,translation:t}),this.prevCenter.copy(this.markup.center)}}},{key:"submitChanges",value:function(e){var t;if(this.markup.layer){if(this.markup.belongsToGroup())return void this.submitGroupUpdate(e);t=new xt(this.markupsExtension.markupsManager,this.markup,this.getEditState())}else{var n=this.markupsExtension.markupsManager.getActiveLayer();this.markup.syncState(),t=new wt(this.markupsExtension.markupsManager,this.markup,n)}t.isDuringEdit=e,t.execute()}},{key:"submitGroupUpdate",value:function(e){var t=this,n=this.markup.markupGroup.markups,r=this.markupsExtension.markupsManager.isActionGroupOpen();r||this.markupsExtension.markupsManager.openActionGroup(),n.forEach((function(r,i){var A=new xt(t.markupsExtension.markupsManager,r,r.getEditState());A.isDuringEdit=i<n.length-1||e,A.execute()})),r||this.markupsExtension.markupsManager.closeActionGroup()}},{key:"deleteMarkup",value:function(){new _t(this.markupsExtension.markupsManager,this.markup).execute()}},{key:"changeStyleProperty",value:function(e,t,n){var r=dt.cloneDeep(this.getEditState());r.style[e]=t,this.updateEditState({style:Object.assign({},r.style)}),n||(this.submitChanges(!0),this.editEnd(!0))}},{key:"snapPointToAxis",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!It(e,t)){var i=this.markupsExtension.renderer.worldToClient(e),A=this.markupsExtension.renderer.worldToClient(t),o=i.clone().sub(A).normalize(),a=at.getSignedAngle(this.markupsExtension.renderer.absoluteUpVec,o,this.markupsExtension.renderer.getCameraEyeVector()),s=a+at.degreesToRadians(r),u=at.degreesToRadians(n),c=Math.ceil((s-at.degreesToRadians(n/2))/u)*u,l=new THREE.Vector3(0,0,-1),h=i.clone();at.applyRotation(h,c-s,A,l);var d=h.clone().sub(A).normalize(),p=i.clone().sub(A).dot(d),f=A.add(d.multiplyScalar(p));e.copy(this.markupsExtension.renderer.clientToWorld(f))}}},{key:"getSnappedPosition",value:function(){return this.markupsExtension.markupsTool.isSnappingAllowed()?this.markupsExtension.markupsTool.getSnappedPosition():this.markupsExtension.markupsTool.lastMousePos}},{key:"didMouseMove",value:function(){return this.markupsExtension.markupsTool.mouseMoved}},{key:"getTouchRadiusWorld",value:function(){return this.markupsExtension.renderer.sizeFromClientToWorld(ke)}},{key:"getMinChangeDistanceWorld",value:function(){return this.markupsExtension.renderer.sizeFromClientToWorld(be)}},{key:"snapDistance",value:function(){return this.markupsExtension.renderer.sizeFromClientToWorld(Se)}},{key:"intersect",value:function(e){return null}},{key:"getCursor",value:function(){return"crosshair"}},{key:"isDragging",value:function(){return!1}},{key:"editStart",value:function(){this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_EDIT_START,markup:this.markup,handler:this})}},{key:"editEnd",value:function(e){this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_EDIT_END,markup:this.markup,isDuringEdit:e,handler:this})}},{key:"isSamePoint",value:function(e,t){return It(e,t,this.getMinChangeDistanceWorld())}},{key:"isSamePointClient",value:function(e,t){return It(e,t,be)}},{key:"handleDoubleClick",value:function(e,t){}},{key:"handleButtonDown",value:function(e,t){}},{key:"handleButtonUp",value:function(e,t){}},{key:"handleKeyDown",value:function(e,t){}},{key:"handleKeyUp",value:function(e,t){}},{key:"handleMouseMove",value:function(e){}},{key:"handleGesture",value:function(e){}},{key:"handleResize",value:function(){}},{key:"destroy",value:function(){this.markupsExtension=null,this.viewer=null,this.markup=null}}])&&tn(t.prototype,n),r&&tn(t,r),e}();function An(e){return(An="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function on(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function an(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function sn(e,t){return(sn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function un(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=hn(e);if(t){var i=hn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return cn(this,n)}}function cn(e,t){return!t||"object"!==An(t)&&"function"!=typeof t?ln(e):t}function ln(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hn(e){return(hn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}nn.GlobalManagerMixin.call(rn.prototype);var dn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&sn(e,t)}(o,e);var t,n,r,i=un(o);function o(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return on(this,o),(t=i.call(this,e,null,n)).bounds=new THREE.Box3,t.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_END,t.clean.bind(ln(t))),t}return t=o,(n=[{key:"handleMouseMove",value:function(e){var t=this;return!!(this.buttonDownPoint&&this.markupsExtension.markupsTool.dragging&&this.didMouseMove())&&(this.bounds.makeEmpty(),this.bounds.expandByVector(new THREE.Vector3(0,0,1/0)),this.bounds.expandByPoint(e),this.bounds.expandByPoint(this.buttonDownPoint),this.markupsExtension.markupsManager.getEnabledMarkups().filter((function(e){return!e.isSelected()})).forEach((function(e){var n=e.getWorldBoundingBox(!0);t.bounds.isIntersectionBox(n)&&e.setHover(!0)})),this.markupsExtension.markupsManager.dispatchEvent({type:A.RECT_SELECTOR_UPDATED,bounds:this.bounds}),!0)}},{key:"clean",value:function(){this.buttonDownPoint=null,this.bounds.makeEmpty(),this.markupsExtension.markupsManager.dispatchEvent({type:A.RECT_SELECTOR_UPDATED,bounds:this.bounds})}},{key:"handleButtonDown",value:function(e,t){return this.clean(),this.buttonDownPoint=e,!0}},{key:"handleButtonUp",value:function(e,t){return this.selectMarkups(),this.clean(),!1}},{key:"selectMarkups",value:function(){var e=this;this.markupsExtension.markupsTool.shiftDown||this.markupsExtension.markupsManager.deselectAllMarkups(),this.markupsExtension.markupsManager.getEnabledMarkups().filter((function(e){return!e.isSelected()})).forEach((function(t){var n=t.getWorldBoundingBox(!0);e.bounds.isIntersectionBox(n)&&t.select()}))}}])&&an(t.prototype,n),r&&an(t,r),o}(rn);function pn(e){return(pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function gn(e,t){return(gn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function En(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Bn(e);if(t){var i=Bn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return mn(this,n)}}function mn(e,t){return!t||"object"!==pn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Bn(e){return(Bn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var vn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&gn(e,t)}(A,e);var t,n,r,i=En(A);function A(){return fn(this,A),i.apply(this,arguments)}return t=A,(n=[{key:"getCursor",value:function(){return"pointer"}},{key:"intersect",value:function(e){return this.markup.intersect(e)}},{key:"handleMouseMove",value:function(e){if(this.markupsExtension.markupsTool.dragging||Autodesk.Viewing.isMobileDevice())return!1;var t=this.markup.intersect(e);return t&&(this.markup.layer===this.markupsExtension.markupsManager.getActiveLayer()?this.markup.setHover(!0):this.markup.layer.setHover(!0)),t}},{key:"handleDoubleClick",value:function(e,t){return!this.didMouseMove()&&!!this.markup.intersect(e)&&(this.markupsExtension.markupsManager.isMarkupSessionOpen()||this.markup.layer===this.markupsExtension.markupsManager.getActiveLayer()||this.markupsExtension.markupsManager.editLayer(this.markup.layer,!1,!1,!1),this.markupsExtension.markupsTool.shiftDown||this.markupsExtension.markupsTool.ctrlDown||this.markupsExtension.markupsManager.deselectAllMarkups([this.markup]),this.markup.select(),!0)}},{key:"handleButtonDown",value:function(e,t){return!1}},{key:"handleButtonUp",value:function(e,t){return!this.didMouseMove()&&!!this.markup.intersect(e)&&(this.markupsExtension.markupsManager.deselectAllLayers([this.markup.layer]),this.markupsExtension.markupsManager.selectLayer(this.markup.layer,!1,!1),this.markupsExtension.markupsManager.isMarkupSessionOpen()&&(this.markupsExtension.markupsTool.shiftDown||this.markupsExtension.markupsTool.ctrlDown||this.markupsExtension.markupsManager.deselectAllMarkups([this.markup]),this.markup.select()),!0)}}])&&yn(t.prototype,n),r&&yn(t,r),A}(rn);function wn(e){return(wn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function kn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bn(e,t){return(bn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Sn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Mn(e);if(t){var i=Mn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Tn(this,n)}}function Tn(e,t){return!t||"object"!==wn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Mn(e){return(Mn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bn(e,t)}(A,e);var t,n,r,i=Sn(A);function A(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return kn(this,A),(n=i.call(this,e,t,r)).keyTranslation=new THREE.Vector3,n}return t=A,r=[{key:"hasOneGroupInEdit",value:function(e){var t=0,n=0;return e.forEach((function(e){e.isGroupMarkup()?t++:e.belongsToGroup()||n++})),1===t&&0===n}}],(n=[{key:"handleMouseMove",value:function(e){return this.translating&&this.handleMouseTranslation(e),this.translating}},{key:"handleButtonDown",value:function(e,t){return!!this.translating||(this.translating=this.intersect(e),this.translating&&(this.lastTranslationPoint=e,this.buttonDownPos=e,this.editStart()),this.translating)}},{key:"handleButtonUp",value:function(e,t){if(this.translating){var n,r=this.markupsExtension.markupsManager.getInEditMarkups();return this.markupsExtension.markupsManager.openActionGroup(),It(e,this.lastTranslationPoint,this.getMinChangeDistanceWorld())?(this.cancelTransformEditing(),n=!1):(r.forEach((function(e,t){e.translationHandler&&e.translationHandler.submitChanges(t<r.length-1)})),this.editEnd(),n=!0),this.markupsExtension.markupsManager.closeActionGroup(),this.translating=!1,this.lastTranslationPoint=null,n}return!1}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:if(this.translating)return this.cancelTransformEditing(),!0;break;case Autodesk.Viewing.KeyCode.UP:return this.handleKeyTranslation(this.markupsExtension.renderer.getCameraUpVector()),!0;case Autodesk.Viewing.KeyCode.DOWN:return this.handleKeyTranslation(this.markupsExtension.renderer.getCameraUpVector().negate()),!0;case Autodesk.Viewing.KeyCode.RIGHT:return this.handleKeyTranslation(this.markupsExtension.renderer.getCameraRightVector()),!0;case Autodesk.Viewing.KeyCode.LEFT:return this.handleKeyTranslation(this.markupsExtension.renderer.getCameraRightVector().negate()),!0}return!1}},{key:"handleKeyUp",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.UP:case Autodesk.Viewing.KeyCode.DOWN:case Autodesk.Viewing.KeyCode.RIGHT:case Autodesk.Viewing.KeyCode.LEFT:return this.keyTranslation.set(0,0,0),this.submitChanges(e.isDuringEdit),!0}return!1}},{key:"handleDoubleClick",value:function(e,t){return this.translating}},{key:"getCursor",value:function(){return"move"}},{key:"cancelTransformEditing",value:function(){this.markupsExtension.markupsManager.getInEditMarkups().forEach((function(e){e.syncEditState()})),this.translating=!1,this.lastTranslationPoint=null,this.editEnd()}},{key:"handleMouseTranslation",value:function(e){var t=this;this.markupsExtension.markupsTool.shiftDown&&(e=e.clone(),this.snapPointToAxis(e,this.buttonDownPos,90));var n=e.clone().sub(this.lastTranslationPoint),r=this.markupsExtension.markupsManager.getInEditMarkups();A.hasOneGroupInEdit(r)?this.handleTranslation(this.markup,n):r.forEach((function(e){t.handleTranslation(e,n)}))}},{key:"handleKeyTranslation",value:function(e){var t=e.multiplyScalar(this.markupsExtension.renderer.multiplyByNormaStrokeWidth(Le));this.keyTranslation.add(t),this.handleTranslation(this.markup,this.keyTranslation)}},{key:"handleTranslation",value:function(e,t){if(e.translationHandler){var n=t.clone().add(e.state.translation);e.translationHandler.updateEditState({translation:n})}}},{key:"intersect",value:function(e){return this.markup.intersect(e)}},{key:"isDragging",value:function(){return this.translating}}])&&Cn(t.prototype,n),r&&Cn(t,r),A}(rn);function Un(e){return(Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Qn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ln(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Fn(e,t){return(Fn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Rn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_n(e);if(t){var i=_n(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Hn(this,n)}}function Hn(e,t){return!t||"object"!==Un(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _n(e){return(_n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Dn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fn(e,t)}(A,e);var t,n,r,i=Rn(A);function A(){return Qn(this,A),i.apply(this,arguments)}return t=A,(n=[{key:"handleMouseMove",value:function(e){return!!this.activeAnchor&&(e=this.getSnappedPosition(),this.markup.applyInverseRotation(e),this.markup.applyInverseScaleAndTranslation(e),this.markupsExtension.markupsTool.shiftDown&&this.snapAxis(e),this.updateActiveAnchor(e),!0)}},{key:"handleButtonDown",value:function(e,t){return!!this.activeAnchor||(this.activeAnchor=this.intersect(e),this.activeAnchor&&(this.originalAnchor=this.activeAnchor.clone(),this.editStart()),!!this.activeAnchor)}},{key:"handleButtonUp",value:function(e,t){return!!this.activeAnchor&&(e=this.getSnappedPosition(),this.markup.applyInverseRotation(e),this.markup.applyInverseScaleAndTranslation(e),this.markupsExtension.markupsTool.shiftDown&&this.snapAxis(e),this.updateActiveAnchor(e),It(this.activeAnchor,this.originalAnchor,this.getMinChangeDistanceWorld())?this.cancelAnchorEditing():(this.submitChanges(),this.editEnd()),this.activeAnchor=null,!0)}},{key:"handleKeyDown",value:function(e,t){if(this.activeAnchor)switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:return this.cancelAnchorEditing(),!0}return!1}},{key:"handleKeyUp",value:function(e,t){}},{key:"handleDoubleClick",value:function(e,t){}},{key:"updateActiveAnchor",value:function(e){this.markup.getAnchors(),this.activeAnchor.copy(e),this.updateEditStateAnchors(),this.handleCompensation()}},{key:"cancelAnchorEditing",value:function(){this.activeAnchor=null,this.markup.syncEditState(),this.updateEditStateAnchors(),this.editEnd()}},{key:"isDragging",value:function(){return!!this.activeAnchor}},{key:"snapAxis",value:function(e){var t=this,n=this.markup.getAnchors(),r=n.findIndex((function(e){return e===t.activeAnchor}));n[r-1]?this.snapPointToAxis(e,n[r-1],Ue):n[r+1]&&this.snapPointToAxis(e,n[r+1],Ue)}},{key:"intersect",value:function(e){var t=this;e=e.clone(),this.markup.applyInverseRotation(e),this.markup.applyInverseScaleAndTranslation(e);var n=this.markupsExtension.renderer.worldToClient(e);return this.markup.getAnchors().find((function(e){if(t.markup.isAnchorHandlingAllowed(e))return t.markupsExtension.renderer.worldToClient(e).distanceTo(n)<=ke}))}},{key:"getCursor",value:function(){return this.activeAnchor?"grabbing":"grab"}}])&&Ln(t.prototype,n),r&&Ln(t,r),A}(rn);function On(e){return(On="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function In(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Nn(e,t){return(Nn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Kn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Gn(e);if(t){var i=Gn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Vn(this,n)}}function Vn(e,t){return!t||"object"!==On(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Gn(e){return(Gn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var jn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Nn(e,t)}(A,e);var t,n,r,i=Kn(A);function A(){return In(this,A),i.apply(this,arguments)}return t=A,(n=[{key:"handleMouseMove",value:function(e){return this.rotating&&this.handleRotation(e),this.rotating}},{key:"handleButtonDown",value:function(e,t){return this.rotating||(this.rotating=this.intersect(e),this.rotating&&(this.originalRotation=this.markup.getRotation(),this.handleRotation(e),this.editStart())),this.rotating}},{key:"handleButtonUp",value:function(e,t){return!!this.rotating&&(this.rotating=!1,Math.abs(this.originalRotation-this.markup.getRotation())<Me?this.cancelTransformEditing():(this.submitChanges(),this.editEnd()),this.originalRotation=null,!0)}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:if(this.rotating)return this.cancelTransformEditing(),!0}return!1}},{key:"handleKeyUp",value:function(e,t){return!1}},{key:"handleDoubleClick",value:function(e,t){return this.rotating}},{key:"getCursor",value:function(){return"url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIyMHB4IiBoZWlnaHQ9IjIwcHgiIHZpZXdCb3g9IjAgMCAyMCAyMCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4gICAgICAgIDx0aXRsZT5tb3VzZSBjdXJzb3Ivcm90YXRlPC90aXRsZT4gICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+ICAgIDxkZWZzPiAgICAgICAgPHBhdGggZD0iTTMsOCBMMSw4IEw0LDQgTDcsOCBMNSw4IEM1LDEwLjQ4NTI4MTQgNy41MTQ3MTg2MywxMyAxMCwxMyBDMTIuNDg1MjgxNCwxMyAxNSwxMC40ODUyODE0IDE1LDggTDEzLDggTDE2LDQgTDE5LDggTDE3LDggQzE3LDExLjU4OTg1MDkgMTMuNTg5ODUwOSwxNSAxMCwxNSBDNi40MTAxNDkxMywxNSAzLDExLjU4OTg1MDkgMyw4IFoiIGlkPSJwYXRoLTEiPjwvcGF0aD4gICAgICAgIDxmaWx0ZXIgeD0iLTMzLjMlIiB5PSItNjkuNyUiIHdpZHRoPSIxNjYuNyUiIGhlaWdodD0iMTk3LjAlIiBmaWx0ZXJVbml0cz0ib2JqZWN0Qm91bmRpbmdCb3giIGlkPSJmaWx0ZXItMiI+ICAgICAgICAgICAgPGZlTW9ycGhvbG9neSByYWRpdXM9IjEiIG9wZXJhdG9yPSJkaWxhdGUiIGluPSJTb3VyY2VBbHBoYSIgcmVzdWx0PSJzaGFkb3dTcHJlYWRPdXRlcjEiPjwvZmVNb3JwaG9sb2d5PiAgICAgICAgICAgIDxmZU9mZnNldCBkeD0iMCIgZHk9Ii0yIiBpbj0ic2hhZG93U3ByZWFkT3V0ZXIxIiByZXN1bHQ9InNoYWRvd09mZnNldE91dGVyMSI+PC9mZU9mZnNldD4gICAgICAgICAgICA8ZmVHYXVzc2lhbkJsdXIgc3RkRGV2aWF0aW9uPSIxIiBpbj0ic2hhZG93T2Zmc2V0T3V0ZXIxIiByZXN1bHQ9InNoYWRvd0JsdXJPdXRlcjEiPjwvZmVHYXVzc2lhbkJsdXI+ICAgICAgICAgICAgPGZlQ29tcG9zaXRlIGluPSJzaGFkb3dCbHVyT3V0ZXIxIiBpbjI9IlNvdXJjZUFscGhhIiBvcGVyYXRvcj0ib3V0IiByZXN1bHQ9InNoYWRvd0JsdXJPdXRlcjEiPjwvZmVDb21wb3NpdGU+ICAgICAgICAgICAgPGZlQ29sb3JNYXRyaXggdmFsdWVzPSIwIDAgMCAwIDAgICAwIDAgMCAwIDAgICAwIDAgMCAwIDAgIDAgMCAwIDAuNSAwIiB0eXBlPSJtYXRyaXgiIGluPSJzaGFkb3dCbHVyT3V0ZXIxIj48L2ZlQ29sb3JNYXRyaXg+ICAgICAgICA8L2ZpbHRlcj4gICAgPC9kZWZzPiAgICA8ZyBpZD0ibW91c2UtY3Vyc29yL3JvdGF0ZSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+ICAgICAgICA8ZyBpZD0iQ29tYmluZWQtU2hhcGUiIGZpbGwtcnVsZT0ibm9uemVybyIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAuMDAwMDAwLCA5LjUwMDAwMCkgcm90YXRlKC0xODAuMDAwMDAwKSB0cmFuc2xhdGUoLTEwLjAwMDAwMCwgLTkuNTAwMDAwKSAiPiAgICAgICAgICAgIDx1c2UgZmlsbD0iYmxhY2siIGZpbGwtb3BhY2l0eT0iMSIgZmlsdGVyPSJ1cmwoI2ZpbHRlci0yKSIgeGxpbms6aHJlZj0iI3BhdGgtMSI+PC91c2U+ICAgICAgICAgICAgPHBhdGggc3Ryb2tlPSIjRkZGRkZGIiBzdHJva2Utd2lkdGg9IjEiIGQ9Ik0yLjUyMDExNDgzLDguNSBMMy40MjUyNjAwOGUtMTIsOC41IEw0LDMuMTY2NjY2NjcgTDgsOC41IEw1LjUzODA0MjA3LDguNSBDNS44NDQ5MzkyOCwxMC41NDE1MjMyIDcuOTU3NDAyMDYsMTIuNSAxMCwxMi41IEMxMi4wNDI1OTc5LDEyLjUgMTQuMTU1MDYwNywxMC41NDE1MjMyIDE0LjQ2MTk1NzksOC41IEwxMiw4LjUgTDE2LDMuMTY2NjY2NjcgTDIwLDguNSBMMTcuNDc5ODg1Miw4LjUgQzE3LjE4NTI0NywxMi4xNzM1MTU3IDEzLjY5ODgwMSwxNS41IDEwLDE1LjUgQzYuMzAxMTk5MDIsMTUuNSAyLjgxNDc1MzAzLDEyLjE3MzUxNTcgMi41MjAxMTQ4Myw4LjUgWiIgZmlsbD0iIzAwMDAwMCIgZmlsbC1ydWxlPSJldmVub2RkIj48L3BhdGg+ICAgICAgICA8L2c+ICAgIDwvZz48L3N2Zz4=) 10 10, auto"}},{key:"cancelTransformEditing",value:function(){this.markup.syncEditState(),this.rotating=!1,this.editEnd()}},{key:"handleRotation",value:function(e){var t=this.markupsExtension.renderer.worldToClient(e),n=this.markup.getClientCenter(),r=t.clone().sub(n).normalize(),i=at.getSignedAngle(r,this.markupsExtension.renderer.getCameraUpVector(),this.markupsExtension.renderer.getCameraEyeVector());if(this.markupsExtension.markupsTool.shiftDown){var A=at.degreesToRadians(Ue);i=Math.ceil((i-at.degreesToRadians(Ue/2))/A)*A}this.updateEditState({rotation:i})}},{key:"getRotationAnchor",value:function(){var e=this.markup.getClientBoundingBox(!0),t=e.center().add(new THREE.Vector3(0,xe+e.size().y/2,0)),n=e.center(),r=this.markup.getRotation()+this.markupsExtension.renderer.getCameraRotation();return at.applyRotation(t,r,n,this.markupsExtension.renderer.absoluteEyeVec),t}},{key:"intersect",value:function(e){e=e.clone();var t=this.markupsExtension.renderer.worldToClient(e);return this.getRotationAnchor().distanceTo(t)<=ke}},{key:"isDragging",value:function(){return this.rotating}}])&&Pn(t.prototype,n),r&&Pn(t,r),A}(rn);function Yn(e){return(Yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Wn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Xn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Jn(e,t){return(Jn=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function zn(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Zn(e);if(t){var i=Zn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return qn(this,n)}}function qn(e,t){return!t||"object"!==Yn(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Zn(e){return(Zn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var $n=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jn(e,t)}(A,e);var t,n,r,i=zn(A);function A(){return Wn(this,A),i.apply(this,arguments)}return t=A,(n=[{key:"handleMouseMove",value:function(e){if(this.scaling){var t=e.clone();this.markup.applyInverseRotation(t),this.markup.applyInverseCameraRotation(t),this.handleScaling(t)}return this.scaling}},{key:"handleButtonDown",value:function(e,t){return this.scaling||(this.scaleAnchor=this.intersect(e),this.scaling=!!this.scaleAnchor,this.scaling&&(this.originalPoint=e.clone(),this.editStart())),this.scaling}},{key:"handleButtonUp",value:function(e,t){return!!this.scaling&&(this.scaleAnchor=null,this.scaling=!1,this.isSamePoint(e,this.originalPoint)?this.cancelTransformEditing():(this.submitChanges(),this.editEnd()),!0)}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:if(this.scaling)return this.cancelTransformEditing(),!0}return!1}},{key:"handleDoubleClick",value:function(e,t){return this.scaling}},{key:"getCursor",value:function(){if(this.cursor&&this.scaling)return this.cursor;var e=this.markup.getClientCenter(),t=this.lastIntersectPoint.clone().sub(e).normalize(),n=new THREE.Vector3(1,0,0),r=this.lastIntersectPoint.y<e.y?1:-1,i=at.radiansToDegrees(t.angleTo(n))*r,A=45*Math.ceil((i-22.5)/45);switch(this.cursor=null,A){case 180:case-180:case 0:this.cursor="ew-resize";break;case 90:case-90:this.cursor="ns-resize";break;case 135:case-45:this.cursor="nwse-resize";break;case-135:case 45:this.cursor="nesw-resize"}return this.cursor}},{key:"cancelTransformEditing",value:function(){this.markup.syncEditState(),this.scaleAnchor=null,this.scaling=!1,this.editEnd()}},{key:"handleScaling",value:function(e){var t=this,n=this.markupsExtension.renderer.worldToClient(e);this.originalBoundingBox=at.swapBoundingBoxY(this.markup.getWorldBoundingBox().clone()),this.scaleAnchor.axisList.forEach((function(e){var r=t.getAnchorPosByAxisList([e],!1),i=n.clone().sub(e.clone().multiplyScalar(t.markup.getMarginSize()));t.resize(i,r,e)})),this.updateTranslation()}},{key:"updateTranslation",value:function(){var e=this.scaleAnchor.axisList.reduce((function(e,t){return e.clone().add(t)})),t=at.swapBoundingBoxY(this.markup.getWorldBoundingBox().clone()).size().sub(this.originalBoundingBox.size()).multiply(e).multiplyScalar(.5),n=this.markupsExtension.renderer.getCameraEyeVector();at.applyRotation(t,this.markup.getRotation(),new THREE.Vector3,n);var r=t.add(this.markup.editState.translation);this.updateEditState({translation:r}),this.originalBoundingBox=at.swapBoundingBoxY(this.markup.getWorldBoundingBox().clone())}},{key:"resize",value:function(e,t,n,r){var i=t.clone().add(n),A=Nt(e,t,i),o=this.markup.getClientBoundingBox(!1),a=this.getOppositePoint(t,o),s=A.clone().sub(a),u=n.clone().multiply(s),c=o.size().multiply(n).length(),l=s.length();if(r||!(l<this.markup.getMinimumSize())){if(!r&&u.x+u.y<0){var h=a.clone().add(n);return this.resize(h,t,n,!0),this.updateTranslation(),n.negate(),this.applyReflection(n),void this.resize(e,h,n,!0)}var d=l/c-1,p=(this.markupsExtension.markupsTool.shiftDown?new THREE.Vector3(1,1,0):new THREE.Vector3(Math.abs(n.x),Math.abs(n.y),Math.abs(n.z))).clone().multiplyScalar(d).addScalar(1).clone().multiply(this.markup.editState.scale);this.updateEditState({scale:p})}}},{key:"intersect",value:function(e){var t=this.getScaleAnchors(),n=e.clone();this.markup.applyInverseRotation(n),this.markup.applyInverseCameraRotation(n);var r=this.markupsExtension.renderer.worldToClient(n);return this.lastIntersectPoint=r,t.find((function(e){return e.pos.distanceTo(r)<=ke}))}},{key:"isDragging",value:function(){return this.scaling}},{key:"getOppositePoint",value:function(e,t){var n=t.center(),r=e.clone().distanceTo(n),i=e.clone().sub(n).normalize();return e.clone().sub(i.multiplyScalar(2*r))}},{key:"applyReflection",value:function(e){var t=new THREE.Vector3(1,1,1).sub(e.clone().multiply(e).multiplyScalar(2)),n=this.markup.editState.scale.clone();n.multiply(t),this.updateEditState({scale:n})}},{key:"getScaleAnchors",value:function(){return this.getEditState().anchors.length<2?[]:this.options.onlyHorizontal?[this.getEastAnchor(),this.getWestAnchor()]:[this.getEastAnchor(),this.getWestAnchor(),this.getNorthAnchor(),this.getSouthAnchor(),this.getNorthWestAnchor(),this.getSouthWestAnchor(),this.getNorthEastAnchor(),this.getSouthEastAnchor()]}},{key:"getAnchorPosByAxisList",value:function(e,t){var n=this.markup.getClientBoundingBox(t),r=n.center();return e.forEach((function(e){var t=e.clone().multiply(n.size().multiplyScalar(.5));r.add(t)})),r}},{key:"getAnchor",value:function(e,t){return{pos:this.getAnchorPosByAxisList(e,!this.markup.belongsToGroup()),axisList:e,id:t}}},{key:"getNorthAnchor",value:function(){return this.getAnchor([new THREE.Vector3(0,1,0)],"n")}},{key:"getSouthAnchor",value:function(){return this.getAnchor([new THREE.Vector3(0,-1,0)],"s")}},{key:"getEastAnchor",value:function(){return this.getAnchor([new THREE.Vector3(1,0,0)],"e")}},{key:"getWestAnchor",value:function(){return this.getAnchor([new THREE.Vector3(-1,0,0)],"w")}},{key:"getNorthWestAnchor",value:function(){return this.getAnchor([new THREE.Vector3(0,1,0),new THREE.Vector3(-1,0,0)],"nw")}},{key:"getSouthWestAnchor",value:function(){return this.getAnchor([new THREE.Vector3(0,-1,0),new THREE.Vector3(-1,0,0)],"sw")}},{key:"getNorthEastAnchor",value:function(){return this.getAnchor([new THREE.Vector3(0,1,0),new THREE.Vector3(1,0,0)],"ne")}},{key:"getSouthEastAnchor",value:function(){return this.getAnchor([new THREE.Vector3(0,-1,0),new THREE.Vector3(1,0,0)],"se")}}])&&Xn(t.prototype,n),r&&Xn(t,r),A}(rn);function er(e){return(er="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function tr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function nr(e,t){return(nr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ar(e);if(t){var i=Ar(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ir(this,n)}}function ir(e,t){return!t||"object"!==er(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ar(e){return(Ar=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var or=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&nr(e,t)}(A,Autodesk.Viewing.EventDispatcher);var t,n,r,i=rr(A);function A(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A),(e=i.call(this)).undoStack=[],e.redoStack=[],e.isGroupOpen=!1,e.nextActionId=0,e}return t=A,(n=[{key:"execute",value:function(e){this.clearStack(this.redoStack),e.id=this.nextActionId,this.nextActionId+=1,e.redo(),this.isGroupOpen?this.group.push(e):this.undoStack.push(e),e.trigger=A.EXECUTE,this.notify(e)}},{key:"undo",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(0!==this.undoStack.length)if(this.isGroupOpen)console.warn("Cannot undo while action group is open!");else{var t=this.undoStack.pop();if(e&&this.redoStack.push(t),t instanceof ft)t.undo();else for(var n=t.length-1;n>=0;n--)t[n].undo();t.trigger=A.UNDO,this.notify(t)}}},{key:"redo",value:function(){if(0!==this.redoStack.length)if(this.isGroupOpen)console.warn("Cannot redo while action group is open!");else{var e=this.redoStack.pop();if(this.undoStack.push(e),e instanceof ft)e.redo();else for(var t=0;t<e.length;t++)e[t].redo();e.trigger=A.REDO,this.notify(e)}}},{key:"clear",value:function(){this.clearStack(this.undoStack),this.clearStack(this.redoStack),this.isGroupOpen=!1,this.group=[],this.notify([])}},{key:"clearStack",value:function(e){e.splice(0,e.length)}},{key:"isUndoStackEmpty",value:function(){return 0===this.undoStack.length}},{key:"isRedoStackEmpty",value:function(){return 0===this.redoStack.length}},{key:"notify",value:function(e){e=e instanceof ft?[e]:e,this.dispatchEvent({type:A.HISTORY_CHANGED_EVENT,actionGroup:e,hasUndo:!this.isUndoStackEmpty(),hasRedo:!this.isRedoStackEmpty()})}},{key:"openActionGroup",value:function(){this.isGroupOpen?console.warn("Cannot open a new action group while another one is still open"):(this.group=[],this.undoStack.push(this.group),this.isGroupOpen=!0)}},{key:"closeActionGroup",value:function(){0===this.group.length&&this.undoStack.pop(),this.isGroupOpen=!1}}])&&tr(t.prototype,n),r&&tr(t,r),A}();or.HISTORY_CHANGED_EVENT="action-manager.history.changed.event",or.UNDO="action-manager.undo",or.REDO="action-manager.redo",or.EXECUTE="action-manager.execute";var ar=n(354),sr=n.n(ar);n(74);function ur(e){return(ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function cr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function lr(e,t){return(lr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function hr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=fr(e);if(t){var i=fr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return dr(this,n)}}function dr(e,t){return!t||"object"!==ur(t)&&"function"!=typeof t?pr(e):t}function pr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fr(e){return(fr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var yr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&lr(e,t)}(o,e);var t,n,r,i=hr(o);function o(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this,e,t,n)).textboxActive=!1,r.submitChangesDebounced=dt.debounce(r.options.submitChanges||r.submitChanges,Ke),Autodesk.Viewing.isIOSDevice()&&(r.onMarkupEditEnabledBinded=r.onMarkupEditEnabled.bind(pr(r)),r.onMarkupEditDisabledBinded=r.onMarkupEditDisabled.bind(pr(r)),r.onMarkupEditStartBinded=r.onMarkupEditStart.bind(pr(r)),r.onMarkupEditEndBinded=r.onMarkupEditEnd.bind(pr(r)),r.onTouchEndBinded=r.onTouchEnd.bind(pr(r)),r.markupsExtension.markupsManager.addEventListener(A.MARKUP_ENABLE_EDIT,r.onMarkupEditEnabledBinded),r.markupsExtension.markupsManager.addEventListener(A.MARKUP_DISABLE_EDIT,r.onMarkupEditDisabledBinded)),r}return t=o,(n=[{key:"intersect",value:function(e){if(!this.markup.isTextMarkup())return!1;e=e.clone(),this.markup.applyInverseRotation(e),this.markup.applyInverseCameraRotation(e);var t=this.markupsExtension.renderer.worldToClient(e);return this.markup.getClientBoundingBox(!0).containsPoint(t)}},{key:"updateCaretPosition",value:function(){var e=this.markupsExtension.renderer.textRenderer.getLabel(this.markup),t=this.getUpdatedCaretPosition(e);0===t.start&&0===t.end||(this.lastCaretPosition=t)}},{key:"getCursor",value:function(){return"pointer"}},{key:"handleDoubleClick",value:function(e,t){if(Autodesk.Viewing.isIOSDevice())return!1;if(this.intersect(e)){var n=this.markupsExtension.renderer.textRenderer.getLabel(this.markup);return this.lastCaretPosition={start:n.innerText.length,end:n.innerText.length},this.startTextEditing(),!0}return!1}},{key:"handleButtonDown",value:function(e){return this.textboxActive?(this.submitChangesDebounced.flush(),this.endTextEditing(),!0):this.isEmpty()}},{key:"handleButtonUp",value:function(e){return!!this.isEmpty()&&(this.onEmptyTextMarkup(),!0)}},{key:"isEmpty",value:function(){return""===this.markup.editState.text.trim()}},{key:"onEmptyTextMarkup",value:function(){this.options.onEmptyTextMarkup?(this.textboxActive=!1,this.options.onEmptyTextMarkup()):this.deleteEmptyTextMarkup()}},{key:"deleteEmptyTextMarkup",value:function(){this.textboxActive=!1,this.markupsExtension.markupsManager.actionManager.undo(),this.markupsExtension.markupsManager.deleteMarkup(this.markup)}},{key:"onCameraChanged",value:function(e){this.markupsExtension.renderer.textRenderer.getLabel(this.markup).focus()}},{key:"startTextEditing",value:function(e){var t=this,n=this.markupsExtension.renderer.textRenderer.getLabel(this.markup);if(this.label=n,n){this.textboxActive=!0,n.style.position="fixed",n.setAttribute("contenteditable",!0),n.style.webkitUserSelect="text",n.style.userSelect="text",n.style.pointerEvents="auto",n.setAttribute("spellcheck",!1),this.setCaretPosition(n),n.blur(),n.focus();var r=this.getDocument();e&&r.execCommand("selectAll",!1,null),this.onCameraChanged=function(){n.focus()};var i=Autodesk.Viewing.isSafari()||Autodesk.Viewing.isIOSDevice();this.onCameraChangedDebounced=dt.debounce(this.onCameraChanged,5),i&&this.markupsExtension.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedDebounced),this.onKeyDown=function(e){n.focus();var r=n.getBoundingClientRect(),A=t.markupsExtension.viewer.impl.getCanvasBoundingClientRect(),o=t.markup.getTextStyle(),a=Vt("AA",o),s=t.markupsExtension.renderer.getFontToWorldScale(),u=t.markupsExtension.renderer.sizeFromWorldToClient(s),c=function(){return r.bottom+a.height*u>A.bottom-30},l=t.getWindow();switch(e.keyCode){case Autodesk.Viewing.KeyCode.ESCAPE:t.submitChangesDebounced.flush(),t.endTextEditing(),t.textboxActive=!0;break;case Autodesk.Viewing.KeyCode.ENTER:i&&c()||t.options.singleLine?e.preventDefault():l.getSelection().anchorNode.firstChild&&"BR"===l.getSelection().anchorNode.firstChild.tagName||0===l.getSelection().anchorOffset?(e.preventDefault(),Autodesk.Viewing.isIE11&&(t.enterPressed=!0)):t.enterPressed=!0;break;case Autodesk.Viewing.KeyCode.BACKSPACE:t.backspacePressed=!0;break;default:i&&(function(){var e=t.getUpdatedCaretPosition(n),i=t.getWindow().getSelection().anchorNode.parentElement;i.value=i.innerText;var o=sr()(i,e.end);return r.left+(o.left+a.width*u)>A.right-30}()?c()||t.options.singleLine?e.preventDefault():r.right<A.right?t.addNewline=!0:e.preventDefault():c()&&e.preventDefault())}var h=t.lastCaretPosition.end-t.lastCaretPosition.start;!e.metaKey&&e.keyCode>47&&n.innerText.length-h>Je&&e.preventDefault(),Autodesk.Viewing.isIE11&&t.onInput(!0)},this.onKeyUp=function(){t.onInput(!0)},this.onInput=function(e){n.innerText||(n.innerText=Autodesk.Viewing.isIE11?" ":String.fromCharCode(10)),t.lastCaretPosition=t.getUpdatedCaretPosition(n);var r=n.innerText;t.addNewline&&(r+="\r\n"),Autodesk.Viewing.isIE11&&!0===e&&(r=r.replace(/(\r\n){2,}/g,"\r\n"),t.enterPressed&&(r+="\r\n\r\n")),t.options.singleLine||t.expandBoundingBox(r),t.updateEditState({text:r}),t.submitChangesDebounced(),t.enterPressed=!1,t.addNewline=!1,t.backspacePressed=!1},this.onPaste=function(e){e.preventDefault();var r=t.getWindow(),i=t.getDocument(),A=e.clipboardData&&e.clipboardData.getData("text")||r.clipboardData&&r.clipboardData.getData&&r.clipboardData.getData("Text");if(A){var o=t.lastCaretPosition.end-t.lastCaretPosition.start,a=Je+o-n.innerText.length;if(A.length>a&&(A=A.substr(0,a)+"â¦"),Autodesk.Viewing.isIE11){var s=r.getSelection(),u=s.getRangeAt(0),c=i.createDocumentFragment();c.appendChild(i.createElement("br"));var l=i.createElement("span");l.innerText=A,c.appendChild(l),u.insertNode(c),u.selectNodeContents(l),s.removeAllRanges(),s.addRange(u),i.execCommand("ms-endUndoUnit",!1,null)}else i.execCommand("insertText",!1,A)}},this.onMouseWheel=function(e){var n=new MouseEvent(e.type,e);n.wheelDelta=e.wheelDelta,n.deltaY=e.deltaY,t.markupsExtension.viewer.toolController.domElement.dispatchEvent(n),n.defaultPrevented&&e.preventDefault()},this.onDOMMouseScroll=function(e){var n=new MouseEvent(e.type,e);n.wheelDelta=e.wheelDelta,n.deltaY=e.deltaY,t.markupsExtension.viewer.toolController.domElement.dispatchEvent(n),n.defaultPrevented&&e.preventDefault()},this.onMouseMove=function(e){var n=new MouseEvent(e.type,e);t.markupsExtension.viewer.toolController.domElement.dispatchEvent(n),n.defaultPrevented&&e.preventDefault()},n.addEventListener("keydown",this.onKeyDown),n.addEventListener("keypress",this.onKeyPress),n.addEventListener("input",this.onInput),n.addEventListener("paste",this.onPaste),Autodesk.Viewing.isIE11&&n.addEventListener("keyup",this.onKeyUp),n.addEventListener("mousewheel",this.onMouseWheel),n.addEventListener("DOMMouseScroll",this.onDOMMouseScroll),n.addEventListener("mousemove",this.onMouseMove),n.addEventListener("mouseup",(function(){setTimeout((function(){t.lastCaretPosition=t.getUpdatedCaretPosition(n)}),25)})),n.addEventListener("touchend",(function(){setTimeout((function(){t.lastCaretPosition=t.getUpdatedCaretPosition(n)}),25)})),this.onHistoryChangedBinded=this.onHistoryChanged.bind(this),this.endTextEditingBinded=this.endTextEditing.bind(this),this.onStyleChangedBinded=this.onStyleChanged.bind(this),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DISABLE_EDIT,this.endTextEditingBinded,{once:!0}),this.markupsExtension.markupsManager.addEventListener(or.HISTORY_CHANGED_EVENT,this.onHistoryChangedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_STYLE_PROPERTY_CHANGED,this.onStyleChangedBinded),this.markupsExtension.markupsManager.dispatchEvent({type:A.TEXT_EDITING_STARTED})}}},{key:"removeSelection",value:function(){this.getWindow().getSelection().removeAllRanges(),this.label.style.position="absolute",this.label.style.pointerEvents="none",this.label.setAttribute("contenteditable",!1),this.label.style.webkitUserSelect="none",this.label.style.userSelect="none"}},{key:"setCaretPosition",value:function(e){this.lastCaretPosition||(this.lastCaretPosition={start:0,end:e.innerText.length});var t=this.getWindow(),n=this.getDocument().createRange(),r=t.getSelection(),i=Math.min(this.lastCaretPosition.start,e.childNodes[0].length),A=Math.min(this.lastCaretPosition.end,e.childNodes[0].length);n.setStart(e.childNodes[0],i),n.setEnd(e.childNodes[0],A),r.removeAllRanges(),r.addRange(n)}},{key:"getUpdatedCaretPosition",value:function(e){var t,n,r={start:0,end:0},i=this.getWindow();return i.getSelection?(t=i.getSelection()).rangeCount&&((n=t.getRangeAt(0)).commonAncestorContainer.parentNode===e||n.commonAncestorContainer.parentNode.parentNode===e)&&(r={start:n.startOffset,end:n.endOffset}):r={start:e.innerText.length,end:e.innerText.length},r}},{key:"onHistoryChanged",value:function(e){var t=this;e.actionGroup.forEach((function(e){e.trigger!==or.UNDO&&e.trigger!==or.REDO||t.markupsExtension.renderer&&t.markupsExtension.renderer.textRenderer.getLabel(t.markup)&&t.endTextEditing()}))}},{key:"endTextEditing",value:function(){if(this.textboxActive&&this.markupsExtension.renderer){var e=this.markupsExtension.renderer.textRenderer.getLabel(this.markup);e.removeEventListener("keydown",this.onKeyDown),e.removeEventListener("input",this.onInput),e.removeEventListener("paste",this.onPaste),Autodesk.Viewing.isIE11&&e.removeEventListener("keyup",this.onKeyUp),e.removeEventListener("mousewheel",this.onMouseWheel),e.removeEventListener("DOMMouseScroll",this.onDOMMouseScroll),e.removeEventListener("mousemove",this.onMouseMove),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DISABLE_EDIT,this.endTextEditingBinded),this.markupsExtension.markupsManager.removeEventListener(or.HISTORY_CHANGED_EVENT,this.onHistoryChangedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_STYLE_PROPERTY_CHANGED,this.onStyleChangedBinded),this.markupsExtension.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedDebounced),this.getWindow().getSelection().removeAllRanges(),e.style.position="absolute",e.style.pointerEvents="none",e.blur(),e.setAttribute("contenteditable",!1),e.style.webkitUserSelect="none",e.style.userSelect="none",this.textboxActive=!1,this.isEmpty()?this.onEmptyTextMarkup():(this.markup.syncEditState(),this.editEnd()),this.markupsExtension.markupsManager.dispatchEvent({type:A.TEXT_EDITING_ENDED})}}},{key:"onStyleChanged",value:function(){this.textboxActive&&this.onCameraChanged()}},{key:"handleKeyDown",value:function(e,t){return!(!this.textboxActive||e.keyCode!==Autodesk.Viewing.KeyCode.ESCAPE||(this.isEmpty()&&this.onEmptyTextMarkup(),this.textboxActive=!1,0))}},{key:"expandBoundingBox",value:function(e){var t=this.getEditState(),n=t.translation,r=t.scale,i=this.markup.getTextStyle(),A=this.markup.getWorldBoundingBoxTextOnly().size(),o=this.markupsExtension.renderer.getFontToWorldScale(),a=this.markup.getTextWidthInFontScale().width;i.width="".concat(a,"px");var s=Vt(this.markup.editState.text,i),u=Vt(e,i);if((this.enterPressed||this.backspacePressed||this.addNewline)&&u.height!==s.height){var c=(u.height-s.height)*o;this.translateBoundingBox(c)}else if(u.height>s.height){i.width=null;var l=Vt("A",i).width*o;r.multiply(new THREE.Vector3((A.x+l)/A.x,1,1));var h=this.markup.getRotation(),d=new THREE.Vector3(l/2,0,0);if(0!==h){var p=this.markupsExtension.renderer.getCameraEyeVector();at.applyRotation(d,h,new THREE.Vector3,p)}n.add(d),this.updateEditState({scale:r,translation:n})}}},{key:"translateBoundingBox",value:function(e){var t=this.getEditState().translation,n=this.markup.getBoundingBoxVerticalTranslation(e);t.add(n),this.updateEditState({translation:t})}},{key:"destroy",value:function(){this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_ENABLE_EDIT,this.onMarkupEditStartBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_EDIT_END,this.onMarkupEditEndBinded)}},{key:"onMarkupEditEnabled",value:function(e){var t=this;e.markup===this.markup&&(this.markupsExtension.markupsManager.hasEventListener(A.MARKUP_EDIT_START,this.onMarkupEditStartBinded)||this.markupsExtension.markupsManager.addEventListener(A.MARKUP_EDIT_START,this.onMarkupEditStartBinded),this.markupsExtension.markupsManager.hasEventListener(A.MARKUP_EDIT_END,this.onMarkupEditEndBinded)||this.markupsExtension.markupsManager.addEventListener(A.MARKUP_EDIT_END,this.onMarkupEditEndBinded),setTimeout((function(){var e=t.markupsExtension.renderer.textRenderer.getLabel(t.markup);e&&(e.addEventListener("touchend",t.onTouchEndBinded),e.style.pointerEvents="auto")}),10))}},{key:"onTouchEnd",value:function(e){e.preventDefault(),e.stopPropagation(),this.startTextEditing()}},{key:"onMarkupEditDisabled",value:function(e){if(e.markup===this.markup){var t=this.markupsExtension.renderer.textRenderer.getLabel(this.markup);t&&(t.removeEventListener("touchend",this.onTouchEndBinded),t.style.pointerEvents="none")}}},{key:"onMarkupEditStart",value:function(e){this.textboxActive&&(this.textboxWasActive=!0),e.markup===this.markup&&e.handler instanceof jn&&this.removeSelection()}},{key:"onMarkupEditEnd",value:function(e){e.handler instanceof o||e.markup===this.markup&&this.textboxWasActive&&e.handler instanceof jn&&(this.textboxWasActive=!1,this.startTextEditing())}}])&&cr(t.prototype,n),r&&cr(t,r),o}(rn);function gr(e){return(gr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Er(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Br(e,t){return(Br=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function vr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=kr(e);if(t){var i=kr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return wr(this,n)}}function wr(e,t){return!t||"object"!==gr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function kr(e){return(kr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Cr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Br(e,t)}(A,e);var t,n,r,i=vr(A);function A(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Er(this,A),i.call(this,e,t,n)}return t=A,(n=[{key:"handleMouseMove",value:function(e){return this.translating&&this.handleMouseTranslation(e),this.translating}},{key:"handleButtonDown",value:function(e,t){if(!this.translating){if(this.translating=this.intersect(e),this.translating){var n=this.markup.getAnchors(),r=n[1].clone().sub(n[0]).normalize(),i=this.markupsExtension.renderer.getCameraEyeVector();this.normal=r.clone().cross(i).normalize(),this.editStart()}return this.translating}return!0}},{key:"getPointOnNormal",value:function(e){var t=this.markup.getAnchors(),n=t[0].clone().add(this.normal);return Nt(e,t[0],n)}},{key:"handleButtonUp",value:function(e,t){if(this.translating){var n=this.getPointOnNormal(e);return It(n,this.lastTranslationPoint,this.getMinChangeDistanceWorld())?this.cancelTransformEditing():this.lastTranslationPoint&&(this.submitChanges(),this.editEnd()),this.translating=!1,this.lastTranslationPoint=null,!0}return!1}},{key:"handleDoubleClick",value:function(e,t){return this.translating}},{key:"getCursor",value:function(){return"move"}},{key:"cancelTransformEditing",value:function(){this.markup.syncEditState(),this.translating=!1,this.lastTranslationPoint=null,this.editEnd()}},{key:"handleMouseTranslation",value:function(e){var t=this.getPointOnNormal(e);this.lastTranslationPoint||(this.lastTranslationPoint=t);var n=t.clone().sub(this.lastTranslationPoint).clone().add(this.markup.state.translation);this.updateEditState({translation:n})}},{key:"intersect",value:function(e){e=e.clone(),this.markup.applyInverseRotation(e);var t=this.markupsExtension.renderer.worldToClient(e);return this.markup.getClientBoundingBox(!0).containsPoint(t)}},{key:"isDragging",value:function(){return this.translating}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:if(this.translating)return this.cancelTransformEditing(),!0}return!1}}])&&mr(t.prototype,n),r&&mr(t,r),A}(rn);function br(e){return(br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Sr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Tr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Mr(e,t){return(Mr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Qr(e);if(t){var i=Qr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ur(this,n)}}function Ur(e,t){return!t||"object"!==br(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Qr(e){return(Qr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Lr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mr(e,t)}(o,e);var t,n,r,i=xr(o);function o(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return Sr(this,o),(n=i.call(this,e,t,r)).onCreationStartCB=r.onCreationStart,n.onCreationEndCB=r.onCreationEnd,n}return t=o,(n=[{key:"creationStart",value:function(){this.creationStarted=!0,this.onCreationStartCB?this.onCreationStartCB():(this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_DRAWING_START,markup:this.markup}),this.markupsExtension.markupsManager.deselectAllMarkups(),this.markupsExtension.markupsManager.deselectAllLinks(),this.editStart())}},{key:"fixInitialRotation",value:function(){var e,t=this;(this.markup.rotationHandler||this.markup.options.rotationNotAllowed)&&(e=t.markupsExtension.renderer.getCameraRotation(),Math.abs(e)>we&&function(){for(var n=t.markupsExtension.renderer.getCameraEyeVector(),r=t.markupsExtension.markupsManager.actionManager;!r.isUndoStackEmpty();){var i=r.undoStack[r.undoStack.length-1];if(Array.isArray(i)&&(i=i[i.length-1]),i.markup!==t.markup)break;t.getEditState().anchors.forEach((function(r){at.applyRotation(r,e,t.markup.getWorldCenter(),n)})),t.prevCenter=t.markup.center.clone(),t.markup.setLocked(!0),t.updateEditStateAnchors(),t.updateEditState({rotation:-e}),t.markup.setLocked(!1),t.handleCompensation();var A=dt.cloneDeep(t.getEditState());if(i.markup.state=A,i.markup.editState=A,i.newState&&(i.newState=A),r.isRedoStackEmpty()||(r.redoStack[r.redoStack.length-1].oldState=A),r.isGroupOpen)break;r.undo()}for(;!r.isRedoStackEmpty();)r.redo()}())}},{key:"creationEnd",value:function(e){this.fixInitialRotation(),this.onCreationEndCB?this.onCreationEndCB(e):(this.markup.disableEdit(),this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_DRAWING_END,markup:this.markup}),this.markupsExtension.markupsManager.duringCreationMarkup=null,this.editEnd(),this.markup.complete())}},{key:"creationCancel",value:function(){this.markup.anchorHandler&&this.markup.anchorHandler.cancelAnchorEditing(),this.markup.disableEdit(),this.markup.remove(),this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_DRAWING_CANCEL,markup:this.markup}),this.markupsExtension.markupsManager.duringCreationMarkup=null,this.editEnd()}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:return this.creationCancel(),!0;case Autodesk.Viewing.KeyCode.ESCAPE:return this.onEscape()}return!1}},{key:"onEscape",value:function(){return this.creationCancel(),!0}}])&&Tr(t.prototype,n),r&&Tr(t,r),o}(rn);function Fr(e){return(Fr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Rr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Hr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _r(e,t){return(_r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Dr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ir(e);if(t){var i=Ir(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Or(this,n)}}function Or(e,t){return!t||"object"!==Fr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ir(e){return(Ir=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Pr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_r(e,t)}(A,e);var t,n,r,i=Dr(A);function A(){return Rr(this,A),i.apply(this,arguments)}return t=A,(n=[{key:"handleMouseMove",value:function(e){var t=this.getEditState().anchors;return t[0]&&(this.creationStarted||this.creationStart(),this.updateRectPoints(t,e)),!0}},{key:"updateRectPoints",value:function(e,t){this.markupsExtension.markupsTool.shiftDown&&this.snapPointToAxis(t,e[0],90,45);var n=this.markupsExtension.renderer.getCameraRightVector(),r=this.markupsExtension.renderer.getCameraUpVector();e[2]=t;var i=e[2].clone().sub(e[0]),A=i.dot(n);e[1]=e[0].clone().add(n.multiplyScalar(A));var o=i.dot(r);e[3]=e[0].clone().add(r.multiplyScalar(o)),this.updateEditStateAnchors()}},{key:"handleButtonDown",value:function(e,t){var n=this.getEditState().anchors;return n[0]||(n[0]=e,this.updateEditStateAnchors()),!0}},{key:"handleButtonUp",value:function(e,t){var n=this.getEditState().anchors;return n[1]?this.isSamePoint(e,n[0])?(this.creationCancel(),!1):(this.updateRectPoints(n,e),this.submitChanges(),this.creationEnd(e),!0):this.handleMouseMove(e,t)}}])&&Hr(t.prototype,n),r&&Hr(t,r),A}(Lr);function Nr(e){return(Nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Kr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Vr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gr(e,t){return(Gr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function jr(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Wr(e);if(t){var i=Wr(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Yr(this,n)}}function Yr(e,t){return!t||"object"!==Nr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Wr(e){return(Wr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Xr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gr(e,t)}(A,e);var t,n,r,i=jr(A);function A(){return Kr(this,A),i.apply(this,arguments)}return t=A,(n=[{key:"handleMouseMove",value:function(e){var t=this.getEditState().anchors;if(this.creationStarted||this.creationStart(),t.length>0){this.popTemporaryPoint(),this.markupsExtension.markupsTool.shiftDown&&t.length>0&&this.snapPointToAxis(e,t[t.length-1],Ue);var n=this.isClosingLoop(e);n||(t.push(e),this.needPop=!0),this.updateEditState({anchors:t,closed:n})}return!0}},{key:"handleButtonDown",value:function(e,t){var n=this.getEditState().anchors;return 0===n.length&&(n.push(e),this.updateEditStateAnchors()),!0}},{key:"handleButtonUp",value:function(e,t){var n=this.getEditState().anchors;this.creationStarted||this.creationStart(),this.popTemporaryPoint();var r=this.isClosingLoop(e);return(r||this.isNewLocation(e))&&(this.markupsExtension.markupsTool.shiftDown&&n.length>0&&this.snapPointToAxis(e,n[n.length-1],Ue),r||n.push(e),this.updateEditState({anchors:n,closed:r}),n.length>1&&this.submitChanges(),r&&this.creationEnd(e)),!0}},{key:"beforeCreationEnd",value:function(){return!0}},{key:"handleDoubleClick",value:function(e,t){return this.getEditState().anchors.length>=this.getMinimumPoints()?(this.popTemporaryPoint(),this.beforeCreationEnd(),this.creationEnd(e)):this.markupsExtension.markupsManager.getMarkupById(this.markup.id)?this.deleteMarkup():this.creationCancel(),!0}},{key:"getMinimumPoints",value:function(){return 2}},{key:"handleKeyDown",value:function(e,t){switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:var n=this.getEditState().anchors;return n.length>0&&(this.popTemporaryPoint(),n.pop(),this.updateEditStateAnchors(),n.length>1?this.submitChanges():this.markupsExtension.markupsManager.getMarkupById(this.markup.id)?this.deleteMarkup():this.creationCancel()),!0;case Autodesk.Viewing.KeyCode.ESCAPE:return this.onEscape()}return!1}},{key:"onEscape",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.getEditState(),n=t.anchors;return n.length>0&&(this.popTemporaryPoint(),n.length>=this.getMinimumPoints()?(e&&this.beforeCreationEnd(),this.creationEnd()):this.markupsExtension.markupsManager.getMarkupById(this.markup.id)?this.deleteMarkup():this.creationCancel(),!0)}},{key:"isClosingLoop",value:function(e){var t=this.getEditState().anchors;return t.length>2&&It(e,t[0],this.snapDistance())}},{key:"isNewLocation",value:function(e){var t=this.getEditState().anchors;return!(t.length>0&&this.isSamePoint(e,t[t.length-1]))}},{key:"popTemporaryPoint",value:function(){this.needPop&&(this.getEditState().anchors.pop(),this.needPop=!1,this.updateEditStateAnchors())}}])&&Vr(t.prototype,n),r&&Vr(t,r),A}(Lr);function Jr(e){return(Jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qr(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zr(e,t){return(Zr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $r(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ti(e);if(t){var i=ti(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ei(this,n)}}function ei(e,t){return!t||"object"!==Jr(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ti(e){return(ti=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ni=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zr(e,t)}(A,e);var t,n,r,i=$r(A);function A(){return zr(this,A),i.apply(this,arguments)}return t=A,(n=[{key:"beforeCreationEnd",value:function(){this.updateEditState({closed:!0}),this.submitChanges()}},{key:"getMinimumPoints",value:function(){return 3}}])&&qr(t.prototype,n),r&&qr(t,r),A}(Xr);function ri(e){return(ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ii(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ai(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function oi(e,t){return(oi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ai(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ui(e);if(t){var i=ui(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return si(this,n)}}function si(e,t){return!t||"object"!==ri(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ui(e){return(ui=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ci=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&oi(e,t)}(A,e);var t,n,r,i=ai(A);function A(){return ii(this,A),i.apply(this,arguments)}return t=A,(n=[{key:"handleMouseMove",value:function(e){return 1===this.getEditState().anchors.length&&this.creationStart(),this.addPoint(e),!0}},{key:"handleButtonDown",value:function(e,t){return this.addPoint(e),!0}},{key:"handleButtonUp",value:function(e,t){return this.addPoint(e),this.submitChanges(),this.creationEnd(e),!0}},{key:"addPoint",value:function(e){var t=this.getEditState().anchors;0!==t.length&&It(e,t[t.length-1],this.markupsExtension.renderer.sizeFromClientToWorld(Te))||(t.push(e),t=zt(t,this.markupsExtension.renderer.sizeFromClientToWorld(.5),!0),this.updateEditStateAnchors(t))}},{key:"handleKeyDown",value:function(e,t){var n=this.getEditState().anchors;switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:return n.length>0&&this.creationCancel(),!0}return!1}}])&&Ai(t.prototype,n),r&&Ai(t,r),A}(Lr);function li(e){return(li="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function hi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function di(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pi(e,t){return(pi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=gi(e);if(t){var i=gi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return yi(this,n)}}function yi(e,t){return!t||"object"!==li(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function gi(e){return(gi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ei=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pi(e,t)}(A,e);var t,n,r,i=fi(A);function A(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return hi(this,A),(n=i.call(this,e,t,r)).tailIndex=r.reverseHead?1:0,n.headIndex=r.reverseHead?0:1,n}return t=A,(n=[{key:"handleMouseMove",value:function(e){var t=this.getEditState().anchors;return t[this.headIndex]||(t[this.headIndex]=t[this.tailIndex]),this.creationStarted||this.creationStart(),t[this.tailIndex]&&(this.markupsExtension.markupsTool.shiftDown&&this.snapPointToAxis(e,t[this.tailIndex],Ue),t[this.headIndex]=e,this.updateEditStateAnchors()),!0}},{key:"handleButtonDown",value:function(e,t){var n=this.getEditState().anchors;return n[this.tailIndex]||(n[this.tailIndex]=e,this.updateEditStateAnchors()),!0}},{key:"handleButtonUp",value:function(e,t){var n=this.getEditState().anchors;return n[this.headIndex]?this.isSamePoint(e,n[this.tailIndex])?(this.creationCancel(),!1):(this.markupsExtension.markupsTool.shiftDown&&this.snapPointToAxis(e,n[this.tailIndex],Ue),n[this.headIndex]=e,this.updateEditStateAnchors(),this.submitChanges(),this.creationEnd(e),!0):this.handleMouseMove(e,t)}}])&&di(t.prototype,n),r&&di(t,r),A}(Lr);function mi(e){return(mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Bi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wi(e,t){return(wi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ki(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=bi(e);if(t){var i=bi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ci(this,n)}}function Ci(e,t){return!t||"object"!==mi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function bi(e){return(bi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Si=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&wi(e,t)}(A,e);var t,n,r,i=ki(A);function A(){return Bi(this,A),i.apply(this,arguments)}return t=A,(n=[{key:"calculateAnchorsByCenterPoint",value:function(e){var t=this.getEditState(),n=t.anchors,r=t.text,i=this.markupsExtension.renderer.getCameraRightVector(),A=this.markupsExtension.renderer.getCameraUpVector(),o=this.markup.getTextStyle(),a=Vt(r,o),s=this.markupsExtension.renderer.getFontToWorldScale(),u=Math.ceil(a.width)*s,c=a.height*s;n[0]=e.clone().sub(A.clone().multiplyScalar(c/2)).sub(i.clone().multiplyScalar(u/2)),n[1]=n[0].clone().add(i.multiplyScalar(u)),n[2]=n[1].clone().add(A.clone().multiplyScalar(c)),n[3]=n[0].clone().add(A.clone().multiplyScalar(c))}},{key:"handleButtonDown",value:function(e,t){return!0}},{key:"handleButtonUp",value:function(e,t){return!this.didMouseMove()&&this.handleClick(e,t)}},{key:"handleClick",value:function(e,t){return this.calculateAnchorsByCenterPoint(e),this.creationStart(),this.updateEditStateAnchors(),this.submitChanges(),this.creationEnd(e),Autodesk.Viewing.isIOSDevice()||this.markup.textInputHandler.startTextEditing(!0),!0}}])&&vi(t.prototype,n),r&&vi(t,r),A}(Lr);function Ti(e){return(Ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function xi(e,t,n){return(xi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Fi(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Ui(e,t){return(Ui=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Fi(e);if(t){var i=Fi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Li(this,n)}}function Li(e,t){return!t||"object"!==Ti(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Fi(e){return(Fi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ri=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ui(e,t)}(o,e);var t,n,r,i=Qi(o);function o(e,t,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this,e,t,n)).measurement=new Autodesk.Viewing.MeasureCommon.Measurement(Autodesk.Viewing.MeasureCommon.MeasurementTypes.MEASUREMENT_DISTANCE),r.snapper=r.markupsExtension.markupsTool.snapper,r.viewer=r.markupsExtension.viewer,r}return t=o,(n=[{key:"getMeasureExtension",value:function(){return this.measureExtension||(this.measureExtension=this.markupsExtension.viewer.getExtension("Autodesk.Measure"),this.measureExtension||console.error("Measure extension not available!")),this.measureExtension}},{key:"handleMouseMove",value:function(e){var t=this.getEditState().anchors;return this.creationStarted||this.creationStart(),t[0]&&(this.markupsExtension.markupsTool.shiftDown&&this.viewer.impl.is2d&&this.snapPointToAxis(e,t[0],90),t[1]||this.updateViewportId(this.measurement.getPick(1).viewportIndex2d),this.pickSecondAnchor(e)),!0}},{key:"handleButtonDown",value:function(e,t){var n=this.getMeasureExtension();if((n.forceCalibrate||this.viewer.model.isLeaflet()||this.viewer.model.isPdf(!0))&&!n.calibrationTool.isCalibrated())return n.openCalibrationRequiredDialog("dimension"),this.markupsExtension.markupsManager.dispatchEvent({type:A.CALIBRATION_REQUIRED}),this.creationCancel(),!0;var r=this.getEditState().anchors;if(!r[0]){if(!this.snapper.isSnapped())return!1;this.snapper.copyResults(this.measurement.getPick(1));var i=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(this.snapper.getSnapResult(),this.viewer);r[0]=this.markupsExtension.renderer.documentCameraToMarkupsCamera(i),this.updateEditStateAnchors()}return!0}},{key:"handleButtonUp",value:function(e,t){var n=this.getEditState().anchors;return n[1]?this.isSamePoint(e,n[0])?(this.creationCancel(),!1):(this.markupsExtension.markupsTool.shiftDown&&this.viewer.impl.is2d&&this.snapPointToAxis(e,n[0],90),!!this.pickSecondAnchor(e)&&(this.updateViewportId(),this.submitChanges(),this.creationEnd(e),this.markup.dimensionEditHandler&&this.markup.dimensionEditHandler.handleButtonDown(e,t),!0)):this.handleMouseMove(e,t)}},{key:"pickSecondAnchor",value:function(e){var t=this.getEditState().anchors;if(this.markupsExtension.markupsTool.shiftDown&&this.viewer.impl.is2d){var n=this.markupsExtension.renderer.worldToClient(e);this.snapper.onMouseMove({x:n.x,y:n.y})}var r=this.measurement.getPick(2),i=this.snapper.isSnapped();i?(this.snapper.copyResults(r),t[1]=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(this.snapper.getSnapResult(),this.viewer)):(t[1]=e,r.geomType=Autodesk.Viewing.MeasureCommon.SnapType.SNAP_VERTEX,r.geomVertex=e,r.intersectPoint=e),Autodesk.Viewing.MeasureCommon.correctPerpendicularPicks(this.measurement.getPick(1),this.measurement.getPick(2),this.viewer,this.snapper)&&(t[1]=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(this.measurement.getPick(2),this.viewer),this.snapper.indicator.render()),i&&(t[1]=this.markupsExtension.renderer.documentCameraToMarkupsCamera(t[1]));var A=i||this.viewer.impl.is2d?this.getDistance():"";return this.updateEditState({text:A,anchors:t}),i}},{key:"creationCancel",value:function(){xi(Fi(o.prototype),"creationCancel",this).call(this),this.updateViewportId()}},{key:"updateViewportId",value:function(e){this.viewer.model&&this.viewer.impl.is2d&&(e?(this.viewer.impl.updateViewportId(e),this.snapper.setViewportId(e)):(this.viewer.impl.updateViewportId(0),this.snapper.setViewportId(null)))}},{key:"getDistance",value:function(){var e=this.getMeasureExtension().sharedMeasureConfig;if(this.measurement.computeResult(this.measurement.picks,this.markupsExtension.viewer),this.markupsExtension.viewer.model&&this.measurement.distanceXYZ){var t=Autodesk.Viewing.Private.convertUnits(this.markupsExtension.viewer.model.getUnitString(),e.units,e.calibrationFactor,this.measurement.distanceXYZ);return Autodesk.Viewing.Private.formatValueWithUnits(t,e.units,3,e.precision)}return null}}])&&Mi(t.prototype,n),r&&Mi(t,r),o}(Lr);function Hi(e){return(Hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Di(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Oi(e,t,n){return(Oi="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ki(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Ii(e,t){return(Ii=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ki(e);if(t){var i=Ki(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ni(this,n)}}function Ni(e,t){return!t||"object"!==Hi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ki(e){return(Ki=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Vi(e){return(Vi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Gi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ji(e,t){return(ji=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Yi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Xi(e);if(t){var i=Xi(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Wi(this,n)}}function Wi(e,t){return!t||"object"!==Vi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Xi(e){return(Xi=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ji=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ji(e,t)}(A,e);var t,n,r,i=Yi(A);function A(e,t,n,r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A),i.call(this,e,t,n,r)}return t=A,(n=[{key:"afterNextMarkupCreated",value:function(e){if(e===this.getTextIndex()){var t,n=this.getArrow(),r=this.getText(),i=r.getWorldBoundingBox(!0),A=r.editState.style[c.THICKNESS]/2,o=i.size().y/2-A,a=i.size().x/2-A,s=n.getHead(),u=n.getTail(),l=Math.atan2(s.y-u.y,s.x-u.x);switch(this.markup.getTextQuadrant(l)){case 1:t=new THREE.Vector3(0,o,0);break;case 2:t=new THREE.Vector3(-a,0,0);break;case 3:t=new THREE.Vector3(0,-o,0);break;case 4:t=new THREE.Vector3(a,0,0)}if(r.editState.frameType===B){var h=t.clone().negate(),d=this.markup.getVectorToClosestPointOnCloud(h);t.add(d)}r.creationHandler.updateEditState({translation:t}),r.creationHandler.submitChanges()}}},{key:"getArrowIndex",value:function(){throw new Error("getArrowIndex needs implementation")}},{key:"getTextIndex",value:function(){throw new Error("getTextIndex needs implementation")}},{key:"getArrow",value:function(){return this.markup.markups[this.getArrowIndex()]}},{key:"getText",value:function(){return this.markup.markups[this.getTextIndex()]}}])&&Gi(t.prototype,n),r&&Gi(t,r),A}(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ii(e,t)}(A,e);var t,n,r,i=Pi(A);function A(e,t,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];_i(this,A),(r=i.call(this,e,t,n)).creationHandlers=[],r.currentStep=0,r.lastCompleted=-1,r.markup.markups=[];var a=[];r.markup.state.uuid?a=r.markup.state.componentsState.sort((function(e,t){return e.groupOrder-t.groupOrder})):r.markup.state.uuid=r.markup.editState.uuid=THREE.Math.generateUUID(),r.markupClasses=o,r.numMarkups=o.length;for(var s=0;s<r.numMarkups;s++){var u=o[s].class,c=o[s].options||{};r._restoreFill(a[s],o[s],a);var l=s===o.length-1;c.onCreationEnd=function(e){r.onCreationEnd(e)},c.onCreationStart=function(){r.onCreationStart()};var h=Object.assign({},a[s],{groupId:r.markup.state.uuid,groupOrder:s}),d=r.markupsExtension.markupsManager.createMarkup(u,h,c);l||(d.selectWhenCompleted=function(){return!1}),d.markupGroup=r.markup,r.markup.markups.push(d),r.creationHandlers.push(d.creationHandler)}return delete r.markup.state.componentsState,r}return t=A,(n=[{key:"_restoreFill",value:function(e,t,n){if(e&&t.options.fillNotAllowed)for(var r=0;r<this.numMarkups;r++)if(!(t===this.markupClasses[r]||this.markupClasses[r].options&&this.markupClasses[r].options.fillNotAllowed)){e.style[c.FILL_OPACITY]=n[r].style[c.FILL_OPACITY],e.style[c.FILL_COLOR]=n[r].style[c.FILL_COLOR];break}}},{key:"handleMouseMove",value:function(e){return this.creationHandlers[this.currentStep].handleMouseMove(e)}},{key:"handleButtonDown",value:function(e,t){return this.creationHandlers[this.currentStep].handleButtonDown(e,t)}},{key:"handleButtonUp",value:function(e,t){return this.creationHandlers[this.currentStep].handleButtonUp(e,t)}},{key:"handleDoubleClick",value:function(e,t){return this.creationHandlers[this.currentStep].handleDoubleClick(e,t)}},{key:"creationCancel",value:function(){for(Oi(Ki(A.prototype),"creationCancel",this).call(this),this.markupsExtension.markupsManager.closeActionGroup();this.currentStep-- >0;)this.markupsExtension.markupsManager.actionManager.undo(!1)}},{key:"onCreationStart",value:function(){0===this.currentStep&&(this.markupsExtension.markupsManager.openActionGroup(),this.creationStart()),this.markup.markups[this.currentStep].setVisible(!0),this.markup.markups[this.currentStep].enableEdit()}},{key:"closeGroup",value:function(){this.lastCompleted===this.currentStep&&this.markupsExtension.markupsManager.closeActionGroup(),this.lastCompleted=this.currentStep}},{key:"onCreationEnd",value:function(e){if(this.markup.markups[this.currentStep].disableEdit(),this.markup.markups[this.currentStep].complete(),this.currentStep===this.numMarkups-1)this.submitChanges(),this.creationEnd(e);else{var t=this.markup.markups[this.currentStep].getStartPointForNextMarkup();this.currentStep+=1,this.markupClasses[this.currentStep].options.requiresClick?this.creationHandlers[this.currentStep].handleClick(t):this.creationHandlers[this.currentStep].handleButtonDown(t),this.afterNextMarkupCreated(this.currentStep)}this.closeGroup()}},{key:"afterNextMarkupCreated",value:function(e){}}])&&Di(t.prototype,n),r&&Di(t,r),A}(Lr));function zi(e){return(zi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qi(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Zi(e,t){return(Zi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $i(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=tA(e);if(t){var i=tA(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return eA(this,n)}}function eA(e,t){return!t||"object"!==zi(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function tA(e){return(tA=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var nA=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zi(e,t)}(A,e);var t,n,r,i=$i(A);function A(e,t,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A),i.call(this,e,t,n,[{class:g,options:{reverseHead:!0,tailHandlingNotAllowed:!0}},{class:S,options:{requiresClick:!0,rotationNotAllowed:!0,frameType:n.calloutFrameType?n.calloutFrameType:E}}])}return t=A,(n=[{key:"getArrowIndex",value:function(){return 0}},{key:"getTextIndex",value:function(){return 1}}])&&qi(t.prototype,n),r&&qi(t,r),A}(Ji);function rA(e){return(rA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function iA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function AA(e,t){return(AA=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oA(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=sA(e);if(t){var i=sA(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return aA(this,n)}}function aA(e,t){return!t||"object"!==rA(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function sA(e){return(sA=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var uA=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&AA(e,t)}(A,e);var t,n,r,i=oA(A);function A(e,t,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A),i.call(this,e,t,n,[{class:B,options:{fillNotAllowed:!0,rotationNotAllowed:!0}},{class:g,options:{reverseHead:!0,headHandlingNotAllowed:!0,tailHandlingNotAllowed:!0}},{class:S,options:{requiresClick:!0,rotationNotAllowed:!0,frameType:n.calloutFrameType?n.calloutFrameType:E}}])}return t=A,(n=[{key:"getArrowIndex",value:function(){return 1}},{key:"getTextIndex",value:function(){return 2}}])&&iA(t.prototype,n),r&&iA(t,r),A}(Ji);function cA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var lA=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"getCreationHandler",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};switch(e){case g:case U:return new Ei(t,n,r);case E:case m:case B:return new Pr(t,n,r);case v:case w:return new ci(t,n,r);case C:return new ni(t,n,r);case k:return new Xr(t,n,r);case S:return new Si(t,n,r);case x:return new Ri(t,n,r);case T:return new nA(t,n,r);case M:return new uA(t,n,r)}throw new Error("".concat(e," creation handler does not exist"))}}],(n=null)&&cA(t.prototype,n),r&&cA(t,r),e}(),hA=n(355),dA=n.n(hA),pA=n(356),fA=n.n(pA);function yA(e){this.supportsInt32Index=e}function gA(e){function t(e,t){return void 0===e?t:e}THREE.Material.call(this),e=e||{},this.lineWidth=t(e.lineWidth,1),this.miter=t(e.miter,!0),this.color=t(e.color,new THREE.Color(16777215)),this.opacity=t(e.opacity,1),this.resolution=t(e.resolution,new THREE.Vector2(1,1));var n=new THREE.RawShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},color:{type:"c",value:this.color},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution}},vertexShader:dA.a,fragmentShader:fA.a,attributes:{previous:{type:"v2",value:new THREE.Vector2},next:{type:"v2",value:new THREE.Vector2},side:{type:"f",value:0},width:{type:"f",value:0},counters:{type:"f",value:0}}});return n.type="MeshLineMaterial",Autodesk.Viewing.isIE11&&(n.defines.IS_IE_11=1),this.miter&&(n.defines.MITER=1),delete e.lineWidth,delete e.color,delete e.opacity,delete e.resolution,delete e.miter,n.setValues(e),n}function EA(e,t,n,r,i,A){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.333,a=Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2)),s=Math.sqrt(Math.pow(i-n,2)+Math.pow(A-r,2)),u=o*a/(a+s),c=o-u,l=n+u*(e-i),h=r+u*(t-A),d=n-c*(e-i),p=r-c*(t-A);return[{x:l,y:h},{x:d,y:p}]}function mA(e,t,n,r){var i=r*r,A=1-r,o=A*A,a=o*e.x;a+=2*A*r*t.x,a+=i*n.x;var s=o*e.y;return s+=2*A*r*t.y,{x:a,y:s+=i*n.y,z:0}}function BA(e,t,n,r,i){var A=i*i,o=A*i,a=1-i,s=a*a,u=s*a,c=u*e.x;c+=3*s*i*t.x,c+=3*a*A*n.x,c+=o*r.x;var l=u*e.y;return l+=3*s*i*t.y,l+=3*a*A*n.y,{x:c,y:l+=o*r.y,z:0}}yA.prototype.create=function(){this.geometry=new THREE.BufferGeometry},yA.prototype.dispose=function(){if(this.geometry&&(this.geometry.dispose(),this.geometry=null),this.attributes){for(var e in this.attributes)delete this.attributes[e].array;this.attributes=null}this.positions=null,this.previous=null,this.next=null,this.side=null,this.width=null,this.counters=null,this.indices_array=null},yA.prototype.setGeometry=function(e,t,n,r){var i=this;this.sourceGeo=e,Array.isArray(t)?(this.widthArray=t,this.widthCallback=function(e){return i.widthArray[e]}):this.widthCallback=t,this.sourceConnectivity=n||[],this.connectivity={},this.options=Object.assign({},{capType:y,joinType:y,useExactSize:!1},r),this.isClosed=!!this.options.isClosed,this.process()},yA.prototype.isPointNear=function(){var e=new THREE.Vector3,t=new THREE.Vector3;function n(n){var r=e.x,i=e.y,A=t.x-r,o=t.y-i;if(0!==A||0!==o){var a=((n.x-r)*A+(n.y-i)*o)/(A*A+o*o);a>1?(r=t.x,i=t.y):a>0&&(r+=A*a,i+=o*a)}return(A=n.x-r)*A+(o=n.y-i)*o}return function(r,i,A){for(var o=0,a=this.numPoints-1;o<a;o++)if(this.connectivity[o]!==d&&(e.fromArray(this.positions,6*o).applyMatrix4(A),t.fromArray(this.positions,6*(o+1)).applyMatrix4(A),n(r)<i))return!0;return!1}}(),yA.prototype.getPositionV3=function(e){var t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},yA.prototype.initArrays=function(e){var t=this.options.useExactSize;if(!this.capacity||this.capacity<e||t&&this.capacity!==e){this.dispose();var n=t?e:Math.ceil(1.5*e);this.positions=new Float32Array(6*n),this.previous=new Float32Array(4*n),this.next=new Float32Array(4*n),this.side=new Float32Array(2*n),this.width=new Float32Array(2*n),this.counters=new Float32Array(2*n);var r=6*(n-1);this.indices_array=this.supportsInt32Index&&r>65535?new Uint32Array(r):new Uint16Array(r),this.capacity=n}this.numPoints=e},yA.prototype.getWidth=function(e,t){return this.widthCallback?this.widthCallback(e,t):1},yA.prototype.process=function(){var e=this,t=this.sourceGeo.length,n=Math.max(1,t-1),r=function(t,r,i,A){var o=e.sourceGeo[t];e.positions.set([o.x,o.y,o.z,o.x,o.y,o.z],6*r),e.counters.set([i,i],2*r),e.side.set([A,-A],2*r);var a=e.getWidth(t,t/n);e.width.set([a,a],2*r)},i=0,A=function(){e.attributes?(e.attributes.position.array=e.positions,e.attributes.position.needsUpdate=!0,e.attributes.previous.array=e.previous,e.attributes.previous.needsUpdate=!0,e.attributes.next.array=e.next,e.attributes.next.needsUpdate=!0,e.attributes.side.array=e.side,e.attributes.side.needsUpdate=!0,e.attributes.width.array=e.width,e.attributes.width.needsUpdate=!0,e.attributes.index.array=e.indices_array,e.attributes.index.needsUpdate=!0,e.attributes.counters.array=e.counters,e.attributes.counters.needsUpdate=!0):(e.create(),e.attributes={position:new THREE.BufferAttribute(e.positions,3),previous:new THREE.BufferAttribute(e.previous,2),next:new THREE.BufferAttribute(e.next,2),side:new THREE.BufferAttribute(e.side,1),width:new THREE.BufferAttribute(e.width,1),index:new THREE.BufferAttribute(e.indices_array,1),counters:new THREE.BufferAttribute(e.counters,1)},e.geometry.addAttribute("position",e.attributes.position),e.geometry.addAttribute("previous",e.attributes.previous),e.geometry.addAttribute("next",e.attributes.next),e.geometry.addAttribute("side",e.attributes.side),e.geometry.addAttribute("width",e.attributes.width),e.geometry.addAttribute("index",e.attributes.index),e.geometry.addAttribute("counters",e.attributes.counters))};if(0!==t){this.isClosed&&this.options.joinType!==f||(this.sourceConnectivity[0]=h,this.sourceConnectivity[t-1]=d);var o=t+this.sourceConnectivity.reduce((function(e){return e+1}),0);this.initArrays(o);for(var a=0,s=0;s<t;s++)if(this.sourceConnectivity[s]===h){var u=0!==s||this.isClosed?this.options.joinType:this.options.capType;this.connectivity[a]=h,r(s,a++,-1,u),r(s,a++,0,u)}else if(this.sourceConnectivity[s]===d){var c=s!==t-1||this.isClosed?this.options.joinType:this.options.capType;r(s,a++,1,c),this.connectivity[a]=d,r(s,a++,2,c)}else r(s,a++,s/n,p);!function(){var t;t=e.isClosed?e.getPositionV3(o-2):e.getPositionV3(0),e.previous.set([t[0],t[1],t[0],t[1]],0);for(var n=1;n<o;n++)t=e.connectivity[n]===h?e.getPositionV3(n):e.connectivity[n]===d?e.getPositionV3(n-2):e.getPositionV3(n-1),e.previous.set([t[0],t[1],t[0],t[1]],4*n)}(),function(){for(var t,n=0;n<o-1;n++)t=e.connectivity[n]===d?e.getPositionV3(n):e.connectivity[n]===h?e.getPositionV3(n+2):e.getPositionV3(n+1),e.next.set([t[0],t[1],t[0],t[1]],4*n);t=e.isClosed?e.getPositionV3(1):e.getPositionV3(o-1),e.next.set([t[0],t[1],t[0],t[1]],4*(o-1))}(),function(){for(var t=0;t<o-1;t++)if(e.connectivity[t]!==d){var n=2*t;e.indices_array.set([n,n+1,n+2,n+2,n+1,n+3],i),i+=6}}(),A(),this.geometry.offsets[0]={index:0,start:0,count:i}}else A()},gA.prototype=Object.create(THREE.Material.prototype),gA.prototype.constructor=gA,gA.prototype.copy=function(e){return THREE.Material.prototype.copy.call(this,e),this.lineWidth=e.lineWidth,this.color.copy(e.color),this.opacity=e.opacity,this.resolution.copy(e.resolution),this.miter=e.miter,this};var vA=function(e){for(var t,n,r,i,A=0,o=1;o<e.length;o++)A+=(t=e[o],n=e[o-1],r=void 0,i=void 0,r=t.x-n.x,i=t.y-n.y,Math.sqrt(r*r+i*i));return A};function wA(e,t,n,r,i,A){for(var o=Math.max(Math.round(vA([e,t,n])/r),4),a=0;a<o;a++){var s=a/o,u=mA(e,t,n,s);i.push(u),A&&A.push(e.width+s*s*(n.width-e.width))}}function kA(e,t,n,r,i,A,o){for(var a=Math.max(Math.round(vA([e,t,n,r])/i),4),s=0;s<a;s++){var u=s/a,c=BA(e,t,n,r,u);A.push(c),o&&o.push(e.width+u*u*u*(r.width-e.width))}}function CA(e,t,n){if(e.length<3)return{anchors:e};for(var r=[],i=[],A=n?[]:null,o=e.length,a=0;a<o-2;a++)r=r.concat(EA(e[a].x,e[a].y,e[a+1].x,e[a+1].y,e[a+2].x,e[a+2].y));wA(e[0],r[0],e[1],t,i,A);for(var s=1;s<o-3;s++)kA(e[s],r[2*s-1],r[2*s],e[s+1],t,i,A);return wA(e[o-2],r[2*o-5],e[o-1],t,i,A),i.push(e[o-1]),A&&A.push(e[o-1].width),{anchors:i,widths:A}}function bA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var SA=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.geoCache={}}var t,n,r;return t=e,r=[{key:"areAllAnchorsEqual",value:function(e){for(var t=e[0],n=1;n<e.length;n++)if(!e[n].equals(t))return!1;return!0}}],(n=[{key:"getStrokeGeometry",value:function(t){return this._isCacheSupported(t.type)?this._getCachedStrokeGeometry(t.type):e.areAllAnchorsEqual(t.editState.anchors)?this._createPointGeometry(t):this._createStrokeGeometry(t)}},{key:"getFillGeometry",value:function(e){switch(e.type){case B:case C:var t={innerGeometry:this._getFillInnerGeometryFromAnchors(e)};return e.meshLine.type!==m&&(t.arcGeometry=this._getFillCircleGeometry(e.meshLine.radius),t.fillGapGeometries=this._getFillingGapsGeometry(e)),t;case k:return this._getFillInnerGeometryFromAnchors(e);case m:return this._getFillCircleGeometry(.5,72);case E:return this._getFillRectangleGeometry();default:return null}}},{key:"_getFillingGapsGeometry",value:function(e){for(var t=[],n=0;n<e.meshLine.intersectionObjects.length;n++){var r=e.meshLine.intersectionObjects[n],i=r.beginPoint,A=r.endPoint,o=r.newCircle,a=r.anchorPoint,s=r.beginCircle,u=r.endCircle;if(!(i&&A&&a&&s&&u&&o))return null;var c=[];c.push(new THREE.Vector3(a.x,a.y,0)),c.push(new THREE.Vector3(s.x,s.y,0)),c.push(new THREE.Vector3(i.x,i.y,0)),c.push(new THREE.Vector3(o.x,o.y,0)),c.push(new THREE.Vector3(A.x,A.y,0)),c.push(new THREE.Vector3(u.x,u.y,0)),t.push(new THREE.ShapeGeometry(new THREE.Shape(c)))}return t}},{key:"_getFillCircleGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n="circle-fill|r:"+e+"|s:"+t;return this.geoCache[n]||(this.geoCache[n]=new THREE.CircleGeometry(e,t)),this.geoCache[n]}},{key:"_getFillRectangleGeometry",value:function(){return this.geoCache["rectangle-fill"]||(this.geoCache["rectangle-fill"]=new THREE.PlaneBufferGeometry(1,1,1,1)),this.geoCache["rectangle-fill"]}},{key:"_getFillInnerGeometryFromAnchors",value:function(e){if(e.meshLine.type===m)return this._getFillCircleGeometry(.5,10);var t=dt.cloneDeep(e.getAnchors());return this._centerAndScaleLocations(t,e.center,e.scaleMatrix),e.meshLine.type===B&&this._shiftAnchorsInsideBox(e,t,e.meshLine.radius),t.length>2?new THREE.ShapeGeometry(new THREE.Shape(t)):null}},{key:"_getCachedStrokeGeometry",value:function(e){var t=e;return this.geoCache[t]||(this.geoCache[t]=this._createCachedStrokeGeometry(e)),this.geoCache[t]}},{key:"_isCacheSupported",value:function(e){return[E,m].includes(e)}},{key:"isCachedGeometry",value:function(e){for(var t in this.geoCache)if(e===this.geoCache[t])return!0;return!1}},{key:"_createCachedStrokeGeometry",value:function(e){switch(e){case E:return this._createRectangleStrokeGeometry();case m:return this._createCircleStrokeGeometry();default:return null}}},{key:"_createStrokeGeometry",value:function(e){switch(e.type){case B:case C:var t=this._createCloudGeometry(e);return t||(t=this._getCachedStrokeGeometry(m)),t;case k:case U:return this._createLineGeometry(e,179);case v:case w:return this._createLineGeometry(e,120);case g:return this._createArrowGeometry(e);case x:return this._createDimensionGeometry(e);default:return null}}},{key:"_createPointGeometry",value:function(e){var t,n;switch(e.type){case B:case C:case v:case w:t=f,n=nt*this.markupsExtension.renderer.mmToWorldUnitFactor;break;default:t=y,n=this.markupsExtension.renderer.getNormaStrokeWidth()}var r=[{x:0,y:0,z:0},{x:n,y:0,z:0}];return this._createMeshLine(r,e.type,e,null,{capType:t})}},{key:"_createMeshLine",value:function(e,t,n,r){var i,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;return n?(i=n.meshLine,A.useExactSize=n.completed):A.useExactSize=!0,i&&i.type===t||(i=new yA(this.markupsExtension.renderer.supportsInt32Index())),i.type=t,i.setGeometry(e,o,r,A),i}},{key:"_createRectangleStrokeGeometry",value:function(){return this._createMeshLine([{x:-.5,y:-.5,z:0},{x:.5,y:-.5,z:0},{x:.5,y:.5,z:0},{x:-.5,y:.5,z:0},{x:-.5,y:-.5,z:0}],E,null,null,{isClosed:!0})}},{key:"_createCircleStrokeGeometry",value:function(){var e=Gt(0,0,.5,0,2*Math.PI,!1,72);return this._createMeshLine(e,m,null,null,{isClosed:!0})}},{key:"_centerAndScaleLocations",value:function(e,t,n){e.forEach((function(e){e.sub(t),e.applyMatrix4(n)}))}},{key:"_createLineGeometry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:29,n=e.type===v||e.type===w,r=dt.cloneDeep(e.getEditState().anchors);this._centerAndScaleLocations(r,e.center,e.scaleMatrix);var i=[],A=null;if(e.editState.closed&&r.push(r[0]),n){var o=.5*e.markupsExtension.renderer.mmToWorldUnitFactor,a=!1,s=CA(r,o,a);r=s.anchors,A=s.widths}for(var u=new THREE.Vector3,c=new THREE.Vector3,l=Math.cos(t*Math.PI/180),h=1;h<r.length-1;h++)u.copy(r[h-1]).sub(r[h]).normalize(),c.copy(r[h+1]).sub(r[h]).normalize(),c.dot(u)>l&&(r.splice(h,0,r[h]),A&&A.splice(h,0,A[h]),i[h]=d,h++);return e.editState.closed&&(u.copy(r[r.length-2]).sub(r[r.length-1]).normalize(),c.copy(r[1]).sub(r[0]).normalize(),c.dot(u)>l&&(r.push(r[0]),A&&A.push(A[0]))),this._createMeshLine(r,e.type,e,i,{capType:n?f:y,joinType:f,isClosed:e.editState.closed},A)}},{key:"_createArrowGeometry",value:function(e){var t=e.editState.style[c.THICKNESS],n=dt.cloneDeep(e.getEditState().anchors);n[0].sub(e.center),n[1].sub(e.center);var r=n[1].clone().sub(n[0]),i=this.markupsExtension.renderer.getCameraEyeVector(),A=Math.min(t*ve,r.length()/2),o=[],a=A>t;if(a){var s=r.clone().normalize(),u=n[1].clone().sub(s.multiplyScalar(A)),l=at.degreesToRadians(30);n[2]=u.clone(),at.applyRotation(n[2],l,n[1],i),n[3]=n[1].clone(),n[4]=u.clone(),at.applyRotation(n[4],-l,n[1],i),o[1]=d,o[2]=h}var p=this._createMeshLine(n,e.type,e,o);return a&&(n[0].add(e.center),n[1].add(e.center),n[2].add(e.center),n[4].add(e.center),p.boundingPoints=[n[0],n[2],n[1],n[4]]),p}},{key:"_createDimensionGeometry",value:function(e){var t=e.editState.style[c.THICKNESS]*Ge,n=dt.cloneDeep(e.getEditState().anchors),r=[],i=[];function A(e,t){r=r.concat([e,t]),i=i.concat([h,d])}n[0].sub(e.center),n[1].sub(e.center),A(n[0],n[1]);var o=n[0].clone().sub(n[1]),a=this.markupsExtension.renderer.getCameraEyeVector(),s=o.clone().cross(a).normalize(),u=t*Ve,l=s.clone().multiplyScalar(u),p=at.degreesToRadians(45);return n[2]=n[0].clone().add(l),n[3]=n[0].clone().sub(l),at.applyRotation([n[2],n[3]],p,n[0],a),A(n[2],n[3]),n[4]=n[1].clone().add(l),n[5]=n[1].clone().sub(l),at.applyRotation([n[4],n[5]],p,n[1],a),A(n[4],n[5]),n[6]=n[0].clone(),e.applyInverseScaleAndTranslation(n[6]),It(n[6],n[0])||(n[7]=n[0].clone().sub(n[0].clone().sub(n[6]).normalize().multiplyScalar(u)),A(n[6],n[7])),n[8]=n[1].clone(),e.applyInverseScaleAndTranslation(n[8]),It(n[8],n[1])||(n[9]=n[1].clone().sub(n[1].clone().sub(n[8]).normalize().multiplyScalar(u)),A(n[8],n[9])),n[10]=n[0].clone().add(l),n[11]=n[0].clone().sub(l),A(n[10],n[11]),n[12]=n[1].clone().add(l),n[13]=n[1].clone().sub(l),A(n[12],n[13]),this._createMeshLine(r,e.type,e,i)}},{key:"_createCloudGeometry",value:function(e){var t=dt.cloneDeep(e.getEditState().anchors);(function(e,t){for(var n=0,r=0;r<e.length;r++){var i=e[r],A=e[(r+1)%e.length];n+=(A.x-i.x)*(A.y+i.y)}return n*t.scaleMatrix.elements[0]*t.scaleMatrix.elements[5]>0})(t,e)&&t.reverse();var n=this.getCloudMinimumRadius(e.editState.style[c.THICKNESS]),r=n/this.markupsExtension.renderer.mmToWorldUnitFactor;this._centerAndScaleLocations(t,e.center,e.scaleMatrix);var i,A=e.editState.closed;if(e.type===B){if(A=!0,!this._shiftAnchorsInsideBox(e,t,n))return null}else(i=new THREE.Box3).min.z=i.max.z=0;var o=function(e,t,n){for(var r=e.length,i=[],A=0;A<r;A++){var o=e[0===A?r-1:A-1],a=e[A],s=e[(A+1)%r];if(!a||!s)break;var u=Math.atan2(a.y-o.y,a.x-o.x),c={};c.p1=new THREE.Vector3(o.x+Math.cos(u-Math.PI/2)*t,o.y+Math.sin(u-Math.PI/2)*t,1),c.p2=new THREE.Vector3(a.x+Math.cos(u-Math.PI/2)*t,a.y+Math.sin(u-Math.PI/2)*t,1);var l=Math.atan2(s.y-a.y,s.x-a.x),h={};h.p1=new THREE.Vector3(a.x+Math.cos(l-Math.PI/2)*t,a.y+Math.sin(l-Math.PI/2)*t,1),h.p2=new THREE.Vector3(s.x+Math.cos(l-Math.PI/2)*t,s.y+Math.sin(l-Math.PI/2)*t,1);var d=Xt(c.p1,c.p2,h.p1,h.p2);if(d.onBothLines){var p=new THREE.Vector3(a.x-o.x,a.y-o.y,0),f=new THREE.Vector3(s.x-a.x,s.y-a.y,0);p.normalize(),f.normalize(),p.multiplyScalar(-1);var y=(new THREE.Vector3).crossVectors(p,f),g=Math.asin(y.z),E=p.dot(f);Math.atan2(g,E)<Math.PI/2&&(a["isCurrentIntersection"+i.length]=!0,s["isNextIntersection"+i.length]=!0,a.intersects=i,s.intersects=i,i.push(d))}}return i}(t,n),a=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.8,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:20,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];function a(e,t,n){var r=t.x-e.x,i=t.y-e.y,A=.5*Math.sqrt(r*r+i*i)/n;A<-1&&(A=-1),A>1&&(A=1);var o=Math.atan2(i,r),a=Math.acos(A);return[o-a,Math.PI+o+a]}var s=[],u=2*t*i,c=n?e[e.length-1]:e[0];o=o||!n;for(var l=n?0:1;l<e.length;l++){var h=e[l],d=h.x-c.x,p=h.y-c.y,f=Math.sqrt(d*d+p*p);d/=f,p/=f;var y=0,g=0;n||(1===l?(f-=t,c.x+=d*t,c.y+=p*t,y=Math.atan2(p,d)+Math.PI):l===e.length-1&&(g=Math.atan2(p,d)));var E=u;if(o){var m=f/u+.5|0;m<1&&(m=1),E=f/m}for(var B=0;B+.1*E<f;B+=E){s.push({x:c.x+B*d,y:c.y+B*p,begin:y,end:g,isAnchor:0===B});for(var v=0;v<r.length;v++)s[s.length-1]["isNextIntersection"+v]=h["isNextIntersection"+v],s[s.length-1]["isCurrentIntersection"+v]=h["isCurrentIntersection"+v],h["isNextIntersection"+v]&&0===B&&(r[v].anchorPoint=s[s.length-1])}c=h}var w=at.degreesToRadians(A);c=s[s.length-1];for(var k=0;k<s.length;k++){var C=s[k],b=a(c,C,t);(n||0!==k)&&(c.end=b[0]+w,C.begin=b[1]),c=C}Yt(s,t,r);for(var S=r.length-1;S>-1;S--)if(s[r[S].begin]&&s[r[S].end]){r[S].beginCircle=s[r[S].begin],r[S].endCircle=s[r[S].end];var T=jt(s,t,r[S].begin,r[S].end),M=T.newCircle,x=T.beginPoint,U=T.endPoint;r[S].newCircle=M,r[S].beginPoint=x,r[S].endPoint=U}return s=s.filter((function(e){return!e.hide}))}(t,n,A,o);if(0===a.length)return null;for(var s,u,l,p=[],y=[],g=0,E=0;E<a.length;E++){var m=a[E];m.isAnchor&&(s=m,u=void 0,l=void 0,(l=Math.abs(s.begin-s.end))>2*Math.PI&&(l-=2*Math.PI),(!u&&s.begin>s.end||u&&s.end>s.begin)&&(l=2*Math.PI-l),l>1.9*Math.PI&&(m.begin=m.end)),Gt(m.x,m.y,n,m.begin,m.end,!1,null,p,r,i);var v=p.length-g;y[g]=h,y[g+v-1]=d,g+=v}var w=this._createMeshLine(p,e.type,e,y,{capType:f,joinType:f});return w.arcs=a,w.radius=n,w.intersectionObjects=o,i&&(i.applyMatrix4(e.invScaleMatrix),i.translate(e.center),w.boundingPoints=[i.min.clone(),i.max.clone(),i.max.clone(),i.min.clone()],w.boundingPoints[1].y=i.min.y,w.boundingPoints[3].y=i.max.y),w}},{key:"_shiftAnchorsInsideBox",value:function(e,t,n){var r=t[0].clone().sub(t[1]).normalize(),i=t[2].clone().sub(t[1]).normalize(),A=t[0].distanceTo(t[1])/2;if(t[2].distanceTo(t[1])/2<n||A<n)return!1;for(var o=0;o<t.length;o++){var a=t[o],s=n*Math.sign(a.dot(i));a.sub(i.clone().multiplyScalar(s)),s=n*Math.sign(a.dot(r)),a.sub(r.clone().multiplyScalar(s))}return!0}},{key:"getCloudMinimumRadius",value:function(e){var t=this.markupsExtension.renderer.mmToWorldUnitFactor*(this.markupsExtension.viewer.impl.is2d?1:10);return Math.max(3*e,t)}},{key:"destroy",value:function(){for(var e in this.geoCache)this.geoCache[e].dispose();this.geoCache=null}}])&&bA(t.prototype,n),r&&bA(t,r),e}();function TA(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function MA(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var UA=Autodesk.Viewing,QA=function(){function e(t,n,r,i){var A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};MA(this,e),this.setGlobalManager(t.globalManager),this.id=n,this.type=r,this.options=A,this.markupsExtension=t,this.materialManager=this.markupsExtension.renderer.materialManager,this.layer=null,this.meshContainer=null,this.strokeMaterial=null,this.fillMaterial=null,this.center=new THREE.Vector3,this.matrix=new THREE.Matrix4,this.invMatrix=new THREE.Matrix4,this.scaleMatrix=new THREE.Matrix4,this.invScaleMatrix=new THREE.Matrix4,this.completed=!1,this.selected=!1,this.inEdit=!1,this.enabled=!0,this.transparent=!1,this.visible=!1,this.hover=!1,this.locked=!1,this.state=this.getDefaultState(),this.state.anchors=this.getDefaultAnchors(),this.state.style=this.getDefaultStyle(),i&&Object.assign(this.state,i),this.state.translation=this.state.translation||new THREE.Vector3,this.state.rotation=this.state.rotation||0,this.state.scale=this.state.scale||new THREE.Vector3(1,1,1),this.editState=dt.cloneDeep(this.state),this.updateMatrix(),this.registerSelectionHandler(),this.creationHandler=lA.getCreationHandler(this.type,this.markupsExtension,this,A)}var t,n,r;return t=e,r=[{key:"createMesh",value:function(e,t){var n=new THREE.Mesh(e,t);return n.frustumCulled=!1,n}}],(n=[{key:"updateMatrix",value:function(){this.scaleMatrix.makeScale(this.editState.scale.x,this.editState.scale.y,this.editState.scale.z),this.matrix.copy(this.scaleMatrix),this.matrix.setPosition(this.editState.translation),this.invMatrix.getInverse(this.matrix),this.invScaleMatrix.getInverse(this.scaleMatrix),this.updateCenter()}},{key:"updateCenter",value:function(){if(0!==this.editState.anchors.length){var e=(new THREE.Vector3).set(-1/0,-1/0,-1/0),t=(new THREE.Vector3).set(1/0,1/0,1/0);this.editState.anchors.forEach((function(n){e=e.max(n),t=t.min(n)})),this.center.x=(e.x+t.x)/2,this.center.y=(e.y+t.y)/2}}},{key:"getDefaultState",value:function(){return{}}},{key:"getDefaultAnchors",value:function(){return[]}},{key:"getDefaultStyle",value:function(){var e;return TA(e={},c.COLOR,this.markupsExtension.getStyleProperty(c.LAST_COLOR)),TA(e,c.FONT_SIZE,this.markupsExtension.getStyleProperty(c.FONT_SIZE)),TA(e,c.FONT_WEIGHT,this.markupsExtension.getStyleProperty(c.FONT_WEIGHT)),TA(e,c.FONT_FAMILY,this.markupsExtension.getStyleProperty(c.FONT_FAMILY)),TA(e,c.FONT_STYLE,this.markupsExtension.getStyleProperty(c.FONT_STYLE)),TA(e,c.FONT_COLOR,this.markupsExtension.getStyleProperty(c.FONT_COLOR)),TA(e,c.THICKNESS,this.markupsExtension.getStyleProperty(c.THICKNESS)),TA(e,c.FILL_OPACITY,this.markupsExtension.getStyleProperty(c.FILL_OPACITY)),TA(e,c.FILL_COLOR,this.markupsExtension.getStyleProperty(c.FILL_COLOR)),TA(e,c.OPACITY,this.markupsExtension.getStyleProperty(c.OPACITY)),e}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(e){this.state=dt.cloneDeep(e),this.rotatedBoundingBox=null,this.boundingBox=null}},{key:"getEditState",value:function(){return this.editState}},{key:"setEditState",value:function(e,t,n){var r=this.editState;this.editState=t?Object.assign({},e,t):dt.cloneDeep(e),this.updateMatrix(),this.rotatedBoundingBox=null,this.boundingBox=null,this.visible&&this.markupsExtension.renderer&&this.render(t),this.belongsToGroup()&&!this.isLocked()&&this.syncGroup(r,this.editState,t,n)}},{key:"isLocked",value:function(){return this.locked}},{key:"setLocked",value:function(e){this.locked=e}},{key:"render",value:function(e){this.meshContainer||(this.meshContainer=new THREE.Group,this.markupsExtension.renderer.addToScene(this))}},{key:"syncEditState",value:function(){this.setEditState(this.getState())}},{key:"syncState",value:function(){this.setState(this.getEditState())}},{key:"syncGroup",value:function(e,t,n,r){this.markupGroup.rotatedBoundingBox=null,this.markupGroup.boundingBox=null,n&&this.markupGroup.syncGroupMarkups(this,e,t,n,r)}},{key:"select",value:function(){this.layer&&!this.markupsExtension.permissionManager.canEditMarkup(this.layer.layerData)||(this.selected=!0,this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_SELECTED,markup:this}),this.enableEdit(),this.belongsToGroup()&&!this.markupGroup.locked&&this.markupGroup.select(this))}},{key:"deselect",value:function(){this.selected=!1,this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_DESELECTED,markup:this}),this.disableEdit()}},{key:"setVisible",value:function(e,t){(this.visible!==e||t)&&(this.visible=e,this.meshContainer&&(this.meshContainer.visible=e),this.markupsExtension.renderer&&(this.visible?this.render():this.markupsExtension.renderer.invalidate()),this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_VISIBILITY_CHANGED,markup:this,visible:e}))}},{key:"isVisible",value:function(){return this.visible}},{key:"isSelected",value:function(){return this.selected}},{key:"enableEdit",value:function(){this.inEdit=!0,this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_ENABLE_EDIT,markup:this}),this.setDirty()}},{key:"disableEdit",value:function(){this.inEdit=!1,this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_DISABLE_EDIT,markup:this}),this.setDirty()}},{key:"enable",value:function(){this.enabled=!0,this.changeTransparency(!1)}},{key:"disable",value:function(){this.enabled=!1,this.changeTransparency(!0)}},{key:"isEnabled",value:function(){return this.enabled}},{key:"changeTransparency",value:function(e){this.transparent!==e&&(this.transparent=e,this.visible&&this.markupsExtension.renderer&&this.render({style:{}}),this.setDirty())}},{key:"isTransparent",value:function(){return this.transparent}},{key:"setHover",value:function(e){this.hover!==e&&(this.hover=e,this.belongsToGroup()&&!this.markupGroup.locked&&this.markupGroup.setHover(e,this),this.setDirty())}},{key:"isHovered",value:function(){return this.hover}},{key:"isInEdit",value:function(){return this.inEdit}},{key:"setDirty",value:function(){this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_DIRTY,markup:this})}},{key:"isCompleted",value:function(){return this.completed}},{key:"complete",value:function(){this.completed=!0,this.selectWhenCompleted()?this.select():this.setDirty(),this.visible&&this.markupsExtension.renderer&&this.render(),this.markupsExtension.markupsManager.selectLayer(this.layer,!1,!1)}},{key:"selectWhenCompleted",value:function(){return!0}},{key:"registerAnchorHandler",value:function(e){this.anchorHandler=new Dn(this.markupsExtension,this,e)}},{key:"registerTranslationHandler",value:function(e){this.translationHandler=new xn(this.markupsExtension,this,e)}},{key:"registerRotationHandler",value:function(e){this.rotationHandler=new jn(this.markupsExtension,this,e)}},{key:"registerScaleHandler",value:function(e){this.scaleHandler=new $n(this.markupsExtension,this,e)}},{key:"registerSelectionHandler",value:function(e){this.selectionHandler=new vn(this.markupsExtension,this,e)}},{key:"registerTextInputHandler",value:function(e){this.textInputHandler=new yr(this.markupsExtension,this,e)}},{key:"registerDimensionEditHandler",value:function(e){this.dimensionEditHandler=new Cr(this.markupsExtension,this,e)}},{key:"applyCameraRotation",value:function(e){var t=this.markupsExtension.renderer.getCameraRotation(),n=this.markupsExtension.renderer.getCameraEyeVector();at.applyRotation(e,t,this.getWorldCenter(),n)}},{key:"applyInverseCameraRotation",value:function(e){var t=this.markupsExtension.renderer.getCameraRotation(),n=this.markupsExtension.renderer.getCameraEyeVector();at.applyRotation(e,-t,this.getWorldCenter(),n)}},{key:"applyInverseRotation",value:function(e){var t=this.getRotation();if(0!==t){var n=this.markupsExtension.renderer.getCameraEyeVector();at.applyRotation(e,-t,this.getWorldCenter(),n)}}},{key:"applyRotation",value:function(e){var t=this.getRotation();if(0!==t){var n=this.markupsExtension.renderer.getCameraEyeVector();at.applyRotation(e,t,this.getWorldCenter(),n)}}},{key:"applyRotationForAnchors",value:function(e){var t=this.getRotation();if(0!==t){var n=this.markupsExtension.renderer.getCameraEyeVector(),r=this.getWorldCenter();e.forEach((function(e){at.applyRotation(e,t,r,n)}))}}},{key:"applyScaleAndTranslation",value:function(e){e.sub(this.center),e.applyMatrix4(this.matrix),e.add(this.center)}},{key:"applyInverseScaleAndTranslation",value:function(e){e.sub(this.center),e.applyMatrix4(this.invMatrix),e.add(this.center)}},{key:"calculateWorldBoundingBox",value:function(e){var t,n=this,r=new THREE.Box3;(t=this.meshLine&&this.meshLine.boundingPoints?dt.cloneDeep(this.meshLine.boundingPoints):dt.cloneDeep(this.editState.anchors)).forEach((function(e){n.applyScaleAndTranslation(e)})),e&&this.applyRotationForAnchors(t),t.forEach((function(e){r.expandByPoint(e)}));var i=this.editState.style[c.THICKNESS]/2;return r.expandByVector(new THREE.Vector3(i,i,0)),r}},{key:"getWorldBoundingBox",value:function(e){return e?(this.rotatedBoundingBox||(this.rotatedBoundingBox=this.calculateWorldBoundingBox(e)),this.rotatedBoundingBox):(this.boundingBox||(this.boundingBox=this.calculateWorldBoundingBox(e)),this.boundingBox)}},{key:"getClientBoundingBox",value:function(e,t){var n=this.getWorldBoundingBox(t).clone();n.min=this.markupsExtension.renderer.worldToClient(n.min),n.max=this.markupsExtension.renderer.worldToClient(n.max);var r=this.markupsExtension.renderer.getCameraEyeVector(),i=n.center(),A=this.markupsExtension.renderer.getCameraRotation();if(at.applyRotation(n.min,A,i,r),at.applyRotation(n.max,A,i,r),at.swapBoundingBoxY(n),e){var o=this.getMarginSize();n.expandByVector(new THREE.Vector3(o,o,0))}return n.min.z=0,n.max.z=0,n}},{key:"getMarginSize",value:function(){return Pe}},{key:"getMinimumSize",value:function(){return Math.max(this.markupsExtension.renderer.sizeFromWorldToClient(this.editState.style[c.THICKNESS]),this.getMarginSize())}},{key:"getCenter",value:function(){return this.center}},{key:"setPosition",value:function(){var e=this.center.clone().add(this.editState.translation);this.meshContainer.position.copy(e)}},{key:"setRotation",value:function(){this.meshContainer.rotation.z=this.editState.rotation*this.markupsExtension.renderer.getCameraEyeVector().z}},{key:"getWorldCenter",value:function(){return this.center.clone().add(this.editState.translation)}},{key:"getClientCenter",value:function(){return this.markupsExtension.renderer.worldToClient(this.getWorldCenter())}},{key:"getRotation",value:function(){return this.editState.rotation}},{key:"getScale",value:function(){return this.editState.scale}},{key:"getAnchors",value:function(){return this.editState.anchors}},{key:"isAnchorHandlingAllowed",value:function(e){return!0}},{key:"getTail",value:function(){return this.editState.anchors[this.editState.anchors.length-1]}},{key:"getHead",value:function(){return this.editState.anchors[0]}},{key:"getStartPointForNextMarkup",value:function(){return new THREE.Vector3}},{key:"intersect",value:function(e){var t=e.clone();this.applyInverseRotation(t);var n=this.markupsExtension.renderer.worldToClient(t),r=this.getClientBoundingBox(!0),i=this.markupsExtension.renderer.getCameraEyeVector(),A=this.markupsExtension.renderer.getCameraRotation();at.applyRotation(n,A,r.center(),i),n.z=0;var o=r.containsPoint(n);if(!o||this.isTextMarkup())return o;if(this.hasFill()&&this.fillMesh&&this.markupsExtension.renderer.raycaster.intersectObject(this.fillMesh).length>0)return!0;var a=this.strokeMaterial.uniforms.lineWidth.value/2;return a+=this.markupsExtension.renderer.sizeFromClientToWorld(Ne),this.meshLine.isPointNear(e,a*a,this.meshContainer.matrixWorld)}},{key:"isGroupMarkup",value:function(){return!1}},{key:"belongsToGroup",value:function(){return!!this.markupGroup}},{key:"isTextMarkup",value:function(){return!1}},{key:"isGeometricMarkup",value:function(){return!0}},{key:"isWithFillMarkup",value:function(){return!1}},{key:"isPoint",value:function(){return this.editState.anchors.length<2||SA.areAllAnchorsEqual(this.editState.anchors)}},{key:"hasFill",value:function(){return this.isWithFillMarkup()&&!this.options.fillNotAllowed&&this.editState.style[c.FILL_OPACITY]>0&&this.editState.style[c.FILL_COLOR]!==a.NO_COLOR}},{key:"needsMiter",value:function(){return!0}},{key:"showPath",value:function(){return!1}},{key:"hasThicknessChanged",value:function(){return this.strokeMaterial&&this.strokeMaterial.uniforms.lineWidth.value!==this.editState.style[c.THICKNESS]}},{key:"removeFill",value:function(){this.fillMaterial&&(this.materialManager.removeMaterial(this.fillMaterial),this.fillMaterial=null),this.fillMesh&&(this.meshContainer.remove(this.fillMesh),this.fillMesh=null)}},{key:"remove",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.markupsExtension.renderer&&(this.strokeMaterial&&(this.materialManager.removeMaterial(this.strokeMaterial),this.strokeMaterial=null),this.strokeMesh&&(this.meshContainer.remove(this.strokeMesh),this.strokeMesh=null),this.meshLine&&!this.markupsExtension.renderer.geometryManager.isCachedGeometry(this.meshLine)&&(this.meshLine.dispose(),this.meshLine=null),this.fillMaterial&&(this.materialManager.removeMaterial(this.fillMaterial),this.fillMaterial=null),this.fillMesh&&(this.markupsExtension.renderer.geometryManager.isCachedGeometry(this.fillMesh.geometry)||this.fillMesh.traverse((function(e){e.geometry&&e.geometry.dispose()})),this.meshContainer.remove(this.fillMesh),this.fillMesh=null),this.meshContainer&&(this.markupsExtension.renderer.removeFromScene(this),this.meshContainer=null),e&&this.markupsExtension.markupsManager.dispatchEvent({type:A.MARKUP_REMOVED,markup:this}))}},{key:"destroy",value:function(){this.anchorHandler&&(this.anchorHandler.destroy(),this.anchorHandler=null),this.translationHandler&&(this.translationHandler.destroy(),this.translationHandler=null),this.rotationHandler&&(this.rotationHandler.destroy(),this.rotationHandler=null),this.scaleHandler&&(this.scaleHandler.destroy(),this.scaleHandler=null),this.selectionHandler&&(this.selectionHandler.destroy(),this.selectionHandler=null),this.textInputHandler&&(this.textInputHandler.destroy(),this.textInputHandler=null),this.markupsExtension=null,this.state=null,this.editState=null,this.layer=null}}])&&xA(t.prototype,n),r&&xA(t,r),e}();function LA(e){return(LA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function FA(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function RA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function HA(e,t,n){return(HA="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=IA(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function _A(e,t){return(_A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function DA(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=IA(e);if(t){var i=IA(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return OA(this,n)}}function OA(e,t){return!t||"object"!==LA(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function IA(e){return(IA=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}UA.GlobalManagerMixin.call(QA.prototype),QA.singleClickMarkup=!1,QA.withSnappingMarkup=!1,QA.useTimerBeforeSelection=!1;var PA=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_A(e,t)}(A,e);var t,n,r,i=DA(A);function A(e,t,n,r){var o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return FA(this,A),(o=i.call(this,e,t,n,r,a)).registerTranslationHandler(),o.registerAnchorHandler(),o}return t=A,(n=[{key:"createLine",value:function(){this.strokeMesh&&this.meshContainer.remove(this.strokeMesh),this.strokeMaterial||(this.strokeMaterial=this.materialManager.addMaterial(this,!1)),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.strokeMesh=QA.createMesh(this.meshLine.geometry,this.strokeMaterial),this.setPosition(),this.meshContainer.add(this.strokeMesh)}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;HA(IA(A.prototype),"render",this).call(this);var t=e.anchors;if(t&&t.length>1&&this.createLine(),this.strokeMesh){if(e.style){var n=this.hasThicknessChanged(),r=this.materialManager.editMaterial(this.strokeMaterial,this,!1);r&&(this.strokeMaterial=r,this.strokeMesh.material=r,n&&this.createLine())}e.translation&&this.setPosition(),this.markupsExtension.renderer.invalidate()}}}])&&RA(t.prototype,n),r&&RA(t,r),A}(QA);function NA(e){return(NA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function KA(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function VA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function GA(e,t){return(GA=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function jA(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=WA(e);if(t){var i=WA(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return YA(this,n)}}function YA(e,t){return!t||"object"!==NA(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function WA(e){return(WA=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}PA.withSnappingMarkup=!0;var XA=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&GA(e,t)}(A,e);var t,n,r,i=jA(A);function A(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return KA(this,A),i.call(this,e,t,g,n,r)}return t=A,(n=[{key:"getTail",value:function(){return this.editState.anchors[0]}},{key:"getHead",value:function(){return this.editState.anchors[1]}},{key:"getStartPointForNextMarkup",value:function(){return this.getTail().clone()}},{key:"isAnchorHandlingAllowed",value:function(e){return!(this.options.headHandlingNotAllowed&&e===this.getHead()||this.options.tailHandlingNotAllowed&&e===this.getTail())}}])&&VA(t.prototype,n),r&&VA(t,r),A}(PA);function JA(e){return(JA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zA(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qA(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ZA(e,t,n){return(ZA="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=no(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function $A(e,t){return($A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function eo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=no(e);if(t){var i=no(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return to(this,n)}}function to(e,t){return!t||"object"!==JA(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function no(e){return(no=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ro=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$A(e,t)}(A,e);var t,n,r,i=eo(A);function A(e,t,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return zA(this,A),(r=i.call(this,e,t,k,n,o)).registerTranslationHandler(),r.registerAnchorHandler(),r.registerRotationHandler(),r.registerScaleHandler(),r}return t=A,(n=[{key:"getDefaultState",value:function(){return{closed:!1}}},{key:"createPolyline",value:function(){if(this.strokeMesh&&this.meshContainer.remove(this.strokeMesh),this.fillMesh&&(this.meshContainer.remove(this.fillMesh),this.fillMesh=null),this.strokeMaterial||(this.strokeMaterial=this.materialManager.addMaterial(this,!1)),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.strokeMesh=QA.createMesh(this.meshLine.geometry,this.strokeMaterial),this.hasFill()&&!this.isPoint()&&qt(this.editState.anchors)){this.fillMaterial||(this.fillMaterial=this.materialManager.addMaterial(this,!0));var e=this.markupsExtension.renderer.geometryManager.getFillGeometry(this);e&&(this.fillMesh=QA.createMesh(e,this.fillMaterial),this.meshContainer.add(this.fillMesh))}this.meshContainer.add(this.strokeMesh),this.setPosition(),this.setRotation()}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;ZA(no(A.prototype),"render",this).call(this);var t=e.anchors;if((t&&t.length>0||this.editState.anchors.length>0&&e.scale)&&this.createPolyline(),this.strokeMesh){if(e.style){var n=this.materialManager.editMaterial(this.strokeMaterial,this,!1);n&&(this.strokeMaterial=n,this.strokeMesh.material=n);var r=!1;if(this.hasFill())if(this.fillMesh){var i=this.materialManager.editMaterial(this.fillMaterial,this,!0);i&&(this.fillMaterial=i,this.fillMesh.material=i)}else r=!0;else this.removeFill();r&&this.createPolyline()}e.translation&&this.setPosition(),void 0!==e.rotation&&this.setRotation(),this.markupsExtension.renderer.invalidate()}}},{key:"isWithFillMarkup",value:function(){return this.editState.closed}},{key:"showPath",value:function(){return!0}}])&&qA(t.prototype,n),r&&qA(t,r),A}(QA);function io(e){return(io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ao(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ao(e,t,n){return(ao="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=lo(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function so(e,t){return(so=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function uo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=lo(e);if(t){var i=lo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return co(this,n)}}function co(e,t){return!t||"object"!==io(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function lo(e){return(lo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}ro.withSnappingMarkup=!0;var ho=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&so(e,t)}(A,e);var t,n,r,i=uo(A);function A(e,t,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Ao(this,A),(r=i.call(this,e,t,C,n,o)).registerTranslationHandler(),r.registerAnchorHandler(),r.registerRotationHandler(),r.registerScaleHandler(),r}return t=A,(n=[{key:"getDefaultState",value:function(){return{closed:!1}}},{key:"needsMiter",value:function(){return!1}},{key:"createCloud",value:function(){if(this.strokeMesh&&this.meshContainer.remove(this.strokeMesh),this.fillMesh&&(this.meshContainer.remove(this.fillMesh),this.fillMesh=null),this.strokeMaterial||(this.strokeMaterial=this.materialManager.addMaterial(this,!1)),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.meshLine.type===m){var e=this.markupsExtension.renderer.getNormaStrokeWidth();this.meshContainer.scale.x=e,this.meshContainer.scale.y=e}else this.meshContainer.scale.x=1,this.meshContainer.scale.y=1;this.strokeMesh=QA.createMesh(this.meshLine.geometry,this.strokeMaterial),this.hasFill()&&!this.isPoint()&&qt(this.editState.anchors)&&this.createFillMesh(),this.meshContainer.add(this.strokeMesh),this.setPosition(),this.setRotation()}},{key:"createFillMesh",value:function(){var e=this,t=this.markupsExtension.renderer.geometryManager.getFillGeometry(this);t.innerGeometry&&(this.fillMaterial||(this.fillMaterial=this.materialManager.addMaterial(this,!0)),this.fillMesh=QA.createMesh(t.innerGeometry,this.fillMaterial),this.meshContainer.add(this.fillMesh),t.arcGeometry&&this.meshLine.arcs.forEach((function(n){var r=QA.createMesh(t.arcGeometry,e.fillMaterial);e.fillMesh.add(r),r.position.x=n.x,r.position.y=n.y})),t.fillGapGeometries&&t.fillGapGeometries.forEach((function(t){var n=QA.createMesh(t,e.fillMaterial);e.fillMesh.add(n)})))}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;ao(lo(A.prototype),"render",this).call(this);var t=e.anchors;if((t&&t.length>0||this.editState.anchors.length>0&&e.scale)&&this.createCloud(),this.strokeMesh){if(e.style){var n=this.hasThicknessChanged(),r=this.materialManager.editMaterial(this.strokeMaterial,this,!1);if(r&&(this.strokeMaterial=r,this.strokeMesh.material=r),this.hasFill())if(this.fillMesh){var i=this.materialManager.editMaterial(this.fillMaterial,this,!0);i&&(this.fillMaterial=i,this.fillMesh.traverse((function(e){return e.material=i})))}else n=!0;else this.removeFill();n&&this.createCloud()}e.translation&&this.setPosition(),void 0!==e.rotation&&this.setRotation(),this.markupsExtension.renderer.invalidate()}}},{key:"showPath",value:function(){return!0}},{key:"isWithFillMarkup",value:function(){return this.editState.closed}}])&&oo(t.prototype,n),r&&oo(t,r),A}(QA);function po(e){return(po="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function go(e,t,n){return(go="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=vo(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Eo(e,t){return(Eo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function mo(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vo(e);if(t){var i=vo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Bo(this,n)}}function Bo(e,t){return!t||"object"!==po(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vo(e){return(vo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}ho.withSnappingMarkup=!0;var wo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Eo(e,t)}(A,e);var t,n,r,i=mo(A);function A(e,t,n,r){var o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return fo(this,A),(o=i.call(this,e,t,n,r,a)).width=0,o.height=0,o.registerTranslationHandler(),o.registerRotationHandler(),o.registerScaleHandler(),o}return t=A,(n=[{key:"setSize",value:function(){var e=this.markupsExtension.renderer.getNormaStrokeWidth();this.meshContainer.scale.x=Math.max(Math.abs(this.width*this.editState.scale.x),e)*Math.sign(this.editState.scale.x),this.meshContainer.scale.y=Math.max(Math.abs(this.height*this.editState.scale.y),e)*Math.sign(this.editState.scale.y)}},{key:"createShape",value:function(e){this.strokeMesh||(this.strokeMaterial||(this.strokeMaterial=this.materialManager.addMaterial(this,!1)),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.strokeMesh=QA.createMesh(this.meshLine.geometry,this.strokeMaterial),this.meshContainer.add(this.strokeMesh),this.meshContainer.rotation.z=-this.markupsExtension.renderer.getCameraRotation()*this.markupsExtension.renderer.getCameraEyeVector().z),!this.fillMesh&&this.hasFill()&&this.createFill(),this.width=e[0].distanceTo(e[1]),this.height=e[2].distanceTo(e[1]),this.setPosition(),this.setSize()}},{key:"createFill",value:function(){this.fillGeometry=this.markupsExtension.renderer.geometryManager.getFillGeometry(this),this.fillGeometry&&(this.fillMaterial||(this.fillMaterial=this.materialManager.addMaterial(this,!0)),this.fillMesh=QA.createMesh(this.fillGeometry,this.fillMaterial),this.meshContainer.add(this.fillMesh),this.meshContainer.add(this.strokeMesh))}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;go(vo(A.prototype),"render",this).call(this);var t=e.anchors;if(t&&t.length>1&&this.createShape(t),this.strokeMesh){if(e.style){var n=this.materialManager.editMaterial(this.strokeMaterial,this,!1);if(n&&(this.strokeMaterial=n,this.strokeMesh.material=n),this.hasFill())if(this.fillMesh){var r=this.materialManager.editMaterial(this.fillMaterial,this,!0);r&&(this.fillMaterial=r,this.fillMesh.material=r)}else this.createFill();else this.removeFill()}e.translation&&this.setPosition(),void 0!==e.rotation&&this.setRotation(),e.scale&&this.setSize(),this.markupsExtension.renderer.invalidate()}}},{key:"isWithFillMarkup",value:function(){return!0}}])&&yo(t.prototype,n),r&&yo(t,r),A}(QA);function ko(e){return(ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Co(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function bo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function So(e,t){return(So=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function To(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=xo(e);if(t){var i=xo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Mo(this,n)}}function Mo(e,t){return!t||"object"!==ko(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function xo(e){return(xo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Uo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&So(e,t)}(A,e);var t,n,r,i=To(A);function A(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Co(this,A),i.call(this,e,t,E,n,r)}return t=A,(n=[{key:"isWithFillMarkup",value:function(){return!0}}])&&bo(t.prototype,n),r&&bo(t,r),A}(wo);function Qo(e){return(Qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Lo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Fo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ro(e,t){return(Ro=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ho(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Do(e);if(t){var i=Do(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _o(this,n)}}function _o(e,t){return!t||"object"!==Qo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Do(e){return(Do=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Oo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ro(e,t)}(A,e);var t,n,r,i=Ho(A);function A(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Lo(this,A),i.call(this,e,t,m,n,r)}return t=A,(n=[{key:"isWithFillMarkup",value:function(){return!0}},{key:"needsMiter",value:function(){return!1}}])&&Fo(t.prototype,n),r&&Fo(t,r),A}(wo);function Io(e){return(Io="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Po(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function No(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ko(e,t,n){return(Ko="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Yo(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Vo(e,t){return(Vo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Go(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Yo(e);if(t){var i=Yo(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return jo(this,n)}}function jo(e,t){return!t||"object"!==Io(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Yo(e){return(Yo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Wo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Vo(e,t)}(A,e);var t,n,r,i=Go(A);function A(e,t,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Po(this,A),(r=i.call(this,e,t,B,n,o)).registerTranslationHandler(),o.rotationNotAllowed||r.registerRotationHandler(),r.registerScaleHandler(),r}return t=A,(n=[{key:"createCloud",value:function(){if(this.strokeMesh&&this.meshContainer.remove(this.strokeMesh),this.fillMesh&&(this.meshContainer.remove(this.fillMesh),this.fillMesh=null),this.strokeMaterial||(this.strokeMaterial=this.materialManager.addMaterial(this,!1)),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.strokeMesh=QA.createMesh(this.meshLine.geometry,this.strokeMaterial),this.hasFill()&&!this.isPoint()&&this.createFillMesh(),this.meshContainer.add(this.strokeMesh),this.meshLine.type===m){var e=this.editState.anchors[0].distanceTo(this.editState.anchors[1]),t=this.editState.anchors[2].distanceTo(this.editState.anchors[1]),n=this.markupsExtension.renderer.getNormaStrokeWidth();this.meshContainer.scale.x=Math.max(Math.abs(e*this.editState.scale.x),n)*Math.sign(this.editState.scale.x),this.meshContainer.scale.y=Math.max(Math.abs(t*this.editState.scale.y),n)*Math.sign(this.editState.scale.y),this.isCompleted()?this.setRotation():this.meshContainer.rotation.z=-this.markupsExtension.renderer.getCameraRotation()*this.markupsExtension.renderer.getCameraEyeVector().z}else this.meshContainer.scale.x=1,this.meshContainer.scale.y=1,this.setRotation();this.setPosition()}},{key:"createFillMesh",value:function(){var e=this,t=this.markupsExtension.renderer.geometryManager.getFillGeometry(this);t.innerGeometry&&(this.fillMaterial||(this.fillMaterial=this.materialManager.addMaterial(this,!0)),this.fillMesh=QA.createMesh(t.innerGeometry,this.fillMaterial),this.meshContainer.add(this.fillMesh),t.arcGeometry&&this.meshLine.arcs.forEach((function(n){var r=QA.createMesh(t.arcGeometry,e.fillMaterial);e.fillMesh.add(r),r.position.x=n.x,r.position.y=n.y})))}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;Ko(Yo(A.prototype),"render",this).call(this);var t=e.anchors;if((t&&t.length>1||this.editState.anchors.length>1&&e.scale)&&this.createCloud(),this.strokeMesh){if(e.style){var n=this.hasThicknessChanged(),r=this.materialManager.editMaterial(this.strokeMaterial,this,!1);if(r&&(this.strokeMaterial=r,this.strokeMesh.material=r),this.hasFill())if(this.fillMesh){var i=this.materialManager.editMaterial(this.fillMaterial,this,!0);i&&(this.fillMaterial=i,this.fillMesh.traverse((function(e){return e.material=i})))}else n=!0;else this.removeFill();n&&this.createCloud()}e.translation&&this.setPosition(),void 0!==e.rotation&&this.setRotation(),this.markupsExtension.renderer.invalidate()}}},{key:"isWithFillMarkup",value:function(){return!0}},{key:"needsMiter",value:function(){return!1}}])&&No(t.prototype,n),r&&No(t,r),A}(QA);function Xo(e){return(Xo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Jo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function zo(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function qo(e,t,n){return(qo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ta(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Zo(e,t){return(Zo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function $o(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ta(e);if(t){var i=ta(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ea(this,n)}}function ea(e,t){return!t||"object"!==Xo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ta(e){return(ta=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Wo.withSnappingMarkup=!0;var na=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Zo(e,t)}(A,e);var t,n,r,i=$o(A);function A(e,t,n,r){var o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return Jo(this,A),(o=i.call(this,e,t,n,r,a)).registerTranslationHandler(),o.registerRotationHandler(),o.registerScaleHandler(),o}return t=A,(n=[{key:"selectWhenCompleted",value:function(){return!1}},{key:"needsMiter",value:function(){return!0}},{key:"createPen",value:function(){this.strokeMesh&&this.meshContainer.remove(this.strokeMesh),this.strokeMaterial||(this.strokeMaterial=this.materialManager.addMaterial(this,!1)),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.strokeMesh=QA.createMesh(this.meshLine.geometry,this.strokeMaterial),this.meshContainer.add(this.strokeMesh),this.setPosition(),this.setRotation()}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;qo(ta(A.prototype),"render",this).call(this);var t=e.anchors;if((t&&t.length>0||this.editState.anchors.length>0&&e.scale)&&this.createPen(),this.strokeMesh){if(e.style){var n=this.materialManager.editMaterial(this.strokeMaterial,this,!1);n&&(this.strokeMaterial=n,this.strokeMesh.material=n)}e.translation&&this.setPosition(),void 0!==e.rotation&&this.setRotation(),this.markupsExtension.renderer.invalidate()}}}])&&zo(t.prototype,n),r&&zo(t,r),A}(QA);function ra(e){return(ra="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ia(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Aa(e,t){return(Aa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=sa(e);if(t){var i=sa(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return aa(this,n)}}function aa(e,t){return!t||"object"!==ra(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function sa(e){return(sa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}na.singleClickMarkup=!0,na.useTimerBeforeSelection=!0;var ua=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Aa(e,t)}(n,e);var t=oa(n);function n(e,r,i){var A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return ia(this,n),t.call(this,e,r,v,i,A)}return n}(na);function ca(e){return(ca="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function la(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ha(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function da(e,t,n){return(da="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ga(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function pa(e,t){return(pa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ga(e);if(t){var i=ga(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ya(this,n)}}function ya(e,t){return!t||"object"!==ca(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ga(e){return(ga=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ea=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pa(e,t)}(A,e);var t,n,r,i=fa(A);function A(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return la(this,A),i.call(this,e,t,w,n,r)}return t=A,(n=[{key:"getDefaultStyle",value:function(){var e=da(ga(A.prototype),"getDefaultStyle",this).call(this);return e[c.OPACITY]=le,e}}])&&ha(t.prototype,n),r&&ha(t,r),A}(na);function ma(e){return(ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ba(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function va(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function wa(e,t,n){return(wa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Sa(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function ka(e,t){return(ka=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ca(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Sa(e);if(t){var i=Sa(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ba(this,n)}}function ba(e,t){return!t||"object"!==ma(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Sa(e){return(Sa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ta=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ka(e,t)}(A,e);var t,n,r,i=Ca(A);function A(e,t,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Ba(this,A),(r=i.call(this,e,t,S,n,o)).registerTranslationHandler(),r.registerScaleHandler({onlyHorizontal:!0}),r.registerTextInputHandler(),o.rotationNotAllowed||r.registerRotationHandler(),r}return t=A,(n=[{key:"getDefaultState",value:function(){return{text:"Default Text",isFrameUsed:!0,frameType:this.options.frameType?this.options.frameType:E}}},{key:"shouldRenderFrame",value:function(){return this.editState.isFrameUsed||this.hasFill()}},{key:"setVisible",value:function(e,t){wa(Sa(A.prototype),"setVisible",this).call(this,e,t),this.frameMarkup?this.frameMarkup.setVisible(e,t):this.shouldRenderFrame()&&e&&this.renderFrame()}},{key:"render",value:function(){arguments.length>0&&void 0!==arguments[0]||this.editState,this.markupsExtension.renderer.textRenderer.renderMarkup(this),this.shouldRenderFrame()?this.renderFrame():(this.removeFrame(),this.setDirty())}},{key:"renderFrame",value:function(){this.frameMarkup||(this.frameMarkup=new bs[this.editState.frameType](this.markupsExtension,this.id),this.frameMarkup.layer=this.layer,this.frameMarkup.transparent=this.isTransparent(),this.frameMarkup.editState.anchors=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]);var e=this.frameMarkup.editState;e.style[c.THICKNESS]=this.editState.style[c.THICKNESS],e.style[c.OPACITY]=this.editState.style[c.OPACITY],e.style[c.FILL_COLOR]=this.editState.style[c.FILL_COLOR],e.style[c.FILL_OPACITY]=this.editState.style[c.FILL_OPACITY],this.editState.isFrameUsed?(e.style[c.COLOR]=this.editState.style[c.COLOR],e.style[c.OPACITY]=1):(e.style[c.COLOR]=this.editState.style[c.FILL_COLOR],e.style[c.OPACITY]=this.editState.style[c.FILL_OPACITY]);var t=this.getWorldBoundingBox(),n=e.style[c.THICKNESS]/2;this.frameMarkup.editState.anchors[0].set(t.min.x+n,t.min.y+n,0),this.frameMarkup.editState.anchors[1].set(t.max.x-n,t.min.y+n,0),this.frameMarkup.editState.anchors[2].set(t.max.x-n,t.max.y-n,0),this.frameMarkup.editState.anchors[3].set(t.min.x+n,t.max.y-n,0),e.rotation=this.editState.rotation,this.frameMarkup.updateMatrix(),this.frameMarkup.render()}},{key:"removeFrame",value:function(){this.frameMarkup&&(this.frameMarkup.remove(!1),this.frameMarkup=null)}},{key:"remove",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.removeFrame(),wa(Sa(A.prototype),"remove",this).call(this,e)}},{key:"changeTransparency",value:function(e){this.frameMarkup&&(this.frameMarkup.transparent=e),wa(Sa(A.prototype),"changeTransparency",this).call(this,e)}},{key:"resetFrameBoundingBox",value:function(){this.frameMarkup&&(this.frameMarkup.rotatedBoundingBox=null,this.frameMarkup.boundingBox=null)}},{key:"setState",value:function(e){this.resetFrameBoundingBox(),wa(Sa(A.prototype),"setState",this).call(this,e)}},{key:"setEditState",value:function(e,t,n){if(t&&t.style){var r=Object.assign({},e,t),i=this.markupsExtension.renderer.getFontToWorldScale(),o=this.getTextWidthInFontScale().width,s=this.getTextStyle(this.editState),u=this.getTextStyle(r);s.width="".concat(o,"px"),u.width="".concat(o,"px");var l=Vt(this.editState.text,s),h=Vt(r.text,u);if(h.height!==l.height){var d=(h.height-l.height)*i,p=this.getBoundingBoxVerticalTranslation(d);if(this.shouldRenderFrame()){var f=this.calculateFrameSize(this.editState.style[c.FONT_SIZE]),y=this.calculateFrameSize(r.style[c.FONT_SIZE])-f,g=new THREE.Vector3(y,-y,0);this._rotateTranslationVector(g),p.add(g)}if(t.translation)t.translation.add(p);else{var E=this.getEditState().translation;E.add(p),t.translation=E}}t.isFrameUsed=r.style[c.COLOR]!==a.NO_COLOR}this.resetFrameBoundingBox(),wa(Sa(A.prototype),"setEditState",this).call(this,e,t,n)}},{key:"getTextWidthInFontScale",value:function(){var e=Autodesk.Viewing.isSafari()||Autodesk.Viewing.isIOSDevice(),t=this.markupsExtension.renderer.getFontToWorldScale(),n=this.getWorldBoundingBoxTextOnly().size().x/t;return{preciseWidth:n,width:e?n:Math.ceil(n)||1}}},{key:"getBoundingBoxVerticalTranslation",value:function(e){var t=new THREE.Vector3(0,-e/2,0);return this._rotateTranslationVector(t),t}},{key:"_rotateTranslationVector",value:function(e){var t=this.getRotation();if(0!==t){var n=this.markupsExtension.renderer.getCameraEyeVector();at.applyRotation(e,t,new THREE.Vector3,n)}}},{key:"_rotateBoundingBox",value:function(e){var t=this.getRotation();if(0===t)return e;var n=e.center(),r=e.size(),i=this.markupsExtension.renderer.getCameraEyeVector(),A=new THREE.Box3;return[e.min,e.min.clone().add(new THREE.Vector3(r.x,0,0)),e.max,e.min.clone().add(new THREE.Vector3(0,r.y,0))].forEach((function(e){at.applyRotation(e,t,n,i),A.expandByPoint(e)})),A}},{key:"_calculateWorldBoundingBoxText",value:function(){var e=this,t=new THREE.Box3,n=dt.cloneDeep(this.editState.anchors);n.forEach((function(t){e.applyScaleAndTranslation(t)})),n.forEach((function(e){t.expandByPoint(e)}));var r=t.center(),i=this.getTextStyle(),A=this.markupsExtension.renderer.getFontToWorldScale(),o=Vt("A",i);t.size().x<o.width*A&&(t.min.x=r.x,t.max.x=r.x,t.expandByVector(new THREE.Vector3(o.width*A/2,0,0)));var a=Math.ceil(t.size().x/A);return i.width="".concat(a,"px"),o=Vt(this.editState.text,i),t.min.y=r.y,t.max.y=r.y,t.expandByVector(new THREE.Vector3(0,o.height*A/2,0)),t}},{key:"calculateWorldBoundingBox",value:function(e){var t=this._calculateWorldBoundingBoxText();if(this.shouldRenderFrame()){var n=this.getWorldFrameSize();t.expandByVector(new THREE.Vector3(n,n,0))}return e?this._rotateBoundingBox(t):t}},{key:"calculateFrameSize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.editState.style[c.THICKNESS],n=this.markupsExtension.renderer.getFontToWorldScale(),r=e*n/2;return this.editState.isFrameUsed?this.editState.frameType===B&&(t+=this.markupsExtension.renderer.geometryManager.getCloudMinimumRadius(t)/2):t=0,r+t}},{key:"getWorldFrameSize",value:function(){return this.calculateFrameSize(this.editState.style[c.FONT_SIZE])}},{key:"getClientFrameSize",value:function(){var e=this.getWorldFrameSize();return this.markupsExtension.renderer.sizeFromWorldToClient(e)}},{key:"getWorldBoundingBoxTextOnly",value:function(e){if(!this.shouldRenderFrame())return this.getWorldBoundingBox(e).clone();var t=this.getWorldBoundingBox(!1).clone(),n=this.getWorldFrameSize();return t.expandByVector(new THREE.Vector3(-n,-n,0)),e?this._rotateBoundingBox(t):t}},{key:"getClientBoundingBoxTextOnly",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.getWorldBoundingBoxTextOnly(e);return n.min=this.markupsExtension.renderer.worldToClient(n.min),n.max=this.markupsExtension.renderer.worldToClient(n.max),t&&at.swapBoundingBoxY(n),n}},{key:"getTextStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getEditState(),t=e.style,n={};return n.color=t[c.FONT_COLOR],n.fontFamily=t[c.FONT_FAMILY],n.opacity=t[c.OPACITY]*(this.isTransparent()?Ye:1),n.fontSize="".concat(t[c.FONT_SIZE],"px"),n.fontWeight=t[c.FONT_WEIGHT],n.fontStyle=t[c.FONT_STYLE],n.whiteSpace=e.isSingleLine?"nowrap":"pre-wrap",n.lineHeight=1,n.backgroundColor=null,n}},{key:"getMinimumSize",value:function(){var e=wa(Sa(A.prototype),"getMinimumSize",this).call(this),t=this.getTextStyle(),n=Vt("A",t),r=this.markupsExtension.renderer.getFontToWorldScale();return Math.max(this.markupsExtension.renderer.sizeFromWorldToClient(n.width*r+2*this.getWorldFrameSize()),e)}},{key:"isTextMarkup",value:function(){return!0}},{key:"isGeometricMarkup",value:function(){return!1}},{key:"isWithFillMarkup",value:function(){return!0}},{key:"getStartPointForNextMarkup",value:function(){return this.getWorldBoundingBox().center().clone()}}])&&va(t.prototype,n),r&&va(t,r),A}(QA);function Ma(e){return(Ma="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xa(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ua(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Qa(e,t,n){return(Qa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_a(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function La(e,t){return(La=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Fa(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_a(e);if(t){var i=_a(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ra(this,n)}}function Ra(e,t){return!t||"object"!==Ma(t)&&"function"!=typeof t?Ha(e):t}function Ha(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _a(e){return(_a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Ta.singleClickMarkup=!0;var Da=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&La(e,t)}(A,e);var t,n,r,i=Fa(A);function A(e,t,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};xa(this,A),(r=i.call(this,e,t,x,n,o)).markupsExtension.viewer.impl.is2d&&r.registerDimensionEditHandler(),r.textMarkup=new Ta(e,t),r.textMarkup.editState.isFrameUsed=!1,r.registerTextInputHandler({singleLine:!0,onEmptyTextMarkup:r.onEmptyTextMarkup.bind(Ha(r)),submitChanges:r.onSubmitChanges.bind(Ha(r))}),r.getTextStyle=r.textMarkup.getTextStyle.bind(r.textMarkup);var a=r.textInputHandler.editStart;r.textInputHandler.editStart=function(){a.bind(r.textInputHandler)(),r.onTextMarkupEditStart()};var s=r.textInputHandler.editEnd;return r.textInputHandler.editEnd=function(){s.bind(r.textInputHandler)(),r.onTextMarkupEditEnd()},r.textMarkup.textInputHandler=r.textInputHandler,r}return t=A,(n=[{key:"setVisible",value:function(e,t){Qa(_a(A.prototype),"setVisible",this).call(this,e,t),this.textMarkup.setVisible(e,t)}},{key:"setState",value:function(e){Qa(_a(A.prototype),"setState",this).call(this,e),this.textMarkup.rotatedBoundingBox=null,this.textMarkup.boundingBox=null,this.textMarkup.resetFrameBoundingBox()}},{key:"setEditState",value:function(e,t,n){this.textMarkup.rotatedBoundingBox=null,this.textMarkup.boundingBox=null,this.textMarkup.resetFrameBoundingBox(),Qa(_a(A.prototype),"setEditState",this).call(this,e,t,n)}},{key:"createDimension",value:function(){this.strokeMesh&&this.meshContainer.remove(this.strokeMesh),this.strokeMaterial||(this.editState.style[c.THICKNESS]*=Ge,this.strokeMaterial=this.materialManager.addMaterial(this,!1),this.editState.style[c.THICKNESS]/=Ge),this.meshLine=this.markupsExtension.renderer.geometryManager.getStrokeGeometry(this),this.strokeMesh=QA.createMesh(this.meshLine.geometry,this.strokeMaterial),this.meshContainer.add(this.strokeMesh),this.setPosition()}},{key:"calculateWorldBoundingBox",value:function(e){var t=Qa(_a(A.prototype),"calculateWorldBoundingBox",this).call(this,e),n=this.textMarkup.calculateWorldBoundingBox(!0);return t.union(n)}},{key:"renderText",value:function(){var e=this.getEditState(),t=e.anchors,n=e.text,r=e.style,i=dt.cloneDeep(r);i[c.FONT_SIZE]*=je,this.textMarkup.enabled=this.enabled,this.textMarkup.transparent=this.isTransparent(),this.textMarkup.editState.style=i,this.textMarkup.editState.text=n,this.textMarkup.editState.isSingleLine=!0;var A=t[0].clone().add(t[1]).multiplyScalar(.5);this.applyScaleAndTranslation(A),this.textMarkup.creationHandler.calculateAnchorsByCenterPoint(A);var o=this.markupsExtension.renderer.getCameraRotation(),a=this.markupsExtension.renderer.getCameraEyeVector(),s=this.textMarkup.editState.anchors;s.forEach((function(e){at.applyRotation(e,o,A,a)}));var u=at.getSignedAngle(this.markupsExtension.renderer.getCameraRightVector(),t[1].clone().sub(t[0]),this.markupsExtension.renderer.getCameraEyeVector());Math.abs(u)>Math.PI/2&&(u+=Math.PI),this.textMarkup.editState.rotation=u-o;var l=s[1].clone(),h=s[2].clone();at.applyRotation([l,h],this.textMarkup.editState.rotation,A,a);var d=this.editState.style[c.THICKNESS]*Ge*Ve,p=h.clone().sub(l),f=p.clone().normalize().multiplyScalar(d).add(p.multiplyScalar(.5));s.forEach((function(e){e.add(f)})),this.textMarkup.render()}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.editState;Qa(_a(A.prototype),"render",this).call(this);var t=e.anchors;if(t&&t.length>1&&this.createDimension(),this.strokeMesh){if(e.style){this.editState.style[c.THICKNESS]*=Ge;var n=this.hasThicknessChanged(),r=this.materialManager.editMaterial(this.strokeMaterial,this,!1);this.editState.style[c.THICKNESS]/=Ge,r&&(this.strokeMaterial=r,this.strokeMesh.material=r,n&&this.createDimension())}e.translation&&(this.createDimension(),this.setPosition()),this.renderText(),this.markupsExtension.renderer.invalidate()}}},{key:"isTextMarkup",value:function(){return!0}},{key:"isWithFillMarkup",value:function(){return!0}},{key:"onEmptyTextMarkup",value:function(){this.markupsExtension.markupsManager.actionManager.undo();var e=this.creationHandler.getDistance();this.creationHandler.updateEditState({text:e}),this.creationHandler.submitChanges()}},{key:"onSubmitChanges",value:function(){this.textInputHandler.submitChanges(),this.hasChanges=!0}},{key:"remove",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.textMarkup.remove(!1),Qa(_a(A.prototype),"remove",this).call(this,e)}},{key:"onTextMarkupEditStart",value:function(){var e=this.textMarkup.editState.text;"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,e.length-1)),this.hasChanges=!1,this.creationHandler.updateEditState({text:e})}},{key:"onTextMarkupEditEnd",value:function(){var e=this.textMarkup.editState.text;"("===e[0]&&")"===e[e.length-1]&&(e=e.slice(1,e.length-1)),""!==e&&(this.hasChanges?(this.markupsExtension.markupsManager.actionManager.undo(),this.creationHandler.updateEditState({text:"(".concat(e,")")}),this.creationHandler.submitChanges()):e!==this.creationHandler.getDistance()&&this.creationHandler.updateEditState({text:"(".concat(e,")")}))}}])&&Ua(t.prototype,n),r&&Ua(t,r),A}(QA);function Oa(e){return(Oa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ia(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pa(e,t){return(Pa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Na(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Va(e);if(t){var i=Va(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ka(this,n)}}function Ka(e,t){return!t||"object"!==Oa(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Va(e){return(Va=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Da.withSnappingMarkup=!0;var Ga=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pa(e,t)}(n,e);var t=Na(n);function n(e,r,i){var A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Ia(this,n),t.call(this,e,r,U,i,A)}return n}(PA);function ja(e){return(ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ya(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wa(e,t,n){return(Wa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qa(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function Xa(e,t){return(Xa=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ja(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=qa(e);if(t){var i=qa(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return za(this,n)}}function za(e,t){return!t||"object"!==ja(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function qa(e){return(qa=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Za(e){return(Za="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function es(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ts(e,t){return(ts=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ns(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=As(e);if(t){var i=As(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return rs(this,n)}}function rs(e,t){return!t||"object"!==Za(t)&&"function"!=typeof t?is(e):t}function is(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function As(e){return(As=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var os=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ts(e,t)}(A,e);var t,n,r,i=ns(A);function A(e,t,n,r){var o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};$a(this,A);var s=(o=i.call(this,e,t,n,r,a)).getTextMarkup();return s.textInputHandler.onEmptyTextMarkup=o.onEmptyTextMarkup.bind(is(o)),o}return t=A,(n=[{key:"getArrowMarkup",value:function(){throw new Error("getArrowMarkup should be implemented")}},{key:"getTextMarkup",value:function(){throw new Error("getTextMarkup should be implemented")}},{key:"getShapeMarkup",value:function(){throw new Error("getShapeMarkup should be implemented")}},{key:"getQuadrant",value:function(e,t){var n=e.getWorldBoundingBox(!0),r=Math.atan2(n.size().y,n.size().x);return t>=-(Math.PI-r)&&t<-r?1:t>=-r&&t<r?2:t>=r&&t<Math.PI-r?3:4}},{key:"getTextQuadrant",value:function(e){return this.getQuadrant(this.getTextMarkup(),e)}},{key:"getShapeQuadrant",value:function(e){return this.getQuadrant(this.getShapeMarkup(),e)}},{key:"getVectorToClosestPointOnCloud",value:function(e){var t=this.getTextMarkup().frameMarkup.meshLine.sourceGeo,n=1/0,r=null;return t.forEach((function(t){var i=e.distanceToSquared(t);i<n&&(n=i,r=t)})),e.clone().sub(r)}},{key:"applyArrowTextConstraint",value:function(e){var t=this.getArrowMarkup(),n=this.getTextMarkup();if((e=e||t.getEditState()).anchors[0]&&e.anchors[1]){var r=n.getWorldBoundingBox(!0),i=r.center(),A=n.editState.style[c.THICKNESS]/2,o=r.size().y/2-A,a=r.size().x/2-A,s=e.anchors[0],u=e.anchors[1].clone();t.applyScaleAndTranslation(u);var l=Math.atan2(u.y-i.y,u.x-i.x);switch(this.getTextQuadrant(l)){case 1:s.set(i.x,i.y-o,0);break;case 2:s.set(i.x+a,i.y,0);break;case 3:s.set(i.x,i.y+o,0);break;case 4:s.set(i.x-a,i.y,0)}if(n.editState.frameType===B){var h=s.clone().sub(i),d=this.getVectorToClosestPointOnCloud(h).negate();s.add(d)}t.applyInverseScaleAndTranslation(s),t.creationHandler.updateEditStateAnchors()}}},{key:"applyShapeArrowConstraint",value:function(e){var t=this.getArrowMarkup(),n=this.getShapeMarkup();if((e=e||t.getEditState()).anchors[0]&&e.anchors[1]){var r=n.getWorldBoundingBox(!0),i=r.center(),A=r.size().y/2,o=r.size().x/2,a=e.anchors[1],s=e.anchors[0].clone();t.applyScaleAndTranslation(s);var u,c=s.x-i.x,l=s.y-i.y,h=Math.atan2(l,c),d=function(e){return e>0?1:-1};switch(this.getShapeQuadrant(h)){case 1:u=d(c)*o/3,a.set(i.x+u,i.y-A,0);break;case 2:u=d(l)*A/3,a.set(i.x+o,i.y+u,0);break;case 3:u=d(c)*o/3,a.set(i.x+u,i.y+A,0);break;case 4:u=d(l)*A/3,a.set(i.x-o,i.y+u,0)}t.applyInverseScaleAndTranslation(a),t.creationHandler.updateEditStateAnchors()}}},{key:"applyArrowConstraints",value:function(e){throw new Error("applyArrowTextConstraint must be implemented")}},{key:"applyConstraints",value:function(e,t,n){throw new Error("applyConstraints must be implemented")}},{key:"applyTranslation",value:function(e,t,n){var r=this;this.markups.forEach((function(i){if(i!==e&&i.isCompleted()){if(i.setLocked(!0),e.type===g){var A=n.translation.clone().sub(t.translation);A=i.editState.translation.clone().add(A),i.creationHandler.updateEditState({translation:A})}else r.applyArrowConstraints();i.setLocked(!1)}}))}},{key:"applyStyle",value:function(e,t,n,r){var i=this;this.markups.forEach((function(t){t!==e&&t.isCompleted()&&(t.setLocked(!0),t.creationHandler.updateEditState({style:r.style}),i.applyArrowConstraints(),t.setLocked(!1))}))}},{key:"applyScale",value:function(e,t,n){var r=this;this.markups.forEach((function(t){t!==e&&t.isCompleted()&&t.type===g&&(t.setLocked(!0),r.applyArrowConstraints(),t.setLocked(!1))}))}},{key:"applyTextChange",value:function(e,t,n){this.applyArrowConstraints()}},{key:"onEmptyTextMarkup",value:function(){this.markupsExtension.markupsManager.actionManager.undo();var e=this.getTextMarkup();e.creationHandler.updateEditState({text:e.getDefaultState().text}),e.creationHandler.submitChanges()}}])&&es(t.prototype,n),r&&es(t,r),A}(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xa(e,t)}(A,e);var t,n,r,i=Ja(A);function A(e,t,n,r,o){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A),i.call(this,e,t,n,r,o)}return t=A,(n=[{key:"render",value:function(){arguments.length>0&&void 0!==arguments[0]||this.editState}},{key:"intersect",value:function(e){return!1}},{key:"isGroupMarkup",value:function(){return!0}},{key:"select",value:function(e){this.selected=!0,this.enableEdit(),e&&(this.setLocked(!0),this.markups.forEach((function(t){return t!==e&&!t.isSelected()&&t.select()})),this.setLocked(!1)),this.setDirty()}},{key:"setHover",value:function(e,t){this.hover!==e&&(this.hover=e,t&&(this.setLocked(!0),this.markups.forEach((function(n){return n!==t&&n.isHovered()!==e&&n.setHover(e)})),this.setLocked(!1)),this.setDirty())}},{key:"calculateWorldBoundingBox",value:function(){var e=new THREE.Box3;return this.markups.forEach((function(t){var n=t.getWorldBoundingBox(!0);e.union(n)})),e}},{key:"remove",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.markups.forEach((function(t){return t.remove(e)})),Wa(qa(A.prototype),"remove",this).call(this,e)}},{key:"syncGroupMarkups",value:function(e,t,n,r,i){r.anchors&&this.applyConstraints(e,t,n),r.translation&&i instanceof xn&&0===i.keyTranslation.length()&&this.applyTranslation(e,t,n),r.scale&&i instanceof $n&&this.applyScale(e,t,n),r.style&&this.applyStyle(e,t,n,r),r.text&&this.applyTextChange(e,t,n)}},{key:"applyConstraints",value:function(e,t,n){}},{key:"applyTranslation",value:function(e,t,n){}},{key:"applyStyle",value:function(e,t,n,r){}},{key:"applyScale",value:function(e,t,n){}},{key:"applyTextChange",value:function(e,t,n){}}])&&Ya(t.prototype,n),r&&Ya(t,r),A}(QA));function as(e){return(as="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ss(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function us(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function cs(e,t){return(cs=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ls(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ds(e);if(t){var i=ds(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return hs(this,n)}}function hs(e,t){return!t||"object"!==as(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ds(e){return(ds=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}os.withSnappingMarkup=!0;var ps=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&cs(e,t)}(A,e);var t,n,r,i=ls(A);function A(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return ss(this,A),i.call(this,e,t,T,n,r)}return t=A,(n=[{key:"getTextMarkup",value:function(){return this.markups[1]}},{key:"getArrowMarkup",value:function(){return this.markups[0]}},{key:"applyArrowConstraints",value:function(e){this.applyArrowTextConstraint(e)}},{key:"applyConstraints",value:function(e,t,n){var r=this;this.markups.forEach((function(t){t!==e&&t.isCompleted()&&e.type===g&&e.anchorHandler.activeAnchor===e.getHead()&&(e.setLocked(!0),r.applyArrowConstraints(n),e.setLocked(!1))}))}}])&&us(t.prototype,n),r&&us(t,r),A}(os);function fs(e){return(fs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ys(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function gs(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Es(e,t){return(Es=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ms(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vs(e);if(t){var i=vs(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Bs(this,n)}}function Bs(e,t){return!t||"object"!==fs(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vs(e){return(vs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ws,ks=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Es(e,t)}(A,e);var t,n,r,i=ms(A);function A(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return ys(this,A),i.call(this,e,t,M,n,r)}return t=A,(n=[{key:"getTextMarkup",value:function(){return this.markups[2]}},{key:"getArrowMarkup",value:function(){return this.markups[1]}},{key:"getShapeMarkup",value:function(){return this.markups[0]}},{key:"applyArrowConstraints",value:function(e){this.applyArrowTextConstraint(e),this.applyShapeArrowConstraint(e)}},{key:"applyConstraints",value:function(e,t,n){var r=this;this.markups.forEach((function(t){t!==e&&t.isCompleted()&&e.type===g&&(e.setLocked(!0),t.type===B?r.applyShapeArrowConstraint(n):r.applyArrowTextConstraint(n),e.setLocked(!1))}))}}])&&gs(t.prototype,n),r&&gs(t,r),A}(os);function Cs(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var bs=(Cs(ws={},g,XA),Cs(ws,k,ro),Cs(ws,C,ho),Cs(ws,E,Uo),Cs(ws,m,Oo),Cs(ws,B,Wo),Cs(ws,v,ua),Cs(ws,w,Ea),Cs(ws,T,ps),Cs(ws,M,ks),Cs(ws,S,Ta),Cs(ws,b,Ta),Cs(ws,x,Da),Cs(ws,U,Ga),ws);function Ss(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ts=Autodesk.Viewing,Ms=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.setGlobalManager(t.globalManager),this.viewer=t.viewer,this.names=["markups"],this.isActive=!1,this.onCameraChangedBinded=this.onCameraChanged.bind(this),this.onEditStartBinded=this.onEditStart.bind(this),this.onEditEndBinded=this.onEditEnd.bind(this),this.onDrawEndBinded=this.onDrawEnd.bind(this),this.onCreationTypeChangedBinded=this.onCreationTypeChanged.bind(this),this.onSelectionChangedBinded=this.onSelectionChanged.bind(this),this.rectSelector=new dn(this.markupsExtension),this.lastDrawEndTime=-1/0}var t,n,r;return t=e,(n=[{key:"getNames",value:function(){return this.names}},{key:"getName",value:function(){return this.names[0]}},{key:"getPriority",value:function(){return this.markupsExtension.markupsManager.isMarkupSessionOpen()?200:40}},{key:"updateToolPriority",value:function(){this.markupsExtension.viewer.toolController.rearrangeByPriorities()}},{key:"intersectHandler",value:function(e,t){if(this.lastMousePos)for(var n=e.length-1;n>=0;n--){var r=e[n];if(r.isCompleted()){var i=r[t];if(i){var A=this.lastMousePos.clone();if(i.intersect(A)||i.isDragging())return i.getCursor()}}}return null}},{key:"getCursor",value:function(){var e=this.markupsExtension.markupsManager.getDuringCreationMarkup(!1),t=this.markupsExtension.markupsManager.getEnabledMarkups(),n=this.markupsExtension.markupsManager.getActiveLayer(),r=this.hasSelection(),i=null;if(this.markupsExtension.markupsManager.isMarkupSessionOpen()){var A=this.markupsExtension.markupsManager.getInEditMarkups(),o=n.getAllLinks();i=(i=(i=(i=(i=(i=(i=e&&e.creationHandler.getCursor())||this.intersectHandler(o,"anchorHandler"))||this.intersectHandler(A,"anchorHandler"))||this.intersectHandler(A,"scaleHandler"))||this.intersectHandler(A,"rotationHandler"))||this.intersectHandler(A,"translationHandler"))||this.intersectHandler(A,"dimensionEditHandler")}if(i=i||this.intersectHandler(t,"selectionHandler"),!this.markupsExtension.markupsManager.isMarkupSessionOpen()){var a=this.markupsExtension.markupsManager.getVisibleLinks();i=i||this.intersectHandler(a,"selectionHandler")}var s=this.markupsExtension.markupsManager.getMarkupCreationType();return i||s!==Q||this.isRectSelectorActive()||(i="auto"),i=i||s&&(r&&!this.isRectSelectorActive()?"auto":it[s]||"crosshair")}},{key:"register",value:function(){this.snapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(this.viewer,{markupMode:!0}),this.viewer.toolController.registerTool(this.snapper)}},{key:"deregister",value:function(){this.snapper&&(this.viewer.toolController.deregisterTool(this.snapper),this.snapper=null)}},{key:"activate",value:function(e){e!==this.getName()||this.isActive||(this.isActive=!0,this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_EDIT_START,this.onEditStartBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_EDIT_END,this.onEditEndBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DRAWING_END,this.onDrawEndBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_CREATION_TYPE_CHANGED,this.onCreationTypeChangedBinded),this.addDocumentEventListener("selectionchange",this.onSelectionChangedBinded))}},{key:"deactivate",value:function(e){e===this.getName()&&this.isActive&&(this.isActive=!1,this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_EDIT_START,this.onEditStartBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_EDIT_END,this.onEditEndBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DRAWING_END,this.onDrawEndBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_CREATION_TYPE_CHANGED,this.onCreationTypeChangedBinded),this.removeDocumentEventListener("selectionchange",this.onSelectionChangedBinded),this.onCreationTypeChanged())}},{key:"onSelectionChanged",value:function(){this.markupsExtension.markupsManager.getSelectedMarkups().forEach((function(e){e.isTextMarkup()&&e.isInEdit()&&e.textInputHandler.updateCaretPosition()}))}},{key:"eventToWorld",value:function(e){var t={x:e.canvasX,y:e.canvasY};return this.markupsExtension.renderer.clientToWorld(t)}},{key:"getSnappedPosition",value:function(){if(!this.lastSnapPoint)if(this.viewer.impl.is2d||this.isSnappingAllowed()){var e={x:this.originalEvent.canvasX,y:this.originalEvent.canvasY};if(this.snapper.onMouseMove(e),this.viewer.model.isLeaflet()||this.snapper.indicator.render(),this.snapper.isSnapped()){var t=Autodesk.Viewing.MeasureCommon.getSnapResultPosition(this.snapper.getSnapResult(),this.viewer);this.lastSnapPoint=this.markupsExtension.renderer.documentCameraToMarkupsCamera(t)}else this.lastSnapPoint=this.lastMousePos}else this.lastSnapPoint=this.lastMousePos;return this.lastSnapPoint.clone()}},{key:"applyHandler",value:function(e,t,n,r){for(var i=e.length-1;i>=0;i--){var A=e[i];if(A.isCompleted()){var o=A[t];if(o&&o[n](this.lastMousePos,r))return!0}}return!1}},{key:"isNavigationToolActive",value:function(){return this.viewer.getActiveNavigationTool()!==this.getName()}},{key:"isSnappingAllowed",value:function(){var e=this.markupsExtension.markupsManager.getMarkupCreationType();return e&&bs[e].withSnappingMarkup&&(e===x||!this.viewer.model.isLeaflet())}},{key:"isRectSelectorActive",value:function(){return this.markupsExtension.markupsManager.isMarkupSessionOpen()&&this.markupsExtension.markupsManager.getMarkupCreationType()===Q}},{key:"hasSelection",value:function(){var e=this.markupsExtension.markupsManager.isMarkupSessionOpen();return this.markupsExtension.markupsManager.getSelectedMarkups().length>0||!e&&(this.markupsExtension.markupsManager.getSelectedLayers().length>0||this.markupsExtension.markupsManager.getSelectedLinks().length>0)}},{key:"handleMouseEvent",value:function(e,t,n,r){if(!this.markupsExtension.isToolEnabled())return!1;this.lastMousePos=this.eventToWorld(e),this.originalEvent=e,this.markupsExtension.renderer.updateRaycaster({x:e.canvasX,y:e.canvasY});var i,A,o=this.markupsExtension.markupsManager.getMarkupCreationType(),a=this.markupsExtension.markupsManager.isMarkupSessionOpen();if(!this.markupInEdit&&(!o||!bs[o].useTimerBeforeSelection||bs[o].useTimerBeforeSelection&&performance.now()-this.lastDrawEndTime>rt)){var s=this.markupsExtension.markupsManager.getEnabledMarkups().filter((function(e){return!e.isSelected()}));i=i||this.applyHandler(s,"selectionHandler",n,t)}var u=this.markupsExtension.markupsManager.getActiveLayer();if(o&&(A=this.markupsExtension.markupsManager.getDuringCreationMarkup(!1))&&!A.isCompleted())if(i)A.creationHandler.creationCancel();else{var c=A.creationHandler.getSnappedPosition();i="handleMouseMove"===n&&!this.mouseMoved&&!A.creationHandler.creationStarted||A.creationHandler[n](c,t)}if(a){var l=u.getAllLinks();i=i||this.applyHandler(l,"anchorHandler",n,t);var h=this.markupsExtension.markupsManager.getInEditMarkups();i=(i=(i=(i=(i=(i=i||this.applyHandler(h,"scaleHandler",n,t))||this.applyHandler(h,"anchorHandler",n,t))||this.applyHandler(h,"rotationHandler",n,t))||this.applyHandler(h,"translationHandler",n,t))||this.applyHandler(h,"dimensionEditHandler",n,t))||this.applyHandler(h,"textInputHandler",n,t)}if(!i&&"handleMouseMove"===n&&this.isSnappingAllowed()&&this.getSnappedPosition(),this.isRectSelectorActive()&&(i=i||this.rectSelector[n](this.lastMousePos)),!a){var d=this.markupsExtension.markupsManager.getVisibleLinks();i=i||this.applyHandler(d,"selectionHandler",n,t)}if(!i&&("handleButtonUp"===n||"handleButtonDown"===n&&o&&bs[o].singleClickMarkup)&&(!this.hasSelection()||this.shiftDown||this.mouseMoved||this.isRectSelectorActive()||(this.markupsExtension.markupsManager.deselectAllMarkups(),this.markupsExtension.markupsManager.deselectAllLinks(),a||this.markupsExtension.markupsManager.deselectAllLayers(null),i=!0)),!i&&r&&o&&!this.isNavigationToolActive()&&(A=this.markupsExtension.markupsManager.getDuringCreationMarkup(!0))){var p=A.creationHandler.getSnappedPosition();(i=A.creationHandler[n](p,t))||A.creationHandler.creationCancel()}return this.lastSnapPoint=null,i}},{key:"handleButtonDown",value:function(e,t){if(this.dragging=!0,this.buttonDownPos=new THREE.Vector2(e.canvasX,e.canvasY,0),this.mouseMoved=!1,this.buttonDownConsumed=!1,this.selectedOnDown=!1,this.panning=!Autodesk.Viewing.isMobileDevice()&&(this.isRightClick(e)||this.isMiddleClick(e)),this.panning)return!1;this.markupsExtension.markupsManager.dispatchEvent({type:A.BUTTON_DOWN}),this.buttonDownConsumed=this.handleMouseEvent(e,t,"handleButtonDown",!0);var n=this.markupsExtension.markupsManager.getSelectedMarkups();return this.selectedOnDown=n.length>0,this.buttonDownConsumed}},{key:"handleButtonUp",value:function(e,t){if(this.dragging=!1,this.buttonDownPos=null,this.buttonUpConsumed=!1,this.buttonUpCalled=!0,this.panning||this.mouseMoved&&!this.buttonDownConsumed)return this.panning=!1,this.mouseMoved=!1,!1;var n=this.handleMouseEvent(e,t,"handleButtonUp",!1),r=this.markupsExtension.markupsManager.getSelectedMarkups();if(!this.mouseMoved&&this.selectedOnDown&&!r[0]){var i=this.markupsExtension.markupsManager.getDuringCreationMarkup(!1);i&&i.creationHandler.creationCancel(),this.markupsExtension.markupsManager.deselectAllMarkups()}this.buttonUpConsumed=n;var A=this.mouseMoved;return this.mouseMoved=!1,n&&A||this.isRectSelectorActive()}},{key:"handleDoubleClick",value:function(e,t){var n=this.handleMouseEvent(e,t,"handleDoubleClick",!1),r=this.markupsExtension.markupsManager.isMarkupSessionOpen()&&this.markupsExtension.markupsManager.getMarkupCreationType();return n||r}},{key:"handleMouseMove",value:function(e){if(this.panning)return!1;this.buttonDownPos&&!this.mouseMoved&&(this.mouseMoved=new THREE.Vector2(e.canvasX,e.canvasY,0).distanceTo(this.buttonDownPos)>be),this.markupsExtension.markupsManager.unhoverAllLayers(),this.markupsExtension.markupsManager.unhoverAllMarkups();var t=this.handleMouseEvent(e,null,"handleMouseMove",!1);return this.dragging&&t}},{key:"handleKeyDown",value:function(e,t){var n=this,r=this.markupsExtension.markupsManager.getInEditMarkups(),i=!1,o=this.markupsExtension.markupsManager.getDuringCreationMarkup(!1);if(o)i=o.creationHandler.handleKeyDown(e,t);else{var a;this.markupsExtension.markupsManager.openActionGroup();for(var s=r.length-1;s>=0;s--){var u=r[s];u&&u.isCompleted()&&((a=u.anchorHandler&&u.anchorHandler.handleKeyDown(e,t))||(a=u.textInputHandler&&u.textInputHandler.handleKeyDown(e,t)),a||(a=u.scaleHandler&&u.scaleHandler.handleKeyDown(e,t)),a||(a=u.rotationHandler&&u.rotationHandler.handleKeyDown(e,t)),a||(a=u.translationHandler&&u.translationHandler.handleKeyDown(e,t)),a||(a=u.dimensionEditHandler&&u.dimensionEditHandler.handleKeyDown(e,t)),a||(a=u.selectionHandler&&u.selectionHandler.handleKeyDown(e,t))),i=i||a}this.markupsExtension.markupsManager.closeActionGroup()}for(var c=this.markupsExtension.markupsManager.getVisibleLinks(),l=c.length-1;l>=0;l--){var h=c[l];i=(i=i||h.anchorHandler&&h.anchorHandler.handleKeyDown(e,t))||h.selectionHandler&&h.selectionHandler.handleKeyDown(e,t)}if(!i)switch(t){case Autodesk.Viewing.KeyCode.CONTROL:this.ctrlDown=!0;break;case Autodesk.Viewing.KeyCode.SHIFT:this.shiftDown=!0,i=!0;break;case Autodesk.Viewing.KeyCode.a:this.ctrlDown&&this.markupsExtension.markupsManager.isMarkupSessionOpen()&&(this.markupsExtension.markupsManager.getActiveLayer().selectAllMarkups(),i=!0);break;case Autodesk.Viewing.KeyCode.x:this.ctrlDown&&(this.markupsExtension.cut(),i=!0);break;case Autodesk.Viewing.KeyCode.c:this.ctrlDown&&(this.markupsExtension.copy(),i=!0);break;case Autodesk.Viewing.KeyCode.v:this.ctrlDown&&(this.markupsExtension.paste(),i=!0);break;case Autodesk.Viewing.KeyCode.d:this.ctrlDown&&(this.markupsExtension.copy(),this.markupsExtension.paste(),i=!0);break;case Autodesk.Viewing.KeyCode.z:this.ctrlDown&&!this.shiftDown?(this.markupsExtension.undo(),i=!0):this.ctrlDown&&this.shiftDown&&(this.markupsExtension.redo(),i=!0);break;case Autodesk.Viewing.KeyCode.y:this.ctrlDown&&(this.markupsExtension.redo(),i=!0);break;case Autodesk.Viewing.KeyCode.ESCAPE:this.markupsExtension.markupsManager.getSelectedMarkups().length>0?(this.markupsExtension.markupsManager.deselectAllMarkups(),i=!0):this.markupsExtension.markupsManager.isMarkupSessionOpen()?(this.markupsExtension.markupsManager.getActiveLayer().isEmpty()?this.markupsExtension.endMarkupSession(!1):this.markupsExtension.markupsManager.dispatchEvent({type:A.LAYER_DISCARD_PRESSED,onConfirmCB:function(){n.markupsExtension.endMarkupSession(!1)}}),i=!0):this.markupsExtension.markupsManager.getSelectedLayers().length>0&&(this.markupsExtension.markupsManager.deselectAllLayers(),i=!0);break;case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:this.markupsExtension.markupsManager.deleteInEditMarkups()}return i}},{key:"handleSingleClick",value:function(e,t){return this.buttonUpConsumed}},{key:"handleKeyUp",value:function(e,t){var n=this.markupsExtension.markupsManager.getInEditMarkups(),r=this.markupsExtension.markupsManager.getDuringCreationMarkup(!1);if(r)r.creationHandler.handleKeyUp(e,t);else{this.markupsExtension.markupsManager.openActionGroup();for(var i=n.length-1;i>=0;i--){var A=n[i];A&&A.isCompleted()&&(e.isDuringEdit=i<n.length-1,A.anchorHandler&&A.anchorHandler.handleKeyUp(e,t)||A.translationHandler&&A.translationHandler.handleKeyUp(e,t))}this.markupsExtension.markupsManager.closeActionGroup()}switch(t){case Autodesk.Viewing.KeyCode.CONTROL:this.ctrlDown=!1;break;case Autodesk.Viewing.KeyCode.SHIFT:this.shiftDown=!1}return!1}},{key:"onCameraChanged",value:function(){this.isSnappingAllowed()&&!this.viewer.model.isLeaflet()&&this.snapper.indicator.render()}},{key:"onCreationTypeChanged",value:function(){this.snapper.indicator.clearOverlays()}},{key:"onEditStart",value:function(){this.markupInEdit=!0,this.snapper.indicator.clearOverlays()}},{key:"onEditEnd",value:function(){this.markupInEdit=!1,this.snapper.indicator.clearOverlays()}},{key:"onDrawEnd",value:function(){this.lastDrawEndTime=performance.now()}},{key:"isMiddleClick",value:function(e){return Autodesk.Viewing.Private.isMiddleClick(e)}},{key:"isRightClick",value:function(e){return Autodesk.Viewing.Private.isRightClick(e,this.viewer.navigation)}},{key:"handleBlur",value:function(){this.ctrlDown=!1,this.shiftDown=!1}},{key:"handleSingleTap",value:function(e){var t=this.buttonUpConsumed;return this.buttonUpCalled||(this.handleButtonDown(e,0),t=this.handleButtonUp(e,0)||this.buttonUpConsumed),this.buttonUpCalled=!1,t}},{key:"handleDoubleTap",value:function(e){return this.handleDoubleClick(e,0)}},{key:"isNavigationJustEnded",value:function(){return this.navigationEndTime&&Date.now()-this.navigationEndTime<We}},{key:"handleGesture",value:function(e){var t;switch(e.type){case"dragstart":return!this.isNavigationJustEnded()&&this.handleButtonDown(e,0);case"dragmove":return!this.isNavigationJustEnded()&&this.handleMouseMove(e);case"dragend":return!this.isNavigationJustEnded()&&(t=this.handleButtonUp(e,0),this.buttonUpCalled=!1,t);case"pinchend":case"panend":this.navigationEndTime=Date.now()}return!1}}])&&Ss(t.prototype,n),r&&Ss(t,r),e}();function xs(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Ts.GlobalManagerMixin.call(Ms.prototype);var Us=Autodesk.Viewing,Qs=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t.viewer,this.setGlobalManager(t.globalManager),this.options=t.options,this.markupsExtension=t,this.createUI()}var t,n,r;return t=e,(n=[{key:"createUI",value:function(){var e=this.options.uiClasses;if(e){var t=this.getDocument();this.uiContainer=t.createElement("div"),this.uiContainer.id="MarkupsUI_Container",this.uiContainer.className="MarkupsUI_Container",this.viewer.container.appendChild(this.uiContainer);var n=e.ToolbarClass;this.toolbar=n&&new n(this.markupsExtension,this.uiContainer,this.viewer,this.options);var r=e.CreationToastClass;this.creationToast=r&&new r(this.markupsExtension,this.uiContainer,this.viewer,this.options);var i=e.ContextualMenuClass;this.contextualMenu=i&&new i(this.markupsExtension,this.uiContainer,this.viewer,this.options);var A=e.AttachmentsPreviewPanelClass;this.attachmentsPreviewPanel=A&&new A(this.markupsExtension,this.uiContainer,this.viewer,this.options);var o=e.MarkupsDialogModalsClass;if(this.MarkupsDialogModals=o&&new o(this.markupsExtension,this.uiContainer,this.viewer,this.options),this.viewer.impl.is2d){var a=e.MarkupsVisibilityButtonClass;this.markupsVisibilityButton=a&&new a(this.markupsExtension,this.uiContainer,this.viewer,this.options)}else{var s=e.ExitMarkupViewClass;this.exitMarkupView=s&&new s(this.markupsExtension,this.uiContainer,this.viewer,this.options)}this.registerEventListeners()}}},{key:"destroy",value:function(){this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),this.creationToast&&(this.creationToast.destroy(),this.creationToast=null),this.contextualMenu&&(this.contextualMenu.destroy(),this.contextualMenu=null),this.attachmentsPreviewPanel&&(this.attachmentsPreviewPanel.destroy(),this.attachmentsPreviewPanel=null),this.markupsVisibilityButton&&(this.markupsVisibilityButton.destroy(),this.markupsVisibilityButton=null),this.exitMarkupView&&(this.exitMarkupView.destroy(),this.exitMarkupView=null),this.unregisterEventListeners(),this.uiContainer&&(this.viewer.container.removeChild(this.uiContainer),this.uiContainer=null),this.markupsExtension=null,this.viewer=null,this.options=null}},{key:"registerEventListeners",value:function(){this.onSessionStartBinded=this.onSessionStart.bind(this),this.onSessionEndBinded=this.onSessionEnd.bind(this),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_START,this.onSessionStartBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_END,this.onSessionEndBinded),this.markupsExtension.markupsManager.addEventListener(A.LAYER_SELECTED,this.onSessionStartBinded),this.markupsExtension.markupsManager.addEventListener(A.LAYER_DESELECTED,this.onSessionEndBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_CREATION_TYPE_CHANGED,this.onSessionStartBinded)}},{key:"unregisterEventListeners",value:function(){this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_START,this.onSessionStartBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_END,this.onSessionEndBinded),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_SELECTED,this.onSessionStartBinded),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DESELECTED,this.onSessionEndBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_CREATION_TYPE_CHANGED,this.onSessionStartBinded)}},{key:"onSessionStart",value:function(){this.selectNavigationButton(null),this.viewer.impl.is2d&&this.handleNavButtonEvents(!0)}},{key:"onSessionEnd",value:function(){this.viewer.impl.is2d&&this.handleNavButtonEvents(!1),this.selectNavigationButton(this.markupsExtension.markupsManager.navigationToolBackup)}},{key:"getNavigationControls",value:function(){return this.viewer.getToolbar().getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID)._controls}},{key:"handleNavButtonEvents",value:function(e){var t=this;this.onNavButtonClickBinded=this.onNavButtonClick.bind(this);var n=this.getNavigationControls(),r=function(n){e?n.hasEventListener(Autodesk.Viewing.UI.Button.Event.CLICK,t.onNavButtonClickBinded)||n.addEventListener(Autodesk.Viewing.UI.Button.Event.CLICK,t.onNavButtonClickBinded):n.removeEventListener(Autodesk.Viewing.UI.Button.Event.CLICK,t.onNavButtonClickBinded)};n.forEach((function(e){r(e),e.subMenu&&e.subMenu._controls.forEach((function(e){r(e)}))}))}},{key:"onNavButtonClick",value:function(e){var t=this;this.getNavigationControls().forEach((function(n){n._id!==e.target._id?n.setState(Autodesk.Viewing.UI.Button.State.INACTIVE):n.getState()===Autodesk.Viewing.UI.Button.State.INACTIVE&&(t.markupsExtension.markupsManager.changeMarkupCreationType(null),n.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),setTimeout((function(){t.markupsExtension.markupsManager.navigationToolBackup=t.viewer.getActiveNavigationTool()})))}))}},{key:"selectNavigationButton",value:function(e){var t=function(t){var n=-1!==t._id.toLowerCase().indexOf(e);t.setState(n?Autodesk.Viewing.UI.Button.State.ACTIVE:Autodesk.Viewing.UI.Button.State.INACTIVE)};this.getNavigationControls().forEach((function(e){t(e),e.subMenu&&e.subMenu._controls.forEach((function(e){t(e)}))}))}}])&&xs(t.prototype,n),r&&xs(t,r),e}();function Ls(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Us.GlobalManagerMixin.call(Qs.prototype);var Fs=function(){function e(t,n,r,i,A){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.guid=t,this.resources=n||[],this.attachments=r||[],this.status=i,this.metadata=A||{}}var t,n,r;return t=e,(n=[{key:"getSvgResource",value:function(){return this.resources[0]&&this.resources[0].data}},{key:"getScreenCaptureResource",value:function(){return this.resources[1]&&this.resources[1].data}},{key:"getLinksMetadata",value:function(){return this.metadata&&this.metadata.markup_metadata&&this.metadata.markup_metadata.links}},{key:"getMetadata",value:function(){return this.metadata}}])&&Ls(t.prototype,n),r&&Ls(t,r),e}();function Rs(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Hs=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.viewer=t.viewer,this.link=n,this.link.syncEditState()}var t,n,r;return t=e,(n=[{key:"getEditState",value:function(){return this.link.getEditState()}},{key:"setEditState",value:function(e){this.link.setEditState(e)}},{key:"updateEditState",value:function(e){this.setEditState(Object.assign({},this.getEditState(),e))}},{key:"submitChanges",value:function(){new xt(this.markupsExtension.markupsManager,this.link,this.getEditState()).execute()}},{key:"isDragging",value:function(){return!1}},{key:"getTouchRadiusWorld",value:function(){return this.markupsExtension.renderer.sizeFromClientToWorld(ke)}},{key:"getMinChangeDistanceWorld",value:function(){return this.markupsExtension.renderer.sizeFromClientToWorld(be)}},{key:"didMouseMove",value:function(){return this.markupsExtension.markupsTool.mouseMoved}},{key:"handleDoubleClick",value:function(e,t){}},{key:"handleButtonDown",value:function(e,t){}},{key:"handleButtonUp",value:function(e,t){}},{key:"handleKeyDown",value:function(e,t){}},{key:"handleKeyUp",value:function(e,t){}},{key:"handleMouseMove",value:function(e){}},{key:"handleGesture",value:function(e){}},{key:"handleResize",value:function(){}},{key:"destroy",value:function(){this.markupsExtension=null,this.viewer=null,this.link=null}}])&&Rs(t.prototype,n),r&&Rs(t,r),e}();function _s(e){return(_s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ds(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Os(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Is(e,t){return(Is=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ps(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ks(e);if(t){var i=Ks(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ns(this,n)}}function Ns(e,t){return!t||"object"!==_s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ks(e){return(Ks=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Vs=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Is(e,t)}(A,e);var t,n,r,i=Ps(A);function A(){return Ds(this,A),i.apply(this,arguments)}return t=A,(n=[{key:"handleMouseMove",value:function(e){var t=this.grabbing||this.intersect(e);return this.link.setHover(t),!!this.grabbing&&(this.updatePosition(e),!0)}},{key:"handleButtonDown",value:function(e,t){return!!this.grabbing||(this.grabbing=this.intersect(e),this.grabbing&&(this.originalPosition=e.clone(),this.lastTranslationPoint=e),!!this.grabbing)}},{key:"handleButtonUp",value:function(e,t){return!!this.grabbing&&(this.updatePosition(e),It(e,this.originalPosition,this.getMinChangeDistanceWorld())?(this.cancelAnchorEditing(),!1):(this.submitChanges(),this.grabbing=!1,this.lastTranslationPoint=null,!0))}},{key:"handleKeyDown",value:function(e,t){if(this.grabbing)switch(t){case Autodesk.Viewing.KeyCode.BACKSPACE:case Autodesk.Viewing.KeyCode.DELETE:case Autodesk.Viewing.KeyCode.ESCAPE:return this.cancelAnchorEditing(),!0}return!1}},{key:"updateEditStatePosition",value:function(){this.updateEditState({position:this.getEditState().position})}},{key:"updatePosition",value:function(e){var t=e.clone().sub(this.lastTranslationPoint);this.link.editState.position||(this.link.editState.position=this.link.getLinkBasePosition()),Kt(this.link.editState.position,t),this.lastTranslationPoint=e,this.updateEditStatePosition()}},{key:"cancelAnchorEditing",value:function(){this.grabbing=!1,this.link.syncEditState(),this.updateEditStatePosition()}},{key:"isDragging",value:function(){return this.grabbing}},{key:"intersect",value:function(e){var t=this.markupsExtension.renderer.worldToClient(e);return this.link.getClientBoundingBox().containsPoint(t)}},{key:"getCursor",value:function(){return this.grabbing?"grabbing":"grab"}}])&&Os(t.prototype,n),r&&Os(t,r),A}(Hs);function Gs(e){return(Gs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function js(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ys(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Ws(e,t){return(Ws=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Xs(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=zs(e);if(t){var i=zs(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Js(this,n)}}function Js(e,t){return!t||"object"!==Gs(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function zs(e){return(zs=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var qs=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ws(e,t)}(A,e);var t,n,r,i=Xs(A);function A(){return js(this,A),i.apply(this,arguments)}return t=A,(n=[{key:"intersect",value:function(e){var t=this.markupsExtension.renderer.worldToClient(e);return this.link.getClientBoundingBox().containsPoint(t)}},{key:"handleMouseMove",value:function(e){if(this.markupsExtension.markupsTool.dragging||Autodesk.Viewing.isMobileDevice())return!1;var t=this.intersect(e);return this.link.setHover(t),t&&this.link.layer.setHover(!0),t}},{key:"getCursor",value:function(){return"pointer"}},{key:"handleButtonUp",value:function(e,t){return!(this.didMouseMove()||!this.intersect(e)||(this.markupsExtension.markupsManager.deselectAllLinks(),this.markupsExtension.markupsManager.selectLink(this.link),0))}}])&&Ys(t.prototype,n),r&&Ys(t,r),A}(Hs);function Zs(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var $s=function(){function e(t,n,r,i,A,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=n,this.guid=r,this.layer=i,this.type=A,this.markupsExtension=t,this.visible=!0,this.selected=!1,this.hover=!1,this.dirty=!1,o?this.state=o:(this.state=this.getDefaultState(),this.state.style=this.getDefaultStyle()),this.editState={},this.registerSelectionHandler(),this.registerAnchorHandler()}var t,n,r;return t=e,(n=[{key:"getDefaultState",value:function(){return{}}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(e){this.state=e}},{key:"getEditState",value:function(){return this.editState}},{key:"setEditState",value:function(e){this.editState=e,this.setDirty(!0)}},{key:"syncEditState",value:function(){this.setEditState(dt.cloneDeep(this.getState()))}},{key:"setDirty",value:function(e){this.dirty=e,e&&this.markupsExtension.markupsManager.dispatchEvent({type:A.LINK_DIRTY,link:this})}},{key:"isDirty",value:function(){return this.dirty}},{key:"isVisible",value:function(){return this.layer.isVisible()}},{key:"getLinkBasePosition",value:function(){var e=this.layer.getClientBoundingBox(!0),t=e.max.clone().setY(e.min.y),n=this.markupsExtension.renderer.getCameraUpVector(),r=this.markupsExtension.renderer.getCameraRightVector(),i=this.getClientBoundingBox().size(),A=n.multiplyScalar(this.markupsExtension.renderer.multiplyByNormaStrokeWidth(i.y/2)),o=r.multiplyScalar(this.markupsExtension.renderer.multiplyByNormaStrokeWidth(Re+i.x/2)),a=this.markupsExtension.renderer.getCameraEyeVector(),s=this.markupsExtension.renderer.getCameraRotation();return at.applyRotation(t,-s,e.center(),a),this.markupsExtension.renderer.clientToWorld(t).sub(A).add(o)}},{key:"getClientBoundingBox",value:function(){return this.markupsExtension.renderer.linksRenderer.getLinkBoundingBox(this)}},{key:"getPosition",value:function(){return this.editState.position?this.editState.position:this.getLinkBasePosition()}},{key:"select",value:function(){this.selected=!0,this.markupsExtension.markupsManager.dispatchEvent({type:A.LINK_SELECTED,link:this}),this.setDirty(!0)}},{key:"deselect",value:function(){this.selected=!1,this.markupsExtension.markupsManager.dispatchEvent({type:A.LINK_DESELECTED,link:this}),this.setDirty(!0)}},{key:"isSelected",value:function(){return this.selected}},{key:"setHover",value:function(e){this.hover!==e&&(this.hover=e,this.setDirty(!0))}},{key:"isHovered",value:function(){return this.hover}},{key:"isCompleted",value:function(){return!0}},{key:"registerSelectionHandler",value:function(){this.selectionHandler=new qs(this.markupsExtension,this)}},{key:"registerAnchorHandler",value:function(){this.anchorHandler=new Vs(this.markupsExtension,this)}},{key:"destroy",value:function(){this.translationHandler&&(this.translationHandler.destroy(),this.translationHandler=null),this.markupsExtension=null,this.state=null,this.editState=null}}])&&Zs(t.prototype,n),r&&Zs(t,r),e}();function eu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var tu=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.id=n,this.layerData=!r||r instanceof Fs?r:new Fs(r.guid,r.resources,r.attachments,r.status,r.metadata),this.markups={},this.links={},this.selected=!1,this.visible=!1,this.transparent=!1,this.hover=!1}var t,n,r;return t=e,(n=[{key:"addMarkup",value:function(e){this.markups[e.id]=e,e.layer=this,e.setVisible(this.visible,!0)}},{key:"deleteMarkup",value:function(e){var t=e instanceof QA?e.id:e;this.markups[t]?(e.deselect(),delete this.markups[t],e.remove(),e.layer=null,this.setDirty()):console.warn("deleteMarkup - markup does not exist")}},{key:"deleteAllMarkups",value:function(){var e=this;Ot(this.markups,(function(t){e.deleteMarkup(t)}))}},{key:"getMarkupById",value:function(e){return this.markups[e]}},{key:"isEmpty",value:function(){return 0===Object.keys(this.markups).length}},{key:"addLink",value:function(e){this.links[e.id]=e}},{key:"deleteLink",value:function(e){var t=e instanceof $s?e.id:e;this.links[t]?(this.markupsExtension.markupsManager.dispatchEvent({type:A.LINK_REMOVED,link:e}),delete this.links[t]):console.warn("deleteLink - markup does not exist")}},{key:"deleteAllLinks",value:function(){var e=this;Ot(this.links,(function(t){e.deleteLink(t)}))}},{key:"getLinkById",value:function(e){return this.links[e]}},{key:"getClientBoundingBox",value:function(e){var t=this.getWorldBoundingBox();t.min=this.markupsExtension.renderer.worldToClient(t.min),t.max=this.markupsExtension.renderer.worldToClient(t.max);var n=this.markupsExtension.renderer.getCameraEyeVector(),r=t.center(),i=this.markupsExtension.renderer.getCameraRotation();if(at.applyRotation(t.min,i,r,n),at.applyRotation(t.max,i,r,n),at.swapBoundingBoxY(t),e){var A=this.getMarginSize();t.expandByVector(new THREE.Vector3(A,A,0))}return t.min.z=0,t.max.z=0,t}},{key:"getMarginSize",value:function(){return Pe}},{key:"getWorldBoundingBox",value:function(){var e=new THREE.Box3;return Ot(this.markups,(function(t){var n=t.getWorldBoundingBox(!0);e.union(n)})),e}},{key:"getRotation",value:function(){return 0}},{key:"getAllMarkups",value:function(){return Pt(this.markups)}},{key:"getAllLinks",value:function(){return Pt(this.links)}},{key:"hasSingleMarkup",value:function(){return 1===this.getAllMarkups().length}},{key:"select",value:function(){this.selected=!0,this.markupsExtension.markupsManager.dispatchEvent({type:A.LAYER_SELECTED,layer:this}),this.setDirty()}},{key:"deselect",value:function(){this.selected=!1,this.markupsExtension.markupsManager.dispatchEvent({type:A.LAYER_DESELECTED,layer:this}),this.setDirty()}},{key:"isSelected",value:function(){return this.selected}},{key:"setHover",value:function(e){this.hover!==e&&(this.hover=e,this.getAllLinks().forEach((function(t){t.setHover(e)})),this.setDirty())}},{key:"isHovered",value:function(){return this.hover}},{key:"unhoverAllMarkups",value:function(){this.getAllMarkups().forEach((function(e){e.setHover(!1)}))}},{key:"setVisible",value:function(e){this.visible=e,Ot(this.markups,(function(t){t.setVisible(e)})),this.setDirty()}},{key:"isVisible",value:function(){return this.visible}},{key:"setDirty",value:function(){this.markupsExtension.markupsManager.dispatchEvent({type:A.LAYER_DIRTY,layer:this})}},{key:"getGuid",value:function(){return this.layerData&&this.layerData.guid}},{key:"selectAllMarkups",value:function(){this.getAllMarkups().forEach((function(e){e.select()}))}},{key:"changeTransparency",value:function(e){this.transparent=e,this.getAllMarkups().forEach((function(t){t.changeTransparency(e)}))}},{key:"isTransparent",value:function(){return this.transparent}},{key:"enable",value:function(){this.getAllMarkups().forEach((function(e){e.enable()}))}},{key:"disable",value:function(){this.getAllMarkups().forEach((function(e){e.disable()}))}}])&&eu(t.prototype,n),r&&eu(t,r),e}();function nu(e){return(nu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ru(e,t){return(ru=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function iu(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ou(e);if(t){var i=ou(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Au(this,n)}}function Au(e,t){return!t||"object"!==nu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ou(e){return(ou=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var au,su,uu,cu=(uu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ru(e,t)}(n,e);var t=iu(n);function n(e,r,i,A,o){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t.call(this,e,r,i,A,ie,o)}return n}($s),(su=ie)in(au={})?Object.defineProperty(au,su,{value:uu,enumerable:!0,configurable:!0,writable:!0}):au[su]=uu,au);function lu(e,t,n,r,i,A,o){try{var a=e[A](o),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,i)}function hu(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var A=e.apply(t,n);function o(e){lu(A,r,i,o,a,"next",e)}function a(e){lu(A,r,i,o,a,"throw",e)}o(void 0)}))}}var du=function(e,t){e&&t&&("eye"in e&&(e.eye[0]=(Number(e.eye[0])+t.x).toString(),e.eye[1]=(Number(e.eye[1])+t.y).toString(),e.eye[2]=(Number(e.eye[2])+t.z).toString()),"target"in e&&(e.target[0]=(Number(e.target[0])+t.x).toString(),e.target[1]=(Number(e.target[1])+t.y).toString(),e.target[2]=(Number(e.target[2])+t.z).toString()),"pivotPoint"in e&&(e.pivotPoint[0]=(Number(e.pivotPoint[0])+t.x).toString(),e.pivotPoint[1]=(Number(e.pivotPoint[1])+t.y).toString(),e.pivotPoint[2]=(Number(e.pivotPoint[2])+t.z).toString()))},pu=function(e,t){var n=e.model,r=n?n.getData().globalOffset:null,i=t.metadata.markup_metadata;if(r){var A=JSON.parse(JSON.stringify(i)),o=A.viewport,a={x:-r.x,y:-r.y,z:-r.z};return du(o,a),A}return i},fu=function(){var e=hu(regeneratorRuntime.mark((function e(t,n,r){var i,A,o=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.length>3&&void 0!==o[3]?o[3]:function(){},n){e.next=4;break}return i(!1),e.abrupt("return");case 4:return A=pu(t,n),t.restoreState(A,null,r),function(){var e=hu(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=3;break}return e.next=3,Autodesk.Viewing.EventUtils.waitUntilTransitionEnded(t);case 3:n=t.navigation.getCamera(),t.navigation.updateCamera(),n.updateMatrixWorld(),t.impl.sceneUpdated(!0),i(!0);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),e.next=10,Autodesk.Viewing.EventUtils.waitUntilGeometryLoaded(t);case 10:t.impl.sceneUpdated(!0);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),yu=function(e,t,n,r){var i=t.model.isPdf(!0);if(t.model.isLeaflet()||i){var A,o;if(i)A=Autodesk.Viewing.PDFUtils.getLeafletLoadOptions(t),o=Autodesk.Viewing.PDFUtils.getLeafletBoundingBox(t);else{var a=t.model.getData();A=a.loadOptions.loadOptions,o=a.bbox}var s=A,u=s.texWidth,c=s.texHeight,l=u/(r.metadata.markup_metadata&&r.metadata.markup_metadata.originalDocumentResolution&&r.metadata.markup_metadata.originalDocumentResolution[0]||u),h=e.x/(u/l)*o.size().x,d=e.y/(c/l)*o.size().y,p=new THREE.Vector3(h,d,0),f=new THREE.Vector3(o.min.x,o.max.y,0);return p.add(f),i&&Autodesk.Viewing.PDFUtils.leafletToPdfWorld(t,p),p}if(n.documentCamera.isPerspective){var y=t.impl.getCanvasBoundingClientRect();e.x=e.x/Oe*(.5*y.height)+.5*y.width,e.y=-e.y/Oe*(.5*y.height)+.5*y.height,e=n.clientToWorld(e)}else{e.applyMatrix4(n.documentCamera.matrixWorld),e.sub(n.documentCamera.position);var g=t.model&&t.model.getData().globalOffset;g&&e.sub(g),e=n.documentCameraToMarkupsCamera(e)}return e},gu=function(e,t,n,r){var i=yu(new THREE.Vector3,t,n,r),A=yu(new THREE.Vector3(e,0,0),t,n,r);return i.distanceTo(A)},Eu=function(e,t,n,r,i){var A=e.childNodes[0].childNodes[0],o=function(e){return A.getAttribute(e)||A.getAttribute(e.toLowerCase())},s=o("type")||"",u=i<5,l=n.model.isLeaflet(),h=n.model.isPdf(!0),d={style:{},anchors:[]},p={type:s,state:d},f=function(){for(var e=[],t=o("locations"),n=t&&t.split(" ")||"",r=0;r<n.length;r+=2){var i=new THREE.Vector3(parseFloat(n[r]),parseFloat(n[r+1]),0);e.push(i)}return e},y=function(e){var t=new THREE.Vector3,n=o(e);if(n){var r=n.split(" ");t.x=r[0]&&parseFloat(r[0])||0,t.y=r[1]&&parseFloat(r[1])||0,t.z=r[2]&&parseFloat(r[2])||0}return t},Q=function(){return o("text")||""},L=o("groupId");L&&(d.groupId=L,d.groupOrder=parseFloat(o("groupOrder")));var F,R,H,_=o("uuid");switch(_&&(d.uuid=_),d.style=function(e){for(var t=Pt(c),n={},r=0;r<t.length;r++){var i=e.getAttribute(t[r]);if(i)switch(t[r]){case c.THICKNESS:n[t[r]]=parseFloat(i);break;case c.FONT_SIZE:case c.OPACITY:case c.FILL_OPACITY:n[t[r]]=parseFloat(i);break;case c.STROKE_LINEJOIN:break;case c.FONT_FAMILY:case c.FONT_STYLE:case c.FONT_WEIGHT:case c.COLOR:case c.FONT_COLOR:case c.FILL_COLOR:n[t[r]]=i}}return n[c.FONT_COLOR]||(n[c.FONT_COLOR]=n[c.COLOR]),n[c.FILL_COLOR]||(n[c.FILL_COLOR]=a.NO_COLOR),n[c.FILL_COLOR]===a.NO_COLOR&&(n[c.FILL_OPACITY]=he),n}(A),d.position=y("position"),d.rotation=(F=o("rotation"))&&parseFloat(F)||0,d.size=y("size"),n.impl.is2d||fu(n,t,!0),s){case E:case B:case m:d.anchors[0]=new THREE.Vector3(-d.size.x/2,-d.size.y/2,0),d.anchors[1]=new THREE.Vector3(d.size.x/2,-d.size.y/2,0),d.anchors[2]=new THREE.Vector3(d.size.x/2,d.size.y/2,0),d.anchors[3]=new THREE.Vector3(-d.size.x/2,d.size.y/2,0),u&&s!==B&&(H=d.style[c.THICKNESS]/2,d.anchors[0].add(new THREE.Vector3(H,H,0)),d.anchors[1].add(new THREE.Vector3(-H,H,0)),d.anchors[2].add(new THREE.Vector3(-H,-H,0)),d.anchors[3].add(new THREE.Vector3(H,-H,0)));break;case g:case U:d.anchors[0]=y("tail"),d.anchors[1]=y("head"),u&&(d.rotation=0);break;case b:case S:d.text=Q(),d.isFrameUsed=!!parseInt(o("isFrameUsed"),10),d.frameType=o("frameType")||E,u&&(d.isFrameUsed||(d.style[c.FILL_OPACITY]=0)),d.anchors[0]=new THREE.Vector3(-d.size.x/2,-d.size.y/2,0),d.anchors[1]=new THREE.Vector3(d.size.x/2,-d.size.y/2,0),d.anchors[2]=new THREE.Vector3(d.size.x/2,d.size.y/2,0),d.anchors[3]=new THREE.Vector3(-d.size.x/2,d.size.y/2,0);break;case T:case M:break;case w:case v:d.anchors=f();break;case C:case k:d.anchors=f(),d.closed=function(){var t=e.childNodes[1]||"",n=!1;if("string"!=typeof t){var r=t.getAttribute("d").split(" ");"z"===r[r.length-1].toLowerCase()&&(n=!0)}return n}();break;case x:d.anchors[0]=y("firstAnchor"),d.anchors[1]=y("secondAnchor"),R=y("offset"),d.position.sub(R),d.translation=yu(R,n,r,t).sub(yu(new THREE.Vector3,n,r,t)),d.text=Q(),u&&(d.style[c.THICKNESS]/=2),d.style[c.FONT_SIZE]/=je,d.style[c.THICKNESS]/=Ge}return(u||l||h)&&function(){if(d.style.hasOwnProperty(c.FONT_SIZE)){var e=r.getFontToWorldScale();d.style[c.FONT_SIZE]/=e}}(),Kt(d.anchors,d.position),(u&&n.model.is3d()||l||h)&&(d.anchors.forEach((function(e){e.copy(yu(e,n,r,t))})),d.style[c.THICKNESS]=gu(d.style[c.THICKNESS],n,r,t),d.style[c.FONT_SIZE]=gu(d.style[c.FONT_SIZE],n,r,t)),p},mu=function(e,t,n,r){try{return JSON.parse(e)}catch(l){for(var i=function(e){var t;try{t=(new DOMParser).parseFromString(e,"text/xml").firstChild}catch(e){console.warn("stringToSvgNode failed to generate an HTMLElement from its string representation.")}return t}(e).childNodes,A=[],o=function(e){var t=e.getAttribute("data-model-version");return"string"==typeof t?parseFloat(t):0}(i[0].childNodes[0]),a=n.impl.is2d?null:n.getState(),s=0;s<i.length;s++){var u=i[s];if(u.childNodes[0].childNodes[0]){var c=Eu(u,t,n,r,o);A.push(c)}}return a&&n.restoreState(a,null,!0),A}};function Bu(e){return(Bu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vu(e){return function(e){if(Array.isArray(e))return wu(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return wu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wu(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ku(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Cu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bu(e,t){return(bu=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Su(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Mu(e);if(t){var i=Mu(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Tu(this,n)}}function Tu(e,t){return!t||"object"!==Bu(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Mu(e){return(Mu=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&bu(e,t)}(o,Autodesk.Viewing.EventDispatcher);var t,n,r,i=Su(o);function o(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).markupsExtension=e,t.actionManager=new or,t.registerEvents(),t.reset(),t}return t=o,(n=[{key:"registerEvents",value:function(){this.onHistoryChangedBinded=this.onHistoryChanged.bind(this),this.actionManager.addEventListener(or.HISTORY_CHANGED_EVENT,this.onHistoryChangedBinded),this.onAllMarkupsLoadedBinded=this.onAllMarkupsLoaded.bind(this),this.addEventListener(A.ALL_MARKUPS_LOADED,this.onAllMarkupsLoadedBinded),this.onMarkupLayerFetchedBinded=this.onMarkupLayerFetched.bind(this),this.addEventListener(A.LAYER_FETCHED,this.onMarkupLayerFetchedBinded),this.onMarkupResourceFetchedBinded=this.onMarkupResourceFetched.bind(this),this.addEventListener(A.LAYER_RESOURCE_FETCHED,this.onMarkupResourceFetchedBinded),this.onMarkupLinkSyncedBinded=this.onMarkupLinkSynced.bind(this),this.addEventListener(A.LINK_SYNCED,this.onMarkupLinkSyncedBinded),this.onLayerSyncedBinded=this.onLayerSynced.bind(this),this.addEventListener(A.LAYER_SYNCED,this.onLayerSyncedBinded),this.onLayerSyncingBinded=this.onLayerSyncing.bind(this),this.addEventListener(A.LAYER_SYNCING,this.onLayerSyncingBinded),this.onLayerSelectedBinded=this.onLayerSelected.bind(this),this.addEventListener(A.LAYER_SELECTED,this.onLayerSelectedBinded),this.onLayerDeselectedBinded=this.onLayerDeselected.bind(this),this.addEventListener(A.LAYER_DESELECTED,this.onLayerDeselectedBinded),this.onCalibrationEndedBinded=this.onCalibrationEnded.bind(this),this.markupsExtension.viewer.addEventListener(Autodesk.Viewing.MeasureCommon.Events.FINISHED_CALIBRATION_FOR_DIMENSION_EVENT,this.onCalibrationEndedBinded),this.onDrawingStartBinded=this.onDrawingStart.bind(this),this.addEventListener(A.MARKUP_DRAWING_START,this.onDrawingStartBinded),this.onDrawingEndBinded=this.onDrawingEnd.bind(this),this.addEventListener(A.MARKUP_DRAWING_END,this.onDrawingEndBinded),this.addEventListener(A.MARKUP_DRAWING_CANCEL,this.onDrawingEndBinded)}},{key:"unregisterEvents",value:function(){this.actionManager.removeEventListener(or.HISTORY_CHANGED_EVENT,this.onHistoryChangedBinded),this.removeEventListener(A.ALL_MARKUPS_LOADED,this.onAllMarkupsLoadedBinded),this.removeEventListener(A.LAYER_FETCHED,this.onMarkupLayerFetchedBinded),this.removeEventListener(A.LAYER_RESOURCE_FETCHED,this.onMarkupResourceFetchedBinded),this.removeEventListener(A.LINK_SYNCED,this.onMarkupLinkSyncedBinded),this.removeEventListener(A.LAYER_SYNCED,this.onLayerSyncedBinded),this.removeEventListener(A.LAYER_SYNCING,this.onLayerSyncingBinded),this.markupsExtension.viewer.removeEventListener(Autodesk.Viewing.MeasureCommon.Events.FINISHED_CALIBRATION_FOR_DIMENSION_EVENT,this.onCalibrationEndedBinded),this.removeEventListener(A.MARKUP_DRAWING_START,this.onDrawingStartBinded),this.removeEventListener(A.MARKUP_DRAWING_END,this.onDrawingEndBinded),this.removeEventListener(A.MARKUP_DRAWING_CANCEL,this.onDrawingEndBinded)}},{key:"createLayer",value:function(e){var t=new tu(this.markupsExtension,this.nextLayerId,e);return this.layers[t.id]=t,this.nextLayerId+=1,this.dispatchEvent({type:A.LAYER_CREATED}),t}},{key:"loadLayers",value:function(e,t,n){var r=this;n&&(this.removeAllLayers([this.getActiveLayer()]),this.markupsExtension.markupsCache&&this.markupsExtension.markupsCache.cleanCache()),(e=e instanceof Array?e:[e]).forEach((function(e){r.markupsExtension.markupsCache&&e.guid&&!r.markupsExtension.markupsCache.get(e.guid)&&r.markupsExtension.markupsCache.add(e.guid,e)}));var i=t?e:this.markupsExtension.filterManager.filterLayers(e);this.getLayersAsList().forEach((function(e){e!==r.getActiveLayer()&&-1===i.findIndex((function(t){return t.guid===e.getGuid()}))&&r.removeLayer(e)})),i.forEach((function(e){if(!r.getLayerByGuid(e.guid)){var t=r.createLayer(e);r.markupsExtension.viewer.impl.is2d&&(t.setVisible(!0),r.loadMarkupsToLayer(t)),r.loadLinksToLayer(t)}}))}},{key:"removeLayer",value:function(e){var t=e.id,n=this.layers[t];n?(this.isMarkupSessionOpen()&&n===this.getActiveLayer()?this.endMarkupSession(!1):this.markupsExtension.viewer.model&&this.markupsExtension.viewer.model.is3d()&&this.isInMarkupView()&&this.getVisibleLayers()[0]===n&&this.exitMarkupView(),this.deselectLayer(e),e.deleteAllMarkups(),e.deleteAllLinks(),e.setVisible(!1),this.dispatchEvent({type:A.LAYER_DELETED,layer:e}),delete this.layers[t]):console.warn("deleteLayer - layer does not exist")}},{key:"removeAllLayers",value:function(e){var t=this;this.getLayersAsList().forEach((function(n){e&&-1!==e.indexOf(n)||t.removeLayer(n)}))}},{key:"deleteLayer",value:function(e){this.dispatchEvent({type:A.LAYER_DELETE,layerData:e.layerData})}},{key:"getLayerById",value:function(e){return this.layers[e]}},{key:"getLayerByGuid",value:function(e){return null==e?null:this.getLayersAsList().find((function(t){return t.getGuid()===e}))}},{key:"addMarkupToLayer",value:function(e,t){return this.getLayerById(t.id)||(this.layers[t.id]=t),this.getSelectedLayers().length>0&&!t.isSelected()&&e.changeTransparency(!0),(this.isMarkupSessionOpen()&&t!==this.getActiveLayer()||!this.isToolEnabled())&&e.disable(),t.addMarkup(e),!0}},{key:"addLinkToLayer",value:function(e,t){return this.getLayerById(t.id)||(this.layers[t.id]=t),t.addLink(e),!0}},{key:"createMarkup",value:function(e,t,n){var r=bs[e];return r?new r(this.markupsExtension,this.nextMarkupId++,t,n):null}},{key:"createLink",value:function(e,t){var n=t.position?(new THREE.Vector3).copy(t.position):null;n&&this.markupsExtension.viewer.model.isPdf(!0)&&Autodesk.Viewing.PDFUtils.leafletToPdfWorld(this.markupsExtension.viewer,n);var r=new cu[t.type](this.markupsExtension,this.nextLinkId,t.id,e,{position:n});return this.nextLinkId+=1,r}},{key:"onAllMarkupsLoaded",value:function(e){var t=e.amount;console.log("All markups have been loaded. Amount: "+t)}},{key:"onMarkupLayerFetched",value:function(e){var t=this,n=e.layerData;this.markupsExtension.filterManager.filterLayers([n]).forEach((function(e){var n=t.createLayer(e);t.markupsExtension.viewer.impl.is2d&&n.setVisible(!0)}))}},{key:"onMarkupResourceFetched",value:function(e){var t=e.layerData;if(this.markupsExtension.viewer.impl.is2d){var n=this.getLayerByGuid(t.guid);n&&this.loadMarkupsToLayer(n)}}},{key:"onMarkupLinkSynced",value:function(e){var t=e.documentAttachment,n=e.layerData,r=this.getLayerByGuid(n.guid);r&&(t&&t.status===q&&0===n.attachments.length&&r.deleteAllLinks(),this.loadLinksToLayer(r))}},{key:"onDrawingStart",value:function(){var e=this.getDuringCreationMarkup(!1);this.polySaveDisabled=e&&e.inEdit&&(e.type===k||e.type===C),this.dispatchEvent({type:A.LAYER_READY_TO_SAVE,readyToSave:this.getReadyToSave()})}},{key:"onDrawingEnd",value:function(){this.polySaveDisabled=!1,this.dispatchEvent({type:A.LAYER_READY_TO_SAVE,readyToSave:this.getReadyToSave()})}},{key:"getReadyToSave",value:function(){var e,t,n=this.getActiveLayer();n&&((e=n.isEmpty())||(t=n.getAllMarkups().some((function(e){return e.isTextMarkup()&&e.textInputHandler.isEmpty()}))));var r=this.markupsExtension.options.isMobileApp?!e:!e||e&&this.markupsExtension.permissionManager.canDeleteMarkup(n.layerData);return!(!n||!r||this.polySaveDisabled||t)}},{key:"removeMarkupFromLayer",value:function(e){var t=e.layer;return t?(this.duringCreationMarkup=null,e.deselect(),e.disableEdit(),t.deleteMarkup(e),!0):(console.warn("removeMarkupFromLayer - markup does not exist"),!1)}},{key:"getMarkupById",value:function(e){var t=null;return Ot(this.layers,(function(n){var r=n.getMarkupById(e);r&&(t=r)})),t}},{key:"getSelectedMarkups",value:function(){return this.getMarkupsByProperty("selected",!0)}},{key:"getUnselectedMarkups",value:function(){return this.getMarkupsByProperty("selected",!1)}},{key:"getSelectedLayers",value:function(){return this.getLayersByProperty("selected",!0)}},{key:"getUnselectedLayers",value:function(){return this.getLayersByProperty("selected",!1)}},{key:"getSelectedLayer",value:function(){return this.getSelectedLayers()[0]}},{key:"getVisibleLayers",value:function(){return this.getLayersByProperty("visible",!0)}},{key:"getVisibleMarkups",value:function(){return this.getMarkupsByProperty("visible",!0)}},{key:"getEnabledMarkups",value:function(){return this.getMarkupsByProperty("enabled",!0).filter((function(e){return!e.layer||e.layer.isVisible()}))}},{key:"getDisabledMarkups",value:function(){return this.getMarkupsByProperty("enabled",!1)}},{key:"getVisibleLinks",value:function(){var e=this.getVisibleLayers(),t=[];return e.forEach((function(e){e.getAllLinks().forEach((function(e){t.push(e)}))})),t}},{key:"getDirtyLinks",value:function(){return this.getLinksByProperty("dirty",!0)}},{key:"getSelectedLinks",value:function(){return this.getLinksByProperty("selected",!0)}},{key:"getInEditMarkups",value:function(){var e=this.getMarkupsByProperty("inEdit",!0);return this.duringCreationMarkup&&-1===e.indexOf(this.duringCreationMarkup)&&e.push(this.duringCreationMarkup),e}},{key:"getMarkupsByProperty",value:function(e,t){var n=[];return Ot(this.layers,(function(r){Ot(r.markups,(function(r){r[e]===t&&n.push(r)}))})),n}},{key:"getLayersByProperty",value:function(e,t){var n=[];return Ot(this.layers,(function(r){r[e]===t&&n.push(r)})),n}},{key:"getLinksByProperty",value:function(e,t){var n=[];return Ot(this.layers,(function(r){Ot(r.links,(function(r){r[e]===t&&n.push(r)}))})),n}},{key:"selectMarkup",value:function(e){(e=e instanceof QA?e:this.getMarkupById(e))?e.select():console.warn("selectMarkup - markup does not exist")}},{key:"deselectMarkup",value:function(e){(e=e instanceof QA?e:this.getMarkupById(e))?e.deselect():console.warn("selectMarkup - markup does not exist")}},{key:"deselectAllMarkups",value:function(e){this.getSelectedMarkups().forEach((function(t){e&&-1!==e.indexOf(t)||!t.isSelected()||t.deselect()}))}},{key:"unhoverAllLayers",value:function(){this.getLayersAsList().forEach((function(e){e.setHover(!1)}))}},{key:"unhoverAllMarkups",value:function(){this.getAllMarkups().forEach((function(e){e.setHover(!1)}))}},{key:"enableAllMarkups",value:function(){this.getAllMarkups().forEach((function(e){e.enable()}))}},{key:"disableAllMarkups",value:function(){this.getAllMarkups().forEach((function(e){e.disable()}))}},{key:"lockNavigation",value:function(){this.lockSettings||(this.lockSettings=this.markupsExtension.viewer.getNavigationLockSettings(),this.markupsExtension.viewer.setNavigationLockSettings({orbit:!1,pan:!1,zoom:!1,roll:!1,fov:!1,gotoview:!1,walk:!1}),this.markupsExtension.viewer.navigation.setIsLocked(!0)),this.dispatchEvent({type:A.MARKUP_VIEW_ENTERED})}},{key:"unlockNavigation",value:function(){this.lockSettings&&(this.markupsExtension.viewer.setNavigationLockSettings(this.lockSettings),this.markupsExtension.viewer.setNavigationLock(!1),this.markupsExtension.viewer.toolController.setIsLocked(!1),this.lockSettings=null)}},{key:"loadLayerIfHidden",value:function(e){var t=e instanceof tu?e:this.getLayerByGuid(e);if(!t&&this.markupsExtension.markupsCache){var n=this.markupsExtension.markupsCache.get(e);if(n){var r=n.metadata.markup_metadata.sheetName;$t(this.markupsExtension.options.sheetName,r)||(n=null)}n&&(this.loadLayers([n],!0),t=this.getLayerByGuid(e))}return t}},{key:"selectLayer",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},o=this.loadLayerIfHidden(e),a=i.bind(this);if(o){var s=o.isSelected();if(this.deselectAllLayers([o]),this.exitMarkupView([o]),this.markupsExtension.viewer.impl.is2d){if(o.select(),t){var u={horizontal:this.markupsExtension.viewer.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN,vertical:this.markupsExtension.viewer.navigation.FIT_TO_VIEW_VERTICAL_MARGIN};this.markupsExtension.viewer.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN=_e,this.markupsExtension.viewer.navigation.FIT_TO_VIEW_VERTICAL_MARGIN=_e;var c=o.getWorldBoundingBox();this.markupsExtension.viewer.navigation.fitBounds(n,c),this.markupsExtension.viewer.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN=u.horizontal,this.markupsExtension.viewer.navigation.FIT_TO_VIEW_VERTICAL_MARGIN=u.vertical}a()}else this.loadMarkupsToLayer(o),o.select(),this.navigationToolBackup=this.markupsExtension.viewer.getActiveNavigationTool(),this.markupsExtension.viewer.setActiveNavigationTool(this.markupsExtension.markupsTool.getName()),fu(this.markupsExtension.viewer,o.layerData,n||s,(function(){o.isSelected()&&(o.setVisible(!0),r.lockNavigation()),a()}))}else{this.dispatchEvent({type:A.LAYER_SELECTED_FROM_DIFFERENT_SHEET,layerGuid:e});var l=this.markupsExtension.cache;l.layerToSelect=this.loadRelevantSheet(e)}}},{key:"deselectLayer",value:function(e){(e=e instanceof tu?e:this.getLayerByGuid(e))?e.isSelected()&&(e.deselect(),e.layerData&&0===this.markupsExtension.filterManager.filterLayers([e.layerData]).length&&this.removeLayer(e)):console.warn("deselectLayer - layer does not exist")}},{key:"deselectAllLayers",value:function(e){var t=this;this.getSelectedLayers().forEach((function(n){e&&-1!==e.indexOf(n)||!n.isSelected()||t.deselectLayer(n)}))}},{key:"loadRelevantSheet",value:function(e){var t=this,n=this.markupsExtension.markupsCache.get(e);return n?this.markupsExtension.options.hasMultiSheet?function(){var r=n.metadata.markup_metadata.sheetName;if(r&&!$t(t.sheetName,r))return function(n,r){for(var i=0;i<t.markupsExtension.sheetList.length;i++){var A=t.markupsExtension.sheetList[i].search(ku({},n,r))[0];if(A)return t.markupsExtension.options.loadDocumentCallback?t.markupsExtension.options.loadDocumentCallback(A):t.markupsExtension.viewer.loadDocumentNode(t.markupsExtension.viewer.model.getDocumentNode().getDocument(),A,{loadAsHidden:!1,applyRefPoint:!1,keepCurrentModels:!1}),e}return console.warn("loadRelevantSheet - Sheet not found (by ".concat(n,")")),null}("name",r)}():void console.warn("loadRelevantSheet - Something weird just happened. This method shouldnt be called on Plans folder."):(console.warn("loadRelevantSheet - Cant find selected layer."),null)}},{key:"isInMarkupView",value:function(){var e=this.getVisibleLayers();return!this.isMarkupSessionOpen()&&e.length>0}},{key:"exitMarkupView",value:function(e){var t=this;if(!this.markupsExtension.viewer.impl.is2d&&this.isInMarkupView()){var n=this.getVisibleLayers();if(e&&(n=n.filter((function(t){return-1===e.indexOf(t)}))),0!==n.length){n.forEach((function(e){t.deselectLayer(e),e.setVisible(!1)})),this.unlockNavigation(),this.markupsExtension.viewer.setActiveNavigationTool(this.navigationToolBackup);var r=this.markupsExtension.viewer.getExtension("Autodesk.Section");r&&1===r.getSectionPlanes().length?r.setSectionFromPlane(null):this.markupsExtension.viewer.impl.setCutPlaneSet("__set_view",void 0),this.dispatchEvent({type:A.MARKUP_VIEW_EXITED})}}}},{key:"changeAllLayersTransparency",value:function(e,t){this.markupsExtension.isToolEnabled()&&this.getLayersAsList().forEach((function(n){t&&-1!==t.indexOf(n)||n.changeTransparency(e)}))}},{key:"onLayerSynced",value:function(e){var t=e.layerData,n=e.layer;if(n=n||this.getLayerByGuid(t.guid)){if(!this.isMarkupSessionOpen()){n.enable();var r=this.getSelectedLayer();(r&&r!==n||!this.markupsExtension.isToolEnabled())&&n.changeTransparency(!0)}0===this.markupsExtension.filterManager.filterLayers([t]).length&&this.removeLayer(n)}this.markupsExtension.options.onMarkupsSyncCallback&&this.markupsExtension.options.onMarkupsSyncCallback({count:this.markupsExtension.markupsCache.length()})}},{key:"onLayerSyncing",value:function(e){var t=e.layerData,n=e.layer;(n=n||this.getLayerByGuid(t.guid))&&(this.markupsExtension.viewer.impl.is2d&&n.deselect(),n.disable())}},{key:"selectLink",value:function(e){e?e.select():console.warn("selectLink - link does not exist")}},{key:"deselectLink",value:function(e){e?e.deselect():console.warn("deselectLink - link does not exist")}},{key:"deselectAllLinks",value:function(){var e=this;this.getSelectedLinks().forEach((function(t){e.deselectLink(t)}))}},{key:"getDuringCreationMarkup",value:function(e){if(!this.duringCreationMarkup&&e){var t=this.getMarkupCreationType(),n=this.createMarkup(t);n&&(n.setVisible(!0),n.enableEdit(),this.duringCreationMarkup=n)}return this.duringCreationMarkup}},{key:"getActiveLayer",value:function(){return this.activeLayer}},{key:"setActiveLayer",value:function(e){e=e instanceof tu?e:this.getLayerById(e),this.activeLayer=e}},{key:"isMarkupSessionOpen",value:function(){return this.sessionOpen}},{key:"changeMarkupCreationType",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ae;Zt(this.markupsExtension.viewer,(function(){var n=e.getDuringCreationMarkup(!1);n&&n.creationHandler.onEscape(),e.markupCreationType=t,e.markupsExtension.viewer.setActiveNavigationTool(t?e.markupsExtension.markupsTool.getName():e.navigationToolBackup),e.dispatchEvent({type:A.MARKUP_CREATION_TYPE_CHANGED,creationType:t}),t&&!e.isMarkupSessionOpen()&&t!==Q&&e.startMarkupSession()}))}},{key:"getMarkupCreationType",value:function(){return this.markupCreationType}},{key:"setToolEnabled",value:function(e){var t=this;this.toolEnabled=e,e?this.enableAllMarkups():(this.deselectAllLayers(),this.deselectAllLinks(),this.disableAllMarkups()),(Autodesk.Viewing.isSafari()||Autodesk.Viewing.isIE11)&&setTimeout((function(){t.markupsExtension.markupsUI&&t.markupsExtension.markupsUI.toolbar.renderToolbar()}),1),this.dispatchEvent({type:A.MARKUP_TOOL_ENABLED_CHANGED,enable:e})}},{key:"isToolEnabled",value:function(){return this.toolEnabled}},{key:"startMarkupSession",value:function(e,t){return!!this.isToolEnabled()&&(this.deselectAllLayers(t&&[t]),this.exitMarkupView([t]),this.deselectAllLinks(),this.sessionOpen=!0,this.markupsExtension.markupsTool.updateToolPriority(),(t=t||this.createLayer()).setVisible(!0),this.setActiveLayer(t),this.navigationToolBackup=this.markupsExtension.viewer.getActiveNavigationTool(),this.markupsExtension.viewer.setActiveNavigationTool(this.markupsExtension.markupsTool.getName()),this.markupsExtension.viewer.impl.is2d||this.lockNavigation(),!e&&this.getMarkupCreationType()||this.changeMarkupCreationType(e),this.getAllMarkups().forEach((function(e){e.layer!==t&&e.disable()})),this.creationStatusType=this.markupsExtension.options.defaultMarkupStatus||P,this.contextMenu=this.markupsExtension.viewer.contextMenu,this.markupsExtension.viewer.setContextMenu(null),this.markupsExtension.viewer.impl.pauseHighlight(!0),this.markupsExtension.viewer.impl.disableSelection(!0),n=this.markupsExtension.viewer,(r=n.toolController.getTool("gestures"))&&(r.setGestureParameter("singletap","time",250),r.setGestureParameter("drag","threshold",0)),this.dispatchEvent({type:A.MARKUP_SESSION_START,layer:t}),!0);var n,r}},{key:"endMarkupSession",value:function(e){var t=this;if(this.isMarkupSessionOpen()){var n=this.getActiveLayer(),r=!1;if(e&&n.isEmpty()){if(n.layerData)return void this.dispatchEvent({type:A.LAYER_DELETE_EMPTY_PRESSED,onConfirmCB:function(){return t.deleteLayer(n)}});r=!0,e=!1}if(this.sessionOpen=!1,e||this.exitMarkupView(),this.markupsExtension.markupsTool&&this.markupsExtension.markupsTool.updateToolPriority(),this.changeMarkupCreationType(null),this.setActiveLayer(null),this.duringCreationMarkup&&this.duringCreationMarkup.creationHandler.creationCancel(),this.deselectAllMarkups(),this.enableAllMarkups(),this.unhoverAllMarkups(),!e)for(;!this.actionManager.isUndoStackEmpty();)this.undo();this.actionManager.clear();var i,o,a=n.isEmpty()||!e&&!n.getGuid();r?this.deleteLayer(n):a&&this.removeLayer(n),n.deselect(),this.markupsExtension.viewer.setContextMenu(this.contextMenu),this.markupsExtension.viewer.impl.pauseHighlight(!1),this.markupsExtension.viewer.impl.disableSelection(!1),i=this.markupsExtension.viewer,(o=i.toolController.getTool("gestures"))&&(o.restoreGestureParameterDefault("singletap","time"),o.restoreGestureParameterDefault("drag","threshold")),this.dispatchEvent({type:A.MARKUP_SESSION_END,layer:n,save:e})}}},{key:"editLayer",value:function(e,t,n,r){var i=this;if(this.isToolEnabled()){var o=this.loadLayerIfHidden(e);o?this.markupsExtension.permissionManager.canEditMarkup(o.layerData)?this.selectLayer(o,t,r,(function(){i.startMarkupSession(Ae,o),n&&(Autodesk.Viewing.isMobileDevice()||o.selectAllMarkups())})):console.warn("editLayer - Cant edit layer, permissions not valid."):(this.dispatchEvent({type:A.LAYER_EDITED_FROM_DIFFERENT_SHEET,layerGuid:e}),this.markupsExtension.cache.layerToEdit=this.loadRelevantSheet(e))}}},{key:"onLayerSelected",value:function(e){var t=e.layer;this.changeAllLayersTransparency(!0,[t])}},{key:"onLayerDeselected",value:function(){this.getSelectedLayer()||this.changeAllLayersTransparency(!1)}},{key:"deleteMarkup",value:function(e){(e=e instanceof QA?e:this.getMarkupById(e))?e.creationHandler.deleteMarkup():console.warn("deleteMarkup - markup does not exist")}},{key:"deleteInEditMarkups",value:function(){var e=this;this.markupsToDelete=this.getInEditMarkups(),this.openActionGroup(),this.markupsToDelete.forEach((function(t){e.deleteMarkup(t)})),this.closeActionGroup()}},{key:"undo",value:function(){this.duringCreationMarkup?this.duringCreationMarkup.creationHandler.onEscape(!1):this.actionManager.undo()}},{key:"redo",value:function(){this.actionManager.redo()}},{key:"isActionGroupOpen",value:function(){return this.actionManager.isGroupOpen}},{key:"openActionGroup",value:function(){this.actionManager.openActionGroup()}},{key:"closeActionGroup",value:function(){this.actionManager.closeActionGroup()}},{key:"copy",value:function(){this.markupsToCopy=this.getSelectedMarkups(),this.pasteOffset=1}},{key:"paste",value:function(){var e=this;this.deselectAllMarkups(),this.openActionGroup(),this.markupsToCopy.forEach((function(t){e.duplicateMarkup(t)})),this.closeActionGroup(),this.pasteOffset+=1}},{key:"cut",value:function(){this.copy(),this.deleteInEditMarkups()}},{key:"duplicateMarkup",value:function(e){var t=this,n=function(){var e=t.markupsExtension.renderer.getCameraRightVector(),n=t.markupsExtension.renderer.getCameraUpVector(),r=t.markupsExtension.renderer.multiplyByNormaStrokeWidth(Qe*t.pasteOffset);return e.sub(n).normalize().multiplyScalar(r)},r=function(e){e.completed=!0;var n=t.activeLayer?t.activeLayer:t.createLayer();new wt(t,e,n).execute()};if(e.translationHandler&&!e.belongsToGroup()){var i=dt.cloneDeep(e.getState()),A=n();i.translation.add(A);var o=this.createMarkup(e.type,i);r(o),o.select()}else if(e.isGroupMarkup()){var a=dt.cloneDeep(e.getState()),s=n();a.uuid=THREE.Math.generateUUID(),a.componentsState=e.markups.map((function(e){var t=dt.cloneDeep(e.getState());return t.translation.add(s),t}));var u=this.createMarkup(e.type,a);r(u),u.markups.forEach((function(e){return r(e)})),u.select()}}},{key:"loadMarkupsToLayer",value:function(e){var t=this,n=e.layerData&&e.layerData.getSvgResource();if(n&&e.isEmpty()){var r=function(n){n.completed=!0,t.addMarkupToLayer(n,e),n.setDirty()},i=mu(n,e.layerData,this.markupsExtension.viewer,this.markupsExtension.renderer);i.forEach((function(e){if(!e.state.groupId){e.state.uuid&&(e.state.componentsState=i.filter((function(t){return e.state.uuid===t.state.groupId})).map((function(e){return e.state})));var n=t.createMarkup(e.type,e.state);n&&(r(n),n.isGroupMarkup()&&n.markups.forEach((function(e){return r(e)})))}}))}}},{key:"createLinkMetadata",value:function(e){var t=e.metadata;t.markup_metadata=t.markup_metadata||{},t.markup_metadata.links=t.markup_metadata.links||[],e.attachments.forEach((function(e){t.markup_metadata.links.some((function(t){return t.id===e.attributes.issue_id&&t.type===e.attributes.attachment_type}))||t.markup_metadata.links.push({id:e.attributes.issue_id,type:e.attributes.attachment_type,position:null})}))}},{key:"loadLinksToLayer",value:function(e){var t=this;this.createLinkMetadata(e.layerData);var n=e.layerData.getLinksMetadata();n&&n.forEach((function(n){if(!e.getAllLinks().find((function(e){return e.guid===n.id}))&&e.layerData.attachments.some((function(e){return e.attributes.issue_id===n.id}))){var r=t.createLink(e,n);t.addLinkToLayer(r,e),r.setDirty(!0)}}))}},{key:"changeStyleProperty",value:function(e,t,n){"string"==typeof t&&(t=a[t.toUpperCase()]||t),e===c.THICKNESS&&(t*=this.markupsExtension.renderer.getNormaStrokeWidth()),this.creationStyleProperties[e]=t,e===c.COLOR&&t!==a.NO_COLOR&&(this.creationStyleProperties[c.LAST_COLOR]=t),this.isMarkupSessionOpen()&&(this.openActionGroup(),this.getSelectedMarkups().forEach((function(r){r.creationHandler.changeStyleProperty(e,t,n)})),this.closeActionGroup()),this.dispatchEvent({type:A.MARKUP_STYLE_PROPERTY_CHANGED,styleProperty:e,value:t})}},{key:"getStyleProperty",value:function(e){return this.creationStyleProperties[e]}},{key:"onCalibrationEnded",value:function(){this.markupsExtension.setToolEnabled(!0),this.startMarkupSession(x)}},{key:"onHistoryChanged",value:function(e){e.actionGroup.forEach((function(e){e.markup.setDirty()})),this.dispatchEvent(e),this.dispatchEvent({type:A.LAYER_READY_TO_SAVE,readyToSave:this.getReadyToSave()})}},{key:"getLayersAsList",value:function(){return Pt(this.layers)}},{key:"getAllMarkups",value:function(){var e=[];return Ot(this.layers,(function(t){e.push.apply(e,vu(Pt(t.markups)))})),e}},{key:"generateScreenCapture",value:function(e){var t=this;return new Promise((function(n){setTimeout((function(){!function(e,t,n){var r,i=e.getExtension("Autodesk.BIM360.Markups");n&&e.impl.is2d&&(r=n.getWorldBoundingBox(),Autodesk.Viewing.ScreenShot.makeBoundsSquare(r));var A={bounds:r,margin:n?_e:0,overlayRenderer:Jt,overlayRendererExtraOptions:{markupLayer:n},getCropBounds:n&&function(e,t){r=n.getWorldBoundingBox(),Autodesk.Viewing.ScreenShot.makeBoundsSquare(r);var A=i.renderer.markupsCamera;e.impl.is2d&&(i.renderer.markupsCamera=t);var o=i.renderer.worldToClient(r.min),a=i.renderer.worldToClient(r.max);i.renderer.markupsCamera=A;var s=(new THREE.Box3).setFromPoints([o,a]);Autodesk.Viewing.ScreenShot.makeBoundsSquare(s,ze);var u=s.size().x;return s.expandByVector(new THREE.Vector3(u*_e,u*_e,0)),s}};Autodesk.Viewing.ScreenShot.getScreenShotAtScreenSize(e,t,A)}(t.markupsExtension.viewer,(function(e){n(e)}),e)}),100)}))}},{key:"changeCreationStatusType",value:function(e){this.creationStatusType=e}},{key:"getCreationStatusType",value:function(){return this.creationStatusType}},{key:"setDefaultCreationStyleProperties",value:function(){this.creationStyleProperties={},this.changeStyleProperty(c.LAST_COLOR,oe),this.changeStyleProperty(c.COLOR,oe),this.changeStyleProperty(c.FILL_COLOR,se),this.changeStyleProperty(c.THICKNESS,ue),this.changeStyleProperty(c.OPACITY,ce),this.changeStyleProperty(c.FILL_OPACITY,he),this.changeStyleProperty(c.FONT_SIZE,pe),this.changeStyleProperty(c.FONT_WEIGHT,ye),this.changeStyleProperty(c.FONT_FAMILY,ge),this.changeStyleProperty(c.FONT_STYLE,Ee),this.changeStyleProperty(c.FONT_COLOR,ae)}},{key:"reset",value:function(){this.nextMarkupId=0,this.nextLinkId=0,this.nextLayerId=0,this.sessionOpen=!1,this.layers={},this.selectedLayers=[],this.duringCreationMarkup=null,this.activeLayer=null,this.markupCreationType=null,this.markupsToCopy=[],this.pasteOffset=1,this.toolEnabled=!0,this.contextMenu=null,this.actionManager.clear(),this.creationStyleProperties={}}},{key:"destroy",value:function(){this.removeAllLayers(),this.unlockNavigation(),this.unregisterEvents(),this.reset(),this.clearListeners(),this.markupsExtension=null,this.actionManager=null}}])&&Cu(t.prototype,n),r&&Cu(t,r),o}();n(711);function Uu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Qu=Autodesk.Viewing,Lu=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.setGlobalManager(t.globalManager),this.viewer=this.markupsExtension.viewer,this.container=this.viewer.appendOrderedElementToViewer("markup-frames-container"),this.container.className="markup-frames-container",this.markupFrames={},this.layerFrames={},this.anchors={},this.segments={},this.rotationAxis=new THREE.Vector3(0,0,1),this.registerEventListeners()}var t,n,r;return t=e,(n=[{key:"registerEventListeners",value:function(){this.onMarkupDirtyBinded=this.onMarkupDirty.bind(this),this.onLayerDirtyBinded=this.onLayerDirty.bind(this),this.onLayerDeletedBinded=this.onLayerDeleted.bind(this),this.onMarkupRemovedBinded=this.onMarkupRemoved.bind(this),this.renderAllBinded=this.renderAll.bind(this),this.onRectSelectorUpdatedBinded=this.onRectSelectorUpdated.bind(this),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DIRTY,this.onMarkupDirtyBinded),this.markupsExtension.markupsManager.addEventListener(A.LAYER_DIRTY,this.onLayerDirtyBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_REMOVED,this.onMarkupRemovedBinded),this.markupsExtension.markupsManager.addEventListener(A.LAYER_DELETED,this.onLayerDeletedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_START,this.renderAllBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_END,this.renderAllBinded),this.markupsExtension.markupsManager.addEventListener(A.RECT_SELECTOR_UPDATED,this.onRectSelectorUpdatedBinded),this.viewer.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.renderAllBinded)}},{key:"unregisterEventListeners",value:function(){this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DIRTY,this.onMarkupDirtyBinded),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DIRTY,this.onLayerDirtyBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_REMOVED,this.onMarkupRemovedBinded),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DELETED,this.onLayerDeletedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_START,this.renderAllBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_END,this.renderAllBinded),this.markupsExtension.markupsManager.removeEventListener(A.RECT_SELECTOR_UPDATED,this.onRectSelectorUpdatedBinded),this.viewer.removeEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.renderAllBinded)}},{key:"renderAll",value:function(){var e=this.markupsExtension.markupsManager.getAllMarkups();this.renderMarkups(e);var t=this.markupsExtension.markupsManager.getLayersAsList();this.renderLayers(t)}},{key:"onMarkupDirty",value:function(e){var t=e.markup;this.renderMarkups([t])}},{key:"onLayerDirty",value:function(e){var t=e.layer;this.renderLayerSelectionFrame(t)}},{key:"renderLayers",value:function(e){var t=this;e.forEach((function(e){t.renderLayerSelectionFrame(e)}))}},{key:"renderMarkups",value:function(e){var t=this;e.forEach((function(e){e.belongsToGroup()||t.renderMarkupSelectionFrame(e),t.renderTransformAnchors(e),e.layer&&t.renderLayerSelectionFrame(e.layer)}))}},{key:"renderFrame",value:function(e,t,n){var r=this.getDocument();if(!e){(e=r.createElement("div")).className="markup-selection-frame-container",this.container.appendChild(e);var i=r.createElement("div");i.className="markup-selection-frame fill",i.style.width="".concat(Ie,"px"),i.style.height="".concat(Ie,"px"),Autodesk.Viewing.isIOSDevice()&&(i.className+=" ios"),e.appendChild(i),e.fillElement=i;for(var A=0;A<4;A++){var o=r.createElement("div");o.className="markup-selection-frame border",o.style.width="".concat(Ie,"px"),o.style.height="".concat(Ie,"px"),Autodesk.Viewing.isIOSDevice()&&(o.className+=" ios"),e.appendChild(o),e["border_".concat(A)]=o}}e.classList.contains("visible")||(e.classList.add("visible"),e.offsetHeight),n&&!e.fillElement.classList.contains("visible")?(e.fillElement.classList.add("visible"),e.fillElement.offsetHeight):!n&&e.fillElement.classList.contains("visible")&&(e.fillElement.classList.remove("visible"),e.fillElement.offsetHeight);var a=t.getClientBoundingBox(!0),s=a.center();s.x-=Ie/2,s.y-=Ie/2;var u=a.size(),c=at.radiansToDegrees(t.getRotation()+this.markupsExtension.renderer.getCameraRotation())||0;return n&&(e.fillElement.style.transform="translate(".concat(s.x,"px, ").concat(s.y,"px) rotate(").concat(c,"deg) scale(").concat(u.x/Ie,", ").concat(u.y/Ie,")")),e.border_0.style.transform="translate(".concat(s.x,"px, ").concat(s.y,"px) rotate(").concat(c,"deg) translate(0px, ").concat(u.y/2,"px) scale(").concat(u.x/Ie,", ").concat(1/Ie,")"),e.border_1.style.transform="translate(".concat(s.x,"px, ").concat(s.y,"px) rotate(").concat(c,"deg) translate(0px, ").concat(-u.y/2,"px) scale(").concat(u.x/Ie,", ").concat(1/Ie,")"),e.border_2.style.transform="translate(".concat(s.x,"px, ").concat(s.y,"px) rotate(").concat(c,"deg) translate(").concat(u.x/2,"px, 0px) scale(").concat(1/Ie,", ").concat(u.y/Ie,")"),e.border_3.style.transform="translate(".concat(s.x,"px, ").concat(s.y,"px) rotate(").concat(c,"deg) translate(").concat(-u.x/2,"px, 0px) scale(").concat(1/Ie,", ").concat(u.y/Ie,")"),e}},{key:"renderMarkupSelectionFrame",value:function(e){var t=this.markupFrames[e.id],n=e.isHovered(),r=e.isSelected();(r||n)&&e.layer?this.markupFrames[e.id]=this.renderFrame(t,e,r):t&&t.classList.contains("visible")&&(t.classList.remove("visible"),t.offsetHeight)}},{key:"renderLayerSelectionFrame",value:function(e){var t=this.layerFrames[e.id],n=e.isHovered(),r=e.isSelected(),i=e.isVisible();(r||n)&&i&&!this.markupsExtension.markupsManager.isMarkupSessionOpen()?this.layerFrames[e.id]=this.renderFrame(t,e,!1):t&&t.classList.contains("visible")&&(this.container.removeChild(t),delete this.layerFrames[e.id])}},{key:"_renderScaleAnchors",value:function(e){var t=this;if(e.scaleHandler)if(e.isInEdit()){var n=e.scaleHandler.getScaleAnchors(),r=e.getClientCenter();n.forEach((function(n,i){var A="".concat(e.id,"_scale_").concat(i),o=e.getRotation()+t.markupsExtension.renderer.getCameraRotation();at.applyRotation(n.pos,o,r,t.rotationAxis);var a=e.scaleHandler.isDragging()&&n.id===e.scaleHandler.scaleAnchor.id;t.createAnchorElement(A,n.pos,a,o,"rectangle")}))}else for(var i=0;i<8;i++){var A="".concat(e.id,"_scale_").concat(i);this.anchors[A]&&this.anchors[A].classList.contains("visible")&&this.anchors[A].classList.remove("visible")}}},{key:"_renderRotationAnchor",value:function(e){if(e.rotationHandler){var t="".concat(e.id,"_rotation_anchor");if(e.isInEdit()){var n=e.rotationHandler.getRotationAnchor(),r=e.rotationHandler.isDragging();this.createAnchorElement(t,n,r);var i=e.getClientBoundingBox(!0),A=i.center().add(new THREE.Vector3(0,i.size().y/2,0)),o=i.center(),a=e.getRotation()+this.markupsExtension.renderer.getCameraRotation();at.applyRotation(A,a,o,this.rotationAxis),this.createSegment(t,A,n)}else this.anchors[t]&&this.anchors[t].classList.contains("visible")&&(this.anchors[t].classList.remove("visible"),this.segments[t].classList.remove("visible"))}}},{key:"_renderAnchors",value:function(e){var t=this;if(e.anchorHandler){var n,r=function(e){var n=t.anchors[e];n&&n.classList.contains("visible")&&n.classList.remove("visible")},i=function(e){var n=t.segments[e];n&&n.classList.contains("visible")&&n.classList.remove("visible")},A="".concat(e.id,"_anchor"),o=e.anchorHandler.getAnchors();if(e.isInEdit()){for(var a=e.getClientCenter(),s=function(n){return e.applyScaleAndTranslation(n),n=t.markupsExtension.renderer.worldToClient(n),at.applyRotation(n,e.getRotation(),a,t.rotationAxis),n},u=null,c=null,l=0;l<o.length;l++){var h="".concat(A,"_").concat(l);c=s(o[l].clone());var d=o[l]===e.anchorHandler.activeAnchor;e.isAnchorHandlingAllowed(o[l])&&this.createAnchorElement(h,c,d),e.showPath()&&l>0&&this.createSegment(h,u,c),u=c}if(e.showPath()&&e.editState.closed){var p="".concat(A,"_").concat(o.length),f=s(o[0].clone());this.createSegment(p,c,f)}for(var y=(n=A,Object.keys(t.anchors).filter((function(e){return 0===e.indexOf(n)}))),g=function(e){return Object.keys(t.segments).filter((function(t){return 0===t.indexOf(e)}))}(A),E=o.length;E<y.length;E++)r("".concat(A,"_").concat(E));for(var m=e.editState.closed?g.length:g.length+1,B=o.length;B<m;B++)i("".concat(A,"_").concat(B))}else for(var v=0;v<=o.length;v++){var w="".concat(A,"_").concat(v);r(w),i(w)}}}},{key:"renderTransformAnchors",value:function(e){e.isCompleted()&&(this._renderScaleAnchors(e),this._renderRotationAnchor(e),this._renderAnchors(e))}},{key:"createAnchorElement",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",A=this.anchors[e],o=this.getDocument();if(!A){(A=o.createElement("div")).className="markup-anchor "+i;var a="".concat(2*Ce,"px");A.style.width=a,A.style.height=a,this.container.appendChild(A),this.anchors[e]=A;var s=o.createElement("div");s.className="markup-anchor-fill "+i,A.appendChild(s),A.anchorFill=s}A.classList.contains("visible")||A.classList.add("visible"),n&&!A.anchorFill.classList.contains("visible")?A.anchorFill.classList.add("visible"):!n&&A.anchorFill.classList.contains("visible")&&A.anchorFill.classList.remove("visible");var u=at.radiansToDegrees(r);A.style.transform="translate(".concat(t.x-Ce,"px, ").concat(t.y-Ce,"px) rotate(").concat(u,"deg)")}},{key:"createSegment",value:function(e,t,n){var r=this.segments[e],i=this.getDocument();r||((r=i.createElement("div")).className="markup-selection-frame segment border",r.style.width="".concat(Ie,"px"),r.style.height="".concat(Ie,"px"),this.container.appendChild(r),this.segments[e]=r),r.classList.contains("visible")||r.classList.add("visible");var A=t.clone().add(n).multiplyScalar(.5);A.x-=Ie/2,A.y-=Ie/2;var o=t.distanceTo(n),a=at.getSignedAngle(n.clone().sub(t),this.markupsExtension.renderer.getCameraUpVector(),this.markupsExtension.renderer.getCameraEyeVector());r.style.transform="translate(".concat(A.x,"px, ").concat(A.y,"px) rotate(").concat(at.radiansToDegrees(a+this.markupsExtension.renderer.getCameraRotation()),"deg) scale(").concat(1/Ie,", ").concat(o/Ie,")")}},{key:"onLayerDeleted",value:function(e){var t=e.layer.id,n=this.layerFrames[t];n&&this.container.removeChild(n),delete this.layerFrames[t]}},{key:"onMarkupRemoved",value:function(e){var t=e.markup,n=t.id,r=this.markupFrames[n];r&&this.container.removeChild(r),delete this.markupFrames[n],t.layer&&t.layer.isEmpty()&&this.onLayerDeleted(t)}},{key:"onRectSelectorUpdated",value:function(e){var t=e.bounds,n=this.getDocument();this.rectSelectorFrame||(this.rectSelectorFrame=n.createElement("div"),this.rectSelectorFrame.className="rect-selector-frame",this.container.appendChild(this.rectSelectorFrame));var r=!t.isEmpty();r&&!this.rectSelectorFrame.classList.contains("visible")?(this.rectSelectorFrame.classList.add("visible"),this.rectSelectorFrame.offsetHeight):!r&&this.rectSelectorFrame.classList.contains("visible")&&(this.rectSelectorFrame.classList.remove("visible"),this.rectSelectorFrame.offsetHeight);var i=t.clone();i.min=this.markupsExtension.renderer.worldToClient(i.min),i.max=this.markupsExtension.renderer.worldToClient(i.max);var A=i.size();this.rectSelectorFrame.style.width="".concat(Math.abs(A.x),"px"),this.rectSelectorFrame.style.height="".concat(Math.abs(A.y),"px"),this.rectSelectorFrame.style.transformOrigin="top left",this.rectSelectorFrame.style.transform="translate(".concat(i.min.x,"px, ").concat(i.min.y,"px) scale(").concat(Math.sign(A.x),", ").concat(Math.sign(A.y),")")}},{key:"destroy",value:function(){var e=this;this.unregisterEventListeners(),Ot(this.markupFrames,(function(t){e.container.removeChild(t)})),this.markupFrames=null,Ot(this.layerFrames,(function(t){e.container.removeChild(t)})),this.layerFrames=null,Ot(this.anchors,(function(t){e.container.removeChild(t)})),this.anchors=null,Ot(this.segments,(function(t){e.container.removeChild(t)})),this.segments=null,this.markupsExtension=null,this.viewer=null}}])&&Uu(t.prototype,n),r&&Uu(t,r),e}();Qu.GlobalManagerMixin.call(Lu.prototype);n(713);function Fu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ru=Autodesk.Viewing,Hu=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.setGlobalManager(t.globalManager),this.viewer=this.markupsExtension.viewer,this.container=this.viewer.appendOrderedElementToViewer("markup-links-container"),this.container.className="markup-links-container",this.links={},this.linksSizeCache={},this.registerEventListeners()}var t,n,r;return t=e,(n=[{key:"registerEventListeners",value:function(){this.onLinkDirtyBinded=this.onLinkDirty.bind(this),this.onMarkupDirtyBinded=this.onMarkupDirty.bind(this),this.renderAllLinksBinded=this.renderAllLinks.bind(this),this.onLinkDeletedBinded=this.onLinkDeleted.bind(this),this.markupsExtension.markupsManager.addEventListener(A.LINK_DIRTY,this.onLinkDirtyBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DIRTY,this.onMarkupDirtyBinded),this.markupsExtension.markupsManager.addEventListener(A.LINK_SYNCED,this.renderAllLinksBinded),this.markupsExtension.markupsManager.addEventListener(A.LINK_REMOVED,this.onLinkDeletedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_START,this.renderAllLinksBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_END,this.renderAllLinksBinded),this.markupsExtension.markupsManager.addEventListener(A.LAYER_SELECTED,this.renderAllLinksBinded),this.markupsExtension.markupsManager.addEventListener(A.LAYER_DESELECTED,this.renderAllLinksBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_VIEW_EXITED,this.renderAllLinksBinded),this.viewer.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.renderAllLinksBinded)}},{key:"unregisterEventListeners",value:function(){this.markupsExtension.markupsManager.removeEventListener(A.LINK_DIRTY,this.onLinkDirtyBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DIRTY,this.onMarkupDirtyBinded),this.markupsExtension.markupsManager.removeEventListener(A.LINK_SYNCED,this.renderAllLinksBinded),this.markupsExtension.markupsManager.removeEventListener(A.LINK_REMOVED,this.onLinkDeletedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_START,this.renderAllLinksBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_END,this.renderAllLinksBinded),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_SELECTED,this.renderAllLinksBinded),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DESELECTED,this.renderAllLinksBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_VIEW_EXITED,this.renderAllLinksBinded),this.viewer.removeEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.renderAllLinksBinded)}},{key:"onMarkupDirty",value:function(e){var t=this,n=e.markup;n.layer&&Ot(n.layer.links,(function(e){t.renderLink(e)}))}},{key:"onLinkDirty",value:function(e){var t=e.link;this.renderLink(t)}},{key:"renderLink",value:function(e){if(!e.layer.isEmpty()){var t="".concat(e.layer.id,"_link_").concat(e.id);if(e.isVisible()){var n=e.isSelected(),r=e.isHovered(),i=this.markupsExtension.markupsManager.getActiveLayer()===e.layer,A=e.layer.layerData.attachments.length,o=this.markupsExtension.markupsManager.isMarkupSessionOpen()&&!i||this.markupsExtension.markupsManager.getSelectedLayers().length>0&&!e.layer.isSelected()||!this.markupsExtension.isToolEnabled();this.createLinkElement(t,e,n,i,r,A,o)}else this.links[t]&&this.links[t].classList.remove("visible");e.setDirty(!1)}}},{key:"renderAllLinks",value:function(){var e=this,t=this.markupsExtension.markupsManager.layers;Ot(t,(function(t){Ot(t.links,(function(t){e.renderLink(t)}))})),this.markupsExtension.markupsManager.dispatchEvent({type:A.LINK_RENDERED})}},{key:"createLinkElement",value:function(e,t,n,r,i,A,o){var a=this.links[e],s=this.getDocument();if(!a){(a=s.createElement("div")).className="link";var u=s.createElement("div");u.className="link-document-attachment",a.appendChild(u),this.container.appendChild(a),this.links[e]=a}a.classList.contains("visible")||a.classList.add("visible"),o&&!a.classList.contains("transparent")?a.classList.add("transparent"):!o&&a.classList.contains("transparent")&&a.classList.remove("transparent"),n&&!a.classList.contains("selected")?a.classList.add("selected"):!n&&a.classList.contains("selected")&&a.classList.remove("selected"),i&&!a.classList.contains("hover")?a.classList.add("hover"):!i&&a.classList.contains("hover")&&a.classList.remove("hover"),r&&!a.classList.contains("editable")?a.classList.add("editable"):!r&&a.classList.contains("editable")&&a.classList.remove("editable");var c=A>99?"99+":A;a.firstChild.innerText=c,this.linksSizeCache[c]||(this.linksSizeCache[c]=a.firstChild.getBoundingClientRect());var l=new THREE.Box3,h=new THREE.Vector3(this.linksSizeCache[c].width/2,this.linksSizeCache[c].height/2,0);l.expandByPoint(new THREE.Vector3),l.expandByVector(h),a.boundingBox=l;var d=t.getPosition(),p=this.markupsExtension.renderer.worldToClient(d);a.style.transform="translate(".concat(Math.round(p.x-this.linksSizeCache[c].width/2),"px, ").concat(Math.round(p.y-this.linksSizeCache[c].height/2),"px)"),l.makeEmpty(),l.expandByPoint(p),l.expandByVector(h)}},{key:"getLinkBoundingBox",value:function(e){var t="".concat(e.layer.id,"_link_").concat(e.id),n=this.links[t];return n?n.boundingBox:new THREE.Box3}},{key:"onLinkDeleted",value:function(e){var t=e.link,n="".concat(t.layer.id,"_link_").concat(t.id),r=this.links[n];r&&this.container.removeChild(r),delete this.links[n]}},{key:"destroy",value:function(){var e=this;this.unregisterEventListeners(),Ot(this.links,(function(t){e.container.removeChild(t)})),this.links=null,this.markupsExtension=null,this.viewer=null}}])&&Fu(t.prototype,n),r&&Fu(t,r),e}();function _u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Ru.GlobalManagerMixin.call(Hu.prototype);var Du=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.viewer=t.viewer,this.materials={}}var t,n,r;return t=e,(n=[{key:"_getHashName",value:function(e,t,n,r){var i=e;return n?(i+="|f",t[c.FILL_COLOR]&&(i+="|c"+t[c.FILL_COLOR]),void 0!==t[c.FILL_OPACITY]&&(i+="|o"+t[c.FILL_OPACITY]*(r?Ye:1))):(t[c.THICKNESS]&&(i+="|t"+t[c.THICKNESS]),t[c.COLOR]&&(i+="|c"+t[c.COLOR]),void 0!==t[c.OPACITY]&&(i+="|o"+t[c.OPACITY]*(r?Ye:1))),i}},{key:"_setResolution",value:function(e,t){e.uniforms&&e.uniforms.resolution&&e.uniforms.resolution.value.set(t.width,t.height)}},{key:"getMaterial",value:function(e,t,n){var r=this._getHashName(e,t,n);return this.materials[r]?this.materials[r]:null}},{key:"_setFillBlending",value:function(e){e.blending=e.opacity<1?THREE.NoBlending:THREE.NormalBlending}},{key:"_setStrokeBlending",value:function(e){e.uniforms.opacity.value<1?(e.blending=THREE.CustomBlending,e.blendDst=THREE.ZeroFactor,e.blendSrc=THREE.OneFactor,e.blendEquation=THREE.AddEquation,Autodesk.Viewing.isIE11||(e.blendEquationAlpha=THREE.MaxEquation)):e.blending=THREE.NormalBlending}},{key:"_createStrokeMaterial",value:function(e,t,n){var r=this.markupsExtension.renderer.getResolution(),i=new gA({color:new THREE.Color(e[c.COLOR]),opacity:e[c.OPACITY]*(n?Ye:1),resolution:new THREE.Vector2(r.width,r.height),lineWidth:e[c.THICKNESS],side:THREE.FrontSide,miter:t});return this._setStrokeBlending(i),i}},{key:"_createFillMaterial",value:function(e,t){var n={color:new THREE.Color(e[c.FILL_COLOR]),transparent:!0,opacity:e[c.FILL_OPACITY]*(t?Ye:1),side:THREE.DoubleSide,wireframe:!1},r=new THREE.MeshBasicMaterial(n);return this._setFillBlending(r),r}},{key:"_editStrokeMaterial",value:function(e,t,n){e.uniforms.color.value.setStyle(t[c.COLOR]),e.uniforms.lineWidth.value=t[c.THICKNESS],e.uniforms.opacity.value=t[c.OPACITY]*(n?Ye:1),this._setStrokeBlending(e)}},{key:"_editFillMaterial",value:function(e,t,n){e.color.setStyle(t[c.FILL_COLOR]),e.opacity=t[c.FILL_OPACITY]*(n?Ye:1),e.needsUpdate=!0,this._setFillBlending(e)}},{key:"hasThicknessChanged",value:function(e,t){return e&&t&&e.uniforms&&t.uniforms&&e.uniforms.lineWidth.value!==t.uniforms.lineWidth.value}},{key:"addMaterial",value:function(e,t){var n=e.type,r=e.editState.style,i=e.isTransparent(),A=this._getHashName(n,r,t,i);if(this.materials[A])this.materials[A].refCount++;else{var o=t?this._createFillMaterial(r,i):this._createStrokeMaterial(r,e.needsMiter(),i);o.depthWrite=!1,o.depthTest=!1,o.transparent=!0,o.refCount=1,o.name=A,this.materials[A]=o}return this.materials[A]}},{key:"removeMaterial",value:function(e){this.materials[e.name]?(e.refCount--,0===e.refCount&&(e.dispose(),e.needsUpdate=!0,delete this.materials[e.name])):console.error("Trying to remove a non-existing material")}},{key:"editMaterial",value:function(e,t,n){if(this.materials[e.name]){var r=t.type,i=t.editState.style,A=t.isTransparent(),o=this._getHashName(r,i,n,A);if(o!==e.name)return 1!==e.refCount||this.materials[o]?(this.removeMaterial(e),this.addMaterial(t,n)):(n?this._editFillMaterial(e,i,A):this._editStrokeMaterial(e,i,A),delete this.materials[e.name],e.name=o,this.materials[o]=e,e.needsUpdate=!0,e)}else console.error("Trying to edit a non-existing material")}},{key:"destroy",value:function(){for(var e in this.materials)this.materials[e].dispose(),this.materials[e].needsUpdate=!0;this.materials={}}},{key:"updateScreenSize",value:function(e){for(var t in this.materials)this._setResolution(this.materials[t],e)}}])&&_u(t.prototype,n),r&&_u(t,r),e}(),Ou=n(357),Iu=n.n(Ou);n(715);function Pu(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Nu=Autodesk.Viewing,Ku=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.setGlobalManager(t.globalManager),this.viewer=this.markupsExtension.viewer,this.container=this.viewer.appendOrderedElementToViewer("markup-text-container"),this.container.className="markup-text-container",this.labels={},this.textMarkups={},this.textSizeCache={},this.registerEventListeners()}var t,n,r;return t=e,(n=[{key:"registerEventListeners",value:function(){this.onMarkupRemovedBinded=this.onMarkupRemoved.bind(this),this.onCameraChangedBinded=this.onCameraChanged.bind(this),this.onMarkupVisibilityChangedBinded=this.onMarkupVisibilityChanged.bind(this),this.onResizeBinded=this.onResize.bind(this),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_VISIBILITY_CHANGED,this.onMarkupVisibilityChangedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_REMOVED,this.onMarkupRemovedBinded),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedBinded),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded)}},{key:"unregisterEventListeners",value:function(){this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_VISIBILITY_CHANGED,this.onMarkupVisibilityChangedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_REMOVED,this.onMarkupRemovedBinded),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedBinded),this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded)}},{key:"onCameraChanged",value:function(){this.renderTextMarkups()}},{key:"onResize",value:function(){var e=this;this.viewer.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,(function(){e.onCameraChanged()}),{once:!0})}},{key:"renderTextMarkups",value:function(){var e=this;Ot(this.textMarkups,(function(t){e.renderMarkup(t)}))}},{key:"updateLabelPositionAndSize",value:function(e,t){function n(t,n){e.styleCache[t]!==n&&(e.style[t]=n,e.styleCache[t]=n)}var r=t.getEditState().text,i=t.getTextStyle(),A=this.markupsExtension.renderer.getFontToWorldScale(),o=this.markupsExtension.renderer.sizeFromWorldToClient(A),a=t.getClientBoundingBoxTextOnly(),s=a.center(),u=a.size(),c=at.radiansToDegrees(t.getRotation()+this.markupsExtension.renderer.getCameraRotation());if(Autodesk.Viewing.isSafari()||Autodesk.Viewing.isIOSDevice()){var l=parseFloat(i.fontSize)*o,h=Math.floor(l)||1,d=l/h,p=u.x/d;i.width="".concat(p,"px"),i.fontSize="".concat(h,"px"),Object.keys(i).forEach((function(e){n(e,i[e])})),e.style.transform="translate(".concat(s.x,"px, ").concat(s.y,"px)\n                                    translate(-50%, -50%)\n                                    rotate(").concat(c,"deg)\n                                    scale(").concat(d,")")}else{var f=t.getTextWidthInFontScale(),y=f.preciseWidth,g=f.width;i.width="".concat(g,"px"),Object.keys(i).forEach((function(e){n(e,i[e])}));var E=(y-g)*o;e.style.transform="translate(".concat(s.x-E/2,"px, ").concat(s.y,"px)\n                                    translate(-50%, -50%)\n                                    rotate(").concat(c,"deg)\n                                    scale(").concat(o,")")}t.textInputHandler.textboxActive||(e.innerText=r||"")}},{key:"renderMarkup",value:function(e){if(e.editState.anchors[0]){var t=this.labels[e.id],n=this.getDocument();if(!t){(t=n.createElement("div")).className="markup-text",t.id=e.id;var r=e.getEditState().text;t.innerText=r||"",t.styleCache={},this.container.appendChild(t),this.labels[e.id]=t,this.textMarkups[e.id]=e}e.isVisible()&&!t.classList.contains("visible")?t.classList.add("visible"):!e.isVisible()&&t.classList.contains("visible")&&t.classList.remove("visible"),e.editState.isSingleLine&&!t.classList.contains("single-line")&&t.classList.add("single-line"),e.isVisible()&&this.updateLabelPositionAndSize(t,e)}}},{key:"getLabel",value:function(e){return this.labels[e.id]}},{key:"onMarkupVisibilityChanged",value:function(e){var t=e.markup;e.visible,t.type===S&&this.renderMarkup(t)}},{key:"onMarkupRemoved",value:function(e){var t=e.markup.id,n=this.labels[t];n&&this.container.removeChild(n),delete this.labels[t],delete this.textMarkups[t]}},{key:"isEmpty",value:function(){return 0===Object.keys(this.labels).length}},{key:"renderTextToCanvas",value:function(e,t,n,r,i,A){var o=this;if(this.isEmpty())A(e);else{var a={};Pt(this.textMarkups).forEach((function(e){e.isVisible()&&(a[e.id]=!0)}));var s={backgroundColor:null,logging:!1,scale:n,onclone:function(e){r();var n=o.markupsExtension.renderer.documentCamera,A=o.markupsExtension.renderer.markupsCamera;o.markupsExtension.renderer.documentCamera=t,o.markupsExtension.renderer.markupsCamera=t;for(var s=e.getElementsByClassName("markup-text-container")[0].children,u=0;u<s.length;u++){var c=s[u];if(a[c.id]){var l=o.textMarkups[c.id];c.classList.contains("visible")||c.classList.add("visible"),c.styleCache={},o.updateLabelPositionAndSize(c,l)}else c.classList.contains("visible")&&c.classList.remove("visible")}o.markupsExtension.renderer.documentCamera=n,o.markupsExtension.renderer.markupsCamera=A,i()}};Iu()(this.container,s).then((function(t){var n=o.getDocument().createElement("canvas");n.width=t.width,n.height=t.height;var r=n.getContext("2d");r.translate(0,n.height),r.scale(1,-1),r.drawImage(t,0,0);var i=e.getContext("2d");i.globalCompositeOperation="source-over",i.drawImage(n,0,0),A(e)}))}}},{key:"destroy",value:function(){var e=this;this.unregisterEventListeners(),Ot(this.labels,(function(t){e.container.removeChild(t)})),this.labels=null,this.textMarkups=null,this.textSizeCache=null,this.markupsExtension=null,this.viewer=null}}])&&Pu(t.prototype,n),r&&Pu(t,r),e}();Nu.GlobalManagerMixin.call(Ku.prototype);var Vu={worldToClient:function(e,t,n){var r=new THREE.Vector4(t.x,t.y,t.z,1);return r.applyMatrix4(n.matrixWorldInverse),r.applyMatrix4(n.projectionMatrix),r.w>0&&(r.x/=r.w,r.y/=r.w,r.z/=r.w),e.impl.viewportToClient(r.x,r.y)},getCameraEyeVector:function(e){return e.target.clone().sub(e.position).normalize()},getCameraRightVector:function(e){var t=Vu.getCameraEyeVector(e);return(new THREE.Vector3).crossVectors(t,e.up).normalize()},getCameraUpVector:function(e){var t=Vu.getCameraRightVector(e),n=Vu.getCameraEyeVector(e);return(new THREE.Vector3).crossVectors(t,n).normalize()},getCameraRotation:function(e){return at.getSignedAngle(Vu.getCameraUpVector(e),new THREE.Vector3(0,1,0),Vu.getCameraEyeVector(e))}},Gu=Vu;function ju(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Yu=Autodesk.Viewing.Private,Wu=Yu.ShaderPass,Xu=Yu.CopyShader,Ju=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.viewer=this.markupsExtension.viewer,this.viewer.impl.updateCameraMatrices(),this.viewer.navigation.updateCamera(),this.documentCamera=this.viewer.navigation.getCamera(),this.documentCamera.updateMatrixWorld(),this.textRenderer=new Ku(this.markupsExtension),this.frameRenderer=new Lu(this.markupsExtension),this.linksRenderer=new Hu(this.markupsExtension),this.materialManager=new Du(this.markupsExtension),this.geometryManager=new SA(this.markupsExtension),this.is3d=this.viewer.model.is3d(),this.raycaster=new THREE.Raycaster,this.size={width:this.viewer.canvas.clientWidth,height:this.viewer.canvas.clientHeight},this.is3d?(this.viewSize=qe,this.markupsCamera=new THREE.OrthographicCamera(0,this.viewSize,this.viewSize,0,0,1),this.markupsCamera.position.set(0,0,1),this.markupsCamera.target=new THREE.Vector3(0,0,0)):this.markupsCamera=this.viewer.navigation.getCamera(),this.markups=[],this.renderer=this.viewer.impl.renderer(),this.glrenderer=this.viewer.impl.glrenderer(),this.copyPass=new Wu(Xu),this.copyPass.material.depthWrite=!1,this.copyPass.material.depthTest=!1,this.copyPass.material.transparent=!0,this._tmpScene=new THREE.Scene,this._black=new THREE.Color(0,0,0),this.absoluteRightVec=new THREE.Vector3(1,0,0),this.absoluteUpVec=new THREE.Vector3(0,1,0),this.absoluteEyeVec=new THREE.Vector3(0,0,1),this.tmpMatrix=new THREE.Matrix4,this.frustum=new THREE.Frustum,this.setMMtoUnitConversion(),this.setNormaStrokeWidth(),this.setNormaTextSize(),this.registerEventListeners(),this.updateCameraAndMaterialParameters()}var t,n,r;return t=e,(n=[{key:"registerEventListeners",value:function(){this.onRenderBinded=this.onRender.bind(this),this.onResizeBinded=this.onResize.bind(this),this.invalidateBinded=this.invalidate.bind(this),this.onCameraChangedBinded=this.onCameraChanged.bind(this),this.viewer.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.onRenderBinded),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_REMOVED,this.invalidateBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DRAWING_CANCEL,this.invalidateBinded)}},{key:"removeEventListeners",value:function(){this.viewer.removeEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.onRenderBinded),this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_REMOVED,this.invalidateBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DRAWING_CANCEL,this.invalidateBinded)}},{key:"onCameraChanged",value:function(){this.eyeVector=null,this.upVector=null,this.rightVector=null}},{key:"getResolution",value:function(){var e=this.glrenderer.getPixelRatio();return{width:this.size.width*e,height:this.size.height*e}}},{key:"supportsInt32Index",value:function(){return!!this.glrenderer.supportsElementIndexUint()}},{key:"disposeTmpTarget",value:function(){this._tmpTarget&&(this._tmpTarget.dispose(),this._tmpTarget=null)}},{key:"createTempRenderTarget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getResolution();return this.disposeTmpTarget(),0!==e.width&&0!==e.height&&(this._tmpTarget=new THREE.WebGLRenderTarget(e.width,e.height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1}),this._tmpTarget.generateMipmaps=!1,!0)}},{key:"onRender",value:function(){this.render()}},{key:"onResize",value:function(e){this.size.width=e.width,this.size.height=e.height,this.updateCameraAndMaterialParameters()}},{key:"updateCameraAndMaterialParameters",value:function(){if(this.is3d){var e=this.size.width/(this.size.height||1),t=this.viewSize*e,n=this.markupsCamera.right-t;this.markupsCamera.position.x+=n/2,this.markupsCamera.target.x+=n/2,this.markupsCamera.right=t,this.markupsCamera.updateProjectionMatrix(),this.markupsCamera.updateMatrixWorld()}var r=this.getResolution();this._tmpTarget&&this.createTempRenderTarget(r),this.materialManager.updateScreenSize(r)}},{key:"render",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.renderer.getFinalTarget(),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.markupsCamera;this.tmpMatrix.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this.frustum.setFromMatrix(this.tmpMatrix);var r=function(t){var n=t.max,r=t.max.clone().setX(t.min.x),i=t.min,A=t.min.clone().setX(t.max.x);return e.frustum.containsPoint(n)||e.frustum.containsPoint(r)||e.frustum.containsPoint(i)||e.frustum.containsPoint(A)||e.frustum.intersectsBox(t)},i=function(e,t){return!(t.max.x<e.min.x||t.min.x>e.max.x||t.max.y<e.min.y||t.min.y>e.max.y)},A=[],o=[],a=[],s=function(){var r;0!==A.length&&((r=e._tmpScene).add.apply(r,A),e.glrenderer.render(e._tmpScene,n,t),e._tmpScene.children.length=0,A.length=0)},u=function(){var r;0!==o.length&&((r=e._tmpScene).add.apply(r,o),e.glrenderer.setClearColor(e._black,0),e.glrenderer.clearTarget(e._tmpTarget,!0,!1,!1),e.glrenderer.render(e._tmpScene,n,e._tmpTarget),e.copyPass.render(e.glrenderer,t,e._tmpTarget),e._tmpScene.children.length=0,o.length=0,a.length=0)};this.markups.forEach((function(c){var l=c.meshContainer;if(l.visible&&0!==l.children.length){if(!e.is3d){var h=c.getWorldBoundingBox(!0);if(!r(h))return}var d=c.fillMesh,p=c.strokeMesh,f=d&&d.material.opacity<1,y=p.material.uniforms.opacity.value<1;if(f||y){if(!e._tmpTarget&&!e.createTempRenderTarget())return;if(s(),!f&&d||!y)u(),e._tmpScene.add(l),l.remove(p),e.glrenderer.setClearColor(e._black,0),e.glrenderer.clearTarget(e._tmpTarget,!0,!1,!1),e.glrenderer.render(e._tmpScene,n,e._tmpTarget),e.copyPass.render(e.glrenderer,t,e._tmpTarget),l.remove(d),l.add(p),e.glrenderer.render(e._tmpScene,n,t),l.add(d),l.add(p),e._tmpScene.remove(l);else{var g=c.getWorldBoundingBox(!0);a.some((function(e){return(!c.isTransparent()||!e.isTransparent)&&i(g,e.bbox)}))&&u(),o.push(l),a.push({bbox:g,isTransparent:c.isTransparent()})}}else u(),A.push(l)}})),s(),u()}},{key:"getCameraEyeVector",value:function(){return this.eyeVector||(this.eyeVector=Gu.getCameraEyeVector(this.markupsCamera)),this.eyeVector.clone()}},{key:"getCameraRightVector",value:function(){return this.rightVector||(this.rightVector=Gu.getCameraRightVector(this.markupsCamera)),this.rightVector.clone()}},{key:"getCameraUpVector",value:function(){return this.upVector||(this.upVector=Gu.getCameraUpVector(this.markupsCamera)),this.upVector.clone()}},{key:"getCameraRotation",value:function(){return Gu.getCameraRotation(this.markupsCamera)}},{key:"worldToClient",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.markupsCamera,n=this.viewer.navigation.getScreenViewport(),r=e.clone().project(t);return new THREE.Vector3((r.x+1)/2*n.width,(1-r.y)/2*n.height,0)}},{key:"clientToWorld",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.markupsCamera,n=this.viewer.navigation.getScreenViewport(),r=new THREE.Vector3;r.x=e.x/n.width*2-1,r.y=-(e.y/n.height*2-1);var i=r.unproject(t);return i.z=0,i}},{key:"sizeFromWorldToClient",value:function(e){var t=this.worldToClient(new THREE.Vector3),n=this.worldToClient(new THREE.Vector3(e,0,0));return t.distanceTo(n)}},{key:"sizeFromClientToWorld",value:function(e){var t=this.clientToWorld(new THREE.Vector3),n=this.clientToWorld(new THREE.Vector3(e,0,0));return t.distanceTo(n)}},{key:"multiplyByNormaStrokeWidth",value:function(e){return this.normaStrokeWidth*e}},{key:"documentCameraToMarkupsCamera",value:function(e){if(!this.is3d)return e.z=0,e;var t=this.worldToClient(e,this.documentCamera);return this.clientToWorld(t)}},{key:"_fromMMtoWorldUnits",value:function(e){if(this.is3d)return 1;var t=this.viewer.model,n=t.getMetadata("page_dimensions","page_units",null)||t.getMetadata("page_dimensions","model_units","mm"),r=Autodesk.Viewing.Private.convertUnits("mm",n,1,e);return t.isLeaflet()&&(r*=this.viewer.impl.getFitBounds(!0).size().x/t.getMetadata("page_dimensions","page_width")),r}},{key:"_calcNormaSize",value:function(e,t){var n=this.mmToWorldUnitFactor*e,r=this.viewer.impl.getFitBounds(!0),i=r.size().x,A=r.size().y,o=Math.sqrt(i*i+A*A);return n=Math.min(n,o*t)}},{key:"setMMtoUnitConversion",value:function(){this.mmToWorldUnitFactor=this._fromMMtoWorldUnits(1)}},{key:"setNormaStrokeWidth",value:function(){this.is3d?this.normaStrokeWidth=et:this.normaStrokeWidth=this._calcNormaSize(de,Ze)}},{key:"setNormaTextSize",value:function(){this.is3d?this.normaTextSize=tt:this.normaTextSize=this._calcNormaSize(fe,$e)}},{key:"getNormaStrokeWidth",value:function(){return this.normaStrokeWidth}},{key:"getFontToWorldScale",value:function(){return this.normaTextSize/pe}},{key:"addToScene",value:function(e){var t=function(e){return e.layer&&e.layer.layerData&&e.layer.layerData.metadata&&e.layer.layerData.metadata.created_at};t(e)?Wt(e,this.markups,(function(e,n){if(!t(e))return 1;var r=Date.parse(e.layer.layerData.metadata.created_at),i=Date.parse(n.layer.layerData.metadata.created_at);return r>i?1:r<i?-1:e.id>n.id?1:e.id<n.id?-1:0})):this.markups.push(e)}},{key:"removeFromScene",value:function(e){dt.remove(this.markups,(function(t){return t===e}))}},{key:"invalidate",value:function(){this.markupsExtension.viewer.impl.invalidate(!1,!1,!0)}},{key:"updateRaycaster",value:function(e){var t=this.viewer.navigation.getScreenViewport(),n=e.x/t.width*2-1,r=-e.y/t.height*2+1;this.raycaster.ray.origin.set(n,r,(this.markupsCamera.near+this.markupsCamera.far)/(this.markupsCamera.near-this.markupsCamera.far)).unproject(this.markupsCamera),this.raycaster.ray.direction.set(0,0,-1)}},{key:"destroy",value:function(){this.removeEventListeners(),this.frameRenderer&&(this.frameRenderer.destroy(),this.frameRenderer=null),this.linksRenderer&&(this.linksRenderer.destroy(),this.linksRenderer=null),this.textRenderer&&(this.textRenderer.destroy(),this.textRenderer=null),this.materialManager&&(this.materialManager.destroy(),this.materialManager=null),this.geometryManager&&(this.geometryManager.destroy(),this.geometryManager=null),this.disposeTmpTarget(),this.invalidate(),this.markupsExtension=null,this.viewer=null}}])&&ju(t.prototype,n),r&&ju(t,r),e}();function zu(e,t){if(t.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+t.length+" present")}function qu(e){zu(1,arguments);var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}function Zu(e){zu(1,arguments);var t=qu(e);return!isNaN(t)}var $u={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function ec(e){return function(t){var n=t||{},r=n.width?String(n.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}var tc={date:ec({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:ec({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:ec({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},nc={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function rc(e){return function(t,n){var r,i=n||{};if("formatting"===(i.context?String(i.context):"standalone")&&e.formattingValues){var A=e.defaultFormattingWidth||e.defaultWidth,o=i.width?String(i.width):A;r=e.formattingValues[o]||e.formattingValues[A]}else{var a=e.defaultWidth,s=i.width?String(i.width):e.defaultWidth;r=e.values[s]||e.values[a]}return r[e.argumentCallback?e.argumentCallback(t):t]}}function ic(e){return function(t,n){var r=String(t),i=n||{},A=i.width,o=A&&e.matchPatterns[A]||e.matchPatterns[e.defaultMatchWidth],a=r.match(o);if(!a)return null;var s,u=a[0],c=A&&e.parsePatterns[A]||e.parsePatterns[e.defaultParseWidth];return s="[object Array]"===Object.prototype.toString.call(c)?function(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return n}(c,(function(e){return e.test(u)})):function(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(e[n]))return n}(c,(function(e){return e.test(u)})),s=e.valueCallback?e.valueCallback(s):s,{value:s=i.valueCallback?i.valueCallback(s):s,rest:r.slice(u.length)}}}var Ac,oc={code:"en-US",formatDistance:function(e,t,n){var r;return n=n||{},r="string"==typeof $u[e]?$u[e]:1===t?$u[e].one:$u[e].other.replace("{{count}}",t),n.addSuffix?n.comparison>0?"in "+r:r+" ago":r},formatLong:tc,formatRelative:function(e,t,n,r){return nc[e]},localize:{ordinalNumber:function(e,t){var n=Number(e),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},era:rc({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:rc({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:function(e){return Number(e)-1}}),month:rc({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:rc({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:rc({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(Ac={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:function(e){return parseInt(e,10)}},function(e,t){var n=String(e),r=t||{},i=n.match(Ac.matchPattern);if(!i)return null;var A=i[0],o=n.match(Ac.parsePattern);if(!o)return null;var a=Ac.valueCallback?Ac.valueCallback(o[0]):o[0];return{value:a=r.valueCallback?r.valueCallback(a):a,rest:n.slice(A.length)}}),era:ic({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:ic({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:function(e){return e+1}}),month:ic({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:ic({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:ic({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}};function ac(e){if(null===e||!0===e||!1===e)return NaN;var t=Number(e);return isNaN(t)?t:t<0?Math.ceil(t):Math.floor(t)}function sc(e,t){zu(2,arguments);var n=qu(e).getTime(),r=ac(t);return new Date(n+r)}function uc(e,t){zu(2,arguments);var n=ac(t);return sc(e,-n)}function cc(e,t){for(var n=e<0?"-":"",r=Math.abs(e).toString();r.length<t;)r="0"+r;return n+r}var lc={y:function(e,t){var n=e.getUTCFullYear(),r=n>0?n:1-n;return cc("yy"===t?r%100:r,t.length)},M:function(e,t){var n=e.getUTCMonth();return"M"===t?String(n+1):cc(n+1,2)},d:function(e,t){return cc(e.getUTCDate(),t.length)},a:function(e,t){var n=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.toUpperCase();case"aaa":return n;case"aaaaa":return n[0];case"aaaa":default:return"am"===n?"a.m.":"p.m."}},h:function(e,t){return cc(e.getUTCHours()%12||12,t.length)},H:function(e,t){return cc(e.getUTCHours(),t.length)},m:function(e,t){return cc(e.getUTCMinutes(),t.length)},s:function(e,t){return cc(e.getUTCSeconds(),t.length)},S:function(e,t){var n=t.length,r=e.getUTCMilliseconds();return cc(Math.floor(r*Math.pow(10,n-3)),t.length)}};function hc(e){zu(1,arguments);var t=1,n=qu(e),r=n.getUTCDay(),i=(r<t?7:0)+r-t;return n.setUTCDate(n.getUTCDate()-i),n.setUTCHours(0,0,0,0),n}function dc(e){zu(1,arguments);var t=qu(e),n=t.getUTCFullYear(),r=new Date(0);r.setUTCFullYear(n+1,0,4),r.setUTCHours(0,0,0,0);var i=hc(r),A=new Date(0);A.setUTCFullYear(n,0,4),A.setUTCHours(0,0,0,0);var o=hc(A);return t.getTime()>=i.getTime()?n+1:t.getTime()>=o.getTime()?n:n-1}function pc(e){zu(1,arguments);var t=dc(e),n=new Date(0);n.setUTCFullYear(t,0,4),n.setUTCHours(0,0,0,0);var r=hc(n);return r}function fc(e,t){zu(1,arguments);var n=t||{},r=n.locale,i=r&&r.options&&r.options.weekStartsOn,A=null==i?0:ac(i),o=null==n.weekStartsOn?A:ac(n.weekStartsOn);if(!(o>=0&&o<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");var a=qu(e),s=a.getUTCDay(),u=(s<o?7:0)+s-o;return a.setUTCDate(a.getUTCDate()-u),a.setUTCHours(0,0,0,0),a}function yc(e,t){zu(1,arguments);var n=qu(e,t),r=n.getUTCFullYear(),i=t||{},A=i.locale,o=A&&A.options&&A.options.firstWeekContainsDate,a=null==o?1:ac(o),s=null==i.firstWeekContainsDate?a:ac(i.firstWeekContainsDate);if(!(s>=1&&s<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var u=new Date(0);u.setUTCFullYear(r+1,0,s),u.setUTCHours(0,0,0,0);var c=fc(u,t),l=new Date(0);l.setUTCFullYear(r,0,s),l.setUTCHours(0,0,0,0);var h=fc(l,t);return n.getTime()>=c.getTime()?r+1:n.getTime()>=h.getTime()?r:r-1}function gc(e,t){zu(1,arguments);var n=t||{},r=n.locale,i=r&&r.options&&r.options.firstWeekContainsDate,A=null==i?1:ac(i),o=null==n.firstWeekContainsDate?A:ac(n.firstWeekContainsDate),a=yc(e,t),s=new Date(0);s.setUTCFullYear(a,0,o),s.setUTCHours(0,0,0,0);var u=fc(s,t);return u}var Ec="midnight",mc="noon",Bc="morning",vc="afternoon",wc="evening",kc="night";function Cc(e,t){var n=e>0?"-":"+",r=Math.abs(e),i=Math.floor(r/60),A=r%60;if(0===A)return n+String(i);var o=t||"";return n+String(i)+o+cc(A,2)}function bc(e,t){return e%60==0?(e>0?"-":"+")+cc(Math.abs(e)/60,2):Sc(e,t)}function Sc(e,t){var n=t||"",r=e>0?"-":"+",i=Math.abs(e);return r+cc(Math.floor(i/60),2)+n+cc(i%60,2)}var Tc={G:function(e,t,n){var r=e.getUTCFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return n.era(r,{width:"abbreviated"});case"GGGGG":return n.era(r,{width:"narrow"});case"GGGG":default:return n.era(r,{width:"wide"})}},y:function(e,t,n){if("yo"===t){var r=e.getUTCFullYear(),i=r>0?r:1-r;return n.ordinalNumber(i,{unit:"year"})}return lc.y(e,t)},Y:function(e,t,n,r){var i=yc(e,r),A=i>0?i:1-i;return"YY"===t?cc(A%100,2):"Yo"===t?n.ordinalNumber(A,{unit:"year"}):cc(A,t.length)},R:function(e,t){return cc(dc(e),t.length)},u:function(e,t){return cc(e.getUTCFullYear(),t.length)},Q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"Q":return String(r);case"QQ":return cc(r,2);case"Qo":return n.ordinalNumber(r,{unit:"quarter"});case"QQQ":return n.quarter(r,{width:"abbreviated",context:"formatting"});case"QQQQQ":return n.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return n.quarter(r,{width:"wide",context:"formatting"})}},q:function(e,t,n){var r=Math.ceil((e.getUTCMonth()+1)/3);switch(t){case"q":return String(r);case"qq":return cc(r,2);case"qo":return n.ordinalNumber(r,{unit:"quarter"});case"qqq":return n.quarter(r,{width:"abbreviated",context:"standalone"});case"qqqqq":return n.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return n.quarter(r,{width:"wide",context:"standalone"})}},M:function(e,t,n){var r=e.getUTCMonth();switch(t){case"M":case"MM":return lc.M(e,t);case"Mo":return n.ordinalNumber(r+1,{unit:"month"});case"MMM":return n.month(r,{width:"abbreviated",context:"formatting"});case"MMMMM":return n.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return n.month(r,{width:"wide",context:"formatting"})}},L:function(e,t,n){var r=e.getUTCMonth();switch(t){case"L":return String(r+1);case"LL":return cc(r+1,2);case"Lo":return n.ordinalNumber(r+1,{unit:"month"});case"LLL":return n.month(r,{width:"abbreviated",context:"standalone"});case"LLLLL":return n.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return n.month(r,{width:"wide",context:"standalone"})}},w:function(e,t,n,r){var i=function(e,t){zu(1,arguments);var n=qu(e),r=fc(n,t).getTime()-gc(n,t).getTime();return Math.round(r/6048e5)+1}(e,r);return"wo"===t?n.ordinalNumber(i,{unit:"week"}):cc(i,t.length)},I:function(e,t,n){var r=function(e){zu(1,arguments);var t=qu(e),n=hc(t).getTime()-pc(t).getTime();return Math.round(n/6048e5)+1}(e);return"Io"===t?n.ordinalNumber(r,{unit:"week"}):cc(r,t.length)},d:function(e,t,n){return"do"===t?n.ordinalNumber(e.getUTCDate(),{unit:"date"}):lc.d(e,t)},D:function(e,t,n){var r=function(e){zu(1,arguments);var t=qu(e),n=t.getTime();t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0);var r=t.getTime(),i=n-r;return Math.floor(i/864e5)+1}(e);return"Do"===t?n.ordinalNumber(r,{unit:"dayOfYear"}):cc(r,t.length)},E:function(e,t,n){var r=e.getUTCDay();switch(t){case"E":case"EE":case"EEE":return n.day(r,{width:"abbreviated",context:"formatting"});case"EEEEE":return n.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return n.day(r,{width:"short",context:"formatting"});case"EEEE":default:return n.day(r,{width:"wide",context:"formatting"})}},e:function(e,t,n,r){var i=e.getUTCDay(),A=(i-r.weekStartsOn+8)%7||7;switch(t){case"e":return String(A);case"ee":return cc(A,2);case"eo":return n.ordinalNumber(A,{unit:"day"});case"eee":return n.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return n.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return n.day(i,{width:"short",context:"formatting"});case"eeee":default:return n.day(i,{width:"wide",context:"formatting"})}},c:function(e,t,n,r){var i=e.getUTCDay(),A=(i-r.weekStartsOn+8)%7||7;switch(t){case"c":return String(A);case"cc":return cc(A,t.length);case"co":return n.ordinalNumber(A,{unit:"day"});case"ccc":return n.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return n.day(i,{width:"narrow",context:"standalone"});case"cccccc":return n.day(i,{width:"short",context:"standalone"});case"cccc":default:return n.day(i,{width:"wide",context:"standalone"})}},i:function(e,t,n){var r=e.getUTCDay(),i=0===r?7:r;switch(t){case"i":return String(i);case"ii":return cc(i,t.length);case"io":return n.ordinalNumber(i,{unit:"day"});case"iii":return n.day(r,{width:"abbreviated",context:"formatting"});case"iiiii":return n.day(r,{width:"narrow",context:"formatting"});case"iiiiii":return n.day(r,{width:"short",context:"formatting"});case"iiii":default:return n.day(r,{width:"wide",context:"formatting"})}},a:function(e,t,n){var r=e.getUTCHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(e,t,n){var r,i=e.getUTCHours();switch(r=12===i?mc:0===i?Ec:i/12>=1?"pm":"am",t){case"b":case"bb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(e,t,n){var r,i=e.getUTCHours();switch(r=i>=17?wc:i>=12?vc:i>=4?Bc:kc,t){case"B":case"BB":case"BBB":return n.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return n.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return n.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(e,t,n){if("ho"===t){var r=e.getUTCHours()%12;return 0===r&&(r=12),n.ordinalNumber(r,{unit:"hour"})}return lc.h(e,t)},H:function(e,t,n){return"Ho"===t?n.ordinalNumber(e.getUTCHours(),{unit:"hour"}):lc.H(e,t)},K:function(e,t,n){var r=e.getUTCHours()%12;return"Ko"===t?n.ordinalNumber(r,{unit:"hour"}):cc(r,t.length)},k:function(e,t,n){var r=e.getUTCHours();return 0===r&&(r=24),"ko"===t?n.ordinalNumber(r,{unit:"hour"}):cc(r,t.length)},m:function(e,t,n){return"mo"===t?n.ordinalNumber(e.getUTCMinutes(),{unit:"minute"}):lc.m(e,t)},s:function(e,t,n){return"so"===t?n.ordinalNumber(e.getUTCSeconds(),{unit:"second"}):lc.s(e,t)},S:function(e,t){return lc.S(e,t)},X:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();if(0===i)return"Z";switch(t){case"X":return bc(i);case"XXXX":case"XX":return Sc(i);case"XXXXX":case"XXX":default:return Sc(i,":")}},x:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"x":return bc(i);case"xxxx":case"xx":return Sc(i);case"xxxxx":case"xxx":default:return Sc(i,":")}},O:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+Cc(i,":");case"OOOO":default:return"GMT"+Sc(i,":")}},z:function(e,t,n,r){var i=(r._originalDate||e).getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+Cc(i,":");case"zzzz":default:return"GMT"+Sc(i,":")}},t:function(e,t,n,r){var i=r._originalDate||e;return cc(Math.floor(i.getTime()/1e3),t.length)},T:function(e,t,n,r){return cc((r._originalDate||e).getTime(),t.length)}};function Mc(e,t){switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}}function xc(e,t){switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}}var Uc={p:xc,P:function(e,t){var n,r=e.match(/(P+)(p+)?/),i=r[1],A=r[2];if(!A)return Mc(e,t);switch(i){case"P":n=t.dateTime({width:"short"});break;case"PP":n=t.dateTime({width:"medium"});break;case"PPP":n=t.dateTime({width:"long"});break;case"PPPP":default:n=t.dateTime({width:"full"})}return n.replace("{{date}}",Mc(i,t)).replace("{{time}}",xc(A,t))}};function Qc(e){var t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),e.getTime()-t.getTime()}var Lc=["D","DD"],Fc=["YY","YYYY"];function Rc(e){return-1!==Lc.indexOf(e)}function Hc(e){return-1!==Fc.indexOf(e)}function _c(e,t,n){if("YYYY"===e)throw new RangeError("Use `yyyy` instead of `YYYY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://git.io/fxCyr"));if("YY"===e)throw new RangeError("Use `yy` instead of `YY` (in `".concat(t,"`) for formatting years to the input `").concat(n,"`; see: https://git.io/fxCyr"));if("D"===e)throw new RangeError("Use `d` instead of `D` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://git.io/fxCyr"));if("DD"===e)throw new RangeError("Use `dd` instead of `DD` (in `".concat(t,"`) for formatting days of the month to the input `").concat(n,"`; see: https://git.io/fxCyr"))}var Dc=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Oc=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Ic=/^'([^]*?)'?$/,Pc=/''/g,Nc=/[a-zA-Z]/;function Kc(e,t,n){zu(2,arguments);var r=String(t),i=n||{},A=i.locale||oc,o=A.options&&A.options.firstWeekContainsDate,a=null==o?1:ac(o),s=null==i.firstWeekContainsDate?a:ac(i.firstWeekContainsDate);if(!(s>=1&&s<=7))throw new RangeError("firstWeekContainsDate must be between 1 and 7 inclusively");var u=A.options&&A.options.weekStartsOn,c=null==u?0:ac(u),l=null==i.weekStartsOn?c:ac(i.weekStartsOn);if(!(l>=0&&l<=6))throw new RangeError("weekStartsOn must be between 0 and 6 inclusively");if(!A.localize)throw new RangeError("locale must contain localize property");if(!A.formatLong)throw new RangeError("locale must contain formatLong property");var h=qu(e);if(!Zu(h))throw new RangeError("Invalid time value");var d=Qc(h),p=uc(h,d),f={firstWeekContainsDate:s,weekStartsOn:l,locale:A,_originalDate:h},y=r.match(Oc).map((function(e){var t=e[0];return"p"===t||"P"===t?(0,Uc[t])(e,A.formatLong,f):e})).join("").match(Dc).map((function(n){if("''"===n)return"'";var r=n[0];if("'"===r)return Vc(n);var o=Tc[r];if(o)return!i.useAdditionalWeekYearTokens&&Hc(n)&&_c(n,t,e),!i.useAdditionalDayOfYearTokens&&Rc(n)&&_c(n,t,e),o(p,n,A.localize,f);if(r.match(Nc))throw new RangeError("Format string contains an unescaped latin alphabet character `"+r+"`");return n})).join("");return y}function Vc(e){return e.match(Ic)[1].replace(Pc,"'")}function Gc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var jc=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.options=n,this.filters=this.markupsExtension.cache.filters||this.getInitialFilters()}var t,n,r;return t=e,(n=[{key:"getInitialFilters",value:function(){return{createdByFilter:[],createdAtStartFilter:null,createdAtEndFilter:null,showPrivateFilter:!0,showPublishedFilter:!0,showArchivedFilter:!1,toggleMarkupViewFilter:!0}}},{key:"updateFilters",value:function(e){this.markupsExtension.cache.filters=this.filters=Object.assign({},this.filters,e),this.markupsExtension.loadLayers(),this.markupsExtension.markupsManager.dispatchEvent({type:A.FILTER_CHANGED,filters:this.filters})}},{key:"filterLayers",value:function(e,t){var n=this;return!t&&this.filters.hideAllMarkups?[]:e.filter((function(e){return n.filterByVersion(e)&&n.filterBySheet(e,t&&n.filters.toggleMarkupViewFilter)&&n.filterByDate(e)&&n.filterPrivate(e)&&n.filterPublished(e)&&n.filterArchived(e)&&n.filterCreator(e)&&n.filterDeleted(e)}))}},{key:"isDateInRange",value:function(e,t,n){return function(e,t){zu(2,arguments);var n=t||{},r=qu(e).getTime(),i=qu(n.start).getTime(),A=qu(n.end).getTime();if(!(i<=A))throw new RangeError("Invalid interval");return r>=i&&r<=A}(Kc(e,"MM/DD/YYYY"),{start:Kc(t,"MM/DD/YYYY"),end:Kc(n,"MM/DD/YYYY")})}},{key:"filterByDate",value:function(e){return!this.filters.createdAtStartFilter||!this.filters.createdAtEndFilter||this.isDateInRange(e.metadata.created_at,this.filters.createdAtStartFilter,this.filters.createdAtEndFilter)}},{key:"filterBySheet",value:function(e,t){if(t||!this.options.hasMultiSheet)return!0;var n=e.metadata.markup_metadata&&e.metadata.markup_metadata.sheetName;return!this.options.sheetName||!n||$t(this.options.sheetName,n)}},{key:"filterDeleted",value:function(e){return e.status!==_}},{key:"filterPrivate",value:function(e){return this.filters.showPrivateFilter||e.metadata.status!==P}},{key:"filterPublished",value:function(e){return this.filters.showPublishedFilter||e.metadata.status!==N}},{key:"filterArchived",value:function(e){return this.filters.showArchivedFilter||e.metadata.status!==G}},{key:"filterCreator",value:function(e){return!this.filters.createdByFilter||0===this.filters.createdByFilter.length||this.filters.createdByFilter.some((function(t){return e.metadata.created_by===t.value}))}},{key:"filterByVersion",value:function(e){var t=e.metadata.starting_version;return this.options.documentVersion>=t}},{key:"destroy",value:function(){this.filters=null,this.options=null}}])&&Gc(t.prototype,n),r&&Gc(t,r),e}();function Yc(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Wc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Xc=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Yc(this,e),this.options=t}var t,n,r;return t=e,(n=[{key:"canPublishMarkup",value:function(e){return!!(e&&e.guid&&!e.metadata.status!==N&&this.options.userId&&e.metadata.permitted_statuses&&-1!==e.metadata.permitted_statuses.indexOf(N))}},{key:"canArchiveMarkup",value:function(e){return!!(e&&e.guid&&!e.metadata.status!==G&&this.options.userId&&e.metadata.permitted_statuses&&-1!==e.metadata.permitted_statuses.indexOf(G))}},{key:"canEditMarkup",value:function(e){if(!e)return!0;if(!e.guid)return!1;var t=[P,N];return!(!this.options.userId||-1===t.indexOf(e.metadata.status))&&!(this.options.documentVersion<this.options.currentRawDocumentVersion)&&(this.options.isAdmin||this.options.userId===e.metadata.created_by)}},{key:"canDeleteMarkup",value:function(e){if(!e||!e.guid)return!1;var t=[I,P];return!(!this.options.userId||-1===t.indexOf(e.metadata.status))&&(this.options.isAdmin||this.options.userId===e.metadata.created_by)}},{key:"canEditMarkupAttachment",value:function(e,t){return!(!e||!e.guid)&&e.metadata.status!==V&&e.metadata.status!==G&&this.options.documentVersion===this.options.currentRawDocumentVersion&&!!this.options.userId&&(!!this.options.isAdmin||!t||t&&this.options.userId===t.attributes.created_by)}},{key:"canCreateMarkup",value:function(){return this.options.documentVersion===this.options.currentRawDocumentVersion}},{key:"destroy",value:function(){this.options=null}}])&&Wc(t.prototype,n),r&&Wc(t,r),e}();function Jc(e){return(Jc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function zc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qc(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Zc=Autodesk.Viewing.getGlobal(),$c=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.registerEventListeners()}var t,n,r;return t=e,r=[{key:"send",value:function(e,t){var n=Zc.webkit&&Zc.webkit.messageHandlers.callbackHandler,r=n?function(e,t){n.postMessage({command:e,data:t})}:null,i=Zc.JSINTERFACE,A="object"===Jc(t)?JSON.stringify(t):t;r?void 0!==A?r(e,A):r(e):i&&i[e]&&(void 0!==A?i[e](A):i[e]())}},{key:"correctPixelRatio",value:function(e){return Autodesk.Viewing.isAndroidDevice()&&(e.min.multiplyScalar(window.devicePixelRatio),e.max.multiplyScalar(window.devicePixelRatio)),e}}],(n=[{key:"registerEventListeners",value:function(){this.markupsExtension.markupsManager.addEventListener(A.LAYER_DESELECTED,this.onLayerDeselected),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DESELECTED,this.onMarkupDeselected),this.markupsExtension.markupsManager.addEventListener(A.LAYER_SELECTED_FROM_DIFFERENT_SHEET,this.onLayerSelectedDifferentSheet),this.markupsExtension.markupsManager.addEventListener(A.LAYER_EDITED_FROM_DIFFERENT_SHEET,this.onLayerEditDifferentSheet),this.markupsExtension.markupsManager.addEventListener(or.HISTORY_CHANGED_EVENT,this.onHistoryChanged),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_START,this.onMarkupSessionStart),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SESSION_END,this.onMarkupSessionEnd),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DRAWING_START,this.onMarkupDrawingStart),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DRAWING_END,this.onMarkupDrawingEnd),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DRAWING_CANCEL,this.onMarkupDrawingCancel),this.markupsExtension.markupsManager.addEventListener(A.LINK_SELECTED,this.onLinkSelected),this.markupsExtension.markupsManager.addEventListener(A.LINK_DESELECTED,this.onLinkDeselected),this.onLayerReadyToSaveChangedBinded=this.onLayerReadyToSaveChanged.bind(this),this.markupsExtension.markupsManager.addEventListener(A.LAYER_READY_TO_SAVE,this.onLayerReadyToSaveChangedBinded),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_VIEW_ENTERED,this.onMarkupViewEntered),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_VIEW_EXITED,this.onMarkupViewExited),this.markupsExtension.markupsManager.addEventListener(A.TEXT_EDITING_STARTED,this.onTextEditingStarted),this.markupsExtension.markupsManager.addEventListener(A.TEXT_EDITING_ENDED,this.onTextEditingEnded),this.updateContextualMenuBinded=this.updateContextualMenu.bind(this),this.hideContextualMenuBinded=this.hideContextualMenu.bind(this),this.updateContextualMenuDebouncedShort=dt.debounce(this.updateContextualMenuBinded,10),this.updateContextualMenuDebouncedLong=dt.debounce(this.updateContextualMenuBinded,200),this.markupsExtension.markupsManager.addEventListener(or.HISTORY_CHANGED_EVENT,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_SELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.LAYER_DIRTY,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.LAYER_SYNCED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.LAYER_SELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_EDIT_END,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_TOOL_ENABLED_CHANGED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.LAYER_DESELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_DESELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.addEventListener(A.MARKUP_EDIT_START,this.hideContextualMenuBinded),this.markupsExtension.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.updateContextualMenuDebouncedLong)}},{key:"unregisterEventListeners",value:function(){this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DESELECTED,this.onLayerDeselected),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DESELECTED,this.onMarkupDeselected),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_SELECTED_FROM_DIFFERENT_SHEET,this.onLayerSelectedDifferentSheet),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_EDITED_FROM_DIFFERENT_SHEET,this.onLayerEditDifferentSheet),this.markupsExtension.markupsManager.removeEventListener(or.HISTORY_CHANGED_EVENT,this.onHistoryChanged),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_START,this.onMarkupSessionStart),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SESSION_END,this.onMarkupSessionEnd),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DRAWING_START,this.onMarkupDrawingStart),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DRAWING_END,this.onMarkupDrawingEnd),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DRAWING_CANCEL,this.onMarkupDrawingCancel),this.markupsExtension.markupsManager.removeEventListener(A.LINK_SELECTED,this.onLinkSelected),this.markupsExtension.markupsManager.removeEventListener(A.LINK_DESELECTED,this.onLinkDeselected),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_READY_TO_SAVE,this.onLayerReadyToSaveChangedBinded),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_VIEW_ENTERED,this.onMarkupViewEntered),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_VIEW_EXITED,this.onMarkupViewExited),this.markupsExtension.markupsManager.removeEventListener(A.TEXT_EDITING_STARTED,this.onTextEditingStarted),this.markupsExtension.markupsManager.removeEventListener(A.TEXT_EDITING_ENDED,this.onTextEditingEnded),this.markupsExtension.markupsManager.removeEventListener(or.HISTORY_CHANGED_EVENT,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_SELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DIRTY,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_SYNCED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_SELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_EDIT_END,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_TOOL_ENABLED_CHANGED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.LAYER_DESELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_DESELECTED,this.updateContextualMenuDebouncedShort),this.markupsExtension.markupsManager.removeEventListener(A.MARKUP_EDIT_START,this.hideContextualMenuBinded),this.markupsExtension.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.updateContextualMenuDebouncedLong),this.updateContextualMenuDebouncedShort.cancel(),this.updateContextualMenuDebouncedLong.cancel()}},{key:"markupToolLoaded",value:function(){e.send("onMarkupToolLoaded")}},{key:"onMarkupSessionStart",value:function(){e.send("onMarkupSessionStart")}},{key:"onMarkupSessionEnd",value:function(){e.send("onMarkupSessionEnd")}},{key:"onMarkupDrawingStart",value:function(t){var n=t.markup;e.send("onMarkupDrawingStart",n.type)}},{key:"onMarkupDrawingEnd",value:function(t){var n=t.markup;e.send("onMarkupDrawingEnd",n.type)}},{key:"onMarkupDrawingCancel",value:function(t){var n=t.markup;e.send("onMarkupDrawingCancel",n.type)}},{key:"onLayerSelectedDifferentSheet",value:function(t){var n=t.layerGuid;e.send("onLayerSelectedDifferentSheet",n)}},{key:"onLayerEditDifferentSheet",value:function(t){var n=t.layerGuid;e.send("onLayerEditDifferentSheet",n)}},{key:"onLayerSelected",value:function(t){var n=t.layer,r=n.getGuid();if(r){var i={guid:r,boundingBox:e.correctPixelRatio(n.getClientBoundingBox(!0))};e.send("onLayerSelected",i)}}},{key:"onLayerDeselected",value:function(t){var n=t.layer.getGuid();n&&e.send("onLayerDeselected",n)}},{key:"onMarkupSelected",value:function(t){var n=t.markup,r={id:n.id,layerGuid:n.layer&&n.layer.getGuid()||"",type:n.type,style:n.editState.style,boundingBox:e.correctPixelRatio(n.getClientBoundingBox(!0,!0))};e.send("onMarkupSelected",r)}},{key:"onMarkupDeselected",value:function(t){var n=t.markup;e.send("onMarkupDeselected",n.id)}},{key:"onHistoryChanged",value:function(t){var n={enableUndo:t.hasUndo,enableRedo:t.hasRedo};e.send("onMarkupHistoryChanged",n)}},{key:"onLayerReadyToSaveChanged",value:function(t){var n=t.readyToSave;e.send("onLayerReadyToSaveChanged",n)}},{key:"postLayer",value:function(t,n,r){var i,A={metadata:t,resources:(i={},zc(i,ee,n[0]),zc(i,te,n[1]),i),requestId:r};e.send("onPostLayer",A)}},{key:"updateLayer",value:function(t,n,r,i){var A,o={originalGuid:t,metadata:n,resources:(A={},zc(A,ee,r[0]),zc(A,te,r[1]),A),requestId:i};e.send("onUpdateLayer",o)}},{key:"deleteLayer",value:function(t,n){var r={guid:t,requestId:n};e.send("onDeleteLayer",r)}},{key:"publishLayer",value:function(t,n){var r={guid:t,requestId:n};e.send("onPublishLayer",r)}},{key:"archiveLayer",value:function(t,n,r){var i={guid:t,closeVersion:n,requestId:r};e.send("onArchiveLayer",i)}},{key:"onLinkSelected",value:function(t){var n=t.link,r={type:n.type,layerGuid:n.layer.layerData.guid,boundingBox:n.getClientBoundingBox()};e.send("onLinkSelected",r)}},{key:"onLinkDeselected",value:function(t){var n=t.link,r={type:n.type,layerGuid:n.layer.layerData.guid};e.send("onLinkDeselected",r)}},{key:"updateContextualMenu",value:function(){if(!this.markupsExtension.markupsManager.getDuringCreationMarkup()){var e=this.markupsExtension.markupsManager.getSelectedMarkups()[0];if(e)return void this.onMarkupSelected({markup:e});if(!this.markupsExtension.markupsManager.isMarkupSessionOpen()){var t=this.markupsExtension.markupsManager.getSelectedLayer();if(t)return void this.onLayerSelected({layer:t})}}this.hideContextualMenu()}},{key:"hideContextualMenu",value:function(){e.send("onHideContextualMenu")}},{key:"onMarkupViewExited",value:function(){e.send("onMarkupViewExited")}},{key:"onMarkupViewEntered",value:function(){e.send("onMarkupViewEntered")}},{key:"onTextEditingStarted",value:function(){e.send("onTextEditingStarted")}},{key:"onTextEditingEnded",value:function(){e.send("onTextEditingEnded")}},{key:"destroy",value:function(){this.unregisterEventListeners(),this.iosSend=null,this.androidSend=null,this.send=null}}])&&qc(t.prototype,n),r&&qc(t,r),e}();function el(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var tl=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cache={},this.currentUrn="default"}var t,n,r;return t=e,(n=[{key:"setCurrentUrn",value:function(e){this.currentUrn=e,this.cache[e]=this.cache[e]||{}}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.currentUrn;this.cache[n][e]=t}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentUrn;delete this.cache[t][e]}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.currentUrn;return this.cache[t][e]}},{key:"getAsList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentUrn,n=[];return Object.keys(this.cache[t]).forEach((function(r){n.push(e.cache[t][r])})),n}},{key:"getCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentUrn;return this.cache[e]}},{key:"cleanCache",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentUrn;Object.keys(this.cache[t]).forEach((function(t){e.remove(t)}))}},{key:"length",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentUrn;return Object.keys(this.cache[e]).length}},{key:"isEmpty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.currentUrn;return 0===this.length(e)}}])&&el(t.prototype,n),r&&el(t,r),e}();function nl(e,t,n,r,i,A,o){try{var a=e[A](o),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,i)}function rl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var il=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.markupsExtension=t,this.options=n||{}}var t,n,r,i,A;return t=e,(n=[{key:"postLayer",value:(i=regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("postLayer"),e.abrupt("return",new Promise((function(e,t){})));case 2:case"end":return e.stop()}}),e)})),A=function(){var e=this,t=arguments;return new Promise((function(n,r){var A=i.apply(e,t);function o(e){nl(A,n,r,o,a,"next",e)}function a(e){nl(A,n,r,o,a,"throw",e)}o(void 0)}))},function(e,t){return A.apply(this,arguments)})},{key:"publishLayer",value:function(e){return console.log("publishLayer"),new Promise((function(e,t){}))}},{key:"archiveLayer",value:function(e,t){return console.log("archiveLayer"),new Promise((function(e,t){}))}},{key:"updateLayer",value:function(e,t){return console.log("updateLayer"),new Promise((function(e,t){}))}},{key:"deleteLayer",value:function(e){return console.log("deleteLayer"),new Promise((function(e,t){}))}},{key:"postDocumentAttachment",value:function(e,t){return console.log("postDocumentAttachment"),new Promise((function(e,t){}))}},{key:"deleteDocumentAttachment",value:function(e){return console.log("deleteDocumentAttachment"),new Promise((function(e,t){}))}},{key:"renameDocumentAttachment",value:function(e,t){return console.log("renameDocumentAttachment"),new Promise((function(e,t){}))}},{key:"requestMarkups",value:function(e,t,n,r){return console.log("requestMarkups"),new Promise((function(e,t){}))}},{key:"getAttachment",value:function(e,t,n){return console.log("getAttachment"),new Promise((function(e,t){}))}},{key:"cancelRequests",value:function(){console.log("cancelRequests")}}])&&rl(t.prototype,n),r&&rl(t,r),e}();function Al(e){return(Al="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ol(e,t,n,r,i,A,o){try{var a=e[A](o),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,i)}function al(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var A=e.apply(t,n);function o(e){ol(A,r,i,o,a,"next",e)}function a(e){ol(A,r,i,o,a,"throw",e)}o(void 0)}))}}function sl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ul(e,t){return(ul=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function cl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=hl(e);if(t){var i=hl(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return ll(this,n)}}function ll(e,t){return!t||"object"!==Al(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function hl(e){return(hl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var dl=n(45),pl=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ul(e,t)}(s,e);var t,n,r,i,A,o,a=cl(s);function s(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);(n=a.call(this,e,t)).issueType=n.ISSUES_TYPE.markup;var r=n.ENV_TABLE[t.env]||n.ENV_TABLE.Development;return n.ISSUE_SERVICE_URL=r.ISSUE_SERVICE,n.OBJECT_STORAGE_SERVICE_URL=r.OBJECT_STORAGE,n.maxPageLimit=200,n.xhrReq=[],n.signedS3Requests={},n.headers=[{name:"x-ads-acm-namespace",value:n.options.acmNamespace},{name:"x-ads-acm-check-groups",value:"true"}],n.options.acmScopes&&n.headers.push({name:"x-ads-acm-scopes",value:n.options.acmScopes}),n.flushSignedS3DownloadRequestsThrottled=dl((function(){n.flushSignedS3DownloadRequests()}),30),n}return t=s,(n=[{key:"checkValidation",value:function(){var e=this.getAccessToken();return this.valid=!!e&&!!this.options.issueProject&&!!this.issueType,this.valid}},{key:"wait",value:function(e){return new Promise((function(t){setTimeout(t,e)}))}},{key:"getSignedS3UploadUrl",value:function(e){var t=this;return new Promise((function(n,r){e+="/signeds3upload";var i=t.getAjaxCallback(n,r,!0),A=t.createRequest("GET",e,"application/vnd.api+json",i,!1,!1);A.responseType="json",t.injectHeaders(A,t.headers),A.send()}))}},{key:"getSignedS3DownloadUrl",value:function(e,t){var n=this;return new Promise((function(r,i){n.signedS3Requests[e]||(n.signedS3Requests[e]={}),n.signedS3Requests[e][t]={resolve:r,reject:i},25===Object.keys(n.signedS3Requests[e]).length?n.flushSignedS3DownloadRequests():n.flushSignedS3DownloadRequestsThrottled()}))}},{key:"flushSignedS3DownloadRequests",value:function(){var e=this;Object.keys(this.signedS3Requests).forEach((function(t){var n="".concat(e.OBJECT_STORAGE_SERVICE_URL,"buckets/").concat(t,"/objects/batchsigneds3download?useCdn=true"),r=e.signedS3Requests[t],i={onLoad:function(e){var t=e.currentTarget.response;200===e.currentTarget.status?Object.keys(t.results).forEach((function(e){var n=t.results[e];"complete"===n.status?r[e].resolve(n.url):r[e].reject(n)})):Object.keys(t.results).forEach((function(t){r[t].reject(e)}))}},A=e.createRequest("POST",n,"application/json",i,!1,!0);A.responseType="json",e.injectHeaders(A,e.headers);var o={requests:Object.keys(r).map((function(e){return{objectKey:e}}))},a=JSON.stringify(o);A.send(a)})),this.signedS3Requests={}}},{key:"completeUpload",value:function(e,t,n,r){e+="/signeds3upload";var i=this.getAjaxCallback(n,r,!0),A=this.createRequest("POST",e,"application/json",i,!1,!1);A.responseType="json",this.injectHeaders(A,this.headers),A.send(JSON.stringify({uploadKey:t}))}},{key:"sendWithRetry",value:(o=al(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0;case 1:if(!(r<5)){e.next=22;break}return e.prev=2,e.next=5,t.apply(this,n);case 5:return i=e.sent,e.abrupt("return",i);case 9:if(e.prev=9,e.t0=e.catch(2),console.error(e.t0),5!==r+1){e.next=16;break}throw e.t0;case 16:return console.warn("Request failed - Retrying..."),e.next=19,this.wait(500);case 19:r++,e.next=1;break;case 22:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(e,t){return o.apply(this,arguments)})},{key:"_requestMarkups",value:function(e,t,n,r){var i=this;return this.checkValidation()?(e||(e=this.maxPageLimit),t||(t=0),new Promise((function(A,o){if(!i.options.documentUrn)return o();var a=[i.ISSUE_SERVICE_URL,"containers/",i.options.issueProject,i.issueType.endpoint].join("");a=[a,"?page[limit]="+e+"&page[offset]="+t].join(""),i.options.documentUrn&&(a=[a,"&filter[target_urn]=",encodeURIComponent(i.options.documentUrn)].join("")),a=[a,"&include=attachments"].join(""),r&&(a=[a,"&filter[status]=",r].join("")),a=[a,"&sort=-created_at"].join("");var s=i.getAjaxCallback(A,o),u=i.createRequest("GET",a,"application/vnd.api+json",s,!1,!0);i.injectHeaders(u,n),u.send()}))):Promise.reject("Service is unavailable.")}},{key:"requestMarkups",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._requestMarkups,t)}},{key:"postMarkups",value:function(e,t){var n=this;return this.checkValidation()?new Promise((function(r,i){var A=[n.ISSUE_SERVICE_URL,"containers/",n.options.issueProject,n.issueType.endpoint].join(""),o=n.getAjaxCallback(r,i),a=n.createRequest("POST",A,"application/vnd.api+json",o,!1,!1);n.injectHeaders(a,t);var s={data:{type:n.issueType.value,attributes:e}};a.send(JSON.stringify(s))})).then(this.parseResponse):Promise.reject("Service is unavailable.")}},{key:"fetchOSSBucketForAttachment",value:function(e){var t=this;return new Promise((function(n,r){t.fetchLocationForNewOssAttachment([],{onLoad:function(t){var i=t.currentTarget;if(201===i.status||200===i.status){var A=JSON.parse(i.responseText);e.ossPath=A.data.attributes.urn,n()}else r("Failed fetching OSS Bucket")},onError:r,onTimeout:r})}))}},{key:"uploadAttachment",value:function(e){var t=this.extractOssBucketAndId(e.ossPath),n=t[0],r=t[1];return this.postAttachment(r,e.data,n)}},{key:"_postLayer",value:(A=al(regeneratorRuntime.mark((function e(t,n,r){var i,A,o,a,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=function(){if(0===n.length)return Promise.resolve();var e=n.map((function(e){return s.fetchOSSBucketForAttachment(e)}));return Promise.all(e)},A=function(){if(0===n.length)return Promise.resolve();var e=n.map((function(e){return s.uploadAttachment(e)}));return Promise.all(e)},o=function(){return n.forEach((function(e){t.resource_urns[e.type]=e.ossPath})),r?s.updateLayer(r,t):s.postMarkups(t,[])},e.next=5,i();case 5:return e.next=7,A();case 7:return e.next=9,o();case 9:return a=e.sent,e.abrupt("return",a);case 11:case"end":return e.stop()}}),e)}))),function(e,t,n){return A.apply(this,arguments)})},{key:"postLayer",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._postLayer,t)}},{key:"parseResponse",value:function(e){try{var t=JSON.parse(e).data;return Promise.resolve(t)}catch(e){return Promise.reject(e)}}},{key:"_publishLayer",value:function(e){var t=this;return this.checkValidation()?new Promise((function(n,r){var i=[t.ISSUE_SERVICE_URL,"containers/",t.options.issueProject,t.issueType.endpoint,"/",e].join(""),A=t.getAjaxCallback(n,r),o=t.createRequest("PATCH",i,"application/vnd.api+json",A,!1,!1),a={data:{type:t.issueType.value,id:e,attributes:{status:N}}};o.send(JSON.stringify(a))})).then(this.parseResponse):Promise.reject("Service is unavailable.")}},{key:"publishLayer",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._publishLayer,t)}},{key:"_archiveLayer",value:function(e,t){var n=this;return this.checkValidation()?new Promise((function(r,i){var A=[n.ISSUE_SERVICE_URL,"containers/",n.options.issueProject,n.issueType.endpoint,"/",e].join(""),o=n.getAjaxCallback(r,i),a=n.createRequest("PATCH",A,"application/vnd.api+json",o,!1,!1),s={data:{type:n.issueType.value,id:e,attributes:{close_version:t,status:G}}};a.send(JSON.stringify(s))})).then(this.parseResponse):Promise.reject("Service is unavailable.")}},{key:"archiveLayer",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._archiveLayer,t)}},{key:"fetchLocationForNewOssAttachment",value:function(e,t){if(!this.checkValidation())return Promise.reject("Service is unavailable.");var n=[this.ISSUE_SERVICE_URL,"containers/",this.options.issueProject,"/oss_objects"].join(""),r=this.createRequest("POST",n,"application/vnd.api+json",t,!1,!1);return this.injectHeaders(r,e),r.send(JSON.stringify({data:{type:"oss_objects"}})),null}},{key:"_getAttachment",value:function(e,t){var n=this;return this.checkValidation()?new Promise(function(){var r=al(regeneratorRuntime.mark((function r(i,A){var o,a,s,u,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=n.extractOssBucketAndId(e),s=!1,r.prev=2,r.next=5,n.getSignedS3DownloadUrl(o[0],o[1]);case 5:a=r.sent,s=!0,r.next=13;break;case 9:r.prev=9,r.t0=r.catch(2),console.warn("Fallback to direct OSS download.",r.t0),a=[n.OBJECT_STORAGE_SERVICE_URL,"buckets/",o[0],"/objects/",o[1]].join("");case 13:u=n.getAjaxCallback(i,A,t),c=n.createRequest("GET",a,null,u,s,!0),t&&(c.responseType="arraybuffer"),n.injectHeaders(c,n.headers),c.send();case 18:case"end":return r.stop()}}),r,null,[[2,9]])})));return function(e,t){return r.apply(this,arguments)}}()):Promise.reject("Service is unavailable.")}},{key:"getAttachment",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._getAttachment,t)}},{key:"postAttachment",value:(i=al(regeneratorRuntime.mark((function e(t,n,r){var i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkValidation()){e.next=2;break}return e.abrupt("return",Promise.reject("Service is unavailable."));case 2:return e.abrupt("return",new Promise(function(){var e=al(regeneratorRuntime.mark((function e(A,o){var a,s,u,c,l,h,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[i.OBJECT_STORAGE_SERVICE_URL,"buckets/",r,"/objects/",t].join(""),s=a,c=!1,e.prev=3,e.next=6,i.getSignedS3UploadUrl(s);case 6:l=e.sent,s=l.urls[0],u=l.uploadKey,c=!0,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),console.warn("Fallback to direct OSS upload.",e.t0);case 15:h={onLoad:function(e){var t=e.currentTarget;200===t.status||201===t.status?c?i.completeUpload(a,u,A,o):A():o("Failed uploading attachment")},onError:o,onTimeout:o},d=i.createRequest("PUT",s,"text/plain",h,c,!1),i.injectHeaders(d,i.headers),d.send(n);case 19:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"updateLayer",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return this.checkValidation()?new Promise((function(i,A){var o=[n.ISSUE_SERVICE_URL,"containers/",n.options.issueProject,n.issueType.endpoint,"/",e].join(""),a=n.getAjaxCallback(i,A),s=n.createRequest("PATCH",o,"application/vnd.api+json",a,!1,!1);n.injectHeaders(s,r);var u={data:{type:n.issueType.value,id:e,attributes:t||{}}};s.send(JSON.stringify(u))})).then(this.parseResponse):Promise.reject("Service is unavailable.")}},{key:"_deleteLayer",value:function(e){var t=this;return this.checkValidation()?new Promise((function(n,r){var i=[t.ISSUE_SERVICE_URL,"containers/",t.options.issueProject,t.ISSUES_TYPE.markup.endpoint+"/",e].join(""),A=t.getAjaxCallback(n,r);t.createRequest("DELETE",i,"application/vnd.api+json",A,!1,!1).send()})):Promise.reject("Service is unavailable")}},{key:"deleteLayer",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._deleteLayer,t)}},{key:"_postDocumentAttachment",value:function(e,t){var n=this;return this.checkValidation()?new Promise((function(r,i){var A=[n.ISSUE_SERVICE_URL,"containers/",n.options.issueProject,n.ATTACHMENT.endpoint].join(""),o=n.getAjaxCallback(r,i),a=n.createRequest("POST",A,"application/vnd.api+json",o,!1,!1);n.injectHeaders(a,t);var s={data:{type:n.ATTACHMENT.value,attributes:e.attributes}};a.send(JSON.stringify(s))})).then(this.parseResponse):Promise.reject("Service is unavailable.")}},{key:"postDocumentAttachment",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._postDocumentAttachment,t)}},{key:"_deleteDocumentAttachment",value:function(e){var t=this;return this.checkValidation()?new Promise((function(n,r){var i=[t.ISSUE_SERVICE_URL,"containers/",t.options.issueProject,t.ATTACHMENT.endpoint+"/",e].join(""),A=t.getAjaxCallback(n,r);t.createRequest("DELETE",i,"application/vnd.api+json",A,!1,!1).send()})):Promise.reject("Service is unavailable")}},{key:"deleteDocumentAttachment",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._deleteDocumentAttachment,t)}},{key:"_renameDocumentAttachment",value:function(e,t){var n=this;return this.checkValidation()?new Promise((function(r,i){var A=[n.ISSUE_SERVICE_URL,"containers/",n.options.issueProject,n.ATTACHMENT.endpoint+"/",e].join(""),o=n.getAjaxCallback(r,i),a=n.createRequest("PATCH",A,"application/vnd.api+json",o,!1,!1),s={data:{type:n.ATTACHMENT.value,id:e,attributes:{name:t}}};a.send(JSON.stringify(s))})).then(this.parseResponse):Promise.reject("Service is unavailable")}},{key:"renameDocumentAttachment",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendWithRetry(this._renameDocumentAttachment,t)}},{key:"extractOssBucketAndId",value:function(e){var t=e.split("/"),n=t[0].split(":");return t[0]=n[n.length-1],t}},{key:"cancelRequests",value:function(){for(var e=this.xhrReq.length-1;e>=0;e--)this.xhrReq[e]&&this.xhrReq[e].abort();this.xhrReq=[]}},{key:"removeXhr",value:function(e){var t=this.xhrReq.indexOf(e);t>-1&&this.xhrReq.splice(t,1)}},{key:"addXhr",value:function(e){this.xhrReq.push(e)}},{key:"getAccessToken",value:function(){var e;if(this.markupsExtension.options.getAccessToken)return this.markupsExtension.options.getAccessToken((function(t,n){e=t})),e}},{key:"getAjaxCallback",value:function(e,t,n){return{onLoad:function(r){201===r.currentTarget.status||200===r.currentTarget.status||204===r.currentTarget.status?e(n?r.currentTarget.response:r.currentTarget.responseText):t(r)},onError:t,onTimeout:t}}},{key:"createRequest",value:function(e,t,n,r,i,A){var o=this,a=new XMLHttpRequest;if(a.open(e,t,!0),n&&a.setRequestHeader("Content-Type",n),!i){var s=this.getAccessToken();a.setRequestHeader("Authorization","Bearer "+s)}return a.setRequestHeader("Access-Control-Allow-Origin","*"),a.onload=function(){o.removeXhr(a),r.onLoad.apply(r,arguments)},a.onerror=function(){o.removeXhr(a),r.onError.apply(r,arguments)},a.ontimeout=function(){o.removeXhr(a),r.onTimeout.apply(r,arguments)},a.onabort=function(){o.removeXhr(a)},A&&this.addXhr(a),a}},{key:"injectHeaders",value:function(e,t){t&&t.forEach((function(t){e.setRequestHeader(t.name,t.value)}))}},{key:"ENV_TABLE",get:function(){return{Local:{ISSUE_SERVICE:"https://developer-dev.api.autodesk.com/issues-dev/v1/",OBJECT_STORAGE:"https://developer-dev.api.autodesk.com/oss/v2/"},Development:{ISSUE_SERVICE:"https://developer-stg.api.autodesk.com/issues-dev/v1/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v2/"},Qa:{ISSUE_SERVICE:"https://developer-stg.api.autodesk.com/issues-qa/v1/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v2/"},Staging:{ISSUE_SERVICE:"https://developer-stg.api.autodesk.com/issues-stg/v1/",OBJECT_STORAGE:"https://developer-stg.api.autodesk.com/oss/v2/"},Production:{ISSUE_SERVICE:"https://developer.api.autodesk.com/issues/v1/",OBJECT_STORAGE:"https://developer.api.autodesk.com/oss/v2/"}}}},{key:"ISSUES_TYPE",get:function(){return{issue:{value:"issues",endpoint:"/issues"},markup:{value:"markups",endpoint:"/markups"},area_markup:{value:"areas",endpoint:"/areas"},area_status:{value:"area_statuses",endpoint:"/area-statuses"}}}},{key:"ATTACHMENT",get:function(){return{value:"attachments",endpoint:"/attachments"}}}])&&sl(t.prototype,n),r&&sl(t,r),s}(il),fl=n(16);function yl(e){return(yl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function gl(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function El(e,t){return(El=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ml(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=vl(e);if(t){var i=vl(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Bl(this,n)}}function Bl(e,t){return!t||"object"!==yl(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function vl(e){return(vl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var wl=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&El(e,t)}(A,e);var t,n,r,i=ml(A);function A(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A),(n=i.call(this,e,t)).pendingRequests={},n}return t=A,(n=[{key:"requestMarkups",value:function(){return this.markupsExtension.mobileCallbacks.markupToolLoaded(),new Promise((function(e,t){}))}},{key:"postLayer",value:function(e,t,n){var r=Object(fl.v4)();return n?this.markupsExtension.mobileCallbacks.updateLayer(n,e,t,r):this.markupsExtension.mobileCallbacks.postLayer(e,t,r),this.returnDelayedPromise(r)}},{key:"updateLayer",value:function(e,t){var n=Object(fl.v4)();return this.markupsExtension.mobileCallbacks.updateLayer(e,t),this.returnDelayedPromise(n)}},{key:"deleteLayer",value:function(e){var t=Object(fl.v4)();return this.markupsExtension.mobileCallbacks.deleteLayer(e,t),this.returnDelayedPromise(t)}},{key:"publishLayer",value:function(e){var t=Object(fl.v4)();return this.markupsExtension.mobileCallbacks.publishLayer(e,t),this.returnDelayedPromise(t)}},{key:"archiveLayer",value:function(e,t){var n=Object(fl.v4)();return this.markupsExtension.mobileCallbacks.archiveLayer(e,t,n),this.returnDelayedPromise(n)}},{key:"postDocumentAttachment",value:function(e,t){var n=Object(fl.v4)();return this.returnDelayedPromise(n)}},{key:"deleteDocumentAttachment",value:function(e){var t=Object(fl.v4)();return this.returnDelayedPromise(t)}},{key:"renameDocumentAttachment",value:function(e,t){var n=Object(fl.v4)();return this.returnDelayedPromise(n)}},{key:"cancelRequests",value:function(){var e=this;Object.keys(this.pendingRequests).forEach((function(t){e.pendingRequests[t].reject(),delete e.pendingRequests[t]}))}},{key:"returnDelayedPromise",value:function(e){var t={},n=new Promise((function(e,n){t.resolve=e,t.reject=n}));return this.pendingRequests[e]=t,n}},{key:"onRequestCompleted",value:function(e,t,n){this.pendingRequests[n]&&(t?this.pendingRequests[n].resolve(e):this.pendingRequests[n].reject(),delete this.pendingRequests[n])}}])&&gl(t.prototype,n),r&&gl(t,r),A}(il);function kl(e){return(kl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Cl=function(e,t){delete e.scale,delete e.translation,t&&(delete e.style,delete e.position,delete e.size,delete e.rotation)},bl=function(e,t){var n,r;if(t.model.isPdf(!0))Autodesk.Viewing.PDFUtils.pdfToLeafletWorld(t,e),n=Autodesk.Viewing.PDFUtils.getLeafletLoadOptions(t),r=Autodesk.Viewing.PDFUtils.getLeafletBoundingBox(t);else{var i=t.model.getData();n=i.loadOptions.loadOptions,r=i.bbox}var A=n,o=A.texWidth,a=A.texHeight,s=e,u=new THREE.Vector3(r.min.x,r.max.y,0);return s.sub(u),e.x=s.x*o/r.size().x,e.y=s.y*a/r.size().y,e},Sl=function(e,t){var n=bl(new THREE.Vector3,t),r=bl(new THREE.Vector3(e,0,0),t);return n.distanceTo(r)},Tl=function(e,t){return t.createElementNS("http://www.w3.org/2000/svg",e)},Ml=function(e,t,n){var r=t.getDocument(),i=Tl("svg",r);!function(e,t,n){var r=n.createElementNS("http://www.w3.org/2000/svg","metadata"),i=n.createElement("markup_document");r.appendChild(i),i.setAttribute("data-model-version",t["data-model-version"]),e.insertBefore(r,e.firstChild)}(i,{"data-model-version":"5"},r);var A=Pt(e.markups),o=t.impl.is2d?null:t.getState(),s=t.model.isLeaflet(),u=t.model.isPdf(!0);return A.forEach((function(A){var o=dt.cloneDeep(A.getState());if(t.impl.is2d||fu(t,e.layerData,!0),o.anchors.forEach((function(e){A.applyScaleAndTranslation(e),(s||u)&&e.copy(bl(e,t))})),A.type!==g&&A.type!==x&&!A.isGroupMarkup()){var l;A.type===S?(o.isFrameUsed=o.isFrameUsed?1:0,l=A.getWorldBoundingBoxTextOnly()):l=A.getWorldBoundingBox();var h=l.size(),d=l.center();(s||u)&&(d.copy(bl(d,t)),h.x=Sl(h.x,t),h.y=Sl(h.y,t)),o.size="".concat(h.x," ").concat(h.y),o.position="".concat(d.x," ").concat(d.y),Kt(o.anchors,d.clone().negate())}A.type===x&&((s||u)&&o.translation.copy(bl(o.translation,t).sub(bl(new THREE.Vector3,t))),o.offset="".concat(o.translation.x," ").concat(o.translation.y," ").concat(o.translation.z),o.style[c.FONT_SIZE]*=je,o.style[c.THICKNESS]*=Ge),(s||u)&&(o.style[c.THICKNESS]=Sl(o.style[c.THICKNESS],t),o.style[c.FONT_SIZE]=Sl(o.style[c.FONT_SIZE],t),o.style[c.FONT_SIZE]*=n.getFontToWorldScale()),o.type=A.type,(o.style[c.FILL_COLOR]===a.NO_COLOR||A.options.fillNotAllowed)&&(o.style[c.FILL_OPACITY]=0,o.style[c.FILL_COLOR]=a.NO_COLOR),Cl(o,A.isGroupMarkup()),function(e){var t={};switch(e.type){case E:case B:case m:break;case g:case U:t.tail=e.anchors[0],t.head=e.anchors[1];break;case x:t.firstAnchor=e.anchors[0],t.secondAnchor=e.anchors[1];break;case w:case v:case C:case k:t.locations=e.anchors}e.anchors=t}(o);var p=function(e){var t={};return Object.keys(e).forEach((function(n){"object"!==kl(e[n])||Array.isArray(e[n])?t[n]=e[n]:Object.keys(e[n]).forEach((function(r){t[r]=e[n][r]}))})),t}(o);!function(e){Object.keys(e).forEach((function(t){if(Array.isArray(e[t])){var n=e[t],r=[];n.forEach((function(e){r.push(e.x),r.push(e.y)})),e[t]=r.join(" ")}else if("object"===kl(e[t])){var i=e[t],A=[];A.push(i.x),A.push(i.y),e[t]=A.join(" ")}}))}(p);var f=function(e,t){var n=Tl("g",t);n.setAttribute("cursor","inherit"),n.setAttribute("pointer-events","none");var r=Tl("path",t);return r.setAttribute("id","markup"),e?r.setAttribute("d","M 0 0 z"):r.setAttribute("d","M 0 0"),n.appendChild(r),n}(p.closed,r);!function(e,t,n){var r=n.createElementNS("http://www.w3.org/2000/svg","metadata"),i=n.createElement("markup_element");r.appendChild(i),Object.keys(t).forEach((function(e){i.setAttribute(e,t[e])})),e.insertBefore(r,e.firstChild)}(f,p,r),i.appendChild(f)})),o&&t.restoreState(o,null,!0),function(e){var t="";try{t=(new XMLSerializer).serializeToString(e)}catch(e){console.error("svgNodeToString failed to generate string representation of domNode.")}return t}(i)};function xl(e){return function(e){if(Array.isArray(e))return Ul(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Ul(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ul(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ul(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ql(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ll=At,Fl=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,(n=[{key:"reset",value:function(e){this.markupsExtension=e,this.markupsManager=e.markupsManager,this.markupsCache=e.markupsCache,this.viewer=e.viewer,this.options=this.markupsExtension.options,this.savingCounter=0;var t=e.options.isMobileApp,n=this.options.serviceClass||pl;this.service=t?new wl(this.markupsExtension,this.options):new n(this.markupsExtension,this.options),this.errorHandler=this.options.errorHandler||function(){},this.onSessionEndedBinded=this.onSessionEnded.bind(this),this.markupsManager.addEventListener(A.MARKUP_SESSION_END,this.onSessionEndedBinded),this.onLayerDeletedBinded=this.onLayerDeleted.bind(this),this.markupsManager.addEventListener(A.LAYER_DELETE,this.onLayerDeletedBinded),this.onDocumentAttachmentCreationStartBinded=this.onDocumentAttachmentCreationStart.bind(this),this.markupsManager.addEventListener(A.DOCUMENT_ATTACHMENT_CREATION_START,this.onDocumentAttachmentCreationStartBinded),this.renameDocumentAttachmentBinded=this.renameDocumentAttachment.bind(this),this.markupsManager.addEventListener(A.DOCUMENT_ATTACHMENT_RENAME,this.renameDocumentAttachmentBinded),this.deleteDocumentAttachmentBinded=this.deleteDocumentAttachment.bind(this),this.markupsManager.addEventListener(A.DOCUMENT_ATTACHMENT_DELETE,this.deleteDocumentAttachmentBinded),this.onPublishLayerBinded=this.onPublishLayer.bind(this),this.markupsManager.addEventListener(A.LAYER_PUBLISH,this.onPublishLayerBinded),this.onArchiveLayerBinded=this.onArchiveLayer.bind(this),this.markupsManager.addEventListener(A.LAYER_ARCHIVE,this.onArchiveLayerBinded)}},{key:"onSessionEnded",value:function(e){var t=e.layer;e.save&&!t.isEmpty()&&this.saveLayer(t)}},{key:"onLayerDeleted",value:function(e){var t=e.layerData;t&&this.deleteLayer(t)}},{key:"onPublishLayer",value:function(e){var t=e.layerData;t&&this.publishLayer(t)}},{key:"onArchiveLayer",value:function(e){var t=e.layerData;t&&this.archiveLayer(t)}},{key:"fetchMarkups",value:function(){var e=this,t=this.options.documentUrn;this.numOfMarkupsLoaded=0;var n=this.getMaxPageLimit(),r=0,i={layersData:[],relatedResources:[]},A=ne;(function t(){return e.requestMarkups(i,n,r,A).then((function(e){if(e&&e.nextReq)return r+=n,t()})).catch((function(e){console.warn("requestMarkups failed or canceled.")}))})().then((function(){return e.getMetadata(i,t)})).catch((function(e){return e}))}},{key:"requestMarkups",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:ne;return this.service.requestMarkups(t,n,null,r).then((function(t){try{var n,r=JSON.parse(t);(n=e.layersData).push.apply(n,xl(r.data));var i,A=r.included;return A&&Array.isArray(A)&&(i=e.relatedResources).push.apply(i,xl(A)),Promise.resolve({nextReq:r.links.next})}catch(e){return Promise.reject(e)}}),(function(){return Promise.reject()}))}},{key:"getMetadata",value:function(e,t){var n=this,r=e.relatedResources,i=e.layersData;return(i=dt.remove(i,(function(e){return $t(e.attributes.markup_metadata.sheetName,n.options.sheetName)})).concat(i)).forEach((function(e){var r=e.attributes;if(r.markup_metadata){var i=r.starting_version;if(!(n.options.documentVersion<i)){r.tags=r.tags||{};var o=function(e){return"true"===e||!0===e||1===e}(r.tags.resourceEmbed),a=n.markupsCache.get(e.id),s=a||new Fs;if(!a){s.guid=e.id,s.status=I,s.metadata=r,r.close_version>0&&(s.status=V);var u=r.resource_urns;if(u){var c=n.createEmptyResourceObject(ee,o,u);c&&s.resources.push(c);var l=n.createEmptyResourceObject(te,o,u);l&&s.resources.push(l)}n.markupsCache.add(s.guid,s,t)}n.notify({type:A.LAYER_FETCHED,layerData:s}),n.getAttachment(s)}}})),this.fetchedAllMarkups||this.numOfMarkupsLoaded!==this.markupsCache.length()||(this.fetchedAllMarkups=!0,this.notify({type:A.ALL_MARKUPS_LOADED,amount:this.numOfMarkupsLoaded})),this.getUserProfiles(),this.getProjectUsers(),this.getRevisions(),this.getAttachedDocumentData(r),this.notify({type:A.LAYER_METADATA_FETCHED}),Promise.resolve()}},{key:"notify",value:function(e){if(this.markupsManager)try{this.markupsManager.dispatchEvent(e)}catch(e){console.warn(e)}}},{key:"getAttachment",value:function(e){var t=this,n=e.resources.map((function(n){var r=null;if(n.data)return r={layerData:e,resourceType:n.type},t.onGetAttachment(r),Promise.resolve(r);var i=$===Z;return t.service.getAttachment(n.ossPath,i).then((function(i){return i?(n.data=i,r={layerData:e,resourceType:n.type},t.onGetAttachment(r),Promise.resolve(r)):Promise.resolve(null)})).catch((function(e){}))}));return Promise.all(n)}},{key:"onGetAttachment",value:function(e){var t=e.layerData,n=e.resourceType;n===ee&&(this.numOfMarkupsLoaded+=1,this.notify({type:A.LAYER_RESOURCE_FETCHED,layerData:t}),this.fetchedAllMarkups||this.numOfMarkupsLoaded!==this.markupsCache.length()||(this.fetchedAllMarkups=!0,this.notify({type:A.ALL_MARKUPS_LOADED,amount:this.numOfMarkupsLoaded}))),n===te&&this.notify({type:A.LAYER_THUMBNAIL_FETCHED,layerData:t})}},{key:"createEmptyResourceObject",value:function(e,t,n){if(n[e]){var r={type:e,data:null,id:null,ossPath:null};return t?r.data=n[e]:r.ossPath=n[e],r}return null}},{key:"getAttachedDocumentData",value:function(e){var t=this;if(e&&Array.isArray(e)&&0!==e.length&&this.options.getAttachedDocumentCallback){var n=this.markupsCache.getAsList(),r=e.filter((function(e){return n.some((function(t){return e.attributes&&e.type===re&&t.guid===e.attributes.issue_id}))}));r.length>0&&this.options.getAttachedDocumentCallback(r,(function(e){n.forEach((function(n){var r;e&&((r=n.attachments).push.apply(r,xl(e.filter((function(e){return e.attributes.issue_id===n.guid&&-1===n.attachments.findIndex((function(t){return t.id===e.id}))})))),n.attachments.forEach((function(e){t.notify({type:A.LINK_SYNCED,layerData:n,documentAttachment:e})})))}))}))}}},{key:"getUserProfiles",value:function(){var e=this;this.options.getUserProfileCallback&&Ot(this.markupsCache.getCache(),(function(t){var n=t.metadata.created_by;n&&!t.userName&&e.options.getUserProfileCallback(n,(function(n){n&&n.name&&(t.userName=n.name,e.notify({type:A.LAYER_METADATA_FETCHED}))}))}))}},{key:"getProjectUsers",value:function(){var e=this;this.options.getProjectUsersCallback&&(0,this.options.getProjectUsersCallback)((function(t){e.notify({type:A.PROJECT_USERS_FETCHED,users:t})}))}},{key:"getRevisions",value:function(){var e=this;this.options.getRevisionCallback&&this.options.getRevisionCallback(this.options.documentUrn,(function(t){Ot(e.markupsCache.getCache(),(function(e){if(e&&e.metadata){var n=e.metadata.starting_version;e.metadata.tags.starting_revision=t[n]}})),e.notify({type:A.LAYER_METADATA_FETCHED})}))}},{key:"generateMarkupDescription",value:function(e){var t=[];return e.getAllMarkups().forEach((function(e){e.type!==b&&e.type!==S||t.push(e.state.text)})),t.join(".\n")}},{key:"generateMetadata",value:function(e,t){var n=this,r={};r.target_urn=this.options.documentUrn,r.starting_version=this.options.documentVersion,r.resource_urns={};var i=this.viewer.getState(),A=this.viewer.model?this.viewer.model.getData().globalOffset:null;if(r.markup_metadata=function(e,t,n){var r=JSON.parse(JSON.stringify(e));return t&&du(r.viewport,t),r.sheetGUID=n.sheetGUID,r.sheetName=n.sheetName,r}(i,A,this.options),r.markup_metadata.links=Pt(t.links).map((function(e){var t=e.state.position&&e.state.position.clone();return t&&n.markupsExtension.viewer.model.isPdf(!0)&&Autodesk.Viewing.PDFUtils.pdfToLeafletWorld(n.markupsExtension.viewer,t),{id:e.guid,type:e.type,position:t}})),r.description=this.generateMarkupDescription(t),r.tags={starting_revision:this.options.documentRevision||this.options.documentVersion},this.options.collectionUrn&&(r.collection_urn=this.options.collectionUrn),this.options.userName&&(r.tags.userName=this.options.userName),r.status=e,this.viewer.model.isLeaflet()){var o=this.viewer.model.getData().loadOptions.loadOptions;r.markup_metadata.originalDocumentResolution=[o.texWidth,o.texHeight]}return r}},{key:"saveLayer",value:function(e){var t,n=this,r=this.options.documentUrn,i=!e.layerData,o="".concat(e.id,"_tmp"),a=i?new Fs:e.layerData,s=this.generateMetadata(i?this.markupsExtension.getCreationStatusType():a.metadata.status,e),u=[{type:ee,data:Ml(e,this.markupsExtension.viewer,this.markupsExtension.renderer),id:null,ossPath:null},{type:te,data:null,id:null,ossPath:null}];a.status=R,a.originalCreationTime=i?(new Date).toISOString():s.created_at,e.layerData=a,i&&((t=dt.cloneDeep(a)).metadata=s,t.resources=u,this.markupsCache.add(o,t,r)),this.notify({type:A.LAYER_SYNCING,layerData:a,layer:e}),this.savingCounter++,this.markupsManager.generateScreenCapture(e).then((function(t){u[1].data=t,i||(a.resources=u),n.notify({type:A.LAYER_SYNCING,layerData:a,layer:e}),n.service.postLayer(s,u,i?void 0:e.getGuid()).then((function(e){var t=e.id;a.guid=t,a.metadata=e.attributes,a.resources=u,a.attachments=a.attachments||[],a.status=F,n.markupsCache.add(t,a,r),a.userName=a.metadata.tags.userName})).catch((function(t){i?e.layerData=null:a.status=L,n.errorHandler(Autodesk.Viewing.i18n.translate("Failed to save markup"),Ll.MARKUP_SAVE_FAILED,t),console.error("Failed to save markup",a,t)})).finally((function(){n.markupsCache.remove(o,r),n.notify({type:A.LAYER_SYNCED,layerData:a,layer:e}),n.savingCounter--}))})).catch((function(){n.savingCounter--}))}},{key:"onDocumentAttachmentCreationStart",value:function(e){var t=this,n=e.documentAttachments,r=e.layerData;if(0!==n.length)if(n.length>1)console.error("Dont save multiple attachments at a time.");else{n.forEach((function(e){e.attributes.issue_id=r.guid,e.attributes.attachment_type=ie}));var i=n[0];this.notify({type:A.LINK_SYNCING,documentAttachment:i,layerData:r}),this.service.postDocumentAttachment(i).then((function(e){e&&e.attributes&&e.attributes.issue_id&&(i.attributes=e.attributes,i.id=e.id,r.attachments.splice(0,0,i),t.markupsManager.createLinkMetadata(r)),t.notify({type:A.LINK_SYNCED,documentAttachment:i,layerData:r})})).catch((function(e){t.notify({type:A.LINK_SYNCED,documentAttachment:i,layerData:r}),t.errorHandler(Autodesk.Viewing.i18n.translate("Failed to create markup attachment"),Ll.MARKUP_ATTACHMENT_CREATE_FAILED,e),console.error("Failed to create markup attachment",e)}))}}},{key:"deleteDocumentAttachment",value:function(e){var t=this,n=e.documentAttachment,r=e.layerData;n.status=q,this.notify({type:A.LINK_SYNCING,documentAttachment:n,layerData:r}),this.service.deleteDocumentAttachment(n.id).then((function(){var e=r.attachments,i=e.indexOf(n);i>-1&&e.splice(i,1),t.notify({type:A.LINK_SYNCED,documentAttachment:n,layerData:r})})).catch((function(e){t.errorHandler(Autodesk.Viewing.i18n.translate("Failed to delete markup attachment"),Ll.MARKUP_ATTACHMENT_DELETE_FAILED,e),t.notify({type:A.LINK_SYNCED,documentAttachment:n,layerData:r})}))}},{key:"renameDocumentAttachment",value:function(e){var t=this,n=e.documentAttachment,r=e.newName,i=e.layerData;n.status=z,n.tmpName=r,this.notify({type:A.LINK_SYNCING,documentAttachment:n,layerData:i}),this.service.renameDocumentAttachment(n.id,r).then((function(e){n.attributes=e.attributes,n.status=void 0,n.tmpName=void 0,t.notify({type:A.LINK_SYNCED,documentAttachment:n,layerData:i})})).catch((function(e){n.status=void 0,n.tmpName=void 0,t.errorHandler(Autodesk.Viewing.i18n.translate("Failed to rename markup attachment"),Ll.MARKUP_ATTACHMENT_RENAME_FAILED,e),t.notify({type:A.LINK_SYNCED,documentAttachment:n,layerData:i})}))}},{key:"updateLinkPosition",value:function(e,t,n){var r=this,i=n.clone();this.markupsExtension.viewer.model.isPdf(!0)&&Autodesk.Viewing.PDFUtils.pdfToLeafletWorld(this.markupsExtension.viewer,i);var A={markup_metadata:{links:[{id:t,position:i}]}};return this.service.updateLayer(e,A).then((function(e){return Promise.resolve(e)}),(function(e){return r.errorHandler(Autodesk.Viewing.i18n.translate("Failed to update markup attachment"),Ll.MARKUP_ATTACHMENT_UPDATE_FAILED,e),Promise.reject("Failed to change the link position: "+t)}))}},{key:"deleteLayer",value:function(e){var t=this;e.guid||(e=this.markupsCache.get(e)),e.status=H,this.notify({type:A.LAYER_SYNCING,layerData:e});var n=this.options.documentUrn;return this.service.deleteLayer(e.guid).then((function(r){return t.markupsCache.remove(e.guid,n),e.status=_,t.notify({type:A.LAYER_SYNCED,layerData:e}),Promise.resolve(!0)}),(function(n){return e.status=D,t.notify({type:A.LAYER_SYNCED,layerData:e}),t.errorHandler(Autodesk.Viewing.i18n.translate("Failed to delete markup"),Ll.MARKUP_DELETE_FAILED,n),Promise.reject("Failed to delete markup: "+e.guid)}))}},{key:"deleteAllLayers",value:function(){var e=this;this.markupsCache.getAsList().forEach((function(t){e.deleteLayer(t)}))}},{key:"publishLayer",value:function(e){var t=this;e.guid||(e=this.markupsCache.get(e));var n=e.status;e.status=K,this.notify({type:A.LAYER_SYNCING,layerData:e}),this.service.publishLayer(e.guid).then((function(r){return e.status=n,e.metadata=r.attributes,t.notify({type:A.LAYER_SYNCED,layerData:e}),Promise.resolve()})).catch((function(r){e.status=n,t.errorHandler(Autodesk.Viewing.i18n.translate("Failed to publish markup"),Ll.MARKUP_PUBLISH_FAILED,r),t.notify({type:A.LAYER_SYNCED,layerData:e})}))}},{key:"archiveLayer",value:function(e){var t=this;e.guid||(e=this.markupsCache.get(e));var n=e.status;e.status=j,this.notify({type:A.LAYER_SYNCING,layerData:e}),this.service.archiveLayer(e.guid,this.options.currentRawDocumentVersion).then((function(r){return e.status=n,e.metadata=r.attributes,t.notify({type:A.LAYER_SYNCED,layerData:e}),Promise.resolve()})).catch((function(r){e.status=n,t.errorHandler(Autodesk.Viewing.i18n.translate("Failed to archive markup"),Ll.MARKUP_ARCHIVE_FAILED,r),t.notify({type:A.LAYER_SYNCED,layerData:e})}))}},{key:"cancelRequests",value:function(){this.service.cancelRequests()}},{key:"terminate",value:function(){this.cancelRequests(),this.markupsExtension=null,this.markupsManager=null,this.service=null}},{key:"getMaxPageLimit",value:function(){return this.service.maxPageLimit}}])&&Ql(t.prototype,n),r&&Ql(t,r),e}();function Rl(e){return(Rl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Hl(e,t,n,r,i,A,o){try{var a=e[A](o),s=a.value}catch(e){return void n(e)}a.done?t(s):Promise.resolve(s).then(r,i)}function _l(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var A=e.apply(t,n);function o(e){Hl(A,r,i,o,a,"next",e)}function a(e){Hl(A,r,i,o,a,"throw",e)}o(void 0)}))}}function Dl(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ol(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Il(e,t){return(Il=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pl(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Vl(e);if(t){var i=Vl(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Nl(this,n)}}function Nl(e,t){return!t||"object"!==Rl(t)&&"function"!=typeof t?Kl(e):t}function Kl(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Vl(e){return(Vl=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Gl=AutodeskNamespace("Autodesk.BIM360.Markups"),jl=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Il(e,t)}(o,Autodesk.Viewing.Extension);var t,n,r,i,A=Pl(o);function o(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Dl(this,o),(t=A.call(this,e,n)).viewer=e,t.options=n,t.onModelLoadedBinded=t.onModelLoaded.bind(Kl(t)),t}return t=o,(n=[{key:"onModelLoaded",value:function(e){if(this.viewer.model&&!this.initialized){this.initCache();var t=e.model.getDocumentNode();t?(this.sheetList=t.getRootNode().search({type:"geometry"}),this.options.sheetGUID=t.guid(),this.options.sheetName=t.name(),this.options.fileName=t.findViewableParent().name()):this.sheetList=[],this.markupsManager=new xu(this),this.filterManager=new jc(this,this.options),this.permissionManager=new Xc(this.options),this.markupsTool=new Ms(this),this.viewer.toolController.registerTool(this.markupsTool);var n=this.viewer.toolController.setIsLocked(!1);this.viewer.toolController.activateTool(this.markupsTool.getName()),this.viewer.toolController.setIsLocked(n),this.renderer=new Ju(this),this.markupsManager.setDefaultCreationStyleProperties(),this.options.isMobileApp?this.mobileCallbacks=new $c(this):(this.markupsUI=new Qs(this),this.initMarkupsPanel()),this.initServiceOperator(),this.selectInitialLayer(),this.initialized=!0}}},{key:"initCache",value:function(){this.cache.hasOwnProperty("markupsCache")||(this.cache.markupsCache=new tl),this.markupsCache=this.cache.markupsCache,this.markupsCache.currentUrn!==this.options.documentUrn&&(this.cache.layerToSelect=null,this.cache.layerToEdit=null,this.cache.filters=null),this.cache.markupsCache.setCurrentUrn(this.options.documentUrn)}},{key:"initServiceOperator",value:function(){this.serviceOperator||(this.serviceOperator=new Fl),this.serviceOperator.reset(this),this.serviceOperator.fetchMarkups()}},{key:"initMarkupsPanel",value:function(){this.options.panelContainer&&this.options.uiClasses&&this.options.uiClasses.MarkupPanelClass&&(this.cache.markupsPanel||(this.cache.markupsPanel=new this.options.uiClasses.MarkupPanelClass),this.cache.markupsPanel.reset(this))}},{key:"selectInitialLayer",value:function(){var e=this;setTimeout(_l(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Autodesk.Viewing.EventUtils.waitUntilTransitionEnded(e.viewer);case 2:e.cache.layerToSelect&&(e.selectLayer(e.cache.layerToSelect,!0,!0),e.cache.layerToSelect=null),e.cache.layerToEdit&&(e.editLayer(e.cache.layerToEdit,!0,!0,!0),e.cache.layerToEdit=null);case 4:case"end":return t.stop()}}),t)}))))}},{key:"load",value:(i=_l(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.cache=this.getCache(),e.next=3,this.viewer.loadExtension("Autodesk.Snapping");case 3:return this.viewer.model?this.onModelLoaded({model:this.viewer.model}):this.viewer.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.onModelLoadedBinded),e.abrupt("return",!0);case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"unload",value:function(){return this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.onModelLoadedBinded),this.mobileCallbacks&&(this.mobileCallbacks.destroy(),this.mobileCallbacks=null),this.markupsUI&&(this.markupsUI.destroy(),this.markupsUI=null),this.renderer&&(this.renderer.destroy(),this.renderer=null),this.markupsTool&&(this.viewer.toolController.deregisterTool(this.markupsTool),this.markupsTool=null),this.markupsManager&&(this.markupsManager.destroy(),this.markupsManager=null),this.filterManager&&(this.filterManager.destroy(),this.filterManager=null),this.permissionManager&&(this.permissionManager.destroy(),this.permissionManager=null),this.serviceOperator&&(this.serviceOperator.terminate(),this.serviceOperator=null),this.markupsCache=null,this.initialized=!1,!0}},{key:"startMarkupSession",value:function(e,t){this.markupsManager.startMarkupSession(e,t)}},{key:"endMarkupSession",value:function(e){this.markupsManager.endMarkupSession(e)}},{key:"setToolEnabled",value:function(e){this.markupsManager.setToolEnabled(e)}},{key:"isToolEnabled",value:function(){return this.markupsManager.isToolEnabled()}},{key:"editLayer",value:function(e,t,n,r){this.markupsManager.editLayer(e,t,n,r)}},{key:"changeMarkupCreationType",value:function(e,t){(this.markupsManager.isMarkupSessionOpen()||t)&&this.markupsManager.changeMarkupCreationType(e)}},{key:"deleteMarkup",value:function(e){this.markupsManager.deleteMarkup(e)}},{key:"deleteInEditMarkups",value:function(){this.markupsManager.deleteInEditMarkups()}},{key:"undo",value:function(){this.markupsManager.undo()}},{key:"redo",value:function(){this.markupsManager.redo()}},{key:"copy",value:function(){this.markupsManager.copy()}},{key:"paste",value:function(){this.markupsManager.paste()}},{key:"cut",value:function(){this.markupsManager.cut()}},{key:"selectMarkup",value:function(e){this.markupsManager.selectMarkup(e)}},{key:"deselectMarkup",value:function(e){this.markupsManager.deselectMarkup(e)}},{key:"deselectAllMarkups",value:function(e){this.markupsManager.deselectAllMarkups(e)}},{key:"deselectAllLayers",value:function(e){this.markupsManager.deselectAllLayers(e)}},{key:"exitMarkupView",value:function(){this.markupsManager.exitMarkupView()}},{key:"getSelectedMarkups",value:function(){return this.markupsManager.getSelectedMarkups()}},{key:"getSelectedLayer",value:function(){return this.markupsManager.getSelectedLayer()}},{key:"getVisibleMarkups",value:function(){return this.markupsManager.getVisibleMarkups()}},{key:"selectLayer",value:function(e,t,n){this.markupsManager.selectLayer(e,t,n)}},{key:"deselectLayer",value:function(e){this.markupsManager.deselectLayer(e)}},{key:"getStyleProperty",value:function(e){return this.markupsManager.getStyleProperty(e)}},{key:"changeStyleProperty",value:function(e,t,n){this.markupsManager.changeStyleProperty(e,t,n)}},{key:"loadLayers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.markupsCache&&this.markupsCache.getAsList(),t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.markupsManager.loadLayers(e,t,n)}},{key:"removeLayer",value:function(e){this.markupsManager.removeLayer(e)}},{key:"changeCreationStatusType",value:function(e){this.markupsManager.changeCreationStatusType(e)}},{key:"getCreationStatusType",value:function(){return this.markupsManager.getCreationStatusType()}},{key:"updateFilters",value:function(e){this.filterManager.updateFilters(e)}}])&&Ol(t.prototype,n),r&&Ol(t,r),o}();Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.BIM360.Markups",jl),Gl.Constants=Object.assign({},r),Gl.Events=Object.assign({},A),Gl.markupsOverlayRenderer=Jt}]);
//# sourceMappingURL=BimMarkups.min.js.map