/*!
 * LMV v7.32.0
 * 
 * Copyright 2020 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.ModelAlignment=function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(i,o,function(t){return e[t]}.bind(null,o));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=608)}({12:function(e,t,n){var i=n(41),o=n(42),r=o;r.v1=i,r.v4=o,e.exports=r},22:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var i=new Uint8Array(16);e.exports=function(){return n(i),i}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},23:function(e,t){for(var n=[],i=0;i<256;++i)n[i]=(i+256).toString(16).substr(1);e.exports=function(e,t){var i=t||0,o=n;return[o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],"-",o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]],o[e[i++]]].join("")}},326:function(e){e.exports=JSON.parse('{"@@locale":"en","@@context":"ModelAlignment Extension","Pivot":"Pivot","From":"From","To":"To"}')},327:function(e){e.exports=JSON.parse('{"@@locale":"en","@@context":"SheetAlignment Extension","Add drawing":"Add drawing"}')},4:function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"==typeof btoa){var o=(s=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),r=i.sources.map((function(e){return"/*# sourceURL="+i.sourceRoot+e+" */"}));return[n].concat(r).concat([o]).join("\n")}var s;return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var i={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(i[r]=!0)}for(o=0;o<e.length;o++){var s=e[o];"number"==typeof s[0]&&i[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),t.push(s))}},t}},41:function(e,t,n){var i,o,r=n(22),s=n(23),a=0,l=0;e.exports=function(e,t,n){var c=t&&n||0,u=t||[],d=(e=e||{}).node||i,h=void 0!==e.clockseq?e.clockseq:o;if(null==d||null==h){var f=r();null==d&&(d=i=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=o=16383&(f[6]<<8|f[7]))}var g=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:l+1,p=g-a+(v-l)/1e4;if(p<0&&void 0===e.clockseq&&(h=h+1&16383),(p<0||g>a)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=g,l=v,o=h;var m=(1e4*(268435455&(g+=122192928e5))+v)%4294967296;u[c++]=m>>>24&255,u[c++]=m>>>16&255,u[c++]=m>>>8&255,u[c++]=255&m;var E=g/4294967296*1e4&268435455;u[c++]=E>>>8&255,u[c++]=255&E,u[c++]=E>>>24&15|16,u[c++]=E>>>16&255,u[c++]=h>>>8|128,u[c++]=255&h;for(var y=0;y<6;++y)u[c+y]=d[y];return t||s(u)}},42:function(e,t,n){var i=n(22),o=n(23);e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[r+a]=s[a];return t||o(s)}},5:function(e,t,n){var i,o,r={},s=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=i.apply(this,arguments)),o}),a=function(e,t){return t?t.querySelector(e):document.querySelector(e)},l=function(e){var t={};return function(e,n){if("function"==typeof e)return e();if(void 0===t[e]){var i=a.call(this,e,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(e){i=null}t[e]=i}return t[e]}}(),c=null,u=0,d=[],h=n(6);function f(e,t){for(var n=0;n<e.length;n++){var i=e[n],o=r[i.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](i.parts[s]);for(;s<i.parts.length;s++)o.parts.push(y(i.parts[s],t))}else{var a=[];for(s=0;s<i.parts.length;s++)a.push(y(i.parts[s],t));r[i.id]={id:i.id,refs:1,parts:a}}}}function g(e,t){for(var n=[],i={},o=0;o<e.length;o++){var r=e[o],s=t.base?r[0]+t.base:r[0],a={css:r[1],media:r[2],sourceMap:r[3]};i[s]?i[s].parts.push(a):n.push(i[s]={id:s,parts:[a]})}return n}function v(e,t){var n=l(e.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=d[d.length-1];if("top"===e.insertAt)i?i.nextSibling?n.insertBefore(t,i.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),d.push(t);else if("bottom"===e.insertAt)n.appendChild(t);else{if("object"!=typeof e.insertAt||!e.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=l(e.insertAt.before,n);n.insertBefore(t,o)}}function p(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=d.indexOf(e);t>=0&&d.splice(t,1)}function m(e){var t=document.createElement("style");if(void 0===e.attrs.type&&(e.attrs.type="text/css"),void 0===e.attrs.nonce){var i=function(){0;return n.nc}();i&&(e.attrs.nonce=i)}return E(t,e.attrs),v(e,t),t}function E(e,t){Object.keys(t).forEach((function(n){e.setAttribute(n,t[n])}))}function y(e,t){var n,i,o,r;if(t.transform&&e.css){if(!(r="function"==typeof t.transform?t.transform(e.css):t.transform.default(e.css)))return function(){};e.css=r}if(t.singleton){var s=u++;n=c||(c=m(t)),i=A.bind(null,n,s,!1),o=A.bind(null,n,s,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(e){var t=document.createElement("link");return void 0===e.attrs.type&&(e.attrs.type="text/css"),e.attrs.rel="stylesheet",E(t,e.attrs),v(e,t),t}(t),i=b.bind(null,n,t),o=function(){p(n),n.href&&URL.revokeObjectURL(n.href)}):(n=m(t),i=k.bind(null,n),o=function(){p(n)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var n=g(e,t);return f(n,t),function(e){for(var i=[],o=0;o<n.length;o++){var s=n[o];(a=r[s.id]).refs--,i.push(a)}e&&f(g(e,t),t);for(o=0;o<i.length;o++){var a;if(0===(a=i[o]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete r[a.id]}}}};var T,P=(T=[],function(e,t){return T[e]=t,T.filter(Boolean).join("\n")});function A(e,t,n,i){var o=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=P(t,o);else{var r=document.createTextNode(o),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(r,s[t]):e.appendChild(r)}}function k(e,t){var n=t.css,i=t.media;if(i&&e.setAttribute("media",i),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function b(e,t,n){var i=n.css,o=n.sourceMap,r=void 0===t.convertToAbsoluteUrls&&o;(t.convertToAbsoluteUrls||r)&&(i=h(i)),o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var s=new Blob([i],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}},589:function(e,t,n){var i=n(590);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(5)(i,o);i.locals&&(e.exports=i.locals)},590:function(e,t,n){(e.exports=n(4)(!1)).push([e.i,".model-alignment-panel .tab-header{border-bottom-color:transparent;font-size:12px;font-weight:bold;border-bottom-style:solid;border-bottom-width:3px;padding-bottom:2px}.model-alignment-panel .tab-header.selected{color:#1dc6f2;border-bottom-color:#1dc6f2}.model-alignment-panel .tab-header:hover{color:#1dc6f2}.model-alignment-panel .model-select-combo{width:calc(100% - 20px);margin:15px 10px 15px 10px;font-size:15px}\n",""])},591:function(e,t,n){var i=n(592);"string"==typeof i&&(i=[[e.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(5)(i,o);i.locals&&(e.exports=i.locals)},592:function(e,t,n){(e.exports=n(4)(!1)).push([e.i,".adsk-viewing-viewer .edit2d-label.angle-to-angle{width:84px;height:84px;border-radius:100px;background:#FFFFFF;box-shadow:0px 1px 6px rgba(12,44,84,0.12);font-size:18px;line-height:20px;display:flex}.adsk-viewing-viewer .edit2d-label.angle-to-angle.visible{display:flex}.adsk-viewing-viewer .edit2d-label.angle-to-angle .edit2d-label-text{font-size:18px;line-height:20px;align-self:center;width:100%;color:black}\n",""])},6:function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var n=t.protocol+"//"+t.host,i=n+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(e,t){var o,r=t.trim().replace(/^"(.*)"$/,(function(e,t){return t})).replace(/^'(.*)'$/,(function(e,t){return t}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?e:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?n+r:i+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},608:function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t),n.d(t,"ModelAlignment",(function(){return Be})),n.d(t,"SheetAlignment",(function(){return Tt}));var o="Autodesk.ModelAlignment_Gizmo",r={MODEL_MOVED_EVENT:"modelMoved"},s=Autodesk.Viewing,a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s.EventDispatcher.prototype.apply(this),this.viewer=t,this.id=n,this.anchor=new THREE.Vector3,this.startPos=new THREE.Vector3,this.viewer.impl.createOverlayScene(o),this.gizmo=new THREE.TransformControls(this.viewer.impl.camera,this.viewer.canvas,"translate"),this.target=new THREE.Object3D,this.gizmo.attach(this.target),this.active=!1,this.tmpMatrix=new THREE.Matrix4,this.onCameraChange=this.onCameraChange.bind(this)}var t,n,a;return t=e,(n=[{key:"dtor",value:function(){this.deactivate(),this.viewer.impl.removeOverlayScene(o)}},{key:"setModel",value:function(e,t){this.model=e,e?(t=t||this.model.getFuzzyBox({ignoreTransforms:!0}),this.anchor.copy(t.min),this.initGizmo(),this.setGizmoVisible(!0)):this.setGizmoVisible(!1)}},{key:"setGizmoVisible",value:function(e){this.gizmo.visible=e,this.viewer.impl.invalidate(!1,!1,!0)}},{key:"initGizmo",value:function(){if(this.model){this.startPos.copy(this.anchor);var e=this.model.getModelToViewerTransform();e&&this.startPos.applyMatrix4(e),this.target.position.copy(this.startPos),this.gizmo.update(),this.viewer.impl.invalidate(!1,!1,!0)}}},{key:"getNames",value:function(){return[this.getName()]}},{key:"getName",value:function(){return"ModelTransformTool_".concat(this.id)}},{key:"activate",value:function(){this.active||(this.viewer.impl.addOverlay(o,this.gizmo),this.viewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.active=!0)}},{key:"deactivate",value:function(){this.active&&(this.viewer.impl.removeOverlay(o,this.gizmo),this.viewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChange),this.active=!1)}},{key:"onCameraChange",value:function(){this.gizmo.update(),this.viewer.impl.invalidate(!1,!1,!0)}},{key:"handleMouseMove",value:function(e){var t=this.gizmo.onPointerMove(e),n=this.gizmo.onPointerHover(e);if(this.viewer.impl.invalidate(t,t,!0),t){var i=this.target.position.clone().sub(this.startPos),o=this.model.getPlacementTransform(),s=o.elements;s[12]+=i.x,s[13]+=i.y,s[14]+=i.z,this.viewer.impl.setPlacementTransform(this.model,o),this.fireEvent({type:r.MODEL_MOVED_EVENT})}return(n||t)&&this.viewer.impl.clearHighlight(),n||t}},{key:"handleButtonDown",value:function(e){return 0===e.button&&this.gizmo.onPointerDown(e)}},{key:"handleButtonUp",value:function(e){return 0===e.button&&this.gizmo.onPointerUp(e)}},{key:"getPriority",value:function(){return 1}}])&&i(t.prototype,n),a&&i(t,a),e}();function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){c(r,i,o,s,a,"next",e)}function a(e){c(r,i,o,s,a,"throw",e)}s(void 0)}))}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=m(e);if(t){var o=m(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return v(this,n)}}function v(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?p(e):t}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}a.Events=r;var E=Autodesk.Viewing,y=Autodesk.Viewing.Private,T=0,P=AutodeskNamespace("Autodesk.ModelAlignment"),A={MODEL_SELECTED:"modelSelected",STATE_CHANGED:"stateChanged"},k=function(e,t){return e&&t?new y.LmvMatrix4(!0).makeScale(t,t,t).multiply(e):e},b=function(e,t){return k(e,1/t.myData.scalingFactor)},S=function(e){var t=e.getDocumentNode();t.getRootNode().urn();return e.is2d()?E.toUrlSafeBase64(t.name()):void 0},C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(l,e);var t,n,i,o,r,s=g(l);function l(e,t){var n;return d(this,l),(n=s.call(this,e,t)).name="ModelAlignmentBase",n.onModelTransformChanged=n.onTransformChanged.bind(p(n)),Autodesk.Viewing.EventDispatcher.prototype.apply(p(n)),n}return t=l,(n=[{key:"load",value:(r=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.Section");case 2:return e.next=4,this.viewer.loadExtension("Autodesk.Snapping");case 4:return e.next=6,this.viewer.loadExtension("Autodesk.Edit2D");case 6:return e.next=8,this.viewer.loadExtension("Autodesk.Edit3D");case 8:this.initTransformTool(),this.snapper=this.viewer.toolController.getTool("Snapper_ModelAlignment"),this.snapper||(this.snapper=new Autodesk.Viewing.Extensions.Snapping.Snapper(this.viewer,{renderSnappedTopology:!0,toolName:"Snapper_ModelAlignment"}),this.viewer.toolController.registerTool(this.snapper)),this.coordPicker=this.viewer.toolController.getTool(Autodesk.Edit3D.CoordPicker.Name),this.coordPicker||(this.coordPicker=new Autodesk.Edit3D.CoordPicker(this.viewer,this.snapper),this.viewer.toolController.registerTool(this.coordPicker)),this.screenOverlay=new Autodesk.Edit2D.ScreenOverlay(this.viewer,"Autodesk.ModelAlignment.ScreenOverlay_".concat(T++)),this.model=null,this.pendingChanges={},this.syncedState={},this.alignmentLockMap={};case 18:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"initTransformTool",value:function(){var e=this;this.modelTransformTool=new a(this.viewer,this.name),this.viewer.toolController.registerTool(this.modelTransformTool),this.modelTransformTool.addEventListener(a.Events.MODEL_MOVED_EVENT,(function(){e.modified()})),this.viewer.addEventListener(E.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged)}},{key:"destroyTransformTool",value:function(){var e;this.modelTransformTool&&(this.viewer.toolController.deregisterTool(this.modelTransformTool),this.viewer.removeEventListener(E.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged),null===(e=this.modelTransformTool)||void 0===e||e.dtor(),this.modelTransformTool=null)}},{key:"unload",value:function(){this.destroyTransformTool(),this.model=null,this.pendingChanges={},this.syncedState={},this.alignmentLockMap={}}},{key:"setAlignmentService",value:function(e){this.options.alignmentService=e}},{key:"onTransformChanged",value:function(){this.modelTransformTool.initGizmo()}},{key:"setModel",value:function(e){var t;if(this.model!==e){if(this.model=e,null===(t=this.modelTransformTool)||void 0===t||t.setModel(e),e){var n=this.getAlignmentItemKey(e);this.syncedState[n]||(this.syncedState[n]={matrix:this.model.getPlacementTransform().clone()})}this.fireEvent({type:A.MODEL_SELECTED})}}},{key:"onSaveButton",value:function(){this.options.onSaveButton&&this.options.onSaveButton()}},{key:"saveChanges",value:function(){for(var e in this.options.alignmentService||console.error("AlignmentService must be set for saving transforms"),new THREE.Matrix4,this.pendingChanges){var t,n=this.pendingChanges[e];if(n){var i=n.model,o=n.resetPlacement?null:i.getPlacementTransform().clone();this.syncedState[e].matrix=o;var r=i.getDocumentNode().getRootNode().urn(),s=S(i);o=b(o,i),null===(t=this.options.alignmentService)||void 0===t||t.saveTransform(r,s,void 0,o)}}this.pendingChanges={}}},{key:"isAlignmentLocked",value:(o=u(regeneratorRuntime.mark((function e(t,n){var i,o,r,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.getAlignmentItemKey(n),!this.alignmentLockMap[i]){e.next=3;break}return e.abrupt("return",this.alignmentLockMap[i]);case 3:return o=n.getDocumentNode(),r=o.getRootNode().urn(),s=n.is2d()?E.toUrlSafeBase64(o.name()):void 0,e.next=8,t.isAlignmentLocked(r,s);case 8:return this.alignmentLockMap[i]=e.sent,e.abrupt("return",this.alignmentLockMap[i]);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getAlignmentItemKey",value:function(e){var t=e.myData.urn,n=e.getDocumentNode();return t+(e.is2d()&&n?n.guid():"")}},{key:"modified",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.model){var t=this.getAlignmentItemKey(this.model);if(e&&!this.hasSavedTransform(this.model))return void delete this.pendingChanges[t];this.pendingChanges[t]=new w(this.model,e)}}},{key:"getOriginalFileTransform",value:function(e){var t=e.myData.refPointTransform||new y.LmvMatrix4(!0);return t=function(e,t){return k(e,t.myData.scalingFactor)}(t,e)}},{key:"isModelTransformDifferentThanOriginalFileTransform",value:function(e){var t=e.getPlacementTransform(),n=this.getOriginalFileTransform(e);return!t.equals(n)}},{key:"isMatrixDifferentThanLastSyncedMatrix",value:function(e,t){if(!e||!t)return!1;var n=this.getAlignmentItemKey(t),i=this.syncedState[n].matrix||this.getOriginalFileTransform(t);return!e.equals(i)}},{key:"hasSavedTransform",value:function(e){var t=this.options.alignmentService;if(!t)return console.error("Alignment service must be set first"),!1;var n=e.getDocumentNode().getRootNode().urn(),i=S(e),o=t.getTransform(n,i);return void 0===o&&console.error("Alignment service transform state should already be known."),null!==o}},{key:"hasPendingChanges",value:function(e){if(e){var t=this.getAlignmentItemKey(e);return!!this.pendingChanges[t]}return Boolean(Object.keys(this.pendingChanges).length)}},{key:"isPendingReset",value:function(e){var t=this;if(e){var n,i=this.getAlignmentItemKey(e);return null===(n=this.pendingChanges[i])||void 0===n?void 0:n.resetPlacement}return Boolean(Object.keys(this.pendingChanges).some((function(e){var n;return null===(n=t.pendingChanges[e])||void 0===n?void 0:n.resetPlacement})))}}])&&h(t.prototype,n),i&&h(t,i),l}(E.Extension),w=function e(t,n){d(this,e),this.model=t,this.resetPlacement=n};P.Events=A;n(589);function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var D={MODEL_SELECTED:"modelSelected"},_="ModelAlignment.ModelSelector",R=function(e,t){if(t){if(t.is3d())!function(e,t){var n=e.getVisibleModels().filter((function(e){return e.is3d()&&e.myData.urn==t})).map((function(e){return e.id}));e.impl.renderer().rollOverModelId(n)}(e,t.myData.urn);else e.impl.renderer().rollOverModelId(t.id);e.impl.invalidate(!1,!1,!0)}else e.impl.clearHighlight()},M=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.hoverColor=new THREE.Color(.5,.5,.1)}var t,n,i;return t=e,(n=[{key:"getName",value:function(){return _}},{key:"getNames",value:function(){return[_]}},{key:"activate",value:function(){this.active=!0,this.viewer.impl.renderer().setRollOverHighlightColor(this.hoverColor)}},{key:"deactivate",value:function(){this.active=!1,this.viewer.impl.clearHighlight(),this.viewer.impl.renderer().setRollOverHighlightColor()}},{key:"register",value:function(){}},{key:"modelIdAtPixel",value:function(e,t){var n=[],i=this.viewer.impl.clientToViewport(e,t),o=this.viewer.impl.renderer().idAtPixel(i.x,i.y,n),r=this.viewer.getVisibleModels();return o&&1===r.length?r[0].id:n[1]?n[1]:0}},{key:"handleMouseMove",value:function(e){if(0!==e.buttons)return this.viewer.impl.clearHighlight(),!1;var t=this.modelIdAtPixel(e.canvasX,e.canvasY),n=this.viewer.impl.findModel(t);return R(this.viewer,n),!0}},{key:"handleSingleClick",value:function(e,t){if(0==t){var n=this.modelIdAtPixel(e.canvasX,e.canvasY),i=n&&this.viewer.impl.findModel(n);return this.fireEvent({type:D.MODEL_SELECTED,model:i}),!0}}}])&&O(t.prototype,n),i&&O(t,i),e}();function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function N(e,t,n){return(N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function V(e,t){return(V=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=I(e);if(t){var o=I(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return H(this,n)}}function H(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?B(e):t}function B(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e){return(I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function F(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function z(e,t,n){return t&&G(e.prototype,t),n&&G(e,n),e}M.Events=D;var j=Autodesk.Viewing,U=Autodesk.Viewing.Private,W={MODEL_TRANSFORM_EDITED:"transformEdited",SELECT_MODEL_PRESSED:"selectModelPressed",EDIT_POSITION_PRESSED:"editPositionPressed",TAB_CHANGED:"tabChanged",VECTOR_INPUT_VALUE_CHANGED:"vectorInputValueChanged",MODEL_SELECTED:"modelSelected",SAVE_BUTTON_PRESSED:"saveButtonPressed",FIT_TO_VIEW_BUTTON_PRESSED:"fitToViewButtonPressed",FROM_POINT_BUTTON_PRESSED:"fromPointButtonPressed",TO_POINT_BUTTON_PRESSED:"toPointButtonPressed",APPLY_PTP_PRESSED:"applyPointToPointPressed",FROM_POINT_CHANGED:"fromPointChanged",TO_POINT_CHANGED:"toPointChanged",OFFSET_CHANGED:"offsetChanged",CENTER_BUTTON_PRESSED:"centerButtonPressed",FROM_ANGLE_BUTTON_PRESSED:"fromAngleButtonPressed",TO_ANGLE_BUTTON_PRESSED:"toAngleButtonPressed",APPLY_ATA_PRESSED:"applyAngleToAnglePressed",CENTER_CHANGED:"centerChanged",OFFSET_ANGLE_CHANGED:"offsetAngleChanged",FROM_ANGLE_CHANGED:"fromAngleChanged",TO_ANGLE_CHANGED:"toAngleChanged",FROM_EDGE_BUTTON_PRESSED:"fromEdgeButtonPressed",TO_EDGE_BUTTON_PRESSED:"toEdgeButtonPressed"},Q=function(e){var t=document.createElement("div");return e.appendChild(t),t.style.height="55px",t.style.backgroundColor="rgba(34, 34, 34, 0.4)",t.style.display="flex",t.style.flexDirection="row",t.style.padding="10px",t.style.width="100%",t.style.boxSizing="border-box",t.style.alignItems="center",t.style.marginTop="15px",t},Y=function(e,t,n,i,o){var r=Q(e);i&&(r.id=i);var s=document.createElement("div");if(s.textContent=t,s.style.flexGrow="90",s.style.fontWeight="bold",r.appendChild(s),!n)return r;var a=function(e){var t=e.container.style;t.backgroundColor="rgb(80,80,80)",t.flexGrow="10",t.height="15px",t.width="auto",t.textAlign="center",t.fontSize="12px"};return a(n),r.appendChild(n.container),o?(a(o),r.appendChild(o.container),r):r},K=function(e,t){var n=document.createElement("div");e.appendChild(n);var i=document.createElement("div");i.textContent=t,i.fontSize="10px",n.appendChild(i);var o=document.createElement("input");return o.type="text",n.appendChild(o),o.style.width="80px",o},q=function(e){return!!e.match(/^-?\d*\.?\d*$/)},X=function(){function e(t,n){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;F(this,e),j.EventDispatcher.prototype.apply(this),this.container=document.createElement("div"),this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.padding="0px 10px 30px 10px",this.container.style.backgroundColor="rgba(34, 34, 34, 0.4)",t.appendChild(this.container),this.input=document.createElement("input"),this.input.type="text",this.input.style.width="100px",this.container.appendChild(this.input),this.updateInput=!0,n&&(this.handleInput=function(){i.updateInput=!1,n(),i.updateInput=!0},this.input.addEventListener("input",this.handleInput)),this.input.addEventListener("blur",this.onBlur.bind(this)),this.digits=o}return z(e,[{key:"validate",value:function(e){return e.toFixed(this.digits)}},{key:"setValue",value:function(e){if(null!=e&&null!==e){var t=parseFloat(e).toFixed(this.digits);isNaN(t)||(this.updateInput&&(this.input.value=t),this.fireEvent({type:W.VECTOR_INPUT_VALUE_CHANGED}))}else this.clear()}},{key:"setRawValue",value:function(e){q(e)&&(this.input.value=e)}},{key:"getValue",value:function(){return this.valid()?parseFloat(this.input.value):void 0}},{key:"onBlur",value:function(){this.setValue(this.input.value)}},{key:"clear",value:function(){this.input.value="",this.fireEvent({type:W.VECTOR_INPUT_VALUE_CHANGED})}},{key:"valid",value:function(){return isFinite(parseFloat(this.input.value))}}]),e}(),Z=function(){function e(t,n){var i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;F(this,e),j.EventDispatcher.prototype.apply(this),this.container=document.createElement("div"),this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.padding="0px 10px 30px 10px",this.container.style.backgroundColor="rgba(34, 34, 34, 0.4)",t.appendChild(this.container),this.x=K(this.container,"X"),this.y=K(this.container,"Y"),this.z=K(this.container,"Z"),this.digits=o,this._value=new THREE.Vector3,this.updateInput=!0,n&&(this.handleInput=function(){i.updateInput=!1,n(),i.updateInput=!0},this.x.addEventListener("input",this.handleInput),this.y.addEventListener("input",this.handleInput),this.z.addEventListener("input",this.handleInput)),this.x.addEventListener("blur",this.onBlur.bind(this)),this.y.addEventListener("blur",this.onBlur.bind(this)),this.z.addEventListener("blur",this.onBlur.bind(this)),this.enableEmpty=!1}return z(e,[{key:"validate",value:function(e){return e.toFixed(this.digits)}},{key:"parseValue",value:function(e){return this.enableEmpty&&!e.length?0:parseFloat(e)}},{key:"valid",value:function(){return this.enableEmpty||this.x.value.length&&this.y.value.length&&this.z.value.length}},{key:"getValue",value:function(){var e=this.parseValue(this.x.value),t=this.parseValue(this.y.value),n=this.parseValue(this.z.value);return this._value.set(e,t,n),this._value}},{key:"isZero",value:function(){var e=this.getValue();return 0==e.x&&0==e.y&&0==e.z}},{key:"setValue",value:function(e){if(e){var t=this.validate(e.x),n=this.validate(e.y),i=this.validate(e.z);isNaN(t)||isNaN(n)||isNaN(i)||(this._value.copy(e),this.updateInput&&(this.x.value=t,this.y.value=n,this.z.value=i),this.fireEvent({type:W.VECTOR_INPUT_VALUE_CHANGED}))}else this.clear()}},{key:"setRawValue",value:function(e){q(e.x)&&q(e.y)&&q(e.z)&&(this.x.value=e.x,this.y.value=e.y,this.z.value=e.z)}},{key:"onBlur",value:function(){this.setValue(this._value)}},{key:"clear",value:function(){this.x.value="",this.y.value="",this.z.value="",this.fireEvent({type:W.VECTOR_INPUT_VALUE_CHANGED})}}]),e}(),J=function(e,t,n){var i=new Autodesk.Viewing.UI.Button(t);return e.appendChild(i.container),i.container.textContent=n,i.container.style.textAlign="center",i.container.style.left="50%",i.container.style.transform="translateX(-50%)",i.container.style.width="auto",i.container.style.height="auto",i.container.style.backgroundColor="rgb(80,80,80)",i},$=function(e,t){e.container.style.boxShadow=t?"0px 0px 10px":"initial",e.highlight=t},ee={Transform:"Transform",PointToPoint:"Point-to-Point",AngleToAngle:"Angle-to-Angle"},te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&V(e,t)}(n,Autodesk.Viewing.UI.DockingPanel);var t=L(n);function n(e,i,o,r){var s;return F(this,n),(s=t.call(this,e.container,i,o,r)).viewer=e,j.EventDispatcher.prototype.apply(B(s)),s.pages=[],s.selectedTabId=null,s.title.style.borderBottomColor="rgb(74, 85, 91)",s.container.classList.add("model-alignment-panel"),s.container.style.width="300px",s.container.style.height="815px",s.container.style.top="6px",s.container.style.left="6px",s.body=document.createElement("div"),s.body.style.backgroundColor="rgba(34, 34, 34, 0.9)",s.body.style.height="100%",s.body.style.padding="10px",s.container.appendChild(s.body),s.addModelSection(s.body),s.addTabHeaderSection(s.body),s.positionTab=s.addTab(ee.Transform,"Position"),s.pointToPointTab=s.addTab(ee.PointToPoint,"Move"),s.angleToAngleTab=s.addTab(ee.AngleToAngle,"Rotate"),s.initPositionTab(),s.initPointToPointTab(),s.initAngleToAngleTab(),s.selectTab(ee.Transform),s.digits=2,s}return z(n,[{key:"filterValue",value:function(e){return e.toFixed(this.digits)}},{key:"addModelSection",value:function(e){var t=this,n=document.createElement("div");n.id="ModelSection",this.selectModelButton=new Autodesk.Viewing.UI.Button("SelectModel"),this.selectModelButton.container.textContent="Select",this.selectModelButton.onClick=function(){t.fireEvent({type:W.SELECT_MODEL_PRESSED}),$(t.selectModelButton,!0)},Y(n,"Model",this.selectModelButton),this.modelCombo=document.createElement("select"),this.modelCombo.classList.add("model-select-combo"),n.appendChild(this.modelCombo),this.updateModelCombo(),this.updateModelCombo=this.updateModelCombo.bind(this),this.viewer.addEventListener(j.MODEL_ADDED_EVENT,this.updateModelCombo),this.viewer.addEventListener(j.MODEL_REMOVED_EVENT,this.updateModelCombo),this.modelCombo.addEventListener("change",(function(){var e=t.modelCombo.selectedIndex,n=t.modelCombo.items[e];t.setModel(n.model)})),e.appendChild(n)}},{key:"getSelectableModels",value:function(){var e={};return this.viewer.getVisibleModels().filter((function(t){if(t.getData().underlayRaster)return!1;if(t.is2d())return!0;var n=t.myData.urn;return!e[n]&&(e[n]=!0,!0)}))}},{key:"updateModelCombo",value:function(){var e=this;this.modelCombo.length=0;var t=[];t.push({name:"Please select",model:null}),this.getSelectableModels().forEach((function(e){var n=e.getDocumentNode().getModelName();t.push({name:n,model:e,urn:e.myData.urn})})),t.forEach((function(t,n){var i=document.createElement("option");i.value=n,i.textContent=t.name,i.addEventListener("mouseenter",(function(){return R(e.viewer,t.model)})),i.addEventListener("mouseleave",(function(){return R(e.viewer,null)})),e.modelCombo.add(i)})),this.modelCombo.items=t}},{key:"initPositionTab",value:function(){var e=this;this.positionTab.padding="10px",this.editPositionButton=this.createEventButton("EditPositionButton","Edit",W.EDIT_POSITION_PRESSED),this.fitToViewButton=this.createEventButton("FitToViewButton","Fit to View",W.FIT_TO_VIEW_BUTTON_PRESSED,null,!1),Y(this.positionTab,"Position",this.editPositionButton,"PositionHeader",this.fitToViewButton),this.position=new Z(this.positionTab,(function(){return e.onTransformChanged()})),Y(this.positionTab,"Rotation"),this.rotation=new X(this.positionTab,(function(){return e.onTransformChanged()})),this.saveButton=this.createEventButton("SaveButton","Save Transforms",W.SAVE_BUTTON_PRESSED),Y(this.body,"",this.saveButton)}},{key:"initPointToPointTab",value:function(){var e=this;this.selectFromButton=this.createEventButton("SelectFromButton","Select",W.FROM_POINT_BUTTON_PRESSED),this.selectToButton=this.createEventButton("SelectToButton","Select",W.TO_POINT_BUTTON_PRESSED),Y(this.pointToPointTab,"From point",this.selectFromButton,"FromPointHeader"),this.fromPoint=new Z(this.pointToPointTab,(function(){return e.onFromPointChanged(!0)})),Y(this.pointToPointTab,"To point",this.selectToButton,"ToPointHeader"),this.toPoint=new Z(this.pointToPointTab,(function(){return e.onToPointChanged(!0)})),Y(this.pointToPointTab,"Offset",null,"OffsetHeader"),this.offset=new Z(this.pointToPointTab,(function(){return e.onOffsetChanged(!0)})),this.offset.enableEmpty=!0;var t=Q(this.pointToPointTab);this.applyPointToPointButton=J(t,"ApplyP2P","Apply"),this.applyPointToPointButton.onClick=function(){e.clearPointToPoint(),e.fireEvent({type:W.APPLY_PTP_PRESSED})}}},{key:"initAngleToAngleTab",value:function(){var e=this;this.selectCenterButton=this.createEventButton("SelectCenterButton","Select",W.CENTER_BUTTON_PRESSED,(function(){return e.onSelectCenterButton()})),this.selectFromAngleButton=this.createEventButton("SelectFromAngleButton","Direction",W.FROM_ANGLE_BUTTON_PRESSED),this.selectToAngleButton=this.createEventButton("SelectToAngleButton","Direction",W.TO_ANGLE_BUTTON_PRESSED),this.selectFromEdgeButton=this.createEventButton("SelectFromEdgeButton","Edge",W.FROM_EDGE_BUTTON_PRESSED),this.selectToEdgeButton=this.createEventButton("SelectToEdgeButton","Edge",W.TO_EDGE_BUTTON_PRESSED),Y(this.angleToAngleTab,"Center",this.selectCenterButton,"CenterHeader"),this.center=new Z(this.angleToAngleTab,(function(){return e.onCenterChanged(!0)})),Y(this.angleToAngleTab,"From angle",this.selectFromEdgeButton,"FromAngleHeader",this.selectFromAngleButton),this.fromAngle=new X(this.angleToAngleTab,(function(){return e.onFromAngleChanged(!0)})),Y(this.angleToAngleTab,"To angle",this.selectToEdgeButton,"ToPointHeader",this.selectToAngleButton),this.toAngle=new X(this.angleToAngleTab,(function(){return e.onToAngleChanged(!0)})),Y(this.angleToAngleTab,"Offset angle",null,"OffsetHeader"),this.offsetAngle=new X(this.angleToAngleTab,(function(){return e.onOffsetAngleChanged(!0)})),this.offset.enableEmpty=!0;var t=Q(this.angleToAngleTab);this.applyAngleToAngleButton=J(t,"ApplyA2A","Apply"),this.applyAngleToAngleButton.onClick=function(){e.clearAngleToAngle(),e.fireEvent({type:W.APPLY_ATA_PRESSED})}}},{key:"setModel",value:function(e){this.model=e;var t=this.modelCombo.items;this.modelCombo.selectedIndex=t.findIndex((function(t){return t.model===e})),this.updateMatrix(),$(this.selectModelButton,!1),this.blockEvents||(this.blockEvents=!0,this.fireEvent({type:W.MODEL_SELECTED}),this.blockEvents=!1)}},{key:"updateMatrix",value:function(){if(this.model){var e=this.model.getPlacementTransform();this.setMatrix(e)}}},{key:"setPosition",value:function(e){this.position.setValue(e)}},{key:"setRotation",value:function(e){this.rotation.setValue(e)}},{key:"setFromPoint",value:function(e){this.fromPoint.setValue(e),this.onFromPointChanged()}},{key:"setToPoint",value:function(e){this.toPoint.setValue(e),this.onToPointChanged()}},{key:"setOffset",value:function(e){this.offset.setValue(e),this.onOffsetChanged()}},{key:"setCenter",value:function(e){this.center.setValue(e)}},{key:"setFromAngle",value:function(e){this.fromAngle.setValue(e),this.onFromAngleChanged()}},{key:"setToAngle",value:function(e){this.toAngle.setValue(e),this.onToAngleChanged()}},{key:"fromPointValid",value:function(){return this.fromPoint.valid()}},{key:"toPointValid",value:function(){return this.toPoint.valid()}},{key:"offsetValid",value:function(){return this.offset.valid()}},{key:"clearPointToPoint",value:function(){this.fromPoint.clear(),this.toPoint.clear(),this.offset.clear()}},{key:"clearAngleToAngle",value:function(){this.center.clear(),this.fromAngle.clear(),this.toAngle.clear(),this.offsetAngle.clear()}},{key:"getPosition",value:function(){return this.position.valid()&&this.position.getValue()}},{key:"getRotation",value:function(){return this.rotation.valid()&&this.rotation.getValue()}},{key:"getFromPoint",value:function(){return this.fromPoint.valid()&&this.fromPoint.getValue()}},{key:"getToPoint",value:function(){return this.toPoint.valid()&&this.toPoint.getValue()}},{key:"getOffset",value:function(){return!this.offset.isZero()&&this.offset.getValue()}},{key:"getCenter",value:function(){return this.center.valid()&&this.center.getValue()}},{key:"extractModelScale",value:function(){var e=new THREE.Vector3(1,1,1),t=this.model.getPlacementTransform();return t?e.setFromMatrixScale(t):e}},{key:"onTransformChanged",value:function(){if(this.model){var e=this.getPosition(),t=new THREE.Vector3(0,0,1),n=THREE.Math.degToRad(this.getRotation()),i=(new THREE.Quaternion).setFromAxisAngle(t,n),o=this.extractModelScale();if(e&&i){var r=new U.LmvMatrix4(!0).compose(e,i,o);this.viewer.impl.setPlacementTransform(this.model,r),this.fireEvent({type:W.MODEL_TRANSFORM_EDITED})}}}},{key:"onFromPointChanged",value:function(e){var t=this.getFromPoint(),n=this.getToPoint(),i=this.getOffset();t&&n?this.offset.setValue(n.sub(t)):t&&i&&(this.toPoint.setValue(t.add(i)),e&&this.fireEvent({type:W.TO_POINT_CHANGED,toPoint:this.getToPoint()})),e&&this.fireEvent({type:W.FROM_POINT_CHANGED,fromPoint:this.getFromPoint()})}},{key:"onToPointChanged",value:function(e){var t=this.getFromPoint(),n=this.getToPoint(),i=this.getOffset();t&&n?(this.offset.setValue(n.sub(t)),e&&this.fireEvent({type:W.OFFSET_CHANGED,offset:this.getOffset()})):n&&i&&(this.fromPoint.setValue(n.sub(i)),e&&this.fireEvent({type:W.FROM_POINT_CHANGED,fromPoint:this.getFromPoint()})),e&&this.fireEvent({type:W.TO_POINT_CHANGED,toPoint:this.getToPoint()})}},{key:"onOffsetChanged",value:function(e){var t=this.getFromPoint(),n=this.getToPoint(),i=this.getOffset();t&&i?(this.toPoint.setValue(t.add(i)),e&&this.fireEvent({type:W.TO_POINT_CHANGED,toPoint:this.getToPoint()})):n&&i&&(this.fromPoint.setValue(n.sub(i)),e&&this.fireEvent({type:W.FROM_POINT_CHANGED,fromPoint:this.getFromPoint()})),e&&this.fireEvent({type:W.OFFSET_CHANGED,offset:this.getOffset()})}},{key:"updateFromAngle",value:function(e){var t=this.toAngle.getValue()-this.offsetAngle.getValue();this.fromAngle.setValue(t),e&&this.fireEvent({type:W.FROM_ANGLE_CHANGED,angle:t})}},{key:"updateToAngle",value:function(e){var t=this.fromAngle.getValue()+this.offsetAngle.getValue();this.toAngle.setValue(t),e&&this.fireEvent({type:W.TO_ANGLE_CHANGED,angle:t})}},{key:"updateOffsetAngle",value:function(e){var t=this.toAngle.getValue()-this.fromAngle.getValue();this.offsetAngle.setValue(t),e&&this.fireEvent({type:W.OFFSET_ANGLE_CHANGED,angle:t})}},{key:"onCenterChanged",value:function(e){e&&this.fireEvent({type:W.CENTER_CHANGED,center:this.getCenter()})}},{key:"onFromAngleChanged",value:function(e){var t=this.fromAngle.valid(),n=this.toAngle.valid(),i=this.offsetAngle.valid();t&&n?this.updateOffsetAngle(e):t&&i&&this.updateToAngle(e),e&&this.fireEvent({type:W.FROM_ANGLE_CHANGED,angle:this.fromAngle.getValue()})}},{key:"onToAngleChanged",value:function(e){var t=this.fromAngle.valid(),n=this.toAngle.valid(),i=this.offsetAngle.valid();t&&n?this.updateOffsetAngle(e):n&&i&&this.updateFromAngle(e),e&&this.fireEvent({type:W.TO_ANGLE_CHANGED,angle:this.toAngle.getValue()})}},{key:"onOffsetAngleChanged",value:function(e){var t=this.fromAngle.valid(),n=this.toAngle.valid(),i=this.offsetAngle.valid();t&&i?this.updateToAngle(e):n&&i?this.updateFromAngle(e):!i||t||n||(this.fromAngle.setValue(0),this.toAngle.setValue(this.offsetAngle.getValue()),this.updateFromAngle(e),this.updateToAngle(e)),e&&this.fireEvent({type:W.OFFSET_ANGLE_CHANGED,angle:this.offsetAngle.getValue()})}},{key:"setMatrix",value:function(e){e=e||(new THREE.Matrix4).identity();var t=new THREE.Vector3,n=new THREE.Quaternion,i=new THREE.Vector3;THREE.Matrix4.prototype.decompose.call(e,t,n,i),this.setPosition(t);var o=(new THREE.Euler).setFromQuaternion(n),r=THREE.Math.radToDeg(o._z);this.setRotation(r)}},{key:"addTabHeaderSection",value:function(e){this.tabHeaders=document.createElement("div"),this.tabHeaders.id="TabHeaders",this.tabHeaders.style.paddingTop="15px",this.tabHeaders.style.paddingLeft="10px",this.tabHeaders.style.backgroundColor="rgb(34, 34, 34, 0.94)",this.tabHeaders.style.display="flex",this.tabHeaders.style.flexDirection="row",this.tabHeaders.style.borderBottomStyle="solid",this.tabHeaders.style.borderBottomWidth="3px",this.tabHeaders.style.borderColor="rgb(34, 34, 34, 0.94)",e.appendChild(this.tabHeaders)}},{key:"addTabHeader",value:function(e,t){var n=this,i=document.createElement("div");i.style.paddingRight="10px";var o=document.createElement("span");o.textContent=t,o.classList.add("tab-header"),i.appendChild(o),i.tabId=e,i.text=o,this.tabHeaders.appendChild(i);i.addEventListener("click",(function(){return n.selectTab(e)}))}},{key:"addTab",value:function(e,t){this.addTabHeader(e,t);var n=document.createElement("div");return n.tabId=e,this.pages.push(n),this.body.append(n),n}},{key:"selectTab",value:function(e){if(this.selectedTabId!==e){for(var t=0;t<this.tabHeaders.children.length;t++){var n=this.tabHeaders.children[t];n.tabId==e?n.text.classList.add("selected"):n.text.classList.remove("selected")}for(var i=0;i<this.pages.length;i++){var o=this.pages[i],r=o.tabId===e;o.style.display=r?"block":"none"}this.selectedTabId=e,this.fireEvent({type:W.TAB_CHANGED,tabId:e})}}},{key:"onFromSelected",value:function(e){this.setFromPoint(e),$(this.selectFromButton,!1),this.fromPoint.valid()&&!this.toPoint.valid()&&($(this.selectToButton,!0),this.fireEvent({type:W.TO_POINT_BUTTON_PRESSED}))}},{key:"onToSelected",value:function(e){this.setToPoint(e),$(this.selectToButton,!1)}},{key:"onFromHovered",value:function(e){this.setFromPoint(e)}},{key:"onToHovered",value:function(e){this.setToPoint(e)}},{key:"createEventButton",value:function(e,t,n,i){var o=this,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=new Autodesk.Viewing.UI.Button(e);return s.container.textContent=t,s.onClick=function(){i&&i(),o.fireEvent({type:n}),r&&$(s,!0)},s}},{key:"onCenterHovered",value:function(e){this.setCenter(e)}},{key:"onCenterSelected",value:function(e){this.setCenter(e),$(this.selectCenterButton,!1),this.center.valid()&&!this.fromAngle.valid()&&$(this.selectFromAngleButton,!0)}},{key:"onFromAngleHovered",value:function(e){this.setFromAngle(e)}},{key:"onFromAngleSelected",value:function(e){this.setFromAngle(e),$(this.selectFromAngleButton,!1),$(this.selectFromEdgeButton,!1),this.center.valid()&&this.fromAngle.valid()&&!this.toAngle.valid()&&$(this.selectToAngleButton,!0)}},{key:"onToAngleHovered",value:function(e){this.setToAngle(e)}},{key:"onToAngleSelected",value:function(e){this.setToAngle(e),$(this.selectToAngleButton,!1),$(this.selectToEdgeButton,!1)}},{key:"onSelectCenterButton",value:function(){this.clearAngleToAngle()}},{key:"uninitialize",value:function(){N(I(n.prototype),"uninitialize",this).call(this),this.viewer.removeEventListener(j.MODEL_ADDED_EVENT,this.updateModelCombo),this.viewer.removeEventListener(j.MODEL_REMOVED_EVENT,this.updateModelCombo)}}]),n}();function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function oe(e,t,n){return(oe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ce(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function re(e,t){return(re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=ce(e);if(t){var o=ce(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return ae(this,n)}}function ae(e,t){return!t||"object"!==ne(t)&&"function"!=typeof t?le(e):t}function le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ce(e){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}te.Events=W,te.TabIds=ee;var ue=Object.assign({},Autodesk.Edit3D.TwoPointPicker.Events),de=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&re(e,t)}(r,Autodesk.Edit3D.TwoPointPicker);var t,n,i,o=se(r);function r(e,t,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var s={backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Blue},a={draggable:!0,labels:["From","To"],labelStyles:[s,s],colors:[Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Red],connections:[{fromIndex:0,toIndex:1,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Line,color:Autodesk.Edit3D.NPointPicker.Colors.Black,getEdgeLabelText:function(){var e=Math.abs(i.points[0].x-i.points[1].x),t=Math.abs(i.points[0].y-i.points[1].y),n=Math.abs(i.points[0].z-i.points[1].z),o=i.unitHandler.lengthToString(e),r=i.unitHandler.lengthToString(t),s=i.unitHandler.lengthToString(n);return"X: ".concat(o,", Y: ").concat(r,", Z: ").concat(s)},labelStyle:{backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Black}}]};return(i=o.call(this,e,t,n,a)).unitHandler=new Autodesk.Edit2D.DefaultUnitHandler(i.viewer),i.updateGizmos=i.updateGizmos.bind(le(i)),i.viewer.addEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,i.updateGizmos),i}return t=r,(n=[{key:"dtor",value:function(){oe(ce(r.prototype),"dtor",this).call(this),this.viewer.removeEventListener(Autodesk.Viewing.MeasureCommon.Events.DISPLAY_UNITS_CHANGED,this.updateGizmos)}},{key:"start",value:function(){this.setVisible(!0),this.startSelect()}},{key:"pause",value:function(){this.cancelPointSelection(),this.isActive=!1,this.setVisible(!1)}},{key:"cancel",value:function(){this.cancelPointSelection(),this.clear(),this.setVisible(!1)}},{key:"finish",value:function(e){return this.isActive=!1,this.apply(e)}},{key:"apply",value:function(e){var t=this;return new Promise((function(n){var i=e.getPlacementTransform(),o=t.pointValid[0]&&t.pointValid[1]?t.points[1].clone().sub(t.points[0]):t.offset,r=(new THREE.Vector3).setFromMatrixPosition(i),s=r.clone().add(o),a=new THREE.Vector3,l=new THREE.Vector3;t.screenOverlay.fadeOutGizmo(t.connectors[0].gizmo),t.connectors[0].label.setOpacity(0,!0),t.markers[0].setLabelVisible(!1),t.markers[1].setLabelVisible(!1),t.anim=Autodesk.Viewing.Private.fadeValue(0,1,1,(function(n){n=THREE.Math.smootherstep(n,0,1),a.lerpVectors(r,s,n),l.lerpVectors(t.points[0],t.points[1],n),t.markers[0].setPosition(l),i.setPosition(a),t.viewer.impl.setPlacementTransform(e,i)}),(function(e){t.clear(),t.anim=null,n()}))}))}},{key:"fitModelToView",value:function(e){var t=e.getBoundingBox(),n=this.viewer.impl.camera,i=Autodesk.Viewing.UnifiedCamera.getViewParamsFromBox(t,!1,n.aspect,n.up,n.fov),o=t.center(),r=i.position.distanceTo(i.target),s=n.getWorldDirection().clone().multiplyScalar(r),a=n.position.clone().add(s),l=o.distanceTo(a),c=2*t.size().length();if(l>c){var u=Math.max(l-c,0),d=a.clone().sub(o).normalize().multiplyScalar(u),h=e.getPlacementTransform(),f=(new THREE.Vector3).setFromMatrixPosition(h);f.add(d),h.setPosition(f),this.viewer.impl.setPlacementTransform(e,h),o.add(d)}this.setPoint(0,o),this.setPoint(1,a),this.apply(e)}},{key:"skipAnim",value:function(){this.anim&&this.anim.skip()}},{key:"isAnimationActive",value:function(){return this.anim&&this.anim.isRunning}}])&&ie(t.prototype,n),i&&ie(t,i),r}();de.Events=ue;n(591);function he(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var fe={CENTER_SELECTED:"centerSelected",CENTER_HOVERED:"centerHovered",FROM_ANGLE_SELECTED:"startAngleSelected",FROM_ANGLE_HOVERED:"startAngleHovered",TO_ANGLE_SELECTED:"endAngleSelected",TO_ANGLE_HOVERED:"endAngleHovered"},ge={NotSelecting:0,SelectingCenter:1,SelectingStartAngle:2,SelectingEndAngle:3,SelectingStartAngleEdge:4,SelectingEndAngleEdge:5},ve={SinglePoint:0,Edge:1},pe=new THREE.Matrix4,me=new THREE.Matrix4,Ee=new THREE.Matrix4,ye=new THREE.Quaternion,Te=(new THREE.Vector3,new THREE.Vector2),Pe=function(e){return e>=0?e:e+360},Ae=function(){function e(t,n,i){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var r=Autodesk.Edit3D.CoordPicker,s=Autodesk.Edit3D.PointMarker,a=Autodesk.Edit3D.TwoPointPicker;this.viewer=t,this.coordPicker=n,Autodesk.Viewing.EventDispatcher.prototype.apply(this),this.mode=ge.NotSelecting,this.defaultPickingMode=ve.Edge,this.center=new THREE.Vector3,this.fromEdge={a:new THREE.Vector3,b:new THREE.Vector3},this.toEdge={a:new THREE.Vector3,b:new THREE.Vector3},this.centerValid=!1,this.fromValid=!1,this.toValid=!1,this.fromPointOnPlane=new THREE.Vector3,this.toPointOnPlane=new THREE.Vector3,this.screenOverlay=i,this.angleGizmo=new Autodesk.Edit2D.AngleGizmo(this.screenOverlay.layer,{startColor:Autodesk.Edit3D.NPointPicker.Colors.Blue,endColor:Autodesk.Edit3D.NPointPicker.Colors.Red,ignoreCameraDistance:!0,hideArrowHead:!0,centerLabel:!0,labelClassName:"angle-to-angle"}),this.angleGizmo.setVisible(!0),this.axis=new THREE.Vector3(0,0,1),this.selectionPlane=new THREE.Plane,this.fromConnector=new Autodesk.Edit2D.ScreenOverlay.Line3DGizmo,this.toConnector=new Autodesk.Edit2D.ScreenOverlay.Line3DGizmo;var l=this.fromConnector.line2D.style;l.lineStyle=10,l.lineWidth=1.5,l.lineColor="rgb(255, 0, 0)",l.lineOpacity=.7,this.toConnector.line2D.style.copy(l),this.animTime=1.5,this.fadeOutAngleGizmoAfter=.7,this.angleGizmoSize=60,this.angleGizmoBottomOffset=200,this.useFirstPointAsCenter=!0,this.visible=!0,this.onDragEdgeEnd=this.onDragEdgeEnd.bind(this);var c={backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Blue},u={draggable:!0,labels:["From"],labelStyles:[c],icons:[Autodesk.Edit3D.PointMarker.Icons.Cross,Autodesk.Edit3D.PointMarker.Icons.Empty],colors:[Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Blue],connections:[{fromIndex:0,toIndex:1,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Arrow,color:Autodesk.Edit3D.NPointPicker.Colors.Blue,getEdgeLabelText:function(){return o.fromValid?Pe(o.edgeToAngle(o.fromEdge.b,o.fromEdge.a,!0)).toFixed(1)+"":""},labelStyle:{backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Black}}]};this.fromEdgePicker=new a(t,n,i,u),this.fromEdgePicker.addEventListener(a.Events.POINT_SELECTED,(function(){return o.onEdgeSelected(o.fromEdgePicker)})),this.fromEdgePicker.markers[0].addEventListener(s.Events.DRAG_START,(function(){o.mode=ge.SelectingStartAngleEdge})),this.fromEdgePicker.markers[1].addEventListener(s.Events.DRAG_START,(function(){o.mode=ge.SelectingStartAngleEdge})),this.fromEdgePicker.markers[0].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.fromEdgePicker.markers[1].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),u={draggable:!0,labels:["To"],labelStyles:[c],icons:[Autodesk.Edit3D.PointMarker.Icons.Cross,Autodesk.Edit3D.PointMarker.Icons.Empty],colors:[Autodesk.Edit3D.NPointPicker.Colors.Red,Autodesk.Edit3D.NPointPicker.Colors.Red],connections:[{fromIndex:0,toIndex:1,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Arrow,color:Autodesk.Edit3D.NPointPicker.Colors.Red,getEdgeLabelText:function(){return o.toValid?Pe(o.edgeToAngle(o.toEdge.b,o.toEdge.a,!0)).toFixed(1)+"":""},labelStyle:{backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.Black}}]},this.toEdgePicker=new a(t,n,i,u),this.toEdgePicker.addEventListener(a.Events.POINT_SELECTED,(function(){return o.onEdgeSelected(o.toEdgePicker)})),this.toEdgePicker.markers[0].addEventListener(s.Events.DRAG_START,(function(){o.mode=ge.SelectingEndAngleEdge})),this.toEdgePicker.markers[1].addEventListener(s.Events.DRAG_START,(function(){o.mode=ge.SelectingEndAngleEdge})),this.toEdgePicker.markers[0].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.toEdgePicker.markers[1].addEventListener(s.Events.DRAG_END,this.onDragEdgeEnd),this.onPointClicked=this.onPointClicked.bind(this),this.onPointHovered=this.onPointHovered.bind(this),this.coordPicker.addEventListener(r.Events.POINT_CLICKED,this.onPointClicked),this.coordPicker.addEventListener(r.Events.POINT_HOVERED,this.onPointHovered),this.coordPicker.addEventListener(r.Events.ESCAPE,(function(){return o.cancelPointSelection()})),this.updateGizmos=this.updateGizmos.bind(this),this.viewer.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.updateGizmos),this.clearOnNextStart=!1,this.updateGizmos()}var t,n,i;return t=e,(n=[{key:"dtor",value:function(){this.coordPicker.removeEventListener(Autodesk.Edit3D.CoordPicker.Events.POINT_CLICKED,this.onPointClicked),this.coordPicker.removeEventListener(Autodesk.Edit3D.CoordPicker.Events.POINT_HOVERED,this.onPointHovered),this.viewer.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.updateGizmos)}},{key:"start",value:function(){this.skipAnim(),this.clearOnNextStart&&this.clear(),this.isActive=!0,this.continuePointSelectionIfNeeded()}},{key:"pause",value:function(){this.cancelPointSelection(),this.setVisible(!1),this.isActive=!1,this.updateGizmos()}},{key:"cancel",value:function(){this.setVisible(!1),this.isActive=!1,this.clear()}},{key:"finish",value:function(e){return this.clearOnNextStart=!1,this.updateGizmos(),this.apply(e)}},{key:"startSelectCenter",value:function(e){this.clear(),this.isActive=!0,this.pointBackup=this.centerValid?this.center.clone():null,this.viewer.toolController.activateTool(this.coordPicker.getName()),this.mode=ge.SelectingCenter,e&&this.coordPicker.setDragging(!0)}},{key:"startCoordPicker",value:function(e){this.viewer.toolController.activateTool(this.coordPicker.getName())}},{key:"endCoordPicker",value:function(){this.viewer.toolController.setIsLocked(!1),this.viewer.toolController.deactivateTool(this.coordPicker.getName())}},{key:"onDragCenterEnd",value:function(e){var t=e.event;this.coordPicker.getDragging()&&(this.coordPicker.handleSingleClick(t,0),this.coordPicker.setDragging(!1))}},{key:"onDragEdgeEnd",value:function(){this.useFirstPointAsCenter&&this.mode===ge.SelectingStartAngleEdge&&this.setCenter(this.fromEdgePicker.points[0]),this.mode=ge.NotSelecting,this.continuePointSelectionIfNeeded()}},{key:"startSelectFromAngle",value:function(e){this.startCoordPicker(!0),this.mode=ge.SelectingStartAngle,this.pointBackup=this.fromValid?this.fromEdge.b.clone():null}},{key:"startSelectToAngle",value:function(e){this.startCoordPicker(!0),this.mode=ge.SelectingEndAngle,this.pointBackup=this.toValid?this.toEdge.b.clone():null}},{key:"setCenter",value:function(e){e?(this.center.copy(e),this.centerValid=!0,this.selectionPlane.setFromNormalAndCoplanarPoint(this.axis,this.center)):this.centerValid=!1,this.updateGizmos()}},{key:"setFromEdge",value:function(e,t){this.fromValid=Boolean(e&&t),this.fromValid&&(this.fromEdge.a.copy(e),this.fromEdge.b.copy(t)),this.updateGizmos()}},{key:"setToEdge",value:function(e,t){this.toValid=Boolean(e&&t),this.toValid&&(this.toEdge.a.copy(e),this.toEdge.b.copy(t)),this.updateGizmos()}},{key:"edgeToAngle",value:function(e,t,n){var i=e.x-t.x,o=e.y-t.y,r=Math.atan2(o,i);return n?THREE.Math.radToDeg(r):r}},{key:"onPointHovered",value:function(e){if(this.mode!==ge.NotSelecting&&e.point)switch(this.mode){case ge.SelectingCenter:this.setCenter(e.point),this.fireEvent({type:fe.CENTER_HOVERED,point:e.point}),this.fromValid&&this.fireEvent({type:fe.FROM_ANGLE_HOVERED,angle:this.edgeToAngle(this.fromEdge.b,this.center,!0)}),this.toValid&&this.fireEvent({type:fe.TO_ANGLE_HOVERED,angle:this.edgeToAngle(this.toEdge.b,this.center,!0)});break;case ge.SelectingStartAngle:this.setFromEdge(this.center,e.point),this.fireEvent({type:fe.FROM_ANGLE_HOVERED,angle:this.edgeToAngle(e.point,!0)});break;case ge.SelectingEndAngle:this.setToEdge(this.center,e.point),this.fireEvent({type:fe.TO_ANGLE_HOVERED,angle:this.edgeToAngle(e.point,!0)});break;case ge.SelectingStartAngleEdge:(1===this.fromEdgePicker.selectingIndex||this.fromValid)&&(this.setFromEdge(this.fromEdgePicker.points[0],this.fromEdgePicker.points[1]),this.fireEvent({type:fe.FROM_ANGLE_HOVERED,angle:this.edgeToAngle(this.fromEdgePicker.points[1],this.fromEdgePicker.points[0])}));break;case ge.SelectingEndAngleEdge:(1===this.toEdgePicker.selectingIndex||this.toValid)&&(this.setToEdge(this.toEdgePicker.points[0],this.toEdgePicker.points[1]),this.fireEvent({type:fe.TO_ANGLE_HOVERED,angle:this.edgeToAngle(this.toEdgePicker.points[1],this.toEdgePicker.points[0])}))}}},{key:"updateAngleGizmo",value:function(){if(this.fromValid&&this.toValid&&this.centerValid){var e=this.viewer.impl.getCanvasBoundingClientRect();this.angleGizmo.setCenter(Te.set(e.width/2,e.height-this.angleGizmoBottomOffset));var t=Math.PI/2;this.setPointFromAngle(Te,-t,this.angleGizmoSize,this.angleGizmo.center),this.angleGizmo.setStart(Te);var n=t+this.getOffsetAngle();this.setPointFromAngle(Te,-n,this.angleGizmoSize,this.angleGizmo.center),this.angleGizmo.setEnd(Te)}else this.angleGizmo.setCenter(null),this.angleGizmo.setStart(null),this.angleGizmo.setEnd(null);this.angleGizmo.update()}},{key:"updateGizmos",value:function(){var e=this.visible&&this.isActive;this.fromEdgePicker.setVisible(e&&this.fromValid),this.toEdgePicker.setVisible(e&&this.toValid),this.fromEdgePicker.updateGizmos(),this.toEdgePicker.updateGizmos(),this.visible&&(this.fromValid||this.toValid)&&(this.isActive||this.isAnimationActive())?(this.angleGizmo.fadeTo(1),this.angleGizmo.setLabelEnabled(!0),this.mode!==ge.NotSelecting&&this.angleGizmo.skipFade(),this.updateAngleGizmo()):(this.angleGizmo.fadeTo(0),this.angleGizmo.setLabelEnabled(!1),this.angleGizmo.update()),this.screenOverlay.update()}},{key:"onPointClicked",value:function(e){var t=e.point,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.mode!==ge.NotSelecting&&this.mode!==ge.SelectingStartAngleEdge&&this.mode!=ge.SelectingEndAngleEdge){t=t||this.pointBackup,this.pointBackup=null;var i=this.mode;this.mode=ge.NotSelecting,this.endCoordPicker(),t&&(this.viewer.impl.camera.pivot.copy(t),this.viewer.impl.camera.dirty=!0);var o=t?this.edgeToAngle(t,this.center,!0):null;switch(i){case ge.SelectingCenter:this.setCenter(t),this.fireEvent({type:fe.CENTER_SELECTED,point:t});break;case ge.SelectingStartAngle:this.setFromEdge(this.center,t),this.fireEvent({type:fe.FROM_ANGLE_SELECTED,angle:o});break;case ge.SelectingEndAngle:this.setToEdge(this.center,t),this.fireEvent({type:fe.TO_ANGLE_SELECTED,angle:o});break;case ge.SelectingStartAngleEdge:case ge.SelectingEndAngleEdge:break;default:console.error("Unexpeced mode")}n&&this.continuePointSelectionIfNeeded()}}},{key:"cancelPointSelection",value:function(){this.onPointClicked({},!1),this.mode===ge.SelectingStartAngleEdge?this.fromValid=!1:this.mode===ge.SelectingEndAngleEdge&&(this.toValid=!1),this.fromEdgePicker.cancelPointSelection(),this.toEdgePicker.cancelPointSelection()}},{key:"continuePointSelectionIfNeeded",value:function(){var e=this;this.isPickerActive()&&(this.setVisible(!0),setTimeout((function(){e.centerValid||e.useFirstPointAsCenter?e.fromValid?e.toValid||(e.defaultPickingMode===ve.Edge?e.startSelectToAngleEdge():e.defaultPickingMode===ve.SinglePoint&&e.startSelectToAngle()):e.defaultPickingMode===ve.Edge?e.startSelectFromAngleEdge():e.defaultPickingMode===ve.SinglePoint&&e.startSelectFromAngle():e.startSelectCenter()}),1))}},{key:"getOffsetAngle",value:function(){if(this.fromValid&&this.toValid){var e=this.edgeToAngle(this.fromEdge.b,this.fromEdge.a);return this.edgeToAngle(this.toEdge.b,this.toEdge.a)-e}return this.offset}},{key:"createRotation",value:function(e,t,n){var i=pe.makeTranslation(-n.x,-n.y,-n.z),o=me.makeTranslation(n.x,n.y,n.z),r=ye.setFromAxisAngle(this.axis,e),s=Ee.makeRotationFromQuaternion(r);return t.copy(o).multiply(s).multiply(i)}},{key:"clear",value:function(){this.clearOnNextStart=!1,this.fromValid=!1,this.toValid=!1,this.centerValid=!1,this.fromEdgePicker.clear(),this.toEdgePicker.clear(),this.isActive=!1,this.updateGizmos()}},{key:"apply",value:function(e){var t=this;return new Promise((function(n){var i=t.getOffsetAngle();(i=Autodesk.Extensions.CompGeom.normalizeAngle(i))>Math.PI&&(i-=2*Math.PI);var o=e.getPlacementTransform().clone(),r=new Autodesk.Viewing.Private.LmvMatrix4(!0),s=e.getGlobalOffset(),a=s?t.center.clone().add(s):t.center;t.fromEdgePicker.markers[0].setDraggable(!1),t.fromEdgePicker.markers[1].setDraggable(!1),t.toEdgePicker.markers[0].setDraggable(!1),t.toEdgePicker.markers[1].setDraggable(!1),t.anim=Autodesk.Viewing.Private.fadeValue(0,1,t.animTime,(function(n){var s=THREE.Math.smootherstep(n,0,1)*i;r=t.createRotation(s,r,t.center);var l=Math.PI/2;t.setPointFromAngle(Te,-(l+s),t.angleGizmoSize,t.angleGizmo.center),t.angleGizmo.setStart(Te),t.angleGizmo.update(),n>t.fadeOutAngleGizmoAfter&&t.angleGizmo.fadeTo(0),r=t.createRotation(s,r,a).multiply(o),t.viewer.impl.setPlacementTransform(e,r)}),(function(){t.angleGizmo.setLabelEnabled(!1),t.clear(),t.anim=null,n()}))}))}},{key:"setVisible",value:function(e){e!==this.visible&&(this.visible=e,this.updateGizmos())}},{key:"setPointFromAngle",value:function(e,t,n,i){e.set(1,0,0),Autodesk.Edit2D.Math2D.rotateAround(e,t),e.multiplyScalar(n).add(i)}},{key:"changeFromAngle",value:function(e){if(this.fromValid){if(void 0!==e){var t=this.fromPointOnPlane.distanceTo(this.center);this.setPointFromAngle(this.fromEdge.b,e,t,this.center)}else this.fromValid=!1;this.updateGizmos()}}},{key:"changeToAngle",value:function(e){if(this.toValid){if(void 0!==e){var t=this.toPointOnPlane.distanceTo(this.center);this.setPointFromAngle(this.toEdge.b,e,t,this.center)}else this.toValid=!1;this.updateGizmos()}}},{key:"changeOffset",value:function(e){this.centerValid&&(this.cancelPointSelection(),this.fromValid||(this.startSelectFromAngle(),this.fromValid=!0,this.changeFromAngle(0),this.onPointClicked({point:this.fromEdge.b})),this.toValid||(this.startSelectToAngle(),this.toValid=!0,this.changeToAngle(this.edgeToAngle(this.fromEdge.b,this.fromEdge.a)+e),this.onPointClicked({point:this.toEdge.b})),this.continuePointSelectionIfNeeded())}},{key:"startSelectFromAngleEdge",value:function(){this.mode=ge.SelectingStartAngleEdge,this.fromEdgePicker.startSelect()}},{key:"startSelectToAngleEdge",value:function(){this.mode=ge.SelectingEndAngleEdge,this.toEdgePicker.startSelect()}},{key:"onEdgeSelected",value:function(e){var t=this.mode===ge.SelectingStartAngleEdge,n=this.mode===ge.SelectingEndAngleEdge;if(t||n){var i=e.points[0],o=e.points[1];if(t?(this.useFirstPointAsCenter&&this.setCenter(i),this.setFromEdge(i,o)):this.setToEdge(i,o),this.updateGizmos(),t){var r=this.edgeToAngle(o,i,!0);this.fireEvent({type:fe.FROM_ANGLE_SELECTED,angle:r})}else{var s=this.edgeToAngle(o,i,!0);this.fireEvent({type:fe.TO_ANGLE_SELECTED,angle:s})}e.areAllPointsSet()&&(this.mode=ge.NotSelecting,this.continuePointSelectionIfNeeded())}}},{key:"isPickerActive",value:function(){return this.isActive}},{key:"skipAnim",value:function(){this.anim&&this.anim.skip()}},{key:"isAnimationActive",value:function(){return this.anim&&this.anim.isRunning}}])&&he(t.prototype,n),i&&he(t,i),e}();Ae.Events=fe,Ae.Modes=ge,Ae.PickingModes=ve;var ke={en:n(326)};function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Se(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function Ce(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function we(e,t,n){return(we="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Me(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function De(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=Me(e);if(t){var o=Me(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return _e(this,n)}}function _e(e,t){return!t||"object"!==be(t)&&"function"!=typeof t?Re(e):t}function Re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Me(e){return(Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var xe=Autodesk.Viewing,Ne=(Autodesk.Viewing.Private,AutodeskNamespace("Autodesk.ModelAlignment")),Ve=function(e,t){if(e.isLeaflet())e.setThemingColor(null,t);else for(var n=e.myData.fragments.fragId2dbId,i=0;i<n.length;i++){var o=n[i];if(Array.isArray(o))for(var r=0;r<o.length;r++)e.setThemingColor(o[r],t);else e.setThemingColor(o,t)}},Le=function(e){return void 0!==e?THREE.Math.degToRad(e):void 0},He={Default:"Default",Animating:"Animating",SelectModel:"SelectModel",PointToPoint:"PointToPoint",AngleToAngle:"AngleToAngle"},Be=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(a,e);var t,n,i,o,r,s=De(a);function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this,e,t)).name="Autodesk.ModelAlignment",n.onPlacementChanged=n.onPlacementChanged.bind(Re(n)),n.onSaveButton=n.onSaveButton.bind(Re(n)),n.onTabChanged=n.onTabChanged.bind(Re(n)),n.onStateChanged=n.onStateChanged.bind(Re(n)),n}return t=a,(n=[{key:"load",value:(o=regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.extendLocalization(ke),e.next=3,we(Me(a.prototype),"load",this).call(this);case 3:this.panel=new te(this.viewer,"ModelAlignmentPanel","Model Alignment"),this.viewer.addPanel&&this.viewer.addPanel(this.panel),this.viewer.addEventListener(xe.MODEL_PLACEMENT_CHANGED_EVENT,this.onPlacementChanged),this.onModelPanelSelect=this.onModelPanelSelect.bind(this),this.pointToPoint=new de(this.viewer,this.coordPicker,this.screenOverlay),this.angleToAngle=new Ae(this.viewer,this.coordPicker,this.screenOverlay),this.modelSelector=new M(this.viewer),this.viewer.toolController.registerTool(this.modelSelector),this.connectModelsPanel(),this.connectPointToPoint(),this.connectAngleToAngle(),this.connectModelSelector(),this.connectModelMoveTool(),this.panel.addEventListener(te.Events.SAVE_BUTTON_PRESSED,this.onSaveButton),this.panel.addEventListener(te.Events.MODEL_TRANSFORM_EDITED,(function(){t.modified(),t.onTabChanged()})),this.panel.addEventListener(te.Events.TAB_CHANGED,this.onTabChanged),this.selectionColor=new THREE.Vector4(1,1,0,.25);case 20:case"end":return e.stop()}}),e,this)})),r=function(){var e=this,t=arguments;return new Promise((function(n,i){var r=o.apply(e,t);function s(e){Se(r,n,i,s,a,"next",e)}function a(e){Se(r,n,i,s,a,"throw",e)}s(void 0)}))},function(){return r.apply(this,arguments)})},{key:"unload",value:function(){we(Me(a.prototype),"unload",this).call(this),this.viewer.removePanel&&this.viewer.removePanel(this.panel),this.panel.uninitialize(),this.panel=null,this.viewer.removeEventListener(xe.MODEL_PLACEMENT_CHANGED_EVENT,this.onPlacementChanged),this.onExtensionLoaded&&this.viewer.removeEventListener(Autodesk.Viewing.EXTENSION_LOADED_EVENT,this.onExtensionLoaded),this.pointToPoint&&(this.pointToPoint.dtor(),this.pointToPoint=null),this.angleToAngle&&(this.angleToAngle=null),this.disconnectModelsPanel()}},{key:"getToolMode",value:function(){return this.isAnimationActive()?He.Animating:this.isAngleToAngleActive()?He.AngleToAngle:this.isPointToPointActive()?He.PointToPoint:this.isModelSelectorActive()?He.SelectModel:He.Default}},{key:"startAngleToAngle",value:function(){this.isAngleToAngleActive()||(this.stopTools(!0),this.angleToAngle.start(),this.onStateChanged())}},{key:"pauseAngleToAngle",value:function(){this.angleToAngle.pause(),this.onStateChanged()}},{key:"cancelAngleToAngle",value:function(){this.angleToAngle.cancel(),this.onStateChanged()}},{key:"isAngleToAngleActive",value:function(){return this.angleToAngle.isActive}},{key:"finishAngleToAngle",value:function(){var e=this;this.angleToAngle.finish(this.model).then((function(){e.modified(),e.onStateChanged()})),this.onStateChanged()}},{key:"startPointToPoint",value:function(){this.isPointToPointActive()||(this.stopTools(!0),this.pointToPoint.start(),this.onStateChanged())}},{key:"pausePointToPoint",value:function(){this.pointToPoint.pause(),this.onStateChanged()}},{key:"cancelPointToPoint",value:function(){this.pointToPoint.cancel(),this.onStateChanged()}},{key:"isPointToPointActive",value:function(){return this.pointToPoint.isActive}},{key:"finishPointToPoint",value:function(){var e=this;this.pointToPoint.finish(this.model).then((function(){e.modified(),e.onStateChanged()})),this.onStateChanged()}},{key:"startModelSelector",value:function(){this.isModelSelectorActive()||(this.stopTools(!0),this.viewer.toolController.activateTool(this.modelSelector.getName()),this.onStateChanged())}},{key:"isModelSelectorActive",value:function(){return this.modelSelector.active}},{key:"stopModelSelector",value:function(){this.isModelSelectorActive()&&(this.viewer.toolController.setIsLocked(!1),this.viewer.toolController.deactivateTool(this.modelSelector.getName()))}},{key:"startFreeTransform",value:function(){this.isFreeTransformActive()||(this.stopTools(!0),this.setTransformToolActive(!0),this.onStateChanged())}},{key:"pauseFreeTransform",value:function(){this.setTransformToolActive(!1)}},{key:"isFreeTransformActive",value:function(){var e=this.modelTransformTool.getName();return this.viewer.toolController.isToolActivated(e)}},{key:"stopTools",value:function(e){this.isPointToPointActive()&&(e?this.pausePointToPoint():this.cancelPointToPoint()),this.isAngleToAngleActive()&&(e?this.pauseAngleToAngle():this.cancelAngleToAngle()),this.isFreeTransformActive()&&this.pauseFreeTransform(),this.isModelSelectorActive()&&this.stopModelSelector()}},{key:"setModel",value:function(e){we(Me(a.prototype),"setModel",this).call(this,e),this.panel.setModel(e),this.updateColorTheming(),this.onTabChanged(),e&&this.stopModelSelector()}},{key:"isAnimationActive",value:function(){return this.pointToPoint.isAnimationActive()||this.angleToAngle.isAnimationActive()}},{key:"isResetEnabled",value:function(){return!!this.model&&!this.isPendingReset(this.model)&&(!!this.hasPendingChanges(this.model)||this.hasSavedTransform(this.model))}},{key:"resetToOriginalFileTransform",value:function(){if(!this.isResetEnabled())return!1;var e=this.getOriginalFileTransform(this.model);return this.viewer.impl.setPlacementTransform(this.model,e),this.modified(!0),!0}},{key:"getSelectableModels",value:function(){return this.panel.getSelectableModels()}},{key:"onStateChanged",value:function(){this.updateTransformTool(),this.fireEvent({type:Autodesk.ModelAlignment.Events.STATE_CHANGED})}},{key:"setTransformToolActive",value:function(e){if(this.isFreeTransformActive()!=e){var t=this.modelTransformTool.getName();e?this.viewer.toolController.activateTool(t):this.viewer.toolController.deactivateTool(t)}}},{key:"updateTransformTool",value:function(){var e=this.getToolMode(),t=this.model&&e===He.Default;this.setTransformToolActive(t)}},{key:"onTabChanged",value:function(){var e=this.panel.selectedTabId;this.onStateChanged(),e===te.TabIds.PointToPoint?this.startPointToPoint():this.cancelPointToPoint(),e===te.TabIds.AngleToAngle?this.startAngleToAngle():this.cancelAngleToAngle()}},{key:"connectModelsPanel",value:function(){var e=this,t=this.viewer.getExtension("Autodesk.ModelsPanel");if(!t)return this.onExtensionLoaded=function(t){return"Autodesk.ModelsPanel"===t.extensionId&&e.connectModelsPanel()},void this.viewer.addEventListener(Autodesk.Viewing.EXTENSION_LOADED_EVENT,this.onExtensionLoaded);this.modelsPanel=t.panel,this.modelsPanel.addEventListener(Autodesk.Viewing.UI.ListPanelEvents.ITEM_SELECT,this.onModelPanelSelect),this.modelsPanel.setModelSelectionModeEnabled(!0)}},{key:"disconnectModelsPanel",value:function(){this.modelsPanel&&(this.modelsPanel.removeEventListener(Autodesk.Viewing.UI.ListPanelEvents.ITEM_SELECT,this.onModelPanelSelect),this.modelsPanel.setModelSelectionModeEnabled(!1))}},{key:"onModelPanelSelect",value:function(e){this.setModel(e.item.model)}},{key:"connectPointToPoint",value:function(){var e=this;this.panel.addEventListener(te.Events.FROM_POINT_CHANGED,(function(t){return e.pointToPoint.setFrom(t.fromPoint)})),this.panel.addEventListener(te.Events.TO_POINT_CHANGED,(function(t){return e.pointToPoint.setTo(t.toPoint)})),this.panel.addEventListener(te.Events.OFFSET_CHANGED,(function(t){return e.pointToPoint.setOffset(t.offset)})),this.panel.addEventListener(te.Events.FROM_POINT_BUTTON_PRESSED,(function(){return e.pointToPoint.startSelectFrom()})),this.panel.addEventListener(te.Events.TO_POINT_BUTTON_PRESSED,(function(){return e.pointToPoint.startSelectTo()})),this.panel.addEventListener(te.Events.APPLY_PTP_PRESSED,(function(){e.pointToPoint.apply(e.panel.model),e.modified()})),this.panel.addEventListener(te.Events.FIT_TO_VIEW_BUTTON_PRESSED,(function(){e.pointToPoint.fitModelToView(e.panel.model),e.modified()})),this.pointToPoint.addEventListener(de.Events.FROM_POINT_SELECTED,(function(t){return e.panel.onFromSelected(t.point)})),this.pointToPoint.addEventListener(de.Events.FROM_POINT_HOVERED,(function(t){return e.panel.onFromHovered(t.point)})),this.pointToPoint.addEventListener(de.Events.TO_POINT_HOVERED,(function(t){return e.panel.onToHovered(t.point)})),this.pointToPoint.addEventListener(de.Events.TO_POINT_SELECTED,(function(t){return e.panel.onToSelected(t.point)}))}},{key:"connectAngleToAngle",value:function(){var e=this;this.panel.addEventListener(te.Events.MODEL_SELECTED,(function(){return e.setModel(e.panel.model)})),this.panel.addEventListener(te.Events.CENTER_CHANGED,(function(t){return e.angleToAngle.setCenter(t.center)})),this.panel.addEventListener(te.Events.FROM_ANGLE_CHANGED,(function(t){return e.angleToAngle.changeFromAngle(Le(t.angle))})),this.panel.addEventListener(te.Events.TO_ANGLE_CHANGED,(function(t){return e.angleToAngle.changeToAngle(Le(t.angle))})),this.panel.addEventListener(te.Events.OFFSET_ANGLE_CHANGED,(function(t){return e.angleToAngle.changeOffset(Le(t.angle))})),this.panel.addEventListener(te.Events.CENTER_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectCenter()})),this.panel.addEventListener(te.Events.FROM_ANGLE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectFromAngle()})),this.panel.addEventListener(te.Events.TO_ANGLE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectToAngle()})),this.panel.addEventListener(te.Events.FROM_EDGE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectFromAngleEdge()})),this.panel.addEventListener(te.Events.TO_EDGE_BUTTON_PRESSED,(function(){return e.angleToAngle.startSelectToAngleEdge()})),this.panel.addEventListener(te.Events.APPLY_ATA_PRESSED,(function(){e.angleToAngle.apply(e.panel.model),e.modified()})),this.angleToAngle.addEventListener(Ae.Events.CENTER_HOVERED,(function(t){return e.panel.onCenterHovered(t.point)})),this.angleToAngle.addEventListener(Ae.Events.CENTER_SELECTED,(function(t){return e.panel.onCenterSelected(t.point)})),this.angleToAngle.addEventListener(Ae.Events.FROM_ANGLE_HOVERED,(function(t){return e.panel.onFromAngleHovered(t.angle)})),this.angleToAngle.addEventListener(Ae.Events.FROM_ANGLE_SELECTED,(function(t){return e.panel.onFromAngleSelected(t.angle)})),this.angleToAngle.addEventListener(Ae.Events.TO_ANGLE_HOVERED,(function(t){return e.panel.onToAngleHovered(t.angle)})),this.angleToAngle.addEventListener(Ae.Events.TO_ANGLE_SELECTED,(function(t){return e.panel.onToAngleSelected(t.angle)}))}},{key:"connectModelMoveTool",value:function(){var e=this;this.panel.addEventListener(te.Events.EDIT_POSITION_PRESSED,(function(){return e.viewer.toolController.activateTool(e.modelTransformTool.getName())}))}},{key:"connectModelSelector",value:function(){var e=this;this.panel.addEventListener(te.Events.SELECT_MODEL_PRESSED,(function(t){e.startModelSelector()})),this.modelSelector.addEventListener(M.Events.MODEL_SELECTED,(function(t){t.model||!e.model?e.setModel(t.model):e.stopModelSelector()}))}},{key:"updateColorTheming",value:function(){for(var e=this.model&&this.model.myData.urn,t=function(t){return e&&t.myData.urn===e},n=this.viewer.getVisibleModels(),i=0;i<n.length;i++){var o=n[i];o.isLeaflet()||(t(o)?Ve(o,this.selectionColor):this.viewer.clearThemingColors(o))}this.viewer.impl.invalidate(!0)}},{key:"onSaveButton",value:function(){this.pointToPoint.skipAnim(),this.angleToAngle.skipAnim(),we(Me(a.prototype),"onSaveButton",this).call(this)}},{key:"onPlacementChanged",value:function(e){e.model===this.model&&(this.panel.updateMatrix(),this.syncAlignments())}},{key:"syncAlignments",value:function(){if(this.model&&!this.model.is2d())for(var e=this.model.myData.urn,t=this.model.getPlacementTransform(),n=this.viewer.getVisibleModels(),i=0;i<n.length;i++){var o=n[i],r=o.myData.urn==e&&o!==this.model;o.is3d()&&r&&this.viewer.impl.setPlacementTransform(o,t)}}}])&&Ce(t.prototype,n),i&&Ce(t,i),a}(C);Be.ToolModes=He,Ne.ModelAlignment=Be,Ne.ModelAlignmentPanel=te,Ne.AngleToAngle=Ae,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.ModelAlignment",Be);var Ie,Fe,Ge,ze,je,Ue,We,Qe,Ye,Ke,qe=(Ie=new THREE.Quaternion,Fe=new THREE.Quaternion,Ge=new THREE.Quaternion,ze=new THREE.Matrix4,je=new THREE.Matrix4,Ue=new THREE.Matrix4,We=new THREE.Vector3,Qe=new THREE.Vector3,Ye=new THREE.Matrix4,Ke=new THREE.Matrix4,function(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},r=o.onChange,s=o.onEnd,a=o.applyTranslation,l=void 0===a||a,c=o.applyRotation,u=void 0===c||c,d=o.applyScale,h=void 0===d||d,f=o.duration,g=void 0===f?1:f,v=o.originalMatrix?o.originalMatrix.clone():void 0,p=n.clone().sub(e),m=e.distanceTo(t),E=n.distanceTo(i),y=E/m,T=t.clone().sub(e).normalize(),P=i.clone().sub(n).normalize();Ie.setFromUnitVectors(T,P),Ye.identity().setPosition(e),Ke.identity().setPosition(e.clone().multiplyScalar(-1));var A=function(e){if(e=THREE.Math.smootherstep(e,0,1),je.identity(),l&&(We.lerpVectors(Qe,p,e),je.makeTranslation(We.x,We.y,We.z)),je.multiply(Ye),u&&(THREE.Quaternion.slerp(Fe,Ie,Ge,e),Ue.makeRotationFromQuaternion(Ge),je.multiply(Ue)),h){var t=Autodesk.Viewing.Private.lerp(1,y,e);ze.makeScale(t,t,t),je.multiply(ze)}je.multiply(Ke),v&&je.multiply(v),r&&r(je)},k=Autodesk.Viewing.Private.fadeValue(0,1,g,A,s);return k}),Xe=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Quaternion,r=new THREE.Quaternion,s=new THREE.Vector3,a=new THREE.Vector3,l=new THREE.Quaternion;return function(c,u,d,h){return c.decompose(e,o,n),u.decompose(t,r,i),s.lerpVectors(e,t,d),a.lerpVectors(n,i,d),THREE.Quaternion.slerp(o,r,l,d),h.compose(s,l,a),h}}();function Ze(e){return(Ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Je(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function $e(e,t){return($e=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function et(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=nt(e);if(t){var o=nt(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return tt(this,n)}}function tt(e,t){return!t||"object"!==Ze(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function nt(e){return(nt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var it={SOURCE_POINT_SELECTION_STARTED:"sourcePointSelectionStarted",DEST_POINT_SELECTION_STARTED:"destPointSelectionStarted"},ot=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$e(e,t)}(r,Autodesk.Edit3D.NPointPicker);var t,n,i,o=et(r);function r(e,t,n){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var s={width:"34px",height:"34px",padding:"7px",boxSizing:"border-box",borderRadius:"20px",border:"1px solid",backgroundColor:Autodesk.Edit3D.NPointPicker.Colors.White},a=Object.assign({},s,{borderColor:Autodesk.Edit3D.NPointPicker.Colors.Blue,color:Autodesk.Edit3D.NPointPicker.Colors.Blue}),l=Object.assign({},s,{borderColor:Autodesk.Edit3D.NPointPicker.Colors.Red,color:Autodesk.Edit3D.NPointPicker.Colors.Red}),c={draggable:!0,colors:[Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Red,Autodesk.Edit3D.NPointPicker.Colors.Blue,Autodesk.Edit3D.NPointPicker.Colors.Red],icons:[Autodesk.Edit3D.PointMarker.Icons.Circle,Autodesk.Edit3D.PointMarker.Icons.Circle,Autodesk.Edit3D.PointMarker.Icons.Circle,Autodesk.Edit3D.PointMarker.Icons.Circle],labels:["1","2","1","2"],labelStyles:[a,l,a,l],connections:[{fromIndex:0,toIndex:2,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Line,color:Autodesk.Edit3D.NPointPicker.Colors.Blue},{fromIndex:1,toIndex:3,type:Autodesk.Edit3D.NPointPicker.ConnectorTypes.Line,color:Autodesk.Edit3D.NPointPicker.Colors.Red}]};return(i=o.call(this,e,t,n,4,c)).tmpVec=new THREE.Vector3,i.addEventListener(Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTION_STARTED,(function(e){var t=e.index;0!==t||i.pointValid[0]?2!==t||i.pointValid[2]||i.fireEvent({type:it.DEST_POINT_SELECTION_STARTED}):i.fireEvent({type:it.SOURCE_POINT_SELECTION_STARTED})})),i}return t=r,(n=[{key:"apply",value:function(e,t){var n=this;if(!this.anim){var i={transform:e.getPlacementTransform().clone(),model:e,s0:this.points[0].clone(),s1:this.points[1].clone(),t0:this.points[2].clone(),t1:this.points[3].clone()},o=e.getPlacementTransform().clone(),r=this.points[0].clone(),s=this.points[1].clone(),a=this.points[2].clone(),l=this.points[3].clone();t&&(a.add(t),l.add(t)),this.anim=qe(r,s,a,l,{onChange:function(t){n.setPoint(0,n.tmpVec.copy(r).applyMatrix4(t)),n.setPoint(1,n.tmpVec.copy(s).applyMatrix4(t)),n.viewer.impl.setPlacementTransform(e,t.multiply(o))},onEnd:function(){n.alignmentBackup=i,n.anim=null,n.clear()}})}}},{key:"restorePreviousTransform",value:function(e){var t=this;if(this.alignmentBackup&&!this.anim){var n=this.alignmentBackup,i=n.transform,o=n.model,r=n.s0,s=n.s1,a=n.t0,l=n.t1;this.anim=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.onChange,o=n.onEnd,r=n.duration,s=void 0===r?1:r,a=new Autodesk.Viewing.Private.LmvMatrix4(t.isDoublePrecision),l=function(n){n=Autodesk.Viewing.Private.smootherStep(n),Xe(e,t,n,a),i&&i(a)};return Autodesk.Viewing.Private.fadeValue(0,1,s,l,o)}(o.getPlacementTransform().clone(),i,{onChange:function(e){t.viewer.impl.setPlacementTransform(o,e)},onEnd:function(){e?(t.setPoint(0,r),t.setPoint(1,s),t.setPoint(2,a),t.setPoint(3,l),t.lastSelectedPoint=3,t.anim=null,t.clearAlignmentBackup(),t.startSelect(),t.fireEvent({type:Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTED,point:a,index:3})):(t.anim=null,t.clearAlignmentBackup())}})}}},{key:"hasAlignmentBackup",value:function(){return!!this.alignmentBackup}},{key:"clearAlignmentBackup",value:function(){this.alignmentBackup=null}},{key:"skipAnim",value:function(){var e;null===(e=this.anim)||void 0===e||e.skip()}},{key:"isSelectingSourcePointsDone",value:function(){return 0!==this.selectingIndex&&1!==this.selectingIndex&&this.pointValid[0]&&this.pointValid[1]}},{key:"isAnimationActive",value:function(){var e;return null===(e=this.anim)||void 0===e?void 0:e.isRunning}}])&&Je(t.prototype,n),i&&Je(t,i),r}();ot.Events=it;var rt={en:n(327)},st=n(12);function at(e){return(at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lt(e,t,n,i,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function ct(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function s(e){lt(r,i,o,s,a,"next",e)}function a(e){lt(r,i,o,s,a,"throw",e)}s(void 0)}))}}function ut(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function dt(e,t,n){return(dt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=pt(e)););return e}(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}function ht(e,t){return(ht=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=pt(e);if(t){var o=pt(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return gt(this,n)}}function gt(e,t){return!t||"object"!==at(t)&&"function"!=typeof t?vt(e):t}function vt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pt(e){return(pt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var mt=AutodeskNamespace("Autodesk.SheetAlignment"),Et={ADD_DRAWING_CLICKED:"addDrawingClicked"},yt=Autodesk.Viewing,Tt=(Autodesk.Viewing.Private,function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ht(e,t)}(a,e);var t,n,i,o,r,s=ft(a);function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this,e,t)).name="Autodesk.SheetAlignment",n.tmpBox=new THREE.Box3,n.onCropChanged=n.onCropChanged.bind(vt(n)),n.fadeDuration=.3,n}return t=a,(n=[{key:"load",value:(r=ct(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.extendLocalization(rt),this.model=null,this.target3DModel=null,e.next=5,dt(pt(a.prototype),"load",this).call(this);case 5:return e.next=7,this.viewer.loadExtension("Autodesk.Crop",{disableMoveTool:!0});case 7:this.cropExtension=e.sent,this.cropExtension.addEventListener(Autodesk.Crop.Events.CROP_MODIFIED,this.onCropChanged),this.fourPointsAlignment=new ot(this.viewer,this.coordPicker,this.screenOverlay),this.onPointSelectionStarted=this.onPointSelectionStarted.bind(this),this.onPointPicked=this.onPointPicked.bind(this),this.fourPointsAlignment.addEventListener(Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTION_STARTED,this.onPointSelectionStarted),this.fourPointsAlignment.addEventListener(Autodesk.Edit3D.NPointPicker.Events.POINT_SELECTED,this.onPointPicked),this.onContextMenu=this.onContextMenu.bind(this),this.viewer.registerContextMenuCallback("Autodesk.SheetAlignment",this.onContextMenu),this.targetPos=null,this.targetNormal=null,this.animationHandleMap={};case 19:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"unload",value:function(){dt(pt(a.prototype),"unload",this).call(this),this.fourPointsAlignment&&(this.fourPointsAlignment.dtor(),this.fourPointsAlignment=null),this.cropExtension.removeEventListener(Autodesk.Crop.Events.CROP_MODIFIED,this.onCropChanged),this.model=null,this.target3DModel=null,this.viewer.unregisterContextMenuCallback("Autodesk.SheetAlignment"),this.animationHandleMap={}}},{key:"getRightVector",value:function(e){var t=this.viewer.navigation.getWorldUpVector(),n=new THREE.Vector3;return n.crossVectors(e,t),n.lengthSq()<1e-4&&(Math.abs(e.z)>=Math.abs(e.y)?t.set(0,1,0):t.set(0,0,1),n.crossVectors(e,t)),n.normalize()}},{key:"applyInitialSheetTransform",value:function(){if(this.targetPos&&this.targetNormal){var e=this.model.getBoundingBox(!0,!0).center(),t=this.targetNormal.clone().negate(),n=this.targetPos.sub(e).sub(t.clone().multiplyScalar(1e-4)),i=this.getRightVector(t).cross(t).normalize(),o=new THREE.Matrix4;o.lookAt(new THREE.Vector3,t,i);var r=(new THREE.Matrix4).makeTranslation(-e.x,-e.y,-e.z),s=(new THREE.Matrix4).makeTranslation(e.x,e.y,e.z),a=(new THREE.Matrix4).makeTranslation(n.x,n.y,n.z).multiply(s).multiply(o).multiply(r);this.viewer.impl.setPlacementTransform(this.model,a),this.modified(),this.targetPos=null}}},{key:"setModel",value:function(e){this.model!==e&&(this.cropExtension.setModel(e),this.cropExtension.cropToModelBounds(!0),dt(pt(a.prototype),"setModel",this).call(this,e),this.model.setDoNotCut(this.viewer.impl.matman(),!0),this.fourPointsAlignment.clear(),this.modelTransformTool.setModel(e,this.getMinCroppedBox()),this.applyInitialSheetTransform())}},{key:"setTarget3DModel",value:function(e){this.target3DModel=e}},{key:"onSaveButton",value:function(){this.fourPointsAlignment.skipAnim(),dt(pt(a.prototype),"onSaveButton",this).call(this)}},{key:"startPointToPointSelection",value:function(){this.fourPointsAlignment.startSelect()}},{key:"applyPointsToPoints",value:function(){var e;this.transformBackup=this.model.getPlacementTransform().clone();var t=null===(e=this.targetNormal)||void 0===e?void 0:e.clone().multiplyScalar(1e-4);this.fourPointsAlignment.apply(this.model,t),this.cropExtension.deactivate(),this.modified()}},{key:"restorePreviousTransform",value:function(e){this.fourPointsAlignment.restorePreviousTransform(e)}},{key:"cancel",value:function(){this.restorePreviousTransform(),this.fourPointsAlignment.clearAlignmentBackup(),this.fourPointsAlignment.clear()}},{key:"areAllPointsSet",value:function(){return this.fourPointsAlignment.areAllPointsSet()}},{key:"fitCameraToSheet",value:function(){var e=this;if(this.model){this.viewer.navigation.toOrthographic();var t=this.getMinCroppedBox(),n=t.size();t.expandByVector(new THREE.Vector3(n.x*this.viewer.navigation.FIT_TO_VIEW_HORIZONTAL_MARGIN,n.y*this.viewer.navigation.FIT_TO_VIEW_VERTICAL_MARGIN,0));var i=this.model.getModelToViewerTransform()||new THREE.Matrix4,o=t.center(),r=o.clone().applyMatrix4(i),s=o;s.z-=t.size().y,s.applyMatrix4(i);var a=new THREE.Matrix4;a.extractRotation(i);var l={position:r,target:s,up:new THREE.Vector3(0,1,0).applyMatrix4(a).normalize()};return new Promise((function(t){Autodesk.Viewing.Private.flyToView(e.viewer,l,.5,t,!1)}))}}},{key:"fitCameraToTargetModel",value:function(){if(this.target3DModel){var e=(new THREE.Box3).copy(this.target3DModel.getBoundingBox());this.viewer.navigation.fitBounds(!1,e,!1)}}},{key:"show",value:function(){this.model&&!this.active&&(this.active=!0,this.fourPointsAlignment.setVisible(!0),this.fourPointsAlignment.continuePointSelectionIfNeeded(),this.cropExtension.activate())}},{key:"hide",value:function(){this.active&&(this.active=!1,this.fourPointsAlignment.cancelPointSelection(),this.fourPointsAlignment.setVisible(!1),this.cropExtension.deactivate(),this.viewer.toolController.deactivateTool(this.modelTransformTool.getName()),this.clearIsolation())}},{key:"getMinCroppedBox",value:function(){var e;if(!this.model)return null;var t=this.tmpBox.copy(this.model.getBoundingBox(!0)),n=null===(e=this.cropExtension.getCurrentCropRegion())||void 0===e?void 0:e.bbox;return n&&t.intersect(n),t}},{key:"onCropChanged",value:function(){var e=this.getMinCroppedBox();this.modelTransformTool.setModel(this.model,e);var t=this.cropExtension.getCurrentCropRegion();this.modified(t)}},{key:"onPointSelectionStarted",value:function(e){var t=e.index;0===t||1===t?this.isolate2DSheet():this.isolate3DModel(),this.cropExtension.activate()}},{key:"onPointPicked",value:function(){this.fourPointsAlignment.areAllPointsSet()&&this.clearIsolation()}},{key:"isolate2DSheet",value:function(){this.animateModelVisibility(this.model,!0),this.animateModelVisibility(this.target3DModel,!1)}},{key:"isolate3DModel",value:function(){this.animateModelVisibility(this.model,!1),this.animateModelVisibility(this.target3DModel,!0)}},{key:"clearIsolation",value:function(){this.animateModelVisibility(this.model,!0),this.animateModelVisibility(this.target3DModel,!0)}},{key:"isAnimationActive",value:function(){return this.fourPointsAlignment.isAnimationActive()}},{key:"animateModelVisibility",value:function(e,t){return e.is2d()?this.animateModelVisibility2D(e,t):this.animateModelVisibility3D(e,t)}},{key:"animateModelVisibility2D",value:function(e,t){e.visibilityManager.setAllVisibility(t),this.viewer.impl.changePaperVisibility(e,!1)}},{key:"animateModelVisibility3D",value:function(e,t){var n=this;t&&e.visibilityManager.setAllVisibility(!0);var i=this.viewer.impl.matman(),o=Object.values(i.getModelMaterials(e,!0).mats),r=this.viewer.impl.fadeMaterial.opacity,s=function(e){o.forEach((function(n){var i=n.opacity,o=t?n.origOpacity:r;n.opacity=(1-e)*i+o*e})),n.viewer.impl.invalidate(!0)};return this.animationHandleMap[e.id]&&(this.animationHandleMap[e.id].stop(),delete this.animationHandleMap[e.id]),o.forEach((function(e){void 0===e.origOpacity&&(e.origOpacity=e.opacity,e.origTransparent=e.transparent,e.transparent=!0)})),new Promise((function(i){n.animationHandleMap[e.id]=Autodesk.Viewing.Private.fadeValue(0,1,n.fadeDuration,s,(function(){t?o.forEach((function(e){e.opacity=e.origOpacity,e.transparent=e.origTransparent,delete e.origOpacity,delete e.origTransparent})):e.visibilityManager.setAllVisibility(!1),delete n.animationHandleMap[e.id],i()}))}))}},{key:"mirrorX",value:function(){var e=this.model.getPlacementTransform(),t=new THREE.Matrix4;t.elements[5]=-1;var n=this.model.getBoundingBox(!0,!0).size(),i=(new THREE.Matrix4).makeTranslation(0,-n.y,0);e.multiply(t).multiply(i),this.viewer.impl.setPlacementTransform(this.model,e)}},{key:"mirrorY",value:function(){var e=this.model.getPlacementTransform(),t=new THREE.Matrix4;t.elements[0]=-1;var n=this.model.getBoundingBox(!0,!0).size(),i=(new THREE.Matrix4).makeTranslation(-n.x,0,0);e.multiply(t).multiply(i),this.viewer.impl.setPlacementTransform(this.model,e)}},{key:"onContextMenu",value:function(e,t){var n,i,o=this,r=this.viewer.impl.hitTest(t.canvasX,t.canvasY,!1);if((null==r||null===(n=r.model)||void 0===n?void 0:n.is3d())&&!this.fourPointsAlignment.isPickerActive()&&(null==r||null===(i=r.face)||void 0===i?void 0:i.normal)){var s=r.point,a=this.viewer.impl.getRenderProxy(r.model,r.fragId),l=(new THREE.Matrix3).getNormalMatrix(a.matrixWorld),c=r.face.normal.clone().applyMatrix3(l).normalize(),u=function(){var e=ct(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.setModel(t),e.next=3,o.fitCameraToSheet();case 3:o.viewer.impl.changePaperVisibility(o.model,!1,!0,(function(){o.startPointToPointSelection()}),1);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),d={title:"Add drawing",target:function(){o.viewer.clearSelection(),o.targetPos=s,o.targetNormal=c,o.setTarget3DModel(r.model),o.fireEvent({type:Et.ADD_DRAWING_CLICKED,onSheetLoaded:u})}};e.push(d)}}},{key:"saveChanges",value:(o=ct(regeneratorRuntime.mark((function e(t){var n,i,o,r,s,a,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.model&&this.target3DModel){e.next=2;break}return e.abrupt("return");case 2:return n=this.model.getPlacementTransform(),i=this.model.getDocumentNode(),o=i.getRootNode().urn(),r=yt.toUrlSafeBase64(i.name()),s=this.target3DModel.getDocumentNode(),a=s.getRootNode().urn(),l=yt.toUrlSafeBase64(s.name()),c=this.cropExtension.getCurrentCropRegion(),this.model.regionId=this.model.regionId||Object(st.v4)(),e.next=13,t.saveRelationship(a,l,o,r,this.model.regionId);case 13:return e.next=15,t.saveViewport(o,r,this.model.regionId,c.bbox,c.units);case 15:return e.next=17,t.saveTransform(o,r,this.model.regionId,n);case 17:this.pendingChanges=[],this.fourPointsAlignment.clearAlignmentBackup();case 19:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})}])&&ut(t.prototype,n),i&&ut(t,i),a}(C));mt.SheetAlignment=Tt,mt.Events=Et,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.SheetAlignment",Tt)}});
//# sourceMappingURL=ModelAlignment.min.js.map