/*!
 * LMV v7.29.0
 * 
 * Copyright 2020 Autodesk, Inc.
 * All rights reserved.
 * 
 * This computer source code and related instructions and comments are the
 * unpublished confidential and proprietary information of Autodesk, Inc.
 * and are protected under Federal copyright and state trade secret law.
 * They may not be disclosed to, copied or used by any third party without
 * the prior written consent of Autodesk, Inc.
 * 
 * Autodesk Forge Viewer Usage Limitations:
 * 
 * The Autodesk Forge viewer can only be used to view files generated by
 * Autodesk Forge services. The Autodesk Forge Viewer JavaScript must be
 * delivered from an Autodesk hosted URL.
 */
Autodesk.Extensions.Section=function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=616)}({13:function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},14:function(t,e){(function(e){t.exports=e}).call(this,{})},21:function(t,e,n){(function(i){var o;function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}
/**
                                                                                                                                                                                                                                                                                                                                                                                * @license
                                                                                                                                                                                                                                                                                                                                                                                * Lodash (Custom Build) <https://lodash.com/>
                                                                                                                                                                                                                                                                                                                                                                                * Build: `lodash include="debounce,throttle" exports="amd"`
                                                                                                                                                                                                                                                                                                                                                                                * Copyright JS Foundation and other contributors <https://js.foundation/>
                                                                                                                                                                                                                                                                                                                                                                                * Released under MIT license <https://lodash.com/license>
                                                                                                                                                                                                                                                                                                                                                                                * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
                                                                                                                                                                                                                                                                                                                                                                                * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
                                                                                                                                                                                                                                                                                                                                                                                */(function(){var a=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,l=/^0o[0-7]+$/i,h=parseInt,u="object"==(void 0===i?"undefined":r(i))&&i&&i.Object===Object&&i,E="object"==("undefined"==typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,p=u||E||Function("return this")(),d=Object.prototype,m=d.hasOwnProperty,f=d.toString,v=p.Symbol,y=v?v.toStringTag:void 0,T=Math.max,w=Math.min;function g(){}function R(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":y&&y in Object(t)?function(t){var e=m.call(t,y),n=t[y];try{t[y]=void 0;var i=!0}catch(t){}var o=f.call(t);i&&(e?t[y]=n:delete t[y]);return o}(t):function(t){return f.call(t)}(t)}var H=function(){return p.Date.now()};function x(t,e,n){var i,o,r,a,s,c,l=0,h=!1,u=!1,E=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var n=i,r=o;return i=o=void 0,l=e,a=t.apply(r,n)}function d(t){return l=t,s=setTimeout(f,e),h?p(t):a}function m(t){var n=t-c;return void 0===c||n>=e||n<0||u&&t-l>=r}function f(){var t=H();if(m(t))return v(t);s=setTimeout(f,function(t){var n=e-(t-c);return u?w(n,r-(t-l)):n}(t))}function v(t){return s=void 0,E&&i?p(t):(i=o=void 0,a)}function y(){var t=H(),n=m(t);if(i=arguments,o=this,c=t,n){if(void 0===s)return d(c);if(u)return s=setTimeout(f,e),p(c)}return void 0===s&&(s=setTimeout(f,e)),a}return e=S(e)||0,b(n)&&(h=!!n.leading,r=(u="maxWait"in n)?T(S(n.maxWait)||0,e):r,E="trailing"in n?!!n.trailing:E),y.cancel=function(){void 0!==s&&clearTimeout(s),l=0,i=c=o=s=void 0},y.flush=function(){return void 0===s?a:v(H())},y}function b(t){var e=r(t);return null!=t&&("object"==e||"function"==e)}function M(t){return null!=t&&"object"==r(t)}function P(t){return"symbol"==r(t)||M(t)&&"[object Symbol]"==R(t)}function S(t){if("number"==typeof t)return t;if(P(t))return NaN;if(b(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=b(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var n=c.test(t);return n||l.test(t)?h(t.slice(2),n?2:8):s.test(t)?NaN:+t}g.debounce=x,g.throttle=function(t,e,n){var i=!0,o=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return b(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),x(t,e,{leading:i,maxWait:e,trailing:o})},g.isObject=b,g.isObjectLike=M,g.isSymbol=P,g.now=H,g.toNumber=S,g.VERSION="4.17.5","object"==r(n(14))&&n(14)&&(void 0===(o=function(){return g}.call(e,n,e,t))||(t.exports=o))}).call(this)}).call(this,n(13))},350:function(t,e,n){var i=n(351);"string"==typeof i&&(i=[[t.i,i,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};n(5)(i,o);i.locals&&(t.exports=i.locals)},351:function(t,e,n){(t.exports=n(4)(!1)).push([t.i,".sectionPanel{line-height:14px;text-align:left;z-index:10}.section-horizontal-divider{height:1px;border-top:1px solid rgba(200,200,200,0.8)}.section-submenu-select{display:block;position:relative;width:calc(100% - 40px);padding:10px 20px 0px 20px;opacity:0.3}.section-panel:hover .section-submenu-select{opacity:0.8}.section-submenu-selectlabel{position:relative;display:inline-block;padding-right:20px;padding-bottom:4px}.section-restart{margin:10px 20px 15px 20px;padding:6px 10px 6px 10px;width:calc(100% - 55px);cursor:pointer}.docking-panel:hover .section-restart{background-color:rgba(255,255,255,0.12)}.docking-panel .section-restart:hover{background-color:rgba(166,194,255,0.7);-webkit-transition:all 0.2s ease;-moz-transition:all 0.2s ease;-ms-transition:all 0.2s ease;-o-transition:all 0.2s ease;transition:all 0.2s ease}\n",""])},4:function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var o=(a=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),r=i.sources.map((function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"}));return[n].concat(r).concat([o]).join("\n")}var a;return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n})).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(i[r]=!0)}for(o=0;o<t.length;o++){var a=t[o];"number"==typeof a[0]&&i[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},5:function(t,e,n){var i,o,r={},a=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=i.apply(this,arguments)),o}),s=function(t,e){return e?e.querySelector(t):document.querySelector(t)},c=function(t){var e={};return function(t,n){if("function"==typeof t)return t();if(void 0===e[t]){var i=s.call(this,t,n);if(window.HTMLIFrameElement&&i instanceof window.HTMLIFrameElement)try{i=i.contentDocument.head}catch(t){i=null}e[t]=i}return e[t]}}(),l=null,h=0,u=[],E=n(6);function p(t,e){for(var n=0;n<t.length;n++){var i=t[n],o=r[i.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](i.parts[a]);for(;a<i.parts.length;a++)o.parts.push(T(i.parts[a],e))}else{var s=[];for(a=0;a<i.parts.length;a++)s.push(T(i.parts[a],e));r[i.id]={id:i.id,refs:1,parts:s}}}}function d(t,e){for(var n=[],i={},o=0;o<t.length;o++){var r=t[o],a=e.base?r[0]+e.base:r[0],s={css:r[1],media:r[2],sourceMap:r[3]};i[a]?i[a].parts.push(s):n.push(i[a]={id:a,parts:[s]})}return n}function m(t,e){var n=c(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=u[u.length-1];if("top"===t.insertAt)i?i.nextSibling?n.insertBefore(e,i.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),u.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=c(t.insertAt.before,n);n.insertBefore(e,o)}}function f(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=u.indexOf(t);e>=0&&u.splice(e,1)}function v(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var i=function(){0;return n.nc}();i&&(t.attrs.nonce=i)}return y(e,t.attrs),m(t,e),e}function y(t,e){Object.keys(e).forEach((function(n){t.setAttribute(n,e[n])}))}function T(t,e){var n,i,o,r;if(e.transform&&t.css){if(!(r="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=r}if(e.singleton){var a=h++;n=l||(l=v(e)),i=R.bind(null,n,a,!1),o=R.bind(null,n,a,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",y(e,t.attrs),m(t,e),e}(e),i=x.bind(null,n,e),o=function(){f(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(e),i=H.bind(null,n),o=function(){f(n)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else o()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=a()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=d(t,e);return p(n,e),function(t){for(var i=[],o=0;o<n.length;o++){var a=n[o];(s=r[a.id]).refs--,i.push(s)}t&&p(d(t,e),e);for(o=0;o<i.length;o++){var s;if(0===(s=i[o]).refs){for(var c=0;c<s.parts.length;c++)s.parts[c]();delete r[s.id]}}}};var w,g=(w=[],function(t,e){return w[t]=e,w.filter(Boolean).join("\n")});function R(t,e,n,i){var o=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=g(e,o);else{var r=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function H(t,e){var n=e.css,i=e.media;if(i&&t.setAttribute("media",i),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function x(t,e,n){var i=n.css,o=n.sourceMap,r=void 0===e.convertToAbsoluteUrls&&o;(e.convertToAbsoluteUrls||r)&&(i=E(i)),o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([i],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}},6:function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,i=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var o,r=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(r)?t:(o=0===r.indexOf("//")?r:0===r.indexOf("/")?n+r:i+r.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},616:function(t,e,n){"use strict";function i(){var t=function(t){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};t.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var e=function(t){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(t),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(t){t?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};e.prototype=Object.create(THREE.LineBasicMaterial.prototype),void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(t,e,n,i){THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i},n=n||1,i=i||0;for(var o=this,r=0,a=t.length;r<a;r+=3)w(new THREE.Vector3(t[r],t[r+1],t[r+2]));var s=this.vertices,c=[],l=(r=0,0);for(a=e.length;r<a;r+=3,l++){var h=s[e[r]],u=s[e[r+1]],E=s[e[r+2]];c[l]=new THREE.Face3(h.index,u.index,E.index,[h.clone(),u.clone(),E.clone()])}var p=new THREE.Vector3;for(r=0,a=c.length;r<a;r++)R(c[r],i);for(r=0,a=this.faceVertexUvs[0].length;r<a;r++){var d=this.faceVertexUvs[0][r],m=d[0].x,f=d[1].x,v=d[2].x,y=Math.max(m,Math.max(f,v)),T=Math.min(m,Math.min(f,v));y>.9&&T<.1&&(m<.2&&(d[0].x+=1),f<.2&&(d[1].x+=1),v<.2&&(d[2].x+=1))}for(r=0,a=this.vertices.length;r<a;r++)this.vertices[r].multiplyScalar(n);function w(t){var e=t.normalize().clone();e.index=o.vertices.push(e)-1;var n=H(t)/2/Math.PI+.5,i=function(t){return Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))}(t)/Math.PI+.5;return e.uv=new THREE.Vector2(n,1-i),e}function g(t,e,n){var i=new THREE.Face3(t.index,e.index,n.index,[t.clone(),e.clone(),n.clone()]);o.faces.push(i),p.copy(t).add(e).add(n).divideScalar(3);var r=H(p);o.faceVertexUvs[0].push([x(t.uv,t,r),x(e.uv,e,r),x(n.uv,n,r)])}function R(t,e){for(var n=Math.pow(2,e),i=(Math.pow(4,e),w(o.vertices[t.a])),r=w(o.vertices[t.b]),a=w(o.vertices[t.c]),s=[],c=0;c<=n;c++){s[c]=[];for(var l=w(i.clone().lerp(a,c/n)),h=w(r.clone().lerp(a,c/n)),u=n-c,E=0;E<=u;E++)s[c][E]=0==E&&c==n?l:w(l.clone().lerp(h,E/u))}for(c=0;c<n;c++)for(E=0;E<2*(n-c)-1;E++){var p=Math.floor(E/2);E%2==0?g(s[c][p+1],s[c+1][p],s[c][p]):g(s[c][p+1],s[c+1][p+1],s[c+1][p])}}function H(t){return Math.atan2(t.z,-t.x)}function x(t,e,n){return n<0&&1===t.x&&(t=new THREE.Vector2(t.x-1,t.y)),0===e.x&&0===e.z&&(t=new THREE.Vector2(n/2/Math.PI+.5,t.y)),t.clone()}this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,n)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(t,e){this.parameters={radius:t,detail:e};THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(t,e,n,i,o){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:o},t=t||100,e=e||40,n=n||8,i=i||6,o=o||2*Math.PI;for(var r=new THREE.Vector3,a=[],s=[],c=0;c<=n;c++)for(var l=0;l<=i;l++){var h=l/i*o,u=c/n*Math.PI*2;r.x=t*Math.cos(h),r.y=t*Math.sin(h);var E=new THREE.Vector3;E.x=(t+e*Math.cos(u))*Math.cos(h),E.y=(t+e*Math.cos(u))*Math.sin(h),E.z=e*Math.sin(u),this.vertices.push(E),a.push(new THREE.Vector2(l/i,c/n)),s.push(E.clone().sub(r).normalize())}for(c=1;c<=n;c++)for(l=1;l<=i;l++){var p=(i+1)*c+l-1,d=(i+1)*(c-1)+l-1,m=(i+1)*(c-1)+l,f=(i+1)*c+l,v=new THREE.Face3(p,d,f,[s[p].clone(),s[d].clone(),s[f].clone()]);this.faces.push(v),this.faceVertexUvs[0].push([a[p].clone(),a[d].clone(),a[f].clone()]),v=new THREE.Face3(d,m,f,[s[d].clone(),s[m].clone(),s[f].clone()]),this.faces.push(v),this.faceVertexUvs[0].push([a[d].clone(),a[m].clone(),a[f].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var n,i,o,r=function(t,e,n){var i=new THREE.Geometry;n=n||1;for(var o=0;o<=64*n;++o)"x"==e&&i.vertices.push(new THREE.Vector3(0,Math.cos(o/32*Math.PI),Math.sin(o/32*Math.PI)).multiplyScalar(t)),"y"==e&&i.vertices.push(new THREE.Vector3(Math.cos(o/32*Math.PI),0,Math.sin(o/32*Math.PI)).multiplyScalar(t)),"z"==e&&i.vertices.push(new THREE.Vector3(Math.sin(o/32*Math.PI),Math.cos(o/32*Math.PI),0).multiplyScalar(t));return i},a=function(t,e,n,i,o,r){var a=new THREE.Geometry,s=new THREE.Mesh(new THREE.CylinderGeometry(t,e,n,i,o,r));return s.position.y=.5,s.updateMatrix(),a.merge(s.geometry,s.matrix),a},s=function(t){var e=new THREE.Geometry;return"X"===t?e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===t?e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===t&&e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),e};THREE.TransformGizmo=function(){var t=this;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var t=new THREE.PlaneBufferGeometry(50,50,2,2),e=new THREE.MeshBasicMaterial({wireframe:!0});e.side=THREE.DoubleSide;var n={XY:new THREE.Mesh(t,e),YZ:new THREE.Mesh(t,e),XZ:new THREE.Mesh(t,e),XYZE:new THREE.Mesh(t,e)};for(var i in this.activePlane=n.XYZE,n.YZ.rotation.set(0,Math.PI/2,0),n.XZ.rotation.set(-Math.PI/2,0,0),n)n[i].name=i,this.planes.add(n[i]),this.planes[i]=n[i],n[i].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse((function(t){if(t instanceof THREE.Mesh){t.updateMatrix();var e=new THREE.Geometry;t.geometry instanceof THREE.BufferGeometry&&(t.geometry=(new THREE.Geometry).fromBufferGeometry(t.geometry)),e.merge(t.geometry,t.matrix),t.geometry=e,t.position.set(0,0,0),t.rotation.set(0,0,0),t.scale.set(1,1,1)}}))},this.hide=function(){this.traverse((function(t){t.visible=!1}))},this.show=function(){this.traverse((function(e){e.visible=!0,e.parent!=t.pickers&&e.parent!=t.hemiPicker||(e.visible=!1),e.parent==t.planes&&(e.visible=!1)})),this.activePlane.visible=!1},this.highlight=function(t){this.traverse((function(e){e.material&&e.material.highlight&&(e.name==t?e.material.highlight(!0):e.material.highlight(!1))}))},this.setupGizmos=function(){var t=function(t,e){for(var n in t)for(var i=t[n].length;i--;){var o=t[n][i][0],r=t[n][i][1],a=t[n][i][2],s=t[n][i][3];o.name=n,r&&o.position.set(r[0],r[1],r[2]),a&&o.rotation.set(a[0],a[1],a[2]),s&&(o.visble=s),e.add(o)}};this.setHandlePickerGizmos(),t(this.handleGizmos,this.handles),t(this.pickerGizmos,this.pickers),t(this.highlightGizmos,this.highlights),t(this.hemiPickerGizmos,this.hemiPicker),t(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(t,e){var n=new THREE.Vector3(0,0,0),i=new THREE.Vector3(0,1,0),o=new THREE.Matrix4;this.traverse((function(r){r.name&&(-1!=r.name.search("E")?r.quaternion.setFromRotationMatrix(o.lookAt(e,n,i)):-1==r.name.search("X")&&-1==r.name.search("Y")&&-1==r.name.search("Z")||r.quaternion.setFromEuler(t))}))},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var n=a(0,.05,.2,12,1,!1),i=s("X"),o=s("Y"),r=s("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new t({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(i,new e({color:15805484}))]],Y:[[new THREE.Mesh(n,new t({color:768011})),[0,.5,0]],[new THREE.Line(o,new e({color:768011}))]],Z:[[new THREE.Mesh(n,new t({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(r,new e({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new t({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new t({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new t({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new t({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new t({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(t,e){var n=new THREE.Matrix4;e.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),"XY"==t&&(this.activePlane=this.planes.XY),"YZ"==t&&(this.activePlane=this.planes.YZ),"XZ"==t&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(r(1,"x",.5),new e({color:16711680}))]],RY:[[new THREE.Line(r(1,"y",.5),new e({color:65280}))]],RZ:[[new THREE.Line(r(1,"z",.5),new e({color:255}))]],RE:[[new THREE.Line(r(1.25,"z",1),new e({color:65535}))]],RXYZE:[[new THREE.Line(r(1,"z",1),new e({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new t({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new t({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new t({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new t({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,2,24),new t({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(t){"RE"==t&&(this.activePlane=this.planes.XYZE),"RX"==t&&(this.activePlane=this.planes.YZ),"RY"==t&&(this.activePlane=this.planes.XZ),"RZ"==t&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(t,e){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=e.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).getInverse(n),u.applyMatrix4(n),this.traverse((function(t){o.setFromEuler(i),"RX"==t.name&&(c.setFromAxisAngle(r,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,c),t.quaternion.copy(o)),"RY"==t.name&&(l.setFromAxisAngle(a,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,l),t.quaternion.copy(o)),"RZ"==t.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),t.quaternion.copy(o))}))},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var e=this;this.setHandlePickerGizmos=function(){var e=a(0,.05,.2,12,1,!1);(new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));this.handleGizmos={Z:[[new THREE.Mesh(e,new t({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new t({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new t({color:16711680})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new t({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new t({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new t({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new t({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new t({color:16711680,opacity:.25})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new t({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new t({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new t({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new t({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new t({color:255})),null,null,!1]]}},this.setActivePlane=function(t,e){if("translate"==this.activeMode){var n=new THREE.Matrix4;e.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==t&&(this.activePlane=this.planes.YZ),"RY"==t&&(this.activePlane=this.planes.XZ),"RZ"==t&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(t,e){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var n=new THREE.Matrix4,i=new THREE.Euler(0,0,1),o=new THREE.Quaternion,r=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),s=new THREE.Vector3(0,0,1),c=new THREE.Quaternion,l=new THREE.Quaternion,h=new THREE.Quaternion,u=e.clone();i.copy(this.planes.XY.rotation),o.setFromEuler(i),n.makeRotationFromQuaternion(o).getInverse(n),u.applyMatrix4(n),this.traverse((function(t){o.setFromEuler(i),"RX"==t.name&&(c.setFromAxisAngle(r,Math.atan2(-u.y,u.z)),o.multiplyQuaternions(o,c),t.quaternion.copy(o)),"RY"==t.name&&(l.setFromAxisAngle(a,Math.atan2(u.x,u.z)),o.multiplyQuaternions(o,l),t.quaternion.copy(o)),"RZ"==t.name&&(h.setFromAxisAngle(s,Math.atan2(u.y,u.x)),o.multiplyQuaternions(o,h),t.quaternion.copy(o))}))}},this.show=function(){this.traverse((function(t){(null==e.parent||e.parent.useAllPickers||t.parent!=e.handles)&&(t.visible=!0),t.material&&(t.material.opacity=t.material.oldOpacity),t.parent!=e.pickers&&t.parent!=e.hemiPicker&&t.parent!=e.subPickers||(t.visible=!1),t.parent!=e.planes&&t.parent!=e.highlights||(t.visible=!1)})),this.activePlane.visible=!1},this.highlight=function(t){this.traverse((function(n){n.material&&n.material.highlight&&(n.name==t?(n.parent!=e.highlights&&n.parent!=e.handles||(n.visible=!0),n.material.highlight(!0)):(n.material.highlight(!1),n.material.opacity=.1))}))},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var n=a(.125,.125,.125),i=s("X"),o=s("Y"),r=s("Z");this.handleGizmos={X:[[new THREE.Mesh(n,new t({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(i,new e({color:16711680}))]],Y:[[new THREE.Mesh(n,new t({color:65280})),[0,.5,0]],[new THREE.Line(o,new e({color:65280}))]],Z:[[new THREE.Mesh(n,new t({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(r,new e({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new t({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new t({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new t({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(t,e){var n=new THREE.Matrix4;e.applyMatrix4(n.getInverse(n.extractRotation(this.planes.XY.matrixWorld))),"X"==t&&(this.activePlane=this.planes.XY,Math.abs(e.y)>Math.abs(e.z)&&(this.activePlane=this.planes.XZ)),"Y"==t&&(this.activePlane=this.planes.XY,Math.abs(e.x)>Math.abs(e.z)&&(this.activePlane=this.planes.YZ)),"Z"==t&&(this.activePlane=this.planes.XZ,Math.abs(e.x)>Math.abs(e.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==t&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(t,e,n){switch(THREE.Object3D.call(this),e=void 0!==e?e:document,this.gizmo={},n){case"translate":this.gizmo[n]=new THREE.TransformGizmoTranslate;break;case"rotate":this.gizmo[n]=new THREE.TransformGizmoRotate;break;case"transrotate":this.gizmo[n]=new THREE.TransformGizmoTranslateRotate;break;case"scale":this.gizmo[n]=new THREE.TransformGizmoScale}if(this.add(this.gizmo[n]),this.gizmo[n].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===n){(o=new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));var i=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(o,i);var o=new THREE.Geometry;i=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});o.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(o,i);o=new THREE.Geometry,i=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});o.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(o,i),(r=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"))).magFilter=r.minFilter=THREE.NearestFilter;var r;o=new THREE.CircleGeometry(.1,32),i=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:r});this.centerMark=new THREE.Mesh(o,i),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={},(r=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"))).magFilter=r.minFilter=THREE.NearestFilter;i=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:r});var a=.25;this.ticks.RX=new THREE.Object3D;o=new THREE.PlaneBufferGeometry(.12,a);var s=new THREE.Mesh(o,i);s.position.set(0,0,-1.275),s.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(s),(s=s.clone()).position.set(0,1.275,0),s.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(s),(s=s.clone()).position.set(0,0,1.275),s.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(s),(s=s.clone()).position.set(0,-1.275,0),s.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(s),this.ticks.RY=new THREE.Object3D,(s=s.clone()).position.set(0,0,-1.275),s.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(s),(s=s.clone()).position.set(-1.275,0,0),s.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(s),(s=s.clone()).position.set(0,0,1.275),s.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(s),(s=s.clone()).position.set(1.275,0,0),s.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(s)}var c=this,l=!1,h=n,u={type:"change"},E={type:"mouseDown"},p={type:"mouseUp",mode:h},d={type:"objectChange"},m=(new THREE.Raycaster,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3),f=new THREE.Vector3,v=new THREE.Vector3,y=new THREE.Vector3,T=1;this.clientScale=1;var w=new THREE.Matrix4,g=new THREE.Vector3,R=new THREE.Matrix4,H=new THREE.Vector3,x=new THREE.Quaternion,b=new THREE.Vector3,M=new THREE.Vector3,P=new THREE.Vector3,S=new THREE.Quaternion,V=new THREE.Quaternion,z=new THREE.Quaternion,k=new THREE.Quaternion,A=new THREE.Quaternion,I=new THREE.Vector3,O=new THREE.Vector3,B=new THREE.Matrix4,G=new THREE.Matrix4,C=new THREE.Vector3,j=new THREE.Vector3,X=new THREE.Euler,L=new THREE.Matrix4,Y=new THREE.Vector3;new THREE.Euler;function Z(e,n){return THREE.TransformControls.intersectObjects(e.canvasX,e.canvasY,n,t,!0)}this.attach=function(t){c.object=t,this.gizmo[h].show(),c.update(),c.updateUnitVectors()},this.detach=function(t){c.object=void 0,this.axis=null,this.gizmo[h].hide()},this.setMode=function(t){"scale"==(h=t||h)&&(c.space="local"),this.gizmo[h].show(),this.update(),c.dispatchEvent(u)},this.getPicker=function(){return c.gizmo[h].hemiPicker.children},this.setPosition=function(t){this.object.position.copy(t),this.update()},this.setNormal=function(t){x.setFromUnitVectors(this.normal,t),this.unitX.applyQuaternion(x),this.unitY.applyQuaternion(x),this.unitZ.applyQuaternion(x),this.normal.copy(t),this.object&&this.object.quaternion.multiply(x),this.update()},this.setSnap=function(t,e){c.snap=t,c.snapDelta=e},this.setSize=function(t){c.size=t,this.update(),c.dispatchEvent(u)},this.setSpace=function(t){c.space=t,this.update(),c.dispatchEvent(u)},this.update=function(n){if(void 0!==c.object){var i;if(c.object.updateMatrixWorld(),j.setFromMatrixPosition(c.object.matrixWorld),X.setFromRotationMatrix(R.extractRotation(c.object.matrixWorld)),t.updateMatrixWorld(),Y.setFromMatrixPosition(t.matrixWorld),this.position.copy(j),this.quaternion.setFromEuler(X),this.normal.set(0,0,1),this.normal.applyEuler(X),t.isPerspective){var o=j.distanceTo(Y);i=2*Math.tan(t.fov*Math.PI/360)*o}else i=t.top-t.bottom;var r=e.getBoundingClientRect();T=100*this.clientScale*i/r.height,this.scale.set(T,T,T),this.gizmoOffset&&this.position.add(this.gizmoOffset),this.updateMatrixWorld(),n&&this.gizmo[h].highlight(c.axis)}},this.setGizmoOffset=function(t){this.gizmoOffset=t||new THREE.Vector3(0,0,0),this.update()},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(X),this.unitY.applyEuler(X),this.unitZ.applyEuler(X)},this.showRotationGizmos=function(t){for(var e=this.gizmo[h].handles.children,n=0;n<e.length;n++){var i=e[n];i.visible=!0,-1!==i.name.search("R")&&(i.visible=t)}this.useAllPickers=t},this.highlight=function(){this.gizmo[h].highlight(this.axis||"Z")},this.onPointerHover=function(t){if(void 0===c.object||!0===l)return!1;var e=Z(t,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children),n=null,i="";return e&&(i=-1!=(n=e.object.name).search("R")?"rotate":"translate"),c.axis!==n&&(c.axis=n,c.gizmo[h].activeMode=i,c.update(!0),c.dispatchEvent(u)),null===c.axis&&c.gizmo[h].show(),!!e},this.onPointerDown=function(e){if(void 0===c.object||!0===l)return!1;var n=e;if("touch"===e.pointerType){var i=null,o="";(r=Z(n,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children))&&(o=-1!=(i=r.object.name).search("R")?"rotate":"translate"),c.axis!==i&&(c.axis=i,c.gizmo[h].activeMode=o)}var r=null;if((0===n.button||-1===n.button||void 0===n.button)&&(r=Z(n,c.useAllPickers?c.gizmo[h].pickers.children:c.gizmo[h].subPickers.children))){c.dispatchEvent(E),c.axis=r.object.name,c.update(),g.copy(t.position).sub(j).normalize(),c.gizmo[h].setActivePlane(c.axis,g);var a=Z(n,[c.gizmo[h].activePlane]);if(a&&f.copy(a.point),I.copy(c.object.position),O.copy(c.object.scale),B.extractRotation(c.object.matrix),L.extractRotation(c.object.matrixWorld),c.object.parent?(G.extractRotation(c.object.parent.matrixWorld),C.setFromMatrixScale(R.getInverse(c.object.parent.matrixWorld))):(G.extractRotation(c.object.matrixWorld),C.setFromMatrixScale(R.getInverse(c.object.matrixWorld))),"transrotate"===h&&"rotate"===c.gizmo[h].activeMode){c.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(c.matrixWorld),c.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(c.matrixWorld),c.startLine.geometry.verticesNeedUpdate=!0,c.parent.add(c.startLine);var s=c.object.geometry.getAttribute("position"),u=(new THREE.Vector3).fromAttribute(s,0).applyMatrix4(c.object.matrixWorld),p=(new THREE.Vector3).fromAttribute(s,1).applyMatrix4(c.object.matrixWorld),d=(new THREE.Vector3).fromAttribute(s,2).applyMatrix4(c.object.matrixWorld),m=(new THREE.Vector3).fromAttribute(s,3).applyMatrix4(c.object.matrixWorld);if("RX"===c.axis){u.lerp(d,.5),p.lerp(m,.5);var v=u.distanceTo(p);c.centerLine.material.dashSize=v/15,c.centerLine.material.gapSize=v/30,c.centerLine.geometry.vertices[0].copy(u),c.centerLine.geometry.vertices[1].copy(p)}else{u.lerp(p,.5),d.lerp(m,.5);v=u.distanceTo(d);c.centerLine.material.dashSize=v/15,c.centerLine.material.gapSize=v/30,c.centerLine.geometry.vertices[0].copy(u),c.centerLine.geometry.vertices[1].copy(d)}c.centerLine.geometry.computeLineDistances(),c.centerLine.geometry.verticesNeedUpdate=!0,c.parent.add(c.centerLine),c.ticks[c.axis].position.copy(c.position),c.ticks[c.axis].quaternion.copy(c.quaternion),c.ticks[c.axis].scale.copy(c.scale),c.parent.add(c.ticks[c.axis])}}return l=!0,!!r},this.onPointerMove=function(t){if(void 0===c.object||null===c.axis||!1===l)return!1;var e=Z(t,[c.gizmo[h].activePlane]);e&&m.copy(e.point);var n=c.gizmo[h].activeMode;if("translate"==n)m.sub(f),m.multiply(C),"local"==c.space&&(m.applyMatrix4(R.getInverse(L)),b.copy(this.unitX),M.copy(this.unitY),P.copy(this.unitZ),H.set(0,0,0),-1!=c.axis.search("X")&&(b.multiplyScalar(m.dot(this.unitX)),H.add(b)),-1!=c.axis.search("Y")&&(M.multiplyScalar(m.dot(this.unitY)),H.add(M)),-1!=c.axis.search("Z")&&(P.multiplyScalar(m.dot(this.unitZ)),H.add(P)),m.copy(H),m.applyMatrix4(B),c.object.position.copy(I),c.object.position.add(m)),"world"!=c.space&&-1==c.axis.search("XYZ")||(b.copy(this.unitX),M.copy(this.unitY),P.copy(this.unitZ),H.set(0,0,0),-1!=c.axis.search("X")&&(b.multiplyScalar(m.dot(this.unitX)),H.add(b)),-1!=c.axis.search("Y")&&(M.multiplyScalar(m.dot(this.unitY)),H.add(M)),-1!=c.axis.search("Z")&&(P.multiplyScalar(m.dot(this.unitZ)),H.add(P)),m.copy(H),m.applyMatrix4(R.getInverse(G)),c.object.position.copy(I),c.object.position.add(m));else if("scale"==n)m.sub(f),m.multiply(C),"local"==c.space&&("XYZ"==c.axis?(T=1+m.y/50,c.object.scale.x=O.x*T,c.object.scale.y=O.y*T,c.object.scale.z=O.z*T):(m.applyMatrix4(R.getInverse(L)),"X"==c.axis&&(c.object.scale.x=O.x*(1+m.x/50)),"Y"==c.axis&&(c.object.scale.y=O.y*(1+m.y/50)),"Z"==c.axis&&(c.object.scale.z=O.z*(1+m.z/50))));else if("rotate"==n){if(m.sub(j),m.multiply(C),H.copy(f).sub(j),H.multiply(C),"RE"==c.axis){m.applyMatrix4(R.getInverse(w)),H.applyMatrix4(R.getInverse(w)),v.set(Math.atan2(m.z,m.y),Math.atan2(m.x,m.z),Math.atan2(m.y,m.x)),y.set(Math.atan2(H.z,H.y),Math.atan2(H.x,H.z),Math.atan2(H.y,H.x)),x.setFromRotationMatrix(R.getInverse(G));var i=v.z-y.z;if(null!==c.snap){var o=Math.round(i/c.snap)*c.snap;Math.abs(o-i)<c.snapDelta&&(i=o)}A.setFromAxisAngle(g,i),S.setFromRotationMatrix(L),x.multiplyQuaternions(x,A),x.multiplyQuaternions(x,S),c.object.quaternion.copy(x)}else if("RXYZE"==c.axis){var r=m.clone().cross(H).normalize();x.setFromRotationMatrix(R.getInverse(G));var a=-m.clone().angleTo(H);if(null!==c.snap){o=Math.round(a/c.snap)*c.snap;Math.abs(o-a)<c.snapDelta&&(a=o)}V.setFromAxisAngle(r,a),S.setFromRotationMatrix(L),x.multiplyQuaternions(x,V),x.multiplyQuaternions(x,S),c.object.quaternion.copy(x)}else if("local"==c.space){m.applyMatrix4(R.getInverse(L)),H.applyMatrix4(R.getInverse(L));var s=m.dot(this.unitX),E=m.dot(this.unitY),p=m.dot(this.unitZ),X=H.dot(this.unitX),Y=H.dot(this.unitY),_=H.dot(this.unitZ);v.set(Math.atan2(p,E),Math.atan2(s,p),Math.atan2(E,s)),y.set(Math.atan2(_,Y),Math.atan2(X,_),Math.atan2(Y,X));var N=v.x-y.x,D=v.y-y.y;i=v.z-y.z;if(null!==c.snap){if(-1!=c.axis.search("X")){o=Math.round(N/c.snap)*c.snap;Math.abs(o-N)<c.snapDelta&&(N=o)}if(-1!=c.axis.search("Y")){o=Math.round(D/c.snap)*c.snap;Math.abs(o-D)<c.snapDelta&&(D=o)}if(-1!=c.axis.search("Z")){o=Math.round(i/c.snap)*c.snap;Math.abs(o-i)<c.snapDelta&&(i=o)}}V.setFromAxisAngle(this.unitX,N),z.setFromAxisAngle(this.unitY,D),k.setFromAxisAngle(this.unitZ,i),S.setFromRotationMatrix(B),"RX"==c.axis&&S.multiplyQuaternions(S,V),"RY"==c.axis&&S.multiplyQuaternions(S,z),"RZ"==c.axis&&S.multiplyQuaternions(S,k),c.object.quaternion.copy(S)}else if("world"==c.space){s=m.dot(this.unitX),E=m.dot(this.unitY),p=m.dot(this.unitZ),X=H.dot(this.unitX),Y=H.dot(this.unitY),_=H.dot(this.unitZ);v.set(Math.atan2(p,E),Math.atan2(s,p),Math.atan2(E,s)),y.set(Math.atan2(_,Y),Math.atan2(X,_),Math.atan2(Y,X)),x.setFromRotationMatrix(R.getInverse(G));N=v.x-y.x,D=v.y-y.y,i=v.z-y.z;if(null!==c.snap){if(-1!=c.axis.search("X")){o=Math.round(N/c.snap)*c.snap;Math.abs(o-N)<c.snapDelta&&(N=o)}if(-1!=c.axis.search("Y")){o=Math.round(D/c.snap)*c.snap;Math.abs(o-D)<c.snapDelta&&(D=o)}if(-1!=c.axis.search("Z")){o=Math.round(i/c.snap)*c.snap;Math.abs(o-i)<c.snapDelta&&(i=o)}}V.setFromAxisAngle(this.unitX,N),z.setFromAxisAngle(this.unitY,D),k.setFromAxisAngle(this.unitZ,i),S.setFromRotationMatrix(L),"RX"==c.axis&&x.multiplyQuaternions(x,V),"RY"==c.axis&&x.multiplyQuaternions(x,z),"RZ"==c.axis&&x.multiplyQuaternions(x,k),x.multiplyQuaternions(x,S),c.object.quaternion.copy(x)}"transrotate"===h&&(c.add(c.endLine),c.add(c.centerMark))}return c.object.matrixAutoUpdate=!0,c.update(!0),c.dispatchEvent(u),c.dispatchEvent(d),!!e},this.onPointerUp=function(t){return l&&null!==c.axis&&(p.mode=h,c.dispatchEvent(p)),l=!1,this.gizmo[h].show(),this.updateUnitVectors(),"transrotate"===h&&"rotate"===this.gizmo[h].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.intersectObjects=(n=new THREE.Vector3,i=new THREE.Vector3,o=new THREE.Raycaster,function(t,e,r,a,s){var c=t/a.clientWidth*2-1,l=-e/a.clientHeight*2+1;a.isPerspective?(n.set(c,l,.5),n.unproject(a),o.set(a.position,n.sub(a.position).normalize())):(n.set(c,l,-1),n.unproject(a),i.set(0,0,-1),o.set(n,i.transformDirection(a.matrixWorld)));var h=o.intersectObjects(r,s);return h[0]?h[0]:null}),THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}n.r(e),n.d(e,"SectionExtension",(function(){return l}));var o=n(21),r=null,a=Autodesk.Viewing.Private,s=function(t,e){var n,s,c,l=t.impl,h=["section"],u=!1,E=!1,p=!1,d=!0,m=e.tintColor,f=e.tintIntensity,v=isNaN(e.gizmoOffsetRight)?200:e.gizmoOffsetRight,y=isNaN(e.gizmoOffsetLeft)?80:e.gizmoOffsetLeft,T=isNaN(e.gizmoOffsetTop)?80:e.gizmoOffsetTop,w=isNaN(e.gizmoOffsetBottom)?80:e.gizmoOffsetBottom,g=new THREE.Vector3,R=new THREE.Vector3,H=new THREE.Vector3,x=[],b=[],M=[],P="",S=null,V=!1,z=!0,k=[[0,1],[1,3],[3,2],[2,0]],A=Object(o.debounce)((function(t,e,n){a.analytics.track("viewer.section",{from:t,type:e,action:n})}),2e3);function I(){l.invalidate(!1,!1,!0)}function O(){B(),n&&n.update(),s&&s.update()}function B(){if(n&&n.object){var t=l.worldToClient(n.position),e=l.getCanvasBoundingClientRect();if(g.copy(t),t.x<y?g.x=y:t.x>e.width-v&&(g.x=e.width-v),t.y<T?g.y=T:t.y>e.height-w&&(g.y=e.height-w),g.x!==t.x||g.y!==t.y){var i=THREE.TransformControls.intersectObjects(g.x,g.y,[n.object],l.camera,!1);if(i){var o=x[0].position;R.copy(n.object.position).add(o),H.copy(i.point).sub(R),n.setGizmoOffset(H)}}}}function G(){u&&1===b.length&&(Z(!0),O(),j((new THREE.Plane).setComponents(b[0].x,b[0].y,b[0].z,b[0].w)))}i(),function(){if(r)return;(r=function(t,e,n){THREE.Mesh.call(this,t,e,!1),this.plane=n,this.planeVec=new THREE.Vector4(n.normal.x,n.normal.y,n.normal.z,n.constant),this.connectivity=[],this.outlines=[]}).prototype=Object.create(THREE.Mesh.prototype),r.prototype.constructor=r,r.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var t=this.plane.normal,e=-1*this.getWorldPosition().dot(t);this.planeVec.set(t.x,t.y,t.z,e),this.plane.constant=e}}();var C=new function(t,e){var n,i,o,r,a,s,c,h=0,u=[],E=[];function p(t){h&&clearTimeout(h),h=0,i=t,u.length=0,E.length=0,r=null,a=-1,s=0,c=0}function d(){h=0;for(var r=performance.now()+t;performance.now()<r;){if(!v())return l.invalidate(!0,!0),void p(null);n(E[c],u[s],o,c+1>=E.length,!i||a>=i.length)}h=setTimeout(d,e)}function m(){if(i&&a<i.length)for(;++a<i.length;)if((r=i[a].getInstanceTree())&&(u.length=0,r.enumNodeChildren(i[a].getRootId(),(function(t){u.push(t)}),!0),u.length>0))return o=i[a];return o=null,!1}function f(){if(s>=u.length)return!1;for(;++s<u.length;){var t=u[s];if(!r.isNodeHidden(t)&&!r.isNodeOff(t)&&(E.length=0,r.enumNodeFragments(t,(function(t){E.push(t)}),!1),E.length>0))return!0}return!1}function v(){if(++c<E.length)return!0;for(c=0;;){if(f())return!0;if(!m())return!1;s=-1}}t=t||15,e=e||0,this.start=function(t,e,i){p(t),n=i,i&&(e>=0?h=setTimeout(d,e):d())}};function j(t){var e=Autodesk.Viewing.Extensions.CompGeom;l.sceneAfter.skipDepthTarget=!0,it();var n=new THREE.Object3D;n.name="section3D",l.scene.add(n);var i=new THREE.Object3D;i.name="section2D",l.sceneAfter.add(i);var o=e.makePlaneBasis(t),r=(new THREE.Matrix4).getInverse(o),s=l.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0,isScreenSpace:!0},!1,!1),c=l.matman().findMaterial(null,s);c.transparent=!0,c.depthTest=!0,c.polygonOffset=!0,c.polygonOffsetFactor=-1,c.polygonOffsetUnits=.1,c.cutplanes=L;var h,u=new THREE.Box3,E=l.modelQueue().getModels(),p=[];C.start(E,50,(function(s,E,d,v){var y=d.getFragmentList();if(y.getWorldBounds(s,u),e.xBoxPlane(t,u)){var T=y.getVizmesh(s);T.geometry&&!T.geometry.is2d&&!T.geometry.isLines&&T.material.cutplanes&&(h=T.material,e.xMeshPlane(t,T,p))}if(v){if(p.length){var w=new THREE.Box3;e.convertToPlaneCoords(o,p,w);var g=new a.VertexBufferBuilder(!1,8*p.length),R=function(t){return t&&t.color||new THREE.Color(16777215)}(h),H=0|.25*R.r*255.5,x=0|.25*R.g*255.5,b=4278190080|(0|.25*R.b*255.5)<<16|x<<8|H,M=new e.EdgeSet(p,w,1e-6*w.size().length());M.snapEdges(),M.sanitizeEdges(),M.stitchContours();var P=M.triangulate();if(P){for(var S=0;S<P.contours.length;S++)for(var V=P.contours[S],z=1;z<V.length;z++){var k=P.pts[V[z-1]],A=P.pts[V[z]];g.addSegment(k.x,k.y,A.x,A.y,0,-2,b,E,0)}var I={mesh:g.toMesh()};a.BufferGeometryUtils.meshToGeometry(I);var O=I.geometry;O.streamingDraw=!0,O.streamingIndex=!0;var B=new THREE.Mesh(O,c);if(B.matrix.copy(r),B.matrixAutoUpdate=!1,B.frustumCulled=!1,B.modelId=d.id,B.dbId=E,i.add(B),!P.triangulationFailed){var G=P.toPolygonMesh(h.packedNormals),C=l.matman().cloneMaterial(h,d);C.packedNormals=h.packedNormals,C.cutplanes=L,C.side=THREE.FrontSide,C.depthTest=!0,C.map=null,C.bumpMap=null,C.normalMap=null,C.alphaMap=null,C.specularMap=null,C.transparent=!1,C.depthWrite=!0,C.hatchPattern=!0,C.needsUpdate=!0;var j=(h.id+2)*Math.PI*.125,X=Math.tan(j);C.hatchParams=new THREE.Vector2(X,10),C.hatchTintColor=m,C.hatchTintIntensity=f,null!=C.prismType&&(C.defines={},C.defines[C.prismType.toUpperCase()]="","PrismWood"==C.prismType&&(C.defines.NO_UVW=""));var Y=new THREE.Mesh(G,C);Y.matrix.copy(r),Y.matrixAutoUpdate=!1,Y.modelId=d.id,Y.dbId=E,Y.fragId=p.fragId,n.add(Y)}}}p.length=0}}))}var X="Autodesk.Viewing.Extension.Section.SectionTool";l.setCutPlaneSetFor2DRendering(X);var L=[];function Y(t,e){var n,i,o=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),t.normal);if(e){var a=t.projectPoint(e.max),s=t.projectPoint(e.min),c=o.clone().inverse();a.applyQuaternion(c),s.applyQuaternion(c),i=(new THREE.Vector3).subVectors(a,s),n=new THREE.PlaneBufferGeometry(i.x,i.y)}else i=2*(e=l.getVisibleBounds()).getBoundingSphere().radius,n=new THREE.PlaneBufferGeometry(i,i);var h=new THREE.MeshBasicMaterial({opacity:0,color:2653930,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),u=new r(n,h,t),E=t.projectPoint(e.center());u.position.copy(E),u.quaternion.multiply(o);var p=l.currentLightPreset();p=Math.max(0,p);for(var d=Autodesk.Viewing.Private.LightPresets[p].bgColorGradient,m="rgb("+(255-d[0])+","+(255-d[1])+","+(255-d[2])+")",f=new THREE.LineBasicMaterial({color:m,linewidth:1,depthTest:!1}),v=u.geometry.getAttribute("position"),y=0;y<k.length;y++){(n=new THREE.Geometry).vertices.push((new THREE.Vector3).fromArray(v.array,k[y][0]*v.itemSize),(new THREE.Vector3).fromArray(v.array,k[y][1]*v.itemSize));var T=new THREE.Line(n,f);u.add(T),u.outlines.push(T)}return u}function Z(t){_((function(e){var n,i,o,a;if(e instanceof r)if(e.connectivity.length>0){var s=(new THREE.Matrix4).getInverse(e.matrixWorld);for(a=new THREE.Vector3,o=e.geometry.getAttribute("position"),n=0;n<o.length/o.itemSize;n++){var c=e.connectivity[n];null!==et(e.plane,c[0],c[1],a)&&(a.applyMatrix4(s),o.setXYZ(n,a.x,a.y,a.z))}for(o.needsUpdate=!0,e.geometry.computeBoundingBox(),e.geometry.computeBoundingSphere(),n=0;n<e.outlines.length;n++)(i=e.outlines[n]).geometry.vertices[0].fromArray(o.array,k[n][0]*o.itemSize),i.geometry.vertices[1].fromArray(o.array,k[n][1]*o.itemSize),i.geometry.verticesNeedUpdate=!0}else if(t){var h=l.getVisibleBounds(),u=2*h.getBoundingSphere().radius;for(a=e.plane.projectPoint(h.center()),e.geometry=new THREE.PlaneBufferGeometry(u,u),e.position.copy(a),o=e.geometry.getAttribute("position"),n=0;n<e.outlines.length;n++)(i=e.outlines[n]).geometry.vertices[0].fromArray(o.array,k[n][0]*o.itemSize),i.geometry.vertices[1].fromArray(o.array,k[n][1]*o.itemSize),i.geometry.verticesNeedUpdate=!0}}))}function _(t){for(var e=0;e<x.length;e++)x[e].traverse(t)}function N(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];_((function(t){t instanceof r&&t.update()})),1===b.length&&j((new THREE.Plane).setComponents(b[0].x,b[0].y,b[0].z,b[0].w)),l.setCutPlaneSet(X,b,t)}function D(t){for(var e=0;e<x.length;e++)x[e].visible=t;d!==t&&I(),d=t}function F(t){t&&b.length>0&&(1===b.length&&j((new THREE.Plane).setComponents(b[0].x,b[0].y,b[0].z,b[0].w)),l.setCutPlaneSet(X,b)),D(t)}function U(t,e){t.attach(e),t.setPosition(e.position),t.visible=!0}function W(t){return l.api.navigation.getEyeVector().dot(t)>0&&t.negate(),t}function Q(t,e){var i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=l.getVisibleBounds(),r=o.center(),a=new THREE.Group;e=void 0!==e?e:-1*r.dot(t);var s=new THREE.Plane(t,e),c=Y(s,null);a.add(c),b.push(c.planeVec),x.push(a),l.addOverlay("gizmo",a),n&&(U(n,c),c.material.opacity=0,q(c),n.showRotationGizmos(!0),M=n.getPicker()),N(i),u&&O()}function q(t){if(!n||!t)return!1;var e=function(t){var e=new THREE.Vector3,n=t.geometry;return n.computeBoundingBox(),e.x=(n.boundingBox.max.x+n.boundingBox.min.x)/2,e.y=(n.boundingBox.max.y+n.boundingBox.min.y)/2,e.z=(n.boundingBox.max.z+n.boundingBox.min.z)/2,t.localToWorld(e),e}(t).sub(t.position);return e.sub(c),n.setGizmoOffset(e),!0}var J,$,K,tt,et=(J=new THREE.Matrix3,$=new THREE.Vector3,K=new THREE.Vector3,tt=new THREE.Vector3,function(t,e,n,i){J.set(t.normal.x,t.normal.y,t.normal.z,e.normal.x,e.normal.y,e.normal.z,n.normal.x,n.normal.y,n.normal.z);var o=J.determinant();return 0===o?null:($.crossVectors(e.normal,n.normal).multiplyScalar(-t.constant),K.crossVectors(n.normal,t.normal).multiplyScalar(-e.constant),tt.crossVectors(t.normal,e.normal).multiplyScalar(-n.constant),(i||new THREE.Vector3).copy($).add(K).add(tt).divideScalar(o))}),nt=function(t,e,n){return THREE.TransformControls.intersectObjects(t.canvasX,t.canvasY,e,l.camera,n)};function it(){var t=l.scene.getObjectByName("section3D");t&&l.scene.remove(t);var e=l.sceneAfter.getObjectByName("section2D");e&&l.sceneAfter.remove(e)}this.isActive=function(){return u},this.getSectionDistance=function(t){var e=l.api.navigation.getEyeVector(),n=l.rayIntersect(new THREE.Ray(l.camera.position,e));return n&&n.intersectPoint&&-1*n.intersectPoint.dot(t)},this.setViewerSection=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.clearSection(t);var e=l.getCutPlaneSet("__set_view");if(1===e.length){n.clientScale=1;var i=e[0],o=new THREE.Vector3(i.x,i.y,i.z),r=i.w;Q(o,r,t),P="SET_VIEW_PLANE",l.setCutPlaneSet("__set_view",void 0,t)}},this.setSection=function(t){var e,i;this.clearSection(),c=new THREE.Vector3,n.clientScale=1;var o=l.getCutPlaneSet("__set_view");switch(1===o.length&&"BOX"!==t&&"OBJ_SET_VIEW_PLANE"!==t&&(t="SET_VIEW_PLANE"),t){case"X":e=new THREE.Vector3(1,0,0),i=this.getSectionDistance(e),Q(W(e),i);break;case"Y":e=new THREE.Vector3(0,1,0),i=this.getSectionDistance(e),Q(W(e),i);break;case"Z":e=new THREE.Vector3(0,0,1),i=this.getSectionDistance(e),Q(W(e),i);break;case"OBJ_SET_VIEW_PLANE":case"SET_VIEW_PLANE":var r=o[0];Q(e=new THREE.Vector3(r.x,r.y,r.z),r.w);break;case"OBJ_BOX":case"BOX":!function(t){var e=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],i=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],o=new THREE.Group,r=l.getVisibleBounds(),a=r.center(),c=new THREE.Box3(r.min,a),h=!1;t&&6===t.length&&1===t[0].x&&(a=(c=new THREE.Box3(new THREE.Vector3(t[3].w,t[4].w,t[5].w),new THREE.Vector3(t[0].w,t[1].w,t[2].w))).max.clone(),h=!0);var u,E,p=[],d=[];for(u=0;u<e.length;u++){if(h){var m=new THREE.Plane(e[u],t[u].w);p.push(m)}else{m=new THREE.Plane(e[u],-1*a.dot(e[u]));if(p.push(m),u>2){var f=m.orthoPoint(c.max),v=m.orthoPoint(c.min),y=(new THREE.Vector3).subVectors(f,v);m.constant-=y.length()}}E=Y(m,c),o.add(E),d.push(E),b.push(E.planeVec)}for(u=0;u<d.length;u++){E=d[u];for(var T=i[u],w=0;w<T.length;w++){for(var g=[],R=T[w],H=0;H<R.length;H++)g.push(p[R[H]]);E.connectivity.push(g)}}x.push(o),l.addOverlay("gizmo",o),N(),Z(),m=x[0].children[0],U(n,m),m.material.opacity=.25,q(m),U(s,x[0]),n.showRotationGizmos(!1),M=n.getPicker().concat(s.getPicker());var P=x[0].position.clone().sub(a.clone());s.setGizmoOffset(P)}(o),n.clientScale=2,this.recomputePivot()}P=t,l.setCutPlaneSet("__set_view",void 0)},this.setSectionFromPlane=function(t){this.clearSection(),Q(new THREE.Vector3(t.x,t.y,t.z),t.w),P="",l.setCutPlaneSet("__set_view",void 0)},this.setActiveMode=function(t){P=t||""},this.clearSection=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(n&&n.detach(),s&&s.detach();b.length>0;)b.pop();for(;x.length>0;){var e=x.pop();l.removeOverlay("gizmo",e)}C.start(null),it(),l.setCutPlaneSet(X,null,t)},this.isPlaneOn=function(){return d},this.showPlane=function(t){D(t)},this.attachControl=function(t){n&&s&&(t?(U(n,x[0].children[0]),n.highlight(),"BOX"===P&&U(s,x[0])):(n.detach(),s.detach()))},this.resetSection=function(){this.setSection(P)},this.getNames=function(){return h},this.getName=function(){return h[0]},this.register=function(){},this.deregister=function(){this.clearSection(),V&&(l.removeOverlay("gizmo",n),n.removeEventListener("change",I),n=null,l.removeOverlay("gizmo",s),s.removeEventListener("change",I),s.removeEventListener("change",B),s=null,l.removeOverlayScene("gizmo"),t.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,O),t.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,G),t.removeEventListener(Autodesk.Viewing.HIDE_EVENT,G),t.removeEventListener(Autodesk.Viewing.SHOW_EVENT,G),t.removeEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,G),V=!1)},this.getPriority=function(){return 70},this.activate=function(){V||((n=new THREE.TransformControls(l.camera,l.canvas,"transrotate")).addEventListener("change",I),n.setSnap(Math.PI/2,Math.PI/36),(s=new THREE.TransformControls(l.camera,l.canvas,"translate")).addEventListener("change",I),s.addEventListener("change",B),void 0===l.overlayScenes.gizmo&&l.createOverlayScene("gizmo"),l.addOverlay("gizmo",n),l.addOverlay("gizmo",s),t.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,O),t.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,G),t.addEventListener(Autodesk.Viewing.HIDE_EVENT,G),t.addEventListener(Autodesk.Viewing.SHOW_EVENT,G),t.addEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,G),V=!0),u=!0,E=!1,z=!0,b=b||[],F(!0)},this.deactivate=function(){u=!1,E=!1,C.start(null),it(),F(!1),l.setCutPlaneSet(X),n.detach(),s.detach()},this.update=function(){return!1},this.handleSingleClick=function(t){var e=nt(t,x[0].children);if(x[0].children.forEach((function(t){t.material.opacity=0})),e){var i,o=n.object;U(n,e.object),n.highlight(),e.object.material.opacity=b.length>1?.25:0,(null===(i=x[0])||void 0===i?void 0:i.children.length)>1&&o!==e.object&&q(e.object),I(),B()}return!1},this.handleDoubleClick=function(){return!1},this.handleSingleTap=function(t){return this.handleSingleClick(t,0)},this.handleDoubleTap=function(){return!1},this.handleKeyDown=function(){return!1},this.handleKeyUp=function(){return!1},this.handleWheelInput=function(){return!1},this.handleButtonDown=function(t){return E=!0,!!s.onPointerDown(t)||n.onPointerDown(t)},this.handleButtonUp=function(t){return E=!1,p&&(p=!1,this.recomputePivot()),!!s.onPointerUp(t)||n.onPointerUp(t)},this.handleMouseMove=function(t){var e=s.object?(new THREE.Vector3).copy(s.object.position):null;if(E){if(s.onPointerMove(t)){p=!0,N(),n.update();var i=(new THREE.Vector3).copy(s.object.position).sub(e);return c.add(i),A("Canvas","Box","translate"),!0}if(n.onPointerMove(t)){if(p=!0,N(),Z(),P.includes("BOX"))A("Canvas","Box","transform");else{var o=-1!=n.axis.search("R")?"rotate":"translate";A("Canvas","Plane",o)}return!0}}if(s.visible=void 0!==s.object,"touch"!==t.pointerType){var r=t,a=nt(r,x[0].children);a&&(z=!1);var l=!!(z||a||nt(r,M,!0));n.visible=l,s.visible=s.visible&&l,D(l)}return!!s.onPointerHover(t)||n.onPointerHover(t)},this.handleGesture=function(t){switch(t.type){case"dragstart":return S="drag",this.handleButtonDown(t,0);case"dragmove":return"drag"===S&&this.handleMouseMove(t);case"dragend":return"drag"===S&&(S=null,this.handleButtonUp(t,0))}return!1},this.handleBlur=function(){return!1},this.handleResize=function(){},this.handlePressHold=function(){return!1},this.recomputePivot=function(){var t=this.getSectionBoxValues(!0);if(t){var e=t.sectionBox;l.api.navigation.setPivotPoint(new THREE.Vector3(e[0]+.5*(e[3]-e[0]),e[1]+.5*(e[4]-e[1]),e[2]+.5*(e[5]-e[2])))}},this.getSectionBoxValues=function(t){var e=x[0];if(!e)return null;var n=e.children;if(n.length<6)return null;var i=n[0].position.x,o=n[1].position.y,r=n[2].position.z,a=n[3].position.x,s=n[4].position.y,c=n[5].position.z,h={x:0,y:0,z:0};return t||(h=l.model.getData().globalOffset||h),{sectionBox:[Math.min(a,i)+h.x,Math.min(o,s)+h.y,Math.min(r,c)+h.z,Math.max(a,i)+h.x,Math.max(o,s)+h.y,Math.max(r,c)+h.z],sectionBoxTransform:(new THREE.Matrix4).identity().toArray()}},this.getSectionPlaneValues=function(t){var e=x[0];if(!e)return null;var n=e.children;if(1!==n.length)return null;var i={x:0,y:0,z:0};t||(i=l.model.getData().globalOffset||i);var o=n[0].plane,r=o.constant-THREE.Vector3.prototype.dot.call(i,o.normal);return{sectionPlane:[o.normal.x,o.normal.y,o.normal.z,r]}},this.getSectionPlaneSet=function(){return l.getCutPlaneSet(X)},this.getSectionPlanes=function(){var t=l.getCutPlaneSet("__set_view");return t.length>0?t:l.getCutPlaneSet(X)},this.notifyCutplanesChanged=function(){var t=L.length;L.length=0;for(var e=l.getCutPlaneSets(),n=0;n<e.length;n++){var i=e[n];if(i!==X)for(var o=l.getCutPlaneSet(i),r=0;r<o.length;r++)L.push(o[r])}e.includes("__set_view")&&""!==P&&-1===P.indexOf("OBJ_")&&this.setViewerSection(!1),t!==L.length&&function(){function t(t){t&&t.traverse((function(t){!t instanceof THREE.Mesh||!t.material||(t.material.needsUpdate=!0)}))}t(l.scene.getObjectByName("section3D")),t(l.sceneAfter.getObjectByName("section2D"))}()},this.setSectionBox=function(t){if(!t)return!1;var e=Autodesk.Viewing.Private.SceneMath.box2CutPlanes(t,t.transform);return P="OBJ_BOX",l.setCutPlaneSet("__set_view",e),this.setSection("OBJ_BOX"),!0},this.setSectionPlane=function(t,e){var i,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||!e)return!1;var r="OBJ_SET_VIEW_PLANE",a=-1*e.dot(t),s=new THREE.Plane(t,a);P=r;var c=[new THREE.Vector4(s.normal.x,s.normal.y,s.normal.z,s.constant)];l.setCutPlaneSet("__set_view",c),this.setSection(r),null===(i=n)||void 0===i||i.showRotationGizmos(o);var h=e.clone().sub(x[0].children[0].position);return n.setGizmoOffset(h),!0}};n(350);var c=Autodesk.Viewing.Private.analytics,l=function(t,e){Autodesk.Viewing.Extension.call(this,t,e),this.viewer=t,this.name="section",this.modes=["x","y","z","box"],this.onViewerSetView=this.onViewerSetView.bind(this),this._onCutPlanesChanged=this._onCutPlanesChanged.bind(this),this._onShowAll=this._onShowAll.bind(this)};l.prototype=Object.create(Autodesk.Viewing.Extension.prototype),l.prototype.constructor=l;var h=l.prototype;h.load=function(){var t=this,e=this,n=this.viewer;this.tool=new s(n,{tintColor:{r:1,g:1,b:0},tintIntensity:.2}),n.toolController.registerTool(this.tool),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],n.addEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),n.addEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this._onCutPlanesChanged),n.addEventListener(Autodesk.Viewing.SHOW_ALL_EVENT,this._onShowAll),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var i=[{keycodes:[Autodesk.Viewing.KeyCode.ESCAPE],onRelease:function(){if(0===e.viewer.getAggregateSelection().length)return e.deactivate()}}];return n.getHotkeyManager().pushHotkeys(this.HOTKEYS_ID,i),this.viewer.registerContextMenuCallback("Autodesk.Section",(function(e,n){!function(t,e,n){var i;if(!n.hasSelected)return;var o=t.viewer,r=(n.event,o.impl.selector.getSelectionBounds()),a={title:"Section",target:[]};a.target.push({title:"Section Box",target:function(){t.setSectionBox(r),c.track("viewer.section",{From:"Contextual",Type:"Box",Action:"Enable"})}});var s=o.getAggregateSelection(),l=s.map((function(t){return t.selection})).flat(),h=s.map((function(t){return t.model.id})),u=o.impl.hitTest(n.canvasX,n.canvasY,!1,l,h);if((null==u||null===(i=u.face)||void 0===i?void 0:i.normal)&&u.model&&-1!==l.indexOf(u.dbId)){var E=o.impl.getRenderProxy(u.model,u.fragId),p=(new THREE.Matrix3).getNormalMatrix(E.matrixWorld),d=u.face.normal.clone().applyMatrix3(p).normalize();a.target.push({title:"Section Plane",target:function(){t.setSectionPlane(d,u.point,!1),c.track("viewer.section",{From:"Contextual",Type:"Plane",Action:"Enable"})}})}e.push(a)}(t,e,n)})),this.viewer.loadExtension("Autodesk.CompGeom")},h.unload=function(){var t=this.viewer;return t.unregisterContextMenuCallback("Autodesk.Section"),t.getHotkeyManager().popHotkeys(this.HOTKEYS_ID),this.destroyUI(),t.removeEventListener(Autodesk.Viewing.SET_VIEW_EVENT,this.onViewerSetView),t.removeEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,this._onCutPlanesChanged),t.removeEventListener(Autodesk.Viewing.SHOW_ALL_EVENT,this._onShowAll),t.toolController.deregisterTool(this.tool),this.tool=null,!0},h.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var t=this.sectionStyle||"X";this.setSectionStyle(t,!0)}return this.isActive()},h.getSectionStyle=function(){return this.sectionStyle},h.setSectionStyle=function(t,e){if(-1===this.supportedStyles.indexOf(t))return!1;var n=this.isActive(),i=this.sectionStyle!==t||!e;return this.sectionStyle=t,n&&i?this.tool.setSection(t):n||(this.enableSectionTool(!0),i?this.tool.setSection(t):this.tool.attachControl(!0)),!0},h.setSectionFromPlane=function(t){if(this.deactivate(),t)this.tool.setSectionFromPlane(t),this.tool.attachControl(!1),this.isActive()||this.tool.showPlane(!1);else{this.tool.clearSection();var e=this.viewer.toolController.setIsLocked(!1);this.enableSectionTool(!1),this.viewer.toolController.setIsLocked(e)}},h.getSectionPlanes=function(){return this.tool.getSectionPlanes()},h.enableSectionTool=function(t){var e=this.viewer.toolController,n=this.tool.isActive();return t&&!n?(e.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(t||!n)&&(e.deactivateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},h.getViewValues=function(t){var e=this.tool.getSectionBoxValues(t);if(e)return e;var n=this.tool.getSectionPlaneValues(t);return n||null},h.getState=function(t){if(this.viewer.model&&!this.viewer.model.is2d()){t.cutplanes=t.cutplanes||[];for(var e=this.tool.getSectionPlaneSet(),n=0;n<e.length;n++)t.cutplanes.push(e[n].toArray())}},h.restoreState=function(t,e){if(t.cutplanes){var n=this.getSectionPlanes();return this.setSectionFromPlane(null),1===n.length&&this.setSectionFromPlane(n[0]),!0}},h._onCutPlanesChanged=function(){this.tool.notifyCutplanesChanged()},h._onShowAll=function(){this.deactivate()},h.setSectionBox=function(t){t&&(this.enableSectionTool(!0),this.tool.setSectionBox(t)?(this.activeStatus=!0,this.viewer.clearSelection()):this.enableSectionTool(!1))},h.setSectionPlane=function(t,e,n){t&&e&&(this.enableSectionTool(!0),this.tool.setSectionPlane(t,e,n)?(this.activeStatus=!0,this.viewer.clearSelection()):this.enableSectionTool(!1))},h.onViewerSetView=function(){this.deactivate()},h.onToolbarCreated=function(t){var e=Autodesk.Viewing.UI;this.sectionToolButton=new e.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var n=t.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(n){var i=n.getControl("toolbar-resetTool");i?n.addControl(this.sectionToolButton,{index:n.indexOf(i.getId())}):n.addControl(this.sectionToolButton,{index:0})}},h.createSubmenu=function(t){var e=this,n=this.viewer,i=Autodesk.Viewing.UI;function o(t,n){return function(){var o=t.getState(),r=function(){t instanceof i.ComboButton==!1?e.activate(n):(e.enableSectionTool(!0),e.tool.attachControl(!0))},a=-1!==n.toLowerCase().indexOf("box")?"Box":"Plane";o===i.Button.State.INACTIVE?(t.setState(i.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(r,1):r(),c.track("viewer.section",{From:"Toolbar",Type:a,Action:"Enable"})):o===i.Button.State.ACTIVE&&(t.setState(i.Button.State.INACTIVE),e.deactivate(),c.track("viewer.section",{From:"Toolbar",Type:a,Action:"Disable"})),e.sectionStyle=n.toUpperCase()}}function r(){var t,i=(t=new THREE.Vector3,function(e,n,i){return t.subVectors(e,n),t.lengthSq()<i}),o=new THREE.Vector3(1,0,0),r=new THREE.Vector3(0,1,0),a=new THREE.Vector3(0,0,1),s=n.autocam.getWorldRightVector(),c=n.autocam.getWorldUpVector(),l=n.autocam.getWorldFrontVector(),h=1e-4;i(c,o,h)?e.sectionYButton.setIcon("adsk-icon-plane-x"):i(c,a,h)?e.sectionYButton.setIcon("adsk-icon-plane-z"):e.sectionYButton.setIcon("adsk-icon-plane-y"),i(s,r,h)?e.sectionXButton.setIcon("adsk-icon-plane-y"):i(s,a,h)?e.sectionXButton.setIcon("adsk-icon-plane-z"):e.sectionXButton.setIcon("adsk-icon-plane-x"),i(l,o,h)?e.sectionZButton.setIcon("adsk-icon-plane-x"):i(l,r,h)?e.sectionZButton.setIcon("adsk-icon-plane-y"):e.sectionZButton.setIcon("adsk-icon-plane-z")}var a=this.sectionXButton=new i.Button("toolbar-sectionTool-x");a.setToolTip("Add X plane"),a.setIcon("adsk-icon-plane-x"),a.onClick=o(a,"x"),t.addControl(a);var s=this.sectionYButton=new i.Button("toolbar-sectionTool-y");s.setToolTip("Add Y plane"),s.setIcon("adsk-icon-plane-y"),s.onClick=o(s,"y"),t.addControl(s);var l=this.sectionZButton=new i.Button("toolbar-sectionTool-z");l.setToolTip("Add Z plane"),l.setIcon("adsk-icon-plane-z"),l.onClick=o(l,"z"),t.addControl(l);var h=this.sectionBoxButton=new i.Button("toolbar-sectionTool-box");h.setToolTip("Add box"),h.setIcon("adsk-icon-box"),h.onClick=o(h,"box"),t.addControl(h),n.model?r():n.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,r,{once:!0})},h.destroyUI=function(){this.sectionToolButton&&(this.sectionToolButton.removeFromParent(),this.sectionToolButton=null)},h.activate=function(t){if(!this.activeStatus||this.mode!==t){switch(this.enableSectionTool(!0),t){default:case"x":this.tool.setSection("X"),this.mode="x";break;case"y":this.tool.setSection("Y"),this.mode="y";break;case"z":this.tool.setSection("Z"),this.mode="z";break;case"box":this.tool.setSection("BOX"),this.mode="box"}return this.activeStatus=!0,!0}},h.deactivate=function(){return!!this.activeStatus&&(this.tool.setActiveMode(""),this.enableSectionTool(!1),this.activeStatus=!1,!0)},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",l)}});
//# sourceMappingURL=Section.min.js.map