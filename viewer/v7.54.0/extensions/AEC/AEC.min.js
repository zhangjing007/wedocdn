/*! For license information please see AEC.min.js.LICENSE.txt */
(()=>{var __webpack_modules__={7400:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(87537),r=n.n(i),o=n(23645),s=n.n(o)()(r());s.push([e.id,".avatar-widget{width:0px;height:0px;top:0px;left:0px;position:absolute;transition:opacity 0.7s;opacity:0;z-index:1;pointer-events:none;will-change:transform}.avatar-widget.visible{opacity:0.7;pointer-events:all}.avatar-frustum{border-left:20px solid transparent;border-right:20px solid transparent;border-top:40px solid #3590e9;border-radius:50%;opacity:0.4;width:0px;height:0px;position:absolute;transform-origin:bottom center;cursor:crosshair;will-change:transform}.avatar-frustum.touch{border-left:40px solid transparent;border-right:40px solid transparent;border-top:80px solid #3590e9}.avatar-position-fill{width:10px;height:10px;left:15px;top:35px;position:absolute;border-radius:50%;background-color:#3590e9;box-shadow:0px 0px 0px 2px #fff}.avatar-position-fill.touch{left:35px;top:75px}.avatar-position-hitarea{position:absolute;width:15px;height:15px;left:5px;top:5px;border-radius:50px;transform:translate(-50%, -50%);cursor:grab}.avatar-position-hitarea.touch{width:50px;height:50px}\n","",{version:3,sources:["webpack://./extensions/AEC/Avatar/Avatar.scss"],names:[],mappings:"AAAA,eACI,SAAW,CACX,UAAW,CACX,OAAQ,CACR,QAAS,CACT,iBAAkB,CAClB,uBAAwB,CACxB,SAAU,CACV,SAAU,CACV,mBAAoB,CAOpB,qBAAsB,CAhB1B,uBAYQ,WAAY,CACZ,kBAAmB,CACtB,gBAMD,kCAAmC,CACnC,mCAAoC,CACpC,6BAA8B,CAC9B,iBAAkB,CAClB,WAAY,CACZ,SAAW,CACX,UAAW,CACX,iBAAkB,CAClB,8BAA+B,CAC/B,gBAAiB,CAQjB,qBAAsB,CAlB1B,sBAaQ,kCAAmC,CACnC,mCAAoC,CACpC,6BAA8B,CACjC,sBAMD,UAAW,CACX,WAAY,CAEZ,SAAU,CACV,QAAS,CACT,iBAAkB,CAClB,iBAAkB,CAClB,wBAAyB,CACzB,+BAAgC,CATpC,4BAaQ,SAAU,CACV,QAAS,CACZ,yBAID,iBAAkB,CAClB,UAAW,CACX,WAAY,CACZ,QAAS,CACT,OAAQ,CACR,kBAAmB,CACnB,+BAAgC,CAChC,WAAY,CARhB,+BAWQ,UAAW,CACX,WAAY",sourcesContent:['.avatar-widget {\n    width:  0px;\n    height: 0px;\n    top: 0px;\n    left: 0px;\n    position: absolute;\n    transition: opacity 0.7s; // Value matches "FADE_DURATION" inside SheetSyncConstants.js\n    opacity: 0;\n    z-index: 1;\n    pointer-events: none;\n\n    &.visible {\n        opacity: 0.7;\n        pointer-events: all;\n    }\n\n    will-change: transform;\n}\n\n.avatar-frustum {\n    border-left: 20px solid transparent;\n    border-right: 20px solid transparent;\n    border-top: 40px solid #3590e9;\n    border-radius: 50%;\n    opacity: 0.4;\n    width:  0px;\n    height: 0px;\n    position: absolute;\n    transform-origin: bottom center;\n    cursor: crosshair;\n\n    &.touch {\n        border-left: 40px solid transparent;\n        border-right: 40px solid transparent;\n        border-top: 80px solid #3590e9;\n    }\n\n    will-change: transform;\n }\n\n.avatar-position-fill {\n    width: 10px;\n    height: 10px;\n    /* Move circle center to the tip of the frustum shape */\n    left: 15px; /* = (avatarFrustum.border-left - width/2)  */\n    top: 35px; /* = (avatarFrustum.border-top  - height/2) */\n    position: absolute;\n    border-radius: 50%;\n    background-color: #3590e9;\n    box-shadow: 0px 0px 0px 2px #fff;\n\n    &.touch {\n        /* Move circle center to the tip of the frustum shape */\n        left: 35px; /* = (avatarFrustum.border-left - width/2)  */\n        top: 75px; /* = (avatarFrustum.border-top  - height/2) */\n    }\n}\n\n.avatar-position-hitarea {\n    position: absolute;\n    width: 15px;\n    height: 15px;\n    left: 5px; /* avatar-position-fill.width/2 */\n    top: 5px; /* avatar-position-fill.height/2 */\n    border-radius: 50px;\n    transform: translate(-50%, -50%);\n    cursor: grab;\n\n    &.touch {\n        width: 50px;\n        height: 50px;\n    }\n}\n'],sourceRoot:""}]);const a=s},33773:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(87537),r=n.n(i),o=n(23645),s=n.n(o)()(r());s.push([e.id,".canvas-bookmark.adsk-button,.clustered-canvas-bookmark.adsk-button,.declustered-canvas-bookmark.adsk-button{position:absolute;left:0px;top:0px;border-style:none !important;color:white;margin:none;padding:0px;transition:visibility 0.5s, opacity 0.5s;opacity:0;visibility:hidden}.canvas-bookmark.adsk-button{width:22px;height:22px}.clustered-canvas-bookmark.adsk-button{width:29px;height:29px}.declustered-canvas-bookmark.adsk-button{width:29px;height:29px;color:lightgrey}.canvas-bookmark.visible{opacity:1;visibility:visible}.clustered-canvas-bookmark.visible{opacity:1;visibility:visible}\n","",{version:3,sources:["webpack://./extensions/AEC/CanvasBookmark/CanvasBookmark.css"],names:[],mappings:"AASA,6GACI,iBAAkB,CAClB,QAAS,CACT,OAAS,CACT,4BAA6B,CAC7B,WAAY,CACZ,WAAY,CACZ,WAAY,CACZ,wCAAyC,CACzC,SAAU,CACV,iBAAkB,CACrB,6BAGG,UAAY,CACZ,WAAY,CACf,uCAGG,UAAY,CACZ,WAAY,CACf,yCAGG,UAAY,CACZ,WAAY,CACZ,eAAgB,CACnB,yBAGG,SAAU,CACV,kBAAmB,CACtB,mCAGG,SAAU,CACV,kBAAmB",sourcesContent:["/*\nhttps://stackoverflow.com/questions/27900053/css-transition-with-visibility-not-working\n\nVisibility is an animatable property according to the spec, but transitions on visibility do not work gradually, as one might expect.\nInstead transitions on visibility delay hiding an element. On the other hand making an element visible works immediately.\nThis is as it is defined by the spec (in the case of the default timing function) and as it is implemented in the browsers.\n\n    ==> transition: visibility 0.7s, opacity 0.7s;\n*/\n.canvas-bookmark.adsk-button, .clustered-canvas-bookmark.adsk-button, .declustered-canvas-bookmark.adsk-button {\n    position: absolute;\n    left: 0px;\n    top:  0px;\n    border-style: none !important; /* Avoid border on button-hover */\n    color: white;\n    margin: none;\n    padding: 0px;\n    transition: visibility 0.5s, opacity 0.5s;\n    opacity: 0;\n    visibility: hidden;\n}\n\n.canvas-bookmark.adsk-button {\n    width:  22px;\n    height: 22px;\n}\n\n.clustered-canvas-bookmark.adsk-button {\n    width:  29px;\n    height: 29px;\n}\n\n.declustered-canvas-bookmark.adsk-button {\n    width:  29px;\n    height: 29px;\n    color: lightgrey;\n}\n\n.canvas-bookmark.visible {\n    opacity: 1;\n    visibility: visible;\n}\n\n.clustered-canvas-bookmark.visible {\n    opacity: 1;\n    visibility: visible;\n}\n"],sourceRoot:""}]);const a=s},79354:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(87537),r=n.n(i),o=n(23645),s=n.n(o)()(r());s.push([e.id,".camera-selector{width:0;height:0;border-left:50px solid transparent;border-right:50px solid transparent;border-top:100px solid #0696D7;border-radius:50%;transform-origin:bottom center;position:absolute;opacity:0.8;pointer-events:none;z-index:1}.camera-selector-position{width:20px;height:20px;border-radius:50%;background-color:#0696D7;position:absolute;opacity:0.8;pointer-events:none;z-index:1;transform:scale(1, 1);transition:transform 3s ease-in}.camera-selector-position--teleporting{transform:scale(0, 0)}.camera-selector-background{width:200px;height:200px;background-color:#0696D7;opacity:0.2;position:absolute;pointer-events:none;z-index:0;transform:translate(-100px, -100px);border-radius:50%}.dropme-guidenace-ui{display:flex;position:absolute;left:50%;top:20px;padding:10px 20px;transform:translate(-50%, 0);align-items:center;border:1px solid #9ec8f6;border-radius:4px;background-color:#edf5fd;color:#039be5;font-size:12px;box-shadow:0 2px 4px 0 rgba(0,0,0,0.25);opacity:1;z-index:999;overflow-y:hidden}\n","",{version:3,sources:["webpack://./extensions/AEC/DropMe/DropMe.css"],names:[],mappings:"AAAA,iBACI,OAAQ,CACR,QAAS,CACT,kCAAmC,CACnC,mCAAoC,CACpC,8BAA+B,CAC/B,iBAAkB,CAClB,8BAA+B,CAC/B,iBAAkB,CAClB,WAAY,CACZ,mBAAoB,CACpB,SAAU,CACb,0BAGG,UAAW,CACX,WAAY,CACZ,iBAAkB,CAClB,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,mBAAoB,CACpB,SAAU,CACV,qBAAqB,CACrB,+BAAgC,CACnC,uCAGG,qBAAqB,CACxB,4BAGG,WAAY,CACZ,YAAa,CACb,wBAAyB,CACzB,WAAY,CACZ,iBAAkB,CAClB,mBAAoB,CACpB,SAAU,CACV,mCAAoC,CACpC,iBAAkB,CACrB,qBAIG,YAAa,CACb,iBAAkB,CAClB,QAAS,CACT,QAAS,CACT,iBAAkB,CAClB,4BAA6B,CAC7B,kBAAmB,CACnB,wBAAyB,CACzB,iBAAkB,CAClB,wBAAyB,CACzB,aAAc,CACd,cAAe,CACf,uCAA2C,CAC3C,SAAU,CACV,WAAY,CACZ,iBAAkB",sourcesContent:[".camera-selector {\n    width: 0;\n    height: 0;\n    border-left: 50px solid transparent;\n    border-right: 50px solid transparent;\n    border-top: 100px solid #0696D7;\n    border-radius: 50%;\n    transform-origin: bottom center;\n    position: absolute;\n    opacity: 0.8;\n    pointer-events: none;\n    z-index: 1;\n}\n\n.camera-selector-position {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    background-color: #0696D7;\n    position: absolute;\n    opacity: 0.8;\n    pointer-events: none;\n    z-index: 1;\n    transform: scale(1,1);\n    transition: transform 3s ease-in;\n}\n\n.camera-selector-position--teleporting {\n    transform: scale(0,0);\n}\n\n.camera-selector-background {\n    width: 200px;\n    height: 200px;\n    background-color: #0696D7;\n    opacity: 0.2;\n    position: absolute;\n    pointer-events: none;\n    z-index: 0;\n    transform: translate(-100px, -100px);\n    border-radius: 50%;\n}\n\n/* mimic issues UI guidance for now as it was the only extension, featuring guidance so far */\n.dropme-guidenace-ui {\n    display: flex;\n    position: absolute;\n    left: 50%;\n    top: 20px;\n    padding: 10px 20px;\n    transform: translate(-50%, 0);\n    align-items: center;\n    border: 1px solid #9ec8f6;\n    border-radius: 4px;\n    background-color: #edf5fd;\n    color: #039be5;\n    font-size: 12px;\n    box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.25);\n    opacity: 1;\n    z-index: 999;\n    overflow-y: hidden;\n}\n"],sourceRoot:""}]);const a=s},38641:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(87537),r=n.n(i),o=n(23645),s=n.n(o)()(r());s.push([e.id,'.minimap3D{width:0px;height:0px;position:absolute;display:flex;flex-direction:column;transition:visibility 0.7s, opacity 0.7s;opacity:0;visibility:hidden;background:rgba(255,255,255,0.4);overflow:hidden;user-select:none;border-radius:4px;box-shadow:1px 1px 8px rgba(0,0,0,0.4)}.minimap3D.paddedForToolbar{right:70px}.minimapScrollArea{width:100%;height:100%;position:relative}.minimap3D.side-by-side{box-sizing:border-box;box-shadow:0px 0px 3px rgba(0,0,0,0.5);z-index:1;overflow-x:hidden}.minimap3D.side-by-side.left-2d-view{border-left:none;border-right:solid 2px #979797;left:0px}.minimap3D.visible{opacity:1;visibility:visible}.mapContainer{position:absolute;left:0px;top:0px;opacity:1}.mapImage{position:absolute;left:0px;top:0px;pointer-events:none}.floorNameLabel{z-index:2;position:absolute;top:0px;left:0px;opacity:0.99;background-color:#f5f5f5;box-shadow:1px 3px 10px 0 rgba(0,0,0,0.5);margin:4px;border-radius:5px}.floorNameLabel.dark{margin-top:10px;left:50%;transform:translate(-50%);border-radius:28px;background-color:rgba(50,50,50,0.8)}.floorNameLabel.light{margin-top:10px;left:50%;transform:translate(-50%);border-radius:28px;background-color:rgba(255,255,255,0.85);box-shadow:none}.floorText{margin:5px 5px 5px 5px;color:black;white-space:nowrap;text-overflow:ellipsis;overflow:hidden}.floorText.dark{padding:0px 15px;color:#FFFFFF;font-family:"Artifakt Element", Helvetica, Arial;font-size:14px}.floorText.light{padding:0px 15px;color:#000;font-family:"Artifakt Element", Helvetica, Arial;font-size:14px}.minimap-placeholder{left:0px;top:0px;position:absolute;background-color:rgba(255,255,255,0.5);opacity:1}.minimap-progressWidget{transform:translate(0, -50%);left:0px;top:50%;position:relative;height:fit-content;width:calc(100% - 60px);margin-left:30px;margin-right:30px}.minimap-progressText{color:black;text-align:left;position:relative}.minimap-progress{z-index:10;width:100%}.map-button-bar{z-Index:2;right:0px;top:0px;position:absolute;right:100%;display:flex;flex-direction:column;background-color:#f5f5f5;box-shadow:1px 3px 10px 0 rgba(0,0,0,0.5);margin-right:4px;margin-top:0px;border-radius:5px}.map-button-bar.side-by-side{margin-top:4px}.map-button-bar.side-by-side.left-2d-view{right:0px}.sheetmap-thumbnail{position:absolute;overflow:hidden}.side-by-side .minimap-header{border-radius:0}.minimap-header{background:#ffffff;display:flex;position:initial;align-items:center;justify-content:space-between;border-radius:4px 4px 0 0;width:100%;z-index:4;transform-origin:top;-moz-box-shadow:0px 2px 4px -2px rgba(0,0,0,0.5);-webkit-box-shadow:0px 2px 4px -2px rgba(0,0,0,0.5);box-shadow:0px 2px 4px -2px rgba(0,0,0,0.5)}.adsk-viewing-viewer.light-theme .minimap-header,.adsk-viewing-viewer.bim-theme .minimap-header,.adsk-viewing-viewer.acs-theme .minimap-header{border-bottom:1px solid #dcdcdc}.minimap-title{font-size:14px;text-align:left;text-align-last:left;margin-right:12px;-webkit-appearance:none;-moz-appearance:none;appearance:none;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.minimap-dropdown-wrapper{cursor:pointer;outline:none;white-space:nowrap;flex-grow:1;display:flex;align-items:center;overflow:hidden;margin-right:auto}.minimap-dropdown-wrapper:after{content:"";border-width:6px 5px 0 5px;border-style:solid;border-color:#819099 transparent}.minimap-dropdown{position:absolute;top:40px;left:5px;max-height:120px;margin:0;width:90%;background:#ffffff;list-style:none;opacity:0;pointer-events:none;overflow:scroll;overflow-x:hidden;border-radius:3px;z-index:10;box-shadow:0px 1px 7px rgba(0,0,0,0.3)}.minimap-dropdown li{display:block;color:#222222;text-decoration:none;border-left:5px;padding:8px 8px 8px 20px;font-size:14px;overflow:hidden;text-overflow:ellipsis}.minimap-dropdown li.active{background:#eef0f2}.minimap-dropdown li:hover{background:#f8f9fa}.minimap-dropdown.active{opacity:1;pointer-events:auto;padding:0 0 10px 0}\n',"",{version:3,sources:["webpack://./extensions/AEC/Minimap3D/Minimap3D.css"],names:[],mappings:"AASA,WACI,SAAY,CACZ,UAAY,CACZ,iBAAkB,CAClB,YAAa,CACb,qBAAsB,CACtB,wCAAyC,CACzC,SAAU,CACV,iBAAkB,CAClB,gCAAiC,CACjC,eAAgB,CAIhB,gBAAiB,CACjB,iBAAkB,CAClB,sCAA0C,CAC7C,4BAEG,UAAW,CACd,mBAGG,UAAW,CACX,WAAY,CACZ,iBAAkB,CACrB,wBAIG,qBAAsB,CACtB,sCAA0C,CAC1C,SAAU,CACV,iBAAkB,CACrB,qCAGG,gBAAiB,CACjB,8BAA+B,CAC/B,QAAS,CACZ,mBAGG,SAAU,CACV,kBAAmB,CACtB,cAIG,iBAAkB,CAClB,QAAS,CACT,OAAQ,CACR,SAAU,CACb,UAGG,iBAAkB,CAClB,QAAS,CACT,OAAQ,CACR,mBAAoB,CACvB,gBAIG,SAAU,CACV,iBAAkB,CAClB,OAAQ,CACR,QAAS,CACT,YAAa,CACb,wBAA0C,CAC1C,yCAA6C,CAC7C,UAAW,CACX,iBAAkB,CACrB,qBAGG,eAAgB,CAChB,QAAS,CACT,yBAA0B,CAC1B,kBAAmB,CACnB,mCAAuC,CAC1C,sBAGG,eAAgB,CAChB,QAAS,CACT,yBAA0B,CAC1B,kBAAmB,CACnB,uCAA2C,CAC3C,eAAgB,CACnB,WAGG,sBAAuB,CACvB,WAAY,CACZ,kBAAmB,CACnB,sBAAuB,CACvB,eAAgB,CACnB,gBAGG,gBAAiB,CACjB,aAAc,CACd,gDAAiD,CACjD,cAAe,CAClB,iBAGG,gBAAiB,CACjB,UAAW,CACX,gDAAiD,CACjD,cAAe,CAClB,qBAIG,QAAS,CACT,OAAQ,CACR,iBAAkB,CAClB,sCAA0C,CAC1C,SAAU,CACb,wBAGG,4BAA6B,CAC7B,QAAS,CACT,OAAQ,CACR,iBAAkB,CAClB,kBAAmB,CACnB,uBAAwB,CACxB,gBAAiB,CACjB,iBAAkB,CACrB,sBAGG,WAAY,CACZ,eAAgB,CAChB,iBAAkB,CACrB,kBAGG,UAAW,CACX,UAAW,CACd,gBAGG,SAAU,CACV,SAAU,CACV,OAAQ,CACR,iBAAkB,CAClB,UAAW,CACX,YAAa,CACb,qBAAsB,CACtB,wBAA0C,CAC1C,yCAA6C,CAC7C,gBAAiB,CACjB,cAAe,CACf,iBAAkB,CACrB,6BAIG,cAAe,CAClB,0CAGG,SAAU,CACb,oBAGG,iBAAkB,CAClB,eAAgB,CACnB,8BAGG,eAAgB,CACnB,gBAGG,kBAAmB,CACnB,YAAa,CACb,gBAAiB,CACjB,kBAAmB,CACnB,6BAA8B,CAC9B,yBAA0B,CAC1B,UAAW,CACX,SAAS,CACT,oBAAqB,CACrB,gDAAqD,CACrD,mDAAwD,CACxD,2CAAgD,CACnD,+IAKG,+BAAgC,CACnC,eAGG,cAAe,CACf,eAAgB,CAChB,oBAAqB,CACrB,iBAAkB,CAClB,uBAAwB,CACxB,oBAAqB,CACrB,eAAgB,CAChB,kBAAmB,CACnB,eAAgB,CAChB,sBAAuB,CAC1B,0BAGG,cAAe,CACf,YAAa,CACb,kBAAmB,CACnB,WAAY,CACZ,YAAa,CACb,kBAAmB,CACnB,eAAgB,CAChB,iBAAkB,CACrB,gCAGG,UAAW,CACX,0BAA2B,CAC3B,kBAAmB,CACnB,gCAAiC,CACpC,kBAGG,iBAAkB,CAClB,QAAS,CACT,QAAS,CACT,gBAAiB,CACjB,QAAS,CACT,SAAU,CACV,kBAAmB,CACnB,eAAgB,CAChB,SAAU,CACV,mBAAoB,CACpB,eAAgB,CAChB,iBAAkB,CAClB,iBAAkB,CAClB,UAAW,CACX,sCAAwC,CAC3C,qBAGG,aAAc,CACd,aAAc,CACd,oBAAqB,CACrB,eAAgB,CAChB,wBAAyB,CACzB,cAAe,CACf,eAAgB,CAChB,sBAAuB,CAC1B,4BAGG,kBAA8B,CACjC,2BAGG,kBAA8B,CACjC,yBAGG,SAAU,CACV,mBAAoB,CACpB,kBAAmB",sourcesContent:['/*\nhttps://stackoverflow.com/questions/27900053/css-transition-with-visibility-not-working\n\nVisibility is an animatable property according to the spec, but transitions on visibility do not work gradually, as one might expect.\nInstead transitions on visibility delay hiding an element. On the other hand making an element visible works immediately.\nThis is as it is defined by the spec (in the case of the default timing function) and as it is implemented in the browsers.\n\n    ==> transition: visibility 0.7s, opacity 0.7s;\n*/\n.minimap3D {\n    width:   0px;\n    height:  0px;\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    transition: visibility 0.7s, opacity 0.7s;\n    opacity: 0;\n    visibility: hidden;    \n    background: rgba(255,255,255,0.4);\n    overflow: hidden;\n\n    /* For side-by-side mode: Make sure that text selection highlighting is disabled on Minimap. Otherwise, fast dragging of the player will\n       color the whole map in blue */\n    user-select: none;\n    border-radius: 4px;\n    box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.4);\n}\n.minimap3D.paddedForToolbar {\n    right: 70px;\n}\n\n.minimapScrollArea {\n    width: 100%;  \n    height: 100%;\n    position: relative;\n}\n\n/* Show map left-aligned and without margin */\n.minimap3D.side-by-side {\n    box-sizing: border-box;\n    box-shadow: 0px 0px 3px rgba(0, 0, 0, 0.5);\n    z-index: 1;\n    overflow-x: hidden;\n}\n\n.minimap3D.side-by-side.left-2d-view {\n    border-left: none;\n    border-right: solid 2px #979797;\n    left: 0px;\n}\n\n.minimap3D.visible {\n    opacity: 1;\n    visibility: visible;\n}\n\n/* Container for floor image + floor name */\n.mapContainer {\n    position: absolute;\n    left: 0px;\n    top: 0px;\n    opacity: 1;\n}\n\n.mapImage {\n    position: absolute;\n    left: 0px;\n    top: 0px;\n    pointer-events: none;\n}\n\n/* Display floor name at top left */\n.floorNameLabel {\n    z-index: 2;\n    position: absolute;\n    top: 0px;\n    left: 0px;\n    opacity: 0.99;\n    background-color: rgba(245, 245, 245, 1.0);\n    box-shadow: 1px 3px 10px 0 rgba(0, 0, 0, 0.5);\n    margin: 4px;\n    border-radius: 5px;\n}\n\n.floorNameLabel.dark {\n    margin-top: 10px;\n    left: 50%;\n    transform: translate(-50%);\n    border-radius: 28px;\n    background-color: rgba(50, 50, 50, 0.8);\n}\n\n.floorNameLabel.light {\n    margin-top: 10px;\n    left: 50%;\n    transform: translate(-50%);\n    border-radius: 28px;\n    background-color: rgba(255, 255, 255, 0.85);\n    box-shadow: none;\n}\n\n.floorText {\n    margin: 5px 5px 5px 5px;\n    color: black;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n}\n\n.floorText.dark {\n    padding: 0px 15px;\n    color: #FFFFFF;\n    font-family: "Artifakt Element", Helvetica, Arial;\n    font-size: 14px;\n}\n\n.floorText.light {\n    padding: 0px 15px;\n    color: #000;\n    font-family: "Artifakt Element", Helvetica, Arial;\n    font-size: 14px;\n}\n\n/* Div with text and progressbar - replaces the map image if map computation is running */\n.minimap-placeholder {\n    left: 0px;\n    top: 0px;\n    position: absolute;\n    background-color: rgba(255, 255, 255, 0.5);\n    opacity: 1;\n}\n\n.minimap-progressWidget {\n    transform: translate(0, -50%);\n    left: 0px;\n    top: 50%;\n    position: relative;\n    height: fit-content;\n    width: calc(100% - 60px);\n    margin-left: 30px;\n    margin-right: 30px;\n}\n\n.minimap-progressText {\n    color: black;\n    text-align: left;\n    position: relative;\n}\n\n.minimap-progress {\n    z-index: 10;\n    width: 100%;\n}\n\n.map-button-bar {\n    z-Index: 2;\n    right: 0px;\n    top: 0px;\n    position: absolute;\n    right: 100%; /* Dock left to mapWidget */\n    display: flex;\n    flex-direction: column;\n    background-color: rgba(245, 245, 245, 1.0);\n    box-shadow: 1px 3px 10px 0 rgba(0, 0, 0, 0.5);\n    margin-right: 4px;\n    margin-top: 0px; /* Toolbar is vertically aligned to the upper mapWidget boundary. This is okay, because the mapWidget already has some margin from the canvas boundary. */\n    border-radius: 5px;\n}\n\n/* In side-by-side, the upper mapWidget edge is matched with the upper canvas edge. So, we add some marigin - otherwise the toolbar would be "glued" to the upper canvas edge. */    \n.map-button-bar.side-by-side {\n    margin-top: 4px; \n}\n\n.map-button-bar.side-by-side.left-2d-view {\n    right: 0px;\n}\n\n.sheetmap-thumbnail {\n    position: absolute;\n    overflow: hidden;\n}\n\n.side-by-side .minimap-header {\n    border-radius: 0;\n}\n\n.minimap-header {\n    background: #ffffff;\n    display: flex;\n    position: initial;\n    align-items: center;\n    justify-content: space-between;\n    border-radius: 4px 4px 0 0;\n    width: 100%;\n    z-index:4;\n    transform-origin: top;\n    -moz-box-shadow: 0px 2px 4px -2px  rgba(0, 0, 0, 0.5);\n    -webkit-box-shadow: 0px 2px 4px -2px  rgba(0, 0, 0, 0.5);\n    box-shadow: 0px 2px 4px -2px  rgba(0, 0, 0, 0.5);\n}\n\n.adsk-viewing-viewer.light-theme .minimap-header,\n.adsk-viewing-viewer.bim-theme .minimap-header,\n.adsk-viewing-viewer.acs-theme .minimap-header {\n    border-bottom: 1px solid #dcdcdc;\n}\n\n.minimap-title {\n    font-size: 14px;\n    text-align: left;\n    text-align-last: left;\n    margin-right: 12px;\n    -webkit-appearance: none;\n    -moz-appearance: none;\n    appearance: none;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.minimap-dropdown-wrapper {\n    cursor: pointer;\n    outline: none;\n    white-space: nowrap;\n    flex-grow: 1;\n    display: flex;\n    align-items: center;\n    overflow: hidden;\n    margin-right: auto;\n}\n\n.minimap-dropdown-wrapper:after {\n    content: "";\n    border-width: 6px 5px 0 5px;\n    border-style: solid;\n    border-color: #819099 transparent;\n}\n\n.minimap-dropdown {\n    position: absolute;\n    top: 40px;\n    left: 5px;\n    max-height: 120px;\n    margin: 0;\n    width: 90%;\n    background: #ffffff;\n    list-style: none;\n    opacity: 0;\n    pointer-events: none;\n    overflow: scroll;\n    overflow-x: hidden;\n    border-radius: 3px;\n    z-index: 10;\n    box-shadow: 0px 1px 7px rgba(0,0,0, 0.3);\n}\n\n.minimap-dropdown li {\n    display: block;\n    color: #222222;\n    text-decoration: none;\n    border-left: 5px;\n    padding: 8px 8px 8px 20px;\n    font-size: 14px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.minimap-dropdown li.active {\n    background: rgb(238, 240, 242);\n}\n\n.minimap-dropdown li:hover {\n    background: rgb(248, 249, 250);\n}\n\n.minimap-dropdown.active {\n    opacity: 1;\n    pointer-events: auto;\n    padding: 0 0 10px 0;\n}'],sourceRoot:""}]);const a=s},95699:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var i=n(87537),r=n.n(i),o=n(23645),s=n.n(o),a=n(61667),c=n.n(a),u=new URL(n(31194),n.b),l=new URL(n(88502),n.b),h=new URL(n(20026),n.b),d=s()(r()),p=c()(u),g=c()(l),f=c()(h);d.push([e.id,'.list-panel{width:260px;min-width:260px;height:260px;min-height:260px;top:180px;left:220px;border-color:transparent}.list-panel .itemList{width:100%;display:flex;flex-direction:column}.list-panel .listItem{display:flex;justify-content:space-between;text-align:left;line-height:35px;background-color:rgba(0,0,0,0);border-style:none;font-family:"ArtifaktElement", "Helvetica Neue", "Segoe UI Semilight", sans-serif;padding:0 10px}.adsk-viewing-viewer.dark-theme .listItem{color:#f3f7fb}.adsk-viewing-viewer.light-theme .list-panel .listItem.hover{background-color:rgba(10,19,28,0.2)}.adsk-viewing-viewer.dark-theme .list-panel .listItem.hover{background-color:#4a555b}.list-panel .listItem:focus{outline:none}.list-panel .listItem.selected{color:#00bfff;border-style:none}.list-panel .listItem .textContainer{-webkit-mask-image:linear-gradient(to left, transparent, black 1em);mask-image:linear-gradient(to left, transparent, black 1em);white-space:nowrap;overflow:hidden;width:100%}.list-panel .listItem .icon{width:24px}.list-panel .listItem.selected .icon::before{content:\'\\2713\';margin-left:8px}.list-panel-item-warning{background-image:url('+p+");width:24px;height:24px;margin-left:auto;margin-top:auto;margin-bottom:auto}.list-panel .visibility{right:0;top:0;width:35px;height:35px;border:none;outline:none;margin:0;padding:0;background-position:6px 12px;background-image:url("+g+");background-repeat:no-repeat;opacity:0.7;position:relative}.list-panel .dim div.visibility{background-position:6px 9px;background-image:url("+f+");opacity:0.3}\n","",{version:3,sources:["webpack://./extensions/AEC/ui/ListPanel.css"],names:[],mappings:"AACA,YACI,WAAY,CACZ,eAAgB,CAChB,YAAa,CACb,gBAAiB,CACjB,SAAU,CACV,UAAW,CACX,wBAAwB,CAC3B,sBAGG,UAAW,CACX,YAAa,CACb,qBAAsB,CACzB,sBAGG,YAAa,CACb,6BAA8B,CAC9B,eAAgB,CAChB,gBAAiB,CACjB,8BAAoC,CACpC,iBAAkB,CAElB,iFAAkF,CAElF,cAAe,CAClB,0CAGG,aAAc,CACjB,6DAGG,mCAAuC,CAC1C,4DAGG,wBAAyB,CAC5B,4BAGG,YAAa,CAChB,+BAGG,aAA6B,CAC7B,iBAAkB,CACrB,qCAGG,mEAAoE,CACpE,2DAA4D,CAC5D,kBAAmB,CACnB,eAAgB,CAChB,UAAW,CACd,4BAGG,UAAW,CACd,6CAGG,eAAgB,CAChB,eAAgB,CACnB,yBAGG,wDAAue,CACve,UAAY,CACZ,WAAY,CACZ,gBAAiB,CACjB,eAAgB,CAChB,kBAAmB,CACtB,wBAGG,OAAQ,CACR,KAAM,CACN,UAAW,CACX,WAAY,CACZ,WAAY,CACZ,YAAa,CACb,QAAS,CACT,SAAU,CACV,4BAA6B,CAC7B,wDAAmpK,CACnpK,2BAA4B,CAC5B,WAAY,CACZ,iBAAkB,CACrB,gCAIG,2BAA4B,CAC5B,wDAAmpF,CACnpF,WAAY",sourcesContent:['\n.list-panel {\n    width: 260px;\n    min-width: 260px;\n    height: 260px;\n    min-height: 260px;\n    top: 180px;\n    left: 220px;\n    border-color:transparent;\n}\n\n.list-panel .itemList {\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n}\n\n.list-panel .listItem {\n    display: flex;\n    justify-content: space-between;\n    text-align: left;\n    line-height: 35px;\n    background-color: rgba(0, 0, 0, 0.0);\n    border-style: none;\n\n    font-family: "ArtifaktElement", "Helvetica Neue", "Segoe UI Semilight", sans-serif;\n\n    padding: 0 10px;\n}\n\n.adsk-viewing-viewer.dark-theme .listItem {\n    color: #f3f7fb;\n}\n\n.adsk-viewing-viewer.light-theme .list-panel .listItem.hover {\n    background-color: rgba(10, 19, 28, 0.2);\n}\n\n.adsk-viewing-viewer.dark-theme .list-panel .listItem.hover {\n    background-color: #4a555b;\n}\n\n.list-panel .listItem:focus {\n    outline: none;\n}\n\n.list-panel .listItem.selected {\n    color: rgba(0, 191, 255, 1.0);\n    border-style: none;\n}\n\n.list-panel .listItem .textContainer {\n    -webkit-mask-image: linear-gradient(to left, transparent, black 1em);\n    mask-image: linear-gradient(to left, transparent, black 1em);\n    white-space: nowrap;\n    overflow: hidden;\n    width: 100%;\n}\n\n.list-panel .listItem .icon {\n    width: 24px;\n}\n\n.list-panel .listItem.selected .icon::before {\n    content: \'\\2713\';\n    margin-left: 8px;\n}\n\n.list-panel-item-warning {\n    background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScyNCcgaGVpZ2h0PScyNCcgdmlld0JveD0nMCAwIDggOCc+PHBhdGggZmlsbD0nIzZiNzg3ZicgZD0nTTMuMDkgMGMtLjA2IDAtLjEuMDQtLjEzLjA5bC0yLjk0IDYuODFjLS4wMi4wNS0uMDMuMTMtLjAzLjE5di44MWMwIC4wNS4wNC4wOS4wOS4wOWg2LjgxYy4wNSAwIC4wOS0uMDQuMDktLjA5di0uODFjMC0uMDUtLjAxLS4xNC0uMDMtLjE5bC0yLjk0LTYuODFjLS4wMi0uMDUtLjA3LS4wOS0uMTMtLjA5aC0uODF6bS0uMDkgM2gxdjJoLTF2LTJ6bTAgM2gxdjFoLTF2LTF6JyAvPjwvc3ZnPg==");\n    width:  24px;\n    height: 24px;\n    margin-left: auto;\n    margin-top: auto;\n    margin-bottom: auto;\n}\n\n.list-panel .visibility {\n    right: 0;\n    top: 0;\n    width: 35px;\n    height: 35px;\n    border: none;\n    outline: none;\n    margin: 0;\n    padding: 0;\n    background-position: 6px 12px;\n    background-image: url(\'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+DQo8c3ZnIHdpZHRoPSIxN3B4IiBoZWlnaHQ9IjEwcHgiIHZpZXdCb3g9IjAgMCAxNyAxMCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4NCiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDQ2LjIgKDQ0NDk2KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4NCiAgICA8dGl0bGU+R3JvdXAgMjU8L3RpdGxlPg0KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPg0KICAgIDxkZWZzPjwvZGVmcz4NCiAgICA8ZyBpZD0iU2VsZWN0LSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+DQogICAgICAgIDxnIGlkPSJNb2RlbF9Ccm93c2VyX2hvdmVyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjYzLjAwMDAwMCwgLTE5NS4wMDAwMDApIj4NCiAgICAgICAgICAgIDxnIGlkPSJHcm91cC0yNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjUzLjAwMDAwMCwgNzQuMDAwMDAwKSI+DQogICAgICAgICAgICAgICAgPGcgaWQ9Ikdyb3VwLTE2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjAwMDAwMCwgMzYuMDAwMDAwKSI+DQogICAgICAgICAgICAgICAgICAgIDxnIGlkPSJHcm91cC0yNSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDcyLjAwMDAwMCkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGcgaWQ9Im1hcmt1cC1kaXNwbGF5LW9uIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iR3JvdXAtMjIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iZ3VpZGUiIG9wYWNpdHk9IjAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4LjAwMDAwMCwgMTguMDAwMDAwKSBzY2FsZSgxLCAtMSkgdHJhbnNsYXRlKC0xOC4wMDAwMDAsIC0xOC4wMDAwMDApICIgZmlsbD0iI0ZGOTg5OCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLTQiIHg9IjAiIHk9IjAiIHdpZHRoPSIzNiIgaGVpZ2h0PSIzNiI+PC9yZWN0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2c+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxnIGlkPSJzaG93LW1hcmtlcnMtaWNvbiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAuMDAwMDAwLCAxMy4wMDAwMDApIiBmaWxsLXJ1bGU9Im5vbnplcm8iIGZpbGw9IiNGRkZGRkYiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGcgaWQ9IkxheWVyXzEiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMi40NzQsMC44MjM0NjMwNTcgQzEzLjQwOTk4ODMsMS4yMTU3ODg4NiAxNC4yODMzMDE4LDEuNzQzNDE1NzQgMTUuMDY2LDIuMzg5NDYzMDYgQzE1Ljc3NjcxMTYsMy4wMjUzOTQ1MSAxNi4zNzg2NTM3LDMuNzczMjYxOTMgMTYuODQ4LDQuNjAzNDYzMDYgQzE2LjQ5NzQ1OTEsNS41MTE5MjQ3NyAxNS45NjQ0OTk5LDYuMzM4OTMwNDMgMTUuMjgyLDcuMDMzNDYzMDYgQzE0LjUzNjE5MjEsNy43MzAyNjE3MSAxMy42NzgxNDUsOC4yOTYyMDc2OSAxMi43NDQsOC43MDc0NjMwNiBDMTEuMzYxMDM2NSw5LjI5MzUzOTU4IDkuODcxOTM1NjEsOS41ODc2ODI5NyA4LjM3LDkuNTcxNDYzMDYgQzYuODk2MjcwMjEsOS42NTA4OTU4OCA1LjQyMjc0OTI5LDkuNDExNDQ4NzMgNC4wNSw4Ljg2OTQ2MzA2IEMzLjExMzAyOTI4LDguNDg3MzIwMTcgMi4yNTMxMTg1Niw3LjkzODQ0MDk5IDEuNTEyLDcuMjQ5NDYzMDYgQzAuODQyNjYxOTQ4LDYuNTM0MTYwMTUgMC4zMjc5NTI0MTksNS42ODg1NjU5MiAwLDQuNzY1NDYzMDYgQzAuNDU1MjQyNjA0LDMuODYyMzEzMjkgMS4wNTc0NTAzMSwzLjA0MTEyMDk2IDEuNzgyLDIuMzM1NDYzMDYgQzIuNTUyMzY1MDQsMS42NTgzODQzOSAzLjQyNzgxNDI3LDEuMTExMjI4NjIgNC4zNzQsMC43MTU0NjMwNTcgQzUuNjUzNTg1NzEsMC4xNzgzNTEzOTYgNy4wMzgyOTI4MywtMC4wNjE2NjQ1MDQ1IDguNDI0LDAuMDEzNDYzMDU3MyBDOS44MTM2NzUzNCwwLjAxOTA0NzQ5MjggMTEuMTg5MDc0OSwwLjI5NDEyNzQwNiAxMi40NzQsMC44MjM0NjMwNTcgWiBNOC41MzIsOC4wNTk0NjMwNiBDOC45NjAxMDIyOSw4LjA1NTI5NTM2IDkuMzgyODA0ODMsNy45NjM0MDM1IDkuNzc0LDcuNzg5NDYzMDYgQzEwLjE1NjgyNjIsNy42MjE1NjcyNCAxMC41MDQ4MjQyLDcuMzgzNDYzMyAxMC44LDcuMDg3NDYzMDYgQzExLjQwOTE4MDYsNi40NzA2MDIwNyAxMS43NDA2NzExLDUuNjMyMTI1ODggMTEuNzE4LDQuNzY1NDYzMDYgQzExLjcyNjA1ODMsMy45MTc0MTMzNSAxMS4zOTU2NjU0LDMuMTAxMTQ4NDMgMTAuOCwyLjQ5NzQ2MzA2IEMxMC41MDQ4MjQyLDIuMjAxNDYyODIgMTAuMTU2ODI2MiwxLjk2MzM1ODg3IDkuNzc0LDEuNzk1NDYzMDYgQzguOTYzMjAwODEsMS40NTAzMjYwNyA4LjA0Njc5OTE5LDEuNDUwMzI2MDcgNy4yMzYsMS43OTU0NjMwNiBDNi44NTMxNzM4NCwxLjk2MzM1ODg3IDYuNTA1MTc1NzYsMi4yMDE0NjI4MiA2LjIxLDIuNDk3NDYzMDYgQzUuNjAwODE5NDUsMy4xMTQzMjQwNSA1LjI2OTMyODg2LDMuOTUyODAwMjQgNS4yOTIsNC44MTk0NjMwNiBDNS4yOTc2Njg2Nyw1LjI0NzM5NTM2IDUuMzg5NDk1NjMsNS42Njk3OTkzOSA1LjU2Miw2LjA2MTQ2MzA2IEM1LjcyNzU3OTMsNi40NDU1NzAxMyA1Ljk2NTk2NjY2LDYuNzkzOTgyNDQgNi4yNjQsNy4wODc0NjMwNiBDNi41NTgzNDMzMyw3LjM4NDQ2MzMxIDYuOTA2NTQzMzEsNy42MjI3MDU0IDcuMjksNy43ODk0NjMwNiBDNy42ODExOTUxNyw3Ljk2MzQwMzUgOC4xMDM4OTc3MSw4LjA1NTI5NTM2IDguNTMyLDguMDU5NDYzMDYgTDguNTMyLDguMDU5NDYzMDYgWiBNMTAuNDIyLDQuNzY1NDYzMDYgQzEwLjQxNjM1ODgsNC41MjI4NzM5MiAxMC4zNjEyMzI0LDQuMjgzOTkyNjggMTAuMjYsNC4wNjM0NjMwNiBDMTAuMTcyMzE3OCwzLjg0MzUzNDU2IDEwLjA0NDA5MzQsMy42NDIwMzg5NiA5Ljg4MiwzLjQ2OTQ2MzA2IEM5LjcxMTEwOTY4LDMuMzA1MjEyNSA5LjUwOTE2ODc2LDMuMTc2NzA0NjUgOS4yODgsMy4wOTE0NjMwNiBMOC41ODYsMi45Mjk0NjMwNiBMNy44ODQsMy4wOTE0NjMwNiBDNy40NDYzNTgyNiwzLjI3NzM3MzU0IDcuMDk3OTEwNDgsMy42MjU4MjEzMSA2LjkxMiw0LjA2MzQ2MzA2IEM2LjcxMDc1NzY2LDQuNTI4NjMwNTEgNi43MTA3NTc2Niw1LjA1NjI5NTYxIDYuOTEyLDUuNTIxNDYzMDYgQzcuMDg0OTYzNjIsNS45NDkzMjI1NiA3LjQxMjcxNDA0LDYuMjk2MzUyNDMgNy44Myw2LjQ5MzQ2MzA2IEw4LjUzMiw2LjY1NTQ2MzA2IEw5LjIzNCw2LjQ5MzQ2MzA2IEM5LjQ1NDUzMTUzLDYuNDA2OTYzMjEgOS42NTYyMzk3Miw2LjI3ODYwMzQ1IDkuODI4LDYuMTE1NDYzMDYgQzkuOTg5MTA0MjEsNS45NDIxMjA5IDEwLjExNzIwNDgsNS43NDA4MjAwMiAxMC4yMDYsNS41MjE0NjMwNiBDMTAuMzE0Njc2MSw1LjI4NDM1NTU3IDEwLjM2OTk3NzYsNS4wMjYyODIwNCAxMC4zNjgsNC43NjU0NjMwNiBMMTAuNDIyLDQuNzY1NDYzMDYgWiIgaWQ9IlNoYXBlIj48L3BhdGg+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2c+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2c+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2c+DQogICAgICAgICAgICAgICAgICAgIDwvZz4NCiAgICAgICAgICAgICAgICA8L2c+DQogICAgICAgICAgICA8L2c+DQogICAgICAgIDwvZz4NCiAgICA8L2c+DQo8L3N2Zz4=\');\n    background-repeat: no-repeat;\n    opacity: 0.7;\n    position: relative;\n}\n\n/* symbol for "visibility toggled off": eye with strike-through. */\n.list-panel .dim div.visibility {\n    background-position: 6px 9px;\n    background-image: url(\'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+DQo8c3ZnIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE1cHgiIHZpZXdCb3g9IjAgMCAxNiAxNSIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4NCiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDQ2ICg0NDQyMykgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+DQogICAgPHRpdGxlPm1hcmt1cF9kaXNwbGF5X3R1cm5fb2ZmPC90aXRsZT4NCiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4NCiAgICA8ZGVmcz48L2RlZnM+DQogICAgPGcgaWQ9IlBhZ2UtNiIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+DQogICAgICAgIDxnIGlkPSJDYW1lcmEtSW50ZXJhY3Rpb25zLS0tSG92ZXItQ29weSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEwNTcuMDAwMDAwLCAtMTIzLjAwMDAwMCkiIGZpbGw9IiNGNEY0RjQiPg0KICAgICAgICAgICAgPGcgaWQ9Ikdyb3VwLTE5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4MTAuMDAwMDAwLCAxMTIuMDAwMDAwKSI+DQogICAgICAgICAgICAgICAgPGcgaWQ9Im1hcmt1cC1kaXNwbGF5LW9mZiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjM5LjAwMDAwMCwgMy4wMDAwMDApIj4NCiAgICAgICAgICAgICAgICAgICAgPGcgaWQ9Im1hcmt1cF9kaXNwbGF5X3R1cm5fb2ZmIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4LjAwMDAwMCwgOC4wMDAwMDApIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNC4zMjIsMC41OTQgQzE0LjA1OCwwLjMzIDEzLjY2MiwwLjMzIDEzLjM5OCwwLjU5NCBMMTAuMzYyLDMuNjMgQzkuNTcsMy40MzIgOC43NzgsMy4yMzQgNy45MiwzLjIzNCBDNC4zNTYsMy4yMzQgMS4zMiw1LjQxMiAwLDguMDUyIEwwLDguMDUyIEMwLjU5NCw5LjI0IDEuNTg0LDEwLjM2MiAyLjc3MiwxMS4yMiBMMC40NjIsMTMuNTMgQzAuMTk4LDEzLjc5NCAwLjE5OCwxNC4xOSAwLjQ2MiwxNC40NTQgQzAuNzI2LDE0LjcxOCAxLjEyMiwxNC43MTggMS4zODYsMTQuNDU0IEwxNC4zMjIsMS41MTggQzE0LjU4NiwxLjI1NCAxNC41ODYsMC44NTggMTQuMzIyLDAuNTk0IEwxNC4zMjIsMC41OTQgWiBNNC43NTIsOC4wNTIgQzQuNzUyLDYuMjcgNi4yMDQsNC44ODQgNy45Miw0Ljg4NCBDOC4yNSw0Ljg4NCA4LjY0Niw0Ljk1IDguOTEsNS4wODIgTDguMDUyLDUuOTQgTDcuODU0LDUuOTQgQzYuNjY2LDUuOTQgNS42NzYsNi45MyA1LjY3Niw4LjExOCBMNS42NzYsOC4zMTYgTDQuODE4LDkuMTc0IEM0LjgxOCw4Ljc3OCA0Ljc1Miw4LjM4MiA0Ljc1Miw4LjA1MiBMNC43NTIsOC4wNTIgWiBNNy45MiwxMC4yMyBDOS4xMDgsMTAuMjMgMTAuMDk4LDkuMjQgMTAuMDk4LDguMDUyIEMxMC4wOTgsNy44NTQgMTAuMDMyLDcuNjU2IDkuOTY2LDcuMzkyIEw3LjI2LDEwLjA5OCBDNy41MjQsMTAuMTY0IDcuNzIyLDEwLjIzIDcuOTIsMTAuMjMgTDcuOTIsMTAuMjMgWiBNMTUuODQsOC4wNTIgQzE1LjE4LDYuNzMyIDE0LjA1OCw1LjU0NCAxMi43MzgsNC42ODYgTDEwLjc1OCw2LjY2NiBDMTAuOTU2LDcuMDYyIDExLjA4OCw3LjU5IDExLjA4OCw4LjA1MiBDMTEuMDg4LDkuODM0IDkuNjM2LDExLjIyIDcuOTIsMTEuMjIgQzcuMzkyLDExLjIyIDYuOTMsMTEuMDg4IDYuNTM0LDEwLjg5IEw1LjA4MiwxMi4zNDIgQzUuOTQsMTIuNjcyIDYuOTMsMTIuODcgNy45MiwxMi44NyBDMTEuNDg0LDEyLjg3IDE0LjUyLDEwLjY5MiAxNS44NCw4LjA1MiBMMTUuODQsOC4wNTIgWiIgaWQ9IlNoYXBlIj48L3BhdGg+DQogICAgICAgICAgICAgICAgICAgIDwvZz4NCiAgICAgICAgICAgICAgICA8L2c+DQogICAgICAgICAgICA8L2c+DQogICAgICAgIDwvZz4NCiAgICA8L2c+DQo8L3N2Zz4=\');\n    opacity: 0.3;\n}\n'],sourceRoot:""}]);const v=d},23645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,r,o){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(i)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(s[c]=!0)}for(var u=0;u<e.length;u++){var l=[].concat(e[u]);i&&s[l[0]]||(void 0!==o&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=o),n&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=n):l[2]=n),r&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=r):l[4]="".concat(r)),t.push(l))}},t}},61667:e=>{"use strict";e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},87537:e=>{"use strict";e.exports=function(e){var t=e[1],n=e[3];if(!n)return t;if("function"==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(n)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),o="/*# ".concat(r," */"),s=n.sources.map((function(e){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(e," */")}));return[t].concat(s).concat([o]).join("\n")}return[t].join("\n")}},4031:(e,t,n)=>{"use strict";n.r(t),n.d(t,{AecModelData:()=>ie,AvatarExtension:()=>Vr,CanvasBookmarkExtension:()=>Wt,DropMeExtension:()=>pt,FloorSelector:()=>D,HyperlinkExtension:()=>Se,HyperlinkTracker:()=>Ae,Hypermodeling:()=>$i,LevelsExtension:()=>ve,ListPanel:()=>Y,ListPanelEvents:()=>G,Locations:()=>tr(),Minimap3DExtension:()=>Gi,SheetSyncExtension:()=>Zr,TopViewRendererExtension:()=>Xn,ViewportsExtension:()=>os});var i=n(93379),r=n.n(i),o=n(7795),s=n.n(o),a=n(90569),c=n.n(a),u=n(3565),l=n.n(u),h=n(19216),d=n.n(h),p=n(44589),g=n.n(p),f=n(95699),v={};v.styleTagTransform=g(),v.setAttributes=l(),v.insert=c().bind(null,"head"),v.domAPI=s(),v.insertStyleElement=d(),r()(f.Z,v),f.Z&&f.Z.locals&&f.Z.locals;var y=n(79354),m={};m.styleTagTransform=g(),m.setAttributes=l(),m.insert=c().bind(null,"head"),m.domAPI=s(),m.insertStyleElement=d(),r()(y.Z,m),y.Z&&y.Z.locals&&y.Z.locals;var _=n(33773),E={};function A(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function C(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}E.styleTagTransform=g(),E.setAttributes=l(),E.insert=c().bind(null,"head"),E.domAPI=s(),E.insertStyleElement=d(),r()(_.Z,E),_.Z&&_.Z.locals&&_.Z.locals;var w=AutodeskNamespace("Autodesk.AEC"),b=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._viewer=t,this._dbIdsToUnhide=new Map,this._cache={}}var t,n;return t=e,(n=[{key:"filter",value:function(e,t){var n=this;if(!e)throw new Error("floorFilterData cannot be undefined.");if(!(e.modelsDbIds instanceof Map))throw new Error("floorFilterData.modelsDbIds has to be a Map.");if(!t)throw new Error("floor cannot be undefined.");var i=this._getLevelHeightFactor(e.levelHeightFactor),r=e.modelsDbIds;if(this._hasModelDbIds(r)){var o=t.zMin,s=t.zMax,a=o+(s-o)*i,c=s+.1*(s-o);this._cache[t.name]||(this._cache[t.name]={});var u=this._viewer.impl.modelQueue().getModels(),l=function(e,i){var o=u[e];if(!o.visibilityManager)return console.warn("The VisibilityManager of the model with ID = ".concat(o.id," is not yet initialized.")),"break";if(n._cache[t.name][o.id]){var s=n._cache[t.name][o.id];return s.size>0&&n.hideDbIds(o,s),"continue"}var l=o.getInstanceTree();if(!l)return console.warn("The instanceTree of the model with ID = ".concat(o.id," is not yet initialized.")),"continue";var h=new Set,d=r.get(o.id);if(!d)return"continue";d.forEach((function(e){var t=new Float32Array(6);l.getNodeBox(e,t);var n=t[2],i=t[5];(n>=a&&n<=c||i>=a&&i<=c||n<=a&&i>=c)&&h.add(e)})),h.size>0&&n.hideDbIds(o,h),n._cache[t.name][o.id]=h};e:for(var h=0,d=u.length;h<d;h++)switch(l(h)){case"break":break e;case"continue":continue}}}},{key:"hideDbIds",value:function(e,t){if(e.visibilityManager)if(t.forEach((function(t){e.visibilityManager.setNodeOff(t,!0)})),this._dbIdsToUnhide.has(e)){var n,i=this._dbIdsToUnhide.get(e),r=A(i);try{for(r.s();!(n=r.n()).done;){var o=n.value;i.add(o)}}catch(e){r.e(e)}finally{r.f()}}else this._dbIdsToUnhide.set(e,t)}},{key:"clearFilter",value:function(){0!==this._dbIdsToUnhide.size&&this._dbIdsToUnhide.forEach(function(e,t){t.visibilityManager&&(e.forEach((function(e){t.visibilityManager.setNodeOff(e,!1)})),this._dbIdsToUnhide.delete(t))}.bind(this))}},{key:"unhideModel",value:function(e){this._dbIdsToUnhide.delete(e)}},{key:"_hasModelDbIds",value:function(e){if(0===e.size)return!1;var t,n=A(e.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i&&i.length>0)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"_getLevelHeightFactor",value:function(e){if(void 0===e)return.5;if("number"!=typeof e)throw new Error("floorFilterData.levelHeightFactor has to be a number");if(e<0||e>=1)throw new Error("floorFilterData.levelHeightFactor has to be a number between 0-1.");return e}},{key:"reApplyFilter",value:function(e){var t=this._dbIdsToUnhide.get(e),n=e.visibilityManager;t&&n&&t.forEach((function(e){n.setNodeOff(e,!0)}))}},{key:"isVisible",value:function(e,t){var n=this._dbIdsToUnhide.get(e);return!n||!n.has(t)}}])&&C(t.prototype,n),e}();function M(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}w.FloorSelectorFilter=b;var T=Autodesk.Viewing,V=Autodesk.Viewing.Private,S=AutodeskNamespace("Autodesk.AEC"),R=1e20,L=-R,P=void 0,O="Autodesk.AEC.FloorSelector",D=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),T.EventDispatcher.prototype.apply(this),this._viewer=t,this._renderer=t.impl.renderer(),this._cameraMovedCB=this._interruptFading.bind(this),t.addEventListener(T.CAMERA_CHANGE_EVENT,this._cameraMovedCB),this._viewerResizeCB=this._onViewerResized.bind(this),t.addEventListener(T.VIEWER_RESIZE_EVENT,this._viewerResizeCB),this._renderOptionsChangedCB=this._onRenderOptionsChanged.bind(this),t.addEventListener(T.RENDER_OPTION_CHANGED_EVENT,this._renderOptionsChangedCB),this._floorSelectionFilterToBeUpdated=this._runFloorSelectorFilterEventHandler.bind(this),t.addEventListener(T.MODEL_ADDED_EVENT,this._floorSelectionFilterToBeUpdated),t.addEventListener(T.OBJECT_TREE_CREATED_EVENT,this._floorSelectionFilterToBeUpdated),this._modelUnloadingCB=this._runModelUnloadingEventHandler.bind(this),t.addEventListener(T.MODEL_UNLOADED_EVENT,this._modelUnloadingCB),this._floors=[],this._currentMode=2,this._hovering=!1,this._floorSectionMin=void 0,this._floorSectionMax=void 0,this._zMinAllModels=void 0,this._zMaxAllModels=void 0,this._floorAnim=null,this._fadeAnim=null,this._ghostFloorOpacity=0,this._currentFloor=void 0,this._aoVisible=!0,this._aoOpacity=void 0,this._floorSelectorFilter=new b(this._viewer),this._floorFilterData=void 0,this._floorRollOverActive=!1,this._fadeEnabled=!0,this.enabled=!0,this.offscreenRenderBudget=void 0,this.fadingTime=.5}var t,n;return t=e,n=[{key:"dtor",value:function(){this._viewer&&(this._viewer.removeEventListener(T.CAMERA_CHANGE_EVENT,this._cameraMovedCB),this._viewer.removeEventListener(T.VIEWER_RESIZE_EVENT,this._viewerResizeCB),this._viewer.removeEventListener(T.RENDER_OPTION_CHANGED_EVENT,this._renderOptionsChangedCB),this._viewer.removeEventListener(T.OBJECT_TREE_CREATED_EVENT,this._floorSelectionFilterToBeUpdated),this._viewer.removeEventListener(T.MODEL_ADDED_EVENT,this._floorSelectionFilterToBeUpdated),this._viewer.removeEventListener(T.MODEL_UNLOADED_EVENT,this._modelUnloadingCB),this._viewer=null)}},{key:"resetState",value:function(){this._floors=[],this._selectFloor(P),this._clearFloorSection(),this._floorSelectorFilter.clearFilter()}},{key:"enterHoverMode",value:function(){1!==this._currentMode&&this._setMode(0),this._hovering=!0}},{key:"exitHoverMode",value:function(e){(1!==this._currentMode||e)&&this._setMode(2),this._hovering=!1,this._setSpatialFilterForRollOver()}},{key:"setPanelHoverEffectEnabled",value:function(e){this.exitHoverMode(!0),this._skipFadeAnimations(),this._fadeEnabled=e}},{key:"_getFadeExtension",value:function(){return this._fadeEnabled&&this._viewer.getExtension("Autodesk.CrossFadeEffects")}},{key:"_ghostFloorsEnabled",value:function(){return Boolean(this._getFadeExtension())}},{key:"rollOverFloor",value:function(e){var t=this._ghostFloorsEnabled()||this._currentFloor===P,n=this._renderer.spatialFilterForRollOverSupported();if(void 0===e||!n||!t)return this._setSpatialFilterForRollOver(),void this._renderer.rolloverObjectId(0);this._renderer.rolloverObjectId(1),this._setSpatialFilterForRollOver(e),this._viewer.impl.invalidate(!1,!0,!0)}},{key:"selectFloor",value:function(t,n){this.floorSelectionValid(t)&&(n?this._moveToFloor(t):this._selectFloor(t),this._runFloorSelectorFilter(),this._ghostFloorsEnabled()||this.rollOverFloor(),this.fireEvent({type:e.SELECTED_FLOOR_CHANGED,levelIndex:t}))}},{key:"floorSelectionValid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:P;return!(!Number.isInteger(e)&&e!==P||!this.floorData||0===this.floorData.length||this.currentFloor===e||!(e===P||e>=0||this.floorData.length>e))}},{key:"isVisible",value:function(e,t){this._tmpNodeBox||(this._tmpNodeBox=new Float32Array(6));var n=this._floors[this._currentFloor];if(n===P)return!0;var i=e.getInstanceTree();if(!i)return!0;var r=this._tmpNodeBox;i.getNodeBox(t,r);var o=r[2],s=r[5];return!(o>n.zMax||s<n.zMin)&&this._floorSelectorFilter.isVisible(e,t)}},{key:"setEnabled",value:function(e){this.enabled=e,this._applySelectedFloorSection()}},{key:"_stopFloorAnim",value:function(){this._floorAnim&&(this._floorAnim.stop(),this._floorAnim=null)}},{key:"_stopFadeAnim",value:function(){this._fadeAnim&&(this._fadeAnim.stop(),this._fadeAnim=null)}},{key:"_skipFadeAnimations",value:function(){this._fadeAnim&&(this._fadeAnim.skip(),this._fadeAnim=null),this._floorAnim&&(this._floorAnim.skip(),this._floorAnim=null)}},{key:"_leaveHoverMode",value:function(){var e=this._getFadeExtension();e&&(e.releaseFadingImage(0),e.releaseFadingImage(1),e.setModelTargetIndexForAll(void 0),this._applySelectedFloorSection(),this._setAOVisible(!0))}},{key:"_interruptFading",value:function(){!this._hovering&&this._fadeAnim&&this._fadeAnim.isRunning&&(this._stopFadeAnim(),this._leaveHoverMode())}},{key:"_onViewerResized",value:function(){this.forceImageRefresh()}},{key:"forceImageRefresh",value:function(){var e=this._hovering;this.exitHoverMode(),this._skipFadeAnimations(),e&&(this.enterHoverMode(),this._skipFadeAnimations())}},{key:"_onRenderOptionsChanged",value:function(){this._floorRollOverActive&&!this._renderer.spatialFilterForRollOverSupported()&&this.rollOverFloor()}},{key:"_getVisibleModels",value:function(){return this._viewer.impl.modelQueue().getModels()}},{key:"_updateZLimits",value:function(){var e=this._getVisibleModels();this._zMinAllModels=R,this._zMaxAllModels=L;for(var t=0;t<e.length;t++){var n=e[t].getBoundingBox();this._zMinAllModels=Math.min(n.min.z,this._zMinAllModels),this._zMaxAllModels=Math.max(n.max.z,this._zMaxAllModels)}this._zMinAllModels>this._zMaxAllModels&&(this._zMinAllModels=L,this._zMaxAllModels=R)}},{key:"_setAOVisible",value:function(e){if(e!==this._aoVisible){this._aoVisible=e;var t=this._renderer.getBlendPass(),n=0;e?(0!==t.uniforms.aoOpacity.value&&console.warn("ao opacity should not be changed while FloorSelector is in use."),n=this._aoOpacity):this._aoOpacity=t.uniforms.aoOpacity.value,this._renderer.setAOOptions(this._renderer.getAORadius(),this._renderer.getAOIntensity(),n)}}},{key:"_setGhostFloorOpactiy",value:function(e){var t=this._getFadeExtension();t&&t.setCrossFadeOpacity(1,e),this._ghostFloorOpacity=e}},{key:"_setSpatialFilterForRollOver",value:function(t){var n=void 0,i=this._floors[t],r=function(e,t){return"bool spatialFilter(vec3 worldPos) { return (worldPos.z >= float("+e+") && worldPos.z <= float("+t+")); }"};i?n=r(i.zMin,i.zMax):t===e.AllFloors&&(n=r(this._zMinAllModels,this._zMaxAllModels)),this._renderer.setSpatialFilterForRollOver(n);var o=this._getFadeExtension();o&&o.crossFade.setSaoHeuristicEnabled(!n),this._floorRollOverActive=!!n}},{key:"_applyFloorSection",value:function(e,t){if(this.enabled){Number.isFinite(e)||(e=L),Number.isFinite(t)||(t=R);var n=[new THREE.Vector4(0,0,-1,e),new THREE.Vector4(0,0,1,-t)];this._viewer.impl.setCutPlaneSet(O,n)}else this._viewer.impl.setCutPlaneSet(O,null)}},{key:"_applySelectedFloorSection",value:function(){var e=void 0!==this._floorSectionMin?this._floorSectionMin:L,t=void 0!==this._floorSectionMax?this._floorSectionMax:R;this._applyFloorSection(e,t)}},{key:"_setFloorSection",value:function(e,t){this._floorSectionMin=isNaN(e)?void 0:e,this._floorSectionMax=isNaN(t)?void 0:t,this._applySelectedFloorSection()}},{key:"_clearFloorSection",value:function(){this._updateZLimits(),this._applyFloorSection()}},{key:"_setMode",value:function(e){var t=this;if(e!==this._currentMode)if(this._currentMode=e,0===e){var n=this._getFadeExtension();if(n){n.acquireControl("FloorSelector",(function(){return t._interruptFading()})),n.setModelTargetIndexForAll(void 0),this._applySelectedFloorSection(),this._renderer.rolloverObjectId(0),this._setAOVisible(!0),n.renderFadingImage(0,this.offscreenRenderBudget),n.setCrossFadeOpacity(0,1),this._clearFloorSection(),n.setModelTargetIndexForAll(1),this._setAOVisible(!1),this._stopFadeAnim();var i=this._setGhostFloorOpactiy.bind(this);this._fadeAnim=V.fadeValue(this._ghostFloorOpacity,.2,this.fadingTime,i)}}else if(1===e){var r=this._getFadeExtension();r&&(r.setClearEnabled(1,!1),r.setClearEnabled(0,!0),r.setModelTargetIndexForAll(0),r.setCrossFadeOpacity(0,1)),this._setAOVisible(!0),this._applySelectedFloorSection()}else if(2===e){this._stopFadeAnim();var o=this._setGhostFloorOpactiy.bind(this),s=this._leaveHoverMode.bind(this);this._fadeAnim=V.fadeValue(this._ghostFloorOpacity,0,this.fadingTime,o,s)}}},{key:"_moveToFloor",value:function(e){var t=this;this._currentFloor=e,this._setMode(1);var n=this._floors[e];this._updateZLimits();var i=void 0===this._floorSectionMin?this._zMinAllModels:this._floorSectionMin,r=void 0===this._floorSectionMax?this._zMaxAllModels:this._floorSectionMax,o=n?n.zMin:this._zMinAllModels,s=n?n.zMax:this._zMaxAllModels;this._stopFloorAnim(),this._floorAnim=V.fadeValue(0,1,this.fadingTime,(function(e){var n=V.smootherStep(e),a=V.lerp(i,o,n),c=V.lerp(r,s,n);t._setFloorSection(a,c);var u=t._renderer.getBlendPass().uniforms.highlightIntensity;u.value=Math.min(u.value,1-n)}),(function(){var e=t._hovering?0:2;t._setMode(e)}))}},{key:"_selectFloor",value:function(e){this._stopFloorAnim(),this._currentFloor=e;var t=this._floors[e],n=t?t.zMin:void 0,i=t?t.zMax:void 0;this._setFloorSection(n,i)}},{key:"_runFloorSelectorFilter",value:function(){if(this._floorSelectorFilter.clearFilter(),this._floorFilterData&&void 0!==this._currentFloor){var e=this._floors[this._currentFloor];this._floorSelectorFilter.filter(this._floorFilterData,e)}}},{key:"_runFloorSelectorFilterEventHandler",value:function(e){e.model.isObjectTreeLoaded()&&(this._floorFilterData&&void 0!==this._currentFloor?this._runFloorSelectorFilter():this._floorSelectorFilter.clearFilter())}},{key:"_runModelUnloadingEventHandler",value:function(e){this._floorFilterData&&void 0!==this._currentFloor&&this._floorSelectorFilter.unhideModel(e.model)}},{key:"invalidateFloorSelection",value:function(e){this._selectFloor(e),this._runFloorSelectorFilter()}},{key:"floorData",get:function(){return this._floors},set:function(t){this.resetState(),this._floors=Array.isArray(t)?t:[],this.fireEvent({type:e.FLOOR_DATA_CHANGED,floorData:this._floors})}},{key:"floorFilterData",get:function(){return this._floorFilterData},set:function(e){this._floorFilterData=e}},{key:"currentFloor",get:function(){return this._currentFloor}}],n&&M(t.prototype,n),e}();D.AllFloors=-1,D.NoFloor=P,D.SELECTED_FLOOR_CHANGED="selectedFloorChanged",D.FLOOR_DATA_CHANGED="floorDataChanged",S.FloorSelector=D;var I=function e(t,n,i,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.index=t,this.name=i,this.zMin=r,this.zMax=o,this.guid=n};function N(e){var t=e.extension;return t&&Object.prototype.hasOwnProperty.call(t,"projectElevation")?t.projectElevation:e.elevation}function k(e,t){var n=new THREE.Vector3,i=function(e){return n.set(0,0,e),n.applyMatrix4(t),n.z};e.forEach((function(e){e.zMin=i(e.zMin),e.zMax=i(e.zMax)}))}var B=1/12;function F(e,t,n){var i=e.levels.filter((function(e){var t=e.extension;return!t||!Object.prototype.hasOwnProperty.call(t,"buildingStory")||t.buildingStory})),r=[],o=i.length;return i.forEach((function(e,t){var n=void 0;if(t+1<o)n=N(i[t+1]);else{var s=i[i.length-1];n=N(s)+s.height}r.push(new I(r.length,e.guid,e.name,N(e)-B,n))})),t?k(r,t):function(e,t){t&&k(e,Autodesk.Viewing.BubbleNode.readMatrixFromArray12(t))}(r,e.refPointTransformation),n&&k(r,n),r}function j(e,t){var n=e.impl.modelQueue().getModels(),i=null,r=-1;return n.forEach((function(e){if(!e.is2d()){var n=e.getDocumentNode();if(n){if(!t&&!n.getAecModelData())return;n.data.size>r?(i=e,r=n.data.size):n.data.size||-1!==r||(i=e,r=0)}}})),i}var z=Autodesk.Viewing,U=Autodesk.Viewing.UI,G={ITEM_SELECT:"itemSelect",ITEM_VISIBILITY_CHANGED:"itemVisibibilityChanged",ITEM_MOUSE_ENTER:"itemMouseEnter",ITEM_MOUSE_LEAVE:"itemMouseLeave"};function Y(e,t,n,i){U.DockingPanel.call(this,e,t,n,i),z.EventDispatcher.prototype.apply(this),this.container.classList.add("list-panel"),this.container.dockRight=!0,this.createScrollContainer({left:!1,heightAdjustment:65,marginTop:0})}Y.prototype=Object.create(U.DockingPanel.prototype),Y.prototype.setItems=function(e){this.buttons=[],this.items=e,this.listDiv&&this.scrollContainer.removeChild(this.listDiv);var t=this.getDocument();this.listDiv=t.createElement("div"),this.listDiv.classList.add("itemList"),this.scrollContainer.appendChild(this.listDiv);for(var n=this,i=function(e){var i=n._getItemText?n._getItemText(e):"<no item text>",r=t.createElement("div");r.classList.add("listItem"),r.item=e,r.setAttribute("title",i),r.addEventListener("click",(function(){n.fireEvent({type:G.ITEM_SELECT,item:e})})),r.addEventListener("mouseenter",(function(){n.fireEvent({type:G.ITEM_MOUSE_ENTER,item:e}),r.classList.add("hover")})),r.addEventListener("mouseleave",(function(){n.fireEvent({type:G.ITEM_MOUSE_LEAVE,item:e}),r.classList.remove("hover")}));var o=t.createElement("span");o.innerHTML=i,o.classList.add("text");var s=t.createElement("div");if(s.classList.add("textContainer"),s.appendChild(o),r.appendChild(s),n.options.enableWarningSymbol){var a=t.createElement("span");a.classList.add("list-panel-item-warning"),r.appendChild(a),r.warnSpan=a}if(n.options.enableCheckmark){var c=t.createElement("span");c.classList.add("icon"),r.appendChild(c)}if(n.options.enableVisibilityToggle){var u=t.createElement("div");u.classList.add("visibility"),r.appendChild(u),u.addEventListener("click",(function(){var e=!n._isVisible||n._isVisible(r.item);n.fireEvent({type:G.ITEM_VISIBILITY_CHANGED,item:r.item,visible:!e}),n.updateItemStates()}))}return r},r=0;r<e.length;r++){var o=i(e[r]);this.listDiv.appendChild(o),this.buttons.push(o)}this.updateItemStates()},Y.prototype.rollOverItem=function(e){for(var t=0;t<this.buttons.length;t++){var n=this.buttons[t];e(n.item)?n.classList.add("hover"):n.classList.remove("hover")}},Y.prototype.updateItemStates=function(){if(this.buttons)for(var e=0;e<this.buttons.length;e++){var t=this.buttons[e];if(t.classList.remove("selected"),this._isSelected&&this._isSelected(t.item)&&t.classList.add("selected"),this.options.enableWarningSymbol){var n=this._getWarningText&&this._getWarningText(t.item);t.warnSpan.style.visibility=n?"visible":"hidden",t.warnSpan.setAttribute("title",n||"")}this.options.enableVisibilityToggle&&(t.classList.remove("dim"),!this._isVisible||this._isVisible(t.item)||t.classList.add("dim"))}},Y.prototype.setItemHandlers=function(e,t,n,i){this._isSelected=e,this._getItemText=t,this._getWarningText=n,this._isVisible=i,this.updateItemStates()},U.ListPanelEvents=G,U.ListPanel=Y;var W=AutodeskNamespace("Autodesk.AEC"),H=["FloorPlan","CeilingPlan","EngineeringPlan"],K=function(e,t,n,i,r,o,s,a){var c=(s-r)/(n-e),u=(a-o)/(i-t),l=r-c*e,h=o-u*t,d=new THREE.Matrix4;return d.elements[0]=c,d.elements[5]=u,d.elements[10]=c,d.elements[12]=l,d.elements[13]=h,d},q=function(e){return 1/e*.3048},Q=function(e,t){var n=e.geometryViewportRegion;if(!n)return null;var i=q(t),r=.01,o=new THREE.Box2;return o.min.x=(n[0]+r)*i,o.min.y=(n[1]+r)*i,o.max.x=(n[3]-r)*i,o.max.y=(n[4]-r)*i,o},Z=function(e,t){if(!e.modelToSheetTransform)return null;var n=e.modelToSheetTransform,i=Autodesk.Viewing.BubbleNode.readMatrixFromArray12(n),r=q(t),o=(new THREE.Matrix4).makeScale(r,r,r);return i.multiplyMatrices(o,i),i},J=function(e,t){var n=Q(e,t),i=e.sectionBox,r=Autodesk.Viewing.BubbleNode.readMatrixFromArray12(i.transform),o=K(n.min.x,n.min.y,n.max.x,n.max.y,0,0,1,1),s=function(e){var t=new THREE.Matrix4;switch(e){case 0:return t;case 1:t.elements[0]=0,t.elements[4]=-1,t.elements[12]=1,t.elements[1]=1,t.elements[5]=0;break;case 2:t.elements[0]=0,t.elements[4]=1,t.elements[1]=-1,t.elements[5]=0,t.elements[13]=1;break;default:console.warn("Unexpected enum value for view rotation: ",e)}return t}(e.viewportRotation),a=K(0,0,1,1,i.min.x,i.min.y,i.max.x,i.max.y);return r.multiply(a).multiply(s).multiply(o)},X=function(e){var t=e instanceof Autodesk.Viewing.BubbleNode?e:e.getDocumentNode(),n=t.getAecModelData();return n&&n.viewports?n.viewports.filter((function(e){return e.sheetGuid===t.guid()})):[]},$=function(e){var t=e.extensions&&e.extensions.viewRange,n=t&&t.cutPlane;return n&&n.levelGuid},ee={},te=function(e,t){var n=t.myData.placementWithOffset;n||(n=new THREE.Matrix4);var i=new THREE.Box3;if(e.forEach((function(r,o){var s=function(e,t,n){var i=t.getData().instanceTree;if(i){var r=function(e,t){var n=[];!function t(i){var r=0;e.enumNodeChildren(i,(function(e){t(e),r+=1})),0===r&&n.push(i)}(t);var i=[];return n.forEach((function(t){e.enumNodeFragments(t,(function(e){i.push(e)}))})),i}(i,e),o=t.getFuzzyBox({allowlist:r});if(n.min.z!==1/0&&n.max.z>o.min.z){var s=Math.abs(o.max.z-o.min.z);Math.abs(n.max.z-n.min.z)>s?n.max.z=n.min.z:o.min.z=n.max.z}return n.copy(o),o}}(r.dbId,t,i);s&&s.min.z!==1/0&&s.max.z!==1/0&&(r.elevation=s.min.z-(n?n.elements[14]:0),o===e.length-1?r.height=t.getBoundingBox().max.z-s.min.z:r.height=s.max.z-s.min.z)})),!e.some((function(e){return!e.elevation}))){var r=[n.elements[0],n.elements[1],n.elements[2],n.elements[4],n.elements[5],n.elements[6],n.elements[8],n.elements[9],n.elements[10],n.elements[12],n.elements[13],n.elements[14]];return{version:"1.0.0",phases:[{name:"Default"}],levels:e,scopeBoxes:[],refPointTransformation:r}}console.warn("Failed to derive elevation for some levels")},ne={get2DTo3DMatrix:function(e,t){var n=Z(e,t);return n?n.invert():J(e,t)},get3DTo2DMatrix:function(e,t){var n=Z(e,t);return n||(n=J(e,t)).invert()},getViewportBounds:Q,remapRectangle:K,findSheetForViewport:function(e,t){return e.search(Autodesk.Viewing.BubbleNode.SHEET_NODE).find((function(e){return e.guid()===t.sheetGuid}))},findViewportsForLevel:function(e,t){return(e.viewports||[]).filter((function(e){return $(e)===t}))},supports2DTo3DTransform:function(e){var t=Boolean(e.modelToSheetTransform),n=Boolean(e.sectionBox&&e.isCropBoxActive);if(!t&&!n)return!1;var i=[].concat(H,["Section"]);return Boolean(i.includes(e.viewType)&&e.geometryViewportRegion&&!e.hasBreaks&&!e.extensions.hasRegions)},getLinkedLevel:$,findViewportsOnSheet:X,findViewportAtPoint:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;console.warn("Please use ViewportExtension.findViewportAtPoint instead.");var i=X(e);n&&(i=i.filter(n));var r=function(e){return e.bounds&&e.bounds.containsPoint(t)};if((i=(i=i.map((function(t){return{viewport:t,bounds:Q(t,e.getUnitScale())}}))).filter(r)).length){var o=function(e,t){return Math.min(Math.min(t.x-e.min.x,e.max.x-t.x),Math.min(t.y-e.min.y,e.max.y-t.y))},s=function(e,n){var i=o(e.bounds,t);return o(n.bounds,t)>i?n:e};return i.reduce(s).viewport}},findLevelForViewport:function(e,t){var n=$(t);return n&&e.levels.find((function(e){return e.guid===n}))},computeAecModelDataForIfc:function(e){if(!e)return null;var t=e.getModelKey();if(ee[t])return ee[t];var n=new Promise((function(n){var i=function(i){if(!i||!i.length)return n(null);var r=te(i,e);t&&(ee[t]=Object.assign({},r)),n(r)},r=function(e){console.error(e),n(null)};e.isOTG()?function(e,t,n){n.search("IFCBUILDING",(function(i){n.getBulkProperties(i,null,(function(i){if(1!==i.length)return e(void 0);var r=i[0].properties.filter((function(e){return"child"===e.displayName})).map((function(e){return e.displayValue}));n.getBulkProperties(r,["Name","Type"],(function(t){var n=t.map((function(e){var t=e.properties.find((function(e){return"Type"===e.displayName})),n=e.properties.find((function(e){return"Name"===e.displayName}));if(t&&t.displayValue.includes("Level")&&n)return{guid:e.dbId.toString(),name:n.displayValue,dbId:e.dbId,extension:{buildingStory:!0,structure:!1,computationHeight:0,groundPlane:!1,hasAssociatedViewPlans:!1}}})).filter(Boolean);e(n)}),t)}),t)}),t,["Type"])}(i,r,e):function(e,t,n){n.search("IfcBuildingStorey",(function(i){n.getBulkProperties(i,["Type","GUID","NAME","Name","ELEVATION","Elevation","IfcElevation"],(function(t){for(var n=[],i=0;i<t.length;i++)if(t[i].properties.length>1){var r=t[i].properties.findIndex((function(e){return"GUID"===e.displayName})),o=t[i].properties.findIndex((function(e){return"Levels: Level: Level 1"===e.displayValue})),s=-1,a=-1;if(o>=0?s=t[i].properties.findIndex((function(e){return("name"===e.attributeName.toLowerCase()||"LcOaNode:LcOaSceneBaseUserName"===e.attributeName)&&"Item"===e.displayCategory})):(s=t[i].properties.findIndex((function(e){return"name"===e.displayName.toLowerCase()&&("IFC"===e.displayCategory||"LcOaNode:LcOaSceneBaseUserName"===e.attributeName&&"Item"===e.displayCategory||"LcRevitData_Element:LcRevitPropertyElementName"===e.attributeName&&"Element"===e.displayCategory)})),a=t[i].properties.findIndex((function(e){return"ELEVATION"===e.displayName&&"IFC"===e.displayCategory||("IfcElevation"===e.displayName||"Elevation"===e.displayName)&&"Element"===e.displayCategory}))),s>=0&&(a>=0||o>=0)){var c=r>-1?t[i].properties[r].displayValue:t[i].dbId;n.push({guid:c.toString(),name:t[i].properties[s].displayValue,dbId:t[i].dbId,extension:{buildingStory:!0,structure:!1,computationHeight:0,groundPlane:!1,hasAssociatedViewPlans:!1}})}}e(n)}),t)}),t,["Type"])}(i,r,e)}));return t&&(ee[t]=n),n},TopViewViewportTypes:H,computeLevels:te};const ie=ne;function re(e){return re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},re(e)}function oe(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function se(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){oe(o,i,r,s,a,"next",e)}function a(e){oe(o,i,r,s,a,"throw",e)}s(void 0)}))}}function ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ce(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ue(e,t){return ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ue(e,t)}function le(e,t){return!t||"object"!==re(t)&&"function"!=typeof t?he(e):t}function he(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e){return de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},de(e)}W.AecModelData=ne;var pe=Autodesk.Viewing,ge=pe.UI,fe=AutodeskNamespace("Autodesk.AEC"),ve=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}(a,e);var t,n,i,r,o,s=(r=a,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=de(r);if(o){var n=de(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return le(this,e)});function a(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ae(this,a),(t=s.call(this,e,n)).container=t.options.panelUIContainers&&t.options.panelUIContainers.levelsPanel,t._onCameraMoved=t._onCameraMoved.bind(he(t)),t.onItemMouseEnter=t.onItemMouseEnter.bind(he(t)),t.onItemMouseLeave=t.onItemMouseLeave.bind(he(t)),t.onItemSelected=t.onItemSelected.bind(he(t)),t.updateFloorsData=t.updateFloorsData.bind(he(t)),t.doNotCreateUI=n.doNotCreateUI,t._currentLevel=void 0,t}return t=a,n=[{key:"_onCameraMoved",value:function(){var e=this._mapCameraToLevel();e&&(this._currentLevel&&e.guid===this._currentLevel.guid||(this._currentLevel=e,this.viewer.dispatchEvent({type:a.LEVEL_CHANGED,level:e})))}},{key:"_mapCameraToLevel",value:function(){var e=this.floorSelector.floorData;if(e.length){var t=this.viewer.impl.camera.position.z;return t<e[0].zMin?e[0]:t>e[e.length-1].zMax?e[e.length-1]:e.find((function(e){return e.zMin<=t&&e.zMax>=t}))}}},{key:"onToolbarCreated",value:function(){if(!this.container){var e=this.viewer.getToolbar().getControl(pe.TOOLBAR.MODELTOOLSID);e&&this.levelsButton&&e.addControl(this.levelsButton)}}},{key:"onItemMouseEnter",value:function(e){var t=e.item.index;t===this.floorSelector.currentFloor&&(t=D.AllFloors),this.floorSelector.rollOverFloor(t),this.hoveredFloor=t}},{key:"onItemMouseLeave",value:function(e){var t=e.item;this.hoveredFloor===t.index&&(this.hoveredFloor=void 0,this.floorSelector.rollOverFloor(D.NoFloor))}},{key:"onItemSelected",value:function(e){var t=e.item,n=t.index!==this.floorSelector.currentFloor?t.index:void 0;this.floorSelector.selectFloor(n,!0)}},{key:"_createUI",value:function(){var e=this;this.doNotCreateUI||(this.levelsButton=new ge.Button("toolbar-levelsTool"),this.levelsButton.setToolTip("Levels"),this.levelsButton.icon.innerHTML=ye(),this.levelsPanel=new Y(this.container||this.viewer.container,"LevelsPanel-"+this.viewer.id,"Levels",{enableCheckmark:!0}),this.levelsPanel.setGlobalManager(this.globalManager),this.container||this.viewer.addPanel&&this.viewer.addPanel(this.levelsPanel),this.levelsPanel.addVisibilityListener((function(t){e.levelsButton.setState(t?ge.Button.State.ACTIVE:ge.Button.State.INACTIVE)})),this.levelsPanel.closer.addEventListener("click",(function(){e.onPanelVisibilityToggled&&e.onPanelVisibilityToggled(!1)})),this.levelsPanel.addEventListener(G.ITEM_MOUSE_ENTER,this.onItemMouseEnter),this.levelsPanel.addEventListener(G.ITEM_MOUSE_LEAVE,this.onItemMouseLeave),this.levelsPanel.addEventListener(G.ITEM_SELECT,this.onItemSelected),this.levelsPanel.container.addEventListener("mouseenter",(function(){return e.floorSelector.enterHoverMode()})),this.levelsPanel.container.addEventListener("mouseleave",(function(){return e.floorSelector.exitHoverMode()})),this.floorSelector.addEventListener(D.SELECTED_FLOOR_CHANGED,(function(){return e.levelsPanel.updateItemStates()})),this.levelsPanel.setItemHandlers((function(t){return t.index===e.floorSelector.currentFloor}),(function(e){return e.text})),this.levelsButton.onClick=function(){var t=!e.levelsPanel.isVisible();e.levelsPanel.setVisible(t),e.onPanelVisibilityToggled&&e.onPanelVisibilityToggled(t)})}},{key:"setAecModelData",value:function(e,t,n){if(e!==this.aecModelData||t!==this.currentModel||n!==this.isDataInWorldCoords){this.aecModelData=e,this.isDataInWorldCoords=n,this.currentModel=t,this.updateFloorsData();for(var i=this.floorSelector.floorData,r=[],o=0;o<i.length;o++){var s=i[o];r.push({text:s.name,index:o})}r.reverse(),this.levelsPanel&&this.levelsPanel.setItems(r),this._updateOccluderData()}}},{key:"setFloorDataTransform",value:function(e){this.floorDataTransform=e,this.updateFloorsData()}},{key:"updateFloorsData",value:function(){var e=this.floorSelector.currentFloor;if(this.aecModelData){if(this.isDataInWorldCoords)this.floorSelector.floorData=this.aecModelData;else{var t,n,i=(null===(t=this.currentModel)||void 0===t?void 0:t.getData().placementWithOffset)||this.floorDataTransform,r=null===(n=this.currentModel)||void 0===n?void 0:n.getModelTransform();this.floorSelector.floorData=F(this.aecModelData,i,r)}this.floorSelector.invalidateFloorSelection(e)}else this.floorSelector.floorData=[];this._onCameraMoved()}},{key:"_updateOccluderData",value:function(){var e=this.aecModelData?function(e){var t=e.impl.modelQueue().getModels(),n=new Map;return t.forEach((function(e){if(!e.is2d()){var t=e.getDocumentNode();if(t){var i=t.getAecModelData();i&&n.set(e.id,i.levelOccluderIds)}}})),{modelsDbIds:n}}(this.viewer):void 0;this.floorSelector.floorFilterData=e}},{key:"load",value:(i=se(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.AEC.ViewportsExtension");case 2:return this.viewportsExtension=e.sent,this.floorSelector=new D(this.viewer),this.updateFloorSelector=se(regeneratorRuntime.mark((function e(){var n,i,r,o,s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.floorSelector){e.next=2;break}return e.abrupt("return");case 2:if(!1===t.options.autoDetectAecModelData){e.next=19;break}if(n=!1,i=j(t.viewer,!0),r=i&&i.getDocumentNode(),(o=r&&r.getAecModelData())||!i||"ifc"!==i.getData().loadOptions.fileExt||!t.options.ifcLevelsEnabled){e.next=13;break}return t.setAecModelData(void 0,i),e.next=12,ie.computeAecModelDataForIfc(i);case 12:o=e.sent;case 13:if(o||!r||t.options.useOnlyAecModelDataViewports){e.next=18;break}return e.next=16,t.viewportsExtension.generateLevelsFromViewports(r);case 16:(s=e.sent).length&&(o=s,n=!0);case 18:t.setAecModelData(o,i,n);case 19:t._updateOccluderData(),a=t.viewer.getVisibleModels().some((function(e){return e.is3d()})),t.floorSelector.setEnabled(a);case 22:case"end":return e.stop()}}),e)}))),this.viewer.addEventListener(pe.MODEL_ROOT_LOADED_EVENT,this.updateFloorSelector),this.viewer.addEventListener(pe.MODEL_UNLOADED_EVENT,this.updateFloorSelector),this.viewer.addEventListener(pe.MODEL_ADDED_EVENT,this.updateFloorSelector),this.viewer.addEventListener(pe.MODEL_TRANSFORM_CHANGED_EVENT,this.updateFloorsData),this.viewer.addEventListener(pe.CAMERA_CHANGE_EVENT,this._onCameraMoved),this.viewportsExtension.addEventListener(Autodesk.AEC.ViewportsExtension.Events.VIEWPORT_DATA_FETCHED_EVENT,this.updateFloorSelector),this._createUI(),this.updateFloorSelector(),e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"unload",value:function(){return this.container||this.viewer.removePanel&&this.viewer.removePanel(this.levelsPanel),this.floorSelector.selectFloor(void 0,!1),this.levelsPanel=null,this.updateFloorSelector&&(this.viewer.removeEventListener(pe.MODEL_ROOT_LOADED_EVENT,this.updateFloorSelector),this.viewer.removeEventListener(pe.MODEL_UNLOADED_EVENT,this.updateFloorSelector),this.viewer.removeEventListener(pe.MODEL_ADDED_EVENT,this.updateFloorSelector),this.viewer.removeEventListener(pe.MODEL_TRANSFORM_CHANGED_EVENT,this.updateFloorsData),this.viewportsExtension.removeEventListener(Autodesk.AEC.ViewportsExtension.Events.VIEWPORT_DATA_FETCHED_EVENT,this.updateFloorSelector),this.updateFloorSelector=null),this.viewer.removeEventListener(pe.CAMERA_CHANGE_EVENT,this._onCameraMoved),this._currentLevel=null,this.floorSelector=null,this.aecModelData=null,this.currentModel=null,!0}},{key:"getState",value:function(e){if(this.viewer.model&&!this.viewer.model.is2d()){var t=this.floorSelector.currentFloor;e.floorGuid=t?this.floorSelector.floorData[t].guid:null}}},{key:"restoreState",value:function(e){if(void 0!==e.floorGuid){if(e.floorGuid){var t=this.floorSelector.floorData.find((function(t){return t.guid===e.floorGuid}));t&&this.floorSelector.selectFloor(t.index,!1)}else this.floorSelector.selectFloor(D.NoFloor,!1);return!0}}},{key:"getCurrentLevel",value:function(){var e=this.floorSelector;return e.floorData[e.currentFloor]||this._mapCameraToLevel()}},{key:"getZRange",value:function(e){var t=this.floorSelector&&this.floorSelector.floorData[e],n=t.zMin+.5*(t.zMax-t.zMin),i=this.floorSelector.floorData[e-1];return{zMin:i?.5*(i.zMin+i.zMax):t.zMin,zMax:n}}}],n&&ce(t.prototype,n),a}(pe.Extension),ye=function(){return['<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">','<g stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">','<path d="M4 8 L12 3 L 20 8 L12 13Z"/>','<path d="M4 12 L12 17 L 20 12"/>','<path d="M4 16 L12 21 L 20 16"/>',"</g>","</svg>"].join("")};function me(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}fe.LevelsExtension=ve,ve.LEVEL_CHANGED="levelChanged",Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.AEC.LevelsExtension",ve);var _e=Autodesk.Viewing,Ee=Autodesk.Viewing.Private;function Ae(e,t,n,i){_e.ToolInterface.call(this),this.names=["hyperlink-tracker"],e.toolController.registerTool(this);var r,o,s=e,a=n,c=i,u=[0,0],l={},h=0,d=!1,p=!1;function g(){var e,t=l[u[1]];if(!t){var n=1===(e=s.impl.modelQueue().getModels()).length?e[0]:void 0;n&&(t=l[n.id])}return t}function f(e){return e&&Object.keys(e).length>0}function v(e,t,n,i){var r=4*n,o=t.stringBoxes[r+1],s=t.stringBoxes[r+3],a=.2*(s-o);o-=a,s+=a;var c=t.stringBoxes[r]-a,u=t.stringBoxes[r+2]+a,l=t.stringDbIds[n],h=e.vcount,d=2009054015;e.addVertexPolytriangle(c,o,d,l,0,0),e.addVertexPolytriangle(u,o,d,l,0,0),e.addVertexPolytriangle(u,s,d,l,0,0),e.addVertexPolytriangle(c,s,d,l,0,0),e.addIndices([0,1,2,0,2,3],h),e.addSegment(c,o,u,o,0,-2*i,-4211905,l,0,0,0),e.addSegment(u,o,u,s,0,-2*i,-4211905,l,0,0,0),e.addSegment(u,s,c,s,0,-2*i,-4211905,l,0,0,0),e.addSegment(c,s,c,o,0,-2*i,-4211905,l,0,0,0)}function y(e){if(e&&e.is2d()){var t=l[e.id];if(!t){var n=e.getDocumentNode(),i=n&&n.getRootNode(),r=i&&i.search({role:"2d",type:"geometry"});if(r&&r.length){t=l[e.id]={};var o="";e.myData&&(o=e.myData.basePath);var a=r.map((function(e){var t=function(e){if(e.children){var t,n=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return me(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?me(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}(e.children);try{for(n.s();!(t=n.n()).done;){var i=t.value;if("resource"===i.type()){var r=i.urn();if(r){var o=r.split("/");return o.pop(),o.join("/")}}}}catch(e){n.e(e)}finally{n.f()}}return null}(e);if(-1===o.indexOf(t)){var n=e.name().split(" ")[0];if(n.length>2)return n}return""}));t.numHyperlinks=0;for(var u=new Ee.VertexBufferBuilder,h=1/(e.getData().loadOptions.modelScale||1),d=e.getData(),p=0;p<d.strings.length;p++){var g=a.indexOf(d.strings[p]);g>=0&&(t[d.stringDbIds[p]]=r[g],v(u,d,p,h),t.numHyperlinks++)}t.boxFragId=function(e,t){var n=e.getFragmentList().vizmeshes.length,i={mesh:t.toMesh(),is2d:!0,packId:"0",meshIndex:n};Ee.BufferGeometryUtils.meshToGeometry(i);var r=s.impl.matman().create2DMaterial(e,{}),o=s.impl.setupMesh(e,i.geometry,r,e.getData().loadOptions.placementTransform);return e.activateFragment(n,o),n}(e,u),c&&c(e.id,t.numHyperlinks)}}}}function m(e){y(e.model)}function _(e){for(var t=s.getAllModels(),n=0;n<t.length;n++){var i=t[n];i.is2d()&&i.isLoadDone()&&e(i)}}this.update=function(){if(p)h=0;else if(d){var e=s.impl.clientToViewport(r,o);h=s.impl.renderer().idAtPixel(e.x,e.y,u),d=!1}return!1},this.handleSingleClick=function(){if(s.model&&s.model.is2d()){var e=s.impl.clientToViewport(r,o);h=s.impl.renderer().idAtPixel(e.x,e.y,u);var t=g(),n=f(t)?t[h]:null;return!!n&&(a(n,t.numHyperlinks),!0)}},this.handleButtonDown=function(e){return p=!0,r=e.canvasX,o=e.canvasY,!1},this.handleButtonUp=function(){return p=!1,!1},this.handleMouseMove=function(e){return r=e.canvasX,o=e.canvasY,d=!0,!1},this.activate=function(){_((function(e){y(e)})),s.addEventListener(_e.GEOMETRY_LOADED_EVENT,m),s.impl.invalidate(!0,!0)},this.deactivate=function(){s.removeEventListener(_e.GEOMETRY_LOADED_EVENT,m),_((function(e){var t=l[e.id];t&&function(e,t){var n=e.getFragmentList();n.vizmeshes[t].geometry.dispose(),delete n.vizmeshes[t]}(e,t.boxFragId)})),l={},s.impl.invalidate(!0,!0)},this.getCursor=function(){var e=g();return h<-1&&f(e)&&e[h]?"pointer":null}}function xe(e){return xe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xe(e)}function Ce(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function we(e,t){return we=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},we(e,t)}function be(e,t){return!t||"object"!==xe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Me(e){return Me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Me(e)}AutodeskNamespace("Autodesk.AEC").HyperlinkTracker=Ae;var Te=Autodesk.Viewing,Ve=AutodeskNamespace("Autodesk.AEC"),Se=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&we(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Me(i);if(r){var n=Me(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return be(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this,e,t)).hyperlinkTracker=new Ae(n.viewer,n.options.rootBubbleNode,n.options.loadViewableCb,n.options.hyperlinksAddedCb),n}return t=s,(n=[{key:"load",value:function(){return this.viewer.toolController.activateTool("hyperlink-tracker"),!0}},{key:"unload",value:function(){return this.viewer.toolController.deactivateTool("hyperlink-tracker"),!0}}])&&Ce(t.prototype,n),s}(Te.Extension);function Re(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Ve.HyperlinkExtension=Se,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.AEC.HyperlinkExtension",Se);var Le=Autodesk.Viewing.Private,Pe=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.overlayName="DropMeViewPortOverlay"}var t,n;return t=e,(n=[{key:"addOverlay",value:function(e,t,n,i){this.viewer.impl.createOverlayScene(this.overlayName);var r=this._createMesh(e,t,n,i);this.viewer.impl.addOverlay(this.overlayName,r)}},{key:"removeOverlay",value:function(){this.viewer.impl.removeOverlayScene(this.overlayName)}},{key:"_createMesh",value:function(e,t,n,i){var r=2581042694,o=.1,s=new Le.VertexBufferBuilder(!1,void 0,4);s.addSegment(e,t,n,t,0,o,r,-1,0,0),s.addSegment(n,t,n,i,0,o,r,-1,0,0),s.addSegment(n,i,e,i,0,o,r,-1,0,0),s.addSegment(e,i,e,t,0,o,r,-1,0,0);var a={mesh:s.toMesh(),is2d:!0,packId:"0",meshIndex:1};Le.BufferGeometryUtils.meshToGeometry(a);var c=a.geometry,u=this.viewer.impl.matman(),l=u.create2DMaterial(this.viewer.impl.model,{skipEllipticals:!0,skipCircles:!0,skipTriangleGeoms:!0,useInstancing:!1}),h=u.findMaterial(this.viewer.impl.model,l);return new THREE.Mesh(c,h)}}])&&Re(t.prototype,n),e}();function Oe(e){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Oe(e)}function De(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function Ie(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){De(o,i,r,s,a,"next",e)}function a(e){De(o,i,r,s,a,"throw",e)}s(void 0)}))}}function Ne(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function ke(e,t){return ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ke(e,t)}function Be(e,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?Fe(e):t}function Fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function je(e){return je=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},je(e)}var ze=Autodesk.Viewing,Ue=ze.Private,Ge=ze.GlobalManagerMixin,Ye="Auto",We="Manual",He=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ke(e,t)}(u,e);var t,n,i,r,o,s,a,c=(s=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=je(s);if(a){var n=je(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Be(this,e)});function u(e,t,n){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(i=c.call(this)).names=["drop-me"],i.viewer=e,i.setGlobalManager(i.viewer.globalManager),i.extension=n,i.options=n.options,void 0===i.options.teleportOnRelease&&(i.options.teleportOnRelease=!0),i.viewer.toolController.registerTool(Fe(i)),i.onDrop=t,i.active=!1,i._movedSinceFirstClick=!1,i.init(),i.cameraSelectionState={pending:!1,pos:null,target:null,inViewport:!1,initialVp:null},i.teleportationInProgress=0,i.isFirstClick=!0,i.viewPortOverlay=new Pe(i.viewer),i.escapeHotkeyId="Autodesk.AEC.DropMeToolEsc",i}return t=u,n=[{key:"init",value:function(){var e=this;this.activate=function(){var t=e.viewer.toolController.getTool("gestures");t&&t.setGestureParameter("drag","threshold",0);var n=[{keycodes:[Autodesk.Viewing.KeyCode.ESCAPE],onRelease:function(){return e.options.triggerDeactivate()}}];e.viewer.getHotkeyManager().pushHotkeys(e.escapeHotkeyId,n),e.viewer.addEventListener(ze.MODEL_ADDED_EVENT,e.options.triggerDeactivate),e.viewer.impl.pauseHighlight(!0),e.active=!0,Ue.analytics.track("viewer.place_me")},this.deactivate=function(){var t=e.viewer.toolController.getTool("gestures");t&&t.restoreGestureParameterDefault("drag","threshold"),e.viewer.getHotkeyManager().popHotkeys(e.escapeHotkeyId),e._cancelTeleportation(),e._destroyCameraSelectorUi(),e.viewer.removeEventListener(ze.MODEL_ADDED_EVENT,e.options.triggerDeactivate),e.viewer.impl.pauseHighlight(!1),e.active=!1,e._movedSinceFirstClick=!1},this.handleButtonDown=function(){return!0},this.handleButtonUp=function(){return!(!this._movedSinceFirstClick||this.isFirstClick)},this.handleSingleClick=function(t,n){if(e.isFirstClick){var i=e._get3DCameraPositionAndVp(t.canvasX,t.canvasY);i&&i.pos&&(e.cameraSelectionState.pos={x:t.canvasX,y:t.canvasY},e.cameraSelectionState.pending=!0,e.cameraSelectionState.initialVp=i.vp,e._createCameraSelectorUi(e.cameraSelectionState.pos),requestAnimationFrame((function(){e._movedSinceFirstClick||e.cameraSelectorPosition.classList.add("camera-selector-position--teleporting")})),i.vp.isTopViewViewport()&&!n?(e._scheduleTeleportation(),e.isFirstClick=!1,e.cursor="none",e.getCursor()):e._runTeleportation(Ye))}else e.options.teleportOnRelease&&e.teleport();return!0},this.teleport=function(){e.cameraSelectionState.target={x:e.lastX,y:e.lastY},e._runTeleportation(We),e.isFirstClick=e.options.teleportOnRelease,e._movedSinceFirstClick=!1,e._recoverCursor()},this.handleMouseMove=function(t){e.isFirstClick||e._movedSinceFirstClick||(e._movedSinceFirstClick=!0),e.cursor&&e._recoverCursor();var n=e._get3DCameraPositionAndVp(t.canvasX,t.canvasY);if(e.cameraSelectionState.initialVp&&!e.isFirstClick?e._addVpOverlay(e.cameraSelectionState.initialVp):n&&n.pos?e._addVpOverlay(n.vp):e.viewPortOverlay.removeOverlay(),e.cameraSelectionState.inViewport=e.isFirstClick&&n&&n.pos||!e.isFirstClick,e.getCursor(),e.cameraSelectionState.pending){e.teleportationInProgress&&(e.cameraSelectorPosition.classList.remove("camera-selector-position--teleporting"),clearTimeout(e.teleportationInProgress),e.teleportationInProgress=0),e.lastX=t.canvasX,e.lastY=t.canvasY;var i=t.canvasX-e.cameraSelectionState.pos.x,r=t.canvasY-e.cameraSelectionState.pos.y,o=180*Math.atan2(r,i)/Math.PI;return 0===i&&0===r||(o+=90),e.cameraSelector.style.transform="rotate(".concat(o,"deg)"),e.options.teleportOnRelease||e.teleport(),!0}},this.handleSingleTap=function(e){return this.handleSingleClick(e,!0)},this.handleResize=function(){e.options.triggerDeactivate()},this.handleSingleTap=function(t){e.isFirstClick?e.handleSingleClick(t):e.handleMouseMove(t)},this.handleGesture=function(t){switch(t.type){case"dragstart":break;case"dragmove":return e.handleMouseMove(t,0);case"dragend":case"panmove":case"panstart":case"panend":case"pinchmove":case"pinchstart":case"pinchend":return!0}return!1}}},{key:"_recoverCursor",value:function(){this.cursor=null,this.getCursor()}},{key:"getCursor",value:function(){return this.cursor?this.cursor:this.cameraSelectionState.inViewport?"cell":"default"}},{key:"_addVpOverlay",value:function(e){this.viewPortOverlay.removeOverlay();var t=e.getViewportBounds(this.viewer.model.getUnitScale()),n=t.min,i=t.max;this.viewPortOverlay.addOverlay(n.x,n.y,i.x,i.y)}},{key:"_runTeleportation",value:function(e){this.extension.dispatchEvent({type:Autodesk.AEC.DropMeExtension.DROP_ME_STARTED_EVENT}),this._mapToCameraPositionIn3D(e),this.options.triggerDeactivate(!0)}},{key:"_scheduleTeleportation",value:function(){var e=this;this.teleportationInProgress=setTimeout((function(){e._runTeleportation(Ye)}),3e3)}},{key:"_cancelTeleportation",value:function(){this.teleportationInProgress&&(clearTimeout(this.teleportationInProgress),this.teleportationInProgress=0)}},{key:"_createCameraSelectorUi",value:function(e){var t=this.getDocument();this.cameraSelectorBackground=t.createElement("div"),this.cameraSelectorBackground.className="camera-selector-background",this.viewer.container.appendChild(this.cameraSelectorBackground),this.cameraSelectorBackground.style.top="".concat(e.y,"px"),this.cameraSelectorBackground.style.left="".concat(e.x,"px"),this.cameraSelectorPosition=t.createElement("div"),this.cameraSelectorPosition.className="camera-selector-position",this.viewer.container.appendChild(this.cameraSelectorPosition),this.cameraSelectorPosition.style.top="".concat(e.y-10,"px"),this.cameraSelectorPosition.style.left="".concat(e.x-10,"px"),this.cameraSelector=t.createElement("div"),this.cameraSelector.className="camera-selector",this.viewer.container.appendChild(this.cameraSelector),this.cameraSelector.style.top="".concat(e.y-100,"px"),this.cameraSelector.style.left="".concat(e.x-50,"px")}},{key:"_destroyCameraSelectorUi",value:function(){this.viewer.container.contains(this.cameraSelector)&&this.viewer.container.removeChild(this.cameraSelector),this.viewer.container.contains(this.cameraSelectorBackground)&&this.viewer.container.removeChild(this.cameraSelectorBackground),this.viewer.container.contains(this.cameraSelectorPosition)&&this.viewer.container.removeChild(this.cameraSelectorPosition),this.cameraSelectionState={pending:!1,pos:null,target:null,inViewport:!1,initialVp:null},this.isFirstClick=!0,this.viewPortOverlay.removeOverlay()}},{key:"_findViewport",value:function(e){var t=new THREE.Vector2(e.x,e.y),n=this.viewer.model,i=this.extension.viewportsExtension.findViewportAtPoint(n,t,{onlyTopViewPlans:!0});return!this.options.useOnlyAecModelDataViewports||i instanceof Autodesk.AEC.ViewportsExtension.AecModelDataViewport?i:null}},{key:"_mapToCameraPositionIn3DForFloorPlan",value:(o=Ie(regeneratorRuntime.mark((function e(t,n,i){var r,o,s,a,c,u,l,h,d,p,g,f,v,y;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.viewer.model.getDocumentNode(),a=null===(r=(o=this.options).getMain3DView)||void 0===r?void 0:r.call(o,s),c=this.cameraSelectionState.target,a){e.next=7;break}return e.next=6,t.get3DNodesForViewport();case 6:a=e.sent[0];case 7:if(u=n,!t.isMatrixInLocalCoords()){e.next=12;break}return e.next=11,this._applyModelToViewerTransform(n,a);case 11:u=e.sent;case 12:if(l=new THREE.Vector3(0,1,0),!c){e.next=26;break}if(h=c.x,d=c.y,!(p=this._get3DCameraPositionAndVp(h,d,!0))||!p.pos){e.next=26;break}if(g=p.pos,!t.isMatrixInLocalCoords()){e.next=23;break}return e.next=22,this._applyModelToViewerTransform(p.pos,a);case 22:g=e.sent;case 23:f=g.x-u.x,v=g.y-u.y,0===f&&0===v||(l.setX(f).setY(v),l.normalize());case 26:y=new THREE.Vector3(-l.y,l.x,0),l.applyAxisAngle(y,Math.PI/18),this.onDrop(u,l,i,a,!t.isMatrixInLocalCoords());case 29:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"_mapToCameraPositionIn3DForSection",value:(r=Ie(regeneratorRuntime.mark((function e(t,n,i){var r,o,s,a,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=this.viewer.model.getDocumentNode(),a=null===(r=(o=this.options).getMain3DView)||void 0===r?void 0:r.call(o,s)){e.next=6;break}return e.next=5,t.get3DNodesForViewport();case 5:a=e.sent[0];case 6:if(c=n,!t.isMatrixInLocalCoords()){e.next=11;break}return e.next=10,this._applyModelToViewerTransform(n,a);case 10:n=e.sent;case 11:u=new THREE.Vector3(0,1,0),l=new THREE.Vector3(-u.y,u.x,0),u.applyAxisAngle(l,Math.PI/18),this.onDrop(c,u,i,a,!t.isMatrixInLocalCoords());case 15:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"_mapToCameraPositionIn3D",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:We,t=this.cameraSelectionState.pos.x,n=this.cameraSelectionState.pos.y,i=this._get3DCameraPositionAndVp(t,n);i&&i.pos&&i.vp&&(i.vp.isTopViewViewport()?this._mapToCameraPositionIn3DForFloorPlan(i.vp,i.pos,e):this._mapToCameraPositionIn3DForSection(i.vp,i.pos,Ye))}},{key:"_get3DCameraPositionAndVp",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.viewer.impl.clientToViewport(e,t),r=this.viewer.impl.intersectGroundViewport(i),o=this._findViewport(r)||n&&this.cameraSelectionState.initialVp;if(!o)return null;var s=this.viewer.model.getUnitScale(),a=this.sheetTo3DWorld(o,r,s);return{pos:a,vp:o}}},{key:"sheetTo3DWorld",value:function(e,t,n){var i=e.get2DTo3DMatrix(n),r=t.clone().applyMatrix4(i),o=e.findLevelForViewport(),s=e.isFloorPlan();return o&&s&&(r.z=o.elevation+5.74147),r}},{key:"_applyModelToViewerTransform",value:(i=Ie(regeneratorRuntime.mark((function e(t,n){var i,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.clone(),!this.options.useLocalModelCoords){e.next=3;break}return e.abrupt("return",i);case 3:if(!n||!this.options.getTransformForNode){e.next=7;break}return e.next=6,this.options.getTransformForNode(n);case 6:r=e.sent;case 7:return r||(o=this.viewer.model.getDocumentNode().getRootNode(),r=o.extractRefPointTransform()),i.applyMatrix4(r),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})}],n&&Ne(t.prototype,n),u}(ze.ToolInterface);function Ke(e){return function(e){if(Array.isArray(e))return qe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return qe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function qe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Qe(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function Ze(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Ge.call(He.prototype);var Je=Autodesk.Viewing,Xe=Je.Private,$e="ViewObjectIn3D",et=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=n,this.dropMeExt=t,this.options=i,this._onModelAdded=this._onModelAdded.bind(this),this._onGeometryLoaded=this._onGeometryLoaded.bind(this),this._onModelUnloaded=this._onModelUnloaded.bind(this),this._onAggregatedSelectionChanged=this._onAggregatedSelectionChanged.bind(this)}var t,n,i,r;return t=e,n=[{key:"activate",value:function(){var e=this;this.viewer.registerContextMenuCallback($e,(function(t){var n=e.viewer.model.is2d(),i=e.options.enableViewIn3d&&e.dropMeExt.isSupportedModel(e.viewer.model,!1,!0)&&e.viewer.getAggregateSelection();n&&i&&1===i.length&&1===i[0].selection.length&&(e.pos3dFrom2d=e._getSelected3dPosFrom2d(i[0].selection[0],i[0].model),t.push({title:"View object in 3D",target:function(){return e.selectObject(i[0].selection[0])}}))}))}},{key:"deactivate",value:function(){this.viewer.unregisterContextMenuCallback($e)}},{key:"selectObject",value:function(e){if(this.viewer.addEventListener(Je.MODEL_ADDED_EVENT,this._onModelAdded,{once:!0}),this.viewer.addEventListener(Je.GEOMETRY_LOADED_EVENT,this._onGeometryLoaded),this.viewer.addEventListener(Je.MODEL_UNLOADED_EVENT,this._onModelUnloaded),this.viewer.addEventListener(Je.AGGREGATE_SELECTION_CHANGED_EVENT,this._onAggregatedSelectionChanged),this.selectedObjectID=e,this.dropMeExt.dispatchEvent({type:pt.OBJECT_SELECTED_EVENT,selectedObjectID:e}),this.options.onDrop){var t,n,i=this.viewer.model.getDocumentNode(),r=null===(t=(n=this.options).getMain3DView)||void 0===t?void 0:t.call(n,i);this.options.onDrop(void 0,void 0,void 0,r)}Xe.analytics.track("viewer.view_in_3d")}},{key:"_onAggregatedSelectionChanged",value:function(e){var t=e.selections&&1===e.selections.length&&e.selections[0];(t.dbIdArray&&1===t.dbIdArray.length&&t.dbIdArray[0])!==this.selectedObjectID&&e.selections.length&&(this.hidingObjectInterval&&clearInterval(this.hidingObjectInterval),this.viewer.removeEventListener(Je.GEOMETRY_LOADED_EVENT,this._onGeometryLoaded),this.viewer.removeEventListener(Je.AGGREGATE_SELECTION_CHANGED_EVENT,this._onAggregatedSelectionChanged),this.chosenPos=null,this.selectedObjectID=null)}},{key:"_onModelAdded",value:function(e){var t=this,n=e.model;this.hidingObjectInterval&&clearInterval(this.hidingObjectInterval),this.selectedObjectID&&n.is3d()&&this._waitForAllModels().then((function(){return t._placeMeToObject()}))}},{key:"_onModelUnloaded",value:function(){this.hidingObjectInterval&&clearInterval(this.hidingObjectInterval)}},{key:"_placeMeToObject",value:(i=regeneratorRuntime.mark((function t(){var n,i,r,o,s,a,c,u,l=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isGeometryLoaded=this._loadingAllGeometriesDone(),n=this._getAllBoundingBoxes(),this.selectionBox=n[this.selectedObjectID],this.selectionBox){t.next=18;break}if(!this.pos3dFrom2d){t.next=15;break}return i=this.pos3dFrom2d.clone().add(new THREE.Vector3(0,1,0)),r=this.dropMeExt.dropMeTool,o=this.viewer.model.getDocumentNode(),t.next=10,r._applyModelToViewerTransform(this.pos3dFrom2d,o);case 10:return this.pos3dFrom2d=t.sent,t.next=13,r._applyModelToViewerTransform(i,o);case 13:i=t.sent,this.options.onHandleViewIn3D?this.options.onHandleViewIn3D(this.pos3dFrom2d,i,!1):(console.warn("Legacy event. Do not use. Please use onHandleViewIn3D CB instead."),this.dropMeExt.dispatchEvent({type:pt.POSITION_FOUND_EVENT,position:this.pos3dFrom2d,target:i,isPosFrom2dTo3dMatrix:!0}));case 15:return t.abrupt("return");case 18:this._setBoundingBoxPoints(),this.selectionCenter=this.selectionBox.getCenter(new THREE.Vector3),delete n[this.selectedObjectID];case 21:s=this._createCandidates(),a=this._getCloseBoxesKeys(n),c=this._getBetterCandidates(s,n,a),this.chosenPos=this._chooseBestCandidate(c,n,a),u=function(){return l._applySelections(l.chosenPos)},this.options.onHandleViewIn3D?this.options.onHandleViewIn3D(this.chosenPos.position,this.selectionCenter,!0,u):(console.warn("Legacy event. Do not use. Please use onHandleViewIn3D CB instead."),this.dropMeExt.dispatchEvent({type:pt.POSITION_FOUND_EVENT,position:this.chosenPos.position,target:this.selectionCenter,applySelectionCB:u})),this.isGeometryLoaded||this._waitForAllInstanceTrees().then((function(){l.hidingObjectInterval&&clearInterval(l.hidingObjectInterval),l.hidingObjectInterval=setInterval((function(){return l._hideCurrentIntersections()}),e.HIDING_INTERVAL_FREQUENCY)}));case 28:case"end":return t.stop()}}),t,this)})),r=function(){var e=this,t=arguments;return new Promise((function(n,r){var o=i.apply(e,t);function s(e){Qe(o,n,r,s,a,"next",e)}function a(e){Qe(o,n,r,s,a,"throw",e)}s(void 0)}))},function(){return r.apply(this,arguments)})},{key:"_getAllBoundingBoxes",value:function(){for(var e={},t=this.viewer.getVisibleModels(),n=0;n<t.length;n++){var i=t[n].getFragmentList();e=Object.assign(e,this._getBoundingBoxes(i))}return e}},{key:"_getBoundingBoxes",value:function(e){for(var t={},n=new THREE.Box3,i=0;i<e.fragments.length;i++){var r=e.fragments.fragId2dbId[i];t[r]||(t[r]=new THREE.Box3),e.getWorldBounds(i,n),t[r].union(n)}return t}},{key:"_createCandidates",value:function(){var t=this._getHeight(this.selectionCenter.z);this.maxDistance=Number.MIN_VALUE;var n,i=this.viewer.navigation.getWorldRightVector(),r=this.viewer.navigation.getWorldUpVector().cross(i),o=this.selectionBox.getSize(new THREE.Vector3),s=Math.abs(o.clone().multiply(i).length()),a=Math.abs(o.clone().multiply(r).length()),c=Math.max(s,a);c/Math.min(s,a)>e.COVERAGE_FACTOR&&(n=c===s?i:r),this.viewer.navigation.toPerspective();for(var u=[],l=0;l<e.NUMBER_OF_POSITION;++l){var h=l/(e.NUMBER_OF_POSITION/2)*Math.PI,d=this.selectionCenter.clone().add(new THREE.Vector3(Math.cos(h),-Math.sin(h),0)),p=this.viewer.navigation.getVerticalFov(),g=this.viewer.getCamera().aspect,f=this.viewer.navigation.computeFit(d,this.selectionCenter,p,this.selectionBox,g).position,v=f.clone().sub(this.selectionCenter);f.add(v.clone().multiplyScalar(.1)),f.z=t;var y=n&&v.normalize().dot(n),m=y&&Math.abs(y)>Math.cos(THREE.Math.degToRad(e.IGNORE_ANGLE)),_=this.selectionCenter.clone().sub(f.clone()),E=_.clone().normalize(),A=new THREE.Ray(f.clone(),E.clone()),x=A.intersectBox(this.selectionBox),C=x&&x.sub(f).length(),w=_.length();this.maxDistance=Math.max(this.maxDistance,C,w),C&&!m&&u.push({index:l,position:f,ray:A,distanceToTarget:C,distanceToCenterTarget:w,selectionID:this.selectedObjectID,intersections:[],cornerIntersections:[],cornerIntersectionsToHide:[]})}return u}},{key:"_getClientViewBoundingBox",value:function(e){for(var t=new THREE.Box3,n=0;n<this.boundingBoxPoints.length;n++){var i=this.boundingBoxPoints[n],r=this.viewer.impl.worldToClient(i,e);t.min.x>r.x&&(t.min.x=r.x),t.max.x<r.x&&(t.max.x=r.x),t.min.y>r.y&&(t.min.y=r.y),t.max.y<r.y&&(t.max.y=r.y)}return t}},{key:"_setBoundingBoxPoints",value:function(){this.boundingBoxPoints=[];for(var e=0;e<8;e++){var t=new THREE.Vector3;t.x=0==!!(1&e)?this.selectionBox.max.x:this.selectionBox.min.x,t.y=0==!!(2&e)?this.selectionBox.max.y:this.selectionBox.min.y,t.z=0==!!(4&e)?this.selectionBox.max.z:this.selectionBox.min.z,this.boundingBoxPoints.push(t)}}},{key:"_getCloseBoxesKeys",value:function(t){var n=this,i=new THREE.Vector3;return Object.keys(t).filter((function(r){return t[r].getCenter(i).clone().sub(n.selectionCenter).length()<n.maxDistance*e.DISTANCE_FACTOR}))}},{key:"_getBetterCandidates",value:function(e,t,n){for(var i=this,r=[],o=Number.POSITIVE_INFINITY,s=function(s){var a=e[s];if(i.isGeometryLoaded){var c=[];a.intersections=[],i.viewer.impl.rayIntersect(a.ray,!1,!1,!1,c);var u=i._getClosestIntersectionWithSelectedObject(c);u?a.distanceToTarget=u:u=a.distanceToCenterTarget,c.forEach((function(e){e.dbId!==i.selectedObjectID&&-1===a.intersections.indexOf(e.dbId)&&e.distance<u&&a.intersections.push(e.dbId)}))}else a.intersections=i._getIntersectionsOfRayWithBoundingBoxes(a,a.ray,o,t,n);a.intersections.length===o?r.push(a):a.intersections.length<o&&(r=[a],o=a.intersections.length)},a=0;a<e.length;++a)s(a);return r}},{key:"_chooseBestCandidate",value:function(e,t,n){var i,r=this,o=Number.MAX_VALUE;return e.forEach((function(e){i=i||e;for(var s=0;s<r.boundingBoxPoints.length;s++){var a=r.boundingBoxPoints[s],c=a.clone().sub(r.selectionCenter).multiplyScalar(.1);a.sub(c);var u,l,h=a.clone().sub(e.position).normalize(),d=new THREE.Ray(e.position.clone(),h),p=[];if(r.isGeometryLoaded){if("continue"===function(){r.viewer.impl.rayIntersect(d,!1,!1,!1,p);var e=r._getClosestIntersectionWithSelectedObject(p);if(!e)return"continue";p=(p=p.filter((function(t){return t.dbId!==r.selectedObjectID&&t.distance<=e}))).map((function(e){return e.dbId}))}())continue}else p=r._getIntersectionsOfRayWithBoundingBoxes(e,d,o,t,n);if(p.length&&((u=e.cornerIntersections).push.apply(u,Ke(p)),e.cornerIntersections=Ke(new Set(e.cornerIntersections)),e.cornerIntersections.length>o))break;r.isGeometryLoaded&&a.clone().sub(r.selectionCenter).dot(e.ray.direction)>0&&p.length&&((l=e.cornerIntersectionsToHide).push.apply(l,Ke(p)),e.cornerIntersectionsToHide=Ke(new Set(e.cornerIntersections)))}var g=e.cornerIntersections.length;r._isInsideOtherObject(e,t,n)&&g++,g<o?(o=g,i=e):g===o&&(e.distanceToCenterTarget===i.distanceToCenterTarget?e.distanceToTarget<i.distanceToTarget&&(i=e):e.distanceToCenterTarget<i.distanceToCenterTarget&&(i=e))})),i}},{key:"_getIntersectionsOfRayWithBoundingBoxes",value:function(e,t,n,i,r){for(var o=[],s=r.length,a=0;a<s;++a){var c=r[a],u=i[c],l=parseInt(c),h=u&&t.intersectBox(u),d=h&&e.position.clone().sub(h).length();if(d&&d<e.distanceToTarget&&(o.push(l),o.length>n))break}return o}},{key:"_isInsideOtherObject",value:function(e,t,n){for(var i=0;i<n.length;++i)if(t[n[i]].containsPoint(e.position))return!0;return!1}},{key:"_getClosestIntersectionWithSelectedObject",value:function(e){var t=this,n=e.filter((function(e){return e.dbId===t.selectedObjectID})),i=Number.MAX_VALUE;if(!n[0])return null;for(var r=0;r<n.length;r++)n[r].distance<i&&(i=n[r].distance);return i}},{key:"_hideCurrentIntersections",value:function(e){if(this.chosenPos){var t=!1,n=[];this.viewer.impl.rayIntersect(this.chosenPos.ray,!1,!1,!1,n),t=this._hideIntersectionsCandidates(n,!0),e&&(t=this._hideCornersIntersections()||t),t&&this.viewer.impl.invalidate(!0,!0,!0)}}},{key:"_hideCornersIntersections",value:function(){for(var t=!1,n=0;n<this.boundingBoxPoints.length;n++)for(var i=this.boundingBoxPoints[n],r=0;r<e.NUMBER_OF_CORNER_INTERSECTIONS;r++){var o=[],s=i.clone().sub(this.selectionCenter).multiplyScalar(r/e.NUMBER_OF_CORNER_INTERSECTIONS);i.sub(s);var a=i.clone().sub(this.chosenPos.position).normalize(),c=new THREE.Ray(this.chosenPos.position.clone(),a);this.viewer.impl.rayIntersect(c,!1,!1,!1,o),t=this._hideIntersectionsCandidates(o)||t}return t}},{key:"_hideIntersectionsCandidates",value:function(e,t){var n,i=e.length,r=!1;if(i>1&&(n=this._getClosestIntersectionWithSelectedObject(e),t&&n&&!this._isSelected(this.selectedObjectID)&&this.allTreesLoaded()&&this.viewer.select(this.selectedObjectID),t||n))for(var o=0;o<i;o++){var s=e[o];s.dbId!==this.selectedObjectID&&s.distance<(n||this.chosenPos.distanceToCenterTarget)&&(this.viewer.hide(s.dbId),r=!0)}return r}},{key:"_isSelected",value:function(e){for(var t=this.viewer.getVisibleModels(),n=0;n<t.length;++n)if(t[n].selector.isSelected(e))return!0;return!1}},{key:"_applySelections",value:function(e){if(e&&this.allTreesLoaded())if(this._isSelected(e.selectionID)||this.viewer.select(e.selectionID),this.isGeometryLoaded)this._hideCurrentIntersections(!0);else{for(var t=0;t<e.intersections.length;++t)this.viewer.hide(e.intersections[t]);for(var n=0;n<e.cornerIntersectionsToHide.length;++n)this.viewer.hide(e.cornerIntersectionsToHide[n])}}},{key:"_getHeight",value:function(e){var t=this.viewer.model.getData().metadata["distance unit"].value||"foot",n=1.8/Autodesk.Viewing.Private.convertUnits(t,"m",1,1),i=F(this.viewer.model.getDocumentNode().getAecModelData(),this.viewer.model.myData.placementWithOffset);return i.length?(e<i[0].zMin?i[0]:e>i[i.length-1].zMax?i[i.length-1]:i.find((function(t){return t.zMin<=e&&t.zMax>=e}))).zMin+n:this.selectionBox.min.z+n}},{key:"_pending3DLoaders",value:function(){return!!this.viewer.impl.loaders.filter((function(e){return e.is3d()})).length}},{key:"_loadingAllGeometriesDone",value:function(){for(var e=this.viewer.getVisibleModels(),t=0;t<e.length;++t)if(!e[t].isLoadDone())return!1;return!this._pending3DLoaders()}},{key:"_waitForAllModels",value:function(){var e=this;return new Promise((function(t){!function n(){!function(){for(var t=e.viewer.getVisibleModels(),n=0;n<t.length;++n)if(!t[n].modelRootLoaded)return!1;return!e._pending3DLoaders()}()?e.viewer.addEventListener(Je.MODEL_ROOT_LOADED_EVENT,n,{once:!0}):t()}()}))}},{key:"allTreesLoaded",value:function(){for(var e=this.viewer.getVisibleModels(),t=0;t<e.length;++t)if(!e[t].getInstanceTree())return!1;return!this._pending3DLoaders()}},{key:"_waitForAllInstanceTrees",value:function(){var e=this;return new Promise((function(t){!function n(){e.allTreesLoaded()?t():e.viewer.addEventListener(Je.OBJECT_TREE_CREATED_EVENT,n,{once:!0})}()}))}},{key:"_onGeometryLoaded",value:function(){var e=this;this._loadingAllGeometriesDone()&&(this.viewer.removeEventListener(Je.GEOMETRY_LOADED_EVENT,this._onGeometryLoaded),this.hidingObjectInterval&&clearInterval(this.hidingObjectInterval),this.selectedObjectID&&this.chosenPos&&this._waitForAllInstanceTrees().then((function(){e.viewer.clearSelection(),e._isSelected(e.selectedObjectID)||e.viewer.select(e.selectedObjectID),e._hideCurrentIntersections(!0),e.viewer.impl.invalidate(!0,!0,!0),e.chosenPos=null,e.selectedObjectID=null})))}},{key:"_getSelected3dPosFrom2d",value:function(e,t){var n=this.viewer.impl.computeSelectionBounds([e],t),i=this.viewer.impl.worldToClient(n.getCenter(new THREE.Vector3)),r=this.dropMeExt.dropMeTool._get3DCameraPositionAndVp(i.x,i.y);return r&&r.pos}}],n&&Ze(t.prototype,n),e}();function tt(e){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(e)}function nt(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function it(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){nt(o,i,r,s,a,"next",e)}function a(e){nt(o,i,r,s,a,"throw",e)}s(void 0)}))}}function rt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ot(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function st(e,t){return st=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},st(e,t)}function at(e,t){return!t||"object"!==tt(t)&&"function"!=typeof t?ct(e):t}function ct(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ut(e){return ut=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ut(e)}et.HIDING_INTERVAL_FREQUENCY=300,et.NUMBER_OF_CORNER_INTERSECTIONS=10,et.DISTANCE_FACTOR=3,et.COVERAGE_FACTOR=4,et.IGNORE_ANGLE=35,et.NUMBER_OF_POSITION=8;var lt=Autodesk.Viewing,ht=Autodesk.Viewing.UI,dt=AutodeskNamespace("Autodesk.AEC"),pt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&st(e,t)}(c,e);var t,n,i,r,o,s,a=(o=c,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ut(o);if(s){var n=ut(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return at(this,e)});function c(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{teleportOnRelease:!0};return rt(this,c),t=a.call(this,e,n),Autodesk.Viewing.EventDispatcher.prototype.apply(ct(t)),t.teleportOnRelease=n.teleportOnRelease,t.viewer=e,t._onModelLoaded=t._onModelLoaded.bind(ct(t)),t._deactivateTool=t._deactivateTool.bind(ct(t)),t._onViewportDataFetched=t._onViewportDataFetched.bind(ct(t)),t.onDropOverride=null,t.options=n,t.options.triggerDeactivate=t._deactivateTool,t.toggleIndex=n.toggleIndex||0,t.enableGuidance=n.enableGuidance||!1,t.options.enableViewIn3d&&(t.viewObjectIn3D=new et(ct(t),e,t.options)),t}return t=c,n=[{key:"load",value:(r=it(regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.AEC.ViewportsExtension");case 2:return this.viewportsExtension=e.sent,this.viewportsExtension.addEventListener(Autodesk.AEC.ViewportsExtension.Events.VIEWPORT_DATA_FETCHED_EVENT,this._onViewportDataFetched),this.dropMeTool=new He(this.viewer,(function(){return n._onDrop.apply(n,arguments)}),this),this.viewer.addEventListener(lt.MODEL_ADDED_EVENT,this._onModelLoaded),this.viewer.model&&this._initUI(this.viewer.model),null===(t=this.viewObjectIn3D)||void 0===t||t.activate(),e.abrupt("return",!0);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"unload",value:function(){var e;return null===(e=this.viewObjectIn3D)||void 0===e||e.deactivate(),this.viewportsExtension.removeEventListener(Autodesk.AEC.ViewportsExtension.Events.VIEWPORT_DATA_FETCHED_EVENT,this._onViewportDataFetched),this.viewportsExtension=null,this.viewer.removeEventListener(lt.MODEL_ADDED_EVENT,this._onModelLoaded),this.viewer.toolController.setIsLocked(!1),this._deactivateTool(),this._destroyUI(),!0}},{key:"_onViewportDataFetched",value:function(){this.viewer.model&&this._onModelLoaded({model:this.viewer.model})}},{key:"setOnDrop",value:function(e){this.onDropOverride=e}},{key:"_destroyUI",value:function(){this._showDrop(!1),this.dropMeButton&&(this.dropMeButton.removeFromParent(),this.dropMeButton=null),this.uiInitialized=!1}},{key:"_onDrop",value:function(e,t,n,i,r){this.teleportOnRelease&&(this.viewer.toolController.setIsLocked(!1),this._deactivateTool(!0)),console.log("DropMe: 3D camera position is ".concat(JSON.stringify(e))),console.log("DropMe: 3D camera direction is ".concat(JSON.stringify(t))),this.dispatchEvent({type:c.DROP_ME_EVENT,pos:e,dir:t,mode:n,bubbleNode:i,ignoreCameraGlobalOffset:r}),this.onDropOverride?this.onDropOverride(e,t,n,i,r):this.options.onDrop?this.options.onDrop(e,t,n,i,r):console.warn("DropMe: No onDrop callback specified ")}},{key:"_onModelLoaded",value:function(e){this.uiInitialized?this._updateUI(e.model):this._initUI(e.model)}},{key:"_deactivateTool",value:function(e){this.uiInitialized&&(this._showGuidenaceUI(!1),this.dropMeButton.setState(e?ht.Button.State.DISABLED:ht.Button.State.INACTIVE)),this.viewer.toolController.deactivateTool("drop-me")}},{key:"isSupportedModel",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(null==e?void 0:e.is2d()))return!1;var i=e.getDocumentNode();if(!i)return!1;var r=this.viewportsExtension.filterAndFlattenViewports(i,{onlyTopViewPlans:t});return(n||this.options.useOnlyAecModelDataViewports)&&(r=r.filter((function(e){return e instanceof Autodesk.AEC.ViewportsExtension.AecModelDataViewport}))),r.length}},{key:"_updateUI",value:(i=it(regeneratorRuntime.mark((function e(t){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.viewer.getToolbar&&this.viewer.getToolbar()){e.next=3;break}return e.abrupt("return");case 3:this.dropMeButton.removeFromParent(),n.getControl(this.options.toolbarGroup||lt.TOOLBAR.NAVTOOLSID).addControl(this.dropMeButton,{index:this.toggleIndex}),i=this.isSupportedModel(t),this._showDrop(i);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"_initUI",value:function(e){var t=this;this.viewer.getToolbar&&this.viewer.getToolbar()&&(this.dropMeButton=new ht.Button("drop-me-icon"),this.dropMeButton.icon.innerHTML=gt(),this.dropMeButton.onClick=function(){t.dropMeTool.active?t._deactivateTool():(t.dropMeButton.setState(ht.Button.State.ACTIVE),t.viewer.toolController.activateTool("drop-me"),t._showGuidenaceUI())},this.uiInitialized=!0,this._updateUI(e))}},{key:"_showGuidenaceUI",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.enableGuidance)if(e){var t=this.getDocument();this.guidenaceUI=t.createElement("div"),this.guidenaceUI.className="dropme-guidenace-ui",this.guidenaceUI.innerHTML=Autodesk.Viewing.i18n.translate("Click on a location to ground yourself, then select a camera direction"),this.viewer.container.appendChild(this.guidenaceUI)}else this.viewer.container.contains(this.guidenaceUI)&&this.viewer.container.removeChild(this.guidenaceUI)}},{key:"_showDrop",value:function(e){if(this.dropMeButton){this.viewer.getToolbar().getControl(this.options.toolbarGroup||lt.TOOLBAR.NAVTOOLSID)&&!this.container&&this.dropMeButton.setState(e?ht.Button.State.INACTIVE:ht.Button.State.DISABLED);var t=Autodesk.Viewing.i18n.translate("Click a 2D location to view that space in 3D"),n=Autodesk.Viewing.i18n.translate("Current view is not supported by Place Me");this.dropMeButton.setToolTip(e?t:n)}}}],n&&ot(t.prototype,n),c}(lt.Extension),gt=function(){return['<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128">','<g stroke="currentColor" fill="currentColor">','<path d="M67,0c2.4.5,4.8.9,7.1,1.6C87.5,5.3,96.6,16.6,98,31a37.2,37.2,0,0,1-2.1,16.2c-4.7,13-23.6,48.1-31.6,58.2-.3-.2-.6-.3-.8-.5-11.1-17.6-21.9-35.4-30-54.7-4.6-10.9-4.6-21.7.6-32.3S47.5,2.6,58.3.7l3-.7ZM64,47A11.8,11.8,0,1,0,52.3,34.9,12,12,0,0,0,64,47Z"/>','<path d="M12.8,103.4c1.4-8,6.9-12.3,14-14.6s12-2.9,18.1-4.2c1.1-.2,2.4.5,3.4,1.5-4.5,1.1-9.1,1.8-13.5,3.3a35,35,0,0,0-9.6,5c-4,3-4.3,7.5-.7,10.9a28.7,28.7,0,0,0,9.6,6.2,87.3,87.3,0,0,0,59.9.1,28.2,28.2,0,0,0,8.7-5.2c4.9-4.1,4.8-9.7-.8-12.8S90.7,89.3,85,87.3c-1.6-.6-3.4-.6-5.3-1.7,1.1-.4,2.2-1.2,3.2-1.1,7.8.9,15.5,2.2,22.6,6,12,6.4,13,17.9,2.1,26.1-8.1,6.1-17.6,8.5-27.4,10L69.1,128H59.2l-5.2-.7c-9.1-.8-18-2.6-26.4-6.5s-13.4-8.1-14.9-16.8Z"/>',"</g>","</svg>"].join("")};function ft(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function vt(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function yt(e,t,n){return t&&vt(e.prototype,t),n&&vt(e,n),e}dt.DropMeExtension=pt,pt.POSITION_FOUND_EVENT="POSITION_FOUND_EVENT",pt.OBJECT_SELECTED_EVENT="OBJECT_SELECTED_EVENT",pt.DROP_ME_EVENT="DROP_ME_EVENT",pt.DROP_ME_STARTED_EVENT="DROP_ME_STARTED_EVENT",Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.AEC.DropMeExtension",pt);var mt=function(){function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;ft(this,e),this._clusterfck=t,this.setDistanceFuncAndThreshold(n,i)}return yt(e,null,[{key:"FlattenCluster",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.value?n.push(t.value):(e.FlattenCluster(t.left,n),e.FlattenCluster(t.right,n)),n}},{key:"ComputeMeanValueForFlattenCluster",value:function(e){var t=new THREE.Box3,n=new THREE.Box3;return e.forEach((function(e){t.expandByPoint(e.currentPosProjected),n.expandByPoint(e.currentPos3D)})),{center2D:t.getCenter(new THREE.Vector3),center3D:n.getCenter(new THREE.Vector3)}}}]),yt(e,[{key:"setDistanceFuncAndThreshold",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this._distanceFunc=e,this._threshold=t}},{key:"setThreshold",value:function(e){this._threshold=e}},{key:"createClusters",value:function(e){return this._clusterfck.hcluster(e,this._distanceFunc,this._clusterfck.AVERAGE_LINKAGE,this._threshold)}}]),e}();function _t(e){return _t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_t(e)}function Et(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function At(e,t){return At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},At(e,t)}function xt(e,t){return!t||"object"!==_t(t)&&"function"!=typeof t?Ct(e):t}function Ct(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wt(e){return wt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},wt(e)}var bt,Mt,Tt,Vt,St,Rt,Lt,Pt,Ot,Dt=Autodesk.Viewing,It=Dt.Private,Nt=Autodesk.Viewing.UI,kt=AutodeskNamespace("Autodesk.AEC"),Bt="Autodesk.AEC.LevelsExtension",Ft="canvasBookmarks",jt="CanvasBookmark_Extension_Overlay",zt="CanvasBookmark_CutPlanes",Ut=(bt=new THREE.Vector3,Mt=new THREE.Vector3,Tt=new THREE.Vector3,Vt=new THREE.Vector3,St=new THREE.Quaternion,Rt=new THREE.Quaternion,Lt=new THREE.Vector3,Pt=new THREE.Vector3,Ot=new THREE.Quaternion,function(e,t,n,i){return e.decompose(bt,St,Tt),t.decompose(Mt,Rt,Vt),Lt.lerpVectors(bt,Mt,n),Pt.lerpVectors(Tt,Vt,n),THREE.Quaternion.slerp(St,Rt,Ot,n),i.compose(Lt,Ot,Pt),i}),Gt=function(e){var t=e.clone();return t.transform=e.transform?e.transform.clone():new THREE.Matrix4,t},Yt=function(e,t){e.visiblityChangePending=!0,requestAnimationFrame((function(){t?e.container.classList.add("visible"):e.container.classList.remove("visible"),e.visiblityChangePending=!1}))},Wt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(s,e);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=wt(i);if(r){var n=wt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return xt(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this,e,t)).viewer=e,n.bookmarks=[],n.clusteredBookmarks=[],n.camera=n.viewer.navigation.getCamera(),n.cameraMovedCB=n.onCameraMoved.bind(Ct(n)),n.onModelTransformChanged=n.onModelTransformChanged.bind(Ct(n)),n.onVisibilityChangedCB=n.onVisibilityChanged.bind(Ct(n)),n.sectionBox=null,n.activeSectionBox=null,n.animStartSectionBox=null,n.animEndSectionBox=null,n.sectionBoxAnim=null,n.changeBookmarksVisibility=n.changeBookmarksVisibility.bind(Ct(n)),n.changeBookmarksVisibilityTimeout=null,n._clusteringEnabled=void 0!==n.options.clusterfck,n._clusteringThreshold=n.options.clusteringThreshold||110,n._clusteringEnabled&&(n.hcluster=new mt(n.options.clusterfck,(function(e,t){var n=new THREE.Vector2(e.currentPosProjected.x,e.currentPosProjected.y);return new THREE.Vector2(t.currentPosProjected.x,t.currentPosProjected.y).distanceTo(n)}),n._clusteringThreshold)),n._filterOutInvisibleBookmark=n._filterOutInvisibleBookmark.bind(Ct(n)),n.levelChangedCB=n.onLevelChanged.bind(Ct(n)),n.extensionLoadedCB=n.onExtensionLoaded.bind(Ct(n)),n.isFrustumFading=!1,n.waitingCallbacks=[],n}return t=s,n=[{key:"setBookmarksVisible",value:function(e){this.bookmarks.forEach((function(t){return Yt(t.marker,e)})),this.clusteredBookmarks.forEach((function(t){return Yt(t.marker,e)})),e||this.stopGhosting()}},{key:"onVisibilityChanged",value:function(e){this.viewer.prefs&&this.viewer.prefs.set(Ft,e),this.setBookmarksVisible(e),e&&this.updateBookmarkPositions()}},{key:"isVisible",value:function(){return this.viewer.prefs&&this.viewer.prefs.get(Ft)}},{key:"onCameraMoved",value:function(){this.setBookmarksVisible(!1),this.debounceBookmarksVisibility()}},{key:"createTooltip",value:function(e,t){e.setToolTip(t.name()),e._toolTipElement.innerHTML="<b>".concat(t.name(),"</b>")}},{key:"flyToBookmark",value:function(e){var t={position:e.pos,target:e.target,up:e.up};this.anim=It.flyToView(this.viewer,t,1)}},{key:"getRelatedModelTransform",value:function(e){var t=e.getRootNode(),n=this.viewer.getVisibleModels().find((function(e){return e.getDocumentNode().getRootNode()===t}));return null==n?void 0:n.getModelToViewerTransform()}},{key:"createBookmark",value:function(e){var t=this,n=e.extractCamera();if(n){var i=n.position,r=n.target,o=this.getRelatedModelTransform(e);o&&(i.applyMatrix4(o),r.applyMatrix4(o));var s=new THREE.Vector3(r.x-i.x,r.y-i.y,r.z-i.z).normalize(),a=new THREE.Vector3(0,0,1),c=new Autodesk.Viewing.UI.Button("b-".concat(e.name().replace(/\s/g,"")));c.container.classList.add("canvas-bookmark"),c.container.innerHTML=['<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 114 114">',"<defs>",'<path id="camera-view-icon-3-with-shadow-v3-b" d="M60.934065,73.4602645 C54.1164768,73.4602645 48.5886781,67.9324658 48.5886781,61.1148776 C48.5886781,54.2963836 54.1164768,48.7694907 60.934065,48.7694907 C67.752559,48.7694907 73.2803577,54.2963836 73.2803577,61.1148776 C73.2803577,67.9324658 67.752559,73.4602645 60.934065,73.4602645 M78.7230158,42.834104 C77.2575106,42.9581919 75.7711731,42.808743 74.2984219,42.8748628 C73.4714712,42.9119986 72.9388896,42.637556 72.4470667,41.9817922 C70.947143,39.9827997 69.3693246,38.0417751 67.8621549,36.0491228 C67.287003,35.2873862 66.5959149,34.9939228 65.6521223,35.0029804 C62.0046628,35.0355874 58.354486,35.0401161 54.7070265,35.0002631 C53.7097946,34.9893941 53.0033088,35.3145587 52.4046073,36.1116196 C50.9028721,38.1088007 49.382116,40.0951128 47.7852769,42.0171165 C47.4311283,42.4437253 46.748192,42.7707014 46.1884378,42.8187062 C44.8515493,42.9346424 43.4974514,42.855842 41.9640149,42.855842 C41.9640149,42.2091358 41.9929989,41.6520989 41.9576746,41.0995907 C41.8897433,40.036239 41.3046281,39.4293858 40.2331246,39.4112707 C38.5112919,39.381381 36.7894591,39.3759465 35.0676263,39.4130822 C33.9934056,39.4366318 33.4291227,40.057977 33.3892696,41.1303863 C33.3693431,41.6557219 33.3856466,42.1819632 33.3856466,42.8078372 C31.121269,42.9074698 29.8523117,44.2289606 29,46.07941 L29,75.8722796 C30.0434252,78.4165343 31.9636175,79.1737422 34.6482636,79.1583444 C49.3911736,79.0686751 64.1340835,79.0713923 78.8769935,79.1556272 C81.5299383,79.1710249 83.372236,78.3377339 84.4011692,75.8722796 L84.4011692,46.07941 C83.3332887,43.5523646 81.4058504,42.6067605 78.7230158,42.834104"/>','<filter id="camera-view-icon-3-with-shadow-v3-a" width="125.3%" height="131.7%" x="-12.6%" y="-11.3%" filterUnits="objectBoundingBox">','<feOffset dy="2" in="SourceAlpha" result="shadowOffsetOuter1"/>','<feGaussianBlur in="shadowOffsetOuter1" result="shadowBlurOuter1" stdDeviation="2"/>','<feColorMatrix in="shadowBlurOuter1" values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.1 0"/>',"</filter>",'<path id="camera-view-icon-3-with-shadow-v3-d" d="M104.440851,57.2204256 C104.440851,83.2997158 83.2997158,104.440851 57.2204256,104.440851 C31.1411354,104.440851 10,83.2997158 10,57.2204256 C10,31.1411354 31.1411354,10 57.2204256,10 C83.2997158,10 104.440851,31.1411354 104.440851,57.2204256 Z"/>','<filter id="camera-view-icon-3-with-shadow-v3-c" width="125.5%" height="125.5%" x="-12.8%" y="-10.6%" filterUnits="objectBoundingBox">','<feMorphology in="SourceAlpha" operator="dilate" radius="5.045" result="shadowSpreadOuter1"/>','<feOffset dy="2" in="shadowSpreadOuter1" result="shadowOffsetOuter1"/>','<feMorphology in="SourceAlpha" radius="5.045" result="shadowInner"/>','<feOffset dy="2" in="shadowInner" result="shadowInner"/>','<feComposite in="shadowOffsetOuter1" in2="shadowInner" operator="out" result="shadowOffsetOuter1"/>','<feGaussianBlur in="shadowOffsetOuter1" result="shadowBlurOuter1" stdDeviation="2"/>','<feColorMatrix in="shadowBlurOuter1" values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.1 0"/>',"</filter>","</defs>",'<g fill="none" fill-rule="evenodd">','<use fill="#000" filter="url(#camera-view-icon-3-with-shadow-v3-a)" xlink:href="#camera-view-icon-3-with-shadow-v3-b"/>','<use fill="currentColor" xlink:href="#camera-view-icon-3-with-shadow-v3-b"/>',"<g>",'<use fill="#000" filter="url(#camera-view-icon-3-with-shadow-v3-c)" xlink:href="#camera-view-icon-3-with-shadow-v3-d"/>','<use stroke="currentColor" stroke-width="10.09" xlink:href="#camera-view-icon-3-with-shadow-v3-d"/>',"</g>","</g>","</svg>"].join(""),Yt(c,this.isVisible()),this.createTooltip(c,e),this.viewer.container.appendChild(c.container);var u=c.getDimensions(),l=this.findSectionBox(e,e.name()),h=l?l.getCenter(new THREE.Vector3).applyMatrix4(l.transform):null,d={marker:c,pos:l?h:i,cameraPos:i,dir:s,up:a,target:r,name:e.name(),anchorX:u.width/2,anchorY:u.height/2,fadeValue:0,hovered:!1,bubbleNode:e,clustered:!1};return c.container.addEventListener("mouseenter",(function(){t.onBookmarkMouseEnter(d)})),c.container.addEventListener("mouseleave",(function(){t.onBookmarkMouseLeave(d)})),c.addEventListener(Nt.Button.Event.CLICK,(function(){t.options&&t.options.onBookmark&&t.options.onBookmark(d.bubbleNode,n)})),d}}},{key:"createClusteredBookmark",value:function(e,t,n){var i=this,r=new Autodesk.Viewing.UI.Button(t);r.container.classList.add("clustered-canvas-bookmark"),r.container.innerHTML=['<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 652 598">','<path fill="currentColor" d="M254.7,94.3A157.6,157.6,0,1,0,412.3,251.9,157.6,157.6,0,0,0,254.7,94.3ZM173.6,281.4a24.2,24.2,0,1,1,23.9-24.2A23.8,23.8,0,0,1,173.6,281.4Zm86.6,0a24.2,24.2,0,1,1,23.9-24.2A23.8,23.8,0,0,1,260.2,281.4Zm86.7,0a24.2,24.2,0,1,1,23.9-24.2A23.8,23.8,0,0,1,346.9,281.4Z"/>','<circle fill="none" stroke="currentColor" stroke-miterlimit="10" stroke-width="42.87px" cx="256" cy="256" r="221.5" transform="translate(-101.8 200.6) rotate(-36.2)"/>',"</svg>"].join(""),Yt(r,this.isVisible()&&n),this.viewer.container.appendChild(r.container);var o=mt.ComputeMeanValueForFlattenCluster(e),s={marker:r,name:t,pos:o.center3D,currentPosProjected:o.center2D,cluster:e,fadeValue:0,hovered:!1,folded:!0};r.container.addEventListener("mouseenter",(function(){i.onClusteredBookmarkMouseEnter(s)})),r.container.addEventListener("mouseleave",(function(){i.onClusteredBookmarkMouseLeave(s)})),r.addEventListener(Nt.Button.Event.CLICK,(function(){i.onClusteredBookmarkClicked(s)})),s.marker.container.style.transform="translate(".concat(o.center2D.x,"px, ").concat(o.center2D.y,"px)"),this.clusteredBookmarks.push(s)}},{key:"deleteBookmark",value:function(e){this.viewer.container.removeChild(e.marker.container),this.hideFrustumShape(e)}},{key:"clearBookmarks",value:function(){var e=this;this.stopSectionBoxAnim(),this.applySectionBox(),this.bookmarks.forEach((function(t){e.deleteBookmark(t)})),this.bookmarks=[],this.clusteredBookmarks.forEach((function(t){e.deleteBookmark(t)})),this.clusteredBookmarks=[]}},{key:"resetBookmarks",value:function(e){var t=this;this.clearBookmarks(),e&&Dt.Document.getAecModelData(e).then((function(){for(var n=0;n<e.length;n++){var i=e[n],r=t.createBookmark(i);r&&t.bookmarks.push(r)}t.bookmarkData=e,t.updateBookmarkPositions()}))}},{key:"resetGlobalOffset",value:function(e){this.options.globalOffset=e,this.resetBookmarks(this.bookmarkData)}},{key:"showFrustumShape",value:function(e){e.frustumShape||(e.frustumShape=function(e,t){for(var n=THREE.Math.degToRad,i=Math.sin(n(17)),r=Math.sin(n(17)),o=Math.sqrt(1-i*i-r*r),s=new THREE.Vector3(-i,-r,o),a=new THREE.Vector3(i,-r,o),c=new THREE.Vector3(-i,r,o),u=new THREE.Vector3(i,r,o),l=new Float32Array([s.x,s.y,s.z,a.x,a.y,a.z,c.x,c.y,c.z,u.x,u.y,u.z,0,0,0]),h=new Uint32Array([4,1,0,4,3,1,4,2,3,4,0,2,0,1,3,0,3,2]),d=new Float32Array(3*h.length),p=0;p<h.length;p++){var g=h[p];d[3*p]=l[3*g],d[3*p+1]=l[3*g+1],d[3*p+2]=l[3*g+2]}var f=new THREE.BufferGeometry;f.setAttribute("position",new THREE.BufferAttribute(d,3)),f.computeVertexNormals();var v=new THREE.MeshPhongMaterial({color:5263615,transparent:!0,opacity:0,depthTest:!1,depthWrite:!1,blending:THREE.NoBlending}),y=new THREE.Mesh(f,v),m=new Uint32Array([4,0,4,1,4,3,4,2,0,1,1,3,3,2,2,0]),_=new THREE.BufferGeometry;_.setAttribute("index",new THREE.BufferAttribute(m,1)),_.setAttribute("position",new THREE.BufferAttribute(l,3)),_.isLines=!0;var E=new THREE.LineBasicMaterial({color:16777215,transparent:!0,side:THREE.DoubleSide,opacity:0,depthTest:!1,depthWrite:!1,blending:THREE.NoBlending}),A=new THREE.Mesh(_,E),x=new THREE.Scene;x.add(y),x.add(A),f.visible=!0,_.visible=!0,y.name="FrustumGizmo",x.scale.set(50,50,50),x.position.copy(e);var C=new THREE.Vector3(0,0,0),w=new THREE.Vector3(0,0,1),b=new THREE.Vector3(-t.x,-t.y,-t.z),M=(new THREE.Matrix4).lookAt(C,b,w);return x.rotation.setFromRotationMatrix(M),x.frustumCulled=!1,y.frustumCulled=!1,A.frustumCulled=!1,x.setFadeValue=function(e){v.opacity=.05*e,E.opacity=1*e},x}(e.cameraPos,e.dir),this.viewer.impl.addOverlay(jt,e.frustumShape),e.frustumShape.name=e.bubbleNode.name(),this.viewer.impl.updateCameraMatrices())}},{key:"hideFrustumShape",value:function(e){e.frustumShape&&(this.viewer.impl.removeOverlay(jt,e.frustumShape),e.frustumShape=null)}},{key:"setFrustumFadeValue",value:function(e,t){e.fadeValue=t,e.frustumShape&&e.frustumShape.setFadeValue(t)}},{key:"updateFrustumShapeFading",value:function(e,t){var n=e.hovered&&e.fadeValue<1,i=!e.hovered&&e.fadeValue>0;if(!n&&!i)return!1;var r=t/500,o=t/500,s=e.fadeValue+(n?r:-o);return s=THREE.Math.clamp(s,0,1),this.setFrustumFadeValue(e,s),e.marker&&e.marker._toolTipElement&&(e.marker._toolTipElement.style.opacity=Math.min(1,3*s)),e.hovered||0!==e.fadeValue||this.hideFrustumShape(e),this.viewer.impl.invalidate(!1,!1,!0),!0}},{key:"requestTimer",value:function(){var e=this,t=this.getWindow();this.timerId=t.requestAnimationFrame((function(){return e.onTimer()}))}},{key:"onTimer",value:function(){var e=this,t=performance.now(),n=t-this.lastTime;this.lastTime=t,this.isFrustumFading=!1,this.bookmarks.forEach((function(t){var i=e.updateFrustumShapeFading(t,n);e.isFrustumFading=e.isFrustumFading||i})),this.isAllDone()&&(this.waitingCallbacks.forEach((function(e){return e()})),this.waitingCallbacks.length=0),this.requestTimer()}},{key:"findSectionBox",value:function(e,t){var n=e.search({type:"view"});if(!n.length||n[0].data.name!==t)return null;var i=n[0].data.sectionBox,r=n[0].data.sectionBoxTransform;if(!i||!r)return null;var o=(new THREE.Matrix4).fromArray([r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15]]),s=new THREE.Box3;s.min.set(i[0],i[1],i[2]),s.max.set(i[3],i[4],i[5]),s.transform=new THREE.Matrix4;var a=this.getRelatedModelTransform(e);return a&&s.transform.multiply(a),s.transform.multiply(o),s}},{key:"setOverlaySceneVisible",value:function(e){var t=this.viewer.impl.overlayScenes[jt],n=t&&t.scene;n&&(n.visible=e)}},{key:"getFadeExtension",value:function(){return this.viewer.getExtension("Autodesk.CrossFadeEffects")}},{key:"showGhosting",value:function(){var e=this,t=this.getFadeExtension();t&&(t.acquireControl("CanvasBookmarks",(function(){return e.stopGhosting()})),this.ghostingActive?this.stopGhostFadeOut():(this.viewer.impl.setCutPlaneSet(zt),this.setOverlaySceneVisible(!1),t.renderFadingImage(0),this.applySectionBox(this.activeSectionBox),this.setOverlaySceneVisible(!0),this.ghostingActive=!0),t.setCrossFadeOpacity(0,.3))}},{key:"stopGhosting",value:function(){if(this.ghostingActive){this.stopGhostFadeOut();var e=this.getFadeExtension();e&&e.releaseFadingImage(0),this.ghostingActive=!1}}},{key:"stopGhostFadeOut",value:function(){this.ghostFadeAnim&&(this.ghostFadeAnim.skip(),this.ghostFadeAnim=null)}},{key:"fadeOutGhosting",value:function(){var e=this.getFadeExtension();if(this.ghostingActive&&e){var t=e.getCrossFadeOpacity(0);this.ghostFadeAnim=It.fadeValue(t,0,.5,(function(t){return e.setCrossFadeOpacity(0,t)}))}}},{key:"onBookmarkMouseEnter",value:function(e){var t=this.findSectionBox(e.bubbleNode,e.name);t&&(this.showGhosting(),this.animateToSectionBox(t)),this.showFrustumShape(e),e.hovered=!0}},{key:"onBookmarkMouseLeave",value:function(e){this.animateToSectionBox(null),this.fadeOutGhosting(),e.hovered=!1}},{key:"onClusteredBookmarkMouseEnter",value:function(e){e.hovered=!0}},{key:"onClusteredBookmarkMouseLeave",value:function(e){e.hovered=!1}},{key:"onClusteredBookmarkClicked",value:function(e){if(e.folded){for(var t=function(e,t,n){var i=Math.cos(n),r=Math.sin(n),o=e.x-t.x,s=e.y-t.y;e.x=o*i-s*r+t.x,e.y=o*r+s*i+t.y},n=e.cluster.length,i=Math.round(360/n),r=new THREE.Vector2(e.currentPosProjected.x,e.currentPosProjected.y),o=new THREE.Vector2(r.x,r.y+35),s=0;s<n;++s){var a=e.cluster[s],c=o.clone();t(c,r,s*i*Math.PI/180),a.currentPosProjected.x=c.x,a.currentPosProjected.y=c.y,a.marker.container.style.transform="translate(".concat(c.x,"px, ").concat(c.y,"px)"),Yt(a.marker,!0)}e.marker.container.classList.add("declustered-canvas-bookmark")}else e.cluster.forEach((function(e){Yt(e.marker,!1)})),e.marker.container.classList.remove("declustered-canvas-bookmark");e.folded=!e.folded}},{key:"debounceBookmarksVisibility",value:function(){this.changeBookmarksVisibilityTimeout&&clearTimeout(this.changeBookmarksVisibilityTimeout),this.changeBookmarksVisibilityTimeout=setTimeout(this.changeBookmarksVisibility,100)}},{key:"debounceResetBookmarks",value:function(){var e=this;this.resetBookmarksTimeout&&clearTimeout(this.resetBookmarksTimeout),this.resetBookmarksTimeout=setTimeout((function(){return e.resetBookmarks(e.bookmarkData)}),100)}},{key:"onModelTransformChanged",value:function(){this.onCameraMoved(),this.debounceResetBookmarks()}},{key:"changeBookmarksVisibility",value:function(){this.updateBookmarkPositions()}},{key:"updateBookmarkPositions",value:function(){var e=this;if(this.isVisible()){this.bookmarks.forEach((function(t){var n=t.bubbleNode.sectionBox,i=n?n.getCenter(new THREE.Vector3):t.pos;t.currentPos3D=i;var r=e.project(i);r.x-=t.anchorX,r.y-=t.anchorY,t.currentPosProjected=new THREE.Vector3(r.x,r.y,r.z),t.marker.container.style.transform="translate(".concat(r.x,"px, ").concat(r.y,"px)")}));var t=this._clusteringEnabled?this.hcluster.createClusters(this.bookmarks):[];this.updateClusteredBookmarks(t)}}},{key:"updateClusteredBookmarks",value:function(e){var t=this;this.clusteredBookmarks.forEach((function(e){t.deleteBookmark(e)})),this.clusteredBookmarks=[],this.bookmarks.forEach((function(e){Yt(e.marker,!1)}));var n=this._getFloorSelector();if(void 0===(n&&n.currentFloor)){this.bookmarks.filter(this._filterOutInvisibleBookmark).forEach((function(e){e.clustered=!1,Yt(e.marker,!0)}));for(var i=0;i<e.length;i++){var r=e[i];r.size>1&&function(){var e=mt.FlattenCluster(r),n=!1;e.forEach((function(e){e.clustered=!0,!n&&e.marker.isVisible()&&(n=!0),Yt(e.marker,!1)})),t.createClusteredBookmark(e,"c-".concat(e[0].bubbleNode.data.viewableID),n)}()}}}},{key:"project",value:function(e){var t=this.viewer.navigation.getScreenViewport(),n=(new THREE.Vector3).copy(e),i=new THREE.Matrix4;return i.multiplyMatrices(this.camera.projectionMatrix,this.camera.matrixWorldInverse),n.applyProjection(i),new THREE.Vector3(Math.round((n.x+1)/2*t.width),Math.round((1-n.y)/2*t.height),n.z)}},{key:"load",value:function(){this.viewer.prefs.add(Ft,!0),this.viewer.addEventListener(Dt.CAMERA_CHANGE_EVENT,this.cameraMovedCB),this.viewer.addEventListener(Dt.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged);var e=this._getFloorSelector();return e&&e.addEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.levelChangedCB),this.viewer.addEventListener(Dt.EXTENSION_LOADED_EVENT,this.extensionLoadedCB),this.updateBookmarkPositions(),this.viewer.impl.createOverlayScene(jt),this.lastTime=performance.now(),this.requestTimer(),this.updateSettingsPanel||(this.updateSettingsPanel=this.configureSettings.bind(this),this.viewer.addEventListener(Dt.SETTINGS_PANEL_CREATED_EVENT,this.updateSettingsPanel)),!0}},{key:"unload",value:function(){this.clearBookmarks(),this.viewer.impl.removeOverlayScene(jt),this.viewer.removeEventListener(Dt.CAMERA_CHANGE_EVENT,this.cameraMovedCB),this.viewer.removeEventListener(Dt.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged);var e=this._getFloorSelector();return e&&e.removeEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.levelChangedCB),this.viewer.removeEventListener(Dt.EXTENSION_LOADED_EVENT,this.extensionLoadedCB),this.timerId&&(this.getWindow().cancelAnimationFrame(this.timerId),this.timerId=null),this.updateSettingsPanel&&(this.viewer.removeEventListener(Dt.SETTINGS_PANEL_CREATED_EVENT,this.updateSettingsPanel),this.updateSettingsPanel=null),!0}},{key:"applySectionBox",value:function(e){if(this.activeSectionBox=e,e){var t=It.SceneMath.box2CutPlanes(e,e.transform);this.viewer.impl.setCutPlaneSet(zt,t)}else this.viewer.impl.setCutPlaneSet(zt)}},{key:"getModelBox",value:function(){for(var e=this.viewer.impl.modelQueue().getModels(),t=new THREE.Box3,n=0;n<e.length;n++)t.union(e[n].getBoundingBox());return t}},{key:"stopSectionBoxAnim",value:function(){this.sectionBoxAnim&&(this.sectionBoxAnim.stop(),this.sectionBoxAnim=null)}},{key:"animateToSectionBox",value:function(e){var t=this;if(e||this.activeSectionBox){this.stopSectionBoxAnim(),this.animStartBox=this.activeSectionBox?Gt(this.activeSectionBox):Gt(this.getModelBox()),this.animEndBox=Gt(e||this.getModelBox()),this.sectionBox=e;var n=new THREE.Box3;n.transform=new THREE.Matrix4,this.sectionBoxAnim=It.fadeValue(0,1,.5,(function(e){e=It.smootherStep(e),function(e,t,n,i){i.min.lerpVectors(e.min,t.min,n),i.max.lerpVectors(e.max,t.max,n),Ut(e.transform,t.transform,n,i.transform)}(t.animStartBox,t.animEndBox,e,n),t.applySectionBox(n)}),(function(){t.applySectionBox(t.sectionBox),t.sectionBoxAnim=null}))}}},{key:"enableClustering",value:function(e){this._clusteringEnabled!==e&&(this._clusteringEnabled=e,this.updateClusteredBookmarks([]))}},{key:"setClusteringThreshold",value:function(e){this._clusteringThreshold!==e&&(this._clusteringThreshold=e,this.hcluster.setThreshold(e),this.updateClusteredBookmarks([]))}},{key:"isAllDone",value:function(){var e=this.sectionBoxAnim&&this.sectionBoxAnim.isRunning,t=this.bookmarks.some((function(e){return e.marker&&e.marker.visiblityChangePending}));return!e&&!this.isFrustumFading&&!t}},{key:"waitForAllDone",value:function(){var e=this;return this.onTimer(),this.isAllDone()?Promise.resolve():new Promise((function(t){e.waitingCallbacks.push(t)}))}},{key:"_filterOutInvisibleBookmark",value:function(e){var t=this.viewer.navigation.getScreenViewport();if(e.currentPosProjected.x<0||e.currentPosProjected.x>t.width)return!1;if(e.currentPosProjected.y<0||e.currentPosProjected.y>t.height)return!1;var n=this.camera.target.clone().sub(this.camera.position),i=e.pos.clone().sub(this.camera.position);return n.dot(i)>0}},{key:"onLevelChanged",value:function(){this.updateBookmarkPositions()}},{key:"onExtensionLoaded",value:function(e){e.extensionId===Bt&&this.updateBookmarkPositions()}},{key:"configureSettings",value:function(){if(this.viewer.getSettingsPanel){var e=this.viewer.getSettingsPanel(!0);if(e.is3dMode){var t=Dt.Extensions.ViewerSettingTab.Navigation;e.addLabel(t,"Location Icons"),e&&!e.showLocationIconsChkBoxId&&(e.showLocationIconsChkBoxId=e.addCheckbox(t,"Show location icons","Toggles availability of the location icons when looking at the project model",!0,this.onVisibilityChangedCB,Ft))}}}},{key:"_getFloorSelector",value:function(){var e=this.viewer.getExtension(Bt);return e&&e.floorSelector}}],n&&Et(t.prototype,n),s}(Dt.Extension);function Ht(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}kt.CanvasBookmarkExtension=Wt,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.AEC.CanvasBookmarkExtension",Wt);var Kt=Autodesk.Viewing,qt=Kt.Private.analytics,Qt=Kt.GlobalManagerMixin,Zt="Autodesk.AEC.LevelsExtension",Jt=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parent=t,this.viewer=t.viewer,this.setGlobalManager(this.viewer.globalManager),this.dropdownWrapper=null,this.parentContainer=t.mapWidgetHeader,this.onClickOptionHandler=this.onClickOption.bind(this),this.createWrapper(50);var i=this.getFloorDataFromLevelExtension();this.createDropdown(i),0===i.length&&this.dropdownWrapper.classList.add("hidden"),this.onLevelChanged=this.onLevelChanged.bind(this),this.viewer.addEventListener(Autodesk.AEC.LevelsExtension.LEVEL_CHANGED,this.onLevelChanged),this.viewer.getExtensionAsync(Zt).then((function(e){e.floorSelector.addEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,n.onLevelChanged),n.onLevelChanged()}))}var t,n;return t=e,(n=[{key:"createWrapper",value:function(e){var t=this.getDocument().createElement("div");t.classList.add("minimap-dropdown-wrapper"),t.id="minimap-dropdown-wrapper",t.style.height=e,this.parent.expandButton||(t.style.paddingLeft="14px"),this.parentContainer.appendChild(t),this.dropdownWrapper=t}},{key:"createDropdown",value:function(e){var t=this,n=this.getDocument();this.titleElement=n.createElement("div"),this.titleElement.classList.add("minimap-title"),this.dropdownWrapper.appendChild(this.titleElement),this.createDropdownOptions(e),this.dropdownWrapper.addEventListener("click",(function(e){t.dropdownElement.classList.toggle("active"),e.stopPropagation()}))}},{key:"onClickOption",value:function(e){var t=this.getDocument();this.titleElement.id=e.target.id,this.viewer.getExtension("Autodesk.BimWalk").jumpToFloor(e.target.id);var n=t.createEvent("Event");n.initEvent("change",!0,!0),qt.track("viewer.3d_minimap.levels"),this.titleElement.dispatchEvent(n),Array.from(this.dropdownElement.children).forEach((function(e){return e.classList.remove("active")})),this.dropdownWrapper.classList.toggle("active"),e.target.classList.toggle("active")}},{key:"createDropdownOptions",value:function(e){var t=this.getDocument();this.dropdownElement&&this.dropdownWrapper.removeChild(this.dropdownElement),this.dropdownElement=t.createElement("ul"),this.dropdownElement.classList.add("minimap-dropdown"),this.dropdownElement.id="minimap-dropdown",this.dropdownWrapper.appendChild(this.dropdownElement);for(var n=e.length-1;n>=0;n--)this.createNewOption(e[n].name,n)}},{key:"createNewOption",value:function(e,t){var n=this.getDocument(),i=n.createElement("li");i.appendChild(n.createTextNode(e)),i.setAttribute("id",t),i.onclick=this.onClickOptionHandler,this.dropdownElement.appendChild(i)}},{key:"onLevelChanged",value:function(){var e=this.viewer.getExtension(Zt).getCurrentLevel();if(e){var t=this.getFloorDataFromLevelExtension();this.update(e.index,t)}}},{key:"getFloorDataFromLevelExtension",value:function(){var e,t=this.viewer.getExtension(Zt);return(null==t||null===(e=t.floorSelector)||void 0===e?void 0:e.floorData)?t.floorSelector.floorData:[]}},{key:"update",value:function(e,t){if(0===t.length?this.dropdownWrapper.classList.add("hidden"):this.dropdownWrapper.classList.remove("hidden"),this.createDropdownOptions(t),e>=0&&t[e]){var n=t[e];this.dropdownWrapper.style.display="flex",this.setSelectedValue(n.name),Array.from(this.dropdownElement.children).forEach((function(e){e.classList.remove("active"),e.textContent===n.name&&e.classList.add("active")}))}}},{key:"setSelectedValue",value:function(e){this.titleElement.textContent=e}},{key:"dtor",value:function(){var e;this.viewer.removeEventListener(Autodesk.AEC.LevelsExtension.LEVEL_CHANGED,this.onLevelChanged);var t=this.viewer.getExtension(Zt);null==t||null===(e=t.floorSelector)||void 0===e||e.removeEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.onLevelChanged),this.dropdownWrapper.parentNode.removeChild(this.dropdownWrapper),this.dropdownWrapper=null}}])&&Ht(t.prototype,n),e}();Qt.call(Jt.prototype);const Xt=function(e,t){e.container.style.width="20px",e.container.style.height="20px",e.container.style.padding="3px 8px",e.icon.classList.remove("adsk-button-icon"),e.setToolTip("");var n=e._toolTipElement.style;n.bottom="0px",n.top="auto",n.height="fit-content",t?(n.left="auto",n.right="130%"):n.top="40px",n.zIndex=3};var $t=['<svg viewBox="2 2 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">','<path d="M20 10V17C20 17.5523 19.5523 18 19 18H5C4.44772 18 4 17.5523 4 17V7C4 6.44772 4.44772 6 5 6H16M20 10L16 6M20 10H17C16.4477 10 16 9.55228 16 9V6" stroke="currentColor"/>','<path d="M13 9H7V15.5H12V13" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>','<path d="M11.5 15.5H16V12" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>','<path d="M10 9V11.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>',"</svg>"].join(""),en=['<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">','<rect width="24" height="24" fill="none"/>','<rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.5"/>','<rect x="13.5" y="7.5" width="5" height="9" rx="0.5" fill="currentColor" stroke="currentColor"/>',"</svg>"].join(""),tn=['<svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">','<rect width="24" height="24" fill="none"/>','<rect x="3" y="5" width="18" height="14" rx="2" stroke="currentColor" stroke-width="1.5"/>','<rect x="13.5" y="7.5" width="5" height="3.16667" rx="0.5" fill="currentColor" stroke="currentColor"/>',"</svg>"].join("");function nn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var rn=Autodesk.Viewing,on=rn.UI,sn=rn.GlobalManagerMixin,an=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parent=t,this.parentElement=t.mapWidgetHeader,this.setGlobalManager(t.viewer.globalManager),this.sideBySideButton=new on.Button("Minimap_SideBySide"),this.sideBySideButton.setGlobalManager(this.globalManager),this.sideBySideButton.onClick=function(){return t.setSideBySideEnabled(!t.sideBySideEnabled)},this.sideBySideButton.icon.innerHTML=en,this.sideBySideButton.icon.style.width="20px",this.sideBySideButton.icon.style.height="20px",this.parentElement.appendChild(this.sideBySideButton.container);var n=this.getDocument();this.shrinkIcon=n.createElement("div"),this.shrinkIcon.innerHTML=tn,this.shrinkIcon.style.width="20px",this.shrinkIcon.style.height="20px",this.sideBySideButton.container.appendChild(this.shrinkIcon),Xt(this.sideBySideButton,!0),this.update()}var t,n;return t=e,(n=[{key:"setSideBySideButtonDisabled",value:function(e){this.sideBySideButtonDisabled=e}},{key:"update",value:function(){var e=this.parent.sideBySideEnabled;this.shrinkIcon.style.display=e?"block":"none",this.sideBySideButton.icon.style.display=e?"none":"block",this.sideBySideButton.setState(this.sideBySideButtonDisabled?on.Button.State.DISABLED:on.Button.State.INACTIVE);var t=Autodesk.Viewing.i18n.translate("Side by side"),n=Autodesk.Viewing.i18n.translate("Small map");this.sideBySideButton.setToolTip(e?n:t)}},{key:"dtor",value:function(){this.parentElement.removeChild(this.sideBySideButton.container),this.sideBySideButton=null,this.shrinkIcon=null}}])&&nn(t.prototype,n),e}();function cn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}sn.call(an.prototype);var un=Autodesk.Viewing,ln=un.UI,hn=un.GlobalManagerMixin,dn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.parent=t,this.parentElement=t.mapWidgetHeader,this.viewer=t.viewer,this.setGlobalManager(t.viewer.globalManager),this.expandButton=new ln.Button("Minimap_Expand"),this.expandButton.setGlobalManager(this.globalManager),this.expandButton.onClick=function(){return t.minimap3DExtension.expandSheetMap()},this.expandButton.icon.innerHTML=$t,this.expandButton.icon.style.width="20px",this.expandButton.icon.style.height="20px",this.parentElement.appendChild(this.expandButton.container),Xt(this.expandButton,!1),this.update()}var t,n;return t=e,(n=[{key:"update",value:function(){this.expandButton.setState(this.parent.minimap3DExtension.isSheetVisible()?ln.Button.State.INACTIVE:ln.Button.State.DISABLED);var e=Autodesk.Viewing.i18n.translate("Go to 2D");this.expandButton.setToolTip(e)}},{key:"dtor",value:function(){this.viewer=null}}])&&cn(t.prototype,n),e}();hn.call(dn.prototype);var pn=null,gn=function(e,t,n,i,r){var o=THREE.Box3.prototype.getCenter.call(t,new THREE.Vector3);e.position.copy(o),e.position.z=i,e.target.copy(e.position),e.target.z-=r,e.isPerspective=!1,e.up.set(0,1,0),e.worldup.set(0,1,0),e.near=0,e.far=i-n,e.updateCameraMatrices()},fn=function(e,t,n){var i=Math.cos(n),r=Math.sin(n),o=e.x-t.x,s=e.y-t.y;e.x=o*i-s*r+t.x,e.y=o*r+s*i+t.y},vn=function(e){var t=e.getSize(new THREE.Vector2),n=e.getCenter(new THREE.Vector2),i=.5*Math.max(t.x,t.y);e.min.set(n.x-i,n.y-i),e.max.set(n.x+i,n.y+i)},yn=function(e,t){var n=t.max.x-t.min.x,i=t.max.y-t.min.y;e.x-=t.min.x,e.y-=t.min.y,e.x/=n,e.y/=i},mn=function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.atan2(i,n)+Math.PI/2};function _n(e,t){var n=e.viewportBounds.getSize(new THREE.Vector3);return function(e,t,n,i){var r=e.clone().applyProjection(t);return new THREE.Vector2((r.x+1)/2*n,(1-r.y)/2*i)}(t,e.mapMatrix,n.x,n.y)}function En(e,t,n,i){var r=e.viewportBounds.getSize(new THREE.Vector3);return function(e,t,n,i,r,o){var s=e/r*2-1,a=t/o*2-1,c=new THREE.Vector3(s,-a,0).applyProjection(i);return c.z=n,c}(t,n,i,e.mapMatrixInv,r.x,r.y)}function An(e,t){t.y=e.viewportBounds.getSize(new THREE.Vector3).y-t.y;var n=e.viewportBounds.min;t.x+=n.x,t.y+=n.y}var xn=.001;function Cn(e,t,n,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=n.x,s=n.y;r||(o-=.5,s-=.5);var a=t.clientToWorld(o,s,void 0,!0);n.copy(a.point);var c=e.viewportBounds.min;if(n.x-=c.x,n.y-=c.y,n.y=e.viewportBounds.getSize(new THREE.Vector3).y-n.y,i){var u=e.viewportBounds.getSize(new THREE.Vector3);n.x=THREE.Math.clamp(n.x,xn,u.x-xn),n.y=THREE.Math.clamp(n.y,xn,u.y-xn)}}function wn(e){var t=e.navigation.getCameraUpVector();return Math.atan2(t.y,t.x)-.5*Math.PI}var bn={MAIN_MAP_CHANGED_EVENT:"mapChanged",CHANGING_SHEET_EVENT:"changingSheet",SHEET_VISIBILITY_CHANGED_EVENT:"sheetVisibilityChanged"},Mn=.7;function Tn(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function Vn(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Tn(o,i,r,s,a,"next",e)}function a(e){Tn(o,i,r,s,a,"throw",e)}s(void 0)}))}}function Sn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Rn=Autodesk.Viewing,Ln=400,Pn=1500,On=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.0254;vn(e);var i=t.getViewportBounds(n).clone();return yn(i.min,e),yn(i.max,e),i},Dn=function(){function e(t,n,i){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.sheetMapConfig=t,this.viewer=n,this.thumbnailImage=null,this.thumbnailRefined=!1,this.onThumbnailReady=i,this.img=new Image,this.img.onload=Vn(regeneratorRuntime.mark((function e(){var t,n,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.sheetMapConfig.getSheetNode();case 2:if(t=e.sent,n=t.search({type:"view"})[0]){e.next=6;break}return e.abrupt("return");case 6:i=n.getViewBox(),(o=new THREE.Box2).min.set(i[0],i[1]),o.max.set(i[2],i[3]),s=On(o,r.sheetMapConfig.viewport),r.cropThumbnail(r.img,s);case 12:case"end":return e.stop()}}),e)})))}var t,n,i;return t=e,n=[{key:"cropThumbnail",value:function(e,t){var n=this,i=function(e,t){var n=Rn.getGlobal().document.createElement("canvas"),i=n.getContext("2d"),r=t.max.x-t.min.x,o=t.max.y-t.min.y,s=r*e.width,a=o*e.height;n.width=s,n.height=a,i.drawImage(e,t.min.x*e.width,(1-t.max.y)*e.height,s,a,0,0,s,a);var c=new Image;return c.src=n.toDataURL(),c}(e,t);i.onload=function(){n.thumbnailImage=i,n.onThumbnailReady(n.sheetMapConfig)}}},{key:"onThumbnailDownloaded",value:function(e){this.thumbnailRefined||(this.img.src=e)}},{key:"requestThumbnail",value:(i=Vn(regeneratorRuntime.mark((function e(){var t,n,i,r,o,s,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sheetMapConfig.getSheetNode();case 2:t=e.sent,n=t.getRootNode(),i=n.getDocument(),r=i.getThumbnailOptions(t.data,Ln,Ln),t.data.thumbnailUrn?(r.urn=t.getDocument().getFullPath(t.data.thumbnailUrn),r.responseType="blob",Autodesk.Viewing.Private.ViewingService.getThumbnail(Autodesk.Viewing.initLoadContext(),r.urn,(function(e){var t=new FileReader;t.onload=function(e){a.onThumbnailDownloaded(e.target.result)},t.readAsDataURL(e)}),(function(e){console.warn("Failed to load sheet thumbnail. Error: ".concat(e,", Urn: ").concat(r.urn,", SheetName: ").concat(t.name()))}),r)):Autodesk.Viewing.endpoint.getUseCookie()?(o=i.getThumbnailPath(t.data,Ln,Ln),this.onThumbnailDownloaded(o)):(s=function(e,n){if(e)console.warn("Failed to load sheet thumbnail. Error: ".concat(e,", Urn: ").concat(r.urn,", SheetName: ").concat(t.name()));else{var i=Rn.getGlobal().URL.createObjectURL(n);a.onThumbnailDownloaded(i)}},Autodesk.Viewing.Document.requestThumbnailWithSecurity(r,s));case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"refineThumbnail",value:function(){var e=this;if(!this.thumbnailRefined){this.thumbnailRefined=!0;var t=this.viewer.model.getBoundingBox(!0),n=new Autodesk.Viewing.UnifiedCamera(Pn,Pn);n.setViewFromBox(t,!0);var i={camera:n};this.viewer.impl.getScreenShotProgressive(Pn,Pn,(function(n){e.img.src=n,e.img.onload=function(){var n=On(t,e.sheetMapConfig.viewport,e.viewer.model.getUnitScale());e.cropThumbnail(e.img,n)}}),i)}}}],n&&Sn(t.prototype,n),e}();function In(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Nn="thumbnail-overlay-scene",kn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.sheetSyncExt=n,this.planeGeometry=new THREE.PlaneBufferGeometry(1,1),this.viewer.impl.createOverlayScene(Nn),this.createThumbnailMesh=this.createThumbnailMesh.bind(this)}var t,n;return t=e,n=[{key:"createThumbnailMesh",value:function(e){if(this.viewer){var t=e.thumbnail.mesh;if(!t){var n=new THREE.MeshBasicMaterial({opacity:0,transparent:!0});t=new THREE.Mesh(this.planeGeometry,n),this.setMeshTransform(t,e),e.thumbnail.mesh=t;var i=new THREE.Texture;i.minFilter=THREE.LinearFilter,t.material.map=i}t.material.map.image=e.thumbnail.thumbnailImage,t.material.map.needsUpdate=!0,this.update()}}},{key:"setMeshTransform",value:function(e,t){var n=En(t,t.viewportBounds.min.x,t.viewportBounds.min.y,0),i=En(t,t.viewportBounds.max.x,t.viewportBounds.max.y,0),r=En(t,t.viewportBounds.max.x,t.viewportBounds.min.y,0),o=Math.atan2(r.y-n.y,r.x-n.x),s=(new THREE.Box3).setFromPoints([n,i]),a=s.getCenter(new THREE.Vector3);fn(n,a,-o),fn(i,a,-o),s.setFromPoints([n,i]);var c=s.getSize(new THREE.Vector3),u=t.viewportBounds.getSize(new THREE.Vector3),l=En(t,u.x/2,u.y/2,this.viewer.getCamera().position.z-1e-4);e.position.copy(l),e.rotation.set(0,0,o),e.scale.set(c.x,c.y,1),e.dirty=!1}},{key:"showThumbnail",value:function(e){e&&e.mesh&&-1===this.viewer.impl.overlayScenes[Nn].scene.children.indexOf(e.mesh)&&(this.viewer.impl.addOverlay(Nn,e.mesh),this.animateOpacity(e,.5))}},{key:"hideThumbnail",value:function(e,t){var n=this;e&&e.mesh&&-1!==this.viewer.impl.overlayScenes[Nn].scene.children.indexOf(e.mesh)&&(t?(this.viewer.impl.removeOverlay(Nn,e.mesh),e.mesh.material.opacity=0):this.animateOpacity(e,0,(function(){n.viewer.impl.removeOverlay(Nn,e.mesh)})))}},{key:"animateOpacity",value:function(e,t,n){var i=this;if(e.fadeAnim){if(e.fadeAnim.targetValue===t)return;e.fadeAnim.stop(),e.fadeAnim=null}var r=e.mesh.material.opacity;e.fadeAnim=Autodesk.Viewing.Private.fadeValue(0,1,Mn,(function(n){if(i.viewer){n=Autodesk.Viewing.Private.smootherStep(n);var o=Autodesk.Viewing.Private.lerp(r,t,n);i.setThumbnailOpacity(e,o)}}),(function(){e.fadeAnim=null,n&&n()})),e.fadeAnim.targetValue=t}},{key:"setThumbnailOpacity",value:function(e,t){e.mesh.material.opacity!==t&&(e.mesh.material.opacity=t,this.viewer.impl.invalidate(!1,!1,!0))}},{key:"requestThumbnailDebounce",value:function(e){var t=this;this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout((function(){t.sheetSyncExt&&(e.thumbnail=new Dn(e,t.sheetSyncExt.viewer,t.createThumbnailMesh),t.tryRefineThumbnail(e)||e.thumbnail.requestThumbnail())}),300)}},{key:"tryRefineThumbnail",value:function(e){return!(!this.sheetSyncExt.isSheetMapLoaded(e)||!this.sheetSyncExt.viewer.model.isLoadDone(!0)||.8!==this.sheetSyncExt.viewer.model.opacity||(e.thumbnail.refineThumbnail(),0))}},{key:"update",value:function(){var e=this,t=this.sheetSyncExt.mapCache,n=this.sheetSyncExt.getCurrentLevel();if(n){var i=this.sheetSyncExt.getShowSheet();Object.keys(t).forEach((function(r){var o=t[r],s=r===n.guid;o.forEach((function(t){var o,a,c=s&&i&&!e.sheetSyncExt.isCameraInsideMap(t);s&&(t.thumbnail?t.thumbnail.thumbnailRefined||e.tryRefineThumbnail(t):e.requestThumbnailDebounce(t)),(null===(o=t.thumbnail)||void 0===o||null===(a=o.mesh)||void 0===a?void 0:a.dirty)&&e.setMeshTransform(t.thumbnail.mesh,t),c?e.showThumbnail(t.thumbnail):e.hideThumbnail(t.thumbnail,r!==n.guid)}))}))}}},{key:"destroy",value:function(){this.planeGeometry.dispose(),this.planeGeometry=null,this.viewer.impl.removeOverlayScene(Nn),this.sheetSyncExt=null,this.viewer=null}}],n&&In(t.prototype,n),e}();function Bn(e){return Bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bn(e)}function Fn(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function jn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function zn(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Un(e,t){return Un=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Un(e,t)}function Gn(e,t){return!t||"object"!==Bn(t)&&"function"!=typeof t?Yn(e):t}function Yn(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wn(e){return Wn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Wn(e)}var Hn=Autodesk.Viewing,Kn=Hn.ProgressState,qn=AutodeskNamespace("Autodesk.AEC"),Qn=new THREE.Vector3,Zn=new THREE.Vector2,Jn=new THREE.Box3,Xn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Un(e,t)}(l,Autodesk.Viewing.Extension);var t,i,r,o,s,a,c,u=(a=l,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Wn(a);if(c){var n=Wn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Gn(this,e)});function l(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return jn(this,l),(t=u.call(this,e,n)).options=t.options.topViewRendererOptions||t.options,t.isModelLoadingMap={},t.waitBeforeRotation=1,t.rotationDuration=2,t.onBeginScene=t.onBeginScene.bind(Yn(t)),t.update=t.update.bind(Yn(t)),t.onMainMapChanged=t.onMainMapChanged.bind(Yn(t)),t.onResize=t.onResize.bind(Yn(t)),t.rotateToSheet=t.rotateToSheet.bind(Yn(t)),t.onSheetGeometryLoaded=t.onSheetGeometryLoaded.bind(Yn(t)),t.pendingFinishedCallbacks=[],t}return t=l,i=[{key:"load",value:(o=regeneratorRuntime.mark((function e(){var t,i,r,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.AEC.SheetSyncExtension",this.viewer.config);case 2:this.sheetSyncExt=e.sent,this.targetViewer=this.sheetSyncExt.targetViewer,this.initTopViewViewer(),this.options.minimapDebugMode?(t=n(76820).Z,this.nearFarOverlay=new t(this.topViewViewer,this.targetViewer),i=this.topViewViewer.impl.modelQueue(),r=i.reset.bind(i),i.reset=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0]=o.targetViewer.getCamera(),r.apply(void 0,t)}):this.thumbnailsOverlay=new kn(this.topViewViewer,this.sheetSyncExt),this.addListeners();case 7:case"end":return e.stop()}}),e,this)})),s=function(){var e=this,t=arguments;return new Promise((function(n,i){var r=o.apply(e,t);function s(e){Fn(r,n,i,s,a,"next",e)}function a(e){Fn(r,n,i,s,a,"throw",e)}s(void 0)}))},function(){return s.apply(this,arguments)})},{key:"initTopViewViewer",value:function(){var e,t=this.viewer.container,n=this.targetViewer.sharedResources,i={};(null===(e=this.targetViewer.config)||void 0===e?void 0:e.profileSettings)&&(i.profileSettings=Object.assign({},this.targetViewer.config.profileSettings)),n?this.topViewViewer=Autodesk.Viewing.createLeechViewer(t,i,n,Autodesk.Viewing.Viewer3D):(console.warn("TopViewRenderer - It is highly recommended using LeechViewer as your target viewer when using this extension."),this.topViewViewer=new Autodesk.Viewing.Viewer3D(t,i)),this.viewer.container.insertBefore(this.topViewViewer.container,this.viewer.container.firstChild),this.topViewViewer.container.style.zIndex=-1,this.topViewViewer.container.style.pointerEvents="none",this.topViewViewer.container.style.transition="opacity 0.7s",this.topViewViewer.container.style.backgroundColor="transparent",this.topViewViewer.start(void 0,void 0,void 0,void 0,{webglInitParams:{alpha:!0}}),this.topViewViewer.impl.skipCameraUpdate=!0,this.topViewViewer.setBackgroundOpacity(0),this.backgroundColorBackup=this.viewer.container.style.backgroundColor,this.viewer.container.style.backgroundColor="transparent",this.backgroundOpacityBackup=this.viewer.impl.glrenderer().getClearAlpha(),this.viewer.setBackgroundOpacity(0),l.isSheetMapSupported()||(this.viewer.canvasWrap.style.opacity=0)}},{key:"destroyTopViewViewer",value:function(){this.topViewViewer&&(this.topViewViewer.finish(),this.topViewViewer=null,this.viewer.container.style.backgroundColor=this.backgroundColorBackup,this.viewer.setBackgroundOpacity(this.backgroundOpacityBackup),l.isSheetMapSupported()||(this.viewer.canvasWrap.style.opacity=1))}},{key:"unload",value:function(){return this.removeListeners(),this.thumbnailsOverlay&&(this.thumbnailsOverlay.destroy(),this.thumbnailsOverlay=null),this.nearFarOverlay&&(this.nearFarOverlay.destroy(),this.nearFarOverlay=null),this.destroyTopViewViewer(),this.rotationAnim&&(this.rotationAnim.stop(),this.rotationAnim=null),this.rotationTimeout&&clearTimeout(this.rotationTimeout),this.viewer=null,this.targetViewer=null,this.sheetSyncExt=null,this.pendingFinishedCallbacks=[],!0}},{key:"addListeners",value:function(){this.targetViewer.addEventListener(Hn.NAVIGATION_MODE_CHANGED_EVENT,this.update),this.targetViewer.addEventListener(Hn.MODEL_ADDED_EVENT,this.update),this.targetViewer.addEventListener(Hn.MODEL_REMOVED_EVENT,this.update),this.targetViewer.addEventListener(Autodesk.AEC.LevelsExtension.LEVEL_CHANGED,this.update),this.viewer.addEventListener(Hn.PROGRESS_UPDATE_EVENT,this.onBeginScene),this.viewer.addEventListener(Hn.RENDER_SCENE_PART,this.update),this.viewer.addEventListener(Hn.VIEWER_RESIZE_EVENT,this.onResize),this.viewer.addEventListener(bn.MAIN_MAP_CHANGED_EVENT,this.onMainMapChanged),this.viewer.addEventListener(Hn.GEOMETRY_LOADED_EVENT,this.onSheetGeometryLoaded),this.topViewViewer.addEventListener(Hn.MODEL_ADDED_EVENT,this.update);var e=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension");e&&e.floorSelector&&e.floorSelector.addEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.update),this.options.minimapDebugMode&&this.targetViewer.addEventListener(Hn.PROGRESS_UPDATE_EVENT,this.onBeginScene)}},{key:"removeListeners",value:function(){this.targetViewer.removeEventListener(Hn.NAVIGATION_MODE_CHANGED_EVENT,this.update),this.targetViewer.removeEventListener(Hn.MODEL_ADDED_EVENT,this.update),this.targetViewer.removeEventListener(Hn.MODEL_REMOVED_EVENT,this.update),this.targetViewer.removeEventListener(Autodesk.AEC.LevelsExtension.LEVEL_CHANGED,this.update),this.viewer.removeEventListener(Hn.PROGRESS_UPDATE_EVENT,this.onBeginScene),this.viewer.removeEventListener(Hn.RENDER_SCENE_PART,this.update),this.viewer.removeEventListener(Hn.VIEWER_RESIZE_EVENT,this.onResize),this.viewer.removeEventListener(bn.MAIN_MAP_CHANGED_EVENT,this.onMainMapChanged),this.viewer.removeEventListener(Hn.GEOMETRY_LOADED_EVENT,this.onSheetGeometryLoaded),this.topViewViewer.removeEventListener(Hn.MODEL_ADDED_EVENT,this.update);var e=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension");e&&e.floorSelector&&e.floorSelector.removeEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.update),this.options.minimapDebugMode&&this.targetViewer.removeEventListener(Hn.PROGRESS_UPDATE_EVENT,this.onBeginScene)}},{key:"onResize",value:function(e){var t=e.width,n=e.height;this.topViewViewer.impl.resize(t,n,!0),this.update()}},{key:"onMainMapChanged",value:function(){this.syncCamera(),this.update(),this.validateRotation()}},{key:"onSheetGeometryLoaded",value:function(){this.validateRotation()}},{key:"validateRotation",value:function(){this.rotationTimeout&&clearTimeout(this.rotationTimeout),this.rotationTimeout=setTimeout(this.rotateToSheet,1e3*this.waitBeforeRotation)}},{key:"isDraggingAvatar",value:function(){var e=this.viewer.getExtension("Autodesk.AEC.AvatarExtension");return!e||!e.avatarWidget||e.avatarWidget.isDragging()}},{key:"rotateToSheet",value:function(){var e=this;if(this.viewer&&this.sheetSyncExt.getShowSheet())if(this.rotationAnim&&(this.rotationAnim.stop(),this.rotationAnim=null),this.isDraggingAvatar())this.validateRotation();else{var t=wn(this.viewer);t<-Math.PI?t+=2*Math.PI:t>Math.PI&&(t-=2*Math.PI),0!==t&&(this.rotationAnim=Autodesk.Viewing.Private.fadeValue(0,1,this.rotationDuration,(function(n){n=Autodesk.Viewing.Private.smootherStep(n);var i=t*(1-n),r=e.viewer.getCamera();r.up.set(0,1,0),fn(r.up,Qn,i),r.dirty=!0,r.updateCameraMatrices()}),(function(){e.rotationAnim=null,e.pendingFinishedCallbacks.forEach((function(e){return e()})),e.pendingFinishedCallbacks=[]})))}}},{key:"waitForRotationDone",value:function(){var e=this;return new Promise((function(t){if(!e.rotationAnim)return t();e.pendingFinishedCallbacks.push(t)}))}},{key:"onBeginScene",value:function(e){var t=e.percent,n=e.state;0===t&&n===Kn.RENDERING&&this.update()}},{key:"syncCamera",value:function(){if(this.sheetSyncExt&&this.sheetSyncExt.sheetMap&&this.viewer.model&&this.worldBoundingBox){var e=this.viewer.getCamera(),t=this.sheetSyncExt.sheetMap,n=En(t,t.viewportBounds.min.x,t.viewportBounds.min.y,0),i=En(t,t.viewportBounds.max.x,t.viewportBounds.min.y,0),r=Math.atan2(i.y-n.y,i.x-n.x),o=this.worldBoundingBox.getCenter(new THREE.Vector3);fn(this.worldBoundingBox.min,o,r),fn(this.worldBoundingBox.max,o,r);var s=_n(t,this.worldBoundingBox.min.clone()),a=_n(t,new THREE.Vector3(this.worldBoundingBox.min.x,this.worldBoundingBox.max.y,0)),c=_n(t,this.worldBoundingBox.max.clone());s.z=0,a.z=0,c.z=0,An(t,s),An(t,c),An(t,a),Jn.setFromPoints([s,c]),e.setViewFromBox(Jn,!0);var u=wn(this.topViewViewer);fn(e.up,Qn,u-r),e.dirty=!0,e.updateCameraMatrices(),this.viewer.impl.invalidate(!0),this.rotationAnim&&this.rotateToSheet()}}},{key:"updateTopViewViewerCamera",value:function(){if(this.viewer.model){var e=this.sheetSyncExt.getCurrentLevel(),t=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension"),n=e?t.getZRange(e.index).zMax:1/0,i=this.viewer.impl.renderer(),r=i.settings.logicalWidth,o=i.settings.logicalHeight,s=this.viewer.getCamera().up.clone(),a=!1,c=Zn.set(0,o);Cn(this.sheetSyncExt.sheetMap,this.viewer,c,!1,a);var u=En(this.sheetSyncExt.sheetMap,c.x,c.y,0),l=Zn.set(r,o);Cn(this.sheetSyncExt.sheetMap,this.viewer,l,!1,a);var h=En(this.sheetSyncExt.sheetMap,l.x,l.y,0),d=Zn.set(r,0);Cn(this.sheetSyncExt.sheetMap,this.viewer,d,!1,a);var p=En(this.sheetSyncExt.sheetMap,d.x,d.y,0);Jn.setFromPoints([u,p]);var g=Jn.getCenter(new THREE.Vector3),f=wn(this.viewer),v=Math.atan2(h.y-u.y,h.x-u.x);fn(u,g,-v),fn(p,g,-v),fn(s,Qn,v-f),Jn.setFromPoints([u,p]),this.worldBoundingBox=Jn.clone();var y=this.targetViewer.impl.getVisibleBounds(),m=Math.min(n,y.max.z),_=y.min.z,E=this.topViewViewer.getCamera();gn(E,Jn,_,m,Jn.getSize(new THREE.Vector3).y),E.up.copy(s),E.updateCameraMatrices(),E.dirty=!0}}},{key:"unloadIrrelevant3DModels",value:function(){var e=this;if(this.sheetSyncExt.targetModels){var t=this.sheetSyncExt.targetModels.map((function(e){return e.getModelKey()}));this.topViewViewer.getVisibleModels().forEach((function(n){var i=n.getModelKey();-1===t.indexOf(i)&&(e.topViewViewer.unloadModel(n),e.isModelLoadingMap[i]=!1)}))}}},{key:"loadRelevant3DModels",value:function(){var e=this;if(this.sheetSyncExt.targetModels){var t=this.topViewViewer.getVisibleModels().map((function(e){return e.getModelKey()}));this.sheetSyncExt.targetModels.forEach((function(n){var i=n.getModelKey();if(-1===t.indexOf(i)&&!e.isModelLoadingMap[i]){e.isModelLoadingMap[i]=!0;var r=n.getData().loadOptions;e.topViewViewer.loadDocumentNode(n.getDocumentNode().getRootNode().getDocument(),n.getDocumentNode(),{keepCurrentModels:!0,preserveView:!0,globalOffset:r.globalOffset,applyRefPoint:r.applyRefPoint,placementTransform:r.placementTransform,applyPlacementInModelUnits:r.applyPlacementInModelUnits}).then((function(){var t=e.targetViewer.impl.renderer().getConfig();t.renderEdges=!0,t.envMapBackground=null,t.aoEnabled=!1,t.antialias=!0,t.envMap=null,e.topViewViewer.impl.renderer().applyConfig(t),e.topViewViewer.setBackgroundOpacity(0)}))}}))}}},{key:"hideTopViewViewer",value:function(){this.topViewViewer&&(this.topViewViewer.container.style.opacity=0)}},{key:"showTopViewViewer",value:function(){this.topViewViewer&&(this.topViewViewer.container.style.opacity=1)}},{key:"update",value:function(){var e;this.sheetSyncExt&&this.sheetSyncExt.sheetMap&&this.viewer&&this.targetViewer&&this.topViewViewer?(this.showTopViewViewer(),this.unloadIrrelevant3DModels(),this.loadRelevant3DModels(),this.updateTopViewViewerCamera(),null===(e=this.thumbnailsOverlay)||void 0===e||e.update()):this.hideTopViewViewer()}}],r=[{key:"isSheetMapSupported",value:function(){return!(Autodesk.Viewing.isIE11Only||Autodesk.Viewing.isIOSDevice())}}],i&&zn(t.prototype,i),r&&zn(t,r),l}();qn.TopViewRenderer=Xn,Hn.theExtensionManager.registerExtension("Autodesk.AEC.TopViewRendererExtension",Xn);var $n=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,i){return e[0]===t&&(n=i,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(t,n){var i=e(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,i=e(n,t);~i&&n.splice(i,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,i=this.__entries__;n<i.length;n++){var r=i[n];e.call(t,r[1],r[0])}},t}()}(),ei="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,ti=void 0!==n.g&&n.g.Math===Math?n.g:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),ni="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(ti):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)},ii=["top","right","bottom","left","width","height","size","weight"],ri="undefined"!=typeof MutationObserver,oi=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,i=!1,r=0;function o(){n&&(n=!1,e()),i&&a()}function s(){ni(o)}function a(){var e=Date.now();if(n){if(e-r<2)return;i=!0}else n=!0,i=!1,setTimeout(s,20);r=e}return a}(this.refresh.bind(this))}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){ei&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),ri?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){ei&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;ii.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),si=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];Object.defineProperty(e,r,{value:t[r],enumerable:!1,writable:!1,configurable:!0})}return e},ai=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||ti},ci=pi(0,0,0,0);function ui(e){return parseFloat(e)||0}function li(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+ui(e["border-"+n+"-width"])}),0)}var hi="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof ai(e).SVGGraphicsElement}:function(e){return e instanceof ai(e).SVGElement&&"function"==typeof e.getBBox};function di(e){return ei?hi(e)?function(e){var t=e.getBBox();return pi(0,0,t.width,t.height)}(e):function(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return ci;var i=ai(e).getComputedStyle(e),r=function(e){for(var t={},n=0,i=["top","right","bottom","left"];n<i.length;n++){var r=i[n],o=e["padding-"+r];t[r]=ui(o)}return t}(i),o=r.left+r.right,s=r.top+r.bottom,a=ui(i.width),c=ui(i.height);if("border-box"===i.boxSizing&&(Math.round(a+o)!==t&&(a-=li(i,"left","right")+o),Math.round(c+s)!==n&&(c-=li(i,"top","bottom")+s)),!function(e){return e===ai(e).document.documentElement}(e)){var u=Math.round(a+o)-t,l=Math.round(c+s)-n;1!==Math.abs(u)&&(a-=u),1!==Math.abs(l)&&(c-=l)}return pi(r.left,r.top,a,c)}(e):ci}function pi(e,t,n,i){return{x:e,y:t,width:n,height:i}}var gi=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=pi(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=di(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),fi=function(e,t){var n,i,r,o,s,a,c,u=(i=(n=t).x,r=n.y,o=n.width,s=n.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,c=Object.create(a.prototype),si(c,{x:i,y:r,width:o,height:s,top:r,right:i+o,bottom:s+r,left:i}),c);si(this,{target:e,contentRect:u})},vi=function(){function e(e,t,n){if(this.activeObservations_=[],this.observations_=new $n,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=n}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof ai(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new gi(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof ai(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new fi(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),yi="undefined"!=typeof WeakMap?new WeakMap:new $n,mi=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=oi.getInstance(),i=new vi(t,n,this);yi.set(this,i)};["observe","unobserve","disconnect"].forEach((function(e){mi.prototype[e]=function(){var t;return(t=yi.get(this))[e].apply(t,arguments)}}));const _i=void 0!==ti.ResizeObserver?ti.ResizeObserver:mi;var Ei={en:JSON.parse('{"@@locale":"en","@@context":"Minimap3D Extension","Side by side":"Side by side","Small map":"Small map","Go to 2D":"Go to 2D","Show sheet":"Show sheet","Hide sheet":"Hide sheet","Loading sheet...":"Loading sheet...","Loading models...":"Loading models..."}'),"en-GB":JSON.parse('{"@@locale":"en","@@context":"Minimap3D Extension","Side by side":"Side By Side","Small map":"Small Map","Go to 2D":"Go to 2D","Show sheet":"Show Sheet","Hide sheet":"Hide Sheet","Loading sheet...":"Loading Sheet...","Loading models...":"Loading Models..."}'),cs:JSON.parse('{"@@locale":"cs","@@context":"Rozen Minimap3D","Side by side":"Vedle sebe","Small map":"Mal mapa","Go to 2D":"Pejt do 2D","Show sheet":"Zobrazit list","Hide sheet":"Skrt list","Loading sheet...":"Natn listu...","Loading models...":"Natn model..."}'),de:JSON.parse('{"@@locale":"de","@@context":"Minimap3D-Erweiterung","Side by side":"Nebeneinander","Small map":"Kleine Karte","Go to 2D":"Zu 2D wechseln","Show sheet":"Plan anzeigen","Hide sheet":"Blatt ausblenden","Loading sheet...":"Plan wird geladen...","Loading models...":"Modelle werden geladen..."}'),es:JSON.parse('{"@@locale":"es","@@context":"Extensin de minimapa 3D","Side by side":"En paralelo","Small map":"Mapa pequeo","Go to 2D":"Ir a 2D","Show sheet":"Mostrar plano","Hide sheet":"Ocultar plano","Loading sheet...":"Cargando plano...","Loading models...":"Cargando modelos..."}'),fr:JSON.parse('{"@@locale":"fr","@@context":"Extension Minimap3D","Side by side":"Cte  cte","Small map":"Petite carte","Go to 2D":"Aller  la 2D","Show sheet":"Afficher une feuille","Hide sheet":"Masquer la feuille","Loading sheet...":"Chargement de la feuille","Loading models...":"Chargement des modles"}'),"fr-CA":JSON.parse('{"@@locale":"fr-CA","@@context":"Extension Minimap3D","Side by side":"Cte  cte","Small map":"Petite carte","Go to 2D":"Aller  la 2D","Show sheet":"Afficher la feuille","Hide sheet":"Masquer la feuille","Loading sheet...":"Chargement de la feuille...","Loading models...":"Chargement des modles..."}'),it:JSON.parse('{"@@locale":"it","@@context":"Estensione Minimap3D","Side by side":"Affiancato","Small map":"Mappa piccola","Go to 2D":"Vai a 2D","Show sheet":"Mostra foglio","Hide sheet":"Nascondi foglio","Loading sheet...":"Caricamento foglio in corso...","Loading models...":"Caricamento modelli in corso..."}'),ja:JSON.parse('{"@@locale":"ja","@@context":"Minimap3D Extension","Side by side":"","Small map":"","Go to 2D":"2D ","Show sheet":"","Hide sheet":"","Loading sheet...":"...","Loading models...":"..."}'),ko:JSON.parse('{"@@locale":"ko","@@context":"Minip3D  ","Side by side":"","Small map":" ","Go to 2D":"2D ","Show sheet":" ","Hide sheet":" ","Loading sheet...":"  ...","Loading models...":"  ..."}'),pl:JSON.parse('{"@@locale":"pl","@@context":"Rozszerzenie Minimap3D","Side by side":"Rwnolegle","Small map":"Maa mapa","Go to 2D":"Przejd do 2D","Show sheet":"Poka arkusz","Hide sheet":"Ukryj arkusz","Loading sheet...":"Wczytywanie arkusza...","Loading models...":"Wczytywanie modeli..."}'),"pt-BR":JSON.parse('{"@@locale":"pt","@@context":"Extenso Minimap3D","Side by side":"Lado a lado","Small map":"Mapa pequeno","Go to 2D":"Ir para 2D","Show sheet":"Mostrar folha","Hide sheet":"Ocultar folha","Loading sheet...":"Carregando folha...","Loading models...":"Carregando modelos..."}'),ru:JSON.parse('{"@@locale":"ru","@@context":" Minimap3D","Side by side":"","Small map":" ","Go to 2D":"  2D","Show sheet":" ","Hide sheet":" ","Loading sheet...":" ...","Loading models...":" ..."}'),tr:JSON.parse('{"@@locale":"tr","@@context":"Minimap3D Uzants","Side by side":"Yan yana","Small map":"Kk harita","Go to 2D":"2B haritaya git","Show sheet":"Sayfay gster","Hide sheet":"Sayfay gizle","Loading sheet...":"Sayfa ykleniyor...","Loading models...":"Model ykleniyor..."}'),"zh-HANS":JSON.parse('{"@@locale":"zh-Hans","@@context":"Minimap3D ","Side by side":"","Small map":"","Go to 2D":"","Show sheet":"","Hide sheet":"","Loading sheet...":"...","Loading models...":"..."}'),"zh-HANT":JSON.parse('{"@@locale":"zh-Hant","@@context":"Minimap3D ","Side by side":"","Small map":"","Go to 2D":" 2D","Show sheet":"","Hide sheet":"","Loading sheet...":"...","Loading models...":"..."}'),"zh-HK":JSON.parse('{"@@locale":"zh-hk","@@context":"Minimap3D ","Side by side":"","Small map":"","Go to 2D":" 2D","Show sheet":"","Hide sheet":"","Loading sheet...":"","Loading models...":""}'),nl:JSON.parse('{"@@locale":"nl","@@context":"Minimap3D-extensie","Side by side":"Naast elkaar","Small map":"Kleine kaart","Go to 2D":"Ga naar 2D","Show sheet":"Blad weergeven","Hide sheet":"Hide sheet","Loading sheet...":"Blad laden...","Loading models...":"Modellen laden..."}'),sv:JSON.parse('{"@@locale":"sv","@@context":"Minimap3D-tillgg","Side by side":"Sida vid sida","Small map":"Liten karta","Go to 2D":"G till 2D","Show sheet":"Visa blad","Hide sheet":"Dlj blad","Loading sheet...":"Lser in blad...","Loading models...":"Lser in modeller..."}'),da:JSON.parse('{"@@locale":"da","@@context":"Minimap3D-udvidelse","Side by side":"Side om side","Small map":"Lille kort","Go to 2D":"G til 2D","Show sheet":"Vis ark","Hide sheet":"Skjul sheet","Loading sheet...":"Indlser ark...","Loading models...":"Indlser modeller..."}'),no:JSON.parse('{"@@locale":"no","@@context":"Minikart-3D-utvidelse","Side by side":"Side ved side","Small map":"Lite kart","Go to 2D":"G til 2D","Show sheet":"Vis ark","Hide sheet":"Skjul ark","Loading sheet...":"Laster ark ...","Loading models...":"Laster modeller ..."}')},Ai=n(38641),xi={};function Ci(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}xi.styleTagTransform=g(),xi.setAttributes=l(),xi.insert=c().bind(null,"head"),xi.domAPI=s(),xi.insertStyleElement=d(),r()(Ai.Z,xi),Ai.Z&&Ai.Z.locals&&Ai.Z.locals;var wi=Autodesk.Viewing.GlobalManagerMixin,bi=function(e){return e.toString()+"px"},Mi=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.minimap3DExtension=t,this.viewer=this.minimap3DExtension.viewer,this.options=t.options,this.setGlobalManager(this.viewer.globalManager),t.extendLocalization(Ei),this.sideBySideOptions=this.options.sideBySideOptions||{},this.showHeader=void 0===this.options.showHeader||this.options.showHeader,this.update=this.update.bind(this),this.mapWidgetWidth=300,this.mapWidgetHeight=300,this.sideOffset=void 0!==this.options.sideOffset?this.options.sideOffset:10,this.mapWidgetTop=0,this.sideBySideOptions.left2DView?(this.mapWidgetLeft=0,this.mapWidgetRight=void 0):(this.mapWidgetLeft=void 0,this.mapWidgetRight=0),this.relMapWidgetSizeLongEdge=.25,this.relMapWidgetSizeShortEdge=.37,this.dropdown=null,this.sideBySideEnabled=this.sideBySideOptions.sideBySideDefault||!1,this.sideBySide=!1,this.expanded=!1,this.sideBySideSplit=this.sideBySideOptions.sideBySideSplit||40,this.init()}var t,n;return t=e,n=[{key:"setMinimapVisible",value:function(e){var t=this;this.visible!==e&&(this.visible=e,this.mapWidget&&(this.getWindow().requestAnimationFrame((function(){t.mapWidgetRoot&&(e?t.mapWidgetRoot.classList.add("visible"):t.mapWidgetRoot.classList.remove("visible"),t.viewer.getExtension("Autodesk.ViewCubeUi",(function(t){t.displayViewCube(!e),t.displayHomeButton(!e)})))})),this.updateBimWalkInfoButtonPos(),e&&this.updateSideBySide()))}},{key:"initWidgets",value:function(){var e=this,t=this.getDocument(),n=this.options.additionalWrapperCss?" "+this.options.additionalWrapperCss:"";this.mapWidgetRoot=t.createElement("div"),this.mapWidgetRoot.style.width=bi(this.mapWidgetWidth),this.mapWidgetRoot.style.height=bi(this.mapWidgetHeight),this.mapWidgetRoot.className="minimap3D ".concat(n," "),this.mapWidgetRoot.classList.add("adsk-viewing-viewer"),this.mapWidgetRoot.classList.add(this.viewer.theme),this.mapWidgetHeader=t.createElement("div"),this.mapWidgetHeader.className="minimap-header",this.mapWidgetHeader.classList.add("adsk-viewing-viewer"),this.mapWidgetHeader.classList.add("adsk-control-group"),this.mapWidgetHeader.classList.add(this.viewer.theme),this.showHeader&&this.mapWidgetRoot.appendChild(this.mapWidgetHeader),this.mapWidget=t.createElement("div"),this.mapWidget.className="minimapScrollArea",this.mapWidgetRoot.appendChild(this.mapWidget),this.showHeader&&(Xn.isSheetMapSupported()&&this.options.onExpand&&(this.expandButton=new dn(this)),this.initDropdownIfNeeded(),this.sideBySideButton=new an(this)),this.setMinimapVisible(!1),this.mapWidgetRoot.addEventListener("transitionend",(function(){e.updateBimWalkInfoButtonPos(),e.updateSideBySide()}))}},{key:"initDropdownIfNeeded",value:function(){var e,t;if(this.showHeader&&!this.dropdown){var n=null===(e=this.minimap3DExtension.levelExt)||void 0===e||null===(t=e.floorSelector)||void 0===t?void 0:t.floorData,i=1===(null==n?void 0:n.length)&&"d53d4fd9-1bc6-4549-9084-1caed451e96f"===n[0].guid;(null==n?void 0:n.length)>0&&!i&&(this.dropdown=new Jt(this),this.sideBySideButton&&(this.sideBySideButton.dtor(),this.sideBySideButton=new an(this)))}}},{key:"destroyWidgets",value:function(){this.widgetAnimation&&(this.widgetAnimation.stop(),this.widgetAnimation=null),this.mapWidgetRoot.parentElement&&this.mapWidgetRoot.parentElement.removeChild(this.mapWidgetRoot),this.mapWidgetRoot=null,this.mapWidget=null,this.mapWidgetHeader=null,this.dropdown&&(this.dropdown.dtor(),this.dropdown=null),this.expandButton&&(this.expandButton.dtor(),this.expandButton=null),this.sideBySideButton&&(this.sideBySideButton.dtor(),this.sideBySideButton=null)}},{key:"init",value:function(){var e=this;this.initWidgets(),this.initialViewerWidth=this.viewer.container.clientWidth,this.initialViewerHeight=this.viewer.container.clientHeight,this.resizeObserver=new _i((function(){e.updateSideBySide(!0)})),this.resizeObserver.observe(this.viewer.clientContainer),this.updateMapSize(!0),this.viewer.clientContainer.appendChild(this.mapWidgetRoot)}},{key:"destroy",value:function(){this.destroyWidgets(),this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this.restoreViewerContainerStyle()}},{key:"getClientContainerWidth",value:function(){return this.viewer.clientContainer.clientWidth||this.initialViewerWidth}},{key:"getClientContainerHeight",value:function(){return this.viewer.clientContainer.clientHeight||this.initialViewerHeight}},{key:"updateToolbar",value:function(){this.sideBySideButton&&this.sideBySideButton.update(),this.expandButton&&this.expandButton.update()}},{key:"update",value:function(){this.initDropdownIfNeeded(),this.minimap3DExtension.isEnabled()?this.setMinimapVisible(!0):this.setMinimapVisible(!1),this.updateToolbar(),this.updateSideBySide()}},{key:"setWidgetSize",value:function(e,t,n,i,r,o){this.mapWidgetWidth=e,this.mapWidgetHeight=t,this.mapWidgetTop=n,this.mapWidgetLeft=i,this.mapWidgetRight=r,this.mapWidgetRoot.style.width=bi(e),this.mapWidgetRoot.style.height=bi(t),this.mapWidgetRoot.style.top=bi(n),this.mapWidgetRoot.style.left=void 0!==i?bi(i):"initial",this.mapWidgetRoot.style.right=void 0!==r?bi(r):"initial",void 0!==o&&(this.mapWidgetHeader.style.height=bi(o),this.mapWidgetHeader.style.opacity=(o/this.getInitialHeaderHeight()*100).toString()+"%"),this.minimap3DExtension.mapViewer&&this.minimap3DExtension.mapViewer.resize(),this.update()}},{key:"setViewerSize",value:function(e,t,n,i,r){this.viewer.container.style.width=bi(e),this.viewer.container.style.height=bi(t),this.viewer.container.style.left=bi(n),this.viewer.container.style.right=bi(i),this.viewer.container.style.top=bi(r),this.viewer.resize(),this.update()}},{key:"updateMapSize",value:function(e,t){var n,i,r,o,s,a,c=this.getClientContainerWidth(),u=this.getClientContainerHeight();if(this.expanded)n=c,i=u,r=0,this.sideBySideOptions.left2DView?o=0:s=0,a=!1;else if(this.sideBySide)this.verticalSideBySide?(n=c,i=u*(this.sideBySideSplit/100)):(n=c*(this.sideBySideSplit/100),i=u),r=0,this.sideBySideOptions.left2DView?o=0:s=0,a=!0;else{var l=Math.max(c,u),h=Math.min(c,u);i=.66*(n=Math.min(this.relMapWidgetSizeLongEdge*l,this.relMapWidgetSizeShortEdge*h))+this.mapWidgetHeader.clientHeight,r=10,this.sideBySideOptions.left2DView?o=this.sideOffset:s=this.sideOffset,a=!0}return e&&!this.widgetAnimation?this.setWidgetSize(n,i,r,o,s):this.animateWidgetSize(n,i,r,o,s,a,t)}},{key:"getInitialHeaderHeight",value:function(){return this.headerHeight||(this.headerHeight=this.mapWidgetHeader.clientHeight),this.headerHeight}},{key:"animateWidgetSize",value:function(e,t,n,i,r){var o=this,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],a=arguments.length>6?arguments[6]:void 0,c=this.mapWidgetWidth,u=this.mapWidgetHeight,l=this.mapWidgetTop,h=this.mapWidgetLeft,d=this.mapWidgetRight,p=this.mapWidgetHeader.clientHeight;a=a||this.minimap3DExtension.resizeDuration,this.widgetAnimation&&(this.widgetAnimation.stop(),this.widgetAnimation=null);var g=function(a){a=Autodesk.Viewing.Private.smootherStep(a);var g=Autodesk.Viewing.Private.lerp(c,e,a),f=Autodesk.Viewing.Private.lerp(u,t,a),v=Autodesk.Viewing.Private.lerp(l,n,a),y=void 0!==i?Autodesk.Viewing.Private.lerp(h||0,i,a):void 0,m=void 0!==r?Autodesk.Viewing.Private.lerp(d||0,r,a):void 0,_=Autodesk.Viewing.Private.lerp(p,s?o.getInitialHeaderHeight()+2*(10-n):0,a);o.setWidgetSize(g,f,v,y,m,_)};return new Promise((function(e){o.widgetAnimation=Autodesk.Viewing.Private.fadeValue(0,1,a,g,(function(){o.widgetAnimation=null,e()}))}))}},{key:"updateBimWalkInfoButtonPos",value:function(){var e=this.viewer.getExtension("Autodesk.BimWalk"),t=e&&e.getInfoButton();if(t&&!e.options.disableBimWalkInfoIcon){var n=this.getWindow().getComputedStyle(this.mapWidgetRoot),i=this.visible||n.opacity>0?this.mapWidgetWidth:0;this.sideBySide&&(i=0);var r=i+20;t.style.right=bi(r)}}},{key:"setSideBySideEnabled",value:function(e){this.sideBySideEnabled=e,this.updateSideBySide()}},{key:"setSideBySideSplit",value:function(e){this.sideBySideSplit=e,this.updateSideBySide(!0),this.updateBimWalkInfoButtonPos()}},{key:"animateViewerSize",value:function(e,t,n,i,r,o){var s=this,a=this.viewer.container.clientWidth,c=this.viewer.container.clientHeight,u=this.viewer.container.clientLeft,l=this.viewer.container.clientRight,h=this.viewer.container.clientTop;this.viewerResizeAnimation&&(this.viewerResizeAnimation.stop(),this.viewerResizeAnimation=null),o=o||this.minimap3DExtension.resizeDuration;var d=function(o){o=Autodesk.Viewing.Private.smootherStep(o);var d=Autodesk.Viewing.Private.lerp(a,e,o),p=Autodesk.Viewing.Private.lerp(c,t,o),g=Autodesk.Viewing.Private.lerp(h,r,o),f=Autodesk.Viewing.Private.lerp(u,n,o),v=Autodesk.Viewing.Private.lerp(l,i,o);s.setViewerSize(d,p,f,v,g)};return new Promise((function(e){s.viewerResizeAnimation=Autodesk.Viewing.Private.fadeValue(0,1,o,d,(function(){s.viewerResizeAnimation=null,e()}))}))}},{key:"updateSideBySide",value:function(e){var t=this.sideBySide;if(this.sideBySide=this.visible&&this.sideBySideEnabled,e||t!==this.sideBySide){var n,i,r,o,s,a=this.getClientContainerHeight(),c=this.getClientContainerWidth();this.sideBySide?(this.mapWidgetRoot.classList.add("side-by-side"),c>=a?(n=(100-this.sideBySideSplit)/100*c,i=a,this.sideBySideOptions.left2DView?(r=this.sideBySideSplit/100*c,o=0):(r=0,o=this.sideBySideSplit/100*c),s=0,this.sideBySideOptions.left2DView&&this.mapWidgetRoot.classList.add("left-2d-view"),this.verticalSideBySide=!1):(n=c,i=(100-this.sideBySideSplit)/100*a,r=0,o=0,s=this.sideBySideSplit/100*a,this.verticalSideBySide=!0),this.sideBySideOptions.onSideBySideUpdated&&this.sideBySideOptions.onSideBySideUpdated(this.sideBySideSplit)):(n=c,i=a,r=0,o=0,s=0,this.mapWidgetRoot.classList.remove("side-by-side"),this.mapWidgetRoot.classList.remove("left-2d-view")),e?this.setViewerSize(n,i,r,o,s):this.animateViewerSize(n,i,r,o,s),this.updateMapSize(e)}}},{key:"restoreViewerContainerStyle",value:function(){this.viewerResizeAnimation&&(this.viewerResizeAnimation.stop(),this.viewerResizeAnimation=null),this.viewer.container.style.width="100%",this.viewer.container.style.height="100%",this.viewer.container.style.left="",this.viewer.container.style.right="",this.viewer.container.style.top="",this.viewer.resize()}},{key:"getMapViewerContainer",value:function(){return this.mapWidget}},{key:"expandSheetMap",value:function(e){if(!this.expanded)return this.expanded=!0,this.mapWidgetHeader.style.pointerEvents="none",this.setSideBySideEnabled(!1),this.updateMapSize(!1,e)}}],n&&Ci(t.prototype,n),e}();function Ti(e){return Ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ti(e)}function Vi(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function Si(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Vi(o,i,r,s,a,"next",e)}function a(e){Vi(o,i,r,s,a,"throw",e)}s(void 0)}))}}function Ri(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Li(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Pi(e,t){return Pi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Pi(e,t)}function Oi(e,t){return!t||"object"!==Ti(t)&&"function"!=typeof t?Di(e):t}function Di(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ii(e){return Ii=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ii(e)}wi.call(Mi.prototype);var Ni=Autodesk.Viewing,ki=Ni.Private,Bi=ki.Empty2DModelLoader,Fi=AutodeskNamespace("Autodesk.AEC"),ji="Autodesk.AEC.AvatarExtension",zi="Autodesk.AEC.TopViewRendererExtension",Ui="miniMap3D",Gi=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Pi(e,t)}(l,e);var t,n,i,r,o,s,a,c,u=(a=l,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ii(a);if(c){var n=Ii(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Oi(this,e)});function l(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ri(this,l),(t=u.call(this,e,n)).mapViewerHighlightEnabled=n.mapViewerHighlightEnabled||!1,t.mapViewerSelectionEnabled=n.mapViewerSelectionEnabled||!1,t.update=t.update.bind(Di(t)),t.onModelAdded=t.onModelAdded.bind(Di(t)),t.onVisibilityChanged=t.onVisibilityChanged.bind(Di(t)),t.resizeDuration=.3,t}return t=l,n=[{key:"load",value:(s=Si(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.AEC.LevelsExtension");case 2:return this.levelExt=e.sent,this.loaded=!0,this.viewer.prefs.add(Ui,!0),this.configureSettings()||this.updateSettingsPanel||(this.updateSettingsPanel=this.configureSettings.bind(this),this.viewer.addEventListener(Ni.SETTINGS_PANEL_CREATED_EVENT,this.updateSettingsPanel)),this.viewer.addEventListener(Ni.TOOL_CHANGE_EVENT,this.update),this.viewer.addEventListener(Ni.MODEL_ADDED_EVENT,this.onModelAdded),(null===(t=this.levelExt)||void 0===t?void 0:t.floorSelector)&&this.levelExt.floorSelector.addEventListener(Autodesk.AEC.FloorSelector.FLOOR_DATA_CHANGED,this.update),this.activate(),e.abrupt("return",!0);case 11:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"unload",value:function(){return this.loaded=!1,this.deactivate(),this.updateSettingsPanel&&(this.viewer.removeEventListener(Ni.SETTINGS_PANEL_CREATED_EVENT,this.updateSettingsPanel),this.updateSettingsPanel=null),this.viewer.removeEventListener(Ni.TOOL_CHANGE_EVENT,this.update),this.viewer.removeEventListener(Ni.MODEL_ADDED_EVENT,this.onModelAdded),this.levelExt=null,!0}},{key:"onModelAdded",value:function(){this.viewer.impl.is2d?this.deactivate():this.activate()}},{key:"activate",value:function(){this.active||(this.update(),this.active=!0)}},{key:"deactivate",value:function(){var e;this.active&&(this.active=!1,this.mapViewer&&(this.mapViewer.finish(),this.sheetSyncExtension=null,this.mapViewer=null),this.layout&&(this.layout.destroy&&this.layout.destroy(),this.layout=null),(null===(e=this.levelExt)||void 0===e?void 0:e.floorSelector)&&this.levelExt.floorSelector.removeEventListener(Autodesk.AEC.FloorSelector.FLOOR_DATA_CHANGED,this.update))}},{key:"isEnabled",value:function(){var e,t,n,i,r=this.viewer.prefs&&this.viewer.prefs.get(Ui),o=this.viewer.getExtension("Autodesk.BimWalk"),s=null==o||null===(e=o.tool)||void 0===e?void 0:e.active,a=this.options.enableWithoutAecModelData||(null===(t=this.levelExt)||void 0===t||null===(n=t.floorSelector)||void 0===n||null===(i=n.floorData)||void 0===i?void 0:i.length)>0;return r&&(s&&a||this.options.minimapDebugMode)}},{key:"onVisibilityChanged",value:function(e){this.viewer.prefs&&this.viewer.prefs.set(Ui,e),this.update()}},{key:"initLayoutIfNeeded",value:function(){if(!this.layout){var e=this.options.LayoutClass||Mi;this.layout=new e(this)}}},{key:"initMapViewerIfNeeded",value:function(){var e,t=this;if(!this.mapViewer){var n=this.layout.getMapViewerContainer();if(this.options.getMapViewer)this.mapViewer=this.options.getMapViewer(n);else{var i=this.options.MapViewerClass||Autodesk.Viewing.Viewer3D;this.mapViewer=new i(n,{}),this.mapViewer.start(void 0,void 0,void 0,void 0,{webglInitParams:{alpha:!0}})}this.mapViewer.config.extensions=this.mapViewer.config.extensions||[],this.mapViewer.config.sheetSyncOptions={targetViewer:this.viewer,cropToViewport:!0,hideSheetWhenNotFocused:!0,autoSwitchSheet:!0,hidePaper:!0,useCustomModel:this.options.useCustomModel,showSheet:this.options.showSheet,loadDocumentNode:this.options.loadDocumentNode,unloadModel:this.options.unloadModel,minimapDebugMode:this.options.minimapDebugMode,useOnlyAecModelDataViewports:this.options.useOnlyAecModelDataViewports},this.mapViewer.config.avatarOptions={trackUsage:this.options.trackUsage,autoFocus:null!==(e=this.options.autoFocus)&&void 0!==e?e:!this.options.minimapDebugMode},this.mapViewer.config.topViewRendererOptions={minimapDebugMode:this.options.minimapDebugMode},-1===this.mapViewer.config.extensions.indexOf(ji)&&this.mapViewer.config.extensions.push(ji),-1===this.mapViewer.config.extensions.indexOf(zi)&&this.mapViewer.config.extensions.push(zi),this.mapViewer.disableHighlight(!this.mapViewerHighlightEnabled),this.mapViewer.disableSelection(!this.mapViewerSelectionEnabled),this.mapViewer.getExtensionAsync("Autodesk.AEC.SheetSyncExtension").then((function(e){t.sheetSyncExtension=e})),this.mapViewer.addEventListener(bn.SHEET_VISIBILITY_CHANGED_EVENT,this.update),this.mapViewer.loadModel("Dummy",{fileLoader:Bi,headlessViewer:!0})}}},{key:"update",value:function(){this.isEnabled()&&(this.initLayoutIfNeeded(),this.initMapViewerIfNeeded()),this.layout&&this.layout.update&&this.layout.update()}},{key:"configureSettings",value:function(){if(!this.viewer.getSettingsPanel)return!1;var e=this.viewer.getSettingsPanel();if(!e||!e.is3dMode)return!1;var t=Ni.Extensions.ViewerSettingTab.Navigation;return e.addLabel(t,"3D Mini-map"),e.showMinimapChkBoxId||(e.showMinimapChkBoxId=e.addCheckbox(t,"Show 3D mini-map","Toggles availability of the 3D mini-map when using first person mode",!0,this.onVisibilityChanged,Ui)),!0}},{key:"setSheetMapEnabled",value:function(e){this.sheetSyncExtension&&(this.sheetSyncExtension.setShowSheet(e),this.update())}},{key:"getSheetMapEnabled",value:function(){var e;return null===(e=this.sheetSyncExtension)||void 0===e?void 0:e.getShowSheet()}},{key:"setSideBySideEnabled",value:function(e){var t;(null===(t=this.layout)||void 0===t?void 0:t.setSideBySideEnabled)&&this.layout.setSideBySideEnabled(e)}},{key:"setSideBySideSplit",value:function(e){var t;(null===(t=this.layout)||void 0===t?void 0:t.setSideBySideSplit)&&this.layout.setSideBySideSplit(e)}},{key:"isSheetVisible",value:function(){var e;return null===(e=this.sheetSyncExtension)||void 0===e?void 0:e.isSheetVisible()}},{key:"waitForRotationDone",value:(o=Si(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.mapViewer.getExtension(zi),e.next=3,t.waitForRotationDone();case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"hideAvatarAndWait",value:(r=Si(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.mapViewer.getExtension(ji),e.next=3,t.hide();case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"expandSheetMap",value:(i=Si(regeneratorRuntime.mark((function e(){var t,n,i,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.sheetSyncExtension.sheetMap.getSheetNode(),this.sheetSyncExtension.expandCropBounds(this.resizeDuration),this.sheetSyncExtension.changePaperVisibility(!0),e.next=5,this.layout.expandSheetMap(this.resizeDuration);case 5:return e.next=7,this.waitForRotationDone();case 7:return this.sheetSyncExtension.setSheetOpaque(this.resizeDuration),e.next=10,this.hideAvatarAndWait();case 10:return n=this.mapViewer.getState(),e.next=13,t;case 13:return i=e.sent,r=i.getInputFileType(),o=1===this.mapViewer.getVisibleModels().length?this.mapViewer.model.getDocumentNode().getInputFileType():"Aggregate",ki.analytics.track("viewer.3d_minimap.open_sheet",{file_2d_extension:r,file_3d_extension:o}),e.next=19,this.options.onExpand(i,this.sheetSyncExtension.getCustomHash());case 19:this.viewer.restoreState(n,void 0,!0);case 20:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})}],n&&Li(t.prototype,n),l}(Ni.Extension);function Yi(e){return Yi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Yi(e)}function Wi(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function Hi(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ki(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function qi(e,t){return qi=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},qi(e,t)}function Qi(e,t){return!t||"object"!==Yi(t)&&"function"!=typeof t?Zi(e):t}function Zi(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ji(e){return Ji=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Ji(e)}Fi.Minimap3DExtension=Gi,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.AEC.Minimap3DExtension",Gi);var Xi=AutodeskNamespace("Autodesk.AEC"),$i=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&qi(e,t)}(c,Autodesk.Viewing.Extension);var t,n,i,r,o,s,a=(o=c,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ji(o);if(s){var n=Ji(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Qi(this,e)});function c(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Hi(this,c),(t=a.call(this,e,n)).loadedSheets={},t.sheetsPerLevelCache={},t.zPositionPerLevel={},t.onModelRootLoaded=t.onModelRootLoaded.bind(Zi(t)),t.onModelChanged=t.onModelChanged.bind(Zi(t)),t}return t=c,n=[{key:"load",value:(i=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.AEC.LevelsExtension");case 2:return this.levelExtension=e.sent,this.addListeners(),t=j(this.viewer),this.init(t),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e,this)})),r=function(){var e=this,t=arguments;return new Promise((function(n,r){var o=i.apply(e,t);function s(e){Wi(o,n,r,s,a,"next",e)}function a(e){Wi(o,n,r,s,a,"throw",e)}s(void 0)}))},function(){return r.apply(this,arguments)})},{key:"onModelChanged",value:function(e){if(!e.model.is2d()){var t=j(this.viewer);t!==this.model3D&&(this.unloadAll(),this.init(t))}}},{key:"init",value:function(e){this.loadedSheets={},this.sheetsPerLevelCache={},this.zPositionPerLevel={},this.floorSelector=this.levelExtension.floorSelector,this.model3D=e,e&&(this.rootNode=this.model3D.getDocumentNode().getRootNode(),this.document=this.rootNode.getDocument(),this.aec=this.rootNode.getAecModelData())}},{key:"unload",value:function(){return this.removeListeners(),this.unloadAll(),this.floorSelector=null,this.model3D=null,this.rootNode=null,this.document=null,this.aec=null,!0}},{key:"addListeners",value:function(){this.viewer.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.onModelRootLoaded),this.viewer.addEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,this.onModelChanged),this.viewer.addEventListener(Autodesk.Viewing.MODEL_REMOVED_EVENT,this.onModelChanged)}},{key:"removeListeners",value:function(){this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.onModelRootLoaded),this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ADDED_EVENT,this.onModelChanged),this.viewer.removeEventListener(Autodesk.Viewing.MODEL_REMOVED_EVENT,this.onModelChanged)}},{key:"getHashNameForViewportAndLevel",value:function(e,t){return e.viewportGuid+"."+t}},{key:"onModelRootLoaded",value:function(e){var t=e.model;if(!t.is3d()){var n=t.loader.options.customHash,i=this.loadedSheets[n];if(i&&i.loading){var r=t.getUnitScale(),o=ie.get2DTo3DMatrix(i.viewport,r),s=this.floorSelector.floorData[i.levelIndex],a=this.model3D.getModelToViewerTransform();a&&o.multiplyMatrices(a,o),Object.prototype.hasOwnProperty.call(this.zPositionPerLevel,i.levelIndex)?this.zPositionPerLevel[i.levelIndex]+=.001:this.zPositionPerLevel[i.levelIndex]=0;var c=1/12+1/120+this.zPositionPerLevel[i.levelIndex],u=new THREE.Vector3;u.setFromMatrixPosition(o),u.z=s.zMin+c,o.setPosition(u),t.setPlacementTransform(o)}else Autodesk.Viewing.Private.logger.warn("Model root loaded called for sheet not being loaded")}}},{key:"getAvailableSheetsForLevel",value:function(e){var t=this;if(this.sheetsPerLevelCache[e])return this.sheetsPerLevelCache[e];var n=this.floorSelector.floorData[e],i=ie.findViewportsForLevel(this.aec,n.guid);if(0===(i=i.filter(ie.supports2DTo3DTransform)).length)return Autodesk.Viewing.Private.logger.warn("No supported viewports for current level"),[];var r=[],o=new THREE.Box3,s=new THREE.Vector3;return i.forEach((function(e){var n=t.rootNode.search({type:"geometry",role:"2d",guid:e.sheetGuid});if(n.length){o.set(e.sectionBox.min,e.sectionBox.max);var i=Autodesk.Viewing.BubbleNode.readMatrixFromArray12(e.sectionBox.transform);o.applyMatrix4(i);var a=o.getSize(s);r.push({viewport:e,node:n[0],boxSize:a.x*a.y})}})),r.sort((function(e,t){return t.boxSize-e.boxSize})),this.sheetsPerLevelCache[e]=r,r}},{key:"loadSheetFromLevel",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=this.getAvailableSheetsForLevel(e);if(r.length){var o=r[n],s=this.getHashNameForViewportAndLevel(o.viewport,e),a=o.node;if(this.loadedSheets[s]){var c=this.loadedSheets[s];return c.loading||this.viewer.showModel(c.model),void(i&&i({hash:s,model:c.model}))}var u={isAEC:!0,useConsolidation:!1,preserveView:!0,keepCurrentModels:!0,disable3DModelLayers:!0,disablePrecomputedNodeBoxes:!0,noShadow:!0,doNotCut:!0,customHash:s};this.options.hidePaper&&(u.modelSpace=!0,u.bgColor=0),this.loadedSheets[s]={node:a,levelIndex:e,sheetIndex:n,viewport:o.viewport,loading:!0},this.viewer.loadDocumentNode(this.document,a,u).then((function(e){t.loadedSheets[s]?(t.loadedSheets[s].loading=!1,t.loadedSheets[s].model=e,e.invalidateBBoxes(),i&&i({hash:s,model:e})):i&&i({})}))}}},{key:"findLoadedSheetsFromLevelIndex",value:function(e){var t=[];for(var n in this.loadedSheets)this.loadedSheets[n].levelIndex===e&&t.push(n);return t}},{key:"findLoadedSheetFromLevelAndSheetIndex",value:function(e,t){for(var n in this.loadedSheets)if(this.loadedSheets[n].levelIndex===e&&this.loadedSheets[n].sheetIndex===t)return n}},{key:"unloadSheet",value:function(e){var t=this.loadedSheets[e];t&&(this.viewer.unloadDocumentNode(t.node),delete this.loadedSheets[e])}},{key:"hideModel",value:function(e){var t=this.loadedSheets[e];t&&(t.model?this.viewer.hideModel(t.model):t.loading&&this.unloadSheet(e))}},{key:"hideSheetFromLevel",value:function(e,t){var n=this.findLoadedSheetFromLevelAndSheetIndex(e,t);n&&this.hideModel(n)}},{key:"hideAllSheetsFromLevel",value:function(e){var t=this;this.findLoadedSheetsFromLevelIndex(e).forEach((function(e){t.hideModel(e)}))}},{key:"unloadSheetsFromLevel",value:function(e){var t=this;this.findLoadedSheetsFromLevelIndex(e).forEach((function(e){t.unloadSheet(e)}))}},{key:"unloadAll",value:function(){for(var e in this.loadedSheets)this.viewer.unloadDocumentNode(this.loadedSheets[e].node);this.loadedSheets={}}}],n&&Ki(t.prototype,n),c}();Xi.HypermodelingExtension=$i,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.AEC.Hypermodeling",$i);var er=n(11907),tr=n.n(er);function nr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n(35867);var ir=Autodesk.Viewing.GlobalManagerMixin,rr=new THREE.Vector3(0,0,1),or=new THREE.Vector3,sr=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.avatarWidget=t,this.targetViewer=t.targetViewer,this.transforms=t.transforms,this.setGlobalManager(t.globalManager),this.dragDirectionStart=this.dragDirectionStart.bind(this),this.dragDirectionMove=this.dragDirectionMove.bind(this),this.dragDirectionEnd=this.dragDirectionEnd.bind(this),this.dragPositionStart=this.dragPositionStart.bind(this),this.dragPositionMove=this.dragPositionMove.bind(this),this.dragPositionEnd=this.dragPositionEnd.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),this.lastAngle=void 0,this.isDragging=!1,this.isRotating=!1,this.active=!1,this.names=["avatar-tool"]}var t,n;return t=e,(n=[{key:"getNames",value:function(){return this.names}},{key:"getName",value:function(){return this.names[0]}},{key:"isActive",value:function(){return this.active}},{key:"activate",value:function(){this.isActive()||(this.active=!0,this.avatarWidget.widgetUI.hitArea.addEventListener("mousedown",this.dragPositionStart),this.avatarWidget.widgetUI.hitArea.addEventListener("touchstart",this.dragPositionStart),this.avatarWidget.widgetUI.addEventListener("mousedown",this.dragDirectionStart),this.avatarWidget.widgetUI.addEventListener("touchstart",this.dragDirectionStart),this.avatarWidget.canvasWrap&&(this.avatarWidget.widgetUI.hitArea.addEventListener("mousewheel",this.onMouseWheel),this.avatarWidget.widgetUI.hitArea.addEventListener("DOMMouseScroll",this.onMouseWheel),this.avatarWidget.widgetUI.addEventListener("mousewheel",this.onMouseWheel),this.avatarWidget.widgetUI.addEventListener("DOMMouseScroll",this.onMouseWheel)))}},{key:"deactivate",value:function(){this.isActive()&&(this.active=!1,this.avatarWidget.widgetUI.hitArea.removeEventListener("mousedown",this.dragPositionStart),this.avatarWidget.widgetUI.hitArea.removeEventListener("touchstart",this.dragPositionStart),this.avatarWidget.widgetUI.removeEventListener("mousedown",this.dragDirectionStart),this.avatarWidget.widgetUI.removeEventListener("touchstart",this.dragDirectionStart),this.avatarWidget.canvasWrap&&(this.avatarWidget.widgetUI.hitArea.removeEventListener("mousewheel",this.onMouseWheel),this.avatarWidget.widgetUI.hitArea.removeEventListener("DOMMouseScroll",this.onMouseWheel),this.avatarWidget.widgetUI.removeEventListener("mousewheel",this.onMouseWheel),this.avatarWidget.widgetUI.removeEventListener("DOMMouseScroll",this.onMouseWheel)),this.dragPositionEnd(),this.dragDirectionEnd())}},{key:"onMouseWheel",value:function(e){var t=new MouseEvent(e.type,e);t.wheelDelta=e.wheelDelta,t.deltaY=e.deltaY,this.avatarWidget.canvasWrap.dispatchEvent(t),t.defaultPrevented&&e.preventDefault()}},{key:"screenToMap",value:function(e,t){e.type.indexOf("touch")>=0&&(e.clientX=e.touches[0].pageX,e.clientY=e.touches[0].pageY);var n=this.avatarWidget.container.getBoundingClientRect(),i=new THREE.Vector2(e.clientX-n.left,e.clientY-n.top);return this.transforms.widgetToMapPixels(i,t),i}},{key:"dragPositionStart",value:function(e){this.addWindowEventListener("mousemove",this.dragPositionMove),this.addWindowEventListener("mouseup",this.dragPositionEnd),this.addWindowEventListener("touchmove",this.dragPositionMove),this.addWindowEventListener("touchend",this.dragPositionEnd),e.stopPropagation(),e.preventDefault(),this.isDragging=!0,this.avatarWidget.dispatchEvent({type:Autodesk.AEC.AvatarEvents.DRAG_START_EVENT})}},{key:"dragPositionMove",value:function(e){var t=this.screenToMap(e,!0),n=t.x,i=t.y,r=this.targetViewer.impl.camera,o=r.position.z,s=r.position.clone(),a=this.transforms.mapPixelsToWorld(n,i,o);r.position.copy(a);var c=r.position.clone().sub(s);r.target.add(c),r.target.z=o,this.targetViewer.impl.invalidate(!0,!0,!0),this.targetViewer.dispatchEvent({type:Autodesk.Viewing.CAMERA_CHANGE_EVENT,camera:r}),e.stopPropagation(),this.avatarWidget&&this.avatarWidget.dispatchEvent({type:Autodesk.AEC.AvatarEvents.DRAG_MOVE_EVENT,camera:r})}},{key:"dragPositionEnd",value:function(e){this.removeWindowEventListener("mousemove",this.dragPositionMove),this.removeWindowEventListener("mouseup",this.dragPositionEnd),this.removeWindowEventListener("touchmove",this.dragPositionMove),this.removeWindowEventListener("touchend",this.dragPositionEnd),e&&e.stopPropagation(),this.isDragging=!1,this.avatarInteractionTracked||(this.avatarInteractionTracked=!0,this.avatarWidget&&this.avatarWidget.trackUsage&&this.avatarWidget.trackUsage({avatar_interaction_tracked:!0})),this.avatarWidget&&this.avatarWidget.dispatchEvent({type:Autodesk.AEC.AvatarEvents.DRAG_END_EVENT})}},{key:"getCameraPositionOnMap",value:function(){var e=this.targetViewer.impl.camera.position;return this.transforms.worldToMapPixels(e)}},{key:"dragDirectionStart",value:function(e){var t=this.getCameraPositionOnMap(),n=this.screenToMap(e);this.lastAngle=mn(t,n),this.addWindowEventListener("mousemove",this.dragDirectionMove),this.addWindowEventListener("mouseup",this.dragDirectionEnd),this.addWindowEventListener("touchmove",this.dragDirectionMove),this.addWindowEventListener("touchend",this.dragDirectionEnd),e.stopPropagation(),e.preventDefault(),this.isRotating=!0,this.avatarWidget&&this.avatarWidget.dispatchEvent({type:Autodesk.AEC.AvatarEvents.ROTATE_START_EVENT,angle:this.lastAngle})}},{key:"dragDirectionMove",value:function(e){var t=this.getCameraPositionOnMap(),n=this.screenToMap(e),i=mn(t,n),r=this.lastAngle-i,o=this.targetViewer.impl.camera,s=o.target.clone().sub(o.position);s.applyAxisAngle(rr,r),s.add(o.position),o.target.copy(s),o.up.applyAxisAngle(rr,r),this.targetViewer.impl.syncCamera(),this.targetViewer.dispatchEvent({type:Autodesk.Viewing.CAMERA_CHANGE_EVENT,camera:o}),this.lastAngle=i,e.stopPropagation(),this.avatarWidget&&this.avatarWidget.dispatchEvent({type:Autodesk.AEC.AvatarEvents.ROTATE_MOVE_EVENT,angle:this.lastAngle})}},{key:"dragDirectionEnd",value:function(e){this.removeWindowEventListener("mousemove",this.dragDirectionMove),this.removeWindowEventListener("mouseup",this.dragDirectionEnd),this.removeWindowEventListener("touchmove",this.dragDirectionMove),this.removeWindowEventListener("touch",this.dragDirectionEnd),e&&e.stopPropagation(),this.isRotating=!1,this.avatarWidget&&this.avatarWidget.dispatchEvent({type:Autodesk.AEC.AvatarEvents.ROTATE_END_EVENT,angle:this.lastAngle})}},{key:"convertEventHammerToMouse",value:function(e){e.pointers&&(e.clientX=e.pointers[0].clientX,e.clientY=e.pointers[0].clientY)}},{key:"getCurrentLevel",value:function(){var e=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension");if(e)return e.getCurrentLevel()}},{key:"handleDoubleClick",value:function(e){var t=this;this.convertEventHammerToMouse(e);var n=this.screenToMap(e),i=n.x,r=n.y,o=this.targetViewer.impl.camera,s=o.getWorldDirection(or);s.z=Math.max(s.z,0);var a=o.position.z,c=this.getCurrentLevel();if(c){var u=c.zMin+1.8/this.targetViewer.model.getUnitScale();u>=c.zMax&&(u=(c.zMin+c.zMax)/2),isFinite(u)&&(a=u)}var l=this.transforms.mapPixelsToWorld(i,r,a),h=l.clone().add(s),d={position:l,target:h,up:o.up};return this.isDragging=!0,Autodesk.Viewing.Private.flyToView(this.targetViewer,d,.5,(function(){t.isDragging=!1})),e.stopPropagation(),e.preventDefault(),!0}},{key:"handleDoubleTap",value:function(e){return this.handleDoubleClick(e)}}])&&nr(t.prototype,n),e}();ir.call(sr.prototype);var ar=n(7400),cr={};function ur(e){return ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ur(e)}function lr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function hr(e,t){return hr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},hr(e,t)}function dr(e,t){return!t||"object"!==ur(t)&&"function"!=typeof t?pr(e):t}function pr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gr(e){return gr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},gr(e)}cr.styleTagTransform=g(),cr.setAttributes=l(),cr.insert=c().bind(null,"head"),cr.domAPI=s(),cr.insertStyleElement=d(),r()(ar.Z,cr),ar.Z&&ar.Z.locals&&ar.Z.locals;var fr=AutodeskNamespace("Autodesk.AEC"),vr=Autodesk.Viewing.GlobalManagerMixin,yr=Autodesk.Viewing,mr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&hr(e,t)}(s,Autodesk.Viewing.EventDispatcher);var t,n,i,r,o=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=gr(i);if(r){var n=gr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return dr(this,e)});function s(e,t,n,i,r,a){var c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(c=o.call(this)).container=e,c.targetViewer=t,c.transforms=i,c.trackUsage=r,c.canvasWrap=a,c.setGlobalManager(n),c.widgetUI=c.createUI(),c.tool=new sr(pr(c)),c.tool.activate(),c}return t=s,(n=[{key:"createUI",value:function(){var e=this.getDocument(),t=e.createElement("div");t.className="avatar-widget",this.container.appendChild(t);var n=e.createElement("div");n.className="avatar-frustum",t.appendChild(n),t.frustumWidget=n,t.anchorX=20,t.anchorY=40;var i=e.createElement("div");i.className="avatar-position-fill",t.appendChild(i),t.posCircle=i;var r=e.createElement("div");return r.className="avatar-position-hitarea",t.posCircle.appendChild(r),t.hitArea=r,yr.isTouchDevice()&&(r.classList.add("touch"),n.classList.add("touch"),t.posCircle.classList.add("touch"),t.anchorX=40,t.anchorY=80),t}},{key:"destroy",value:function(){this.tool.deactivate(),this.tool=null,this.container.removeChild(this.widgetUI),this.widgetUI=null}},{key:"show",value:function(){return this.changeVisibility(!0)}},{key:"hide",value:function(){return this.changeVisibility(!1)}},{key:"changeVisibility",value:function(e){var t=this;return new Promise((function(n){e^t.widgetUI.classList.contains("visible")?(e?t.widgetUI.classList.add("visible"):t.widgetUI.classList.remove("visible"),t.widgetUI.addEventListener("transitionend",(function e(){t.widgetUI.removeEventListener("transitionend",e),n()}))):n()}))}},{key:"getPosition2D",value:function(){var e=this.targetViewer.impl.camera.position;return this.transforms.worldToMapPixels(e)}},{key:"getTarget2D",value:function(){var e=this.targetViewer.impl.camera.target;return this.transforms.worldToMapPixels(e)}},{key:"update",value:function(){var e=this.getPosition2D(),t=this.getTarget2D(),n=mn(e,t),i=this.transforms.getMapRotationAngle();this.widgetUI.frustumWidget.style.transform="rotate(".concat(n+i,"rad)"),this.transforms.mapPixelsToWidget(e),this.widgetUI.style.transform="translate(".concat(e.x-this.widgetUI.anchorX,"px, ").concat(e.y-this.widgetUI.anchorY,"px)")}},{key:"isDragging",value:function(){return this.tool.isDragging}},{key:"isRotating",value:function(){return this.tool.isRotating}}])&&lr(t.prototype,n),s}();function _r(e){return _r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_r(e)}function Er(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function Ar(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function xr(e,t){return xr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},xr(e,t)}function Cr(e,t){return!t||"object"!==_r(t)&&"function"!=typeof t?wr(e):t}function wr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function br(e){return br=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},br(e)}vr.call(mr.prototype),Object.assign(fr,{AvatarEvents:{DRAG_START_EVENT:"dragStart",DRAG_MOVE_EVENT:"dragMove",DRAG_END_EVENT:"dragEnd",ROTATE_START_EVENT:"rotateStart",ROTATE_MOVE_EVENT:"rotateMove",ROTATE_END_EVENT:"rotateEnd"}});var Mr=Autodesk.Viewing,Tr=AutodeskNamespace("Autodesk.AEC"),Vr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&xr(e,t)}(c,Autodesk.Viewing.Extension);var t,n,i,r,o,s,a=(o=c,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=br(o);if(s){var n=br(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Cr(this,e)});function c(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c),(n=a.call(this,e,t)).options=n.options.avatarOptions||n.options,n.autoFocus=void 0===n.options.autoFocus||n.options.autoFocus,n.outOfFocus=!0,n.focusDuration=2,n.last3dCameraPos=new THREE.Vector3,n.update=n.update.bind(wr(n)),n.onMainMapChanged=n.onMainMapChanged.bind(wr(n)),n.on3dCameraChanged=n.on3dCameraChanged.bind(wr(n)),n.onSheetCameraChanged=n.onSheetCameraChanged.bind(wr(n)),n.onDragStart=n.onDragStart.bind(wr(n)),n.onDragEnd=n.onDragEnd.bind(wr(n)),n}return t=c,n=[{key:"load",value:(i=regeneratorRuntime.mark((function e(){var t,n,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.viewer.loadExtension("Autodesk.AEC.SheetSyncExtension",this.viewer.config);case 2:this.sheetSyncExt=e.sent,this.targetViewer=this.sheetSyncExt.targetViewer,t={mapPixelsToWorld:this.mapPixelsToWorld.bind(this),worldToMapPixels:this.worldToMapPixels.bind(this),mapPixelsToWidget:this.mapPixelsToWidget.bind(this),widgetToMapPixels:this.widgetToMapPixels.bind(this),getMapRotationAngle:this.getCameraRotationAngle.bind(this)},this.avatarWidget=new mr(this.viewer.container,this.targetViewer,this.globalManager,t,this.options.trackUsage,this.viewer.canvasWrap),this.visible=!0,this.autoFocus&&((n=this.getFuzzyBoundsCenter())?this.setCameraPosition(n,!0):this.targetViewer.addEventListener(Mr.GEOMETRY_LOADED_EVENT,(function(){i.focusOnModel()}),{once:!0})),this.addListeners(),this.activateTool();case 10:case"end":return e.stop()}}),e,this)})),r=function(){var e=this,t=arguments;return new Promise((function(n,r){var o=i.apply(e,t);function s(e){Er(o,n,r,s,a,"next",e)}function a(e){Er(o,n,r,s,a,"throw",e)}s(void 0)}))},function(){return r.apply(this,arguments)})},{key:"unload",value:function(){return this.sheetSyncExt=null,this.removeListeners(),this.deactivateTool(),this.avatarWidget.destroy(),this.avatarWidget=null,this.focusAnim&&(this.focusAnim.stop(),this.focusAnim=null),!0}},{key:"activateTool",value:function(){this.toolActive||(this.toolActive=!0,this.viewer.toolController.registerTool(this.avatarWidget.tool),this.viewer.toolController.activateTool(this.avatarWidget.tool.getName()),this.avatarWidget.addEventListener(Autodesk.AEC.AvatarEvents.DRAG_START_EVENT,this.onDragStart),this.avatarWidget.addEventListener(Autodesk.AEC.AvatarEvents.DRAG_END_EVENT,this.onDragEnd),this.updateFocus())}},{key:"deactivateTool",value:function(){this.toolActive&&(this.toolActive=!1,this.viewer.toolController.deactivateTool(this.avatarWidget.tool.getName()),this.viewer.toolController.deregisterTool(this.avatarWidget.tool),this.avatarWidget.removeEventListener(Autodesk.AEC.AvatarEvents.DRAG_START_EVENT,this.onDragStart),this.avatarWidget.removeEventListener(Autodesk.AEC.AvatarEvents.DRAG_END_EVENT,this.onDragEnd))}},{key:"addListeners",value:function(){this.targetViewer.addEventListener(Mr.NAVIGATION_MODE_CHANGED_EVENT,this.update),this.targetViewer.addEventListener(Mr.MODEL_ADDED_EVENT,this.update),this.targetViewer.addEventListener(Mr.MODEL_REMOVED_EVENT,this.update),this.targetViewer.addEventListener(Mr.CAMERA_CHANGE_EVENT,this.on3dCameraChanged),this.viewer.addEventListener(Mr.MODEL_ADDED_EVENT,this.update),this.viewer.addEventListener(Mr.MODEL_REMOVED_EVENT,this.update),this.viewer.addEventListener(Mr.RENDER_PRESENTED_EVENT,this.update),this.viewer.addEventListener(Mr.VIEWER_RESIZE_EVENT,this.update),this.viewer.addEventListener(bn.MAIN_MAP_CHANGED_EVENT,this.onMainMapChanged),this.viewer.addEventListener(Mr.CAMERA_CHANGE_EVENT,this.onSheetCameraChanged)}},{key:"removeListeners",value:function(){this.targetViewer.removeEventListener(Mr.NAVIGATION_MODE_CHANGED_EVENT,this.update),this.targetViewer.removeEventListener(Mr.MODEL_ADDED_EVENT,this.update),this.targetViewer.removeEventListener(Mr.MODEL_REMOVED_EVENT,this.update),this.targetViewer.removeEventListener(Mr.CAMERA_CHANGE_EVENT,this.on3dCameraChanged),this.viewer.removeEventListener(Mr.MODEL_ADDED_EVENT,this.update),this.viewer.removeEventListener(Mr.MODEL_REMOVED_EVENT,this.update),this.viewer.removeEventListener(Mr.RENDER_PRESENTED_EVENT,this.update),this.viewer.removeEventListener(Mr.VIEWER_RESIZE_EVENT,this.update),this.viewer.removeEventListener(bn.MAIN_MAP_CHANGED_EVENT,this.onMainMapChanged),this.viewer.removeEventListener(Mr.CAMERA_CHANGE_EVENT,this.onSheetCameraChanged)}},{key:"onDragStart",value:function(){this.focusAnim&&(this.focusAnim.stop(),this.focusAnim=null)}},{key:"onDragEnd",value:function(){this.outOfFocus=!0,this.updateFocus()}},{key:"isEnabled",value:function(){return this.sheetSyncExt.isEnabled()}},{key:"onMainMapChanged",value:function(e){e.sheetMap&&this.update()}},{key:"update",value:function(){var e;if(this.viewer.impl&&this.viewer.model&&this.avatarWidget&&this.sheetSyncExt)return this.sheetSyncExt.sheetMap&&this.isEnabled()&&this.visible?(e=this.avatarWidget.show(),this.activateTool()):(e=this.avatarWidget.hide(),this.deactivateTool()),this.sheetSyncExt.sheetMap&&this.avatarWidget.update(),e}},{key:"show",value:function(){if(!this.visible)return this.visible=!0,this.update()}},{key:"hide",value:function(){if(this.visible)return this.visible=!1,this.update()}},{key:"setCameraPosition",value:function(e,t){var n=this.viewer.getCamera();n.position.set(e.x,e.y,t?e.z:n.position.z),n.target.set(e.x,e.y,n.target.z),n.dirty=!0}},{key:"getCameraRotationAngle",value:function(){return wn(this.viewer)}},{key:"worldToMapPixels",value:function(e){return _n(this.sheetSyncExt.sheetMap,e)}},{key:"mapPixelsToWorld",value:function(e,t,n){return En(this.sheetSyncExt.sheetMap,e,t,n)}},{key:"mapPixelsToWidget",value:function(e){return function(e,t,n){An(e,n),n.copy(t.worldToClient(n))}(this.sheetSyncExt.sheetMap,this.viewer,e)}},{key:"widgetToMapPixels",value:function(e,t){return t=t&&!this.sheetSyncExt.options.cropToViewport,Cn(this.sheetSyncExt.sheetMap,this.viewer,e,t)}},{key:"world3DtoWorld2D",value:function(e){var t=this.worldToMapPixels(e);return this.mapPixelsToWidget(t),this.viewer.clientToWorld(t.x,t.y,void 0,!0).point}},{key:"getAvatarPositionOn2DSheet",value:function(){return this.world3DtoWorld2D(this.targetViewer.getCamera().position)}},{key:"on3dCameraChanged",value:function(){this.updateFocus(),this.update()}},{key:"onSheetCameraChanged",value:function(){this.viewer.toolController.getTool("pan").isInteractionActive()&&(this.outOfFocus=!0,this.focusAnim&&(this.focusAnim.stop(),this.focusAnim=null))}},{key:"focusOnAvatar",value:function(){var e=this;this.animateFocus(!1,(function(){e.outOfFocus=!1}))}},{key:"focusOnModel",value:function(){var e=this;this.animateFocus(!0,(function(){e.outOfFocus=!0}))}},{key:"updateFocus",value:function(){if(this.sheetSyncExt&&this.sheetSyncExt.sheetMap&&this.autoFocus&&!this.avatarWidget.tool.isDragging){var e=this.targetViewer.getCamera();if(this.last3dCameraPos.x!==e.position.x||this.last3dCameraPos.y!==e.position.y){if(this.isAvatarInsideBounds())if(this.outOfFocus)this.focusOnAvatar();else{var t=this.getAvatarPositionOn2DSheet();this.setCameraPosition(t)}else this.focusOnModel();this.last3dCameraPos=e.position.clone()}}else this.outOfFocus=!0}},{key:"getFuzzyBoundsCenter",value:function(){var e=this.sheetSyncExt.getFuzzyBox();if(e.isEmpty())return null;var t=this.world3DtoWorld2D(e.min),n=this.world3DtoWorld2D(e.max),i=(new THREE.Box3).setFromPoints([t,n]),r=this.viewer.getCamera();return this.viewer.navigation.computeFit(r.position,r.target,r.fov,i,r.aspect).position}},{key:"isAvatarInsideBounds",value:function(){var e=this.sheetSyncExt.getFuzzyBox();if(e.isEmpty())return!1;e.min.z=-1/0,e.max.z=1/0;var t=this.targetViewer.getCamera().position;return e.containsPoint(t)}},{key:"animateFocus",value:function(e,t){var n=this;if(!this.focusAnim){var i=this.viewer.getCamera().position;this.focusAnim=Autodesk.Viewing.Private.fadeValue(0,1,this.focusDuration,(function(t){if(n.toolActive){var r=e?n.getFuzzyBoundsCenter():n.getAvatarPositionOn2DSheet();if(r){t=Autodesk.Viewing.Private.smootherStep(t);var o=i.clone().lerp(r,t);n.setCameraPosition(o,e)}}}),(function(){n.focusAnim=null,t&&t()}))}}},{key:"getAutoFocus",value:function(){return this.autoFocus}},{key:"setAutoFocus",value:function(e){this.autoFocus=e,this.updateFocus()}}],n&&Ar(t.prototype,n),c}();function Sr(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function Rr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Lr(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Pr(e,t,n){return t&&Lr(e.prototype,t),n&&Lr(e,n),e}Tr.AvatarExtension=Vr,Mr.theExtensionManager.registerExtension("Autodesk.AEC.AvatarExtension",Vr);var Or=function(){function e(t,n,i){Rr(this,e),this.viewport=t,this.mapMatrix=n,this.mapMatrixInv=n.clone().invert(),this.levelGuid=i,this.thumbnail=void 0}var t,n;return Pr(e,[{key:"getSheetNode",value:(t=regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._sheetNode){e.next=4;break}return e.next=3,this.viewport.getParentSheetNode();case 3:this._sheetNode=e.sent;case 4:return e.abrupt("return",this._sheetNode);case 5:case"end":return e.stop()}}),e,this)})),n=function(){var e=this,n=arguments;return new Promise((function(i,r){var o=t.apply(e,n);function s(e){Sr(o,i,r,s,a,"next",e)}function a(e){Sr(o,i,r,s,a,"throw",e)}s(void 0)}))},function(){return n.apply(this,arguments)})}]),e}(),Dr=function(){function e(){Rr(this,e)}return Pr(e,null,[{key:"computeMapMatrix",value:function(e,t){var n=e.getViewportBounds(1),i=ie.remapRectangle(n.min.x,n.min.y,n.max.x,n.max.y,-1,-1,1,1),r=e.get3DTo2DMatrix(1),o=(new THREE.Matrix4).multiplyMatrices(i,r);if(e.isMatrixInLocalCoords()){var s=t.getInverseModelToViewerTransform();s&&o.multiply(s)}return o}},{key:"createSheetMapConfigs",value:function(t,n,i,r){for(var o=[],s=0;s<t.length;s++){var a=t[s];if(a.getDocumentNode()){var c=i.findViewportsInLevel(a,n);r&&(c=c.filter((function(e){return e instanceof Autodesk.AEC.ViewportsExtension.AecModelDataViewport})));for(var u=0;u<c.length;u++){var l=c[u],h=e.computeMapMatrix(l,a),d=new Or(l,h,n);o.push(d)}}}return o}}]),e}();function Ir(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var Nr=(new THREE.Box3).setFromPoints([new THREE.Vector3(-1e20,-1e20,-1e20),new THREE.Vector3(1e20,1e20,1e20)]),kr=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.viewer=t,this.options=n}var t,n;return t=e,n=[{key:"updateSheetAppearance",value:function(e,t){var n=this;if(this.viewer.model){var i=t?.8:0,r=e&&e.viewportBounds;t&&this.updateCrop(t,r),this.animateOpacity(this.viewer.model,i,(function(){n.updateCrop(t,r)}))}}},{key:"setVisibilityImmediate",value:function(e){var t=this;this.viewer.getAllModels().forEach((function(n){n.fadeAnim&&(n.fadeAnim.stop(),n.fadeAnim=null),t.setModelOpacity(n,e?1:0)}))}},{key:"animateOpacity",value:function(e,t,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Mn;if(e){e.fadeAnim&&(e.fadeAnim.stop(),e.fadeAnim=null);var o=e.opacity||0,s=function(n){n=Autodesk.Viewing.Private.smootherStep(n);var r=Autodesk.Viewing.Private.lerp(o,t,n);i.setModelOpacity(e,r)},a=function(){e.fadeAnim=null,n&&n()};e.fadeAnim=Autodesk.Viewing.Private.fadeValue(0,1,r,s,a),e.fadeAnim.targetValue=t}}},{key:"setModelOpacity",value:function(e,t){if(this.options.hideSheetWhenNotFocused&&e){var n=this.viewer.impl.matman().getModelMaterials(e).mats,i=!1;Object.keys(n).forEach((function(e){n[e].uniforms&&n[e].uniforms.opacity&&n[e].uniforms.opacity.value!==t&&(n[e].uniforms.opacity.value=t,i=!0)})),e.opacity=t,i&&(this.viewer.dispatchEvent({type:bn.SHEET_VISIBILITY_CHANGED_EVENT,model:e,value:t}),this.viewer.impl.invalidate(!0))}}},{key:"expandCropBounds",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mn,i=e.viewportBounds,r=this.viewer.model.getBoundingBox(),o=new THREE.Box2,s=function(e){e=Autodesk.Viewing.Private.smootherStep(e),o.min.lerpVectors(i.min,r.min,e),o.max.lerpVectors(i.max,r.max,e),t.updateCrop(!0,o)};Autodesk.Viewing.Private.fadeValue(0,1,n,s)}},{key:"updateCrop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nr;if(this.options.cropToViewport){var n,i=this.viewer.model;if(!i)return;i.latestCropBounds||(i.latestCropBounds=new THREE.Box3),n=e?t:Nr,i.latestCropBounds.equals(n)||(i.latestCropBounds=n.clone(),this.viewer.impl.setViewportBounds(i,n.isEmpty()?null:n))}}},{key:"isSheetVisible",value:function(){var e,t;return 0!==(null===(e=this.viewer)||void 0===e||null===(t=e.model)||void 0===t?void 0:t.opacity)}},{key:"setSheetOpaque",value:function(e){var t=this;this.animateOpacity(this.viewer.model,1,void 0,e),Autodesk.Viewing.Private.fadeValue(0,1,e,(function(e){e=Autodesk.Viewing.Private.smootherStep(e);var n=Autodesk.Viewing.Private.lerp(0,1,e);t.viewer.impl&&t.viewer.setBackgroundOpacity(n)}))}}],n&&Ir(t.prototype,n),e}();function Br(e){return Br="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Br(e)}function Fr(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function jr(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Fr(o,i,r,s,a,"next",e)}function a(e){Fr(o,i,r,s,a,"throw",e)}s(void 0)}))}}function zr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ur(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Gr(e,t){return Gr=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Gr(e,t)}function Yr(e,t){return!t||"object"!==Br(t)&&"function"!=typeof t?Wr(e):t}function Wr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Hr(e){return Hr=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Hr(e)}var Kr=Autodesk.Viewing,qr=Kr.Private.Empty2DModelLoader,Qr=AutodeskNamespace("Autodesk.AEC"),Zr=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gr(e,t)}(c,Autodesk.Viewing.Extension);var t,n,i,r,o,s,a=(o=c,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Hr(o);if(s){var n=Hr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Yr(this,e)});function c(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};zr(this,c),(t=a.call(this,e,n)).options=t.options.sheetSyncOptions||t.options,t.targetViewer=t.options.targetViewer,t.sheetMap=null,t.targetModels=[],t.mapCache={},t.modelIdToFuzzyBox=[],t.isModelLoadingMap={};var i=void 0===t.options.showSheet||t.options.showSheet;return t.setShowSheet(i),t.sheetVisibilityManager=new kr(t.viewer,t.options),t.onNavigationToolChanged=t.onNavigationToolChanged.bind(Wr(t)),t.onSheetGeometryLoaded=t.onSheetGeometryLoaded.bind(Wr(t)),t.on3dGeometryLoaded=t.on3dGeometryLoaded.bind(Wr(t)),t.updateSheetAppearance=t.updateSheetAppearance.bind(Wr(t)),t.isCameraInsideMap=t.isCameraInsideMap.bind(Wr(t)),t.onModelTransformChanged=t.onModelTransformChanged.bind(Wr(t)),t.update=t.update.bind(Wr(t)),t.onViewportDataFetched=t.onViewportDataFetched.bind(Wr(t)),t}return t=c,n=[{key:"load",value:(r=jr(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.targetViewer.loadExtension("Autodesk.AEC.ViewportsExtension");case 2:return this.viewportsExtension=e.sent,this.targetViewer.addEventListener(Kr.NAVIGATION_MODE_CHANGED_EVENT,this.onNavigationToolChanged),this.onNavigationToolChanged(),e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"unload",value:function(){return this.deactivate(),this.viewportsExtension=null,this.sheetVisibilityManager.setVisibilityImmediate(!0),this.sheetVisibilityManager.updateCrop(null),this.changePaperVisibility(!0),this.sheetMap=null,this.targetModels=[],this.targetViewer.removeEventListener(Kr.NAVIGATION_MODE_CHANGED_EVENT,this.onNavigationToolChanged),!0}},{key:"onViewportDataFetched",value:function(){this.invalidateSheetMaps()}},{key:"changePaperVisibility",value:function(e,t){this.options.hidePaper&&((t=t||this.viewer.getAllModels()).forEach((function(t){t.changePaperVisibility(e)})),this.viewer.impl.invalidate(!0))}},{key:"activate",value:function(){this.active||(this.active=!0,this.addListeners(),this.on3dGeometryLoaded(),this.changePaperVisibility(!1))}},{key:"deactivate",value:function(){this.active&&(this.active=!1,this.sheetMap=null,this.removeListeners())}},{key:"addListeners",value:function(){var e,t;this.targetViewer.addEventListener(Kr.MODEL_ADDED_EVENT,this.update),this.targetViewer.addEventListener(Kr.MODEL_REMOVED_EVENT,this.update),this.targetViewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.update),this.targetViewer.addEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged),this.targetViewer.addEventListener(Kr.GEOMETRY_LOADED_EVENT,this.on3dGeometryLoaded),this.targetViewer.addEventListener(Autodesk.AEC.LevelsExtension.LEVEL_CHANGED,this.updateSheetAppearance),this.viewer.addEventListener(Kr.MODEL_ROOT_LOADED,this.onSheetGeometryLoaded),this.viewer.addEventListener(Kr.GEOMETRY_LOADED_EVENT,this.onSheetGeometryLoaded),this.viewer.addEventListener(Kr.TEXTURES_LOADED_EVENT,this.onSheetGeometryLoaded),this.viewer.addEventListener(bn.MAIN_MAP_CHANGED_EVENT,this.updateSheetAppearance),this.viewportsExtension.addEventListener(Autodesk.AEC.ViewportsExtension.Events.VIEWPORT_DATA_FETCHED_EVENT,this.onViewportDataFetched);var n=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension");null==n||null===(e=n.floorSelector)||void 0===e||e.addEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.update),null==n||null===(t=n.floorSelector)||void 0===t||t.addEventListener(Autodesk.AEC.FloorSelector.FLOOR_DATA_CHANGED,this.onViewportDataFetched)}},{key:"removeListeners",value:function(){var e,t;this.targetViewer.removeEventListener(Kr.MODEL_ADDED_EVENT,this.update),this.targetViewer.removeEventListener(Kr.MODEL_REMOVED_EVENT,this.update),this.targetViewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.update),this.targetViewer.removeEventListener(Autodesk.Viewing.MODEL_TRANSFORM_CHANGED_EVENT,this.onModelTransformChanged),this.targetViewer.removeEventListener(Kr.GEOMETRY_LOADED_EVENT,this.on3dGeometryLoaded),this.targetViewer.removeEventListener(Autodesk.AEC.LevelsExtension.LEVEL_CHANGED,this.updateSheetAppearance),this.viewer.removeEventListener(Kr.MODEL_ROOT_LOADED,this.onSheetGeometryLoaded),this.viewer.removeEventListener(Kr.GEOMETRY_LOADED_EVENT,this.onSheetGeometryLoaded),this.viewer.removeEventListener(Kr.TEXTURES_LOADED_EVENT,this.onSheetGeometryLoaded),this.viewer.removeEventListener(bn.MAIN_MAP_CHANGED_EVENT,this.updateSheetAppearance),this.viewportsExtension.removeEventListener(Autodesk.AEC.ViewportsExtension.Events.VIEWPORT_DATA_FETCHED_EVENT,this.onViewportDataFetched);var n=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension");null==n||null===(e=n.floorSelector)||void 0===e||e.removeEventListener(Autodesk.AEC.FloorSelector.SELECTED_FLOOR_CHANGED,this.update),null==n||null===(t=n.floorSelector)||void 0===t||t.removeEventListener(Autodesk.AEC.FloorSelector.FLOOR_DATA_CHANGED,this.onViewportDataFetched)}},{key:"isEnabled",value:function(){var e;return"bimwalk"===this.targetViewer.getActiveNavigationTool()||(null===(e=this.targetViewer.getExtension("Autodesk.AEC.Minimap3DExtension"))||void 0===e?void 0:e.isEnabled())}},{key:"onNavigationToolChanged",value:function(){this.isEnabled()?this.activate():this.deactivate(),this.update()}},{key:"updateSheetAppearance",value:function(){if(this.isSheetMapLoaded(this.sheetMap)&&this.isMapOnCurrentLevel(this.sheetMap)){var e=this.showSheet&&this.isCameraInsideMap(this.sheetMap)&&this.isEnabled();this.sheetVisibilityManager.updateSheetAppearance(this.sheetMap,e)}else this.sheetVisibilityManager.setVisibilityImmediate(!1),this.sheetVisibilityManager.updateCrop(null)}},{key:"getFuzzyBox",value:function(){for(var e=new THREE.Box3,t=0;t<this.targetModels.length;t++){var n=this.targetModels[t],i=this.modelIdToFuzzyBox[n.id];i||(i=n.getFuzzyBox(),n.isLoadDone()&&(this.modelIdToFuzzyBox[n.id]=i)),e.union(i)}return e}},{key:"generateDummyMap",value:function(){if(!this.sheetMap){var e=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension"),t=e&&e.getCurrentLevel(),n=t&&e.getZRange(t.index),i=this.getFuzzyBox();if(!i.isEmpty()){var r=n?n.zMin:i.min.z,o=n?n.zMax:i.max.z;i.min.z=0,i.max.z=0;var s=this.viewer.impl.renderer(),a=s.settings.logicalWidth,c=s.settings.logicalHeight,u=new Kr.UnifiedCamera(a,c);gn(u,i,r,o,i.getSize(new THREE.Vector3).y);var l=new THREE.Matrix4;!function(e,t){t.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse)}(u,l);var h=l.clone().invert(),d=this.viewer.clientToWorld(0,0,void 0,!0).point,p=this.viewer.clientToWorld(a,c,void 0,!0).point,g=(new THREE.Box3).setFromPoints([d,p]);this.sheetMap={viewportBounds:g,mapMatrix:l,mapMatrixInv:h,viewport:{getGuid:function(){return"dummyViewportGuid"},getSheetName:function(){return"dummySheetName"},getSheetUrn:function(){return"dummySheetUrn"}}},this.viewer.dispatchEvent({type:bn.MAIN_MAP_CHANGED_EVENT,sheetMap:this.sheetMap}),this.update()}}}},{key:"on3dGeometryLoaded",value:function(){this.updateTargetModels(),this.targetModels&&(this.generateDummyMap(),this.update())}},{key:"onSheetGeometryLoaded",value:function(e){var t=e.model;this.changePaperVisibility(!1,[t]),this.update()}},{key:"invalidateSheetMaps",value:function(){var e=this;Object.keys(this.mapCache).forEach((function(t){Dr.createSheetMapConfigs(e.targetModels,t,e.viewportsExtension,e.options.useOnlyAecModelDataViewports).forEach((function(n){var i,r=e.mapCache[t].find((function(e){return e.viewport.getGuid()===n.viewport.getGuid()}));r?(r.mapMatrix=n.mapMatrix,r.mapMatrixInv=n.mapMatrixInv,(null===(i=r.thumbnail)||void 0===i?void 0:i.mesh)&&(r.thumbnail.mesh.dirty=!0)):(n.viewportBounds=n.viewport.getViewportBounds(e.viewer.model.getUnitScale()),e.mapCache[t].push(n))}))})),this.update(),this.viewer.dispatchEvent({type:bn.MAIN_MAP_CHANGED_EVENT,sheetMap:this.sheetMap})}},{key:"onModelTransformChanged",value:function(e){var t=e.model;this.targetModels.includes(t)&&(this.modelIdToFuzzyBox[t.id]=null,this.invalidateSheetMaps())}},{key:"updateTargetModels",value:function(){if(!this.options.useCustomModel){var e=this.targetViewer.getVisibleModels().filter((function(e){return e.is3d()}));this.setTargetModels(e)}}},{key:"setTargetModels",value:function(e){this.targetModels=e}},{key:"getSheetNodeKey",value:function(e){return e&&"".concat(e.viewport.getSheetUrn(),"_").concat(e.viewport.getSheetName())}},{key:"isLoadingSheetNode",value:function(e){var t=this.getSheetNodeKey(e);return t&&this.isModelLoadingMap[t]}},{key:"shouldSwitchSheet",value:function(){var e=this.showSheet,t=this.options.autoSwitchSheet,n=!this.isSheetMapLoaded(this.sheetMap),i=this.isCameraInsideMap(this.sheetMap),r=this.isLoadingSheetNode(this.sheetMap),o=this.options.minimapDebugMode;return t&&n&&e&&i&&!r&&!o}},{key:"getCurrentLevel",value:function(){var e=this.targetViewer.getExtension("Autodesk.AEC.LevelsExtension");if(e)return e.getCurrentLevel()}},{key:"update",value:function(){this.viewer.model&&this.getCurrentLevel()&&this.isEnabled()&&(this.updateTargetModels(),this.updateSheetMaps(),this.updateSheetAppearance(),this.switchSheetIfNeededDebounce())}},{key:"switchSheetIfNeededDebounce",value:function(){this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.debounceTimeout=setTimeout(this.switchSheetIfNeeded.bind(this),300)}},{key:"getCustomHash",value:function(){return"sheetsync_".concat(this.viewer.id)}},{key:"switchSheetIfNeeded",value:(i=jr(regeneratorRuntime.mark((function e(){var t,n,i,r,o,s,a,c,u=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shouldSwitchSheet()){e.next=16;break}return this.viewer.dispatchEvent({type:bn.CHANGING_SHEET_EVENT}),t=this.viewer.model,n=this.sheetMap,e.next=6,this.sheetMap.getSheetNode();case 6:if(i=e.sent,n===this.sheetMap){e.next=9;break}return e.abrupt("return");case 9:r=i.getRootNode().getDocument(),o=this.options.hideSheetWhenNotFocused?0:1,s=this.options.loadDocumentNode||this.viewer.loadDocumentNode.bind(this.viewer),a=this.options.unloadModel||this.viewer.unloadModel.bind(this.viewer),c=this.getSheetNodeKey(n),this.isModelLoadingMap[c]=!0,s(r,i,{opacity:o,preserveView:!0,keepCurrentModels:!0,loadAsHidden:!0,customHash:this.getCustomHash()}).catch((function(e){return console.error("Failed to load sheet: ",i.name(),": ",e)})).then((function(e){t&&t!==e&&(t.loader instanceof qr?u.viewer.unloadModel(t):a(t)),u.isModelLoadingMap[c]=!1,u.viewer.showModel(e,!0),u.viewer.navigation.setConstraints2D(),u.sheetVisibilityManager.setVisibilityImmediate(!1),n.viewportBounds=n.viewport.getViewportBounds(e.getUnitScale()),n.model=e,u.update(),u.viewer.dispatchEvent({type:bn.MAIN_MAP_CHANGED_EVENT,sheetMap:n})}));case 16:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"isSheetMapsEqual",value:function(e,t){return(null==e?void 0:e.viewport.getGuid())===(null==t?void 0:t.viewport.getGuid())}},{key:"isMapOnCurrentLevel",value:function(e){if(!e)return!1;var t=this.getCurrentLevel();return!(!t||e.levelGuid!==t.guid)}},{key:"isSheetMapLoaded",value:function(e){return(null==e?void 0:e.model)===this.viewer.model}},{key:"isCameraInsideMap",value:function(e){return!!e&&!!this.isMapOnCurrentLevel(e)&&!(!this.options.autoSwitchSheet&&!this.isSheetMapLoaded(e))&&(t=this.targetViewer.getCamera().position,n=e.mapMatrix,i=(pn=pn||new THREE.Vector3).copy(t).applyProjection(n),Math.abs(i.x)<1&&Math.abs(i.y)<1);var t,n,i}},{key:"updateSheetMaps",value:function(){var e,t=this.getCurrentLevel();if(this.mapCache[t.guid])e=this.mapCache[t.guid];else{e=Dr.createSheetMapConfigs(this.targetModels,t.guid,this.viewportsExtension,this.options.useOnlyAecModelDataViewports);var n=this.viewer.model,i=n.getDocumentNode();e.forEach((function(e){e.viewportBounds=e.viewport.getViewportBounds(n.getUnitScale()),e.viewport.getSheetName()===i.name()&&e.viewport.getSheetUrn()===i.urn(!0)&&(e.model=n)})),this.mapCache[t.guid]=e}var r=e.find(this.isCameraInsideMap)||(this.options.cropToViewport?this.sheetMap:void 0),o=!this.isSheetMapsEqual(this.sheetMap,r);this.sheetMap=r,o&&this.viewer.dispatchEvent({type:bn.MAIN_MAP_CHANGED_EVENT,sheetMap:this.sheetMap})}},{key:"setShowSheet",value:function(e){e&&!Xn.isSheetMapSupported()||(this.showSheet=e,this.active&&this.update())}},{key:"getShowSheet",value:function(){return this.showSheet}},{key:"isSheetVisible",value:function(){return this.showSheet&&this.isSheetMapLoaded(this.sheetMap)&&this.sheetVisibilityManager.isSheetVisible()&&this.viewer.model.isLoadDone()}},{key:"expandCropBounds",value:function(e){this.sheetVisibilityManager.expandCropBounds(this.sheetMap,e)}},{key:"setSheetOpaque",value:function(e){this.sheetVisibilityManager.setSheetOpaque(e)}}],n&&Ur(t.prototype,n),c}();function Jr(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function Xr(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Jr(o,i,r,s,a,"next",e)}function a(e){Jr(o,i,r,s,a,"throw",e)}s(void 0)}))}}function $r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function eo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}Object.assign(Qr,{SheetSyncEvents:bn}),Qr.SheetSyncExtension=Zr,Kr.theExtensionManager.registerExtension("Autodesk.AEC.SheetSyncExtension",Zr);var to=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$r(this,e),this.options=t}var t,n,i,r,o;return t=e,n=[{key:"fetchViewports",value:(o=Xr(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"fetchViewports not implemented";case 1:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"deleteViewport",value:(r=Xr(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"deleteViewport not implemented";case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})}],i=[{key:"getProviderName",value:function(){throw"getProviderName not implemented"}}],n&&eo(t.prototype,n),i&&eo(t,i),e}();function no(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function io(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){no(o,i,r,s,a,"next",e)}function a(e){no(o,i,r,s,a,"throw",e)}s(void 0)}))}}function ro(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var so=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;ro(this,e),this.viewportRaw=t,this.viewportName=n,this.sheetUrn=i,this.lineageUrn=Autodesk.Viewing.BubbleNode.parseLineageUrnFromEncodedUrn(i),this.sheetName=r,this.options=o}var t,n,i,r,o;return t=e,n=[{key:"getGuid",value:function(){throw"getGuid not implemented"}},{key:"isMatrixInLocalCoords",value:function(){throw"isMatrixInLocalCoords not implemented"}},{key:"getSheetUrn",value:function(){return this.sheetUrn}},{key:"getSheetLineageUrn",value:function(){return this.lineageUrn}},{key:"getSheetName",value:function(){return this.sheetName}},{key:"getName",value:function(){return this.viewportName}},{key:"getViewportBounds",value:function(){throw"getViewportBounds not implemented"}},{key:"get2DTo3DMatrix",value:function(){throw"get2DTo3DMatrix not implemented"}},{key:"get3DTo2DMatrix",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.get2DTo3DMatrix(e).clone();return t.invert()}},{key:"getParentSheetNode",value:(o=io(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"getParentSheetNode not implemented";case 1:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"get3DNodesForViewport",value:(r=io(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"get3DNodesForViewport not implemented";case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"getRelatedModel3DInfo",value:(i=io(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw"getRelatedModel3DInfo not implemented";case 1:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"findLevelForViewport",value:function(){throw"findLevelForViewport not implemented"}},{key:"isViewportInLevel",value:function(e){throw"isViewportInLevel not implemented"}},{key:"supports2DTo3DTransform",value:function(){throw"supports2DTo3DTransform not implemented"}},{key:"isTopViewViewport",value:function(){throw"isTopViewViewport not implemented"}},{key:"isFloorPlan",value:function(){throw"isFloorPlan not implemented"}},{key:"getElevation",value:function(){return this.get2DTo3DMatrix().elements[14]}}],n&&oo(t.prototype,n),e}();function ao(e){return ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ao(e)}function co(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function uo(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){co(o,i,r,s,a,"next",e)}function a(e){co(o,i,r,s,a,"throw",e)}s(void 0)}))}}function lo(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ho(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function po(e,t){return po=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},po(e,t)}function go(e,t){return!t||"object"!==ao(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function fo(e){return fo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},fo(e)}var vo=Autodesk.AEC.AecModelData,yo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&po(e,t)}(c,e);var t,n,i,r,o,s,a=(o=c,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=fo(o);if(s){var n=fo(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return go(this,e)});function c(){var e;lo(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=a.call.apply(a,[this].concat(n))).sheetNode=e.options.sheetNode,e.aecModelData=e.options.aecModelData,e}return t=c,n=[{key:"getGuid",value:function(){return this.viewportRaw.viewportGuid}},{key:"isMatrixInLocalCoords",value:function(){return!0}},{key:"getViewportBounds",value:function(e){return e?vo.getViewportBounds(this.viewportRaw,e):(console.error("Unit scale must be provided"),null)}},{key:"get2DTo3DMatrix",value:function(e){if(!e)return console.error("Unit scale must be provided"),null;var t=vo.get2DTo3DMatrix(this.viewportRaw,e);if(this.isFloorPlan()){var n=this.findLevelForViewport();if(n){var i=new THREE.Vector3;i.setFromMatrixPosition(t),i.z=n.elevation+1/120,t=t.clone().setPosition(i)}}return t}},{key:"getParentSheetNode",value:(r=uo(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sheetNode);case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"get3DNodesForViewport",value:(i=uo(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=this.sheetNode.getRootNode().search(Autodesk.Viewing.BubbleNode.MODEL_NODE)).length||console.error("That shouldn't happen - No AEC views"),e.abrupt("return",t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"findLevelForViewport",value:function(){return vo.findLevelForViewport(this.aecModelData,this.viewportRaw)}},{key:"isViewportInLevel",value:function(e){var t=vo.getLinkedLevel(this.viewportRaw);return e.guid===t}},{key:"supports2DTo3DTransform",value:function(){return vo.supports2DTo3DTransform(this.viewportRaw)}},{key:"isTopViewViewport",value:function(){return vo.TopViewViewportTypes.includes(this.viewportRaw.viewType)}},{key:"isFloorPlan",value:function(){return"FloorPlan"===this.viewportRaw.viewType}}],n&&ho(t.prototype,n),c}(so);function mo(e){return mo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mo(e)}function _o(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function Eo(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){_o(o,i,r,s,a,"next",e)}function a(e){_o(o,i,r,s,a,"throw",e)}s(void 0)}))}}function Ao(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Co(e,t){return Co=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Co(e,t)}function wo(e,t){return!t||"object"!==mo(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function bo(e){return bo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},bo(e)}var Mo=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Co(e,t)}(u,e);var t,n,i,r,o,s,a,c=(s=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=bo(s);if(a){var n=bo(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return wo(this,e)});function u(){return Ao(this,u),c.apply(this,arguments)}return t=u,n=[{key:"fetchViewports",value:(o=Eo(regeneratorRuntime.mark((function e(t){var n,i,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.getRootNode(),i=n.getAecModelData(),r=t.is2D()?Autodesk.AEC.AecModelData.findViewportsOnSheet(t):null==i?void 0:i.viewports){e.next=5;break}return e.abrupt("return",[]);case 5:return o=r.map((function(e){var t=n.search({guid:e.sheetGuid})[0];if(t){var r=t.name(),o=n.urn();return new yo(e,r,o,r,{aecModelData:i,sheetNode:t})}console.warn("Shouldn't happen - couldn't find corresponding sheet.")})),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"deleteViewport",value:(r=Eo(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("Viewport deletion not allowed for AecModelData"),e.abrupt("return",!1);case 2:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})}],i=[{key:"getProviderName",value:function(){return"AecModelDataViewportProvider"}}],n&&xo(t.prototype,n),i&&xo(t,i),u}(to);function To(e){return To="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},To(e)}function Vo(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function So(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Vo(o,i,r,s,a,"next",e)}function a(e){Vo(o,i,r,s,a,"throw",e)}s(void 0)}))}}function Ro(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Lo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Po(e,t){return Po=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Po(e,t)}function Oo(e,t){return!t||"object"!==To(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Do(e){return Do=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Do(e)}var Io=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Po(e,t)}(u,e);var t,n,i,r,o,s,a,c=(s=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Do(s);if(a){var n=Do(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Oo(this,e)});function u(){var e;Ro(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=c.call.apply(c,[this].concat(n))).fetchSheetNodeForViewport=e.options.fetchSheetNodeForViewport,e.fetch3DNodeForViewport=e.options.fetch3DNodeForViewport,e.getModel3DInfoRelatedToViewport=e.options.getModel3DInfoRelatedToViewport,e}return t=u,n=[{key:"getGuid",value:function(){return this.viewportRaw.regionId}},{key:"isMatrixInLocalCoords",value:function(){return!1}},{key:"getViewportBounds",value:function(){return this.viewportRaw.boundingBox}},{key:"get2DTo3DMatrix",value:function(){return this.viewportRaw.transform}},{key:"getParentSheetNode",value:(o=So(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.parentSheetNodePromise||(this.parentSheetNodePromise=this.fetchSheetNodeForViewport(this)),e.abrupt("return",this.parentSheetNodePromise);case 2:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"get3DNodesForViewport",value:(r=So(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fetch3DNodeForViewport(this));case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getRelatedModel3DInfo",value:(i=So(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getModel3DInfoRelatedToViewport(this));case 1:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"findLevelForViewport",value:function(){return this.isTopViewViewport()?{elevation:this.getElevation()}:null}},{key:"isViewportInLevel",value:function(e){if(!this.isTopViewViewport())return!1;var t=this.getElevation();return t>e.zMin&&t<e.zMax}},{key:"supports2DTo3DTransform",value:function(){return!!this.options.supports2DTo3DTransform}},{key:"isTopViewViewport",value:function(){if(void 0===this._topViewViewport){var e=this.get2DTo3DMatrix(),t=(new THREE.Matrix3).getNormalMatrix(e),n=new THREE.Vector3(0,0,1),i=n.clone().applyMatrix3(t).angleTo(n);i>=Math.PI&&(i-=Math.PI),this._topViewViewport=Math.abs(i)<.05}return this._topViewViewport}},{key:"isFloorPlan",value:function(){return this.isTopViewViewport()}}],n&&Lo(t.prototype,n),u}(so);function No(e){return No="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},No(e)}function ko(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Bo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bo(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function Fo(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function jo(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Fo(o,i,r,s,a,"next",e)}function a(e){Fo(o,i,r,s,a,"throw",e)}s(void 0)}))}}function zo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Uo(e,t){return Uo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Uo(e,t)}function Go(e,t){return!t||"object"!==No(t)&&"function"!=typeof t?Yo(e):t}function Yo(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Wo(e){return Wo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Wo(e)}var Ho=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Uo(e,t)}(f,e);var t,n,i,r,o,s,a,c,u,l,h,d,p,g=(d=f,p=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Wo(d);if(p){var n=Wo(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Go(this,e)});function f(e){var t;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),(t=g.call(this,e)).service=t.options.service,t.getVersionUrn=t.options.getVersionUrn,t.loadDocument=t.options.loadDocument,!t.service||!t.getVersionUrn||!t.loadDocument)throw console.error("One of AlignmentServiceViewportProvider callbacks is missing."),"AlignmentServiceViewportProvider callbacks is missing";return t.getModel3DInfoRelatedToViewport=t.getModel3DInfoRelatedToViewport.bind(Yo(t)),t.fetch3DNodeForViewport=t.fetch3DNodeForViewport.bind(Yo(t)),t.fetchSheetNodeForViewport=t.fetchSheetNodeForViewport.bind(Yo(t)),t}return t=f,n=[{key:"fetchViewports",value:(h=jo(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.is2D()?this.fetchViewportsFromBubble2D(t):this.fetchViewportsFromBubble3D(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"fetchViewportsFromBubble2D",value:(l=jo(regeneratorRuntime.mark((function e(t){var n,i,r,o,s,a,c=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name(),i=t.lineageUrn(),e.prev=2,e.next=5,this.getVersionUrn(i);case 5:r=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),console.log("Could not get latest version. Probably no permission or document has been deleted"),e.abrupt("return",[]);case 12:return o=Autodesk.Viewing.Private.toUrlSafeBase64(r),e.next=15,this.service.loadRegions(o,n);case 15:if((s=e.sent)&&s.length){e.next=18;break}return e.abrupt("return",[]);case 18:return e.next=20,Promise.all(s.map(function(){var e=jo(regeneratorRuntime.mark((function e(t){var r,s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.service.getRelationships(Autodesk.AlignmentService.RelationshipEntityTypes.Region,i,n,t.regionId);case 2:return r=e.sent,s=r.length>0,a=c._createViewport(t,n,o,n,s),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 20:return a=e.sent,e.abrupt("return",a);case 22:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(e){return l.apply(this,arguments)})},{key:"fetchViewportsFromBubble3D",value:(u=jo(regeneratorRuntime.mark((function e(t){var n,i,r,o,s,a,c,u,l,h,d,p,g,f,v,y,m,_,E,A;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.lineageUrn(),i=t.name(),e.prev=2,e.next=5,this.service.getRelationships(Autodesk.AlignmentService.RelationshipEntityTypes.Model3D,n,i);case 5:r=e.sent,e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),console.warn("getRelationships Error: "+e.t0),e.abrupt("return",[]);case 12:o=[],s=0;case 14:if(!(s<r.length)){e.next=46;break}if(a=r[s],c=a.entities.find((function(e){return e.type===Autodesk.AlignmentService.RelationshipEntityTypes.Region}))){e.next=20;break}return console.warn("Related model not found"),e.abrupt("continue",43);case 20:return u=c.id.split("?"),l=ko(u,2),h=l[0],d=l[1],p=d.slice(Autodesk.AlignmentService.RelationshipIdPrefix.Name.length),g=p.split(Autodesk.AlignmentService.RelationshipIdPrefix.Region),f=ko(g,2),v=f[0],y=f[1],m=void 0,e.prev=24,e.next=27,this.getVersionUrn(h);case 27:m=e.sent,e.next=34;break;case 30:return e.prev=30,e.t1=e.catch(24),console.log("Could not get latest version for alignment relationship. Probably no permission or document has been deleted"),e.abrupt("continue",43);case 34:return _=Autodesk.Viewing.Private.toUrlSafeBase64(m),e.next=37,this.service.loadRegion(_,v,y);case 37:if(E=e.sent){e.next=41;break}return console.warn("Viewport not found.",_,v,y),e.abrupt("continue",43);case 41:A=this._createViewport(E,v,_,v,!0),o.push(A);case 43:s++,e.next=14;break;case 46:return e.abrupt("return",o);case 47:case"end":return e.stop()}}),e,this,[[2,8],[24,30]])}))),function(e){return u.apply(this,arguments)})},{key:"fetchSheetNodeForViewport",value:(c=jo(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetchBubbleNode(t.getSheetUrn(),t.getSheetName());case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"getModel3DInfoRelatedToViewport",value:(a=jo(regeneratorRuntime.mark((function e(t){var n,i,r,o,s,a,c,u,l,h,d,p,g;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.getSheetLineageUrn(),r=t.getSheetName(),o=t.getGuid(),e.prev=3,e.next=6,this.service.getRelationships(Autodesk.AlignmentService.RelationshipEntityTypes.Region,i,r,o);case 6:a=e.sent,c=ko(a,1),s=c[0],e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(3),console.warn("No relationship found. Error: "+e.t0),e.t0;case 15:if(u=null===(n=s)||void 0===n?void 0:n.entities.find((function(e){return e.type===Autodesk.AlignmentService.RelationshipEntityTypes.Model3D}))){e.next=18;break}throw"No related model found for sheet-model transition";case 18:return l=u.id.split("?"),h=ko(l,2),d=h[0],p=h[1],e.prev=19,e.next=22,this.getVersionUrn(d);case 22:g=e.sent,e.next=29;break;case 25:throw e.prev=25,e.t1=e.catch(19),console.log("Could not get latest version for alignment relationship. Probably no permission or document has been deleted"),e.t1;case 29:return e.abrupt("return",{versionUrn3D:g,lineageUrn3D:d,name3D:p});case 30:case"end":return e.stop()}}),e,this,[[3,11],[19,25]])}))),function(e){return a.apply(this,arguments)})},{key:"fetch3DNodeForViewport",value:(s=jo(regeneratorRuntime.mark((function e(t){var n,i,r,o,s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getModel3DInfoRelatedToViewport(t);case 2:return n=e.sent,i=n.versionUrn3D,r=n.name3D,o=Autodesk.Viewing.toUrlSafeBase64(i),s=decodeURIComponent(r.slice(Autodesk.AlignmentService.RelationshipIdPrefix.Name.length)),e.next=9,this._fetchBubbleNode(o,s);case 9:return a=e.sent,e.abrupt("return",[a]);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"deleteViewport",value:(o=jo(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.service.deleteRegion(t.lineageUrn,t.sheetUrn,t.sheetName,t.viewportRaw.regionId);case 2:return e.abrupt("return",!0);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"_createViewport",value:function(e,t,n,i,r){var o={getModel3DInfoRelatedToViewport:this.getModel3DInfoRelatedToViewport,fetch3DNodeForViewport:this.fetch3DNodeForViewport,fetchSheetNodeForViewport:this.fetchSheetNodeForViewport,supports2DTo3DTransform:r};return new Io(e,t,n,i,o)}},{key:"_fetchBubbleNode",value:(r=jo(regeneratorRuntime.mark((function e(t,n){var i,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.loadDocument(t);case 3:i=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),"Could not load document";case 9:return r=i.getRoot(),o=r.search({type:"geometry",name:n}),e.abrupt("return",o[0]);case 12:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(e,t){return r.apply(this,arguments)})}],i=[{key:"getProviderName",value:function(){return"AlignmentServiceViewportProvider"}}],n&&zo(t.prototype,n),i&&zo(t,i),f}(to),Ko={en:JSON.parse('{"@@locale":"en","@@context":"Viewports Extension","Level":"Level"}'),"en-GB":JSON.parse('{"@@locale":"en","@@context":"Viewports Extension","Level":"Level"}'),cs:JSON.parse('{"@@locale":"cs","@@context":"Rozen vez","Level":"rove"}'),de:JSON.parse('{"@@locale":"de","@@context":"Ansichtsfenstererweiterung","Level":"Ebene"}'),es:JSON.parse('{"@@locale":"es","@@context":"Extensin de ventanas grficas","Level":"Nivel"}'),fr:JSON.parse('{"@@locale":"fr","@@context":"Extension des fentres","Level":"Niveau"}'),"fr-CA":JSON.parse('{"@@locale":"fr-CA","@@context":"Extension des fentres","Level":"Niveau"}'),it:JSON.parse('{"@@locale":"it","@@context":"Estensione finestre","Level":"Livello"}'),ja:JSON.parse('{"@@locale":"ja","@@context":"Viewports Extension","Level":""}'),ko:JSON.parse('{"@@locale":"ko","@@context":" ","Level":""}'),pl:JSON.parse('{"@@locale":"pl","@@context":"Rozszerzenie Viewports","Level":"Poziom"}'),"pt-BR":JSON.parse('{"@@locale":"ptb","@@context":"Extenso de viewports","Level":"Nvel"}'),ru:JSON.parse('{"@@locale":"ru","@@context":"  ","Level":""}'),tr:JSON.parse('{"@@locale":"tr","@@context":"Grnt Alanlar Uzants","Level":"Seviye"}'),"zh-HANS":JSON.parse('{"@@locale":"zh-Hans","@@context":"","Level":""}'),"zh-HANT":JSON.parse('{"@@locale":"zh-Hant","@@context":"Viewports ","Level":""}'),"zh-HK":JSON.parse('{"@@locale":"zh-hk","@@context":"","Level":""}'),nl:JSON.parse('{"@@locale":"nl","@@context":"Extensie viewports","Level":"Niveau"}'),sv:JSON.parse('{"@@locale":"sv","@@context":"Tillgg fr vyportar","Level":"Vning"}'),da:JSON.parse('{"@@locale":"da","@@context":"Viewports-udvidelse","Level":"Niveau"}'),no:JSON.parse('{"@@locale":"no","@@context":"Viewports-utvidelse","Level":"Niv"}')};function qo(e){return qo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},qo(e)}function Qo(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function Zo(e){return function(){var t=this,n=arguments;return new Promise((function(i,r){var o=e.apply(t,n);function s(e){Qo(o,i,r,s,a,"next",e)}function a(e){Qo(o,i,r,s,a,"throw",e)}s(void 0)}))}}function Jo(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Xo(e,t,n){return Xo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ns(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}},Xo(e,t,n||e)}function $o(e,t){return $o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},$o(e,t)}function es(e,t){return!t||"object"!==qo(t)&&"function"!=typeof t?ts(e):t}function ts(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ns(e){return ns=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ns(e)}var is=Autodesk.Viewing,rs=AutodeskNamespace("Autodesk.AEC"),os=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$o(e,t)}(l,e);var t,n,i,r,o,s,a,c,u=(a=l,c=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ns(a);if(c){var n=ns(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return es(this,e)});function l(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),n=u.call(this,e,t),is.EventDispatcher.prototype.apply(ts(n)),n.name="Viewports",n.onModelAdded=n.onModelAdded.bind(ts(n)),n.onViewportDataCreated=n.onViewportDataCreated.bind(ts(n)),n}return t=l,n=[{key:"load",value:function(){return Xo(ns(l.prototype),"load",this).call(this),this.extendLocalization(Ko),this.cache=this.getCache(),this.cache.viewports||(this.cache.viewports={}),this.providers={},this.addViewportProvider(new Mo),this.addEventListeners(),this.fetchViewportsForAllModels(),!0}},{key:"unload",value:function(){return Xo(ns(l.prototype),"unload",this).call(this),this.providers=null,this.removeEventListeners(),!0}},{key:"addViewportProvider",value:function(e){var t=e.constructor.getProviderName();this.providers[t]||(this.providers[t]=e),this.fetchViewportsForAllModels()}},{key:"removeViewportProvider",value:function(e){delete this.providers[e.constructor.getProviderName()]}},{key:"fetchViewportsForAllModels",value:function(){var e=this;this.viewer.getAllModels().forEach((function(t){return e.fetchViewports(t.getDocumentNode())}))}},{key:"addEventListeners",value:function(){this.viewer.addEventListener(is.MODEL_ADDED_EVENT,this.onModelAdded),this.addEventListener(l.Events.VIEWPORT_DATA_CREATED_EVENT,this.onViewportDataCreated)}},{key:"removeEventListeners",value:function(){this.viewer.removeEventListener(is.MODEL_ADDED_EVENT,this.onModelAdded),this.removeEventListener(l.Events.VIEWPORT_DATA_CREATED_EVENT,this.onViewportDataCreated)}},{key:"onModelAdded",value:function(e){var t=e.model;this.fetchViewports(t.getDocumentNode())}},{key:"generateLevelsFromViewports",value:(s=Zo(regeneratorRuntime.mark((function e(t){var n,i,r,o,s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getViewportsAsync(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",[]);case 5:for(i=[],n.sort((function(e,t){return e.getElevation()-t.getElevation()})),r=0;r<n.length-1;r++)Math.abs(n[r].getElevation()-n[r+1].getElevation())<1&&(n.splice(r+1,1),r--);for(o=0;o<n.length;o++)s=n[o].getElevation(),void 0,a=o===n.length-1?2147483647:n[o+1].getElevation(),i.push(new I(o,o.toString(),"".concat(Autodesk.Viewing.i18n.translate("Level")," #").concat(o+1),s-B,a));return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"onViewportDataCreated",value:function(e){var t=this;e.models.forEach((function(e){var n=e.getModelKey();t.cache.viewports[n]&&(delete t.cache.viewports[n],t.onModelAdded({model:e}))}))}},{key:"getViewportsAsync",value:(o=Zo(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchViewports(t);case 2:return e.abrupt("return",this.filterAndFlattenViewports(t,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"getViewports",value:function(e,t){return this.filterAndFlattenViewports(e,t)}},{key:"filterAndFlattenViewports",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=null===(t=i.filter2DTo3DTransformSupport)||void 0===t||t,o=null===(n=i.onlyTopViewPlans)||void 0===n||n,s=i.filterCB,a=e.getModelKey(),c=this.cache.viewports[a];if(!c)return[];var u=Object.values(c).flat();return r&&(u=u.filter((function(e){return e.supports2DTo3DTransform()}))),o&&(u=u.filter((function(e){return e.isTopViewViewport()}))),s&&(u=u.filter(s)),u}},{key:"fetchViewports",value:(r=Zo(regeneratorRuntime.mark((function e(t){var n,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return n=t.getModelKey(),this.cache.viewports[n]||(this.cache.viewports[n]={}),e.next=6,Promise.all(Object.values(this.providers).map(function(){var e=Zo(regeneratorRuntime.mark((function e(r){var o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.constructor.getProviderName(),i.cache.viewports[n][o]){e.next=11;break}return i.cache.viewports[n][o]=[],i.cache.viewports[n][o].pendingPromise=r.fetchViewports(t),e.next=6,i.cache.viewports[n][o].pendingPromise;case 6:s=e.sent,delete i.cache.viewports[n][o].pendingPromise,s.length&&(i.cache.viewports[n][o]=s,i.fireEvent({type:l.Events.VIEWPORT_DATA_FETCHED_EVENT,modelKey:n,providerName:o,viewports:s})),e.next=14;break;case 11:if(!i.cache.viewports[n][o].pendingPromise){e.next=14;break}return e.next=14,i.cache.viewports[n][o].pendingPromise;case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"findViewportAtPoint",value:function(e,t,n){var i=this.filterAndFlattenViewports(e.getDocumentNode(),n);if(!(i=(i=i.map((function(t){return{viewport:t,bounds:t.getViewportBounds(e.getUnitScale())}}))).filter((function(e){var n;return null===(n=e.bounds)||void 0===n?void 0:n.containsPoint(t)}))).length)return null;var r=function(e,t){return Math.min(Math.min(t.x-e.min.x,e.max.x-t.x),Math.min(t.y-e.min.y,e.max.y-t.y))};return i.reduce((function(e,n){var i=r(e.bounds,t);return r(n.bounds,t)>i?n:e})).viewport}},{key:"findViewportsInLevel",value:function(e,t){var n=this.viewer.getExtension("Autodesk.AEC.LevelsExtension");if(!n)return[];var i=n.floorSelector.floorData.find((function(e){return e.guid===t}));return i?this.getViewports(e.getDocumentNode(),{filterCB:function(e){return e.isViewportInLevel(i)}}):[]}},{key:"deleteViewport",value:(i=Zo(regeneratorRuntime.mark((function e(t,n){var i,r,o,s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=this.getViewportType(t),s=null===(i=this.cache.viewports[n])||void 0===i?void 0:i[o]){e.next=4;break}return e.abrupt("return",!1);case 4:if(-1!==(a=s.findIndex((function(e){return e===t})))){e.next=7;break}return e.abrupt("return",!1);case 7:return s.splice(a,1),this.fireEvent({type:l.Events.VIEWPORT_DATA_FETCHED_EVENT,modelKey:n,providerName:o,viewports:s}),e.next=11,null===(r=this.providers[o])||void 0===r?void 0:r.deleteViewport(t);case 11:if(e.sent){e.next=17;break}return console.warn("Could not delete viewport or not allowed.",t),s.splice(a,0,t),this.fireEvent({type:l.Events.VIEWPORT_DATA_FETCHED_EVENT,modelKey:n,providerName:o,viewports:s}),e.abrupt("return",!1);case 17:return e.abrupt("return",!0);case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"getViewportType",value:function(e){return e instanceof yo?Mo.getProviderName():e instanceof Io?Ho.getProviderName():void 0}},{key:"findViewportByGuid",value:function(e){for(var t in this.cache.viewports){var n=this.cache.viewports[t],i=Object.values(n).flat().find((function(t){return t.getGuid()===e}));if(i)return i}return null}}],n&&Jo(t.prototype,n),l}(is.Extension);rs.ViewportsExtension=os,os.Events={VIEWPORT_DATA_FETCHED_EVENT:"viewportDataFetched",VIEWPORT_DATA_CREATED_EVENT:"viewportDataCreated"},os.ViewportProviderInterface=to,os.AecModelDataViewportProvider=Mo,os.AlignmentServiceViewportProvider=Ho,os.AlignmentServiceViewport=Io,os.AecModelDataViewport=yo,is.theExtensionManager.registerExtension("Autodesk.AEC.ViewportsExtension",os)},70483:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getPointLocations:()=>_e,parseLocationsMetadata:()=>Ee});var r,o=new THREE.Vector2,s=new THREE.Vector2,a=function(e,t,n){var i=(e.x-t.x)*n.x+(e.y-t.y)*n.y;e.set(t.x+i*n.x,t.y+i*n.y)},c=(r=new THREE.Vector2,function(e,t,n,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=n.x-t.x,s=n.y-t.y,a=Math.sqrt(o*o+s*s),c={v1:t,dx:o,dy:s,length:a,length2:a*a};return Autodesk.Extensions.CompGeom.pointOnLine(e.x,e.y,c,r,i)}),u=function(e,t,n){return(n=n||new THREE.Vector2).copy(t).sub(e).normalize()},l=function(e,t){var n=Math.atan2(e.y,e.x)-Math.atan2(t.y,t.x);return n<0&&(n+=2*Math.PI),n},h=function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},d=c,p=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i={x:t.x-e.x,y:t.y-e.y};if(n){var r=Math.pow(10,n);i.x=Math.round(i.x*r)/r,i.y=Math.round(i.y*r)/r}if(i.x||i.y)return i},g=function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},f=function(e){return e.determinant()<0},v=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Matrix4,r=e.size(o),a=t.size(s),c=a.x/r.x,u=a.y/r.y;n.preserveAspect&&(u=c=Math.min(c,u));var l=e.min.x,h=e.min.y;n.flipY&&(u*=-1,h=e.max.y);var d=-c*l+t.min.x,p=-u*h+t.min.y,g=i.makeScale(c,u,1);return g.elements[12]=d,g.elements[13]=p,g};function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}var m=null,_="http://www.w3.org/2000/svg",E=Math.pow(10,4),A=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e||null===t)return e;var n=4===t?E:Math.pow(10,t);return Math.round(e*n)/n},x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return'<circle cx="'.concat(A(e.centerX,t),'" cy="').concat(A(e.centerY,t),'" r="').concat(A(e.radius,t)).concat(n,'"/>')},C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!e.vertexCount)return[];for(var i=function(e){return A(e,n)},r=[],o=new THREE.Vector2,s=new THREE.Vector2,a=new fe,c=new THREE.Vector2,u=new THREE.Vector2,l=e.loopCount,h=0;h<l;h++){var d=e.getEdgeCount(h);d>0&&(o=e.getPoint(0,h,o),r.push("M ".concat(i(o.x),",").concat(i(o.y))));for(var g=0;g<d;g++){var f=g,v=e.isPath()?e.getEdgeType(f,h):ae.Line,y=e.nextIndex(f,h);o=e.getPoint(y,h,o);var m="";switch(v){case ae.Ellipse:var _=(a=e.getEllipseArcParams(f,h,a)).largeArcFlag?1:0,E=a.sweepFlag?1:0;m="A ".concat(a.rx,",").concat(a.ry,",").concat(a.rotation,",").concat(_,",").concat(E,",").concat(o.x,",").concat(o.y);break;case ae.Bezier:c=e.getControlPoint(f,1,h,c),u=e.getControlPoint(f,2,h,u),m="C ".concat(i(c.x,n),",").concat(i(c.y,n),",").concat(i(u.x,n),",").concat(i(u.y,n),",").concat(i(o.x,n),",").concat(i(o.y,n));break;default:s=e.getPoint(g,h,s);var x=p(s,o,n);if(!x)continue;m=Math.abs(x.x)<=t?"V ".concat(i(o.y)):Math.abs(x.y)<=t?"H ".concat(i(o.x)):"L ".concat(i(o.x),",").concat(i(o.y))}var C=0===y;C&&v===ae.Line||r.push(m)}e.isClosed&&r.push("Z")}return r},w=function(e){var t={};return t.stroke=e.lineColor,t.fill=e.fillColor,t["stroke-width"]=e.lineWidth,1!=e.lineAlpha&&(t["stroke-opacity"]=e.lineAlpha),1!=e.fillAlpha&&(t["fill-opacity"]=e.fillAlpha),t},b=function(e){var t="";for(var n in e)t+=" ".concat(n,'="').concat(e[n],'"');return t},M=function(e,t){var n=t&&t.precision||0,i=t&&t.digits||0,r=t&&t.exportStyle||!0;if(e instanceof re){var o=document.createElementNS(_,"path");return o.setAttribute("d",C(e,n,i)),r&&function(e,t){for(var n in t)e.setAttribute(n,t[n])}(o,w(e.style)),o}console.error("SVG serialization not supported for this shape: ",e)},T={toSvg:function(e,t){var n=t&&t.precision||0,i=t&&t.digits||null,r=t&&t.exportStyle||!1,o="";if(r){var s=w(e.style);o=b(s)}if("object"!==y(t)&&("number"==typeof arguments[1]&&(n=arguments[1]),"number"==typeof arguments[2]&&(i=arguments[2])),e instanceof ye)return x(e,i,o);if(e instanceof re){var a=C(e,n,i);return'<path d="'.concat(a.join(" "),'"').concat(o,"/>")}console.error("SVG serialization not supported for this shape: ",e)},fromSvg:function(e){if(e){var t=(m=m||new DOMParser).parseFromString(e,"application/xml");if(1!==t.childNodes.length)throw"Function does only support svg with a single element: path, circle";var n=t.firstChild;if("circle"===n.nodeName)return function(e){if(!e.hasAttributes||!e.hasAttributes())throw"No attributes available on the <circle/> node";for(var t=new ye,n=e.attributes.length-1;n>=0;n--){var i=e.attributes[n];switch(i.name){case"cx":t.centerX=parseFloat(i.value);break;case"cy":t.centerY=parseFloat(i.value);break;case"r":t.radius=parseFloat(i.value)}}return t}(n);if("path"===n.nodeName)return function(e){var t=e.getAttribute("d");if(t)return function(e){for(var t=e.split(/ (?=[a-zA-Z])/gi),n=new fe,i=new THREE.Vector2,r=0,o=new ve,s=0;s<t.length;s++){var a=t[s];if(-1==="MLHVCZA".indexOf(a[0]))throw'"'.concat(a[0],'" is not a supported or invalid glyph: ').concat(a);var c=o.getVertexCount(r)-1,u=a.substring(1);switch(a[0]){case"M":r=o.nextFreeLoop();case"L":var l=u.split(",");i.x=parseFloat(l[0]),i.y=parseFloat(l[1]);break;case"H":i.x=parseFloat(u);break;case"V":i.y=parseFloat(u);break;case"C":var h=u.split(",");i.x=parseFloat(h[4]),i.y=parseFloat(h[5]);var d=parseFloat(h[0]),g=parseFloat(h[1]),f=parseFloat(h[2]),v=parseFloat(h[3]);c>=0?o.setBezierArc(c,d,g,f,v,r):console.error('SVG Parse error: Path is not expected to start with "C" command');break;case"A":var y=u.split(",");i.x=parseFloat(y[5]),i.y=parseFloat(y[6]),n.rx=parseFloat(y[0]),n.ry=parseFloat(y[1]),n.rotation=parseFloat(y[2]),n.largeArcFlag=Boolean(parseFloat(y[3])),n.sweepFlag=Boolean(parseFloat(y[4])),c>=0?o.setEllipseArc(c,n,r):console.error('SVG Parse error: Path is not expected to start with "A" command');break;case"Z":o.isClosed=!0;continue}o.addPoint(i.x,i.y,r)}return function(e){if(e.isClosed)for(var t=new THREE.Vector2,n=new THREE.Vector2,i=e.loopCount,r=0;r<i;r++){var o=e.getVertexCount(r)-1;o<1||(t=e.getPoint(0,r,t),n=e.getPoint(o,r,n),p(t,n,0)||e.removePoint(o,r))}}(o),o}(t)}(n);throw"Unsupported svg node type: ".concat(n.nodeName)}},createSvgShape:M,createSvgElement:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new THREE.Box2;e.forEach((function(e){return n.union(e.getBBox())}));var i=t.srcBox||n,r=t.dstBox||n,o={preserveAspect:!0,flipY:!0},s=v(i,r,o),a=r.max.x-r.min.x,c=r.max.y-r.min.y,u=document.createElementNS(_,"svg");return u.setAttribute("height",a),u.setAttribute("width",c),e.forEach((function(e){var n=e.clone().applyMatrix4(s),i=M(n,t);u.appendChild(i)})),u}},V=n(32230),S=(new THREE.Vector3,new THREE.Vector3,function(e){var t=new V.Path2D;return de(t,e),t});function R(e){throw new Error('"'+e+'" is read-only')}function L(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?P(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(a)throw o}}}}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var O=function(e){for(var t=0;t<e.length;t++)for(var n=e[t],i=t+1;i<e.length;i++)for(var r=e[i],o=(0,V.computeCurveCurveIntersections)(n,r,!1,!0),s=0;s<o.length;s++){var a=o[s],c=a.cutInfo.param,u=a.cutByInfo.param,l=n.getRange(),h=r.getRange(),d=Math.min(Math.abs(c-l[0]),Math.abs(c-l[1])),p=Math.min(Math.abs(u-h[0]),Math.abs(u-h[1]));if(Math.max(d,p)>1e-5)return!0}return!1},D=function(e,t){var n,i=!1,r=!1,o=!1,s=function(n){var s=e.has(n),a=t.has(n);s&&a?i=!0:s?r=!0:a&&(o=!0)},a=L(e);try{for(a.s();!(n=a.n()).done;)s(n.value)}catch(e){a.e(e)}finally{a.f()}var c,u=L(t);try{for(u.s();!(c=u.n()).done;)s(c.value)}catch(e){u.e(e)}finally{u.f()}return i?r&&!o?0:o&&!r?1:r||o?3:4:2};function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function N(e,t,n){return N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=z(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}},N(e,t,n||e)}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}function B(e,t){return B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},B(e,t)}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=z(e);if(t){var r=z(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return j(this,n)}}function j(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function z(e){return z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},z(e)}function U(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function G(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Y(e,t,n){return t&&G(e.prototype,t),n&&G(e,n),e}var W=1,H=Autodesk.Viewing,K=function(e,t,n){return"rgb("+e+","+t+","+n+")"},q=function(e){return e.map((function(e){return{x:e.x,y:e.y}}))},Q={numIterations:100,minSegLenFraction:.01},Z=new THREE.Vector3,J=new THREE.Vector3,X=new THREE.Box2,$=new THREE.Vector2,ee=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};U(this,e),this.lineColor=t.lineColor||t.color||"rgb(0,0,128)",this.lineAlpha=void 0!==t.lineAlpha?t.lineAlpha:void 0!==t.alpha?t.alpha:1,this.lineWidth=void 0!==t.lineWidth?t.lineWidth:3,this.fillColor=t.fillColor||t.color||"rgb(0,0,128)",this.fillAlpha=void 0!==t.fillAlpha?t.fillAlpha:void 0!==t.alpha?t.alpha:.2,this.lineStyle=t.lineStyle||0,this.isScreenSpace=void 0===t.isScreenSpace||t.isScreenSpace,this.compositeOperation="source-over"}return Y(e,[{key:"setFillColor",value:function(e,t,n){this.fillColor=K(e,t,n)}},{key:"setLineColor",value:function(e,t,n){this.lineColor=K(e,t,n)}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"copy",value:function(e){return this.lineColor=e.lineColor,this.lineAlpha=e.lineAlpha,this.lineWidth=e.lineWidth,this.fillColor=e.fillColor,this.fillAlpha=e.fillAlpha,this.lineStyle=e.lineStyle,this.isScreenSpace=e.isScreenSpace,this.compositeOperation=e.compositeOperation,this}}]),e}();ee.toColor=K;var te=new ee,ne=function(e,t){for(var n=0;n<e.length;n++)t.expandByPoint(e[n])},ie=function(e){k(n,e);var t=F(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te.clone();return U(this,n),(e=t.call(this)).style=i,e.id=W++,e.bbox=new THREE.Box2,e.bboxDirty=!0,e.visible=!0,e.movable=!0,e.selectable=!0,e.name=e.id.toString(),e}return Y(n,[{key:"draw",value:function(){}},{key:"hitTest",value:function(){}},{key:"move",value:function(){return this}},{key:"applyMatrix4",value:function(e){return this}},{key:"clone",value:function(){return(new n).copy(this)}},{key:"copy",value:function(e){return this.style=e.style.clone(),this}},{key:"computeBBox",value:function(){console.error("Must be implemented by derived class.")}},{key:"modified",value:function(){this.bboxDirty=!0,this.fireEvent({type:n.Events.MODIFIED})}},{key:"updateBBox",value:function(){this.bboxDirty&&(this.computeBBox(),this.bboxDirty=!1)}},{key:"getBBox",value:function(){return this.updateBBox(),this.bbox}},{key:"toSVG",value:function(e,t){return T.toSvg(this,e,t)}},{key:"createSvgShape",value:function(e){return T.toSvgElement(this,e)}},{key:"setVisible",value:function(e){this.visible=e}}],[{key:"fromSVG",value:function(e){return T.fromSvg(e)}}]),n}(H.EventDispatcher);ie.Events={MODIFIED:"modified"},H.GlobalManagerMixin.call(ie.prototype);var re=function(e){k(n,e);var t=F(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:te.clone();return U(this,n),(e=t.call(this,r))._loops=i?[i]:[],e.isClosed=void 0,e._loopInfos=null,e}return Y(n,[{key:"allocPoints",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<e;++n)this.addPoint(0,0,t);return this}},{key:"isPolygon",value:function(){return this.isClosed}},{key:"isPolyline",value:function(){return!this.isClosed}},{key:"isPath",value:function(){return this instanceof ve}},{key:"addPoint",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._loops[n]||(this._loops[n]=[]),r={x:e,y:t};return i.push(r),this.modified(),r}},{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2;return"object"===I(t)&&(n=t,t=0),n.copy(this._loops[t][e])}},{key:"removePoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._loops[t].splice(e,1)}},{key:"updatePoint",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=this._loops[i][e];r.x=t,r.y=n,this.modified()}},{key:"insertPoint",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._loops[n].splice(e,0,t)}},{key:"getVertexCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._loops[e];return t?t.length:0}},{key:"clear",value:function(){this._loops=[],this.modified()}},{key:"enumEdges",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.getEdgeCount(t),i=0;i<n;i++){var r=i,o=this.nextIndex(i,t),s=this.getPoint(r,t),a=this.getPoint(o,t),c=e(s,a,r,o);if(c)return}}},{key:"findEdgeIndex",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=-1,r=function(n,r,o){var s=d(e,n,r,t);return s&&(i=o),s};return this.enumEdges(r,n),i}},{key:"moveLoop",value:function(e,t,n){for(var i=this._loops[n],r=0;r<i.length;r++)i[r].x+=e,i[r].y+=t;this.modified()}},{key:"move",value:function(e,t){for(var n=0;n<this.loopCount;n++)this.moveLoop(e,t,n);return this}},{key:"applyMatrix4",value:function(e){for(var t=0;t<this.loopCount;t++)for(var n=this._loops[t],i=0;i<n.length;i++){var r=n[i],o=function(t,n,i){var r=Z.set(t,n,0).applyMatrix4(e);return i.x=r.x,i.y=r.y,i};if(o(r.x,r.y,r),this.isBezierArc(i,t)){var s=o(r.cp1x,r.cp1y,Z);r.cp1x=s.x,r.cp1y=s.y,s=o(r.cp2x,r.cp2y,Z),r.cp2x=s.x,r.cp2y=s.y}this.isEllipseArc(i,t)&&r.ellipseArcParams.applyMatrix4(e)}return this.modified(),this}},{key:"addLoop",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,r=e._loops[n],o=q(r);return-1===i?(t=this.nextFreeLoop(),this._loops[t]=o):(t=i,this._loops.splice(t,0,o)),this.modified(),t}},{key:"copyGeometry",value:function(e){this.isClosed=e.isClosed,this._loops=[];for(var t=0;t<e.loopCount;t++)this.addLoop(e,t);return this}},{key:"copy",value:function(e){return N(z(n.prototype),"copy",this).call(this,e),this.copyGeometry(e)}},{key:"computeBBox",value:function(){this.bbox.makeEmpty();for(var e=0;e<this.loopCount;e++){var t=this._loops[e];t&&ne(t,this.bbox)}return this.bbox}},{key:"indexValid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e>=0&&e<this.getVertexCount(t)}},{key:"nextIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.indexValid(e,t))return-1;var n=e===this.getVertexCount(t)-1;return n?this.isClosed?0:-1:e+1}},{key:"prevIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.indexValid(e,t))return-1;if(0===e){var n=this.getVertexCount(t);return this.isClosed?n-1:-1}return e-1}},{key:"edgeBeforeVertex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.prevIndex(e,t)}},{key:"edgeAfterVertex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)?e:-1}},{key:"nextEdgeIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)&&(this.isClosed||e!==this.getEdgeCount(t)-1)?this.nextIndex(e,t):-1}},{key:"prevEdgeIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)&&(this.isClosed||0!==e)?this.prevIndex(e,t):-1}},{key:"edgeIndexValid",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.getEdgeCount(t);return e>=0&&e<n}},{key:"prevEdgeExists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.getVertexCount(t);return this.edgeIndexValid(e,t)&&n>2&&(e>0||this.isClosed)}},{key:"nextEdgeExists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.getVertexCount(t),i=e===n-2;return this.edgeIndexValid(e,t)&&n>2&&(!i||this.isClosed)}},{key:"getEdge",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=e,o=this.nextIndex(e,i);this.getPoint(r,i,t),this.getPoint(o,i,n)}},{key:"getEdgeDirection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2,i=e,r=this.nextIndex(e,t),o=this._loops[t];return u(o[i],o[r],n)}},{key:"getEdgeLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e,i=this.nextIndex(e,t),r=this._loops[t],o=r[n],s=r[i];return h(o,s)}},{key:"getEdgeCount",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.getVertexCount(e);return this.isClosed?t:t-1}},{key:"getLength",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=new THREE.Vector2,i=new THREE.Vector2,r=0,o=0;o<this.getEdgeCount(t);o++)this.getEdge(o,n,i,t),e&&(e.apply(n),e.apply(i)),r+=n.distanceTo(i);return r}},{key:"fromBox2",value:function(e){return this.addPoint(e.min.x,e.min.y),this.addPoint(e.max.x,e.min.y),this.addPoint(e.max.x,e.max.y),this.addPoint(e.min.x,e.max.y),this}},{key:"getPointOnEdge",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Vector2,r=this._loops[n],o=r[e],s=r[this.nextIndex(e,n)];return i.lerpVectors(o,s,t)}},{key:"isCCW",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return Autodesk.Extensions.CompGeom.polygonArea(this._loops[e])>0}},{key:"getLeftEdgeNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2,i=this._loops[t],r=e,o=(e+1)%i.length,s=i[r],a=i[o];n.subVectors(a,s).normalize();var c=n.x;return n.x=-n.y,n.y=c,n}},{key:"getOuterNormal",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new THREE.Vector2,i=this.getLeftEdgeNormal(e,t,n);return this.isCCW(t)?i.multiplyScalar(-1):i}},{key:"nextFreeLoop",value:function(){var e=this._loops.findIndex((function(e){return!e||!e.length}));return e>=0?e:this.loopCount}},{key:"findVertex",value:function(e){for(var t=0;t<this.loopCount;t++)for(var n=this.getVertexCount(t),i=0;i<n;i++)if(e(i,t))return{vertexIndex:i,loopIndex:t};return null}},{key:"empty",value:function(){return!this._loops.some((function(e){return e&&e.length>0}))}},{key:"modified",value:function(){N(z(n.prototype),"modified",this).call(this),this._loopInfos=null}},{key:"isSelfIntersecting",value:function(){var e=this._getLoopInfos();return e&&e.some((function(e){return e.error}))}},{key:"_getLoopInfos",value:function(){if(this.isClosed&&!(this.loopCount<1))return this._loopInfos||(this._loopInfos=function(e){for(var t=S(e).getWireBody(),n=t.getWires(),r=t.getEdges(),o=[],s=0;s<n.length;s++){var a=n[s].getEdges();o[s]={containedLoops:[],rank:0,error:O(a)}}if(n.length<2)return o;var c=new V.SketchRegionSolver;c.compute(r),c.getFaces().forEach((function(e,t){return e.arrayIndex=t}));for(var u=[],l=function(e){var t=n[e].getEdges();if(O(t))return o[e].error=!0,u[e]=new Set,"continue";var i=new Set,r=function(e,t){var n=e.getFaces(),i=(0,V.getRegionEdges)(e,t);return(0,V.getBoundedRegionFaces)(n,i)}(c,t);r.forEach((function(e){i.add(e.arrayIndex)})),u[e]=i},h=0;h<n.length;h++)l(h);for(var d=0;d<u.length;d++)for(var p=u[d],g=d+1;g<u.length;g++){var f=u[g];switch(D(p,f)){case 2:continue;case 0:o[d].containedLoops.push(g),o[g].rank++;break;case 1:o[g].containedLoops.push(g),o[d].rank++;break;default:o[d].error=!0,o[g].error=!0}}if(n.length!==e.loopCount){for(var v=[],y=0,m=0;m<e.loopCount;m++)e.getVertexCount(m)&&(v[i]=o[(R("srcIndex"),y++)]);R("loopInfos"),o=v}return o}(this)),this._loopInfos}},{key:"getLoopType",value:function(e){if(this.isClosed){if(!this.getVertexCount(e))return 0;var t=this._getLoopInfos()[e];return t.error?3:1&t.rank?1:2}}},{key:"getChildLoops",value:function(e){var t=this._getLoopInfos(),n=t&&t[e];return n?n.containedLoops.slice():[]}},{key:"cleanupLoops",value:function(){this._loops=this._loops.filter((function(e){return e&&e.length>=0}))}},{key:"getMainLoops",value:function(){var e=this._getLoopInfos();if(!e)return[];for(var t=[],n=0;n<e.length;n++){var i=e[n];2===this.getLoopType(n)&&0===i.rank&&t.push(n)}return t}},{key:"removeLoop",value:function(e){return this._loops.splice(e,1),this.modified(),this}},{key:"removeLoops",value:function(e){this._loops=this._loops.filter((function(t,n){return!e.includes(n)}))}},{key:"isPointFinite",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.indexValid(e,t))return!1;var n=this._loops[t],i=n[e];return isFinite(i.x)&&isFinite(i.y)}},{key:"isLoopFinite",value:function(e){for(var t=this._loops[e],n=t?t.length:0,i=0;i<n;i++)if(!this.isPointFinite(i,e))return!1;return!0}},{key:"points",get:function(){return this._loops[0]||(this._loops[0]=[])}},{key:"loopCount",get:function(){return this._loops.length}},{key:"length",get:function(){return console.warn("poly.length is deprecated and will be removed. Please use poly.vertexCount property instead."),this.points.length}},{key:"vertexCount",get:function(){return this.points.length}}]),n}(ie),oe=function(e){k(n,e);var t=F(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:te.clone();return U(this,n),(e=t.call(this,i,r)).isClosed=!0,e}return Y(n,[{key:"draw",value:function(e,t){pe(e,this,t)}},{key:"hitTest",value:function(e,t){if(!this.vertexCount)return!1;for(var n=0,i=0;i<this.loopCount;i++){var r=this._loops[i];if(r){for(var o=new Autodesk.Extensions.CompGeom.ComplexPolygon(r),s=[],a=0;a<r.length;a++)s.push(a);o.pointInContour(e,t,s)&&n++}}return Boolean(1&n)}},{key:"clone",value:function(){return(new n).copy(this)}},{key:"getArea",value:function(e){if(this.isClosed){for(var t=this._getLoopInfos(),n=0,i=0;i<this.loopCount;i++)if(!(this.points.length<3)){var r=t?t[i]:null,o=1&(r?r.rank:0)?-1:1,s=0;this.enumEdges((function(t,n){e&&e.apply(t),e&&e.apply(n),s+=t.x*n.y-n.x*t.y}),i),n+=o*Math.abs(.5*s)}return n}}}]),n}(re),se=function(e){k(n,e);var t=F(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:te.clone();return U(this,n),(e=t.call(this,i,r)).isClosed=!1,e}return Y(n,[{key:"makeLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return 2!==this.vertexCount?(this.clear(),this.addPoint(e,t),this.addPoint(n,i)):(this.updatePoint(0,e,t),this.updatePoint(1,n,i)),this}},{key:"draw",value:function(e,t){pe(e,this,t)}},{key:"clone",value:function(){return(new n).copy(this)}},{key:"hitTest",value:function(e,t,n){return-1!==this.findEdgeIndex({x:e,y:t},n)}}]),n}(re),ae={Line:0,Bezier:1,Ellipse:2},ce=null,ue=function(){return ce=ce||new Autodesk.Extensions.CompGeom.EllipseArc},le=new THREE.Vector2,he=function(e,t,n){var i=t._loops[n];if(i&&i.length)if(t.isLoopFinite(n)){e.moveTo(i[0].x,i[0].y);for(var r=function(i,r,o){switch(i.arcType){case ae.Line:break;case ae.Bezier:return void e.bezierCurveTo(i.cp1x,i.cp1y,i.cp2x,i.cp2y,r.x,r.y);case ae.Ellipse:var s=i.ellipseArcParams,a=t.exportEllipseArc(o,n,ue());if(!a.isValid())break;return void(e.ellipseArcTo?e.ellipseArcTo(s.rx,s.ry,THREE.Math.degToRad(s.rotation),s.largeArcFlag,s.sweepFlag,r.x,r.y):e.ellipse(a.cx,a.cy,a.rx,a.ry,a.rotation,a.startAngle,a.endAngle,a.ccw))}e.lineTo(r.x,r.y)},o=1;o<i.length;o+=1)r(i[o-1],i[o],o-1);t.isClosed&&(r(i[i.length-1],i[0],i.length-1),e.closePath())}else console.warn("Skipped loop, because it contains Inf or NaN values. Shape ID: ".concat(t.id,". LoopIndex: ").concat(n))},de=function(e,t){for(var n=0;n<t.loopCount;n++)he(e,t,n)},pe=function(e,t,n){if(t.vertexCount){var i=n||t.style,r=e.canvasContext;e.dbId=t.id,e.lineStyle=i.lineStyle,e.isScreenSpace=i.isScreenSpace;var o=r.globalCompositeOperation;if(i.compositeOperation&&(r.globalCompositeOperation=i.compositeOperation,e.flushBuffer(0,!0)),e.beginPath(),de(e,t),t.isClosed){if(r.fillStyle=i.fillColor,i.fillColor.hasOwnProperty("colorStops")){var s=e.createGradientData(i.fillColor).getFillStyle(r);r.fillStyle=s}r.globalAlpha=i.fillAlpha,e.fill()}r.strokeStyle=i.lineColor,r.globalAlpha=i.lineAlpha,r.lineWidth=i.lineWidth,i.isScreenSpace&&(r.lineWidth*=window.devicePixelRatio),e.stroke(),e.dbId=-1,e.lineStyle=0,e.isScreenSpace=!1,r.globalCompositeOperation=o}},ge=function(){function e(){U(this,e),this.cp1x=0,this.cp1y=0,this.cp2x=0,this.cp2y=0}return Y(e,[{key:"copy",value:function(e){return this.cp1x=e.cp1x,this.cp1y=e.cp1y,this.cp2x=e.cp2x,this.cp2y=e.cp2y,this}},{key:"clone",value:function(){return(new e).copy(this)}}]),e}(),fe=function(){function e(){U(this,e),this.rx=0,this.ry=0,this.rotation=0,this.largeArcFlag=!1,this.sweepFlag=!1}return Y(e,[{key:"copy",value:function(e){return this.rx=e.rx,this.ry=e.ry,this.rotation=e.rotation,this.largeArcFlag=e.largeArcFlag,this.sweepFlag=e.sweepFlag,this}},{key:"clone",value:function(){return(new e).copy(this)}},{key:"rotate",value:function(e){this.rotation+=e,this.rotation-=360*Math.trunc(this.rotation/360)}},{key:"scale",value:function(e){this.rx*=e,this.ry*=e}},{key:"applyMatrix4",value:function(e){Z.set(1,0,0).applyMatrix4(e),J.set(0,0,0).applyMatrix4(e);var t=Z.sub(J),n=THREE.Math.radToDeg(Math.atan2(t.y,t.x)),i=t.length();this.rotate(n),this.scale(i),f(e)&&(this.sweepFlag=!this.sweepFlag,this.rotation=360-this.rotation)}}]),e}(),ve=function(e){k(n,e);var t=F(n);function n(e){var i,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:te.clone();return U(this,n),(i=t.call(this,e,o)).isClosed=r,i}return Y(n,[{key:"_updateEllipseArcParams",value:function(e,t,n,i){var r=this._loops[t][e].ellipseArcParams,o=this.getEdgeDirection(e,t),s=u(n,i),a=l(s,o);r.rotate(THREE.Math.radToDeg(a));var c=this.getEdgeLength(e,t),h=g(n,i)/c;isFinite(h)&&h>0&&r.scale(h)}},{key:"updatePoint",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=this._loops[i],o=r[e],s=le.set(t,n),a=t-o.x,c=n-o.y;if(this.isBezierArc(e,i)&&(o.cp1x+=a,o.cp1y+=c),this.isEllipseArc(e,i)){var u=this.nextIndex(e,i),l=r[u];this._updateEllipseArcParams(e,i,s,l)}var h=this.edgeBeforeVertex(e,i);if(this.edgeIndexValid(h,i)){var d=r[h];this.isBezierArc(h,i)&&(d.cp2x+=a,d.cp2y+=c),this.isEllipseArc(h,i)&&this._updateEllipseArcParams(h,i,d,s)}o.x=t,o.y=n,this.modified()}},{key:"getEdgeType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._loops[t][e].arcType;return n||ae.Line}},{key:"setBezierArc",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i="object"===I(t);i||(t={cp1x:t,cp1y:n,cp2x:arguments.length<=3?void 0:arguments[3],cp2y:arguments.length<=4?void 0:arguments[4]},n=(arguments.length<=5?void 0:arguments[5])||0);var r=this._loops[n][e];r.arcType=ae.Bezier,ge.prototype.copy.call(r,t),this.modified()}},{key:"getBezierArcParams",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ge,i=this._loops[t][e],r=i&&i.arcType===ae.Bezier&&i;return r&&n.copy(r)}},{key:"setEllipseArc",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._loops[n][e];i.arcType=ae.Ellipse,i.ellipseArcParams=t.clone(),this.modified()}},{key:"getEllipseArcParams",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new fe,i=this._loops[t][e],r=i&&i.arcType===ae.Ellipse&&i.ellipseArcParams;return r&&n.copy(r)}},{key:"exportEllipseArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new EllipseArc,i=this._loops[t],r=this.nextIndex(e,t),o=i[e],s=i[r],a=o.ellipseArcParams;return n.setFromSvgArc(a.rx,a.ry,a.rotation,a.largeArcFlag,a.sweepFlag,o,s),n}},{key:"isBezierArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)&&this._loops[t][e].arcType===ae.Bezier}},{key:"isEllipseArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.edgeIndexValid(e,t)&&this._loops[t][e].arcType===ae.Ellipse}},{key:"isArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.isBezierArc(e,t)||this.isEllipseArc(e,t)}},{key:"getStartTangent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t||new THREE.Vector2,i=this.points[e];return n.x=i.cp1x-i.x,n.y=i.cp1y-i.y,n}},{key:"getEndTangent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t||new THREE.Vector2,i=this.nextIndex(e),r=this.points[e],o=this.points[i];return n.x=r.cp2x-o.x,n.y=r.cp2y-o.y,n}},{key:"setStartTangent",value:function(e,t){var n=this.points[e];n.cp1x=n.x+t.x,n.cp1y=n.y+t.y,this.modified()}},{key:"setEndTangent",value:function(e,t){var n=this.points[e],i=this.points[this.nextIndex(e)];n.cp2x=i.x+t.x,n.cp2y=i.y+t.y,this.modified()}},{key:"removeArc",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._loops[t][e];n.arcType===ae.Bezier&&(n.cp1x=void 0,n.cp1y=void 0,n.cp2x=void 0,n.cp2y=void 0),n.ellipseArcParams&&(n.ellipseArcParams=void 0),n.arcType=ae.Line,this.modified()}},{key:"getControlPoint",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Vector2,r=this._loops[n][e];return 1===t?(i.x=r.cp1x,i.y=r.cp1y):(i.x=r.cp2x,i.y=r.cp2y),i}},{key:"updateControlPoint",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=this._loops[r][e];1===t?(o.cp1x=n,o.cp1y=i):(o.cp2x=n,o.cp2y=i),this.modified()}},{key:"draw",value:function(e,t){pe(e,this,t)}},{key:"toPoly",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Autodesk.Extensions.CompGeom.DefaultTessParams,n=this.isClosed?new oe:new se,i=function(i){var r={moveTo:function(e,t){return n.addPoint(e,t,i)},lineTo:function(e,t){return n.addPoint(e,t,i)},bezierCurveTo:function(e,o,s,a,c,u){var l=n._loops[i],h=l[l.length-1],d=X.makeEmpty();d.expandByPoint(h),d.expandByPoint($.set(c,u)),d.expandByPoint($.set(e,o)),d.expandByPoint($.set(s,a));var p=d.size(le).length();Autodesk.Extensions.CompGeom.TesselateCubic(r,h.x,h.y,e,o,s,a,c,u,p,t)},ellipse:function(e,n,i,o,s,a,c,u){var l=Math.max(i,o),h=t.numIterations,d=t.minSegLenFraction*l;ue().set(e,n,i,o,s,a,c,u).tesselate(r,h,d)},closePath:function(){}};he(r,e,i)},r=0;r<this.loopCount;r++)i(r);return n}},{key:"computeBBox",value:function(){N(z(n.prototype),"computeBBox",this).call(this);for(var e=new THREE.Vector2,t=0;t<this.loopCount;t++)for(var i=0;i<this.getVertexCount(t);i++)if(this.isBezierArc(i,t))this.getControlPoint(i,1,t,e),this.bbox.expandByPoint(e),this.getControlPoint(i,2,t,e),this.bbox.expandByPoint(e);else if(this.isEllipseArc(i,t)){var r=this.exportEllipseArc(i,t,ue());this.bbox.union(r.computeBBox(X))}}},{key:"hitTest",value:function(e,t,n){return this.toPoly().hitTest(e,t,n)}},{key:"clone",value:function(){return(new n).copy(this)}},{key:"addLoop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;i=N(z(n.prototype),"addLoop",this).call(this,e,t,i);for(var r=e._loops[t],o=this._loops[i],s=0;s<r.length;s++){var a=e.getEdgeType(s,t);if(a!==ae.Line){var c=r[s],u=o[s];switch(u.arcType=c.arcType,a){case ae.Bezier:u.cp1x=c.cp1x,u.cp1y=c.cp1y,u.cp2x=c.cp2x,u.cp2y=c.cp2y;break;case ae.Ellipse:u.ellipseArcParams=c.ellipseArcParams&&c.ellipseArcParams.clone()}}}return this.modified(),this}},{key:"moveLoop",value:function(e,t,i){N(z(n.prototype),"moveLoop",this).call(this,e,t,i);for(var r=this._loops[i],o=0;o<r.length;o++)if(this.isBezierArc(o,i)){var s=r[o];s.cp1x+=e,s.cp1y+=t,s.cp2x+=e,s.cp2y+=t}}},{key:"getArea",value:function(e){if(this.isClosed){var t=this.toPoly(Q);return t._loopInfos=this._getLoopInfos(),t.getArea(e)}}},{key:"getLength",value:function(e){return this.toPoly().getLength(e)}},{key:"getPointOnEdge",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new THREE.Vector2,o=this._loops[i],s=this.getEdgeType(e,i);switch(s){case ae.Line:break;case ae.Bezier:var a=o[e],c=o[this.nextIndex(e)];return Autodesk.Extensions.CompGeom.getCubeBezierPoint(t,a.x,a.y,a.cp1x,a.cp1y,a.cp2x,a.cp2y,c.x,c.y,r);case ae.Ellipse:var u=this.exportEllipseArc(e,i,ue());if(!u.isValid())break;return u.getPoint(t,r);default:avp.logger.error("unexpected edge type")}return N(z(n.prototype),"getPointOnEdge",this).call(this,e,t,i,r)}},{key:"runPathCommands",value:function(e){de(e,this)}},{key:"hasArcs",value:function(){var e=this;return Boolean(this.findVertex((function(t,n){return e.isArc(t,n)})))}}]),n}(re),ye=function(e){k(n,e);var t=F(n);function n(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:te.clone(),a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:20;return U(this,n),(e=t.call(this,s)).polygon=new oe([],s),e.polygon.id=e.id,e.centerX=i,e.centerY=r,e.radius=o,e.tessSegments=a,e.needsUpdate=!0,e}return Y(n,[{key:"draw",value:function(e,t){this.polygon.points.length=0;for(var n=360/this.tessSegments,i=0;i<360;i+=n){var r=i*Math.PI/180,o=this.radius*Math.cos(r),s=this.radius*Math.sin(r);this.polygon.addPoint(this.centerX+o,this.centerY+s)}this.needsUpdate=!1,this.polygon.draw(e,t)}},{key:"setCenter",value:function(e,t){this.centerX=e,this.centerY=t,this.modified()}},{key:"move",value:function(e,t){return this.centerX+=e,this.centerY+=t,this.modified(),this}},{key:"hitTest",value:function(e,t){var n=e-this.centerX,i=t-this.centerY;return n*n+i*i<this.radius*this.radius}},{key:"clone",value:function(){return(new n).copy(this)}},{key:"copy",value:function(e){return N(z(n.prototype),"copy",this).call(this,e),this.polygon=e.polygon.clone(),this.centerX=e.centerX,this.centerY=e.centerY,this.radius=e.radius,this.tessSegments=e.tessSegments,this.modified(),this}},{key:"computeBBox",value:function(){this.bbox.min.set(this.centerX-this.radius,this.centerY-this.radius),this.bbox.max.set(this.centerX+this.radius,this.centerY+this.radius)}}]),n}(ie);function me(e,t){return!(!e||!t)&&(e===t||me(e.parent,t))}function _e(e,t){for(var n=[],i=0;i<t.length;i++){var r=t[i];r.polygon.hitTest(e.x,e.y)&&n.push(r)}for(var o=0;o<n.length-1;o++)for(var s=o+1;s<n.length;s++)me(n[o],n[s])?n[s]=null:me(n[s],n[o])&&(n[o]=null);return n.filter((function(e){return e}))}function Ee(e){var t={},n=e.map((function(e){if(e.area&&"Svg"===e.area.format){var n=ie.fromSVG(e.area.geometry);n.name=e.name;var i=e.node&&e.node.id||e.id,r={id:i,metadata:e,polygon:n,parent:void 0};return t[i]=r,r}})).filter((function(e){return e}));return n.forEach((function(e){var n=e.metadata.node&&e.metadata.node.parentId||e.metadata.parentId;e.parent=t[n]})),n}},52463:(e,t,n)=>{"use strict";function i(e,t,n,i){return new Promise((function(r,o){e((function(e){if(!e)return o("Invalid access token.");var s=function(e){switch(e){case"staging":case"qa":case"dev":case"local":return"https://developer-stg.api.autodesk.com";default:return"https://developer.api.autodesk.com"}}(i),a=function(e){switch(e){case"qa":return"-qa";case"dev":case"local":return"-dev";default:return""}}(i),c="bim360/locations".concat(a,"/v2"),u="".concat(s,"/").concat(c,"/containers/").concat(t,"/trees/").concat("default","/nodes:search"),l=[];!function t(i){var a=function(e,n,i,o,a,c){var u=new XMLHttpRequest;return u.open("POST",n),u.setRequestHeader("Content-Type",i),u.setRequestHeader("Access-Control-Allow-Origin","*"),u.setRequestHeader("Authorization","Bearer "+o),u.onload=function(e){var n,i;201===e.currentTarget.status||200===e.currentTarget.status||204===e.currentTarget.status?(n=e.currentTarget.responseText,i=JSON.parse(n),l=l.concat(i.results),i.pagination.next?t(s+i.pagination.next):r(l)):c()},u.onerror=c,u.ontimeout=c,u.onabort=c,u}(0,i,"application/json",e,0,o),c={documentUrns:[n]};a.send(JSON.stringify(c))}(u)}))}))}n.r(t),n.d(t,{fetch2dLocations:()=>i})},11907:(e,t,n)=>{function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function r(e,t,n){return r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}},r(e,t,n||e)}function o(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}function l(e,t){return l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},l(e,t)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=g(e);if(t){var r=g(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return d(this,n)}}function d(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?p(e):t}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(e)}var f=Autodesk.Viewing,v=AutodeskNamespace("Autodesk.AEC.Locations");function y(t,n){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e.exports[i]=t[i],n[i]=t[i])}y(n(52463),v),y(n(70483),v);var m="locations-2d-context",_={fillColor:"rgb(205, 234, 247)",fillAlpha:.2,lineColor:"rgb(0, 110, 175)",lineWidth:2},E={background:"#FFFFFF",borderRadius:"17px",display:"flex",flexDirection:"row",padding:"5px 9px",boxShadow:"none",zIndex:0},A={color:"#006EAF",fontSize:"12px",lineHeight:"12px",alignSelf:"center"},x=function(e){"use strict";u(a,e);var t,n,i=h(a);function a(e,t){var n;return s(this,a),(n=i.call(this,e,t)).onModelAdded=n.onModelAdded.bind(p(n)),n}return c(a,[{key:"load",value:(t=regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.locations=[],e.next=3,this.viewer.loadExtension("Autodesk.Edit2D");case 3:return this.edit2dExtension=e.sent,this.edit2dContext=this.edit2dExtension.registerTools(m),t=function(e){u(n,Autodesk.Edit2D.FadeOutStyleRule);var t=h(n);function n(){return s(this,n),t.apply(this,arguments)}return c(n,[{key:"apply",value:function(e,t,i){r(g(n.prototype),"apply",this).call(this,e,t,i),e.styleInitialized||(e.styleInitialized=!0,Object.assign(e.container.style,E),Object.assign(e.textDiv.style,A)),e.hoverStyle^t.hover&&(e.hoverStyle=!!t.hover,e.container.style.boxShadow=t.hover?"0px 4px 14px rgba(12, 44, 84, 0.15), 0px 0px 2px rgba(12, 44, 84, 0.25)":"none")}}]),n}(),this.shapeLabelRule=new Autodesk.Edit2D.ShapeLabelRule(this.edit2dContext.layer,(function(e){return e.name}),void 0,new t),this.viewer.addEventListener(f.MODEL_ADDED_EVENT,this.onModelAdded),this.onModelAdded(),e.abrupt("return",!0);case 10:case"end":return e.stop()}}),e,this)})),n=function(){var e=this,n=arguments;return new Promise((function(i,r){var s=t.apply(e,n);function a(e){o(s,i,r,a,c,"next",e)}function c(e){o(s,i,r,a,c,"throw",e)}a(void 0)}))},function(){return n.apply(this,arguments)})},{key:"unload",value:function(){return this.edit2dExtension&&this.edit2dExtension.unregisterTools(m),this.shapeLabelRule.dtor(),this.shapeLabelRule=null,this.edit2dExtension=null,this.edit2dContext=null,this.locations=[],this.viewer.removeEventListener(f.MODEL_ADDED_EVENT,this.onModelAdded),!0}},{key:"onModelAdded",value:function(){var e;if(!(null===(e=this.viewer.model)||void 0===e?void 0:e.isPageCoordinates())){var t=Autodesk.Viewing.PDFUtils.getLeafletNormalizingMatrix(this.viewer);if(!t)return;var n=this.viewer.model.getMetadata("page_dimensions"),i=new THREE.Matrix4;i.makeScale(n.page_width,n.page_height,1);var r=new THREE.Matrix4;r.multiplyMatrices(i,t),r.invert(),this.edit2dContext.setMatrix(r)}}},{key:"setLocations",value:function(e){this.locations=e,this.allLocationsVisible&&this.showAllLocations()}},{key:"getLocations",value:function(){return this.locations}},{key:"getLocationById",value:function(e){var t=this.locations.find((function(t){return t.id===e}));return t||console.warn("Cant find location: ",e),t}},{key:"showLocationById",value:function(e){var t=this.getLocationById(e);this.showLocationItem(t)}},{key:"hideLocationById",value:function(e){var t=this.getLocationById(e);this.hideLocationItem(t)}},{key:"showLocationItem",value:function(e){if(e){var t=e.polygon;Object.assign(t.style,_),this.edit2dContext.layer.findShapeById(t.id)||this.edit2dContext.layer.addShape(t)}}},{key:"hideLocationItem",value:function(e){if(e){var t=e.polygon;this.edit2dContext.layer.removeShape(t)}}},{key:"showAllLocations",value:function(){var e=this;this.edit2dContext.layer.autoUpdate=!1,this.locations.forEach((function(t){e.showLocationItem(t)})),this.edit2dContext.layer.autoUpdate=!0,this.edit2dContext.layer.update(),this.allLocationsVisible=!0}},{key:"hideAllLocations",value:function(){var e=this;this.edit2dContext.layer.autoUpdate=!1,this.locations.forEach((function(t){e.hideLocationItem(t)})),this.edit2dContext.layer.autoUpdate=!0,this.edit2dContext.layer.update(),this.allLocationsVisible=!1}},{key:"getLocationIdsAtPoint",value:function(e){return Autodesk.AEC.Locations.getPointLocations(e,this.locations).map((function(e){return e.id}))}},{key:"onMouseMove",value:function(e){var t=this.viewer.impl.getCanvasBoundingClientRect(),n=this.viewer.clientToWorld(e.clientX-t.left,e.clientY-t.top,void 0,!0).point;if(this.viewer.model.isPageCoordinates()||(n=Autodesk.Viewing.PDFUtils.leafletToPdfWorld(this.viewer,n))){var i=this.getLocationIdsAtPoint(n).slice(0,1);this.hoverLocationsByIds(i)}}},{key:"hoverLocationsByIds",value:function(e){var t=!1;this.locations.forEach((function(n){var i=n.polygon;-1!==e.indexOf(n.id)?i.hover||(i.style.fillAlpha=.5,i.hover=!0,t=!0):i.hover&&(i.style.fillAlpha=.2,i.hover=!1,t=!0)})),t&&this.edit2dContext.layer.update()}}]),a}(f.Extension);f.theExtensionManager.registerExtension("Autodesk.AEC.LocationsExtension",x)},76820:(e,t,n)=>{"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.d(t,{Z:()=>o});var r="camera-near-far-overlay-scene",o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.topViewViewer=t,this.targetViewer=n,this.topViewViewer.impl.createOverlayScene(r),this.planeGeometry=new THREE.PlaneBufferGeometry(1,1),this.nearPlane=this.createMesh(23502),this.farPlane=this.createMesh(15249964),this.show(),this.update(),this.update=this.update.bind(this),this.targetViewer.addEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.update),this.topViewViewer.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.update)}var t,n;return t=e,(n=[{key:"createMesh",value:function(e){var t=new THREE.MeshBasicMaterial({color:e,opacity:1,transparent:!1,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide});return new THREE.Mesh(this.planeGeometry,t)}},{key:"show",value:function(){this.topViewViewer.impl.addOverlay(r,this.nearPlane),this.topViewViewer.impl.addOverlay(r,this.farPlane)}},{key:"hide",value:function(){this.topViewViewer.impl.removeOverlay(r,this.nearPlane),this.topViewViewer.impl.removeOverlay(r,this.farPlane)}},{key:"getScale",value:function(e){return e*this.topViewViewer.getCamera().orthoScale/this.topViewViewer.navigation.getScreenViewport().height}},{key:"update",value:function(){var e=this.targetViewer.getCamera(),t=e.target.clone().sub(e.position).normalize(),n=Math.atan2(e.target.y-e.position.y,e.target.x-e.position.x)+THREE.Math.degToRad(90),i=this.getScale(1),r=this.topViewViewer.getCamera().position.z-.001,o=e.position.clone().add(t.clone().multiplyScalar(e.near));o.z=r,this.nearPlane.position.copy(o),this.nearPlane.scale.set(200*i,4*i,1),this.nearPlane.rotation.set(0,0,n);var s=e.position.clone().add(t.clone().multiplyScalar(e.far));s.z=r,this.farPlane.position.copy(s),this.farPlane.scale.set(200*i,4*i,1),this.farPlane.rotation.set(0,0,n),this.topViewViewer.impl.invalidate(!1,!1,!0)}},{key:"destroy",value:function(){this.planeGeometry.dispose(),this.planeGeometry=null,this.topViewViewer.impl.removeOverlayScene(r),this.targetViewer.removeEventListener(Autodesk.Viewing.RENDER_PRESENTED_EVENT,this.update),this.topViewViewer.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.update),this.topViewViewer=null,this.targetViewer=null}}])&&i(t.prototype,n),e}()},32230:function(module,exports){function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}var e,t;e="undefined"!=typeof self?self:this,t=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==_typeof(e)&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=86)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=!1;"undefined"!=typeof window&&window.isJaguar&&(t.isSceneComposerEnv=i=!0);var r=!1;i&&(t.USE_LEGACY_LEIDS=r=window.isJaguar&&window.isJaguar()||!!JSON.parse(localStorage.getItem("USE_LEGACY_LEIDS"))),t.KERNEL_TOLERANCE=1e-6,t.KERNEL_ANGULAR_TOLERANCE=1e-10,t.PARAMETER_SPACE_TOLERANCE=1e-10,t.SPLINE_TANGENT_HANDLE_SCALE=1,t.SPLINE_DISTANCE_TOLERANCE=1e-4,t.DEFAULT_CURVE_RESOLUTION=64,t.isSceneComposerEnv=i,t.NO_ID="",t.USE_LEGACY_LEIDS=r,t.TESSELLATION={LINEAR_PRECISION:1e-4,ANGULAR_PRECISION:1e-5},t.GEOMETRY_TYPES={POINT:1,BCURVE:2,CIRCLE:3,ELLIPSE:4,HAPCURVE:5,LINE:6,BSURFACE:7,CONE:8,CYLINDER:9,ELLIPTICAL_CONE:10,ELLIPTICAL_CYLINDER:11,PLANE:12,SPHERE:13,TORUS:14,toString:function(e){switch(e){case this.POINT:return"Point";case this.BCURVE:return"BCurve";case this.CIRCLE:return"Circle";case this.ELLIPSE:return"Ellipse";case this.HAPCURVE:return"HapCurve";case this.LINE:return"Line";case this.BSURFACE:return"BSurface";case this.CONE:return"Cone";case this.CYLINDER:return"Cylinder";case this.ELLIPTICAL_CONE:return"EllipticalCone";case this.ELLIPTICAL_CYLINDER:return"EllipticalCylinder";case this.PLANE:return"Plane";case this.SPHERE:return"Sphere";case this.TORUS:return"Torus";default:return"unknown"}}},t.TOPOLOGY_TYPES={VERTEX:1,EDGE:2,COEDGE:3,LOOP:4,FACE:5,SHELL:6,LUMP:7,BODY:8,WIRE:9,WIREBODY:10,toString:function(e){switch(e){case this.VERTEX:return"Vertex";case this.EDGE:return"Edge";case this.COEDGE:return"Coedge";case this.LOOP:return"Loop";case this.FACE:return"Face";case this.SHELL:return"Shell";case this.LUMP:return"Lump";case this.BODY:return"Body";case this.WIRE:return"Wire";case this.WIREBODY:return"WireBody";default:return"unknown"}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"Vector2",(function(){return s})),n.d(t,"Vector3",(function(){return c})),n.d(t,"Vector4",(function(){return l})),n.d(t,"Matrix22",(function(){return d})),n.d(t,"Matrix33",(function(){return g})),n.d(t,"Matrix44",(function(){return v})),n.d(t,"Quat",(function(){return m})),n.d(t,"ProjectionUtils",(function(){return _})),n.d(t,"FLOAT64_TOLERANCE",(function(){return i})),n.d(t,"FLOAT32_TOLERANCE",(function(){return r}));var i=1e-12,r=1e-6,o={createFloat32:function(){var e=new Float32Array(2);return e[0]=0,e[1]=0,e},createFloat64:function(){var e=new Float64Array(2);return e[0]=0,e[1]=0,e},createNumber:function(){return[0,0]},clone:function(e){var t=new e.constructor(2);return t[0]=e[0],t[1]=e[1],t},createFloat32FromValues:function(e,t){var n=new Float32Array(2);return n[0]=e,n[1]=t,n}};o.asFloat32=o.createFloat32FromValues,o.createFloat64FromValues=function(e,t){var n=new Float64Array(2);return n[0]=e,n[1]=t,n},o.asFloat64=o.createFloat64FromValues,o.createNumberFromValues=function(e,t){return[e,t]},o.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e},o.set=function(e,t,n){return e[0]=t,e[1]=n,e},o.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e},o.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e},o.sub=o.subtract,o.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e},o.mul=o.multiply,o.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e},o.div=o.divide,o.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e},o.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e},o.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e},o.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e},o.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e},o.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e},o.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e},o.distance=function(e,t){var n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)},o.dist=o.distance,o.squaredDistance=function(e,t){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i},o.sqrDist=o.squaredDistance,o.length=function(e){var t=e[0],n=e[1];return Math.sqrt(t*t+n*n)},o.len=o.length,o.squaredLength=function(e){var t=e[0],n=e[1];return t*t+n*n},o.sqrLen=o.squaredLength,o.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e},o.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e},o.normalize=function(e,t){var n=t[0],i=t[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r),e},o.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},o.cross=function(e,t,n){var i=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=i,e},o.lerp=function(e,t,n,i){var r=t[0],o=t[1];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e},o.random=function(e,t){t=t||1;var n=2*Math.random()*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e},o.transformMatrix22=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[2]*r,e[1]=n[1]*i+n[3]*r,e},o.transformMatrix33=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[3]*r+n[6],e[1]=n[1]*i+n[4]*r+n[7],e},o.transformMatrix44=function(e,t,n){var i=t[0],r=t[1];return e[0]=n[0]*i+n[4]*r+n[12],e[1]=n[1]*i+n[5]*r+n[13],e},o.angle=function(e,t){var n=o.clone(e),i=o.clone(t);o.normalize(n,n),o.normalize(i,i);var r=o.dot(n,i),s=Math.abs(n[0]*i[1]-n[1]*i[0]);return Math.atan2(s,r)},o.isParallel=function(e,t,n,r){r=r||i,n=n||0;var s=e[0]*t[1]-e[1]*t[0];return!(s*s>r*r*o.squaredLength(e)*o.squaredLength(t))&&(n>0?o.dot(e,t)>0:!(n<0)||o.dot(e,t)<0)},o.isOrthogonal=function(e,t,n){n=n||i;var r=o.dot(e,t);return r*r<=n*n*o.squaredLength(e)*o.squaredLength(t)},o.toString=function(e){return"["+e[0]+", "+e[1]+"]"},o.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]},o.equals=function(e,t,n){return n=n||i,Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n};var s=o,a={createFloat32:function(){var e=new Float32Array(3);return e[0]=0,e[1]=0,e[2]=0,e},createFloat64:function(){var e=new Float64Array(3);return e[0]=0,e[1]=0,e[2]=0,e},createNumber:function(){return[0,0,0]},clone:function(e){var t=new e.constructor(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},createFloat32FromValues:function(e,t,n){var i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=n,i}};a.asFloat32=a.createFloat32FromValues,a.createFloat64FromValues=function(e,t,n){var i=new Float64Array(3);return i[0]=e,i[1]=t,i[2]=n,i},a.asFloat64=a.createFloat64FromValues,a.createNumberFromValues=function(e,t,n){return[e,t,n]},a.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},a.set=function(e,t,n,i){return e[0]=t,e[1]=n,e[2]=i,e},a.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e},a.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},a.sub=a.subtract,a.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},a.mul=a.multiply,a.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},a.div=a.divide,a.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e},a.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e},a.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e},a.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e},a.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e},a.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e},a.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e},a.distance=function(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return Math.sqrt(n*n+i*i+r*r)},a.dist=a.distance,a.squaredDistance=function(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2];return n*n+i*i+r*r},a.sqrDist=a.squaredDistance,a.length=function(e){var t=e[0],n=e[1],i=e[2];return Math.sqrt(t*t+n*n+i*i)},a.len=a.length,a.squaredLength=function(e){var t=e[0],n=e[1],i=e[2];return t*t+n*n+i*i},a.sqrLen=a.squaredLength,a.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},a.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e},a.normalize=function(e,t){var n=t[0],i=t[1],r=t[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e},a.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},a.cross=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],c=n[2];return e[0]=r*c-o*a,e[1]=o*s-i*c,e[2]=i*a-r*s,e},a.lerp=function(e,t,n,i){var r=t[0],o=t[1],s=t[2];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e},a.hermite=function(e,t,n,i,r,o){var s=o*o,a=s*(2*o-3)+1,c=s*(o-2)+o,u=s*(o-1),l=s*(3-2*o);return e[0]=t[0]*a+n[0]*c+i[0]*u+r[0]*l,e[1]=t[1]*a+n[1]*c+i[1]*u+r[1]*l,e[2]=t[2]*a+n[2]*c+i[2]*u+r[2]*l,e},a.bezier=function(e,t,n,i,r,o){var s=1-o,a=s*s,c=o*o,u=a*s,l=3*o*a,h=3*c*s,d=c*o;return e[0]=t[0]*u+n[0]*l+i[0]*h+r[0]*d,e[1]=t[1]*u+n[1]*l+i[1]*h+r[1]*d,e[2]=t[2]*u+n[2]*l+i[2]*h+r[2]*d,e},a.random=function(e,t){t=t||1;var n=2*Math.random()*Math.PI,i=2*Math.random()-1,r=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e[2]=i*t,e},a.transformMatrix44=function(e,t,n){var i=t[0],r=t[1],o=t[2];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12],e[1]=n[1]*i+n[5]*r+n[9]*o+n[13],e[2]=n[2]*i+n[6]*r+n[10]*o+n[14],e},a.transformAsDirectionMatrix44=function(e,t,n){var i=t[0],r=t[1],o=t[2];return e[0]=n[0]*i+n[4]*r+n[8]*o,e[1]=n[1]*i+n[5]*r+n[9]*o,e[2]=n[2]*i+n[6]*r+n[10]*o,e},a.transformMatrix33=function(e,t,n){var i=t[0],r=t[1],o=t[2];return e[0]=i*n[0]+r*n[3]+o*n[6],e[1]=i*n[1]+r*n[4]+o*n[7],e[2]=i*n[2]+r*n[5]+o*n[8],e},a.transformQuat=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],c=n[2],u=n[3],l=u*i+a*o-c*r,h=u*r+c*i-s*o,d=u*o+s*r-a*i,p=-s*i-a*r-c*o;return e[0]=l*u+p*-s+h*-c-d*-a,e[1]=h*u+p*-a+d*-s-l*-c,e[2]=d*u+p*-c+l*-a-h*-s,e},a.setFromMatrixScale=function(e,t){var n=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=Math.sqrt(t[4]*t[4]+t[5]*t[5]+t[6]*t[6]),r=Math.sqrt(t[8]*t[8]+t[9]*t[9]+t[10]*t[10]);return e[0]=n,e[1]=i,e[2]=r,e},a.rotateX=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},a.rotateY=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},a.rotateZ=function(e,t,n,i){var r=[],o=[];return r[0]=t[0]-n[0],r[1]=t[1]-n[1],r[2]=t[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e},a.angle=function(e,t){var n=a.clone(e),i=a.clone(t);a.normalize(n,n),a.normalize(i,i);var r=a.dot(n,i),o=a.length(a.cross(n,n,i));return Math.atan2(o,r)},a.isParallel=function(e,t,n,r){r=r||i,n=n||0;var o=a.createFloat64();return a.cross(o,e,t),!(a.squaredLength(o)>r*r*a.squaredLength(e)*a.squaredLength(t))&&(n>0?a.dot(e,t)>0:!(n<0)||a.dot(e,t)<0)},a.isOrthogonal=function(e,t,n){n=n||i;var r=a.dot(e,t);return r*r<=n*n*a.squaredLength(e)*a.squaredLength(t)},a.computeOrthogonal=function(e,t){return t[0]*t[0]>t[2]*t[2]?a.set(e,t[1],-t[0],0):a.set(e,0,t[2],-t[1]),e},a.setEulerFromRotationMatrix=function(e,t,n){var r=1-i;function o(e){return Math.min(Math.max(e,-1),1)}var s=t[0],a=t[4],c=t[8],u=t[1],l=t[5],h=t[9],d=t[2],p=t[6],g=t[10];return void 0===n||"XYZ"===n?(e[1]=Math.asin(o(c)),Math.abs(c)<r?(e[0]=Math.atan2(-h,g),e[2]=Math.atan2(-a,s)):(e[0]=Math.atan2(p,l),e[2]=0)):"YXZ"===n?(e[0]=Math.asin(-o(h)),Math.abs(h)<r?(e[1]=Math.atan2(c,g),e[2]=Math.atan2(u,l)):(e[1]=Math.atan2(-d,s),e[2]=0)):"ZXY"===n?(e[0]=Math.asin(o(p)),Math.abs(p)<r?(e[1]=Math.atan2(-d,g),e[2]=Math.atan2(-a,l)):(e[1]=0,e[2]=Math.atan2(u,s))):"ZYX"===n?(e[1]=Math.asin(-o(d)),Math.abs(d)<r?(e[0]=Math.atan2(p,g),e[2]=Math.atan2(u,s)):(e[0]=0,e[2]=Math.atan2(-a,l))):"YZX"===n?(e[2]=Math.asin(o(u)),Math.abs(u)<r?(e[0]=Math.atan2(-h,l),e[1]=Math.atan2(-d,s)):(e[0]=0,e[1]=Math.atan2(c,g))):"XZY"===n&&(e[2]=Math.asin(-o(a)),Math.abs(a)<r?(e[0]=Math.atan2(p,l),e[1]=Math.atan2(c,s)):(e[0]=Math.atan2(-h,g),e[1]=0)),e},a.toString=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"},a.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},a.equals=function(e,t,n){return n=n||i,Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n};var c=a,u={createFloat32:function(){var e=new Float32Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},createFloat64:function(){var e=new Float64Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e},createNumber:function(){return[0,0,0,0]},clone:function(e){var t=new e.constructor(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},createFloat32FromValues:function(e,t,n,i){var r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}};u.asFloat32=u.createFloat32FromValues,u.createFloat64FromValues=function(e,t,n,i){var r=new Float64Array(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r},u.asFloat64=u.createFloat64FromValues,u.createNumberFromValues=function(e,t,n,i){return[e,t,n,i]},u.copy=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},u.set=function(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e},u.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},u.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},u.sub=u.subtract,u.multiply=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e},u.mul=u.multiply,u.divide=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e},u.div=u.divide,u.ceil=function(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e},u.floor=function(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e},u.min=function(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e},u.max=function(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e},u.round=function(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e},u.scale=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},u.scaleAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e},u.distance=function(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],o=t[3]-e[3];return Math.sqrt(n*n+i*i+r*r+o*o)},u.dist=u.distance,u.squaredDistance=function(e,t){var n=t[0]-e[0],i=t[1]-e[1],r=t[2]-e[2],o=t[3]-e[3];return n*n+i*i+r*r+o*o},u.sqrDist=u.squaredDistance,u.length=function(e){var t=e[0],n=e[1],i=e[2],r=e[3];return Math.sqrt(t*t+n*n+i*i+r*r)},u.len=u.length,u.squaredLength=function(e){var t=e[0],n=e[1],i=e[2],r=e[3];return t*t+n*n+i*i+r*r},u.sqrLen=u.squaredLength,u.negate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},u.inverse=function(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e},u.normalize=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s),e[0]=n*s,e[1]=i*s,e[2]=r*s,e[3]=o*s),e},u.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},u.lerp=function(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=t[3];return e[0]=r+i*(n[0]-r),e[1]=o+i*(n[1]-o),e[2]=s+i*(n[2]-s),e[3]=a+i*(n[3]-a),e},u.random=function(e,t){return t=t||1,e[0]=Math.random(),e[1]=Math.random(),e[2]=Math.random(),e[3]=Math.random(),u.normalize(e,e),u.scale(e,e,t),e},u.transformMatrix44=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3];return e[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,e[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,e[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,e[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,e},u.transformQuat=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[0],a=n[1],c=n[2],u=n[3],l=u*i+a*o-c*r,h=u*r+c*i-s*o,d=u*o+s*r-a*i,p=-s*i-a*r-c*o;return e[0]=l*u+p*-s+h*-c-d*-a,e[1]=h*u+p*-a+d*-s-l*-c,e[2]=d*u+p*-c+l*-a-h*-s,e[3]=t[3],e},u.toString=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},u.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},u.equals=function(e,t,n){return n=n||i,Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[2]-t[2])<=n};var l=u,h={createFloat32:function(){var e=new Float32Array(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},createFloat64:function(){var e=new Float64Array(4);return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},createNumber:function(){return[1,0,0,1]},clone:function(e){var t=new e.constructor(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},createFloat32FromValues:function(e,t,n,i){var r=new Float32Array(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r}};h.asFloat32=h.createFloat32FromValues,h.createFloat64FromValues=function(e,t,n,i){var r=new Float64Array(4);return r[0]=e,r[1]=t,r[2]=n,r[3]=i,r},h.asFloat64=h.createFloat64FromValues,h.createNumberFromValues=function(e,t,n,i){return[e,t,n,i]},h.set=function(e,t,n,i,r){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e},h.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},h.transpose=function(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e},h.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*o-r*i;return s?(s=1/s,e[0]=o*s,e[1]=-i*s,e[2]=-r*s,e[3]=n*s,e):null},h.determinant=function(e){return e[0]*e[3]-e[2]*e[1]},h.multiply=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[0],c=n[1],u=n[2],l=n[3];return e[0]=i*a+o*c,e[1]=r*a+s*c,e[2]=i*u+o*l,e[3]=r*u+s*l,e},h.mul=h.multiply,h.scale=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[0],c=n[1];return e[0]=i*a,e[1]=r*a,e[2]=o*c,e[3]=s*c,e},h.toString=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},h.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e},h.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e},h.sub=h.subtract,h.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},h.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e},h.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},h.equals=function(e,t,n){return n=n||i,Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n};var d=h,p={createFloat32:function(){var e=new Float32Array(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},createFloat64:function(){var e=new Float64Array(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},createNumber:function(){return[1,0,0,0,1,0,0,0,1]},fromMatrix44:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},clone:function(e){var t=new e.constructor(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},createFloat32FromValues:function(e,t,n,i,r,o,s,a,c){var u=new Float32Array(9);return u[0]=e,u[1]=t,u[2]=n,u[3]=i,u[4]=r,u[5]=o,u[6]=s,u[7]=a,u[8]=c,u}};p.asFloat32=p.createFloat32FromValues,p.createFloat64FromValues=function(e,t,n,i,r,o,s,a,c){var u=new Float64Array(9);return u[0]=e,u[1]=t,u[2]=n,u[3]=i,u[4]=r,u[5]=o,u[6]=s,u[7]=a,u[8]=c,u},p.asFloat64=p.createFloat64FromValues,p.createNumberFromValues=function(e,t,n,i,r,o,s,a,c){return[e,t,n,i,r,o,s,a,c]},p.set=function(e,t,n,i,r,o,s,a,c,u){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=c,e[8]=u,e},p.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.transpose=function(e,t){if(e===t){var n=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},p.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=l*s-a*u,d=-l*o+a*c,p=u*o-s*c,g=n*h+i*d+r*p;return g?(g=1/g,e[0]=h*g,e[1]=(-l*i+r*u)*g,e[2]=(a*i-r*s)*g,e[3]=d*g,e[4]=(l*n-r*c)*g,e[5]=(-a*n+r*o)*g,e[6]=p*g,e[7]=(-u*n+i*c)*g,e[8]=(s*n-i*o)*g,e):null},p.determinant=function(e){var t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],c=e[7],u=e[8];return t*(u*o-s*c)+n*(-u*r+s*a)+i*(c*r-o*a)},p.multiply=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],c=t[5],u=t[6],l=t[7],h=t[8],d=n[0],p=n[1],g=n[2],f=n[3],v=n[4],y=n[5],m=n[6],_=n[7],E=n[8];return e[0]=d*i+p*s+g*u,e[1]=d*r+p*a+g*l,e[2]=d*o+p*c+g*h,e[3]=f*i+v*s+y*u,e[4]=f*r+v*a+y*l,e[5]=f*o+v*c+y*h,e[6]=m*i+_*s+E*u,e[7]=m*r+_*a+E*l,e[8]=m*o+_*c+E*h,e},p.mul=p.multiply,p.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e},p.fromRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=-n,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},p.fromQuat=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,c=r+r,u=n*s,l=i*s,h=i*a,d=r*s,p=r*a,g=r*c,f=o*s,v=o*a,y=o*c;return e[0]=1-h-g,e[3]=l-y,e[6]=d+v,e[1]=l+y,e[4]=1-u-g,e[7]=p-f,e[2]=d-v,e[5]=p+f,e[8]=1-u-h,e},p.normalFromMatrix44=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=t[9],d=t[10],p=t[11],g=t[12],f=t[13],v=t[14],y=t[15],m=n*a-i*s,_=n*c-r*s,E=n*u-o*s,A=i*c-r*a,x=i*u-o*a,C=r*u-o*c,w=l*f-h*g,b=l*v-d*g,M=l*y-p*g,T=h*v-d*f,V=h*y-p*f,S=d*y-p*v,R=m*S-_*V+E*T+A*M-x*b+C*w;return R?(R=1/R,e[0]=(a*S-c*V+u*T)*R,e[1]=(c*M-s*S-u*b)*R,e[2]=(s*V-a*M+u*w)*R,e[3]=(r*V-i*S-o*T)*R,e[4]=(n*S-r*M+o*b)*R,e[5]=(i*M-n*V-o*w)*R,e[6]=(f*C-v*x+y*A)*R,e[7]=(v*E-g*C-y*_)*R,e[8]=(g*x-f*E+y*m)*R,e):null},p.toString=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+"]"},p.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e},p.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e},p.sub=p.subtract,p.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e},p.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e},p.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]},p.equals=function(e,t,n){return n=n||i,Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n&&Math.abs(e[4]-t[4])<=n&&Math.abs(e[5]-t[5])<=n&&Math.abs(e[6]-t[6])<=n&&Math.abs(e[7]-t[7])<=n&&Math.abs(e[8]-t[8])<=n};var g=p,f={createFloat32:function(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},createFloat64:function(){var e=new Float64Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},createNumber:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},clone:function(e){var t=new e.constructor(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},copy:function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},createFloat32FromValues:function(e,t,n,i,r,o,s,a,c,u,l,h,d,p,g,f){var v=new Float32Array(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=i,v[4]=r,v[5]=o,v[6]=s,v[7]=a,v[8]=c,v[9]=u,v[10]=l,v[11]=h,v[12]=d,v[13]=p,v[14]=g,v[15]=f,v}};f.asFloat32=f.createFloat32FromValues,f.createFloat64FromValues=function(e,t,n,i,r,o,s,a,c,u,l,h,d,p,g,f){var v=new Float64Array(16);return v[0]=e,v[1]=t,v[2]=n,v[3]=i,v[4]=r,v[5]=o,v[6]=s,v[7]=a,v[8]=c,v[9]=u,v[10]=l,v[11]=h,v[12]=d,v[13]=p,v[14]=g,v[15]=f,v},f.asFloat64=f.createFloat64FromValues,f.createNumberFromValues=function(e,t,n,i,r,o,s,a,c,u,l,h,d,p,g,f){return[e,t,n,i,r,o,s,a,c,u,l,h,d,p,g,f]},f.set=function(e,t,n,i,r,o,s,a,c,u,l,h,d,p,g,f,v){return e[0]=t,e[1]=n,e[2]=i,e[3]=r,e[4]=o,e[5]=s,e[6]=a,e[7]=c,e[8]=u,e[9]=l,e[10]=h,e[11]=d,e[12]=p,e[13]=g,e[14]=f,e[15]=v,e},f.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},f.transpose=function(e,t){if(e===t){var n=t[1],i=t[2],r=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=o,e[11]=t[14],e[12]=r,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},f.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],c=t[6],u=t[7],l=t[8],h=t[9],d=t[10],p=t[11],g=t[12],f=t[13],v=t[14],y=t[15],m=n*a-i*s,_=n*c-r*s,E=n*u-o*s,A=i*c-r*a,x=i*u-o*a,C=r*u-o*c,w=l*f-h*g,b=l*v-d*g,M=l*y-p*g,T=h*v-d*f,V=h*y-p*f,S=d*y-p*v,R=m*S-_*V+E*T+A*M-x*b+C*w;return R?(R=1/R,e[0]=(a*S-c*V+u*T)*R,e[1]=(r*V-i*S-o*T)*R,e[2]=(f*C-v*x+y*A)*R,e[3]=(d*x-h*C-p*A)*R,e[4]=(c*M-s*S-u*b)*R,e[5]=(n*S-r*M+o*b)*R,e[6]=(v*E-g*C-y*_)*R,e[7]=(l*C-d*E+p*_)*R,e[8]=(s*V-a*M+u*w)*R,e[9]=(i*M-n*V-o*w)*R,e[10]=(g*x-f*E+y*m)*R,e[11]=(h*E-l*x-p*m)*R,e[12]=(a*b-s*T-c*w)*R,e[13]=(n*T-i*b+r*w)*R,e[14]=(f*_-g*A-v*m)*R,e[15]=(l*A-h*_+d*m)*R,e):null},f.determinant=function(e){var t=e[0],n=e[1],i=e[2],r=e[3],o=e[4],s=e[5],a=e[6],c=e[7],u=e[8],l=e[9],h=e[10],d=e[11],p=e[12],g=e[13],f=e[14],v=e[15];return(t*s-n*o)*(h*v-d*f)-(t*a-i*o)*(l*v-d*g)+(t*c-r*o)*(l*f-h*g)+(n*a-i*s)*(u*v-d*p)-(n*c-r*s)*(u*f-h*p)+(i*c-r*a)*(u*g-l*p)},f.multiply=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=t[4],c=t[5],u=t[6],l=t[7],h=t[8],d=t[9],p=t[10],g=t[11],f=t[12],v=t[13],y=t[14],m=t[15],_=n[0],E=n[1],A=n[2],x=n[3];return e[0]=_*i+E*a+A*h+x*f,e[1]=_*r+E*c+A*d+x*v,e[2]=_*o+E*u+A*p+x*y,e[3]=_*s+E*l+A*g+x*m,_=n[4],E=n[5],A=n[6],x=n[7],e[4]=_*i+E*a+A*h+x*f,e[5]=_*r+E*c+A*d+x*v,e[6]=_*o+E*u+A*p+x*y,e[7]=_*s+E*l+A*g+x*m,_=n[8],E=n[9],A=n[10],x=n[11],e[8]=_*i+E*a+A*h+x*f,e[9]=_*r+E*c+A*d+x*v,e[10]=_*o+E*u+A*p+x*y,e[11]=_*s+E*l+A*g+x*m,_=n[12],E=n[13],A=n[14],x=n[15],e[12]=_*i+E*a+A*h+x*f,e[13]=_*r+E*c+A*d+x*v,e[14]=_*o+E*u+A*p+x*y,e[15]=_*s+E*l+A*g+x*m,e},f.mul=f.multiply,f.fromTranslation=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},f.fromScaling=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},f.fromRotation=function(e,t,n){var r,o,s,a=n[0],c=n[1],u=n[2],l=Math.sqrt(a*a+c*c+u*u);return Math.abs(l)<i?null:(a*=l=1/l,c*=l,u*=l,r=Math.sin(t),s=1-(o=Math.cos(t)),e[0]=a*a*s+o,e[1]=c*a*s+u*r,e[2]=u*a*s-c*r,e[3]=0,e[4]=a*c*s-u*r,e[5]=c*c*s+o,e[6]=u*c*s+a*r,e[7]=0,e[8]=a*u*s+c*r,e[9]=c*u*s-a*r,e[10]=u*u*s+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},f.fromXRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},f.fromYRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},f.fromZRotation=function(e,t){var n=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},f.fromRotationTranslation=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=i+i,c=r+r,u=o+o,l=i*a,h=i*c,d=i*u,p=r*c,g=r*u,f=o*u,v=s*a,y=s*c,m=s*u;return e[0]=1-(p+f),e[1]=h+m,e[2]=d-y,e[3]=0,e[4]=h-m,e[5]=1-(l+f),e[6]=g+v,e[7]=0,e[8]=d+y,e[9]=g-v,e[10]=1-(l+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},f.getTranslation=function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e},f.extractRotation=function(e,t){var n=1/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),i=1/Math.sqrt(t[4]*t[4]+t[5]*t[5]+t[6]*t[6]),r=1/Math.sqrt(t[8]*t[8]+t[9]*t[9]+t[10]*t[10]);return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=0,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=0,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},f.getRotation=function(e,t){var n=t[0]+t[5]+t[10],i=0;return n>0?(i=2*Math.sqrt(n+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e},f.fromRotationTranslationScale=function(e,t,n,i){var r=t[0],o=t[1],s=t[2],a=t[3],c=r+r,u=o+o,l=s+s,h=r*c,d=r*u,p=r*l,g=o*u,f=o*l,v=s*l,y=a*c,m=a*u,_=a*l,E=i[0],A=i[1],x=i[2];return e[0]=(1-(g+v))*E,e[1]=(d+_)*E,e[2]=(p-m)*E,e[3]=0,e[4]=(d-_)*A,e[5]=(1-(h+v))*A,e[6]=(f+y)*A,e[7]=0,e[8]=(p+m)*x,e[9]=(f-y)*x,e[10]=(1-(h+g))*x,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e},f.fromRotationTranslationScaleOrigin=function(e,t,n,i,r){var o=t[0],s=t[1],a=t[2],c=t[3],u=o+o,l=s+s,h=a+a,d=o*u,p=o*l,g=o*h,f=s*l,v=s*h,y=a*h,m=c*u,_=c*l,E=c*h,A=i[0],x=i[1],C=i[2],w=r[0],b=r[1],M=r[2];return e[0]=(1-(f+y))*A,e[1]=(p+E)*A,e[2]=(g-_)*A,e[3]=0,e[4]=(p-E)*x,e[5]=(1-(d+y))*x,e[6]=(v+m)*x,e[7]=0,e[8]=(g+_)*C,e[9]=(v-m)*C,e[10]=(1-(d+f))*C,e[11]=0,e[12]=n[0]+w-(e[0]*w+e[4]*b+e[8]*M),e[13]=n[1]+b-(e[1]*w+e[5]*b+e[9]*M),e[14]=n[2]+M-(e[2]*w+e[6]*b+e[10]*M),e[15]=1,e},f.fromQuat=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n+n,a=i+i,c=r+r,u=n*s,l=i*s,h=i*a,d=r*s,p=r*a,g=r*c,f=o*s,v=o*a,y=o*c;return e[0]=1-h-g,e[1]=l+y,e[2]=d-v,e[3]=0,e[4]=l-y,e[5]=1-u-g,e[6]=p+f,e[7]=0,e[8]=d+v,e[9]=p-f,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},f.setRotationFromEuler=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=Math.cos(i),a=Math.sin(i),c=Math.cos(r),u=Math.sin(r),l=Math.cos(o),h=Math.sin(o);if(void 0===n||"XYZ"===n){var d=s*l,p=s*h,g=a*l,f=a*h;e[0]=c*l,e[4]=-c*h,e[8]=u,e[1]=p+g*u,e[5]=d-f*u,e[9]=-a*c,e[2]=f-d*u,e[6]=g+p*u,e[10]=s*c}else if("YXZ"===n){var v=c*l,y=c*h,m=u*l,_=u*h;e[0]=v+_*a,e[4]=m*a-y,e[8]=s*u,e[1]=s*h,e[5]=s*l,e[9]=-a,e[2]=y*a-m,e[6]=_+v*a,e[10]=s*c}else if("ZXY"===n)v=c*l,y=c*h,m=u*l,_=u*h,e[0]=v-_*a,e[4]=-s*h,e[8]=m+y*a,e[1]=y+m*a,e[5]=s*l,e[9]=_-v*a,e[2]=-s*u,e[6]=a,e[10]=s*c;else if("ZYX"===n)d=s*l,p=s*h,g=a*l,f=a*h,e[0]=c*l,e[4]=g*u-p,e[8]=d*u+f,e[1]=c*h,e[5]=f*u+d,e[9]=p*u-g,e[2]=-u,e[6]=a*c,e[10]=s*c;else if("YZX"===n){var E=s*c,A=s*u,x=a*c,C=a*u;e[0]=c*l,e[4]=C-E*h,e[8]=x*h+A,e[1]=h,e[5]=s*l,e[9]=-a*l,e[2]=-u*l,e[6]=A*h+x,e[10]=E-C*h}else"XZY"===n&&(E=s*c,A=s*u,x=a*c,C=a*u,e[0]=c*l,e[4]=-h,e[8]=u*l,e[1]=E*h+C,e[5]=s*l,e[9]=A*h-x,e[2]=x*h-A,e[6]=a*l,e[10]=C*h+E);return e},f.toString=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"},f.add=function(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e},f.subtract=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e},f.sub=f.subtract,f.multiplyScalar=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e},f.multiplyScalarAndAdd=function(e,t,n,i){return e[0]=t[0]+n[0]*i,e[1]=t[1]+n[1]*i,e[2]=t[2]+n[2]*i,e[3]=t[3]+n[3]*i,e[4]=t[4]+n[4]*i,e[5]=t[5]+n[5]*i,e[6]=t[6]+n[6]*i,e[7]=t[7]+n[7]*i,e[8]=t[8]+n[8]*i,e[9]=t[9]+n[9]*i,e[10]=t[10]+n[10]*i,e[11]=t[11]+n[11]*i,e[12]=t[12]+n[12]*i,e[13]=t[13]+n[13]*i,e[14]=t[14]+n[14]*i,e[15]=t[15]+n[15]*i,e},f.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},f.equals=function(e,t,n){return n=n||i,Math.abs(e[0]-t[0])<=n&&Math.abs(e[1]-t[1])<=n&&Math.abs(e[2]-t[2])<=n&&Math.abs(e[3]-t[3])<=n&&Math.abs(e[4]-t[4])<=n&&Math.abs(e[5]-t[5])<=n&&Math.abs(e[6]-t[6])<=n&&Math.abs(e[7]-t[7])<=n&&Math.abs(e[8]-t[8])<=n&&Math.abs(e[9]-t[9])<=n&&Math.abs(e[10]-t[10])<=n&&Math.abs(e[11]-t[11])<=n&&Math.abs(e[12]-t[12])<=n&&Math.abs(e[13]-t[13])<=n&&Math.abs(e[14]-t[14])<=n&&Math.abs(e[15]-t[15])<=n};var v=f,y={createFloat32:function(){var e=new Float32Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},createFloat64:function(){var e=new Float64Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},createNumber:function(){return[0,0,0,1]}};y.rotationTo=function(){var e=c.createFloat64(),t=c.createFloat64FromValues(1,0,0),n=c.createFloat64FromValues(0,1,0);return function(r,o,s){var a=c.dot(o,s);return a<-1+i?(c.cross(e,t,o),c.length(e)<i&&c.cross(e,n,o),c.normalize(e,e),y.setAxisAngle(r,e,Math.PI),r):a>1-i?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(c.cross(e,o,s),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+a,y.normalize(r,r))}}(),y.setAxes=function(){var e=g.createFloat64();return function(t,n,i,r){return e[0]=i[0],e[3]=i[1],e[6]=i[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],y.normalize(t,y.fromMatrix33(t,e))}}(),y.clone=l.clone,y.createFloat32FromValues=l.createFloat32FromValues,y.createFloat64FromValues=l.createFloat64FromValues,y.createNumberFromValues=l.createNumberFromValues,y.asFloat32=l.createFloat32FromValues,y.asFloat64=l.createFloat64FromValues,y.copy=l.copy,y.set=l.set,y.identity=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},y.setAxisAngle=function(e,t,n){n*=.5;var i=Math.sin(n);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(n),e},y.getAxisAngle=function(e,t){var n=2*Math.acos(t[3]),i=Math.sin(n/2);return 0!==i?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},y.add=l.add,y.multiply=function(e,t,n){var i=t[0],r=t[1],o=t[2],s=t[3],a=n[0],c=n[1],u=n[2],l=n[3];return e[0]=i*l+s*a+r*u-o*c,e[1]=r*l+s*c+o*a-i*u,e[2]=o*l+s*u+i*c-r*a,e[3]=s*l-i*a-r*c-o*u,e},y.mul=y.multiply,y.scale=l.scale,y.rotateX=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=i*c+s*a,e[1]=r*c+o*a,e[2]=o*c-r*a,e[3]=s*c-i*a,e},y.rotateY=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=i*c-o*a,e[1]=r*c+s*a,e[2]=o*c+i*a,e[3]=s*c-r*a,e},y.rotateZ=function(e,t,n){n*=.5;var i=t[0],r=t[1],o=t[2],s=t[3],a=Math.sin(n),c=Math.cos(n);return e[0]=i*c+r*a,e[1]=r*c-i*a,e[2]=o*c+s*a,e[3]=s*c-o*a,e},y.calculateW=function(e,t){var n=t[0],i=t[1],r=t[2];return e[0]=n,e[1]=i,e[2]=r,e[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),e},y.dot=l.dot,y.lerp=l.lerp,y.slerp=function(e,t,n,r){var o,s,a,c,u,l=t[0],h=t[1],d=t[2],p=t[3],g=n[0],f=n[1],v=n[2],y=n[3];return(s=l*g+h*f+d*v+p*y)<0&&(s=-s,g=-g,f=-f,v=-v,y=-y),1-s>i?(o=Math.acos(s),a=Math.sin(o),c=Math.sin((1-r)*o)/a,u=Math.sin(r*o)/a):(c=1-r,u=r),e[0]=c*l+u*g,e[1]=c*h+u*f,e[2]=c*d+u*v,e[3]=c*p+u*y,e},y.sqlerp=function(){var e=y.createFloat64(),t=y.createFloat64();return function(n,i,r,o,s,a){return y.slerp(e,i,s,a),y.slerp(t,r,o,a),y.slerp(n,e,t,2*a*(1-a)),n}}(),y.invert=function(e,t){var n=t[0],i=t[1],r=t[2],o=t[3],s=n*n+i*i+r*r+o*o,a=s?1/s:0;return e[0]=-n*a,e[1]=-i*a,e[2]=-r*a,e[3]=o*a,e},y.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},y.length=l.length,y.len=y.length,y.squaredLength=l.squaredLength,y.sqrLen=y.squaredLength,y.normalize=l.normalize,y.fromMatrix33=function(e,t){var n,i=t[0]+t[4]+t[8];if(i>0)n=Math.sqrt(i+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{var r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;n=Math.sqrt(t[3*r+r]-t[3*o+o]-t[3*s+s]+1),e[r]=.5*n,n=.5/n,e[3]=(t[3*o+s]-t[3*s+o])*n,e[o]=(t[3*o+r]+t[3*r+o])*n,e[s]=(t[3*s+r]+t[3*r+s])*n}return e},y.toString=function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"},y.exactEquals=l.exactEquals,y.equals=l.equals;var m=y,_={frustum:function(e,t,n,i,r,o,s){var a=1/(n-t),c=1/(r-i),u=1/(o-s);return e[0]=2*o*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*c,e[6]=0,e[7]=0,e[8]=(n+t)*a,e[9]=(r+i)*c,e[10]=(s+o)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*o*2*u,e[15]=0,e},perspective:function(e,t,n,i,r){var o=1/Math.tan(t/2),s=1/(i-r);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(r+i)*s,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*r*i*s,e[15]=0,e},ortho:function(e,t,n,i,r,o,s){var a=1/(t-n),c=1/(i-r),u=1/(o-s);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*a,e[13]=(r+i)*c,e[14]=(s+o)*u,e[15]=1,e},lookAt:function(e,t,n,r){var o,s,a,c,u,l,h,d,p,g,f=t[0],y=t[1],m=t[2],_=r[0],E=r[1],A=r[2],x=n[0],C=n[1],w=n[2];return Math.abs(f-x)<i&&Math.abs(y-C)<i&&Math.abs(m-w)<i?v.identity(e):(h=f-x,d=y-C,p=m-w,o=E*(p*=g=1/Math.sqrt(h*h+d*d+p*p))-A*(d*=g),s=A*(h*=g)-_*p,a=_*d-E*h,(g=Math.sqrt(o*o+s*s+a*a))?(o*=g=1/g,s*=g,a*=g):(o=0,s=0,a=0),c=d*a-p*s,u=p*o-h*a,l=h*s-d*o,(g=Math.sqrt(c*c+u*u+l*l))?(c*=g=1/g,u*=g,l*=g):(c=0,u=0,l=0),e[0]=o,e[1]=c,e[2]=h,e[3]=0,e[4]=s,e[5]=u,e[6]=d,e[7]=0,e[8]=a,e[9]=l,e[10]=p,e[11]=0,e[12]=-(o*f+s*y+a*m),e[13]=-(c*f+u*y+l*m),e[14]=-(h*f+d*y+p*m),e[15]=1,e)},transformProjectionMatrix:function(e,t,n){var i=t[0],r=t[1],o=t[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];return s=s||1,e[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/s,e[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,e[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,e}};t.default={Vector2:s,Vector3:c,Vector4:l,Matrix22:d,Matrix33:g,Matrix44:v,Quat:m,ProjectionUtils:_,FLOAT64_TOLERANCE:i,FLOAT32_TOLERANCE:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={assert:function(e,t){if(!e)throw new Error(t)}};t.ConsoleUtils=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.definePlaneThroughPoints=t.getPlaneTransforms=t.limitRange=t.PI2=t.sortedIndex=t.clamp=t.orient2D=t.signedDistanceTo2DLine=t.intersectIntervals=t.solveTwoEquationsTwoVariables=t.closestPointToTriangle=t.closestPointToPolyline=t.distancePointToLineSegment=t.projectPointToLineSegment=t.angleDifference=t.periodicDifference=t.minMaxCosSinFunc=t.convertToOtherPeriodicRange=t.adjustParameterToPeriodicRange=t.getShortestParametricRange=t.isParameterWithinPeriodicRange=t.normalizeSegmentsToPeriodicRange=t.normalizeParametricRange=t.normalizeParametricRangeToShiftedRange=t.normalizeParameterToShiftedRange=t.adjustAngleToRange=t.normalizeAngleRange=t.normalizeAngle=t.normalizeParameter=t.foldNearTo=t.foldAbove=t.fold=t.modulus=t.getSignedAngle=t.isPointInsidePolygon2D=t.binomialCoefficients=void 0;var i=n(1),r=n(0),o=n(2),s=2*Math.PI,a=[];!function(){for(var e=0;e<8;++e){a[e]=[1];for(var t=1;t<e;++t)a[e][t]=a[e-1][t-1]+a[e-1][t];a[e][e]=1}}();var c=function(e,t,n){return Math.min(Math.max(t,e),n)},u=function(e,t){return e-t*Math.floor(e/t)},l=function(e,t){var n=e%t;return n<0?n+t:n},h=function(e,t,n){return l(e-t,n)+t},d=function(e,t){return e<0?t+e%t:e%t},p=function(e,t){return d(e-t[0],t[1]-t[0])+t[0]},g=function(e,t){o.ConsoleUtils.assert(e[1]>=e[0],"normalizeParametricRange: in_range ends not in order.");var n=e[1]-e[0],i=d(e[0],t);return[i,i+n]},f=function(e,t,n,i,r){if(!isFinite(n))return e;var o=g(t,n),s=d(e,n),a=s+n;if(i=!!i,s>=o[0]&&s<=o[1])return t[0]+(s-o[0]);if(a>=o[0]&&a<=o[1])return t[0]+(a-o[0]);var c=Math.abs(o[0]-s),u=Math.abs(s-o[1]),l=Math.abs(o[0]-a),h=Math.abs(a-o[1]);return r?Math.min(c,l)<Math.min(u,h)?t[0]:t[1]:Math.min(c,u)>Math.min(l,h)&&!i?t[0]+(a-o[0]):t[0]+(s-o[0])},v=function(e,t,n){var i=Math.abs(e-t);return isFinite(n)&&(i%=n)>n/2?n-i:i},y=function(e,t,n){var o=i.Vector3.sub(i.Vector3.createFloat64(),t,e),s=i.Vector3.dot(o,o);if(s<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE)return 0;var a=i.Vector3.sub(i.Vector3.createFloat64(),n,e);return i.Vector3.dot(a,o)/s};t.binomialCoefficients=a,t.isPointInsidePolygon2D=function(e,t){for(var n=!1,i=t.length,r=0,o=i-2;r<i;r+=2)t[r+1]>e[1]!=t[o+1]>e[1]&&e[0]<(t[o]-t[r])*(e[1]-t[r+1])/(t[o+1]-t[r+1])+t[r]&&(n=!n),o=r;return n},t.getSignedAngle=function(e,t){var n=c(i.Vector2.dot(e,t),-1,1),r=t[0]*e[1]-t[1]*e[0];return 0===r?.5*Math.PI*(n-1):r<0?-Math.acos(n):Math.acos(n)},t.modulus=u,t.fold=l,t.foldAbove=h,t.foldNearTo=function(e,t,n){return h(e,t-n/2,n)},t.normalizeParameter=d,t.normalizeAngle=function(e){return d(e,s)},t.normalizeAngleRange=function(e){return g(e,2*Math.PI)},t.adjustAngleToRange=function(e,t){return f(e,t,2*Math.PI)},t.normalizeParameterToShiftedRange=p,t.normalizeParametricRangeToShiftedRange=function(e,t){o.ConsoleUtils.assert(e[1]>=e[0],"normalizeParametricRangeToShiftedRange: in_range ends not in order.");var n=e[1]-e[0],i=p(e[0],t);return[i,i+n]},t.normalizeParametricRange=g,t.normalizeSegmentsToPeriodicRange=function(e,t,n,i,o){for(var s=void 0!==i?i:r.KERNEL_TOLERANCE,a=void 0!==o?o:t[1]-t[0],c=[],u=0;u<e.length;u++){var l=p(e[u][0],t),h=e[u][1]-e[u][0];if(h>=a)return[[t[0],t[1]]];var d=l+h;d<t[1]?c.push([l,d]):(c.push([l,t[1]]),c.push([t[0],d-t[1]+t[0]]))}var g=[];for(c.sort((function(e,t){return e[0]-t[0]})),u=0;u<c.length;u++){for(var f=c[u];u+1<c.length&&c[u+1][0]<f[1];)f[1]=Math.max(f[1],c[u+1][1]),u++;(Math.abs(f[1]-f[0])>s||!n)&&g.push(f)}return g},t.isParameterWithinPeriodicRange=function(e,t,n,i){var r=f(e,t,n);return i=i||0,r>t[0]-i&&r<t[1]+i},t.getShortestParametricRange=function(e,t,n){if((e=d(e,n))>(t=d(t,n))){var i=e;e=t,t=i}return e-t+n<t-e?[t,e+n]:[e,t]},t.adjustParameterToPeriodicRange=f,t.convertToOtherPeriodicRange=function(e,t,n,i){if(!isFinite(n))return o.ConsoleUtils.assert(e[0]>=t[0]-i,"The start of the input range doesn't lie in the target range."),o.ConsoleUtils.assert(e[1]<=t[1]+i,"The input range doesn't lie within the target range."),e;if(i=i||0,e[1]-e[0]>=n-i)return t[1]-t[0]<n-i&&console.error("The input range is larger than the target range."),t;var r=f(e[0],t,n);o.ConsoleUtils.assert(r>=t[0]-i,"The start of the input range doesn't lie in the target range.");var s=r+e[1]-e[0];return o.ConsoleUtils.assert(s<=t[1]+i,"The input range doesn't lie within the target range."),[r,s]},t.minMaxCosSinFunc=function(e,t,n,i){if(0===e&&0===t)return[n,n];var r,o=g(i,2*Math.PI),s=f(Math.atan(t/e),o,Math.PI,!0),a=[];for(r=0;r<3;++r)o[0]<=s&&o[1]>=s&&a.push(e*Math.cos(s)+t*Math.sin(s)),s+=Math.PI;if(i[1]-i[0]<2*Math.PI)for(r=0;r<2;r++)a.push(e*Math.cos(i[r])+t*Math.sin(i[r]));return[Math.min.apply(null,a)+n,Math.max.apply(null,a)+n]},t.periodicDifference=v,t.angleDifference=function(e,t){return v(e,t,2*Math.PI)},t.projectPointToLineSegment=y,t.distancePointToLineSegment=function(e,t,n,r){var o=y(e,t,n);o=c(o,0,1);var s=r||i.Vector3.createFloat64();return i.Vector3.lerp(s,e,t,o),i.Vector3.distance(s,n)},t.closestPointToPolyline=function(e,t,n,r,o){for(var s="number"==typeof t[0],a=s?t.length/3:t.length,u=void 0,l=Number.POSITIVE_INFINITY,h=i.Vector3.createFloat64(),d=0;d<a-1;++d){var p=n?n[d]:d,g=n?n[d+1]:d+1,f=0,v=1;if(!(r&&(r[0]>p&&(f=(r[0]-p)/(g-p)),r[1]<g&&(v=(r[1]-p)/(g-p)),v<f))){var m,_;s?(m=[t[3*d],t[3*d+1],t[3*d+2]],_=[t[3*d+3],t[3*d+4],t[3*d+5]]):(m=t[d],_=t[d+1]);var E=y(m,_,e);E=c(E,f,v),i.Vector3.lerp(h,m,_,E);var A=i.Vector3.squaredDistance(h,e);A<l&&(u=(1-E)*p+E*g,l=A,o&&i.Vector3.copy(o,h))}}return u},t.closestPointToTriangle=function(e,t,n,o,s){var a,u,l=i.Vector3.sub(i.Vector3.createFloat64(),n,t),h=i.Vector3.sub(i.Vector3.createFloat64(),o,t),d=i.Vector3.sub(i.Vector3.createFloat64(),e,t),p=i.Vector3.squaredLength(l),g=i.Vector3.squaredLength(h),f=i.Vector3.dot(l,h),v=i.Vector3.dot(d,l),m=i.Vector3.dot(d,h);if(p<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE&&g<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE)a=u=0;else if(p<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE)a=0,u=c(m/g,0,1);else if(g<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE)a=c(v/p,0,1),u=0;else{var _=i.Matrix22.createFloat64FromValues(p,f,f,g);if(Math.abs(i.Matrix22.determinant(_))>i.FLOAT64_TOLERANCE){i.Matrix22.invert(_,_);var E=[v,m];i.Vector2.transformMatrix22(E,E,_),a=E[0],u=E[1]}else u=m/g,(a=v/p)<=0||u<=0?(a=c(a,0,1),u=c(u,0,1)):a<u?(a=c(a,0,1),u=0):(a=0,u=c(u,0,1))}if(a<0&&m>=0&&m<=g&&(a=0,u=m/g),u<0&&v>=0&&v<=p&&(a=v/p,u=0),a+u>1){var A=y(n,o,e);A>=0&&A<=1&&(a=1-A,u=A)}if(a<0||u<0||a+u>1){var x=i.Vector3.squaredLength(d),C=i.Vector3.squaredDistance(e,n),w=i.Vector3.squaredDistance(e,o);C<=x&&C<=w?(a=1,u=0):w<=x&&w<=C?(a=0,u=1):a=u=0}return s&&(i.Vector3.scaleAndAdd(s,t,l,a),i.Vector3.scaleAndAdd(s,s,h,u)),{coordA:a,coordB:u}},t.solveTwoEquationsTwoVariables=function(e){var t=e[0][0],n=e[0][1],i=e[1][0],r=e[1][1],o=t*r-n*i;if(0!==o){var s=r*e[0][2]-n*e[1][2],a=-i*e[0][2]+t*e[1][2];return[s/=o,a/=o]}},t.intersectIntervals=function(e,t,n){n=n||0;for(var i=[],r=0;r<e.length;r++)for(var o=0;o<t.length;o++){var s=Math.max(e[r][0],t[o][0]),a=Math.min(e[r][1],t[o][1]);a-n>s&&(a>s?i.push([s,a]):i.push([a,a]))}return i},t.signedDistanceTo2DLine=function(e,t,n){var i=n[0]-e[0],r=n[1]-e[1];return t[1]*i-t[0]*r},t.orient2D=function(e,t,n){var i=e[0]-n[0],r=t[0]-n[0],o=e[1]-n[1];return i*(t[1]-n[1])-o*r},t.clamp=c,t.sortedIndex=function(e,t){for(var n=0,i=e.length;i>n;){var r=Math.floor((n+i)/2);t>e[r]?n=r+1:i=r}return i},t.PI2=s,t.limitRange=function(e,t,n,r){if(o.ConsoleUtils.assert(2===t.length),o.ConsoleUtils.assert(t[0]<=t[1]),n)return t[1]-t[0]<r+i.FLOAT64_TOLERANCE?[t[0],t[1]]:(console.warn("limitRange : in_limitRange length cannot be greater than in_period"),[t[0],t[0]+r]);var s=Math.max(e[0],t[0]),a=Math.min(e[1],t[1]);return s>a&&(s>a+i.FLOAT64_TOLERANCE&&console.warn("limitRange : requested range must overlap in_oldRange"),s=a=t[0]>e[1]?e[1]:e[0]),[s,a]},t.getPlaneTransforms=function(e){var t,n,r=e.evaluateDu(0,0),o=e.evaluateDv(0,0),s=e.getOrigin();if(!i.Vector3.isParallel(r,[1,0,0],1)||!i.Vector3.isParallel(o,[0,1,0],1)||Math.abs(s[2])>i.FLOAT64_TOLERANCE){var a=e.evaluateNormal(0,0);t=i.Matrix44.createFloat64FromValues(r[0],r[1],r[2],0,o[0],o[1],o[2],0,a[0],a[1],a[2],0,s[0],s[1],s[2],1),n=i.Matrix44.createFloat64(),i.Matrix44.invert(n,t)}return{uvToThreeSpace:t,threeSpaceToUV:n}},t.definePlaneThroughPoints=function(e){var t,n,o,s=[0,0,0],a=[0,0,0];if(!(e.length<3)){var c=[0,0,0];for(t=0;t<e.length;++t)i.Vector3.add(c,c,e[t]);i.Vector3.scale(c,c,1/e.length);var l=[0,0,0];n=0;var h=0,d=0;for(t=0;t<e.length;++t){(o=i.Vector3.squaredDistance(c,e[t]))>d&&(d=o,h=t),(o/=100)>n&&(n=o,i.Vector3.sub(l,e[t],c));var p=(t+1)%e.length;(o=i.Vector3.squaredDistance(e[t],e[p]))>n&&(n=o,i.Vector3.sub(l,e[p],e[t]))}if(!(d<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE)){i.Vector3.normalize(l,l);var g=[0,0,0];for(n=0,t=0;t<e.length;++t)i.Vector3.sub(s,e[t],c),i.Vector3.cross(s,s,l),(o=i.Vector3.squaredLength(s))>n&&(n=o,i.Vector3.copy(g,s));if(!(n<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE)){i.Vector3.normalize(g,g);var f=e[h],v=e[u(h-1,e.length)],y=e[u(h+1,e.length)];i.Vector3.sub(s,v,f),i.Vector3.sub(a,y,f),i.Vector3.dot(i.Vector3.cross(a,a,s),g)<0&&i.Vector3.negate(g,g);var m=[0,0,0];i.Vector3.cross(m,g,l),i.Vector3.normalize(m,m);var _=Number.POSITIVE_INFINITY,E=Number.NEGATIVE_INFINITY,A=Number.POSITIVE_INFINITY,x=Number.NEGATIVE_INFINITY;for(t=0;t<e.length;++t){i.Vector3.sub(s,e[t],c);var C=i.Vector3.dot(s,l),w=i.Vector3.dot(s,m);_=Math.min(_,C),E=Math.max(E,C),A=Math.min(A,w),x=Math.max(x,w)}return{origin:c,normal:g,uAxis:l,vAxis:m,uRange:[_,E],vRange:[A,x]}}}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BoundingBox=void 0;var i=n(1),r=n(0),o=function(e,t){this.min=e?i.Vector3.createFloat64FromValues(e[0],e[1],e[2]):i.Vector3.createFloat64FromValues(1/0,1/0,1/0),this.max=t?i.Vector3.createFloat64FromValues(t[0],t[1],t[2]):i.Vector3.createFloat64FromValues(-1/0,-1/0,-1/0)};o.prototype.toString=function(){return"(x:"+this.min[0]+", y:"+this.min[1]+", z:"+this.min[2]+") -> (x:"+this.max[0]+", y:"+this.max[1]+", z:"+this.max[2]+")"},o.prototype.copy=function(e){return i.Vector3.copy(this.min,e.min),i.Vector3.copy(this.max,e.max),this},o.prototype.clone=function(){return new o(this.min,this.max)},o.prototype.getWidth=function(e){var t=0;return 0<=e&&e<=2?(t=this.max[e]-this.min[e],isFinite(t)?t:0):(console.error("wrong axis argument supplied to BoundingBox.getWidth(): "+e),0)},o.prototype.getMaxMinAligned=function(e,t,n){for(var r,s,a,c=this.getCorners(),u=[],l=[],h=[],d=0;d<c.length;++d)r=i.Vector3.dot(c[d],e),s=i.Vector3.dot(c[d],t),a=i.Vector3.dot(c[d],n),u.push(r),l.push(s),h.push(a);var p=Math.min.apply(void 0,u),g=Math.min.apply(void 0,l),f=Math.min.apply(void 0,h),v=Math.max.apply(void 0,u),y=Math.max.apply(void 0,l),m=Math.max.apply(void 0,h);return new o([p,g,f],[v,y,m])},o.prototype.include=function(e){return this.includeX(e.min[0],e.max[0]),this.includeY(e.min[1],e.max[1]),this.includeZ(e.min[2],e.max[2]),this},o.prototype.includeX=function(e,t){return this.min[0]=Math.min(this.min[0],e),this.max[0]=Math.max(this.max[0],t),this},o.prototype.includeY=function(e,t){return this.min[1]=Math.min(this.min[1],e),this.max[1]=Math.max(this.max[1],t),this},o.prototype.includeZ=function(e,t){return this.min[2]=Math.min(this.min[2],e),this.max[2]=Math.max(this.max[2],t),this},o.prototype.includeSphere=function(e){var t=e.getCenter(),n=e.getRadius();return this.includeX(t[0]-n,t[0]+n),this.includeY(t[1]-n,t[1]+n),this.includeZ(t[2]-n,t[2]+n),this},o.prototype.translate=function(e){return i.Vector3.add(this.min,this.min,e),i.Vector3.add(this.max,this.max,e),this},o.prototype.getCorners=function(){var e=this.getDiagonal();return[i.Vector3.clone(this.min),i.Vector3.createFloat64FromValues(this.min[0]+e[0],this.min[1],this.min[2]),i.Vector3.createFloat64FromValues(this.min[0],this.min[1]+e[1],this.min[2]),i.Vector3.createFloat64FromValues(this.min[0],this.min[1],this.min[2]+e[2]),i.Vector3.createFloat64FromValues(this.min[0]+e[0],this.min[1]+e[1],this.min[2]),i.Vector3.createFloat64FromValues(this.min[0]+e[0],this.min[1],this.min[2]+e[2]),i.Vector3.createFloat64FromValues(this.min[0],this.min[1]+e[1],this.min[2]+e[2]),i.Vector3.clone(this.max)]},o.prototype.transform=function(e){if(!this.isEmpty()){var t=this.getCorners();this.max[0]=-1/0,this.max[1]=-1/0,this.max[2]=-1/0,this.min[0]=1/0,this.min[1]=1/0,this.min[2]=1/0;for(var n=0;n<t.length;++n)i.Vector3.transformMatrix44(t[n],t[n],e),i.Vector3.max(this.max,this.max,t[n]),i.Vector3.min(this.min,this.min,t[n])}return this},o.prototype.includePointXYZ=function(e){return this.includeX(e.x,e.x),this.includeY(e.y,e.y),this.includeZ(e.z,e.z),this},o.prototype.includePoint=function(e){return this.includeX(e[0],e[0]),this.includeY(e[1],e[1]),this.includeZ(e[2],e[2]),this},o.prototype.getCenter=function(){var e=i.Vector3.createFloat64();return i.Vector3.add(e,this.min,this.max),i.Vector3.scale(e,e,.5),e},o.prototype.getDiagonal=function(){var e=i.Vector3.createFloat64();return i.Vector3.sub(e,this.max,this.min),e},o.prototype.isPointInside=function(e){return!(e[0]<this.min[0]||e[0]>this.max[0]||e[1]<this.min[1]||e[1]>this.max[1]||e[2]<this.min[2]||e[2]>this.max[2])},o.prototype.isPointInsideWithTolerance=function(e,t){return t||(t=r.KERNEL_TOLERANCE),!(e[0]<this.min[0]-t||e[0]>this.max[0]+t||e[1]<this.min[1]-t||e[1]>this.max[1]+t||e[2]<this.min[2]-t||e[2]>this.max[2]+t)},o.prototype.intersects=function(e){return!(e.min[0]>this.max[0]||e.max[0]<this.min[0]||e.min[1]>this.max[1]||e.max[1]<this.min[1]||e.min[2]>this.max[2]||e.max[2]<this.min[2])},o.prototype.intersectsWithTolerance=function(e,t){return t||(t=r.KERNEL_TOLERANCE),!(e.min[0]>this.max[0]+t||e.max[0]<this.min[0]-t||e.min[1]>this.max[1]+t||e.max[1]<this.min[1]-t||e.min[2]>this.max[2]+t||e.max[2]<this.min[2]-t)},o.prototype.isEmpty=function(){return this.max[0]<this.min[0]||this.max[1]<this.min[1]||this.max[2]<this.min[2]},o.prototype.setEmpty=function(){return this.max[0]=-1/0,this.min[0]=1/0,this.max[1]=-1/0,this.min[1]=1/0,this.max[2]=-1/0,this.min[2]=1/0,this},o.prototype.isBounded=function(){return isFinite(this.max[0])&&isFinite(this.max[1])&&isFinite(this.max[2])&&isFinite(this.min[0])&&isFinite(this.min[1])&&isFinite(this.min[2])},t.BoundingBox=o},function(e,t,n){"use strict";var i,r,o=e.exports=n(10),s=n(61);o.codegen=n(99),o.fetch=n(100),o.path=n(101),o.fs=o.inquire("fs"),o.toArray=function(e){if(e){for(var t=Object.keys(e),n=new Array(t.length),i=0;i<t.length;)n[i]=e[t[i++]];return n}return[]},o.toObject=function(e){for(var t={},n=0;n<e.length;){var i=e[n++],r=e[n++];void 0!==r&&(t[i]=r)}return t};var a=/\\/g,c=/"/g;o.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},o.safeProp=function(e){return!/^[$\w_]+$/.test(e)||o.isReserved(e)?'["'+e.replace(a,"\\\\").replace(c,'\\"')+'"]':"."+e},o.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;o.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,(function(e,t){return t.toUpperCase()}))},o.compareFieldsById=function(e,t){return e.id-t.id},o.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(o.decorateRoot.remove(e.$type),e.$type.name=t,o.decorateRoot.add(e.$type)),e.$type;i||(i=n(63));var r=new i(t||e.name);return o.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var l=0;o.decorateEnum=function(e){if(e.$type)return e.$type;r||(r=n(11));var t=new r("Enum"+l++,e);return o.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},Object.defineProperty(o,"decorateRoot",{get:function(){return s.decorated||(s.decorated=new(n(71)))}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Point=void 0;var i=n(1),r=n(43),o=n(4),s=n(0),a=function(e){r.BaseGeometry.call(this),this._position=i.Vector3.createFloat64(),e&&i.Vector3.copy(this._position,e)};(a.prototype=Object.create(r.BaseGeometry.prototype)).getGeometryType=function(){return s.GEOMETRY_TYPES.POINT},a.prototype.clone=function(){var e=new a;return e.copy(this),e},a.prototype.copy=function(e){r.BaseGeometry.prototype.copy.call(this,e),this.copyPosition(e.getPosition())},a.prototype.getPosition=function(){return this._position},a.prototype.copyPosition=function(e){i.Vector3.copy(this._position,e)},a.prototype.setPosition=function(e,t,n){i.Vector3.set(this._position,e,t,n)},a.prototype.getBoundingBox=function(){var e=new o.BoundingBox;return e.includePoint(this.getPosition()),e},a.prototype.transform=function(e){i.Vector3.transformMatrix44(this._position,this._position,e)},a.prototype.toObject=function(){return{position:this.vectorToObject(this._position)}},t.Point=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Line=void 0;var i=n(1),r=n(4),o=n(34),s=n(0),a=n(32),c=n(3),u=n(2),l=function(){a.Curve.call(this),this._position=i.Vector3.createFloat64FromValues(0,0,0),this._direction=i.Vector3.createFloat64FromValues(1,0,0)};(l.prototype=Object.create(a.Curve.prototype)).getGeometryType=function(){return s.GEOMETRY_TYPES.LINE},l.prototype.set=function(e,t){u.ConsoleUtils.assert(i.Vector3.squaredLength(t)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),i.Vector3.copy(this._position,e),i.Vector3.copy(this._direction,t)},l.prototype.clone=function(){var e=new l;return e.copy(this),e},l.prototype.tessellate=function(e,t){var n={positions:[],offsets:[],tolerance:0};n.offsets.push(0);var i=e[0];n.positions.push(this.evaluatePosition(i));for(var r=1;r<e.length;++r){var o=e[r];n.positions.push(this.evaluatePosition(o)),n.offsets.push(n.positions.length-1),i=o}return n},l.prototype.copy=function(e){a.Curve.prototype.copy.call(this,e),i.Vector3.copy(this._position,e._position),i.Vector3.copy(this._direction,e._direction)},l.prototype.getRangeUnlimited=function(){return[-1/0,1/0]},l.prototype.isPeriodicUnlimited=function(){return!1},l.prototype.isClosedUnlimited=function(){return!1},l.prototype.evaluatePosition=function(e){var t=i.Vector3.createFloat64();return i.Vector3.scaleAndAdd(t,this._position,this._direction,e)},l.prototype.evaluateDt=function(e){return i.Vector3.clone(this._direction)},l.prototype.tangentLength=function(e){return i.Vector3.length(this._direction)},l.prototype.getTangentCone=function(e){var t=i.Vector3.createFloat64();return new o.TangentCone(i.Vector3.normalize(t,this.evaluateDt(0)),0)},l.prototype.getArcLength=function(e){return void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited()),isFinite(e[0])&&isFinite(e[1])?(e[1]-e[0])*i.Vector3.length(this._direction):1/0},l.prototype.getParameterFromArcLength=function(e,t){if(void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited()),isFinite(t[0])&&isFinite(t[1])){var n=t[0]+e/i.Vector3.length(this._direction);return(0,c.clamp)(n,t[0],t[1])}return NaN},l.prototype.getBoundingBox=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=new r.BoundingBox;return isFinite(e[0])&&isFinite(e[1])?(t.includePoint(this.evaluatePosition(e[0])),t.includePoint(this.evaluatePosition(e[1]))):(t.includePoint([1/0,1/0,1/0]),t.includePoint([-1/0,-1/0,-1/0])),t},l.prototype.closestToRayParam=function(e,t,n,r){var o=i.Vector3.createFloat64();i.Vector3.sub(o,this._position,e);var s=i.Vector3.squaredLength(this._direction),a=i.Vector3.squaredLength(t),c=i.Vector3.dot(this._direction,t),u=i.Vector3.dot(o,this._direction),l=i.Vector3.dot(o,t),h=s*a-c*c,d=(c*l-a*u)/h,p=(c*u-s*l)/h;if(isFinite(d)&&isFinite(p)){if(n)if(d<n[0]){if(d=n[0],void 0!==r){var g=this.evaluatePosition(n[0]),f=i.Vector3.createFloat64();i.Vector3.sub(f,g,e),p=i.Vector3.dot(f,t)/a}}else if(d>n[1]&&(d=n[1],void 0!==r)){var v=this.evaluatePosition(n[1]);f=i.Vector3.createFloat64(),i.Vector3.sub(f,v,e),p=i.Vector3.dot(f,t)/a}if(void 0!==r){var y=this.evaluatePosition(d),m=i.Vector3.createFloat64();if(i.Vector3.scaleAndAdd(m,e,t,p),i.Vector3.squaredDistance(y,m)>r*r)return}return d}},l.prototype.setFromEndpoints=function(e,t){u.ConsoleUtils.assert(i.Vector3.squaredDistance(e,t)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),this._position=i.Vector3.clone(e),i.Vector3.normalize(this._direction,i.Vector3.sub(this._direction,t,e)),this.unlimitRange()},l.prototype.transform=function(e){i.Vector3.transformMatrix44(this._position,this._position,e),i.Vector3.transformAsDirectionMatrix44(this._direction,this._direction,e)},l.prototype.closestToPointParam=function(e,t){void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited());var n=i.Vector3.createFloat64();i.Vector3.sub(n,e,this._position);var r=this._direction,o=i.Vector3.dot(n,r)/i.Vector3.squaredLength(r);return isFinite(t[0])&&isFinite(t[1])?(0,c.clamp)(o,t[0],t[1]):o},l.prototype.suggestSplittingParam=function(e){},l.prototype.toObject=function(){return{position:this.vectorToObject(this._position),direction:this.vectorToObject(this._direction),range:this.rangeToObject(this.getRange(),this.isLimited())}},t.Line=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=!1,r=!1,o={},s={init3D:function(e){for(var t in i=!0,e)"function"==typeof e[t]&&(s[t]=e[t].bind(e))},setLevel:function(e,t){var n=o[e];return o[e]=t,console.log("Debug of "+e+" set to level "+t),n},level:function(e){if(!i)return 0;var t=o[e];return void 0===t?0:t},setConsoleWarnings:function(e){r=e},warn:function(e){r&&console.warn(e)}};t.DebugUtils=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseTopology=void 0;var i=n(44),r=n(0),o=function(){i.Base.call(this),this._attributes=[]};(o.prototype=Object.create(i.Base.prototype)).getTopologyType=function(){console.warn("BaseTopology.getTopologyType : abstract method invoked!")},o.prototype.getBoundingBox=function(){console.warn("BaseTopology.getBoundingBox : abstract method invoked!")},o.prototype.getBody=function(){console.warn("BaseTopology.getBody : abstract method invoked!")},o.prototype.collectFaces=function(e){return console.warn("BaseTopology.collectFaces : abstract method invoked!"),e||new Set},o.prototype.collectEdges=function(e){return console.warn("BaseTopology.collectEdges : abstract method invoked!"),e||new Set},o.prototype.collectVertices=function(e){return console.warn("BaseTopology.collectVertices : abstract method invoked!"),e||new Set},o.prototype.getAttributes=function(){return this._attributes},o.prototype.addAttribute=function(e){this._attributes?this._attributes.push(e):this._attributes=[e],e.addTopology(this)},o.prototype.removeAttribute=function(e){var t=this._attributes.indexOf(e);return t>-1&&(this._attributes.splice(t,1),e.removeTopology(this),!0)},o.prototype.removeAllAttributes=function(){if(this._attributes)for(var e=0;e<this._attributes.length;e++)this.removeAttribute(this._attributes[e])},o.prototype.isVertex=function(){return this.getTopologyType()===r.TOPOLOGY_TYPES.VERTEX},o.prototype.getFaces=function(){return Array.from(this.collectFaces())},o.prototype.getEdges=function(){return Array.from(this.collectEdges())},o.prototype.getVertices=function(){return Array.from(this.collectVertices())},o.prototype.addAllToModelObject=function(e,t){if(!e.topologies[this.getGuid()]){var n={};n[r.TOPOLOGY_TYPES.toString(this.getTopologyType()).toLowerCase()]=this.toObject(),e.topologies[this.getGuid()]=n}t.forEach((function(t){null!=t&&(Array.isArray(t)?t.forEach((function(t){t.addToModelObject(e)})):t.addToModelObject(e))}))},t.BaseTopology=o},function(e,t,n){"use strict";(function(e){var i=t;function r(e,t,n){for(var i=Object.keys(t),r=0;r<i.length;++r)void 0!==e[i[r]]&&n||(e[i[r]]=t[i[r]]);return e}function o(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&r(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}i.asPromise=n(58),i.base64=n(90),i.EventEmitter=n(91),i.float=n(92),i.inquire=n(59),i.utf8=n(93),i.pool=n(94),i.LongBits=n(95),i.global="undefined"!=typeof window&&window||void 0!==e&&e||"undefined"!=typeof self&&self||this,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isNode=Boolean(i.global.process&&i.global.process.versions&&i.global.process.versions.node),i.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},i.isString=function(e){return"string"==typeof e||e instanceof String},i.isObject=function(e){return e&&"object"==_typeof(e)},i.isset=i.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!=_typeof(n)||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},i.Buffer=function(){try{var e=i.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(e){return"number"==typeof e?i.Buffer?i._Buffer_allocUnsafe(e):new i.Array(e):i.Buffer?i._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},i.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(e){return e?i.LongBits.from(e).toHash():i.LongBits.zeroHash},i.longFromHash=function(e,t){var n=i.LongBits.fromHash(e);return i.Long?i.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},i.merge=r,i.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},i.newError=o,i.ProtocolError=o("ProtocolError"),i.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},i.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var e=i.Buffer;e?(i._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},i._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):i._Buffer_from=i._Buffer_allocUnsafe=null}}).call(this,n(57))},function(e,t,n){"use strict";e.exports=s;var i=n(21);((s.prototype=Object.create(i.prototype)).constructor=s).className="Enum";var r=n(30),o=n(5);function s(e,t,n,r,o){if(i.call(this,e,n),t&&"object"!=_typeof(t))throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=o||{},this.reserved=void 0,t)for(var s=Object.keys(t),a=0;a<s.length;++a)"number"==typeof t[s[a]]&&(this.valuesById[this.values[s[a]]=t[s[a]]]=s[a])}s.fromJSON=function(e,t){var n=new s(e,t.values,t.options,t.comment,t.comments);return n.reserved=t.reserved,n},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},s.prototype.add=function(e,t,n){if(!o.isString(e))throw TypeError("name must be a string");if(!o.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return this.comments[e]=n||null,this},s.prototype.remove=function(e){if(!o.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this},s.prototype.isReservedId=function(e){return r.isReservedId(this.reserved,e)},s.prototype.isReservedName=function(e){return r.isReservedName(this.reserved,e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Surface=void 0;var i=n(1),r=n(43),o=n(0),s=n(3),a=function(){r.BaseGeometry.call(this),this._subrangeU=[],this._subrangeV=[]};(a.prototype=Object.create(r.BaseGeometry.prototype)).copy=function(e){r.BaseGeometry.prototype.copy.call(this,e),this._subrangeU=e.isLimitedU()?[e._subrangeU[0],e._subrangeU[1]]:[],this._subrangeV=e.isLimitedV()?[e._subrangeV[0],e._subrangeV[1]]:[]},a.prototype.isLimitedU=function(){return this._subrangeU.length>0},a.prototype.isLimitedV=function(){return this._subrangeV.length>0},a.prototype.getRangeU=function(){return this.isLimitedU()?this._subrangeU:this.getRangeUnlimitedU()},a.prototype.getRangeV=function(){return this.isLimitedV()?this._subrangeV:this.getRangeUnlimitedV()},a.prototype.getRangeUnlimitedU=function(){console.warn("Surface.getRangeUnlimitedU : abstract method invoked!")},a.prototype.getRangeUnlimitedV=function(){console.warn("Surface.getRangeUnlimitedV : abstract method invoked!")},a.prototype.limitRangeU=function(e){var t=this.getRangeU();this._subrangeU=(0,s.limitRange)(t,e,this.isPeriodicU(),this.getPeriodU())},a.prototype.limitRangeV=function(e){var t=this.getRangeV();this._subrangeV=(0,s.limitRange)(t,e,this.isPeriodicV(),this.getPeriodV())},a.prototype.unlimitRangeU=function(){this._subrangeU=[]},a.prototype.unlimitRangeV=function(){this._subrangeV=[]},a.prototype.isPeriodicU=function(){return this.isPeriodicUnlimitedU()&&!this.isLimitedU()},a.prototype.isPeriodicV=function(){return this.isPeriodicUnlimitedV()&&!this.isLimitedV()},a.prototype.isPeriodicUnlimitedU=function(){console.warn("Surface.isPeriodicUnlimitedU : abstract method invoked!")},a.prototype.isPeriodicUnlimitedV=function(){console.warn("Surface.isPeriodicUnlimitedV : abstract method invoked!")},a.prototype.getPeriodU=function(){return this.isLimitedU()?void 0:this.getPeriodUnlimitedU()},a.prototype.getPeriodV=function(){return this.isLimitedV()?void 0:this.getPeriodUnlimitedV()},a.prototype.getPeriodUnlimitedU=function(){if(this.isPeriodicUnlimitedU()){var e=this.getRangeUnlimitedU();return e[1]-e[0]}},a.prototype.getPeriodUnlimitedV=function(){if(this.isPeriodicUnlimitedV()){var e=this.getRangeUnlimitedV();return e[1]-e[0]}},a.prototype.isClosedU=function(){if(this.isClosedUnlimitedU()){if(this.isLimitedU()){var e=this.getRangeUnlimitedU(),t=e[1]-e[0];return this._subrangeU[1]-this._subrangeU[0]>t-o.PARAMETER_SPACE_TOLERANCE}return!0}return!1},a.prototype.isClosedV=function(){if(this.isClosedUnlimitedV()){if(this.isLimitedV()){var e=this.getRangeUnlimitedV(),t=e[1]-e[0];return this._subrangeV[1]-this._subrangeV[0]>t-o.PARAMETER_SPACE_TOLERANCE}return!0}return!1},a.prototype.isClosedUnlimitedU=function(){console.warn("Surface.isClosedUnlimitedU : abstract method invoked!")},a.prototype.isClosedUnlimitedV=function(){console.warn("Surface.isClosedUnlimitedV : abstract method invoked!")},a.prototype.evaluatePosition=function(e,t){console.warn("Surface.evaluatePosition : abstract method invoked")},a.prototype.evaluateDu=function(e,t){console.warn("Surface.evaluateDu : abstract method invoked")},a.prototype.evaluateDv=function(e,t){console.warn("Surface.evaluateDv : abstract method invoked")},a.prototype.evaluateNormal=function(e,t){var n=this.evaluateDu(e,t);return i.Vector3.cross(n,n,this.evaluateDv(e,t)),i.Vector3.normalize(n,n),n},a.prototype.closestParam=function(e){console.warn("Surface.closestParam : abstract method invoked")},a.prototype.vParamLine=function(e){console.warn("Surface.vParamLine : abstract method invoked, returning undefined")},a.prototype.uParamLine=function(e){console.warn("Surface.uParamLine : abstract method invoked, returning undefined")},a.prototype.getBoundingBox=function(e,t){console.warn("Surface.getBoundingBox : abstract method invoked, returning undefined")},a.prototype.transform=function(e){console.warn("Surface.transform : abstract method invoked")},t.Surface=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Loop=void 0;var i=n(9),r=n(0),o=function(){i.BaseTopology.call(this),this._coedges=[],this._face=void 0};(o.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return r.TOPOLOGY_TYPES.LOOP},o.prototype.getFace=function(){return this._face},o.prototype.setFace=function(e){this._face=e},o.prototype.getCoedges=function(){return this._coedges},o.prototype.setCoedges=function(e){this._coedges=new Array(e.length);for(var t=0;t<e.length;++t)this._coedges[t]=e[t]},o.prototype.addCoedge=function(e){this._coedges?this._coedges.push(e):this._coedges=[e],e.setLoop(this)},o.prototype.addCoedges=function(e){this._coedges||(this._coedges=[]);for(var t=0;t<e.length;++t)e[t].setLoop(this);this._coedges=this._coedges.concat(e)},o.prototype.removeCoedge=function(e){var t=this._coedges.indexOf(e);return t>-1&&(this._coedges.splice(t,1),e.getLoop()===this&&e.setLoop(void 0),!0)},o.prototype.getBody=function(){return this._face?this._face.getBody():void 0},o.prototype.collectFaces=function(e){return e=e||new Set,this._face&&e.add(this._face),e},o.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._coedges.length;++t)this._coedges[t].collectEdges(e);return e},o.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._coedges.length;++t)this._coedges[t].collectVertices(e);return e},o.prototype.toString=function(){return"Loop"},o.prototype.toObject=function(){return{coedges:this.refsToStrings(this._coedges),attributes:this.refsToStrings(this._attributes)}},o.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._coedges,this._attributes])},t.Loop=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Circle=void 0;var i=n(1),r=n(4),o=n(34),s=n(0),a=n(32),c=n(3),u=n(2),l=n(50),h=function(){a.Curve.call(this),this._center=i.Vector3.createFloat64FromValues(0,0,0),this._normal=i.Vector3.createFloat64FromValues(0,0,1),this._xAxis=i.Vector3.createFloat64FromValues(1,0,0),this._yAxis=i.Vector3.createFloat64FromValues(0,1,0),this._radius=1};(h.prototype=Object.create(a.Curve.prototype)).getGeometryType=function(){return s.GEOMETRY_TYPES.CIRCLE},h.prototype.set=function(e,t,n){u.ConsoleUtils.assert(i.Vector3.squaredLength(t)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),u.ConsoleUtils.assert(i.Vector3.squaredLength(n)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),u.ConsoleUtils.assert(i.Vector3.isOrthogonal(t,n,s.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.copy(this._center,e),i.Vector3.normalize(this._normal,t),i.Vector3.normalize(this._xAxis,n),this._radius=i.Vector3.length(n),this._computeYAxis()},h.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._normal,this._xAxis)},h.prototype.clone=function(){var e=new h;return e.copy(this),e},h.prototype.getCenter=function(){return this._center},h.prototype.getNormal=function(){return this._normal},h.prototype.setNormal=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),this._normal!==e&&(i.Vector3.normalize(this._normal,e),i.Vector3.isOrthogonal(this._xAxis,this._normal)||(i.Vector3.computeOrthogonal(this._xAxis,this._normal),i.Vector3.normalize(this._xAxis,this._xAxis)),this._computeYAxis())},h.prototype.getRadius=function(){return this._radius},h.prototype.setRadius=function(e){u.ConsoleUtils.assert(e>s.KERNEL_TOLERANCE),this._radius=e},h.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},h.prototype.setOrigin=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),u.ConsoleUtils.assert(i.Vector3.isOrthogonal(e,this._normal,s.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._xAxis,e),this._computeYAxis()},h.prototype.copy=function(e){a.Curve.prototype.copy.call(this,e),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),this._radius=e._radius,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._normal,e._normal)},h.prototype.getRangeUnlimited=function(){return[-Math.PI,Math.PI]},h.prototype.isPeriodicUnlimited=function(){return!0},h.prototype.isClosedUnlimited=function(){return!0},h.prototype._computeRadiusVector=function(){return i.Vector3.scale(i.Vector3.createFloat64(),this._xAxis,this._radius)},h.prototype.tessellate=function(e,t){t=t||s.TESSELLATION.LINEAR_PRECISION;var n={positions:[],offsets:[],tolerance:0};n.offsets.push(0);for(var i=e[0],r=1;r<e.length;++r){var o=e[r],a=l.CurveTessellator.getCircularArcRenderPoints(this,[i,o],t,1===r,n.positions);n.offsets.push(n.positions.length-1),i=o,n.tolerance=Math.max(n.tolerance,a)}return n},h.prototype.evaluatePosition=function(e){var t=i.Vector3.createFloat64FromValues(0,0,0);return i.Vector3.scaleAndAdd(t,t,this._xAxis,Math.cos(e)*this._radius),i.Vector3.scaleAndAdd(t,t,this._yAxis,Math.sin(e)*this._radius),i.Vector3.add(t,t,this._center),t},h.prototype.evaluateDt=function(e){var t=i.Vector3.createFloat64FromValues(0,0,0);return i.Vector3.scaleAndAdd(t,t,this._xAxis,-Math.sin(e)*this._radius),i.Vector3.scaleAndAdd(t,t,this._yAxis,Math.cos(e)*this._radius),t},h.prototype.evaluateDtt=function(e){var t=i.Vector3.createFloat64FromValues(0,0,0);return i.Vector3.scaleAndAdd(t,t,this._xAxis,-Math.cos(e)*this._radius),i.Vector3.scaleAndAdd(t,t,this._yAxis,-Math.sin(e)*this._radius),t},h.prototype.tangentLength=function(e){return this.getRadius()},h.prototype.getArcLength=function(e){return void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited()),this.getRadius()*(e[1]-e[0])},h.prototype.getParameterFromArcLength=function(e,t){void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited());var n=t[0]+e/this.getRadius();return(0,c.clamp)(n,t[0],t[1])},h.prototype.getBoundingBox=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=(0,c.minMaxCosSinFunc)(this._xAxis[0]*this._radius,this._yAxis[0]*this._radius,this._center[0],e),n=(0,c.minMaxCosSinFunc)(this._xAxis[1]*this._radius,this._yAxis[1]*this._radius,this._center[1],e),i=(0,c.minMaxCosSinFunc)(this._xAxis[2]*this._radius,this._yAxis[2]*this._radius,this._center[2],e),o=new r.BoundingBox;return o.min[0]=t[0],o.max[0]=t[1],o.min[1]=n[0],o.max[1]=n[1],o.min[2]=i[0],o.max[2]=i[1],o},h.prototype.getTangentCone=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=.5*(e[0]+e[1]),n=i.Vector3.createFloat64FromValues(0,0,0);i.Vector3.scaleAndAdd(n,n,this._xAxis,-Math.sin(t)),i.Vector3.scaleAndAdd(n,n,this._yAxis,Math.cos(t));var r=Math.min(Math.PI,.5*(e[1]-e[0]));return new o.TangentCone(n,r)},h.prototype.closestToRayParam=function(e,t,n){var r=i.Vector3.createFloat64();i.Vector3.sub(r,this._center,e);var o=i.Vector3.dot(r,this._normal)/i.Vector3.dot(t,this._normal);if(isFinite(o)){var s=i.Vector3.createFloat64();return i.Vector3.scaleAndAdd(s,e,t,o),this.closestToPointParam(s,n)}},h.prototype.getRadiusAndRangeFromEndpoints=function(e,t,n){var r=i.Vector3.createFloat64();i.Vector3.sub(r,e,this._center);var o=i.Vector3.createFloat64();i.Vector3.sub(o,t,this._center);var a,u=.5*(i.Vector3.length(r)+i.Vector3.length(o)),l=i.Vector3.dot(r,this._xAxis),h=i.Vector3.dot(r,this._yAxis),d=(0,c.normalizeAngle)(Math.atan2(h,l));if(e===t||i.Vector3.squaredDistance(e,t)<s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE)a=d+c.PI2;else{var p=i.Vector3.dot(o,this._xAxis),g=i.Vector3.dot(o,this._yAxis);if((a=(0,c.normalizeAngle)(Math.atan2(g,p)))<d&&(a+=c.PI2),n){var f=a;a=d,d=f-c.PI2}}return{radius:u,range:[d,a]}},h.prototype.closestToPointParam=function(e,t){void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited());var n=i.Vector3.createFloat64();i.Vector3.sub(n,e,this._center);var r,o=i.Vector3.dot(n,this._xAxis),a=i.Vector3.dot(n,this._yAxis);return r=o*o+a*a<s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE?.5*Math.PI:Math.atan2(a,o),r=(0,c.foldNearTo)(r,.5*(t[0]+t[1]),2*Math.PI),(0,c.clamp)(r,t[0],t[1])},h.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._normal,this._normal,e),i.Vector3.scale(this._xAxis,this._xAxis,this._radius),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),this._radius=i.Vector3.length(this._xAxis),i.Vector3.normalize(this._normal,this._normal),i.Vector3.normalize(this._xAxis,this._xAxis),this._computeYAxis()},h.prototype.suggestSplittingParam=function(e){},h.prototype.toObject=function(){var e=this.evaluatePosition(0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this._center),radius:this.vectorToObject(e),normal:this.vectorToObject(this._normal),range:this.rangeToObject(this.getRange(),this.isLimited())}},t.Circle=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Face=void 0;var i=n(1),r=n(9),o=n(0),s=n(8),a=function(e){r.BaseTopology.call(this),this._surface=e,this._reversed=!1,this._loops=[],this._shell=void 0};(a.prototype=Object.create(r.BaseTopology.prototype)).getTopologyType=function(){return o.TOPOLOGY_TYPES.FACE},a.prototype.getSurfaceType=function(){return this._surface?this._surface.getGeometryType():void 0},a.prototype.clone=function(){var e=new a;return e._surface=this._surface?this._surface.clone():void 0,e._reversed=this._reversed,e.setLoops(this._loops),e._shell=this._shell,e._vertexUvData=void 0,e},a.prototype.getSurface=function(){return this._surface},a.prototype.setSurface=function(e){this._surface=e},a.prototype.getShell=function(){return this._shell},a.prototype.setShell=function(e){this._shell=e},a.prototype.getLoops=function(){return this._loops},a.prototype.setLoops=function(e){this._loops=new Array(e.length);for(var t=0;t<e.length;++t)this._loops[t]=e[t]},a.prototype.addLoop=function(e){this._loops?this._loops.push(e):this._loops=[e],e.setFace(this)},a.prototype.addLoops=function(e){this._loops||(this._loops=[]);for(var t=0;t<e.length;++t)e[t].setFace(this);this._loops=this._loops.concat(e)},a.prototype.removeLoop=function(e){var t=this._loops.indexOf(e);return t>-1&&(this._loops.splice(t,1),e.getFace()===this&&e.setFace(void 0),!0)},a.prototype.isReversed=function(){return this._reversed},a.prototype.setReversed=function(e){this._reversed=e},a.prototype.getVertices=function(){return Array.from(this.collectVertices())},a.prototype.evaluatePosition=function(e,t){return this._surface.evaluatePosition(e,t)},a.prototype.evaluateNormal=function(e,t){var n=this._surface.evaluateNormal(e,t);return!0===this.isReversed()&&i.Vector3.negate(n,n),n},a.prototype.getBody=function(){return this._shell?this._shell.getBody():void 0},a.prototype.collectFaces=function(e){return(e=e||new Set).add(this),e},a.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._loops.length;++t)this._loops[t].collectEdges(e);return e},a.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._loops.length;++t)this._loops[t].collectVertices(e);return e},a.prototype.getBoundingBox=function(){var e=this._surface.getRangeU(),t=this._surface.getRangeV();return isFinite(e[0])&&isFinite(e[1])||(s.DebugUtils.warn("Face.getBoundingBox: Surface is unbounded in u."),e=[0,1]),isFinite(t[0])&&isFinite(t[1])||(s.DebugUtils.warn("Face.getBoundingBox: Surface is unbounded in v."),t=[0,1]),this._surface.getBoundingBox(e,t)},a.prototype.closestParam=function(e){return this._surface.closestParam(e)},a.prototype.isPlanarFace=function(){return this.getSurfaceType()===o.GEOMETRY_TYPES.PLANE},a.prototype.toObject=function(){return{loops:this.refsToStrings(this._loops),reversed:this._reversed,geometry:this.refToString(this._surface),attributes:this.refsToStrings(this._attributes)}},a.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._loops,this._surface,this._attributes])},t.Face=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Vertex=void 0;var i=n(9),r=n(0),o=n(2),s=n(78),a=function(e){i.BaseTopology.call(this),this._point=e,this._precision=0,this._edges=[]};(a.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return r.TOPOLOGY_TYPES.VERTEX},a.prototype.getPoint=function(){return this._point},a.prototype.setPoint=function(e){this._point=e},a.prototype.getPrecision=function(){return this._precision},a.prototype.setPrecision=function(e){o.ConsoleUtils.assert(e>=0),this._precision=e},a.prototype.getEdges=function(){return this._edges},a.prototype.isAdjacentEdge=function(e){return-1!==this._edges.indexOf(e)},a.prototype.getOtherEdge=function(e){for(var t=0;t<this._edges.length;t++){var n=this._edges[t];if(n!==e)return n}return null},a.prototype.getOtherEdges=function(e){for(var t=[],n=0;n<this._edges.length;n++){var i=this._edges[n];i!==e&&t.push(i)}return t},a.prototype.getAdjacentVertices=function(){for(var e=[],t=0;t<this._edges.length;t++){var n=this._edges[t].getOtherVertex(this);n!==this&&e.indexOf(n)<0&&e.push(n)}return e},a.prototype.getCommonEdges=function(e){for(var t=[],n=0;n<this._edges.length;n++){var i=this._edges[n],r=i.getStartVertex(),o=i.getEndVertex();(r===this&&o===e||o===this&&r===e)&&t.push(i)}return t},a.prototype.addEdge=function(e){-1===this._edges.indexOf(e)&&this._edges.push(e)},a.prototype.removeEdge=function(e){var t=this._edges.indexOf(e);return t>=0&&(this._edges.splice(t,1),!0)},a.prototype.getPosition=function(){return this._point.getPosition()},a.prototype.getBody=function(){return this._edges.length>0?this._edges[0].getBody():void 0},a.prototype.collectFaces=function(e){e=e||new Set;for(var t=0;t<this._edges.length;++t)this._edges[t].collectFaces(e);return e},a.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._edges.length;++t)e.add(this._edges[t]);return e},a.prototype.collectVertices=function(e){return(e=e||new Set).add(this),e},a.prototype.getBoundingBox=function(){return this._point.getBoundingBox()},a.prototype.toString=function(){return String(this._point.getPosition())},a.prototype.getOrderedFaces=function(){for(var e=[],t=(0,s.getOrderedFacesOnVertex)(this),n=0;n<t.length;n++)t[n].faces.forEach((function(t){e.push(t)}));return e},a.prototype.toObject=function(){return{geometry:this.refToString(this._point),precision:this.getPrecision(),attributes:this.refsToStrings(this._attributes)}},a.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._point,this._attributes])},t.Vertex=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.controlPointsFromHomogeneous=t.controlPointsToHomogeneous=t.getUniqueKnots=t.findKnotSpanAndMultiplicity=t.findKnotSpan=void 0;var i=n(0),r=n(2),o=function(e,t){var n=0,i=t.length-1;if(e<=t[n]){for(;t[n]===t[n+1]&&n<i-1;)n+=1;return n}if(e>=t[i]){for(;t[i]===t[i-1]&&i>n+1;)i-=1;return i-1}for(var r=Math.floor((n+i)/2);e<t[r]||e>=t[r+1];)e<t[r]?i=r:n=r,r=Math.floor((n+i)/2);return r};t.findKnotSpan=o,t.findKnotSpanAndMultiplicity=function(e,t){var n=i.PARAMETER_SPACE_TOLERANCE,r=o(e,t),s=0,a=e,c=r;if(e<t[c]+n)for(a=t[c];c>=0&&Math.abs(t[c]-a)<n;)--c,++s;else if(e>t[c+1]-n){for(a=t[++c];c<t.length&&Math.abs(t[c]-a)<n;)++c,++s;a=c<t.length?t[r=c-1]:t[t.length-1]}return{span:r,multiplicity:s,knot:a}},t.getUniqueKnots=function(e){for(var t=[e[0]],n=1;n<e.length;++n)e[n]!==e[n-1]&&t.push(e[n]);return t},t.controlPointsToHomogeneous=function(e,t){r.ConsoleUtils.assert(e.length>0&&e.length===3*t.length);for(var n=t.length,i=new Array(4*n),o=0;o<n;++o){var s=t[o];i[4*o]=e[3*o]*s,i[4*o+1]=e[3*o+1]*s,i[4*o+2]=e[3*o+2]*s,i[4*o+3]=s}return i},t.controlPointsFromHomogeneous=function(e){r.ConsoleUtils.assert(e.length>0&&e.length%4==0);for(var t=e.length/4,n=new Array(3*t),i=new Array(t),o=0;o<t;++o){var s=e[4*o+3];n[3*o]=e[4*o]/s,n[3*o+1]=e[4*o+1]/s,n[3*o+2]=e[4*o+2]/s,i[o]=s}return{P:n,w:i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Plane=void 0;var i=n(1),r=n(4),o=n(0),s=n(12),a=n(7),c=n(2),u=function(){s.Surface.call(this),this._origin=i.Vector3.createFloat64(),this._normal=i.Vector3.createFloat64(),this._uAxis=i.Vector3.createFloat64(),this._vAxis=i.Vector3.createFloat64()};(u.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.PLANE},u.prototype.clone=function(){var e=new u;return e.copy(this),e},u.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),i.Vector3.copy(this._origin,e._origin),i.Vector3.copy(this._normal,e._normal),i.Vector3.copy(this._uAxis,e._uAxis),i.Vector3.copy(this._vAxis,e._vAxis)},u.prototype._computeVAxis=function(){i.Vector3.cross(this._vAxis,this._normal,this._uAxis)},u.prototype.set=function(e,t,n){i.Vector3.copy(this._origin,e),c.ConsoleUtils.assert(i.Vector3.squaredLength(t)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._normal,t),void 0===n||i.Vector3.squaredLength(n)<o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE?(i.Vector3.computeOrthogonal(this._uAxis,this._normal),i.Vector3.normalize(this._uAxis,this._uAxis)):(c.ConsoleUtils.assert(i.Vector3.isOrthogonal(n,t,o.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.copy(this._uAxis,n)),this._computeVAxis()},u.prototype.getOrigin=function(){return this._origin},u.prototype.setOrigin=function(e){i.Vector3.copy(this._origin,e)},u.prototype.getNormal=function(){return this._normal},u.prototype.setNormal=function(e){c.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._normal,e),(i.Vector3.squaredLength(this._uAxis)<=o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE||!i.Vector3.isOrthogonal(this._uAxis,this._normal,o.KERNEL_ANGULAR_TOLERANCE))&&(i.Vector3.computeOrthogonal(this._uAxis,this._normal),i.Vector3.normalize(this._uAxis,this._uAxis)),this._computeVAxis()},u.prototype.getUAxis=function(){return this._uAxis},u.prototype.setUAxis=function(e){c.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.copy(this._uAxis,e),this._computeVAxis()},u.prototype.evaluatePosition=function(e,t){var n=i.Vector3.clone(this._origin);return i.Vector3.scaleAndAdd(n,n,this._uAxis,e),i.Vector3.scaleAndAdd(n,n,this._vAxis,t),n},u.prototype.evaluateNormal=function(e,t){return i.Vector3.clone(this._normal)},u.prototype.evaluateDu=function(e,t){return i.Vector3.clone(this._uAxis)},u.prototype.evaluateDv=function(e,t){return i.Vector3.clone(this._vAxis)},u.prototype.closestParam=function(e){var t=i.Vector3.createFloat64();return i.Vector3.sub(t,e,this._origin),{u:i.Vector3.dot(t,this._uAxis)/i.Vector3.squaredLength(this._uAxis),v:i.Vector3.dot(t,this._vAxis)/i.Vector3.squaredLength(this._vAxis)}},u.prototype.vParamLine=function(e){var t=new a.Line;return t.set(this.evaluatePosition(e,0),this._vAxis),t},u.prototype.uParamLine=function(e){var t=new a.Line;return t.set(this.evaluatePosition(0,e),this._uAxis),t},u.prototype.getBoundingBox=function(e,t){var n=new r.BoundingBox;return e&&t?(n.includePoint(this.evaluatePosition(e[0],t[0])),n.includePoint(this.evaluatePosition(e[0],t[1])),n.includePoint(this.evaluatePosition(e[1],t[1])),n.includePoint(this.evaluatePosition(e[1],t[0]))):(n.includePoint([-1/0,-1/0,-1/0]),n.includePoint([1/0,1/0,1/0])),n},u.prototype.transform=function(e){i.Vector3.transformMatrix44(this._origin,this._origin,e),i.Vector3.transformAsDirectionMatrix44(this._uAxis,this._uAxis,e),i.Vector3.transformAsDirectionMatrix44(this._vAxis,this._vAxis,e),i.Vector3.transformAsDirectionMatrix44(this._normal,this._normal,e),i.Vector3.normalize(this._normal,this._normal)},u.prototype.getRangeUnlimitedU=function(){return[-1/0,1/0]},u.prototype.getRangeUnlimitedV=function(){return[-1/0,1/0]},u.prototype.isPeriodicUnlimitedU=function(){return!1},u.prototype.isPeriodicUnlimitedV=function(){return!1},u.prototype.isClosedUnlimitedU=function(){return!1},u.prototype.isClosedUnlimitedV=function(){return!1},u.prototype.toObject=function(){return{origin:this.vectorToObject(this._origin),normal:this.vectorToObject(this._normal),uAxis:this.vectorToObject(this._uAxis),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.Plane=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mergeConnectedFaces=t.mergeFaces=t.findConnectedFaces=t.findConnectedEdges=t.mergeCoincidentVertices=t.transformTopology=t.reverseFace=void 0;var i=n(1),r=n(0),o=n(13),s=n(2),a=function(e){e.setReversed(!e.isReversed())},c=function(e,t){var n=!1,i=!0,r=new Set;t&&(void 0!==t.inputFacesOnly&&(n=t.inputFacesOnly),void 0!==t.allowVertexConnections&&(i=t.allowVertexConnections),void 0!==t.barrierEdges&&(r=new Set(t.barrierEdges)));var o=new Set,s=new Set(e);function a(t){s.delete(t),o.add(t),o.forEach((function(t){var a=new Set;i?t.collectVertices().forEach((function(e){e.collectEdges(a)})):(t.collectEdges(a),r.forEach((function(e){a.delete(e)}))),a.forEach((function(t){for(var i=t.getCoedge(),r=i;r;){if(r.getLoop()){var a=r.getLoop().getFace();o.has(a)||n&&!(e.indexOf(a)>=0)||(o.add(a),s.delete(a))}(r=r.getPartner())===i&&(r=void 0)}}))}))}for(var c=[];s.size>0;)o.clear(),a(s.values().next().value),c.push(Array.from(o));return c},u=function(e){if(1!==e.length){var t=new Set;e.forEach((function(e){e.collectEdges(t)}));var n=new Set,i=[];t.forEach((function(t){var r=t.getCoedges(),o=r.map((function(t){return e.indexOf(t.getFace())>=0}));if(2===r.length&&o[0]&&o[1])i.push(t);else for(var s=0;s<r.length;s++)o[s]&&(n.add(r[s]),r[s].resetUVCurve())}));for(var r=[];n.size>0;){for(var a=[],c=n.values().next().value;c;){a.push(c),n.delete(c);var u=c,l=void 0,h=2*c.getEndVertex().getEdges().length;do{if(u=u.getNext(),n.has(u)){l=u;break}u=u.getPartner()}while(u&&u!==c&&--h>0);c=l}s.ConsoleUtils.assert(a[0].getStartVertex()===a[a.length-1].getEndVertex()),r.push(a)}i.forEach((function(e){e.setStartVertex(null),e.setEndVertex(null)}));var d=e[0];d.setLoops([]),r.forEach((function(e){var t=new o.Loop;t.addCoedges(e),d.addLoop(t)}));for(var p=1;p<e.length;p++)e[p].getShell()&&e[p].getShell().removeFace(e[p]);var g=d.getSurface();g.unlimitRangeU(),g.unlimitRangeV()}};t.reverseFace=function(e){e.setReversed(!e.isReversed());for(var t=e.getLoops(),n=0;n<t.length;++n){for(var i=t[n].getCoedges(),r=0;r<i.length;++r)a(i[r]);i.reverse()}},t.transformTopology=function(e,t){Array.isArray(e)||(e=[e]);for(var n=new Set,i=new Set,o=new Set,s=0;s<e.length;++s){var a=e[s],c=a.getTopologyType();a.collectVertices(n),c!==r.TOPOLOGY_TYPES.VERTEX&&a.collectEdges(i),c!==r.TOPOLOGY_TYPES.VERTEX&&c!==r.TOPOLOGY_TYPES.EDGE&&c!==r.TOPOLOGY_TYPES.COEDGE&&c!==r.TOPOLOGY_TYPES.LOOP&&a.collectFaces(o)}n.forEach((function(e){e.getPoint()&&e.getPoint().transform(t)})),i.forEach((function(e){e.getCurve()&&e.getCurve().transform(t)})),o.forEach((function(e){e.getSurface()&&e.getSurface().transform(t)}))},t.mergeCoincidentVertices=function(e){for(var t=r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE,n=[],o=0;o<e.length;++o){var s,a=e[o],c=a.getStartVertex(),u=a.getEndVertex();for(s=0;s<n.length&&!(i.Vector3.squaredDistance(c.getPosition(),n[s].getPosition())<t);++s);if(s===n.length?n.push(c):(n[s].setPrecision(Math.max(n[s].getPrecision(),c.getPrecision())),a.setStartVertex(n[s])),c!==u)for(s=0;s<n.length&&!(i.Vector3.squaredDistance(u.getPosition(),n[s].getPosition())<t);++s);s===n.length?n.push(u):(n[s].setPrecision(Math.max(n[s].getPrecision(),u.getPrecision())),a.setEndVertex(n[s]))}},t.findConnectedEdges=function(e,t){for(var n=t||!1,i=[],r=new Set,o=0;o<e.length;++o){var s=e[o];if(!r.has(s)){for(var a=[],c=[s],u=0;u<c.length;++u){var l=c[u];r.has(l)||n&&!(e.indexOf(l)>=0)||(r.add(l),a.push(l),c=c.concat(l.getStartVertex().getEdges(),l.getEndVertex().getEdges()))}i.push(a)}}return i},t.findConnectedFaces=c,t.mergeFaces=u,t.mergeConnectedFaces=function(e){var t=[];return c(e,{inputFacesOnly:!0,allowVertexConnections:!1}).forEach((function(e){u(e),t.push(e[0])})),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Edge=void 0;var i=n(1),r=n(9),o=n(0),s=n(2),a=function(e){r.BaseTopology.call(this),this._curve=e,this._reversed=!1,this._vertices=[null,null],this._range=[0,0],this._precision=0,this._coedge=void 0,this._wire=void 0,this._tessellationPoints=[]};(a.prototype=Object.create(r.BaseTopology.prototype)).getTopologyType=function(){return o.TOPOLOGY_TYPES.EDGE},a.prototype.getCurveType=function(){return this._curve?this._curve.getGeometryType():void 0},a.prototype.clone=function(){var e=new a;return e._curve=this._curve?this._curve.clone():void 0,e._reversed=this._reversed,e._vertices[0]=this._vertices[0],e._vertices[1]=this._vertices[1],e._range[0]=this._range[0],e._range[1]=this._range[1],e._precision=this._precision,e._coedge=this._coedge,e._wire=this._wire,e._tessellationPoints=[],e},a.prototype.getCurve=function(){return this._curve},a.prototype.setCurve=function(e){this._curve=e},a.prototype.getArcLength=function(){var e=this.getRange();return this.isReversed()&&(e=[-e[1],-e[0]]),this._curve.getArcLength(e)},a.prototype.getVertices=function(){return this._vertices},a.prototype.getVertex=function(e){return s.ConsoleUtils.assert(0===e||1===e),this._vertices[e]},a.prototype.getStartVertex=function(){return this._vertices[0]},a.prototype.getEndVertex=function(){return this._vertices[1]},a.prototype.setCoedge=function(e){this._coedge=e},a.prototype.getCoedge=function(){return this._coedge},a.prototype.getCoedges=function(){for(var e=[],t=this._coedge;t;)e.push(t),(t=t.getPartner())===this._coedge&&(t=void 0);return e},a.prototype.setWire=function(e){this._wire=e},a.prototype.getWire=function(){return this._wire},a.prototype.getRange=function(){return this._range},a.prototype.setRange=function(e){s.ConsoleUtils.assert(2===e.length),this._range[0]=e[0],this._range[1]=e[1]},a.prototype.t0=function(){return this._range[0]},a.prototype.sett0=function(e){this._range[0]=e},a.prototype.t1=function(){return this._range[1]},a.prototype.sett1=function(e){this._range[1]=e},a.prototype.isClosed=function(){return this._curve&&this._vertices[0]&&this._vertices[0]===this._vertices[1]},a.prototype.getOtherVertex=function(e){return s.ConsoleUtils.assert(this._vertices[0]===e||this._vertices[1]===e),this._vertices[0]===e?this._vertices[1]:this._vertices[0]},a.prototype.getCommonVertex=function(e){var t=this.getStartVertex(),n=this.getEndVertex(),i=e.getStartVertex(),r=e.getEndVertex();return t===i||t===r?t:n===i||n===r?n:null},a.prototype.setVertex=function(e,t){s.ConsoleUtils.assert(0===e||1===e),t!==this._vertices[e]&&(this._vertices[e]&&this._vertices[0]!==this._vertices[1]&&this._vertices[e].removeEdge(this),this._vertices[e]=t,t&&this._vertices[e].addEdge(this))},a.prototype.setStartVertex=function(e){this.setVertex(0,e)},a.prototype.setEndVertex=function(e){this.setVertex(1,e)},a.prototype.getCoedgeForFace=function(e){for(var t=this._coedge;t;){if(t.getFace()===e)return t;if((t=t.getPartner())===this._coedge)break}},a.prototype.getOtherFace=function(e){var t=this.getCoedgeForFace(e);s.ConsoleUtils.assert(t);var n=t.getPartner();if(n&&n!==t)return n.getFace()},a.prototype.isReversed=function(){return this._reversed},a.prototype.setReversed=function(e){this._reversed=e},a.prototype.getPrecision=function(){return this._precision},a.prototype.setPrecision=function(e){s.ConsoleUtils.assert(e>=0),this._precision=e},a.prototype.evaluatePosition=function(e){return this.isReversed()&&(e=-e),this._curve.evaluatePosition(e)},a.prototype.evaluateDt=function(e){this.isReversed()&&(e=-e);var t=this._curve.evaluateDt(e);return this.isReversed()&&i.Vector3.negate(t,t),t},a.prototype.evaluateCurvature=function(e,t){return this.isReversed()&&(e=-e),this._curve.evaluateCurvature(e,t)},a.prototype.closestToPointParam=function(e,t){if(this._curve){var n=t||this.getRange();this.isReversed()&&(n=[-n[1],-n[0]]);var i=this._curve.closestToPointParam(e,n);return this.isReversed()?-i:i}},a.prototype.includesPoint=function(e){var t=Math.max(this.getPrecision(),o.KERNEL_TOLERANCE),n=this.closestToPointParam(e),r=this.evaluatePosition(n);return i.Vector3.squaredDistance(r,e)<t*t},a.prototype.distanceToPoint=function(e){var t=this.closestToPointParam(e),n=this.evaluatePosition(t);return i.Vector3.distance(n,e)},a.prototype.tessellate=function(e,t){var n,r;if(!1===this.isReversed())n=e||[this._range[0],this._range[1]];else if(e){n=new Array(e.length);for(var o=0;o<e.length;++o)n[o]=-e[e.length-1-o]}else n=[-this._range[1],-this._range[0]];var s,a=this._curve.tessellate(n,t);if(this._tessellationPoints.length!==a.positions.length)for(this._tessellationPoints=new Array(a.positions.length),o=0;o<a.positions.length;o++)this._tessellationPoints[o]=i.Vector3.createFloat64();if(!1===this.isReversed())for(s=a.offsets,r=0;r<a.positions.length;++r)i.Vector3.copy(this._tessellationPoints[r],a.positions[r]);else{for(r=0;r<a.positions.length;++r)i.Vector3.copy(this._tessellationPoints[r],a.positions[a.positions.length-1-r]);for(s=new Array(a.offsets.length),r=0;r<a.offsets.length;++r)s[r]=a.positions.length-1-a.offsets[a.offsets.length-1-r]}return{positions:this._tessellationPoints,offsets:s,tolerance:a.tolerance}},a.prototype.getBody=function(){return s.ConsoleUtils.assert(void 0===this._coedge||void 0===this._wire),this._coedge?this._coedge.getBody():this._wire?this._wire.getBody():void 0},a.prototype.collectFaces=function(e){e=e||new Set;for(var t=this._coedge;t;)t.collectFaces(e),(t=t.getPartner())===this._coedge&&(t=void 0);return e},a.prototype.collectEdges=function(e){return(e=e||new Set).add(this),e},a.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._vertices.length;++t)this._vertices[t]&&e.add(this._vertices[t]);return e},a.prototype.getBoundingBox=function(){var e=this.getRange();return!0===this.isReversed()&&(e=[-e[1],-e[0]]),this._curve.getBoundingBox(e)},a.prototype.closestToRayParam=function(e,t,n){var i=this.getRange();!0===this.isReversed()&&(i=[-i[1],-i[0]]);var r=this._curve.closestToRayParam(e,t,i,n);return!0===this.isReversed()?-r:r},a.prototype.toString=function(){return o.GEOMETRY_TYPES.toString(this.getCurveType())+" "+String(this.getStartVertex())+" -> "+String(this.getEndVertex())},a.prototype.getLoops=function(){for(var e=this.getCoedges(),t=new Set,n=0;n<e.length;n++)t.add(e[n].getLoop());return Array.from(t)},a.prototype.toObject=function(){return{vertex0:this.refToString(this._vertices[0]),vertex1:this.refToString(this._vertices[1]),precision:this._precision,range:this.rangeToObject(this._range,!0),reversed:this._reversed,geometry:this.refToString(this._curve),attributes:this.refsToStrings(this._attributes)}},a.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._vertices[0],this._vertices[1],this._curve,this._attributes])},t.Edge=a},function(e,t,n){"use strict";e.exports=o,o.className="ReflectionObject";var i,r=n(5);function o(e,t){if(!r.isString(e))throw TypeError("name must be a string");if(t&&!r.isObject(t))throw TypeError("options must be an object");this.options=t,this.name=e,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(o.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),o.prototype.toJSON=function(){throw Error()},o.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof i&&t._handleAdd(this)},o.prototype.onRemove=function(e){var t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},o.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},o.prototype.getOption=function(e){if(this.options)return this.options[e]},o.prototype.setOption=function(e,t,n){return n&&this.options&&void 0!==this.options[e]||((this.options||(this.options={}))[e]=t),this},o.prototype.setOptions=function(e,t){if(e)for(var n=Object.keys(e),i=0;i<n.length;++i)this.setOption(n[i],e[n[i]],t);return this},o.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},o._configure=function(e){i=e}},function(e,t,n){"use strict";e.exports=u;var i=n(21);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";var r,o=n(11),s=n(31),a=n(5),c=/^required|optional|repeated$/;function u(e,t,n,r,o,u,l){if(a.isObject(r)?(l=o,u=r,r=o=void 0):a.isObject(o)&&(l=u,u=o,o=void 0),i.call(this,e,u),!a.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!a.isString(n))throw TypeError("type must be a string");if(void 0!==r&&!c.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==o&&!a.isString(o))throw TypeError("extend must be a string");this.rule=r&&"optional"!==r?r:void 0,this.type=n,this.id=t,this.extend=o||void 0,this.required="required"===r,this.optional=!this.required,this.repeated="repeated"===r,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!a.Long&&void 0!==s.long[n],this.bytes="bytes"===n,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=l}u.fromJSON=function(e,t){return new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)},Object.defineProperty(u.prototype,"packed",{get:function(){return null===this._packed&&(this._packed=!1!==this.getOption("packed")),this._packed}}),u.prototype.setOption=function(e,t,n){return"packed"===e&&(this._packed=null),i.prototype.setOption.call(this,e,t,n)},u.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return a.toObject(["rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=s.defaults[this.type])&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof r?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof o&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(!0!==this.options.packed&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof o)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=a.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;a.base64.test(this.typeDefault)?a.base64.decode(this.typeDefault,e=a.newBuffer(a.base64.length(this.typeDefault)),0):a.utf8.write(this.typeDefault,e=a.newBuffer(a.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=a.emptyObject:this.repeated?this.defaultValue=a.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof r&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.d=function(e,t,n,i){return"function"==typeof t?t=a.decorateType(t).name:t&&"object"==_typeof(t)&&(t=a.decorateEnum(t).name),function(r,o){a.decorateType(r.constructor).add(new u(o,e,t,n,{default:i}))}},u._configure=function(e){r=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ellipse=void 0;var i=n(1),r=n(4),o=n(34),s=n(0),a=n(32),c=n(3),u=n(35),l=n(2),h=n(50),d=function(){a.Curve.call(this),this._center=i.Vector3.createFloat64FromValues(0,0,0),this._normal=i.Vector3.createFloat64FromValues(0,0,1),this._xAxis=i.Vector3.createFloat64FromValues(1,0,0),this._yAxis=i.Vector3.createFloat64FromValues(0,1,0),this._majorRadius=0,this._minorRadius=0,this._tessellationCache=new h.TessellationCache};(d.prototype=Object.create(a.Curve.prototype)).getGeometryType=function(){return s.GEOMETRY_TYPES.ELLIPSE},d.prototype.set=function(e,t,n,r){l.ConsoleUtils.assert(i.Vector3.squaredLength(t)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),l.ConsoleUtils.assert(i.Vector3.squaredLength(n)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),l.ConsoleUtils.assert(i.Vector3.isOrthogonal(t,n,s.KERNEL_ANGULAR_TOLERANCE)),l.ConsoleUtils.assert(r>i.FLOAT64_TOLERANCE&&r<=1,"Invalid radius ratio"),i.Vector3.copy(this._center,e),i.Vector3.normalize(this._normal,t),i.Vector3.normalize(this._xAxis,n),this._majorRadius=i.Vector3.length(n),this._minorRadius=this._majorRadius*r,this._computeYAxis(),this._dirtyTessellation()},d.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._normal,this._xAxis)},d.prototype.getCenter=function(){return this._center},d.prototype.getNormal=function(){return this._normal},d.prototype.setCenter=function(e){i.Vector3.copy(this._center,e),this._dirtyTessellation()},d.prototype.setNormal=function(e){l.ConsoleUtils.assert(i.Vector3.squaredLength(e)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),this._normal!==e&&(i.Vector3.normalize(this._normal,e),i.Vector3.isOrthogonal(this._xAxis,this._normal)||(i.Vector3.computeOrthogonal(this._xAxis,this._normal),i.Vector3.normalize(this._xAxis,this._xAxis)),this._computeYAxis(),this._dirtyTessellation())},d.prototype.setMajorAxis=function(e){l.ConsoleUtils.assert(i.Vector3.squaredLength(e)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),l.ConsoleUtils.assert(i.Vector3.isOrthogonal(e,this._normal,s.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._xAxis,e),this._computeYAxis(),this._dirtyTessellation()},d.prototype.getMajorAxis=function(){return this._xAxis},d.prototype.getMinorAxis=function(){return this._yAxis},d.prototype.clone=function(){var e=new d;return e.copy(this),e},d.prototype.copy=function(e){a.Curve.prototype.copy.call(this,e),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),this._majorRadius=e._majorRadius,this._minorRadius=e._minorRadius,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._normal,e._normal)},d.prototype.getMajorRadius=function(){return this._majorRadius},d.prototype.getMinorRadius=function(){return this._minorRadius},d.prototype.setMajorRadius=function(e){l.ConsoleUtils.assert(e>s.KERNEL_TOLERANCE),this._majorRadius=e,this._dirtyTessellation()},d.prototype.setMinorRadius=function(e){l.ConsoleUtils.assert(e>s.KERNEL_TOLERANCE),this._minorRadius=e,this._dirtyTessellation()},d.prototype.getRangeUnlimited=function(){return[-Math.PI,Math.PI]},d.prototype.isPeriodicUnlimited=function(){return!0},d.prototype.isClosedUnlimited=function(){return!0},d.prototype._dirtyTessellation=function(){this._tessellationCache.setDirty(!0)},d.prototype._evaluateArcLengthIntegrand=function(e){var t=this._majorRadius*Math.sin(e),n=this._minorRadius*Math.cos(e);return Math.sqrt(t*t+n*n)},d.prototype.getArcLength=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());for(var t=e[0],n=0;t<e[1]+s.PARAMETER_SPACE_TOLERANCE;){for(var i=t,r=[this._evaluateArcLengthIntegrand(t)];r.length<5&&t<e[1]+s.PARAMETER_SPACE_TOLERANCE;)t+=.01,r.push(this._evaluateArcLengthIntegrand(t));switch(i=t-i,r.length){case 1:break;case 2:n+=(r[0]+r[1])*i/2;break;case 3:n+=(r[0]+4*r[1]+r[2])*i/6;break;case 4:n+=(r[0]+3*r[1]+3*r[2]+r[3])*i/8;break;default:n+=(7*r[0]+32*r[1]+12*r[2]+32*r[3]+7*r[4])*i/90}(i=t-e[1])>s.PARAMETER_SPACE_TOLERANCE&&(n-=this._evaluateArcLengthIntegrand(e[1])*i)}return n},d.prototype.getParameterFromArcLength=function(e,t){return void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited()),(0,u.invertIntegral1D)(this._evaluateArcLengthIntegrand.bind(this),e,t)},d.prototype.evaluatePosition=function(e){var t=i.Vector3.createFloat64FromValues(0,0,0);return i.Vector3.scaleAndAdd(t,t,this._xAxis,Math.cos(e)*this._majorRadius),i.Vector3.scaleAndAdd(t,t,this._yAxis,Math.sin(e)*this._minorRadius),i.Vector3.add(t,t,this._center),t},d.prototype.evaluateDt=function(e){var t=i.Vector3.createFloat64FromValues(0,0,0);return i.Vector3.scaleAndAdd(t,t,this._xAxis,-Math.sin(e)*this._majorRadius),i.Vector3.scaleAndAdd(t,t,this._yAxis,Math.cos(e)*this._minorRadius),t},d.prototype.evaluateDtt=function(e){var t=i.Vector3.createFloat64FromValues(0,0,0);return i.Vector3.scaleAndAdd(t,t,this._xAxis,-Math.cos(e)*this._majorRadius),i.Vector3.scaleAndAdd(t,t,this._yAxis,-Math.sin(e)*this._minorRadius),t},d.prototype._getFullTessellation=function(e){var t=[-Math.PI,-Math.PI/2,0,Math.PI/2,Math.PI],n=h.CurveTessellator.getAdaptiveRenderPoints(this,e,[-Math.PI,Math.PI],t);return n.didRetessellate=!0,n},d.prototype.tessellate=function(e,t){return t=t||s.TESSELLATION.LINEAR_PRECISION,this._tessellationCache.getTessellation(e,this,t,this._getFullTessellation.bind(this))},d.prototype.getBoundingBox=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=(0,c.minMaxCosSinFunc)(this._xAxis[0]*this._majorRadius,this._yAxis[0]*this._minorRadius,this._center[0],e),n=(0,c.minMaxCosSinFunc)(this._xAxis[1]*this._majorRadius,this._yAxis[1]*this._minorRadius,this._center[1],e),i=(0,c.minMaxCosSinFunc)(this._xAxis[2]*this._majorRadius,this._yAxis[2]*this._minorRadius,this._center[2],e),o=new r.BoundingBox;return o.min[0]=t[0],o.max[0]=t[1],o.min[1]=n[0],o.max[1]=n[1],o.min[2]=i[0],o.max[2]=i[1],o},d.prototype.getTangentCone=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=this.evaluateDt(e[0]);i.Vector3.normalize(t,t);var n=this.evaluateDt(e[1]);i.Vector3.normalize(n,n);var r=i.Vector3.createFloat64(),a=i.Vector3.dot(t,n),u=i.Vector3.dot(i.Vector3.cross(r,t,n),this._normal),l=Math.atan2(u,a);l<0?l+=c.PI2:e[1]-e[0]>c.PI2-s.PARAMETER_SPACE_TOLERANCE&&(l=c.PI2),l*=.5,a=Math.cos(l),u=Math.sin(l);var h=i.Vector3.clone(t);return i.Vector3.scale(h,h,a),i.Vector3.cross(r,this._normal,t),i.Vector3.scaleAndAdd(h,h,r,u),new o.TangentCone(h,l)},d.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._normal,this._normal,e),i.Vector3.scale(this._xAxis,this._xAxis,this._majorRadius),i.Vector3.scale(this._yAxis,this._yAxis,this._minorRadius),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),this._majorRadius=i.Vector3.length(this._xAxis),this._minorRadius=i.Vector3.length(this._yAxis),i.Vector3.normalize(this._normal,this._normal),i.Vector3.normalize(this._xAxis,this._xAxis),this._computeYAxis(),this._dirtyTessellation()},d.prototype.closestToRayParam=function(e,t,n){var r=i.Vector3.createFloat64();i.Vector3.sub(r,this._center,e);var o=i.Vector3.dot(r,this._normal)/i.Vector3.dot(t,this._normal);if(isFinite(o)){var s=i.Vector3.createFloat64();return i.Vector3.scaleAndAdd(s,e,t,o),this.closestToPointParam(s,n)}},d.prototype.isCircular=function(){return Math.abs(this._majorRadius-this._minorRadius)<s.KERNEL_TOLERANCE},d.prototype.closestToPointParam=function(e,t){void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited());var n=i.Vector3.createFloat64();i.Vector3.sub(n,e,this._center);var r=i.Vector3.dot(n,this._xAxis),o=i.Vector3.dot(n,this._yAxis);if(r*r+o*o<s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE){var a=.5*Math.PI;if(((a=(0,c.adjustParameterToPeriodicRange)(a,t,c.PI2))<t[0]||a>t[1])&&(a=(0,c.adjustParameterToPeriodicRange)(.5*-Math.PI,t,c.PI2)),a<t[0]||a>t[1]){var l=this.evaluatePosition(t[0]),h=this.evaluatePosition(t[1]);a=i.Vector3.squaredDistance(this._center,l)<i.Vector3.squaredDistance(this._center,h)?t[0]:t[1]}return a}var d=this._majorRadius,p=this._minorRadius,g=Math.atan2(d*o,p*r),f=this.evaluatePosition(g);i.Vector3.sub(f,f,this._center),r*r+o*o<i.Vector3.squaredLength(f)&&(g=(o<s.KERNEL_TOLERANCE?-1:1)*Math.acos(r/d));var v,y=i.FLOAT64_TOLERANCE,m=function(t){var n=this.evaluatePosition(t),i=this.evaluateDt(t),r=this.evaluateDtt(t),o=[n[0]-e[0],n[1]-e[1],n[2]-e[2]];return{val:2*(o[0]*i[0]+o[1]*i[1]+o[2]*i[2]),deriv:2*(o[0]*r[0]+o[1]*r[1]+o[2]*r[2]+(i[0]*i[0]+i[1]*i[1]+i[2]*i[2]))}},_=(0,u.newtonRaphson1D)(m.bind(this),void 0,g,y,32);(_=(0,c.adjustParameterToPeriodicRange)(_,t,c.PI2))<t[0]||_>t[1]?(_=(0,u.newtonRaphson1D)(m.bind(this),void 0,-_,y,32),v=(_=(0,c.adjustParameterToPeriodicRange)(_,t,c.PI2))<t[0]||_>t[1]?1/0:i.Vector3.squaredDistance(e,this.evaluatePosition(_))):v=i.Vector3.squaredDistance(e,this.evaluatePosition(_));var E=i.Vector3.squaredDistance(e,this.evaluatePosition(t[0])),A=i.Vector3.squaredDistance(e,this.evaluatePosition(t[1]));return E<v&&(v=E,_=t[0]),A<v&&(_=t[1]),_},d.prototype.suggestSplittingParam=function(e){},d.prototype.toObject=function(){var e=this.evaluatePosition(0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this._center),majorRadius:this.vectorToObject(e),normal:this.vectorToObject(this._normal),radiusRatio:this.getMinorRadius()/this.getMajorRadius(),range:this.rangeToObject(this.getRange(),this.isLimited())}},t.Ellipse=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Body=void 0;var i=n(9),r=n(0),o=n(4),s=n(19),a=function(){i.BaseTopology.call(this),this._lumps=[]};(a.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return r.TOPOLOGY_TYPES.BODY},a.prototype.getLumps=function(){return this._lumps},a.prototype.setLumps=function(e){this._lumps=new Array(e.length);for(var t=0;t<e.length;++t)this._lumps[t]=e[t]},a.prototype.addLump=function(e){this._lumps?this._lumps.push(e):this._lumps=[e],e.setBody(this)},a.prototype.addLumps=function(e){this._lumps||(this._lumps=[]);for(var t=0;t<e.length;++t)e[t].setBody(this);this._lumps=this._lumps.concat(e)},a.prototype.removeLump=function(e){var t=this._lumps.indexOf(e);return t>-1&&(this._lumps.splice(t,1),e.getBody()===this&&e.setBody(void 0),!0)},a.prototype.getBody=function(){return this},a.prototype.collectFaces=function(e){e=e||new Set;for(var t=0;t<this._lumps.length;++t)this._lumps[t].collectFaces(e);return e},a.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._lumps.length;++t)this._lumps[t].collectEdges(e);return e},a.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._lumps.length;++t)this._lumps[t].collectVertices(e);return e},a.prototype.getBoundingBox=function(){for(var e=new o.BoundingBox,t=0;t<this._lumps.length;++t)e.include(this._lumps[t].getBoundingBox());return e},a.prototype.transform=function(e){(0,s.transformTopology)(this,e)},a.prototype.toObject=function(){return{lumps:this.refsToStrings(this._lumps),attributes:this.refsToStrings(this._attributes)}},a.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._lumps,this._attributes])},t.Body=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Lump=void 0;var i=n(9),r=n(0),o=n(4),s=function(){i.BaseTopology.call(this),this._shells=[],this._body=void 0};(s.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return r.TOPOLOGY_TYPES.LUMP},s.prototype.getBody=function(){return this._body},s.prototype.setBody=function(e){this._body=e},s.prototype.getShells=function(){return this._shells},s.prototype.setShells=function(e){this._shells=new Array(e.length);for(var t=0;t<e.length;++t)this._shells[t]=e[t]},s.prototype.addShell=function(e){this._shells?this._shells.push(e):this._shells=[e],e.setLump(this)},s.prototype.addShells=function(e){this._shells||(this._shells=[]);for(var t=0;t<e.length;++t)e[t].setLump(this);this._shells=this._shells.concat(e)},s.prototype.removeShell=function(e){var t=this._shells.indexOf(e);return t>-1&&(this._shells.splice(t,1),e.getLump()===this&&e.setLump(void 0),!0)},s.prototype.collectFaces=function(e){e=e||new Set;for(var t=0;t<this._shells.length;++t)this._shells[t].collectFaces(e);return e},s.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._shells.length;++t)this._shells[t].collectEdges(e);return e},s.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._shells.length;++t)this._shells[t].collectVertices(e);return e},s.prototype.getBoundingBox=function(){for(var e=new o.BoundingBox,t=0;t<this._shells.length;++t)e.include(this._shells[t].getBoundingBox());return e},s.prototype.toString=function(){return"Lump"},s.prototype.toObject=function(){return{shells:this.refsToStrings(this._shells),attributes:this.refsToStrings(this._attributes)}},s.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._shells,this._attributes])},t.Lump=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Shell=void 0;var i=n(9),r=n(0),o=n(4),s=function(){i.BaseTopology.call(this),this._faces=[],this._lump=void 0};(s.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return r.TOPOLOGY_TYPES.SHELL},s.prototype.getLump=function(){return this._lump},s.prototype.setLump=function(e){this._lump=e},s.prototype.getFaces=function(){return this._faces},s.prototype.setFaces=function(e){this._faces=new Array(e.length);for(var t=0;t<e.length;++t)this._faces[t]=e[t]},s.prototype.addFace=function(e){this._faces?this._faces.push(e):this._faces=[e],e.setShell(this)},s.prototype.addFaces=function(e){this._faces||(this._faces=[]);for(var t=0;t<e.length;++t)e[t].setShell(this);this._faces=this._faces.concat(e)},s.prototype.removeFace=function(e){var t=this._faces.indexOf(e);return t>-1&&(this._faces.splice(t,1),e.getShell()===this&&e.setShell(void 0),!0)},s.prototype.getBody=function(){return this._lump?this._lump.getBody():void 0},s.prototype.collectFaces=function(e){e=e||new Set;for(var t=0;t<this._faces.length;++t)e.add(this._faces[t]);return e},s.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._faces.length;++t)this._faces[t].collectEdges(e);return e},s.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._faces.length;++t)this._faces[t].collectVertices(e);return e},s.prototype.getBoundingBox=function(){for(var e=new o.BoundingBox,t=0;t<this._faces.length;++t)e.include(this._faces[t].getBoundingBox());return e},s.prototype.toString=function(){return"Shell"},s.prototype.toObject=function(){return{faces:this.refsToStrings(this._faces),attributes:this.refsToStrings(this._attributes)}},s.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._faces,this._attributes])},t.Shell=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Coedge=void 0;var i=n(1),r=n(9),o=n(0),s=n(2),a=n(3),c=n(36),u=function(e){r.BaseTopology.call(this),this._reversed=!1,this._edge=e,this._loop=void 0,this._partner=void 0,this._uvCurve=void 0};(u.prototype=Object.create(r.BaseTopology.prototype)).getTopologyType=function(){return o.TOPOLOGY_TYPES.COEDGE},u.prototype.getEdge=function(){return this._edge},u.prototype.getLoop=function(){return this._loop},u.prototype.getPartner=function(){return this._partner},u.prototype.setEdge=function(e){this._edge=e},u.prototype.setLoop=function(e){this._loop=e},u.prototype.setPartner=function(e){this._partner=e},u.prototype.getStartVertex=function(){return this._reversed?this._edge.getEndVertex():this._edge.getStartVertex()},u.prototype.getEndVertex=function(){return this._reversed?this._edge.getStartVertex():this._edge.getEndVertex()},u.prototype.getFace=function(){return this._loop?this._loop.getFace():void 0},u.prototype.getNext=function(){if(this._loop){var e=this._loop.getCoedges(),t=e.indexOf(this);return s.ConsoleUtils.assert(t>=0),e[(t+1)%e.length]}},u.prototype.getPrevious=function(){if(this._loop){var e=this._loop.getCoedges(),t=e.indexOf(this);return s.ConsoleUtils.assert(t>=0),e[(0,a.modulus)(t-1,e.length)]}},u.prototype.isReversed=function(){return this._reversed},u.prototype.setReversed=function(e){this._reversed=e},u.prototype.getRange=function(){if(this._edge)return this._reversed?[-this._edge.t1(),-this._edge.t0()]:[this._edge.t0(),this._edge.t1()]},u.prototype.t0=function(){if(this._edge)return this._reversed?-this._edge.t1():this._edge.t0()},u.prototype.t1=function(){if(this._edge)return this._reversed?-this._edge.t0():this._edge.t1()},u.prototype.evaluatePosition=function(e){if(this._edge)return this.isReversed()&&(e=-e),this._edge.evaluatePosition(e)},u.prototype.evaluateDt=function(e){if(this._edge){this.isReversed()&&(e=-e);var t=this._edge.evaluateDt(e);return this.isReversed()&&i.Vector3.negate(t,t),t}},u.prototype.evaluateCurvature=function(e,t){if(this._edge)return this.isReversed()&&(e=-e),this._edge.evaluateCurvature(e,t)},u.prototype.evaluateFaceUV=function(e){var t=this.getFace();if(t){var n=this.evaluatePosition(e);return t.closestParam(n)}},u.prototype.evaluateInwardDirection=function(e){var t=this.getFace();if(t){var n=this.evaluateDt(e),r=this.evaluateFaceUV(e),o=t.evaluateNormal(r.u,r.v),s=[0,0,0];return i.Vector3.cross(s,o,n),i.Vector3.normalize(s,s),s}},u.prototype.getBoundingBox=function(){if(this._edge)return this._edge.getBoundingBox()},u.prototype.generateUVCurve=function(e){if(!this._uvCurve&&this._edge){var t=this._edge.getCurve();if(t&&this._loop&&this._loop.getFace()){var n=this._loop.getFace().getSurface();n&&n.getGeometryType()===o.GEOMETRY_TYPES.PLANE&&(e||(e=(0,a.getPlaneTransforms)(n).threeSpaceToUV),e?(this._uvCurve=t.clone(),this._uvCurve.transform(e)):this._uvCurve=t)}}},u.prototype.resetUVCurve=function(){this._uvCurve=void 0},u.prototype.uvAngleSubtended=function(e){var t=this._loop.getFace().getSurface().closestParam(e),n=[t.u,t.v,0];this.generateUVCurve(),s.ConsoleUtils.assert(this._uvCurve);var r=this.getRange(),u=1;this.isReversed()!==this._edge.isReversed()&&(r=[-r[1],-r[0]],u=-1),this._loop&&this._loop.getFace()&&this._loop.getFace().isReversed()&&(u*=-1);var l=!1,h=this._uvCurve.getRange();this._uvCurve.isClosed()&&r[1]-r[0]>=h[1]-h[0]-2*o.PARAMETER_SPACE_TOLERANCE&&(l=!0);var d=this._uvCurve.evaluatePosition(r[0]),p=this._uvCurve.evaluatePosition(r[1]),g=i.Vector3.createFloat64();i.Vector3.sub(g,d,n),i.Vector3.normalize(g,g);var f=i.Vector3.createFloat64();i.Vector3.sub(f,p,n),i.Vector3.normalize(f,f);var v=(0,a.getSignedAngle)(g,f),y=v<0,m=!1,_=!1;switch(this._edge.getCurveType()){case o.GEOMETRY_TYPES.LINE:break;case o.GEOMETRY_TYPES.CIRCLE:_=this._uvCurve.getNormal()[2]>0,m=i.Vector3.distance(n,this._uvCurve.getCenter())<this._uvCurve.getRadius(),l||(m=m&&y!==_);break;case o.GEOMETRY_TYPES.ELLIPSE:_=this._uvCurve.getNormal()[2]>0;var E=i.Vector3.sub([0,0,0],n,this._uvCurve.getCenter()),A=i.Vector3.dot(E,this._uvCurve.getMajorAxis())/this._uvCurve.getMajorRadius(),x=i.Vector3.dot(E,this._uvCurve.getMinorAxis())/this._uvCurve.getMinorRadius();m=A*A+x*x<=1,l||(m=m&&y!==_);break;case o.GEOMETRY_TYPES.BCURVE:this._uvCurve.isPlanarXY()||console.warn("Unsupported non-planar curve for uvAngleSubtended");var C=[n[0],n[1]];m=c.SplineCurveHelper.isPointInsideSplineRegionXYPlanar3D(C,this._uvCurve,r),_=!0;break;default:throw new Error("Unsupported curve type for uvAngleSubtended")}return l?v=m?2*Math.PI*(_?-1:1):0:m&&(v<0?v=2*Math.PI+v:v-=2*Math.PI),v*u},u.prototype.getBody=function(){return this._loop?this._loop.getBody():void 0},u.prototype.collectFaces=function(e){return e=e||new Set,this._loop&&this._loop.collectFaces(e),e},u.prototype.collectEdges=function(e){return e=e||new Set,this._edge&&e.add(this._edge),e},u.prototype.collectVertices=function(e){return e=e||new Set,this._edge&&this._edge.collectVertices(e),e},u.prototype.toString=function(){return"Coedge"},u.prototype.toObject=function(){return{edge:this.refToString(this._edge),partner:this.refToString(this._partner),reversed:this._reversed,attributes:this.refsToStrings(this._attributes)}},u.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._edge,this._attributes])},t.Coedge=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createShellsFromFaces=t.createWiresFromEdges=t.createEdgesFromCurves=t.createEdgeFromCurve=t.createLoopFromPolyline=t.createFaceFromPolyline=t.makeConeOrCylinderVParamLoop=t.createCoedgeOnEdge=t.createLineEdge=t.createLineEdgeBetweenVertices=void 0;var i=n(1),r=n(0),o=n(2),s=n(6),a=n(7),c=n(18),u=n(27),l=n(16),h=n(26),d=n(20),p=n(13),g=n(15),f=n(40),v=n(3),y=n(19),m=function(e,t){var n=e.getPosition(),r=t.getPosition(),o=new a.Line;o.setFromEndpoints(n,r);var s=new d.Edge(o);return s.setRange([0,i.Vector3.distance(n,r)]),s.setStartVertex(e),s.setEndVertex(t),s},_=function(e){var t=new u.Coedge;t.setEdge(e);var n=e.getCoedge();return n?(o.ConsoleUtils.assert(!n.getPartner()),n.setPartner(t),t.setPartner(n),t.setReversed(!n.isReversed())):e.setCoedge(t),t},E=function(e){for(var t=e.length,n=new Array(t),i=0;i<t;++i)n[i]=new l.Vertex(new s.Point(e[i]));var r=new Array(t);for(i=0;i<t;++i){var o=(i+1)%t,a=m(n[i],n[o]);r[i]=_(a)}var c=new p.Loop;return c.addCoedges(r),c},A=function(e){var t=new d.Edge(e),n=e.getRange();n[0]!==-1/0&&n[1]!==1/0?(t.sett0(n[0]),t.sett1(n[1])):(t.sett0(0),t.sett1(1));var i=t.evaluatePosition(t.t0());if(t.setStartVertex(new l.Vertex(new s.Point(i))),e.isClosed())t.setEndVertex(t.getStartVertex());else{var r=t.evaluatePosition(t.t1());t.setEndVertex(new l.Vertex(new s.Point(r)))}return t};t.createLineEdgeBetweenVertices=m,t.createLineEdge=function(e,t){var n=new l.Vertex(new s.Point(e)),i=new l.Vertex(new s.Point(t));return m(n,i)},t.createCoedgeOnEdge=_,t.makeConeOrCylinderVParamLoop=function(e,t){o.ConsoleUtils.assert(e.getGeometryType()===r.GEOMETRY_TYPES.CYLINDER||e.getGeometryType()===r.GEOMETRY_TYPES.CONE||e.getGeometryType()===r.GEOMETRY_TYPES.ELLIPTICAL_CYLINDER||e.getGeometryType()===r.GEOMETRY_TYPES.ELLIPTICAL_CONE),o.ConsoleUtils.assert(e.isPeriodicV());var n,i=new d.Edge,a=e.vParamLine(t);a.getGeometryType()===r.GEOMETRY_TYPES.POINT?n=a:(n=new s.Point(a.evaluatePosition(a.getRange()[0])),i.setCurve(a),i.setRange(a.getRange()));var c=new l.Vertex(n);i.setStartVertex(c),i.setEndVertex(c);var u=new p.Loop;return u.addCoedge(_(i)),u},t.createFaceFromPolyline=function(e){var t=E(e),n=(0,v.definePlaneThroughPoints)(e),i=new c.Plane;i.set(n.origin,n.normal,n.uAxis),i.limitRangeU(n.uRange),i.limitRangeV(n.vRange);var r=new g.Face(i);return r.addLoop(t),r},t.createLoopFromPolyline=E,t.createEdgeFromCurve=A,t.createEdgesFromCurves=function(e){for(var t=[],n=0;n<e.length;++n)t.push(A(e[n]));return(0,y.mergeCoincidentVertices)(t),t},t.createWiresFromEdges=function(e){for(var t=(0,y.findConnectedEdges)(e),n=[],i=0;i<t.length;++i){var r=new f.Wire;r.addEdges(t[i]),n.push(r)}return n},t.createShellsFromFaces=function(e){for(var t=(0,y.findConnectedFaces)(e),n=new Array(t.length),i=0;i<t.length;++i){var r=new h.Shell;r.addFaces(t[i]),n[i]=r}return n}},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"default",(function(){return y})),n.d(t,"VERSION",(function(){return m})),n.d(t,"iteratee",(function(){return A})),n.d(t,"restArguments",(function(){return C})),n.d(t,"each",(function(){return L})),n.d(t,"forEach",(function(){return L})),n.d(t,"map",(function(){return P})),n.d(t,"collect",(function(){return P})),n.d(t,"reduce",(function(){return D})),n.d(t,"foldl",(function(){return D})),n.d(t,"inject",(function(){return D})),n.d(t,"reduceRight",(function(){return I})),n.d(t,"foldr",(function(){return I})),n.d(t,"find",(function(){return N})),n.d(t,"detect",(function(){return N})),n.d(t,"filter",(function(){return k})),n.d(t,"select",(function(){return k})),n.d(t,"reject",(function(){return B})),n.d(t,"every",(function(){return F})),n.d(t,"all",(function(){return F})),n.d(t,"some",(function(){return j})),n.d(t,"any",(function(){return j})),n.d(t,"contains",(function(){return z})),n.d(t,"includes",(function(){return z})),n.d(t,"include",(function(){return z})),n.d(t,"invoke",(function(){return U})),n.d(t,"pluck",(function(){return G})),n.d(t,"where",(function(){return Y})),n.d(t,"findWhere",(function(){return W})),n.d(t,"max",(function(){return H})),n.d(t,"min",(function(){return K})),n.d(t,"shuffle",(function(){return q})),n.d(t,"sample",(function(){return Q})),n.d(t,"sortBy",(function(){return Z})),n.d(t,"groupBy",(function(){return X})),n.d(t,"indexBy",(function(){return $})),n.d(t,"countBy",(function(){return ee})),n.d(t,"toArray",(function(){return ne})),n.d(t,"size",(function(){return ie})),n.d(t,"partition",(function(){return re})),n.d(t,"first",(function(){return oe})),n.d(t,"head",(function(){return oe})),n.d(t,"take",(function(){return oe})),n.d(t,"initial",(function(){return se})),n.d(t,"last",(function(){return ae})),n.d(t,"rest",(function(){return ce})),n.d(t,"tail",(function(){return ce})),n.d(t,"drop",(function(){return ce})),n.d(t,"compact",(function(){return ue})),n.d(t,"flatten",(function(){return he})),n.d(t,"without",(function(){return de})),n.d(t,"uniq",(function(){return pe})),n.d(t,"unique",(function(){return pe})),n.d(t,"union",(function(){return ge})),n.d(t,"intersection",(function(){return fe})),n.d(t,"difference",(function(){return ve})),n.d(t,"unzip",(function(){return ye})),n.d(t,"zip",(function(){return me})),n.d(t,"object",(function(){return _e})),n.d(t,"findIndex",(function(){return Ae})),n.d(t,"findLastIndex",(function(){return xe})),n.d(t,"sortedIndex",(function(){return Ce})),n.d(t,"indexOf",(function(){return be})),n.d(t,"lastIndexOf",(function(){return Me})),n.d(t,"range",(function(){return Te})),n.d(t,"chunk",(function(){return Ve})),n.d(t,"bind",(function(){return Re})),n.d(t,"partial",(function(){return Le})),n.d(t,"bindAll",(function(){return Pe})),n.d(t,"memoize",(function(){return Oe})),n.d(t,"delay",(function(){return De})),n.d(t,"defer",(function(){return Ie})),n.d(t,"throttle",(function(){return Ne})),n.d(t,"debounce",(function(){return ke})),n.d(t,"wrap",(function(){return Be})),n.d(t,"negate",(function(){return Fe})),n.d(t,"compose",(function(){return je})),n.d(t,"after",(function(){return ze})),n.d(t,"before",(function(){return Ue})),n.d(t,"once",(function(){return Ge})),n.d(t,"keys",(function(){return Ke})),n.d(t,"allKeys",(function(){return qe})),n.d(t,"values",(function(){return Qe})),n.d(t,"mapObject",(function(){return Ze})),n.d(t,"pairs",(function(){return Je})),n.d(t,"invert",(function(){return Xe})),n.d(t,"functions",(function(){return $e})),n.d(t,"methods",(function(){return $e})),n.d(t,"extend",(function(){return tt})),n.d(t,"extendOwn",(function(){return nt})),n.d(t,"assign",(function(){return nt})),n.d(t,"findKey",(function(){return it})),n.d(t,"pick",(function(){return ot})),n.d(t,"omit",(function(){return st})),n.d(t,"defaults",(function(){return at})),n.d(t,"create",(function(){return ct})),n.d(t,"clone",(function(){return ut})),n.d(t,"tap",(function(){return lt})),n.d(t,"isMatch",(function(){return ht})),n.d(t,"isEqual",(function(){return dt})),n.d(t,"isEmpty",(function(){return pt})),n.d(t,"isElement",(function(){return gt})),n.d(t,"isArray",(function(){return vt})),n.d(t,"isObject",(function(){return yt})),n.d(t,"isArguments",(function(){return mt})),n.d(t,"isFunction",(function(){return _t})),n.d(t,"isString",(function(){return Et})),n.d(t,"isNumber",(function(){return At})),n.d(t,"isDate",(function(){return xt})),n.d(t,"isRegExp",(function(){return Ct})),n.d(t,"isError",(function(){return wt})),n.d(t,"isSymbol",(function(){return bt})),n.d(t,"isMap",(function(){return Mt})),n.d(t,"isWeakMap",(function(){return Tt})),n.d(t,"isSet",(function(){return Vt})),n.d(t,"isWeakSet",(function(){return St})),n.d(t,"isFinite",(function(){return Lt})),n.d(t,"isNaN",(function(){return Pt})),n.d(t,"isBoolean",(function(){return Ot})),n.d(t,"isNull",(function(){return Dt})),n.d(t,"isUndefined",(function(){return It})),n.d(t,"has",(function(){return Nt})),n.d(t,"identity",(function(){return kt})),n.d(t,"constant",(function(){return Bt})),n.d(t,"noop",(function(){return Ft})),n.d(t,"property",(function(){return jt})),n.d(t,"propertyOf",(function(){return zt})),n.d(t,"matcher",(function(){return Ut})),n.d(t,"matches",(function(){return Ut})),n.d(t,"times",(function(){return Gt})),n.d(t,"random",(function(){return Yt})),n.d(t,"now",(function(){return Wt})),n.d(t,"escape",(function(){return Qt})),n.d(t,"unescape",(function(){return Zt})),n.d(t,"result",(function(){return Jt})),n.d(t,"uniqueId",(function(){return $t})),n.d(t,"templateSettings",(function(){return en})),n.d(t,"template",(function(){return sn})),n.d(t,"chain",(function(){return an})),n.d(t,"mixin",(function(){return un}));var i="object"==("undefined"==typeof self?"undefined":_typeof(self))&&self.self===self&&self||"object"==_typeof(e)&&e.global===e&&e||Function("return this")()||{},r=Array.prototype,o=Object.prototype,s="undefined"!=typeof Symbol?Symbol.prototype:null,a=r.push,c=r.slice,u=o.toString,l=o.hasOwnProperty,h=Array.isArray,d=Object.keys,p=Object.create,g=i.isNaN,f=i.isFinite,v=function(){};function y(e){return e instanceof y?e:this instanceof y?void(this._wrapped=e):new y(e)}var m=y.VERSION="1.10.2";function _(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,i,r){return e.call(t,n,i,r)};case 4:return function(n,i,r,o){return e.call(t,n,i,r,o)}}return function(){return e.apply(t,arguments)}}function E(e,t,n){return null==e?kt:_t(e)?_(e,t,n):yt(e)&&!vt(e)?Ut(e):jt(e)}function A(e,t){return E(e,t,1/0)}function x(e,t,n){return y.iteratee!==A?y.iteratee(e,t):E(e,t,n)}function C(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),i=Array(n),r=0;r<n;r++)i[r]=arguments[r+t];switch(t){case 0:return e.call(this,i);case 1:return e.call(this,arguments[0],i);case 2:return e.call(this,arguments[0],arguments[1],i)}var o=Array(t+1);for(r=0;r<t;r++)o[r]=arguments[r];return o[t]=i,e.apply(this,o)}}function w(e){if(!yt(e))return{};if(p)return p(e);v.prototype=e;var t=new v;return v.prototype=null,t}function b(e){return function(t){return null==t?void 0:t[e]}}function M(e,t){return null!=e&&l.call(e,t)}function T(e,t){for(var n=t.length,i=0;i<n;i++){if(null==e)return;e=e[t[i]]}return n?e:void 0}y.iteratee=A;var V=Math.pow(2,53)-1,S=b("length");function R(e){var t=S(e);return"number"==typeof t&&t>=0&&t<=V}function L(e,t,n){var i,r;if(t=_(t,n),R(e))for(i=0,r=e.length;i<r;i++)t(e[i],i,e);else{var o=Ke(e);for(i=0,r=o.length;i<r;i++)t(e[o[i]],o[i],e)}return e}function P(e,t,n){t=x(t,n);for(var i=!R(e)&&Ke(e),r=(i||e).length,o=Array(r),s=0;s<r;s++){var a=i?i[s]:s;o[s]=t(e[a],a,e)}return o}function O(e){return function(t,n,i,r){var o=arguments.length>=3;return function(t,n,i,r){var o=!R(t)&&Ke(t),s=(o||t).length,a=e>0?0:s-1;for(r||(i=t[o?o[a]:a],a+=e);a>=0&&a<s;a+=e){var c=o?o[a]:a;i=n(i,t[c],c,t)}return i}(t,_(n,r,4),i,o)}}var D=O(1),I=O(-1);function N(e,t,n){var i=(R(e)?Ae:it)(e,t,n);if(void 0!==i&&-1!==i)return e[i]}function k(e,t,n){var i=[];return t=x(t,n),L(e,(function(e,n,r){t(e,n,r)&&i.push(e)})),i}function B(e,t,n){return k(e,Fe(x(t)),n)}function F(e,t,n){t=x(t,n);for(var i=!R(e)&&Ke(e),r=(i||e).length,o=0;o<r;o++){var s=i?i[o]:o;if(!t(e[s],s,e))return!1}return!0}function j(e,t,n){t=x(t,n);for(var i=!R(e)&&Ke(e),r=(i||e).length,o=0;o<r;o++){var s=i?i[o]:o;if(t(e[s],s,e))return!0}return!1}function z(e,t,n,i){return R(e)||(e=Qe(e)),("number"!=typeof n||i)&&(n=0),be(e,t,n)>=0}var U=C((function(e,t,n){var i,r;return _t(t)?r=t:vt(t)&&(i=t.slice(0,-1),t=t[t.length-1]),P(e,(function(e){var o=r;if(!o){if(i&&i.length&&(e=T(e,i)),null==e)return;o=e[t]}return null==o?o:o.apply(e,n)}))}));function G(e,t){return P(e,jt(t))}function Y(e,t){return k(e,Ut(t))}function W(e,t){return N(e,Ut(t))}function H(e,t,n){var i,r,o=-1/0,s=-1/0;if(null==t||"number"==typeof t&&"object"!=_typeof(e[0])&&null!=e)for(var a=0,c=(e=R(e)?e:Qe(e)).length;a<c;a++)null!=(i=e[a])&&i>o&&(o=i);else t=x(t,n),L(e,(function(e,n,i){((r=t(e,n,i))>s||r===-1/0&&o===-1/0)&&(o=e,s=r)}));return o}function K(e,t,n){var i,r,o=1/0,s=1/0;if(null==t||"number"==typeof t&&"object"!=_typeof(e[0])&&null!=e)for(var a=0,c=(e=R(e)?e:Qe(e)).length;a<c;a++)null!=(i=e[a])&&i<o&&(o=i);else t=x(t,n),L(e,(function(e,n,i){((r=t(e,n,i))<s||r===1/0&&o===1/0)&&(o=e,s=r)}));return o}function q(e){return Q(e,1/0)}function Q(e,t,n){if(null==t||n)return R(e)||(e=Qe(e)),e[Yt(e.length-1)];var i=R(e)?ut(e):Qe(e),r=S(i);t=Math.max(Math.min(t,r),0);for(var o=r-1,s=0;s<t;s++){var a=Yt(s,o),c=i[s];i[s]=i[a],i[a]=c}return i.slice(0,t)}function Z(e,t,n){var i=0;return t=x(t,n),G(P(e,(function(e,n,r){return{value:e,index:i++,criteria:t(e,n,r)}})).sort((function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return e.index-t.index})),"value")}function J(e,t){return function(n,i,r){var o=t?[[],[]]:{};return i=x(i,r),L(n,(function(t,r){var s=i(t,r,n);e(o,t,s)})),o}}var X=J((function(e,t,n){M(e,n)?e[n].push(t):e[n]=[t]})),$=J((function(e,t,n){e[n]=t})),ee=J((function(e,t,n){M(e,n)?e[n]++:e[n]=1})),te=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function ne(e){return e?vt(e)?c.call(e):Et(e)?e.match(te):R(e)?P(e,kt):Qe(e):[]}function ie(e){return null==e?0:R(e)?e.length:Ke(e).length}var re=J((function(e,t,n){e[n?0:1].push(t)}),!0);function oe(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[0]:se(e,e.length-t)}function se(e,t,n){return c.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))}function ae(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[e.length-1]:ce(e,Math.max(0,e.length-t))}function ce(e,t,n){return c.call(e,null==t||n?1:t)}function ue(e){return k(e,Boolean)}function le(e,t,n,i){for(var r=(i=i||[]).length,o=0,s=S(e);o<s;o++){var a=e[o];if(R(a)&&(vt(a)||mt(a)))if(t)for(var c=0,u=a.length;c<u;)i[r++]=a[c++];else le(a,t,n,i),r=i.length;else n||(i[r++]=a)}return i}function he(e,t){return le(e,t,!1)}var de=C((function(e,t){return ve(e,t)}));function pe(e,t,n,i){Ot(t)||(i=n,n=t,t=!1),null!=n&&(n=x(n,i));for(var r=[],o=[],s=0,a=S(e);s<a;s++){var c=e[s],u=n?n(c,s,e):c;t&&!n?(s&&o===u||r.push(c),o=u):n?z(o,u)||(o.push(u),r.push(c)):z(r,c)||r.push(c)}return r}var ge=C((function(e){return pe(le(e,!0,!0))}));function fe(e){for(var t=[],n=arguments.length,i=0,r=S(e);i<r;i++){var o=e[i];if(!z(t,o)){var s;for(s=1;s<n&&z(arguments[s],o);s++);s===n&&t.push(o)}}return t}var ve=C((function(e,t){return t=le(t,!0,!0),k(e,(function(e){return!z(t,e)}))}));function ye(e){for(var t=e&&H(e,S).length||0,n=Array(t),i=0;i<t;i++)n[i]=G(e,i);return n}var me=C(ye);function _e(e,t){for(var n={},i=0,r=S(e);i<r;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n}function Ee(e){return function(t,n,i){n=x(n,i);for(var r=S(t),o=e>0?0:r-1;o>=0&&o<r;o+=e)if(n(t[o],o,t))return o;return-1}}var Ae=Ee(1),xe=Ee(-1);function Ce(e,t,n,i){for(var r=(n=x(n,i,1))(t),o=0,s=S(e);o<s;){var a=Math.floor((o+s)/2);n(e[a])<r?o=a+1:s=a}return o}function we(e,t,n){return function(i,r,o){var s=0,a=S(i);if("number"==typeof o)e>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(n&&o&&a)return i[o=n(i,r)]===r?o:-1;if(r!=r)return(o=t(c.call(i,s,a),Pt))>=0?o+s:-1;for(o=e>0?s:a-1;o>=0&&o<a;o+=e)if(i[o]===r)return o;return-1}}var be=we(1,Ae,Ce),Me=we(-1,xe);function Te(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var i=Math.max(Math.ceil((t-e)/n),0),r=Array(i),o=0;o<i;o++,e+=n)r[o]=e;return r}function Ve(e,t){if(null==t||t<1)return[];for(var n=[],i=0,r=e.length;i<r;)n.push(c.call(e,i,i+=t));return n}function Se(e,t,n,i,r){if(!(i instanceof t))return e.apply(n,r);var o=w(e.prototype),s=e.apply(o,r);return yt(s)?s:o}var Re=C((function(e,t,n){if(!_t(e))throw new TypeError("Bind must be called on a function");var i=C((function(r){return Se(e,i,t,this,n.concat(r))}));return i})),Le=C((function(e,t){var n=Le.placeholder;return function i(){for(var r=0,o=t.length,s=Array(o),a=0;a<o;a++)s[a]=t[a]===n?arguments[r++]:t[a];for(;r<arguments.length;)s.push(arguments[r++]);return Se(e,i,this,this,s)}}));Le.placeholder=y;var Pe=C((function(e,t){var n=(t=le(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var i=t[n];e[i]=Re(e[i],e)}}));function Oe(e,t){var n=function n(i){var r=n.cache,o=""+(t?t.apply(this,arguments):i);return M(r,o)||(r[o]=e.apply(this,arguments)),r[o]};return n.cache={},n}var De=C((function(e,t,n){return setTimeout((function(){return e.apply(null,n)}),t)})),Ie=Le(De,y,1);function Ne(e,t,n){var i,r,o,s,a=0;n||(n={});var c=function(){a=!1===n.leading?0:Wt(),i=null,s=e.apply(r,o),i||(r=o=null)},u=function(){var u=Wt();a||!1!==n.leading||(a=u);var l=t-(u-a);return r=this,o=arguments,l<=0||l>t?(i&&(clearTimeout(i),i=null),a=u,s=e.apply(r,o),i||(r=o=null)):i||!1===n.trailing||(i=setTimeout(c,l)),s};return u.cancel=function(){clearTimeout(i),a=0,i=r=o=null},u}function ke(e,t,n){var i,r,o=function(t,n){i=null,n&&(r=e.apply(t,n))},s=C((function(s){if(i&&clearTimeout(i),n){var a=!i;i=setTimeout(o,t),a&&(r=e.apply(this,s))}else i=De(o,t,this,s);return r}));return s.cancel=function(){clearTimeout(i),i=null},s}function Be(e,t){return Le(t,e)}function Fe(e){return function(){return!e.apply(this,arguments)}}function je(){var e=arguments,t=e.length-1;return function(){for(var n=t,i=e[t].apply(this,arguments);n--;)i=e[n].call(this,i);return i}}function ze(e,t){return function(){if(--e<1)return t.apply(this,arguments)}}function Ue(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}}var Ge=Le(Ue,2),Ye=!{toString:null}.propertyIsEnumerable("toString"),We=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function He(e,t){var n=We.length,i=e.constructor,r=_t(i)&&i.prototype||o,s="constructor";for(M(e,s)&&!z(t,s)&&t.push(s);n--;)(s=We[n])in e&&e[s]!==r[s]&&!z(t,s)&&t.push(s)}function Ke(e){if(!yt(e))return[];if(d)return d(e);var t=[];for(var n in e)M(e,n)&&t.push(n);return Ye&&He(e,t),t}function qe(e){if(!yt(e))return[];var t=[];for(var n in e)t.push(n);return Ye&&He(e,t),t}function Qe(e){for(var t=Ke(e),n=t.length,i=Array(n),r=0;r<n;r++)i[r]=e[t[r]];return i}function Ze(e,t,n){t=x(t,n);for(var i=Ke(e),r=i.length,o={},s=0;s<r;s++){var a=i[s];o[a]=t(e[a],a,e)}return o}function Je(e){for(var t=Ke(e),n=t.length,i=Array(n),r=0;r<n;r++)i[r]=[t[r],e[t[r]]];return i}function Xe(e){for(var t={},n=Ke(e),i=0,r=n.length;i<r;i++)t[e[n[i]]]=n[i];return t}function $e(e){var t=[];for(var n in e)_t(e[n])&&t.push(n);return t.sort()}function et(e,t){return function(n){var i=arguments.length;if(t&&(n=Object(n)),i<2||null==n)return n;for(var r=1;r<i;r++)for(var o=arguments[r],s=e(o),a=s.length,c=0;c<a;c++){var u=s[c];t&&void 0!==n[u]||(n[u]=o[u])}return n}}var tt=et(qe),nt=et(Ke);function it(e,t,n){t=x(t,n);for(var i,r=Ke(e),o=0,s=r.length;o<s;o++)if(t(e[i=r[o]],i,e))return i}function rt(e,t,n){return t in n}var ot=C((function(e,t){var n={},i=t[0];if(null==e)return n;_t(i)?(t.length>1&&(i=_(i,t[1])),t=qe(e)):(i=rt,t=le(t,!1,!1),e=Object(e));for(var r=0,o=t.length;r<o;r++){var s=t[r],a=e[s];i(a,s,e)&&(n[s]=a)}return n})),st=C((function(e,t){var n,i=t[0];return _t(i)?(i=Fe(i),t.length>1&&(n=t[1])):(t=P(le(t,!1,!1),String),i=function(e,n){return!z(t,n)}),ot(e,i,n)})),at=et(qe,!0);function ct(e,t){var n=w(e);return t&&nt(n,t),n}function ut(e){return yt(e)?vt(e)?e.slice():tt({},e):e}function lt(e,t){return t(e),e}function ht(e,t){var n=Ke(t),i=n.length;if(null==e)return!i;for(var r=Object(e),o=0;o<i;o++){var s=n[o];if(t[s]!==r[s]||!(s in r))return!1}return!0}function dt(e,t){return function e(t,n,i,r){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return!1;if(t!=t)return n!=n;var o=_typeof(t);return("function"===o||"object"===o||"object"==_typeof(n))&&function(t,n,i,r){t instanceof y&&(t=t._wrapped),n instanceof y&&(n=n._wrapped);var o=u.call(t);if(o!==u.call(n))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+n;case"[object Number]":return+t!=+t?+n!=+n:0==+t?1/+t==1/n:+t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object Symbol]":return s.valueOf.call(t)===s.valueOf.call(n)}var a="[object Array]"===o;if(!a){if("object"!=_typeof(t)||"object"!=_typeof(n))return!1;var c=t.constructor,l=n.constructor;if(c!==l&&!(_t(c)&&c instanceof c&&_t(l)&&l instanceof l)&&"constructor"in t&&"constructor"in n)return!1}r=r||[];for(var h=(i=i||[]).length;h--;)if(i[h]===t)return r[h]===n;if(i.push(t),r.push(n),a){if((h=t.length)!==n.length)return!1;for(;h--;)if(!e(t[h],n[h],i,r))return!1}else{var d,p=Ke(t);if(h=p.length,Ke(n).length!==h)return!1;for(;h--;)if(!M(n,d=p[h])||!e(t[d],n[d],i,r))return!1}return i.pop(),r.pop(),!0}(t,n,i,r)}(e,t)}function pt(e){return null==e||(R(e)&&(vt(e)||Et(e)||mt(e))?0===e.length:0===Ke(e).length)}function gt(e){return!(!e||1!==e.nodeType)}function ft(e){return function(t){return u.call(t)==="[object "+e+"]"}}var vt=h||ft("Array");function yt(e){var t=_typeof(e);return"function"===t||"object"===t&&!!e}var mt=ft("Arguments"),_t=ft("Function"),Et=ft("String"),At=ft("Number"),xt=ft("Date"),Ct=ft("RegExp"),wt=ft("Error"),bt=ft("Symbol"),Mt=ft("Map"),Tt=ft("WeakMap"),Vt=ft("Set"),St=ft("WeakSet");!function(){mt(arguments)||(mt=function(e){return M(e,"callee")})}();var Rt=i.document&&i.document.childNodes;function Lt(e){return!bt(e)&&f(e)&&!g(parseFloat(e))}function Pt(e){return At(e)&&g(e)}function Ot(e){return!0===e||!1===e||"[object Boolean]"===u.call(e)}function Dt(e){return null===e}function It(e){return void 0===e}function Nt(e,t){if(!vt(t))return M(e,t);for(var n=t.length,i=0;i<n;i++){var r=t[i];if(null==e||!l.call(e,r))return!1;e=e[r]}return!!n}function kt(e){return e}function Bt(e){return function(){return e}}function Ft(){}function jt(e){return vt(e)?function(t){return T(t,e)}:b(e)}function zt(e){return null==e?function(){}:function(t){return vt(t)?T(e,t):e[t]}}function Ut(e){return e=nt({},e),function(t){return ht(t,e)}}function Gt(e,t,n){var i=Array(Math.max(0,e));t=_(t,n,1);for(var r=0;r<e;r++)i[r]=t(r);return i}function Yt(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))}"object"!=("undefined"==typeof Int8Array?"undefined":_typeof(Int8Array))&&"function"!=typeof Rt&&(_t=function(e){return"function"==typeof e||!1});var Wt=Date.now||function(){return(new Date).getTime()},Ht={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Kt=Xe(Ht);function qt(e){var t=function(t){return e[t]},n="(?:"+Ke(e).join("|")+")",i=RegExp(n),r=RegExp(n,"g");return function(e){return e=null==e?"":""+e,i.test(e)?e.replace(r,t):e}}var Qt=qt(Ht),Zt=qt(Kt);function Jt(e,t,n){vt(t)||(t=[t]);var i=t.length;if(!i)return _t(n)?n.call(e):n;for(var r=0;r<i;r++){var o=null==e?void 0:e[t[r]];void 0===o&&(o=n,r=i),e=_t(o)?o.call(e):o}return e}var Xt=0;function $t(e){var t=++Xt+"";return e?e+t:t}var en=y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},tn=/(.)^/,nn={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},rn=/\\|'|\r|\n|\u2028|\u2029/g,on=function(e){return"\\"+nn[e]};function sn(e,t,n){!t&&n&&(t=n),t=at({},t,y.templateSettings);var i,r=RegExp([(t.escape||tn).source,(t.interpolate||tn).source,(t.evaluate||tn).source].join("|")+"|$","g"),o=0,s="__p+='";e.replace(r,(function(t,n,i,r,a){return s+=e.slice(o,a).replace(rn,on),o=a+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":i?s+="'+\n((__t=("+i+"))==null?'':__t)+\n'":r&&(s+="';\n"+r+"\n__p+='"),t})),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{i=new Function(t.variable||"obj","_",s)}catch(e){throw e.source=s,e}var a=function(e){return i.call(this,e,y)},c=t.variable||"obj";return a.source="function("+c+"){\n"+s+"}",a}function an(e){var t=y(e);return t._chain=!0,t}function cn(e,t){return e._chain?y(t).chain():t}function un(e){return L($e(e),(function(t){var n=y[t]=e[t];y.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),cn(this,n.apply(y,e))}})),y}L(["pop","push","reverse","shift","sort","splice","unshift"],(function(e){var t=r[e];y.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],cn(this,n)}})),L(["concat","join","slice"],(function(e){var t=r[e];y.prototype[e]=function(){return cn(this,t.apply(this._wrapped,arguments))}})),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return String(this._wrapped)}}.call(this,n(57))},function(e,t,n){"use strict";e.exports=l;var i=n(21);((l.prototype=Object.create(i.prototype)).constructor=l).className="Namespace";var r,o,s,a=n(22),c=n(5);function u(e,t){if(e&&e.length){for(var n={},i=0;i<e.length;++i)n[e[i].name]=e[i].toJSON(t);return n}}function l(e,t){i.call(this,e,t),this.nested=void 0,this._nestedArray=null}function h(e){return e._nestedArray=null,e}l.fromJSON=function(e,t){return new l(e,t.options).addJSON(t.nested)},l.arrayToJSON=u,l.isReservedId=function(e,t){if(e)for(var n=0;n<e.length;++n)if("string"!=typeof e[n]&&e[n][0]<=t&&e[n][1]>=t)return!0;return!1},l.isReservedName=function(e,t){if(e)for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1},Object.defineProperty(l.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=c.toArray(this.nested))}}),l.prototype.toJSON=function(e){return c.toObject(["options",this.options,"nested",u(this.nestedArray,e)])},l.prototype.addJSON=function(e){if(e)for(var t,n=Object.keys(e),i=0;i<n.length;++i)t=e[n[i]],this.add((void 0!==t.fields?r.fromJSON:void 0!==t.values?s.fromJSON:void 0!==t.methods?o.fromJSON:void 0!==t.id?a.fromJSON:l.fromJSON)(n[i],t));return this},l.prototype.get=function(e){return this.nested&&this.nested[e]||null},l.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},l.prototype.add=function(e){if(!(e instanceof a&&void 0!==e.extend||e instanceof r||e instanceof s||e instanceof o||e instanceof l))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(!(t instanceof l&&e instanceof l)||t instanceof r||t instanceof o)throw Error("duplicate name '"+e.name+"' in "+this);for(var n=t.nestedArray,i=0;i<n.length;++i)e.add(n[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}}else this.nested={};return this.nested[e.name]=e,e.onAdd(this),h(this)},l.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),h(this)},l.prototype.define=function(e,t){if(c.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var n=this;e.length>0;){var i=e.shift();if(n.nested&&n.nested[i]){if(!((n=n.nested[i])instanceof l))throw Error("path conflicts with non-namespace objects")}else n.add(n=new l(i))}return t&&n.addJSON(t),n},l.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof l?e[t++].resolveAll():e[t++].resolve();return this.resolve()},l.prototype.lookup=function(e,t,n){if("boolean"==typeof t?(n=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),c.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;if(""===e[0])return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(1===e.length){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof l&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var r=0;r<this.nestedArray.length;++r)if(this._nestedArray[r]instanceof l&&(i=this._nestedArray[r].lookup(e,t,!0)))return i;return null===this.parent||n?null:this.parent.lookup(e,t)},l.prototype.lookupType=function(e){var t=this.lookup(e,[r]);if(!t)throw Error("no such type: "+e);return t},l.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},l.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[r,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},l.prototype.lookupService=function(e){var t=this.lookup(e,[o]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},l._configure=function(e,t,n){r=e,o=t,s=n}},function(e,t,n){"use strict";var i=t,r=n(5),o=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function s(e,t){var n=0,i={};for(t|=0;n<e.length;)i[o[n+t]]=e[n++];return i}i.basic=s([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),i.defaults=s([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",r.emptyArray,null]),i.long=s([0,0,0,1,1],7),i.mapKey=s([0,0,0,5,5,0,0,0,1,1,0,2],2),i.packed=s([1,5,0,0,0,5,5,0,0,0,1,1,0])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Curve=void 0;var i=n(1),r=n(43),o=n(0),s=n(3),a=n(2),c=function(){r.BaseGeometry.call(this),this._subrange=[]};(c.prototype=Object.create(r.BaseGeometry.prototype)).copy=function(e){r.BaseGeometry.prototype.copy.call(this,e),this._subrange=e.isLimited()?[e._subrange[0],e._subrange[1]]:[]},c.prototype.isLimited=function(){return this._subrange.length>0},c.prototype.getRange=function(){return this.isLimited()?this._subrange:this.getRangeUnlimited()},c.prototype.getRangeUnlimited=function(){console.warn("Curve.getRangeUnlimited : abstract method invoked!")},c.prototype.limitRange=function(e){this._subrange=(0,s.limitRange)(this.getRange(),e,this.isPeriodic(),this.getPeriod())},c.prototype.unlimitRange=function(){this._subrange=[]},c.prototype.isPeriodic=function(){return this.isPeriodicUnlimited()&&!this.isLimited()},c.prototype.isPeriodicUnlimited=function(){console.warn("Curve.isPeriodicUnlimited : abstract method invoked!")},c.prototype.getPeriod=function(){return this.isLimited()?void 0:this.getPeriodUnlimited()},c.prototype.getPeriodUnlimited=function(){if(this.isPeriodicUnlimited()){var e=this.getRangeUnlimited();return e[1]-e[0]}},c.prototype.isClosed=function(){if(this.isClosedUnlimited()){if(this.isLimited()){var e=this.getRangeUnlimited(),t=e[1]-e[0];return this._subrange[1]-this._subrange[0]>t-o.PARAMETER_SPACE_TOLERANCE}return!0}return!1},c.prototype.isClosedUnlimited=function(){console.warn("Curve.isClosedUnlimited : abstract method invoked!")},c.prototype._restrictRangeToUnlimited=function(e){a.ConsoleUtils.assert(2===e.length),a.ConsoleUtils.assert(e[0]<=e[1]);var t=this.getRangeUnlimited(),n=[];if(this.isPeriodicUnlimited()){var r=t[1]-t[0];if(e[1]-e[0]>r-o.PARAMETER_SPACE_TOLERANCE)n.push([t[0],t[1]]);else{var c=(0,s.foldAbove)(e[0],t[0],r)-e[0];n.push([e[0]+c,e[1]+c]),n[0][1]>t[1]+o.PARAMETER_SPACE_TOLERANCE&&(n.push([t[0],n[0][1]-r]),n[0][1]=t[1])}}else{var u=Math.max(e[0],t[0]),l=Math.min(e[1],t[1]);u>t[1]?u<t[1]+i.FLOAT64_TOLERANCE&&n.push([t[1],t[1]]):l<t[0]?l>t[0]-i.FLOAT64_TOLERANCE&&n.push([t[0],t[0]]):n.push([u,l])}return n},c.prototype.transform=function(e){console.warn("Curve.transform : abstract method invoked! Doing nothing.")},c.prototype.evaluatePosition=function(e){console.warn("Curve.evaluatePosition : abstract method invoked! Returning undefined.")},c.prototype.evaluateDt=function(e){console.warn("Curve.evaluateDt : abstract method invoked! Returning undefined.")},c.prototype.evaluateCurvature=function(e,t){var n=this.evaluateDt(e),r=this.evaluateDt(e+o.KERNEL_TOLERANCE);i.Vector3.sub(r,r,n);var s=i.Vector3.createFloat64();i.Vector3.scale(s,r,1/o.KERNEL_TOLERANCE),t&&(i.Vector3.copy(t,s),i.Vector3.normalize(t,t));var a=i.Vector3.squaredLength(n);return i.Vector3.cross(s,n,s),i.Vector3.length(s)/Math.pow(a,1.5)},c.prototype.tangentLength=function(e){return i.Vector3.length(this.evaluateDt(e))},c.prototype.suggestSplittingParam=function(e){console.warn("Curve.suggestSplittingParam : abstract method invoked! Returning undefined.")},c.prototype.getTangentCone=function(e){console.warn("Curve.getTangentCone : abstract method invoked! Returning undefined.")},c.prototype.closestToRayParam=function(e,t,n){console.warn("Curve.closestToRayParam : abstract method invoked! Returning undefined.")},c.prototype.closestToPointParam=function(e,t){console.warn("Curve.closestToPointParam : abstract method invoked! Returning undefined.")},c.prototype.getArcLength=function(e){console.warn("Curve.getArcLength : abstract method invoked!")},c.prototype.getParameterFromArcLength=function(e,t){console.warn("Curve.getParameterFromArcLength : abstract method invoked!")},c.prototype.getBoundingBox=function(e){console.warn("Curve.getBoundingBox : abstract method invoked! Returning undefined.")},c.prototype.tessellate=function(e,t){console.warn("Curve.tessellate : abstract method invoked! Returning undefined.")},t.Curve=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BCurve=void 0;var i=n(1),r=n(4),o=n(34),s=n(0),a=n(32),c=n(7),u=n(3),l=n(35),h=n(2),d=n(8),p=n(50),g=n(36),f=n(17),v=n(37),y=n(102),m=n(73),_=function(){a.Curve.call(this),this._controlPoints=[],this._weights=[],this._degree=0,this._knots=[],this._isRational=void 0,this._isPeriodic=void 0,this._isClosed=void 0,this._isPlanarXY=void 0,this._discretizationCache=void 0,this._segments=void 0,this._hasDirtySegments=!0,this._isDirtyControlPoint=[],this._tessellationCache=new p.TessellationCache};(_.prototype=Object.create(a.Curve.prototype)).getGeometryType=function(){return s.GEOMETRY_TYPES.BCURVE},_.prototype.clone=function(){var e=new _;return e.copy(this),e},_.prototype.getControlPointsVector3=function(){for(var e=new Array(this._controlPoints.length/3),t=0;t<this._controlPoints.length/3;t++)e[t]=i.Vector3.createFloat64FromValues(this._controlPoints[3*t],this._controlPoints[3*t+1],this._controlPoints[3*t+2]);return e},_.prototype.copy=function(e){a.Curve.prototype.copy.call(this,e),this._isRational=e._isRational,this._weights=e._weights.slice(0),this._degree=e._degree,this._knots=e._knots.slice(0),this._isPeriodic=e._isPeriodic,this._isClosed=e._isClosed,this._weights=e._weights.slice(0),this._controlPoints=e._controlPoints.slice(0),this._isPlanarXY=e._isPlanarXY,this._hasDirtySegments=!0,this._tessellationCache.reset()},_.prototype.set=function(e,t,n,r){this.dirtyCurveRepresentation(),this._weights=Array.prototype.slice.call(t),this._degree=n;var o=0;if(this._isRational=!1,this._weights.length!==t.length){this._weights=Array.prototype.slice.call(t);var s=this._weights[0];for(o=1;o<this._weights.length;++o)if(Math.abs(this._weights[o]-s)>i.FLOAT64_TOLERANCE){this._isRational=!0;break}}else for(s=this._weights[0],o=1;o<this._weights.length;++o)this._weights[o]=t[o],Math.abs(this._weights[o]-s)>i.FLOAT64_TOLERANCE&&(this._isRational=!0);if(this._knots.length!==r.length)this._knots=Array.prototype.slice.call(r);else for(o=0;o<this._knots.length;++o)this._knots[o]=r[o];var a=e.length/3;if(0===this._weights.length)for(this._weights=new Array(a),o=0;o<a;++o)this._weights[o]=1;if(this._controlPoints.length!==e.length)this._controlPoints=Array.prototype.slice.call(e);else for(o=0;o<e.length;++o)this._controlPoints[o]=e[o];this._isDirtyControlPoint.length!==a&&(this._isDirtyControlPoint=new Array(a)),this._isDirtyControlPoint.fill(!1)},_.prototype.dirtyCurveRepresentation=function(){this._isPlanarXY=void 0,this._isRational=void 0,this._isClosed=void 0,this._isPeriodic=void 0,this._discretizationCache=void 0,this._hasDirtySegments=!0,this._tessellationCache.setDirty(!0)},_.prototype.hasDirtyTessellation=function(){return this._tessellationCache.isDirty()},_.prototype.getTessellationCacheTolerance=function(){return this._tessellationCache.getTolerance()},_.prototype.weightedControlPoints=function(){for(var e=[],t=0;t<this._controlPoints.length/3;++t){var n=this._weights[t];e.push(this._controlPoints[3*t]*n,this._controlPoints[3*t+1]*n,this._controlPoints[3*t+2]*n,n)}return e},_.prototype.getControlPoints=function(){return this._controlPoints},_.prototype._findChangedControlPoints=function(e){var t=e.length===this._controlPoints.length;t||(this._isDirtyControlPoint=new Array(e.length/3),this._isDirtyControlPoint.fill(!0));for(var n=0;n<e.length/3;++n)if(t){var i=e[3*n]-this._controlPoints[3*n],r=e[3*n+1]-this._controlPoints[3*n+1],o=e[3*n+2]-this._controlPoints[3*n+2];i*i+r*r+o*o>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE&&(this._isDirtyControlPoint[n]=!0)}else this._isDirtyControlPoint[n]=!0},_.prototype.setControlPoints=function(e){this._findChangedControlPoints(e),this._controlPoints=e,this.dirtyCurveRepresentation()},_.prototype.copyControlPoints=function(e){if(this._findChangedControlPoints(e),e!==this._controlPoints){this._controlPoints.length=e.length;for(var t=0;t<e.length;++t)this._controlPoints[t]=e[t]}this.dirtyCurveRepresentation()},_.prototype.transform=function(e){for(var t=[],n=i.Vector3.createFloat64(),r=0;r<this._controlPoints.length;r+=3)i.Vector3.set(n,this._controlPoints[r],this._controlPoints[r+1],this._controlPoints[r+2]),i.Vector3.transformMatrix44(n,n,e),t.push(n[0],n[1],n[2]);this.setControlPoints(t)},_.prototype.getControlPointPosition=function(e){return i.Vector3.createFloat64FromValues(this._controlPoints[3*e],this._controlPoints[3*e+1],this._controlPoints[3*e+2])},_.prototype.extendBBoxFromControlPoints=function(e){for(var t=i.Vector3.createFloat64(),n=0;n<this._controlPoints.length;n+=3)i.Vector3.set(t,this._controlPoints[n],this._controlPoints[n+1],this._controlPoints[n+2]),e.includePoint(t)},_.prototype.setControlPointPosition=function(e,t,n,i){this._controlPoints[3*e]=t,this._controlPoints[3*e+1]=n,this._controlPoints[3*e+2]=i,this._isDirtyControlPoint[e]=!0,this.dirtyCurveRepresentation()},_.prototype.getWeights=function(){return this._weights},_.prototype.setWeights=function(e){this._weights=e,this.dirtyCurveRepresentation()},_.prototype.getKnotVector=function(){return this._knots},_.prototype.setKnotVector=function(e){this._knots=e,this.dirtyCurveRepresentation()},_.prototype.getDegree=function(){return this._degree},_.prototype.isRational=function(){if(void 0===this._isRational&&(this._isRational=!1,this._weights))for(var e=this._weights[0],t=0;t<this._weights.length;++t)if(Math.abs(this._weights[t]-e)>i.FLOAT64_TOLERANCE)return this._isRational=!0,!0;return this._isRational},_.prototype.isSimpleBezier=function(){return this._knots.length===2*this._degree+2},_.prototype.getNumControlPoints=function(){return this._controlPoints.length/3},_.prototype.getTessellationCache=function(){return this._tessellationCache.getCache()},_.prototype.getEvaluationCache=function(){return void 0===this._discretizationCache&&this.evaluate(),this._discretizationCache},_.prototype.getRangeUnlimited=function(){return[this._knots[0],this._knots[this._knots.length-1]]},_.prototype.isPeriodicUnlimited=function(){return this._checkClosure(),this._isPeriodic},_.prototype.isClosedUnlimited=function(){return this._checkClosure(),this._isClosed},_.prototype._checkClosure=function(){if(void 0===this._isClosed||void 0===this._isPeriodic){this._isClosed=this._isPeriodic=!1;var e=this.getRangeUnlimited(),t=this.evaluatePosition(e[0]),n=this.evaluatePosition(e[1]);if(i.Vector3.equals(t,n,s.KERNEL_TOLERANCE)){this._isClosed=!0;var r=this.evaluateDt(e[0]),o=this.evaluateDt(e[1]);i.Vector3.isParallel(r,o,1,s.KERNEL_ANGULAR_TOLERANCE)&&(this._isPeriodic=!0)}}},_.prototype.getBezierSegments=function(){return this._decomposeCurve(),this.isSimpleBezier()?[this]:this._segments},_.prototype.isPlanarXY=function(){if(void 0===this._isPlanarXY){var e=s.SPLINE_DISTANCE_TOLERANCE;this._isPlanarXY=!0;for(var t=1/0,n=-1/0,i=2;i<this._controlPoints.length;i+=3)t=Math.min(t,this._controlPoints[i]),n=Math.max(n,this._controlPoints[i]);Math.abs(n-t)>2*e&&(this._isPlanarXY=!1)}return this._isPlanarXY},_.prototype.getBezierSegmentsInRange=function(e,t){for(var n=this.getBezierSegments(),i=e||this._knots[0],r=t||this._knots[this._knots.length-1],o=[],s=0;s<n.length;++s){var a=n[s].getKnotVector();i<=a[a.length-1]&&a[0]>=r&&o.push(n[s])}return o},_.prototype.getApproxParameterSpaceTolerance=function(){if(12===this.getControlPoints().length)return g.SplineCurveHelper.getApproxBezierParameterSpaceTolerance(this.getBoundingBox(),s.KERNEL_TOLERANCE);this._decomposeCurve();for(var e=0,t=0;t<this._segments.size();++t)e+=g.SplineCurveHelper.getApproxBezierParameterSpaceTolerance(this._segments[t].getBoundingBox(),s.KERNEL_TOLERANCE);return e},_.prototype.getArcLength=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());for(var t=this._restrictRangeToUnlimited(e),n=0,r=this.getBezierSegments(),o=0;o<r.length;++o)for(var a=r[o],c=a.getRangeUnlimited(),u=0;u<t.length;++u){var h=[Math.max(c[0],t[u][0]),Math.min(c[1],t[u][1])];h[1]-h[0]>s.PARAMETER_SPACE_TOLERANCE&&(n+=(0,l.integrateFunction1D)((function(e){return i.Vector3.length(a.evaluateDt(e))}),h))}return n},_.prototype.getParameterFromArcLength=function(e,t){void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited());var n=this;return(0,l.invertIntegral1D)((function(e){return i.Vector3.length(n.evaluateDt(e))}),e,t)},_.prototype._decomposeCurve=function(){if(this._hasDirtySegments)if(this._hasDirtySegments=!1,this.isSimpleBezier())this._segments=void 0;else{var e;this._isDirtyControlPoint.length===this.getNumControlPoints()?e=(0,y.decomposeBCurveFlags)(this.getKnotVector(),this._isDirtyControlPoint):(this._isDirtyControlPoint=new Array(this.getNumControlPoints()),(e=new Array(this.getNumControlPoints())).fill(!0)),this._isDirtyControlPoint.fill(!1);var t=(0,y.decomposeBCurveToBezier)(this._knots,this._controlPoints,this.isRational()?this._weights:void 0);this._segments&&this._segments.length===t.P.length||(this._segments=[]);for(var n=0;n<t.P.length;++n)void 0===this._segments[n]&&(this._segments[n]=new _,e[n]=!0),e[n]&&this._segments[n].set(t.P[n],t.w?t.w[n]:new Array(2*this._degree+2).fill(1),this._degree,t.U[n])}},_.prototype.evaluatePosition=function(e){this.isPeriodicUnlimited()&&(e=(0,u.normalizeParameterToShiftedRange)(e,[this._knots[0],this._knots[this._knots.length-1]]));var t=this.isRational()?this._weights:void 0;return(0,v.evaluateBCurvePoint)(e,this._degree,this._knots,this._controlPoints,t)},_.prototype.evaluateDt=function(e){this.isPeriodicUnlimited()&&(e=(0,u.normalizeParameterToShiftedRange)(e,[this._knots[0],this._knots[this._knots.length-1]]));var t=this.isRational()?this._weights:void 0;return(0,v.evaluateBCurveDerivs)(e,1,this._degree,this._knots,this._controlPoints,t)[1]},_.prototype.closestToRayParam=function(e,t,n,r){if(!(this._controlPoints.length<9)){if(this.isPlanarXY()){var o=t[2],a=i.Vector3.createFloat64();if(Math.abs(o)<s.KERNEL_ANGULAR_TOLERANCE)i.Vector3.copy(a,e);else{var c=(this._controlPoints[2]-e[2])/o;i.Vector3.add(a,i.Vector3.scale(a,t,c),e)}return this.closestToPointParam(a)}d.DebugUtils.warn("BCurve.closestToRayParam() only defined for planar curves")}},_.prototype.closestToPointParam=function(e,t){void 0===t?t=this.getRange():0===t.length&&(t=this.getRangeUnlimited());for(var n=this._restrictRangeToUnlimited(t),r=i.FLOAT64_TOLERANCE,o=this.getBezierSegments(),s=(0,m.closestBCurveSegments)(e,o,void 0,n),a=Number.POSITIVE_INFINITY,c=void 0,l=0;l<s.length;++l)if(!(s[l].minDistSqr>a))for(var h=o[s[l].index],d=h.getRangeUnlimited(),p=0;p<n.length;++p){var g=[Math.max(d[0],n[p][0]),Math.min(d[1],n[p][1])];if(!(g[1]-g[0]<=i.FLOAT64_TOLERANCE)){var f=h.getEvaluationCache(),v=(0,u.closestPointToPolyline)(e,f.points,f.offset,g),y=(0,m.relaxBCurveToPerpendicular)(this._knots,this._controlPoints,this.isRational()?this._weights:void 0,e,v,g,r,32),_=h.evaluatePosition(y),E=i.Vector3.squaredDistance(_,e);E<a&&(a=E,c=y);var A=h.evaluatePosition(g[0]),x=i.Vector3.squaredDistance(A,e);x<a&&(a=x,c=g[0]);var C=h.evaluatePosition(g[1]),w=i.Vector3.squaredDistance(C,e);w<a&&(a=w,c=g[1])}}return this.isPeriodicUnlimited()&&(c=(0,u.foldNearTo)(c,.5*(t[0]+t[1]),this.getPeriodUnlimited())),c},_.prototype.evaluate=function(){var e=this.getBezierSegments();if(e[0]===this)void 0===this._discretizationCache&&(this._discretizationCache=g.SplineCurveHelper.evaluateCurve(this.getDegree(),this.getKnotVector(),this.getControlPoints(),this.getWeights(),!0));else for(var t=0;t<e.length;++t){var n=e[t];void 0===n._discretizationCache&&(n._discretizationCache=g.SplineCurveHelper.evaluateCurve(n.getDegree(),n.getKnotVector(),n.getControlPoints(),n.getWeights(),!0))}},_.prototype._getFullTessellation=function(e){var t,n,r=this.getBezierSegments(),o=0,s=!1;if(r[0]===this){s=!0;var a=p.CurveTessellator.getAdaptiveRenderPoints(this,e,this.getRangeUnlimited());t=a.positions,n=a.params,o=Math.max(o,a.tolerance)}else{t=[],n=[];for(var c=0;c<r.length;++c){var u=r[c];if(u.hasDirtyTessellation()||u.getTessellationCacheTolerance()>e+i.FLOAT64_TOLERANCE){s=!0;var l=p.CurveTessellator.getAdaptiveRenderPoints(u,e,u.getRangeUnlimited());u._tessellationCache.setCache(l),o=Math.max(o,l.tolerance)}u._tessellationCache&&(0===c?(t.push.apply(t,u._tessellationCache.getCache().positions),n.push.apply(n,u._tessellationCache.getCache().params)):(t.push.apply(t,u._tessellationCache.getCache().positions.slice(1)),n.push.apply(n,u._tessellationCache.getCache().params.slice(1))))}}return{positions:t,params:n,didRetessellate:s,tolerance:o}},_.prototype.tessellate=function(e,t){return t=t||s.TESSELLATION.LINEAR_PRECISION,this._tessellationCache.getTessellation(e,this,t,this._getFullTessellation.bind(this))},_.prototype.getBoundingBox=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=this._restrictRangeToUnlimited(e),n=new r.BoundingBox,i=this.getRangeUnlimited();if(t[0][0]<i[0]+s.PARAMETER_SPACE_TOLERANCE&&t[0][1]>i[1]-s.PARAMETER_SPACE_TOLERANCE)this.extendBBoxFromControlPoints(n);else for(var o=this.getBezierSegments(),a=0;a<t.length;a++)for(var c=0;c<o.length;c++){var u=o[c];(u=u._getSubset(t[a][0],t[a][1]))&&u.extendBBoxFromControlPoints(n)}return n},_.prototype.getTangentCone=function(e){void 0===e?e=this.getRange():0===e.length&&(e=this.getRangeUnlimited());var t=this.evaluatePosition(e[0]),n=this.evaluatePosition(e[1]);i.Vector3.sub(n,n,t),i.Vector3.squaredLength(n)<.01*s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE&&(n=this.evaluateDt(.5*(e[0]+e[1]))),i.Vector3.normalize(n,n);for(var r=new o.TangentCone(n,0),a=this._restrictRangeToUnlimited(e),c=i.Vector3.createFloat64FromValues(0,0,0),u=this.getBezierSegments(),l=0;l<a.length;l++)for(var h=0;h<u.length;h++){var d=u[h];if(d=d._getSubset(a[l][0],a[l][1]))for(var p=d._controlPoints,g=0;g<p.length-3;g+=3)c[0]=p[g+3]-p[g],c[1]=p[g+4]-p[g+1],c[2]=p[g+5]-p[g+2],i.Vector3.dot(c,n)>=0?r.includeVector(c):r.angle=Math.PI}return r},_.prototype._getSubset=function(e,t){var n;if(this.isPeriodicUnlimited())return t-e>this.getPeriodUnlimited()-s.PARAMETER_SPACE_TOLERANCE?this:((n=this.clone())._periodicTrimToParams(e,t),n);var i=this.getRangeUnlimited();return e>i[1]-s.PARAMETER_SPACE_TOLERANCE||t<i[0]+s.PARAMETER_SPACE_TOLERANCE?void 0:e<i[0]+s.PARAMETER_SPACE_TOLERANCE&&t>i[1]-s.PARAMETER_SPACE_TOLERANCE?this:(n=this.clone(),e>i[0]+s.PARAMETER_SPACE_TOLERANCE&&n.trimToParam(!0,e),t<i[1]-s.PARAMETER_SPACE_TOLERANCE&&n.trimToParam(!1,t),n)},_.prototype._periodicTrimToParams=function(e,t){h.ConsoleUtils.assert(this._isPeriodic);var n=this.getRangeUnlimited(),i=(0,u.normalizeParametricRangeToShiftedRange)([e,t],n);if(i[1]>n[1])this._isClosed=this._isPeriodic=!1,this.trimToParam(!0,i[1]-(n[1]-n[0]),void 0),this.trimToParam(!1,i[0],void 0);else{var r,o,s=this.getControlPoints(),a=this.getKnotVector(),c=this.getWeights(),l=this.getDegree(),d=this.getPeriodUnlimited(),p=[],f=a.slice(),v=a.slice(),y=[];for(o=0;o<s.length/3;++o)p[4*o+0]=s[3*o+0]*c[o],p[4*o+1]=s[3*o+1]*c[o],p[4*o+2]=s[3*o+2]*c[o],p[4*o+3]=c[o];for(r=p.slice(),g.SplineCurveHelper.extractCurveSegment(l,i[1],n[1],f,p),g.SplineCurveHelper.extractCurveSegment(l,n[0],i[0],v,r),o=0;o<v.length;++o)v[o]=v[o]+d;g.SplineCurveHelper.joinCurves(l,f,p,v,r);var m=p.length/4,_=[];for(y.length=m,_.length=3*m,o=0;o<m;++o){var E=p[4*o+3];_[3*o]=p[4*o]/E,_[3*o+1]=p[4*o+1]/E,_[3*o+2]=p[4*o+2]/E,y[o]=E}this.set(_,y,l,f),this._isClosed=this._isPeriodic=!1}},_.prototype.trimToParam=function(e,t,n){if(this.isPeriodicUnlimited())return h.ConsoleUtils.assert(void 0!==n),void this._periodicTrimToParams(t,n);var i,r,o=this.getControlPoints(),s=this.getKnotVector(),a=this.getWeights(),c=this.getDegree(),u=[];for(i=0;i<o.length/3;++i)u[4*i+0]=o[3*i+0]*a[i],u[4*i+1]=o[3*i+1]*a[i],u[4*i+2]=o[3*i+2]*a[i],u[4*i+3]=a[i];var l=[],d=0,p=g.SplineCurveHelper.insertKnot(c,s,u,t,c),v=(0,f.findKnotSpan)(t,p.U);for(e?(p.U.splice(0,v-c+1,t),r=p.U.length-c-1,d=4*(p.Pw.length/4-r)):(p.U.splice(v+1,p.U.length,t),r=p.U.length-c-1),u.length=3*r,l.length=r,i=0;i<r;++i){var y=p.Pw[4*i+3+d];u[3*i]=p.Pw[4*i+0+d]/y,u[3*i+1]=p.Pw[4*i+1+d]/y,u[3*i+2]=p.Pw[4*i+2+d]/y,l[i]=y}this.set(u,l,c,p.U)},_.prototype.addControlPoint=function(e,t){var n=this.getControlPoints(),r=this.getNumControlPoints(),o=this.getKnotVector(),a=this.getWeights(),u=this.getDegree(),l=this.getControlPointPosition(e),h=this.getControlPointPosition(e+1),d=new c.Line;d.setFromEndpoints(l,h);var p=d.closestToPointParam(t),f=d.evaluatePosition(p),v=i.Vector3.distance(f,l),y=i.Vector3.distance(f,h),m=a[e]*v+a[e+1]*y;if(Math.abs(m)<s.KERNEL_TOLERANCE)console.warn("numerical error in addControlPoints -- coincident control points / negative weights?");else{for(var _=a[e]*v/m,E=o[e+1]+_*(o[e+u+1]-o[e+1]),A=[],x=0;x<n.length/3;++x)A[4*x]=n[3*x]*a[x],A[4*x+1]=n[3*x+1]*a[x],A[4*x+2]=n[3*x+2]*a[x],A[4*x+3]=a[x];var C=g.SplineCurveHelper.findKnotMultiplicity(E,o),w=g.SplineCurveHelper.insertKnot(u,o,A,E,C+1),b=[];for(A.length=3*(r+1),b.length=r+1,x=0;x<=r;++x){var M=w.Pw[4*x+3];A[3*x]=w.Pw[4*x]/M,A[3*x+1]=w.Pw[4*x+1]/M,A[3*x+2]=w.Pw[4*x+2]/M,b[x]=M}this.set(A,b,u,w.U)}},_.prototype.addControlPointOnCurve=function(e){for(var t=this.getNumControlPoints(),n=Number.MAX_VALUE,r=-1,o=i.Vector3.createFloat64FromValues(0,0,0),s=i.Vector3.createFloat64FromValues(0,0,0),a=0;a<t-1;++a){o[0]=this._controlPoints[3*a+0],o[1]=this._controlPoints[3*a+1],s[0]=this._controlPoints[3*a+3],s[1]=this._controlPoints[3*a+4];var c=(0,u.distancePointToLineSegment)(o,s,e);c<n&&(n=c,r=a)}-1!==r&&this.addControlPoint(r,e)},_.prototype.makePeriodic=function(){if(!this.isPeriodicUnlimited()){for(var e=this.getControlPoints(),t=this.getKnotVector(),n=this.getWeights(),i=this.getDegree(),r=[],o=0;o<e.length/3;++o)r[4*o]=e[3*o]*n[o],r[4*o+1]=e[3*o+1]*n[o],r[4*o+2]=e[3*o+2]*n[o],r[4*o+3]=n[o];var s=t.slice();g.SplineCurveHelper.makePeriodic(i,s,r);var a=[],c=[],u=r.length/4;for(a.length=u,c.length=3*u,o=0;o<u;++o){var l=r[4*o+3];c[3*o]=r[4*o]/l,c[3*o+1]=r[4*o+1]/l,c[3*o+2]=r[4*o+2]/l,a[o]=l}this.set(c,a,i,s),this._isClosed=this._isPeriodic=!0}},_.prototype.suggestSplittingParam=function(e){var t,n=this.getKnotVector(),i=.5*(e[0]+e[1]),r=(0,u.sortedIndex)(n,i);if(0===r)t=n[r];else if(r===n.length)t=n[r-1];else{var o=n[r-1],s=n[r];t=i-o<s-i?o:s}return t>=e[0]&&t<=e[1]?t:void 0},_.prototype.toObject=function(){return{degree:this._degree,knots:this._knots,controlPoints:this._controlPoints,weights:this._weights,range:this.rangeToObject(this.getRange(),this.isLimited())}},t.BCurve=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TangentCone=void 0;var i=n(1),r=n(0),o=n(3),s=function(e,t){this.set(e,t)};s.prototype.set=function(e,t){void 0===e||void 0===t?(this.axis=void 0,this.angle=void 0):(this.axis=i.Vector3.clone(e),this.angle=t)},s.prototype.toString=function(){return this.isDegenerate()?"degenerate":"(x:"+this.axis[0]+", y:"+this.axis[1]+", z:"+this.axis[2]+", radians:"+this.angle+")"},s.prototype.copy=function(e){return e.isDegenerate()?(this.axis=void 0,this.angle=void 0):(this.axis=i.Vector3.clone(e.axis),this.angle=e.angle),this},s.prototype.clone=function(){return new s(this.axis,this.angle)},s.prototype.isDegenerate=function(){return void 0===this.axis||void 0===this.angle},s.prototype.includeVector=function(e){if(i.Vector3.squaredLength(e)<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE)return this;if(this.isDegenerate())return this.axis||(this.axis=i.Vector3.createFloat64()),i.Vector3.normalize(this.axis,e),this.angle=0,this;var t=i.Vector3.dot(this.axis,e)/i.Vector3.length(e);t=(0,o.clamp)(t,-1,1);var n=Math.acos(t);return this.angle=Math.max(this.angle,n),this},s.prototype.includeCone=function(e){if(e.isDegenerate())return this;if(this.isDegenerate())return this.copy(e);var t=i.Vector3.dot(this.axis,e.axis),n=Math.acos((0,o.clamp)(t,-1,1));if(this.angle>=e.angle+n)return this;if(e.angle>=this.angle+n)return this.copy(e);if(n>Math.PI-r.KERNEL_ANGULAR_TOLERANCE)return this.angle=Math.PI,this;var s=(this.angle+e.angle+n)/2;if(s>=Math.PI)return this.angle=Math.PI,this;var a=Math.sin(s-e.angle),c=Math.sin(s-this.angle);return i.Vector3.scale(this.axis,this.axis,a),i.Vector3.scaleAndAdd(this.axis,this.axis,e.axis,c),i.Vector3.normalize(this.axis,this.axis),this.angle=s,this},s.prototype.contains=function(e,t){if(t="number"==typeof t?t:r.KERNEL_ANGULAR_TOLERANCE,!this.isDegenerate())return i.Vector3.squaredLength(e)<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE||i.Vector3.angle(this.axis,e)<this.angle+t},t.TangentCone=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.invertIntegral1D=t.integrateFunction1D=t.newtonRaphson1D=void 0;var i=n(0),r=n(3),o=n(8),s=function(){var e=[.9914553711208126,.9491079123427585,.8648644233597691,.7415311855993945,.5860872354676911,.4058451513773972,.20778495500789848,0],t=[.022935322010529224,.06309209262997856,.10479001032225019,.14065325971552592,.1690047266392679,.19035057806478542,.20443294007529889,.20948214108472782],n=[.1294849661688697,.27970539148927664,.3818300505051189,.4179591836734694];return function(r,a,c){var u=function(i,r,o){for(var s=.5*(r+o),a=.5*(o-r),c=i(s),u=c*t[7],l=c*n[3],h=0;h<7;++h){var d=a*e[h],p=i(s-d)+i(s+d);u+=p*t[h],h%2==1&&(l+=p*n[Math.floor(h/2)])}var g=200*Math.abs(u-l)*a;return{length:u*a,error:g*=Math.sqrt(g)}}(r,a[0],a[1]);if(void 0===c)c=0;else if(c>8)return o.DebugUtils.warn("Max depth reached in integrateFunction1D!"),u.length;if(u.error>i.KERNEL_TOLERANCE){var l=.5*(a[0]+a[1]);return s(r,[a[0],l],c+1)+s(r,[l,a[1]],c+1)}return u.length}}();t.newtonRaphson1D=function(e,t,n,i,s){var a,c=n;t&&(c=(0,r.clamp)(c,t[0],t[1]));var u=0;do{++u;var l=e(c),h=c-l.val/l.deriv;t&&(h=(0,r.clamp)(h,t[0],t[1])),a=Math.abs(h-c),c=h}while(a>i&&u<s);return u>=s&&o.DebugUtils.warn("Maximum number of iterations reached. Something wrong is going on here !!!"),c},t.integrateFunction1D=s,t.invertIntegral1D=function(e,t,n){var o=i.KERNEL_TOLERANCE,a=s(e,n);if(t<o)return n[0];if(t>a-o)return n[1];for(var c=n[0],u=n[1],l=t;u-c>i.PARAMETER_SPACE_TOLERANCE;){var h=l/a,d=c+(h=(0,r.clamp)(h,.01,.99))*(u-c),p=s(e,[c,d]),g=a-(p=(0,r.clamp)(p,0,a));if(Math.abs(l-p)<o)return d;p>l?(u=d,a=p):(c=d,l-=p,a=g)}return.5*(c+u)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SplineCurveHelper=void 0;var i=n(1),r=n(0),o=n(3),s=n(8),a=n(17),c=n(37),u=n(72),l=function(){};l.getApproxBezierParameterSpaceTolerance=function(e,t){var n=e.getDiagonal(),o=2*t/i.Vector3.length(n);return o<.01*r.PARAMETER_SPACE_TOLERANCE?.01*r.PARAMETER_SPACE_TOLERANCE:o},l.solve_cubic_uniqueRoots=function(e,t){var n=e[2]*e[2]-3*e[1],i=e[2]*(2*e[2]*e[2]-9*e[1])+27*e[0];if(0===i&&0===n)return t[0]=-e[2]/3,1;if(i*i/4<n*n*n){var r=-2*Math.sqrt(n),o=Math.acos(-i/(n*r));return t[0]=(r*Math.cos(o/3)-e[2])/3,t[1]=(r*Math.cos((o+2*Math.PI)/3)-e[2])/3,t[2]=(r*Math.cos((o-2*Math.PI)/3)-e[2])/3,3}var s=Math.pow(Math.abs(i)/2+Math.sqrt(i*i/4-n*n*n),1/3)/3;return i>0&&(s=-s),t[0]=s+n/(9*s)-e[2]/3,1};var h=function(e,t,n){return 6*((1-n)*(e[6+t]-2*e[3+t]+e[t])+n*(e[9+t]-2*e[6+t]+e[3+t]))},d=function(e,t){return 6*(e[9+t]-e[t]+3*(e[3+t]-e[6+t]))},p=function(e,t){var n=new Array(3);!function(e,t,n){n[0]=3*(e[3+t]-e[t]),n[1]=6*(e[t]+e[6+t]-2*e[3+t]),n[2]=3*(e[9+t]-e[t]+3*(e[3+t]-e[6+t]))}(e,t,n);var i,r=new Array(2),o=function(e,t){var n=e[1]*e[1]-4*e[2]*e[0];if(n<0)return 0;if(0===n)return t[0]=-.5*e[1]/e[2],1;var i=e[1]>0?-.5*(e[1]+Math.sqrt(n)):-.5*(e[1]-Math.sqrt(n));return t[0]=i/e[2],t[1]=e[0]/i,2}(n,r);2===o&&r[0]>r[1]&&(i=r[0],r[0]=r[1],r[1]=i);for(var s=[],a=0;a<o;a++)r[a]>0&&r[a]<1&&((i=Math.abs(h(e,t,r[a]))<1e-12)?(i=Math.abs(d(e,t))<1e-12)&&s.push(r[a]):s.push(r[a]));return s},g=function(e,t,n){return e+t[0]+t[1]*n+t[2]*n*n+t[3]*n*n*n};l.intersect_xAxis_NonRationalCubicBSpline_XYPlanar3D=function(e,t,n,i){var o=new Float64Array(4),s=new Float64Array(4);o[0]=t[0]-e[0],o[1]=3*(t[3]-t[0]),o[2]=3*(t[0]+t[6]-2*t[3]),o[3]=t[9]-t[0]+3*(t[3]-t[6]),s[0]=t[1]-e[1],s[1]=3*(t[4]-t[1]),s[2]=3*(t[1]+t[7]-2*t[4]),s[3]=t[10]-t[1]+3*(t[4]-t[7]);var a,c=s;if(Math.abs(c[3])>1e-4)c[0]/=c[3],c[1]/=c[3],c[2]/=c[3],c[3]=1,a=this.solve_cubic_uniqueRoots(c,n);else{var l=[].slice.call(c).reverse();0===l[0]&&(l=l.slice(1));var h=(0,u.getRealPolynomialRoots)(l);a=h.length;for(var d=0;d<a;d++)n[d]=h[d]}if(1===a)return(f=n[0])<0||f>1?0:(n[0]=g(e[0],o,f),1);d=0;for(var p=0;p<a;++p)(f=n[p])>=0&&f<=1&&(n[d]=g(e[0],o,f),++d);if(void 0!==i){var f,v;if(Math.abs(s[3])<1e-12)Math.abs(s[2])<1e-12?v=-1:(f=-s[1]/(2*s[2]),v=0);else{var y=2/3*s[2]/s[3];v=y*y/4-1/3*s[1]/s[3],f=-y/2}if(0===v)if(f<0||f>1){var m=g(e[0],s,0),_=g(e[0],s,1);Math.abs(m)>Math.abs(_)?i.push([g(e[0],o,0),m]):i.push([g(e[0],o,1),_])}else i.push([g(e[0],o,f),g(e[0],s,f)]);else if(v>0){for(p=0;p<2;p++)(f=-y/2+(0===p?-1:1)*Math.sqrt(v))<-r.PARAMETER_SPACE_TOLERANCE||f>1+r.PARAMETER_SPACE_TOLERANCE||(f=Math.max(Math.min(1,f),0),i.push([g(e[0],o,f),g(e[0],s,f)]));if(i.length>1&&i[0][0]>i[1][0]){var E=i[0];i[0]=i[1],i[1]=E}}}return d},l.isPointInsideSplineRegionXYPlanar3D=function(e,t,n){var r,s,a=new Float64Array(3),c=t.getBezierSegments();if(t.isRational()||!c||3!==t.getDegree()){for(var u=t.tessellate().positions,l=new Float64Array(2*u.length),h=0;h<u.length;++h)l[2*h]=u[h].x,l[2*h+1]=u[h].y;return(0,o.isPointInsidePolygon2D)(e,l)}var d,p=0,g=i.Vector3.createFloat64();for(h=0;h<c.length;++h){s=c[h].getControlPoints(),r=this.intersect_xAxis_NonRationalCubicBSpline_XYPlanar3D(e,s,a);for(var f=0;f<r;++f)i.Vector3.set(g,a[f],e[1],0),(d=t.closestToPointParam(g))>=n[0]&&d<=n[1]&&a[f]>e[0]&&++p}var v=t.evaluatePosition(n[0]),y=t.evaluatePosition(n[1]),m=i.Vector3.createFloat64();i.Vector3.normalize(m,i.Vector3.sub(m,y,v)),m[1]<0&&i.Vector3.negate(m,m);var _=i.Vector2.createFloat64FromValues(e[0],e[1]);return(0,o.signedDistanceTo2DLine)(v,m,_)<=0&&e[1]>=Math.min(v[1],y[1])&&e[1]<=Math.max(v[1],y[1])&&++p,1&p},l.insertKnot=function(e,t,n,i,r){var o,s,c,u=[],l=[],h=[],d=n.length/4,p=d+e+1,g=(0,a.findKnotSpanAndMultiplicity)(i,t),f=r-g.multiplicity;if(f<1)return{U:u=t.slice(),Pw:l=n.slice()};for(o=0;o<=g.span;++o)u[o]=t[o];for(o=1;o<=f;++o)u[g.span+o]=i;for(o=g.span+1;o<p;++o)u[o+f]=t[o];for(o=0;o<=g.span-e;++o)for(s=0;s<4;++s)l[4*o+s]=n[4*o+s];for(o=g.span-g.multiplicity;o<d;++o)for(s=0;s<4;++s)l[4*(o+f)+s]=n[4*o+s];for(o=0;o<=e-g.multiplicity;++o)for(s=0;s<4;++s)h[4*o+s]=n[4*(g.span-e+o)+s];for(var v=1;v<=f;++v){for(c=g.span-e+v,o=0;o<=e-v-g.multiplicity;++o){var y=(i-t[c+o])/(t[o+g.span+1]-t[c+o]);for(s=0;s<4;++s)h[4*o+s]=h[4*(o+1)+s]*y+h[4*o+s]*(1-y)}for(s=0;s<4;++s)l[4*c+s]=h[s],l[4*(g.span+f-v-g.multiplicity)+s]=h[4*(e-v-g.multiplicity)+s]}for(o=c+1;o<g.span-g.multiplicity;++o)for(s=0;s<4;++s)l[4*o+s]=h[4*(o-c)+s];return{U:u,Pw:l}},l.refineKnotVector=function(e,t,n,i){var o,s,c=[],u=[],l=n.length/4-1,h=i.length-1,d=l+e+1,p=(0,a.findKnotSpan)(i[0],t),g=(0,a.findKnotSpan)(i[h],t)+1;for(o=0;o<=p-e;++o)for(s=0;s<4;++s)u[4*o+s]=n[4*o+s];for(o=g-1;o<=l;++o)for(s=0;s<4;++s)u[4*(o+h+1)+s]=n[4*o+s];for(o=0;o<=p;++o)c[o]=t[o];for(o=g+e;o<=d;++o)c[o+h+1]=t[o];var f=g+e-1,v=g+e+h;for(o=h;o>=0;--o){for(;i[o]<=t[f]&&f>p;){for(s=0;s<4;++s)u[4*(v-e-1)+s]=n[4*(f-e-1)+s];c[v]=t[f],--v,--f}for(s=0;s<4;++s)u[4*(v-e-1)+1]=u[4*(v-e)+s];for(var y=1;y<=e;++y){var m=v-e+y,_=c[v+y]-i[o];if(Math.abs(_)<r.KERNEL_TOLERANCE)for(s=0;s<4;++s)u[4*(m-1)+s]=u[4*m+s];else for(_/=c[v+y]-t[f-e+y],s=0;s<4;++s)u[4*(m-1)+s]=u[4*(m-1)+s]*_+u[4*m+s]*(1-_)}c[v]=i[o],--v}return{U:c,Pw:u}};var f=function(e,t,n,r){var s=(0,o.projectPointToLineSegment)(t,n,e);return r&&(s=(0,o.clamp)(s,0,1)),i.Vector3.lerp(i.Vector3.createFloat64(),t,n,s)};l.validControlPolygon=function(e){for(var t=e.length/3,n=e.length,r=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),s=i.Vector3.createFloat64(),a=3,c=1;c<t-1;++c){i.Vector3.set(r,e[a],e[a+1],e[a+2]),i.Vector3.set(o,e[a-3],e[a-2],e[a-1]),i.Vector3.set(s,e[a+3],e[a+4],e[a+5]);var u=f(r,o,s,!1);if(i.Vector3.sub(r,r,u),c<t/2?i.Vector3.sub(o,[e[n-3],e[n-2],e[n-1]],u):i.Vector3.sub(o,[e[0],e[1],e[2]],u),i.Vector3.dot(r,o)>0)return!1;a+=3}return!0};var v=function(e){if(e)for(var t=0;t<e.length;++t)if(Math.abs(e[t]-1)>i.FLOAT64_TOLERANCE)return!0;return!1},y=function(){var e=new Float64Array(4),t=new Float64Array(4),n=new Float64Array(4),i=new Float64Array(16);return function(r,o,s,a,c){var u,l,h,d,p,g,f=1-s;if(e[0]=f*f*f,e[1]=3*s*f*f,e[2]=3*s*s*f,e[3]=s*s*s,t[0]=-3*f*f,t[1]=3*(s-1)*(3*s-1),t[2]=3*s*(2-3*s),t[3]=3*s*s,n[0]=6*f,n[1]=6*(3*s-2),n[2]=6*(1-3*s),n[3]=6*s,void 0===c?v(o):c){for(var y=0;y<4;++y)i[4*y+a]=r[3*y+a]*o[y],i[4*y+3]=o[y];for(u=i[a]*e[0],l=i[a]*t[0],h=i[a]*n[0],y=1;y<4;++y)u+=i[4*y+a]*e[y],l+=i[4*y+a]*t[y],h+=i[4*y+a]*n[y];for(d=i[3]*e[0],p=i[3]*t[0],g=i[3]*n[0],y=1;y<4;++y)d+=i[4*y+3]*e[y],p+=i[4*y+3]*t[y],g+=i[4*y+3]*n[y];u/=d,l/=p,h/=g}else for(u=r[a]*e[0],l=r[a]*t[0],h=r[a]*n[0],y=1;y<4;++y)u+=r[3*y+a]*e[y],l+=r[3*y+a]*t[y],h+=r[3*y+a]*n[y];return[u,l,h]}}(),m=function(e,t,n,i){var r=i;r[0]=n[0]-t[0],r[1]=n[1]-t[1];var o=r[0]*r[0]+r[1]*r[1],s=(e[0]-t[0])*r[0]+(e[1]-t[1])*r[1];if(0===o||s<=0)i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[1]=i[0]*i[0]+i[1]*i[1],i[0]=0;else if(s>o)i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[1]=i[0]*i[0]+i[1]*i[1],i[0]=1;else{var a=s/o;i[0]=t[0]+a*r[0]-e[0],i[1]=t[1]+a*r[1]-e[1],i[1]=i[0]*i[0]+i[1]*i[1],i[0]=a}},_=function(e,t,n,i){var r=i;r[0]=n[0]-t[0],r[1]=n[1]-t[1],r[2]=n[2]-t[2];var o=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],s=(e[0]-t[0])*r[0]+(e[1]-t[1])*r[1]+(e[2]-t[2])*r[2];if(0===o||s<=0)i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i[1]=i[0]*i[0]+i[1]*i[1]+i[1]*i[1],i[0]=0;else if(s>o)i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i[1]=i[0]*i[0]+i[1]*i[1]+i[1]*i[1],i[0]=1;else{var a=s/o;i[0]=t[0]+a*r[0]-e[0],i[1]=t[1]+a*r[1]-e[1],i[2]=t[2]+a*r[2]-e[2],i[1]=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],i[0]=a}};l.closestStartPoint=function(){var e,t,n,i,r=new Float64Array(3),o=new Float64Array(3),s=new Float64Array(3),a=new Float64Array(2);return function(c,u,l,h){if(l)for(a[0]=0,a[1]=1/0,n=u.points.length,i=0;i<n-3;i+=3)r[0]=u.points[i],r[1]=u.points[i+1],o[0]=u.points[i+3],o[1]=u.points[i+4],m(c,r,o,s),s[1]<a[1]&&(e=i/3,t=(1-s[0])*u.offset[e]+s[0]*u.offset[e+1],(!h||t>=h[0]&&t<=h[1])&&(a[0]=t,a[1]=s[1]));else for(a[1]=1/0,n=u.points.length,i=0;i<n-3;i+=3)r[0]=u.points[i],r[1]=u.points[i+1],r[2]=u.points[i+2],o[0]=u.points[i+3],o[1]=u.points[i+4],o[2]=u.points[i+5],_(c,r,o,s),s[1]<a[1]&&(e=i/3,t=(1-s[0])*u.offset[e]+s[0]*u.offset[e+1],(!h||t>=h[0]&&t<=h[1])&&(a[0]=t,a[1]=s[1]));return a[0]}}(),l.extremalParams=function(e,t){if(3!==e.getDegree())return s.DebugUtils.warn("SplineCurveHelper.extremalParams called with non-degree 3 curve"),[];var n,o,a=e.getBezierSegments(),c=[];for(n=0;n<a.length;++n){var u=a[n].getControlPoints(),h=a[n].getWeights(),d=a[n].getKnotVector(),p=l.extremalParamsXYPlanarBezierCurve(u,h,t),g=[];for(o=0;o<p.length;o++)g.push(d[0]*(1-p[o])+d[d.length-1]*p[o]);c.push(g)}var f=[];for(n=0;n<a.length;++n)if(f=f.concat(c[n]),n<a.length-1||e.isPeriodicUnlimited()){var v=a[n],y=a[(n+1)%a.length],m=c[n],_=c[(n+1)%a.length],E=v.getRangeUnlimited()[1],A=y.getRangeUnlimited()[0],x=0===m.length||E-m[m.length-1]>r.PARAMETER_SPACE_TOLERANCE,C=0===_.length||_[0]-A>r.PARAMETER_SPACE_TOLERANCE;if(x&&C){var w=v.evaluateDt(E)[t],b=y.evaluateDt(A)[t];(Math.abs(w)<i.FLOAT64_TOLERANCE||Math.abs(b)<i.FLOAT64_TOLERANCE||Math.sign(w)!==Math.sign(b))&&f.push(E)}}return f},l.extremalParamsXYPlanarBezierCurve=function(e,t,n,i,r){var o=v(t);if(!o)return p(e,n);for(var s,a,c=i||16,u=r||1e-12,l=[],h=void 0,d=0;d<8;d++){if(a=y(e,t,d/7,n,o),void 0!==h&&Math.sign(a[1])!==h){var g=(d-1+Math.abs(s)/(Math.abs(a[1])+Math.abs(s)))/7;l.push(g)}h=Math.sign(a[1]),s=a[1]}0===l.length&&(l[0]=0+u,l[1]=1-u),l.length>2&&console.error("More than two roots in the second derivative of a cubic polynomial. This should not happen.");var f,m,_,E=[],A=[];for(d=0;d<l.length;d++){var x=0;do{++x,_=0!==(a=y(e,t,l[d],n,o))[2]?l[d]-a[1]/a[2]:l[d],f=Math.abs(a[1]),m=Math.abs(l[d]-_),l[d]=_}while((f>u||m>1e-6)&&x<c);E[d]=f,A[d]=a[2]}for(d=0;d<l.length;d++)if(l[d]<0||l[d]>1||E[d]>u)l.splice(d,1),d--;else if(Math.abs(A[d])<1e-6){var C=(y(e,t,l[d]+5e-7,n,o)[2]-y(e,t,l[d]-5e-7,n,o)[2])/1e-6;Math.abs(C)>1e-6&&(l.splice(d,1),d--)}if(2===l.length){if(Math.abs(l[0]-l[1])<1e-6){var w=E[0]/(E[0]+E[1]);return[l[0]*(1-w)+l[1]*w]}return l}return l},l.evaluateNURBSCurvePointWithFactors=function(e,t,n,i,r,o){var s,u,l,h=(0,a.findKnotSpan)(r,t),d=(0,c.evaluateBasisFunctions)(h,r,e,t),p=new Float64Array(3),g=0,f=3*(h-e);for(o.rangeMin=h-e,o.rangeMax=h,u=0;u<=e;++u){for(s=i[h-e+u]*d[u],o.factors[u]=s,l=0;l<3;++l)p[l]+=n[f+l]*s;g+=s,f+=3}for(u=0;u<3;++u)p[u]/=g;for(u=0;u<=e;++u)o.factors[u]/=g;return p};var E=function e(t,n,r,o,s,a,u,h,d,p,g,v,y){var m=.5*(r+s),_=(0,c.evaluateBCurvePoint)(m,t,n,u,d?h:void 0);if(v>y)g.push({offset:m,point:_});else{var E=f(_,o,a,!1),A=i.Vector3.squaredDistance(a,o),x=i.Vector3.squaredDistance(E,_);l.validControlPolygon(u)&&x<p*A?g.push({offset:m,point:_}):(e(t,n,r,o,m,_,u,h,d,p,g,v+1,y),e(t,n,m,_,s,a,u,h,d,p,g,v+1,y))}};l.renderNURBSCurve=function(e,t,n,o,s,a,u,l){var h=a||r.DEFAULT_CURVE_RESOLUTION,d=u||[t[0],t[t.length-1]];l=void 0===l||l;var p,g=v(o);if(s){var f,y,m=[];f=(0,c.evaluateBCurvePoint)(d[0],e,t,n,g?o:void 0),y=(0,c.evaluateBCurvePoint)(d[1],e,t,n,g?o:void 0),m.push({offset:d[0],point:f}),E(e,t,d[0],f,d[1],y,n,o,g,r.SPLINE_DISTANCE_TOLERANCE,m,0,4),m.push({offset:d[1],point:y}),p=new Array(4*m.length);for(var _=l?0:1,A=l?0:1;A<m.length;A++)p[_]=m[A].point[0],p[_+1]=m[A].point[1],p[_+2]=m[A].point[2],p[_+3]=m[A].offset,_+=4}else{for(var x=0,C=3;C<n.length;C+=3)x+=i.Vector3.distance([n[C-3],n[C-2],n[C-1]],[n[C],n[C+1],n[C+2]]);for(h=10*Math.round(x),l?(C=0,p=new Float32Array(3*h)):(C=1,p=new Float32Array(3*(h-1)));C<h;++C){var w,b=d[0]+(d[1]-d[0])*C/(h-1);w=(0,c.evaluateBCurvePoint)(b,e,t,n,g?o:void 0);for(var M=3*C,T=0;T<3;++T)p[M+T]=w[T]}}return p},l.evaluateCurve=function(e,t,n,i,o,s){if(o){var a=(0,c.evaluateBCurvePoint)(t[0],e,t,n,i),u=(0,c.evaluateBCurvePoint)(t[t.length-1],e,t,n,i),l=[];l.push({offset:t[0],point:a}),E(e,t,t[0],a,t[t.length-1],u,n,i,!0,r.SPLINE_DISTANCE_TOLERANCE,l,0,3),l.push({offset:t[t.length-1],point:u});for(var h=[],d=[],p=0;p<l.length;++p)h.push(l[p].offset),d.push(l[p].point[0],l[p].point[1],l[p].point[2])}else{var g=s||.01,f=t[0],v=0;h=[],d=[];do{var y=(0,c.evaluateBCurvePoint)(f,e,t,n,i);for(h[v]=f,p=0;p<3;++p)d[3*v+p]=y[p];++v,f+=g}while(f<=t[t.length-1])}return{offset:h,points:d}};var A=function(e,t,n){var i=new Float64Array(2);i[0]=n[0]-t[0],i[1]=n[1]-t[1];var r=i[0]*i[0]+i[1]*i[1];if(0===r)return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[0]*i[0]+i[1]*i[1];var o=(e[0]-t[0])*i[0]+(e[1]-t[1])*i[1];return o<0?(i[0]=e[0]-t[0],i[1]=e[1]-t[1]):o>r?(i[0]=e[0]-n[0],i[1]=e[1]-n[1]):(o/=r,i[0]=t[0]+o*i[0]-e[0],i[1]=t[1]+o*i[1]-e[1]),i[0]*i[0]+i[1]*i[1]},x=function(e,t){var n,i=!1,r=t.length;n=0;for(var o=r-3;n<r;n+=3)t[n+1]>e[1]!=t[o+1]>e[1]&&e[0]<(t[o]-t[n])*(e[1]-t[n+1])/(t[o+1]-t[n+1])+t[n]&&(i=!i),o=n;return i},C=function(e,t){for(var n,i=new Float64Array(2),r=Number.NEGATIVE_INFINITY,o=0;o<t.length;o+=3)i[0]=t[o]-e[0],i[1]=t[o+1]-e[1],(n=i[0]*i[0]+i[1]*i[1])>r&&(r=n);return r},w=function(e,t,n){for(var i,r=t.length,o=new Float64Array(2),s=new Float64Array(2),a=Number.POSITIVE_INFINITY,c=0;c<r-3;c+=3)o[0]=t[c],o[1]=t[c+1],s[0]=t[c+3],s[1]=t[c+4],(i=A(e,o,s))<a&&(a=i);return void 0!==n&&n&&(o[0]=t[r-3],o[1]=t[r-2],s[0]=t[0],s[1]=t[1],(i=A(e,o,s))<a&&(a=i)),a};l.closestSegmentsXYPlanar=function(e,t,n,i){for(var r=Number.POSITIVE_INFINITY,o=[],s=0;s<t.length;++s){var a,c=t[s],u=c.getRangeUnlimited();if(i){a=!1;for(var l=0;l<i.length;++l)if(u[1]>=i[l][0]&&u[0]<=i[l][1]){a=!0;break}}else a=!0;if(a){var h,d,p=n?n[s]:0,g=c.getControlPoints();x(e,g)?h=0:(h=w(e,g,!0),h=Math.max(0,h-p)),h<=r&&(d=C(e,g)+p,o.push({index:s,minDistSqr:h,maxDistSqr:d}),d<r&&(r=d))}}var f=[];for(s=0;s<o.length;++s)o[s].minDistSqr<=r&&f.push(o[s]);return f.sort((function(e,t){var n=e.minDistSqr-t.minDistSqr;return 0===n?e.maxDistSqr-t.maxDistSqr:n})),f},l.findKnotMultiplicity=function(e,t){for(var n=0,i=0;i<t.length;++i){if(t[i]>e+1e-8)return n;Math.abs(t[i]-e)<1e-8&&n++}return n},l.unclampCurve=function(e,t,n,i){var r,o,s,a,c,u=n.length/4-1,l=i||1;for(r=0;r<e-1;++r)for(t[e-r-1]=t[e-r]-(t[u-r+1]-t[u-r])*l,s=e-1,o=r;o>=0;--o){for(a=(t[e]-t[s])/(t[e+o+1]-t[s]),c=0;c<4;++c)n[4*o+c]=(n[4*o+c]-a*n[4*(o+1)+c])/(1-a);s-=1}for(t[0]=t[1]-(t[u-e+2]-t[u-e+1])*l,r=0;r<e-1;++r)for(t[u+r+2]=t[u+r+1]+(t[e+r+1]-t[e+r])*l,o=r;o>=0;--o)for(a=(t[u+1]-t[u-o])/(t[u-o+r+2]-t[u-o]),c=0;c<4;++c)n[4*(u-o)+c]=(n[4*(u-o)+c]-(1-a)*n[4*(u-o-1)+c])/a;t[u+e+1]=t[u+e]+(t[2*e]-t[2*e-1])*l},l.extractCurveSegment=function(e,t,n,i,r){var o=this.insertKnot(e,i,r,t,e);o=this.insertKnot(e,o.U,o.Pw,n,e);var s,c=(0,a.findKnotSpan)(t,o.U);for(i.length=o.U.length-(c-e),i[0]=t,s=1;s<i.length;++s)i[s]=o.U[s+c-e];var u=i.length-e-1,l=4*(o.Pw.length/4-u);for(r.length=o.Pw.length-l,s=0;s<r.length;++s)r[s]=o.Pw[s+l];c=(0,a.findKnotSpan)(n,i),i.length=c+1,i.push(n),r.length=4*(i.length-e-1)};var b=function(e,t,n,i){for(var r=0,o=0;o<4;++o)r+=(e[t+o]-n[i+o])*(e[t+o]-n[i+o]);return Math.sqrt(r)};l.removeKnot=function(e,t,n,i,o){if(t<=i[0]||t>=i[i.length-1])return 0;var s,c,u,l,h,d=[],p=e+1,g=(0,a.findKnotSpanAndMultiplicity)(t,i);if(g.multiplicity<1)return 0;for(var f,v,y,m,_=(2*g.span-g.multiplicity-e)/2,E=r.KERNEL_TOLERANCE,A=g.span-g.multiplicity,x=g.span-e,C=!1,w=[0,0,0,0],M=0;M<n;++M){for(f=x-1,h=0;h<4;++h)d[0+h]=o[4*f+h],d[4*(A+1-f)+h]=o[4*(A+1)+h];for(s=x,c=A,u=1,l=A-f,C=!1;c-s>M;){for(v=(t-i[s])/(i[s+p+M]-i[s]),y=(t-i[c-M])/(i[c+p]-i[c-M]),h=0;h<4;++h)d[4*u+h]=(o[4*s+h]-(1-v)*d[4*(u-1)+h])/v,d[4*l+h]=(o[4*c+h]-y*d[4*(l+1)+h])/(1-y);++s,++u,--c,--l}if(c-s<M)b(d,4*(u-1),d,4*(l+1))<=E&&(C=!0);else{for(v=(t-i[s])/(i[s+p+M]-i[s]),h=0;h<4;++h)w[h]=v*d[4*(u+M+1)+h]+(1-v)*d[4*(u-1)+h];b(o,4*s,w,0)<=E&&(C=!0)}if(!C)break;for(s=x,c=A;c-s>M;){for(h=0;h<4;++h)o[4*s+h]=d[4*(s-f)+h],o[4*c+h]=d[4*(c-f)+h];++s,--c}--x,++A}if(0===M)return 0;for(m=g.span+1;m<i.length;++m)i[m-M]=i[m];for(i.length=i.length-M,s=c=_,m=1;m<M;++m)m%2==1?s+=1:c-=1;for(m=s+1;m<o.length/4;++m){for(h=0;h<4;++h)o[4*c+h]=o[4*m+h];c+=1}return o.length=o.length-4*M,M},l.joinCurves=function(e,t,n,i,r){var o,s=t[t.length-1];for(t.length=t.length-1,o=e+1;o<i.length;++o)t.push(i[o]);for(o=4;o<r.length;++o)n.push(r[o]);var a=this.removeKnot(e,s,e-1,t,n);a!==e-1&&console.warn("Failed knot removal, only removed seam knot "+a+" times.")},l.clampCurve=function(e,t,n){var i=t[e],r=t[t.length-e-1];this.extractCurveSegment(e,i,r,t,n)},l.makePeriodic=function(e,t,n){var i,r,o=function(e,t,n){var i,r,o,s=0;for(i=1;i<n.length/4;++i){for(o=0,r=0;r<3;++r)o+=(n[4*i+r]-n[4*(i-1)+r])*(n[4*i+r]-n[4*(i-1)+r]);s+=Math.sqrt(o)}for(o=0,r=0;r<3;++r)o+=(n[r]-n[n.length-4+r])*(n[r]-n[n.length-4+r]);var a=Math.sqrt(o),c=(t[t.length-1]-t[0])/s,u=n.length/4-1,l=t.slice();for(i=0;i<e-1;++i)l[e-i-1]=l[e-i]-(l[u-i+1]-l[u-i]),l[u+i+2]=l[u+i+1]+(l[e+i+1]-l[e+i]);var h=l[1]-(l[u-e+2]-l[u-e+1]),d=l[u+e]+(l[2*e]-l[2*e-1]);return c/((t[0]-h+d-t[t.length-1])/a)}(e,t,n);this.unclampCurve(e,t,n,o);var s=t.length;for(i=e-1;i>=0;--i)t[s-i]=t[s-i-1]+(t[e-(i-1)]-t[e-i]);var a=n.length/4;for(n.length=4*a+4*e,t.length=s+e,i=0;i<e;++i){for(r=0;r<4;++r)n[4*(a+i)+r]=n[4*i+r];t[s+i]=t[s+i-1]+(t[e+i+1]-t[e+i])}this.clampCurve(e,t,n)},t.SplineCurveHelper=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateBCurveDerivs=t.evaluateBCurvePoint=t.evaluateBasisDerivatives=t.evaluateBasisFunctions=void 0;var i=n(1),r=n(3),o=n(17),s=function(){var e=null,t=null;return function(n,i,r,o){(null===e||e.length<r+1)&&(e=new Float64Array(r+1),t=new Float64Array(r+1));var s=new Float64Array(r+1);s[0]=1;for(var a=1;a<=r;++a){e[a]=i-o[n+1-a],t[a]=o[n+a]-i;for(var c=0,u=0;u<a;++u){var l=s[u]/(t[u+1]+e[a-u]);s[u]=c+t[u+1]*l,c=e[a-u]*l}s[a]=c}return s}}(),a=function(){var e=null,t=null,n=null,i=null;return function(r,o,s,a,c,u){var l,h,d;if(null===t||t.length<s+1){for(e=[new Float64Array(s+1),new Float64Array(s+1)],t=new Array(s+1),l=0;l<s+1;++l)t[l]=new Float64Array(s+1);n=new Float64Array(s+1),i=new Float64Array(s+1)}if(!u)for(u=new Array(a+1),l=0;l<=a;++l)u[l]=new Float64Array(s+1);for(t[0][0]=1,l=1;l<=s;++l){n[l]=o-c[r+1-l],i[l]=c[r+l]-o;var p=0;for(d=0;d<l;++d){t[l][d]=i[d+1]+n[l-d];var g=t[d][l-1]/t[l][d];t[d][l]=p+i[d+1]*g,p=n[l-d]*g}t[l][l]=p}for(l=0;l<=s;++l)u[0][l]=t[l][s];for(d=0;d<=s;++d){var f=0,v=1;for(e[0][0]=1,h=1;h<=a;++h){var y,m=0,_=d-h,E=s-h;for(d>=h&&(e[v][0]=e[f][0]/t[E+1][_],m=e[v][0]*t[_][E]),y=d-1<=E?h-1:s-d,l=_>=-1?1:-_;l<=y;++l)e[v][l]=(e[f][l]-e[f][l-1])/t[E+1][_+l],m+=e[v][l]*t[_+l][E];d<=E&&(e[v][h]=-e[f][h-1]/t[E+1][d],m+=e[v][h]*t[d][E]),u[h][d]=m,l=f,f=v,v=l}}for(d=s,h=1;h<=a;++h){for(l=0;l<=s;++l)u[h][l]*=d;d*=s-h}return u}}(),c=function(){var e=null,t=null;return function(n,s,c,u,l,h){var d,p,g;if(null===e||e.length<c+1){for(e=new Array(c+1),d=0;d<=c;++d)e[d]=new Float64Array(c+1);t=new Float64Array(c+1)}var f=Math.min(s,c),v=h&&h.length>0,y=(0,o.findKnotSpan)(n,u);a(y,n,c,f,u,e);var m=new Array(s+1);for(d=0;d<=s;++d)m[d]=i.Vector3.createFloat64();for(p=0;p<=f;++p){var _=3*(y-c);if(v)for(t[p]=0,d=0;d<=c;++d)g=h[y-c+d]*e[p][d],m[p][0]+=l[_]*g,m[p][1]+=l[_+1]*g,m[p][2]+=l[_+2]*g,t[p]+=g,_+=3;else for(d=0;d<=c;++d)g=e[p][d],m[p][0]+=l[_]*g,m[p][1]+=l[_+1]*g,m[p][2]+=l[_+2]*g,_+=3}if(v)for(p=0;p<=f;++p){var E=m[p];for(d=1;d<=p;++d)g=-r.binomialCoefficients[p][d]*t[d],i.Vector3.scaleAndAdd(E,E,m[p-d],g);i.Vector3.scale(E,E,1/t[0])}return m}}();t.evaluateBasisFunctions=s,t.evaluateBasisDerivatives=a,t.evaluateBCurvePoint=function(e,t,n,r,a){var c,u,l=(0,o.findKnotSpan)(e,n),h=s(l,e,t,n),d=a&&a.length>0,p=i.Vector3.createFloat64(),g=0,f=3*(l-t);if(d){for(c=0;c<=t;++c)u=a[l-t+c]*h[c],p[0]+=r[f]*u,p[1]+=r[f+1]*u,p[2]+=r[f+2]*u,g+=u,f+=3;i.Vector3.scale(p,p,1/g)}else for(c=0;c<=t;++c)u=h[c],p[0]+=r[f]*u,p[1]+=r[f+1]*u,p[2]+=r[f+2]*u,f+=3;return p},t.evaluateBCurveDerivs=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cylinder=void 0;var i=n(1),r=n(4),o=n(0),s=n(12),a=n(7),c=n(14),u=n(2),l=function(){s.Surface.call(this),this._center=i.Vector3.createFloat64(),this._radius=0,this._uScale=1,this._xAxis=i.Vector3.createFloat64(),this._yAxis=i.Vector3.createFloat64(),this._zAxis=i.Vector3.createFloat64()};(l.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.CYLINDER},l.prototype.clone=function(){var e=new l;return e.copy(this),e},l.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),this._radius=e._radius,this._uScale=e._uScale,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),i.Vector3.copy(this._zAxis,e._zAxis)},l.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._xAxis,this._zAxis)},l.prototype.set=function(e,t,n,r,s){i.Vector3.copy(this._center,e),u.ConsoleUtils.assert(t>o.KERNEL_TOLERANCE),this._radius=t,u.ConsoleUtils.assert(i.Vector3.squaredLength(n)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,n),void 0!==r&&i.Vector3.squaredLength(r)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE?(u.ConsoleUtils.assert(i.Vector3.isOrthogonal(n,r,o.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._xAxis,r)):(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._uScale=s||1,u.ConsoleUtils.assert(this._uScale>o.PARAMETER_SPACE_TOLERANCE),this._computeYAxis()},l.prototype.getRadius=function(){return this._radius},l.prototype.setRadius=function(e){u.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._radius=e},l.prototype.getCenter=function(){return this._center},l.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},l.prototype.getAxisDir=function(){return this._zAxis},l.prototype.setAxisDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,e),(i.Vector3.squaredLength(this._xAxis)<=o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE||!i.Vector3.isOrthogonal(this._xAxis,this._zAxis,o.KERNEL_ANGULAR_TOLERANCE))&&(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._computeYAxis()},l.prototype.getUvOriginDir=function(){return this._xAxis},l.prototype.setUvOriginDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,e),this._computeYAxis()},l.prototype.getUScale=function(){return this._uScale},l.prototype.setUScale=function(e){u.ConsoleUtils.assert(e>o.PARAMETER_SPACE_TOLERANCE),this._uScale=e},l.prototype.evaluatePosition=function(e,t){var n=this._radius*Math.cos(t),r=this._radius*Math.sin(t),o=this._uScale*e,s=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(s,s,this._xAxis,n),i.Vector3.scaleAndAdd(s,s,this._yAxis,r),i.Vector3.scaleAndAdd(s,s,this._zAxis,o),s},l.prototype.evaluateNormal=function(e,t){var n=Math.cos(t),r=Math.sin(t),o=i.Vector3.createFloat64();return i.Vector3.scale(o,this._xAxis,n),i.Vector3.scaleAndAdd(o,o,this._yAxis,r),o},l.prototype.evaluateDu=function(e,t){var n=i.Vector3.createFloat64();return i.Vector3.scale(n,this._zAxis,this._uScale),n},l.prototype.evaluateDv=function(e,t){var n=-this._radius*Math.sin(t),r=this._radius*Math.cos(t),o=i.Vector3.createFloat64();return i.Vector3.scale(o,this._xAxis,n),i.Vector3.scaleAndAdd(o,o,this._yAxis,r),o},l.prototype.closestParam=function(e){var t=i.Vector3.createFloat64();i.Vector3.sub(t,e,this._center);var n=i.Vector3.dot(t,this._xAxis),r=i.Vector3.dot(t,this._yAxis),s=i.Vector3.dot(t,this._zAxis)/this._uScale,a=0;return n*n+r*r>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE&&(a=Math.atan2(r,n)),{u:s,v:a}},l.prototype.vParamLine=function(e){var t=new c.Circle,n=i.Vector3.clone(this._center),r=e*this._uScale;i.Vector3.scaleAndAdd(n,n,this._zAxis,r);var o=i.Vector3.clone(this._xAxis);i.Vector3.scale(o,o,this._radius);var s=i.Vector3.clone(this._zAxis);return i.Vector3.negate(s,s),t.set(n,s,o),t},l.prototype.uParamLine=function(e){var t=new a.Line,n=i.Vector3.clone(this._center),r=this._radius*Math.cos(e),o=this._radius*Math.sin(e);return i.Vector3.scaleAndAdd(n,n,this._xAxis,r),i.Vector3.scaleAndAdd(n,n,this._yAxis,o),t.set(n,this.evaluateDu(0,e)),t},l.prototype.getBoundingBox=function(e,t){if(e){var n=e[0],i=e[1],o=this.vParamLine(n).getBoundingBox(t);return o.include(this.vParamLine(i).getBoundingBox(t)),o}return new r.BoundingBox([-1/0,-1/0,-1/0],[1/0,1/0,1/0])},l.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),i.Vector3.transformAsDirectionMatrix44(this._zAxis,this._zAxis,e);var t=i.Vector3.length(this._xAxis);this._radius*=t,this._uScale*=t,i.Vector3.normalize(this._xAxis,this._xAxis),i.Vector3.normalize(this._yAxis,this._yAxis),i.Vector3.normalize(this._zAxis,this._zAxis)},l.prototype.getRangeUnlimitedU=function(){return[-1/0,1/0]},l.prototype.getRangeUnlimitedV=function(){return[-Math.PI,Math.PI]},l.prototype.isPeriodicUnlimitedU=function(){return!1},l.prototype.isPeriodicUnlimitedV=function(){return!0},l.prototype.isClosedUnlimitedU=function(){return!1},l.prototype.isClosedUnlimitedV=function(){return!0},l.prototype.toObject=function(){var e=this.evaluatePosition(0,0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this._center),radius:this.vectorToObject(e),axis:this.vectorToObject(this.getAxisDir()),uCoordScale:this.getUScale(),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.Cylinder=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EllipticalCylinder=void 0;var i=n(1),r=n(4),o=n(0),s=n(12),a=n(7),c=n(23),u=n(2),l=function(){s.Surface.call(this),this._center=i.Vector3.createFloat64(),this._majorRadius=0,this._minorRadius=0,this._uScale=1,this._xAxis=i.Vector3.createFloat64(),this._yAxis=i.Vector3.createFloat64(),this._zAxis=i.Vector3.createFloat64()};(l.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.ELLIPTICAL_CYLINDER},l.prototype.clone=function(){var e=new l;return e.copy(this),e},l.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),this._majorRadius=e._majorRadius,this._minorRadius=e._minorRadius,this._uScale=e._uScale,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),i.Vector3.copy(this._zAxis,e._zAxis)},l.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._xAxis,this._zAxis)},l.prototype.set=function(e,t,n,r,s){i.Vector3.copy(this._center,e),this._majorRadius=i.Vector3.length(t),u.ConsoleUtils.assert(this._majorRadius>o.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,t),u.ConsoleUtils.assert(n<=1),this._minorRadius=n*this._majorRadius,u.ConsoleUtils.assert(this._minorRadius>o.KERNEL_TOLERANCE),u.ConsoleUtils.assert(i.Vector3.squaredLength(r)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),u.ConsoleUtils.assert(i.Vector3.isOrthogonal(r,t,o.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._zAxis,r),this._uScale=s||1,u.ConsoleUtils.assert(this._uScale>o.PARAMETER_SPACE_TOLERANCE),this._computeYAxis()},l.prototype.getMajorRadius=function(){return this._majorRadius},l.prototype.setMajorRadius=function(e){u.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._majorRadius=e},l.prototype.getMinorRadius=function(){return this._minorRadius},l.prototype.setMinorRadius=function(e){u.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._minorRadius=e},l.prototype.getMajorAxis=function(){return this._xAxis},l.prototype.setMajorAxis=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,e),this._computeYAxis()},l.prototype.getCenter=function(){return this._center},l.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},l.prototype.getAxisDir=function(){return this._zAxis},l.prototype.setAxisDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,e),this._computeYAxis()},l.prototype.getUScale=function(){return this._uScale},l.prototype.setUScale=function(e){u.ConsoleUtils.assert(e>o.PARAMETER_SPACE_TOLERANCE),this._uScale=e},l.prototype.evaluatePosition=function(e,t){var n=this._majorRadius*Math.cos(t),r=this._minorRadius*Math.sin(t),o=this._uScale*e,s=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(s,s,this._xAxis,n),i.Vector3.scaleAndAdd(s,s,this._yAxis,r),i.Vector3.scaleAndAdd(s,s,this._zAxis,o),s},l.prototype.evaluateNormal=function(e,t){var n=this._minorRadius*Math.cos(t),r=this._majorRadius*Math.sin(t),o=Math.sqrt(n*n+r*r),s=i.Vector3.createFloat64();return i.Vector3.scale(s,this._xAxis,n/o),i.Vector3.scaleAndAdd(s,s,this._yAxis,r/o),s},l.prototype.evaluateDu=function(e,t){var n=i.Vector3.createFloat64();return i.Vector3.scale(n,this._zAxis,this._uScale),n},l.prototype.evaluateDv=function(e,t){var n=-this._majorRadius*Math.sin(t),r=this._minorRadius*Math.cos(t),o=i.Vector3.createFloat64();return i.Vector3.scale(o,this._xAxis,n),i.Vector3.scaleAndAdd(o,o,this._yAxis,r),o},l.prototype.closestParam=function(e){var t=i.Vector3.createFloat64();i.Vector3.sub(t,e,this._center);var n=i.Vector3.dot(t,this._zAxis)/this._uScale;return{u:n,v:this.vParamLine(n).closestToPointParam(e)}},l.prototype.vParamLine=function(e){var t=new c.Ellipse,n=i.Vector3.clone(this._center),r=e*this._uScale;i.Vector3.scaleAndAdd(n,n,this._zAxis,r);var o=i.Vector3.clone(this._xAxis);i.Vector3.scale(o,o,this._majorRadius);var s=i.Vector3.clone(this._zAxis);return i.Vector3.negate(s,s),t.set(n,s,o,this._minorRadius/this._majorRadius),t},l.prototype.uParamLine=function(e){var t=new a.Line,n=i.Vector3.clone(this._center),r=this._majorRadius*Math.cos(e),o=this._minorRadius*Math.sin(e);return i.Vector3.scaleAndAdd(n,n,this._xAxis,r),i.Vector3.scaleAndAdd(n,n,this._yAxis,o),t.set(n,this.evaluateDu(0,e)),t},l.prototype.getBoundingBox=function(e,t){if(e){var n=e[0],i=e[1],o=this.vParamLine(n).getBoundingBox(t);return o.include(this.vParamLine(i).getBoundingBox(t)),o}return new r.BoundingBox([-1/0,-1/0,-1/0],[1/0,1/0,1/0])},l.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),i.Vector3.transformAsDirectionMatrix44(this._zAxis,this._zAxis,e);var t=i.Vector3.length(this._xAxis);this._majorRadius*=t,this._minorRadius*=t,this._uScale*=t,i.Vector3.normalize(this._xAxis,this._xAxis),i.Vector3.normalize(this._yAxis,this._yAxis),i.Vector3.normalize(this._zAxis,this._zAxis)},l.prototype.getRangeUnlimitedU=function(){return[-1/0,1/0]},l.prototype.getRangeUnlimitedV=function(){return[-Math.PI,Math.PI]},l.prototype.isPeriodicUnlimitedU=function(){return!1},l.prototype.isPeriodicUnlimitedV=function(){return!0},l.prototype.isClosedUnlimitedU=function(){return!1},l.prototype.isClosedUnlimitedV=function(){return!0},l.prototype.toObject=function(){var e=this.evaluatePosition(0,0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this._center),majorRadius:this.vectorToObject(e),axis:this.vectorToObject(this.getAxisDir()),uCoordScale:this.getUScale(),radiusRatio:this.getMinorRadius()/this.getMajorRadius(),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.EllipticalCylinder=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Wire=void 0;var i=n(9),r=n(4),o=n(0),s=function(){i.BaseTopology.call(this),this._wireBody=void 0,this._edges=[]};(s.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return o.TOPOLOGY_TYPES.WIRE},s.prototype.getWireBody=function(){return this._wireBody},s.prototype.setWireBody=function(e){this._wireBody=e},s.prototype.getEdges=function(){return this._edges},s.prototype.setEdges=function(e){this._edges=new Array(e.length);for(var t=0;t<e.length;++t)this._edges[t]=e[t]},s.prototype.addEdge=function(e){this._edges?this._edges.push(e):this._edges=[e],e.setWire(this),e.setCoedge(void 0)},s.prototype.addEdges=function(e){this._edges||(this._edges=[]);for(var t=0;t<e.length;++t)e[t].setWire(this),e[t].setCoedge(void 0);this._edges=this._edges.concat(e)},s.prototype.removeEdge=function(e){var t=this._edges.indexOf(e);return t>-1&&(this._edges.splice(t,1),e.getWire()===this&&e.setWire(void 0),!0)},s.prototype.getBody=function(){return this._wireBody},s.prototype.collectFaces=function(e){return e||new Set},s.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._edges.length;++t)e.add(this._edges[t]);return e},s.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._edges.length;++t)this._edges[t].collectVertices(e);return e},s.prototype.isBranched=function(){for(var e=0;e<this._edges.length;++e){var t=this._edges[e],n=t.getStartVertex(),i=t.getEndVertex();if(n===i&&n.getOtherEdge(t))return!0;if(n.getEdges().length>2||i.getEdges().length>2)return!0}return!1},s.prototype.getOrderedEdges=function(){if(0===this._edges.length)return{edges:[],start:void 0,end:void 0};var e=[];e.push(this._edges[0]);for(var t=new Set(this._edges.slice(1)),n=e[0].getStartVertex(),i=e[0].getEndVertex();t.size>0;){var r=t.size;if(t.forEach((function(r){r.getEndVertex()===n?(e.unshift(r),n=r.getStartVertex(),t.delete(r)):r.getStartVertex()===n?(e.unshift(r),n=r.getEndVertex(),t.delete(r)):r.getEndVertex()===i?(e.push(r),i=r.getStartVertex(),t.delete(r)):r.getStartVertex()===i&&(e.push(r),i=r.getEndVertex(),t.delete(r))})),r===t.size){console.warn("Wire is disconnected or branching.");break}}return{edges:e,start:n,end:i}},s.prototype.isClosed=function(){if(1===this._edges.length)return this._edges[0].getStartVertex()===this._edges[0].getEndVertex();for(var e=this._edges[0],t=void 0,n=0;n<this._edges.length;++n){var i,r=e.getStartVertex(),o=e.getEndVertex();if(r===o||2!==r.getEdges().length||2!==o.getEdges().length)return!1;if(t&&r.getOtherEdge(e)!==t){if(o.getOtherEdge(e)!==t)return!1;i=r.getOtherEdge(e)}else i=o.getOtherEdge(e);t=e,e=i}return e===this._edges[0]},s.prototype.getBoundingBox=function(){for(var e=new r.BoundingBox,t=0;t<this._edges.length;++t)e.include(this._edges[t].getBoundingBox());return e},s.prototype.toString=function(){return"Wire"},s.prototype.toObject=function(){return{edges:this.refsToStrings(this._edges),attributes:this.refsToStrings(this._attributes)}},s.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._edges,this._attributes])},t.Wire=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgenitorMap=void 0;var i=n(0),r=n(2),o=function(){this._newToOldMap=new Map,this._oldToNewMap=new Map,this._labelMap=new Map};o.prototype.addEntry=function(e,t,n){t=Array.from(new Set(t)),r.ConsoleUtils.assert(!this._newToOldMap.has(e)),this._newToOldMap.set(e,t),n&&this._labelMap.set(e,n);for(var i=0;i<t.length;i++){var o=t[i],s=this._oldToNewMap.get(o);s?s.indexOf(e)<0&&s.push(e):this._oldToNewMap.set(o,[e])}},o.prototype.hasEntry=function(e){return this._newToOldMap.has(e)},o.prototype.removeEntry=function(e){var t=this._newToOldMap.get(e);if(t){this._newToOldMap.delete(e),this._labelMap.delete(e);for(var n=0;n<t.length;n++){var i=this._oldToNewMap.get(t[n]),o=i.indexOf(e);r.ConsoleUtils.assert(o>=0),i.splice(o,1),0===i.length&&this._oldToNewMap.delete(t[n])}}},o.prototype.size=function(){return this._newToOldMap.size},o.prototype.getProgenitors=function(e){return this._newToOldMap.get(e)},o.prototype.getDescendants=function(e){return this._oldToNewMap.get(e)||[]},o.prototype.getLabel=function(e){return this._labelMap.get(e)||""},o.prototype.getAllNewTopology=function(){return Array.from(this._newToOldMap.keys())},o.prototype.getAllOldTopology=function(){return Array.from(this._oldToNewMap.keys())},o.prototype.clear=function(){this._newToOldMap.clear(),this._oldToNewMap.clear(),this._labelMap.clear()},o.prototype.mergeMaps=function(e){var t=new o,n=new Set(this._newToOldMap.keys());return e._newToOldMap.keys().forEach((function(e){n.add(e)})),n.forEach((function(n){var i=this.getProgenitors(n)||[],r=e.getProgenitors(n)||[],o=this.getLabel(n)||e.getLabel(n);t.addEntry(n,i.concat(r),o)})),t},o.prototype.collapseMaps=function(e,t){var n=!1,i=!1;t&&(void 0!==t.keepIntermediates&&(n=t.keepIntermediates),void 0!==t.keepAllDescendants&&(i=t.keepAllDescendants));var r=new o,s=void 0;return i&&(s=new Set(e._newToOldMap.keys())),this._newToOldMap.forEach((function(t,o){for(var a=new Set,c=0;c<t.length;c++){var u=t[c],l=e.getProgenitors(u);l&&l.length>0?(l.forEach((function(e){a.add(e)})),n&&a.add(u)):a.add(u),i&&s.delete(u)}r.addEntry(o,Array.from(a))})),i&&s.forEach((function(t){var n=e.getProgenitors(t);r.hasEntry(t)&&(n=n.concat(r.getProgenitors(t)),r.removeEntry(t)),r.addEntry(t,n)})),r},o.prototype.toString=function(){for(var e="ProgenitorMap:\n",t=this.getAllNewTopology(),n=0;n<t.length;n++){var r=t[n];e+=i.TOPOLOGY_TYPES.toString(r.getTopologyType())+":"+r.getGuid();var o=this.getLabel(r);o&&(e+=" '"+o+"'"),e+=" -> [ ";for(var s=this.getProgenitors(r),a=0;a<s.length;a++)a>0&&(e+=", "),e+=i.TOPOLOGY_TYPES.toString(s[a].getTopologyType())+":"+s[a].getGuid();e+=" ]\n"}return e},t.ProgenitorMap=o},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o})),n.d(t,"VERSION",(function(){return i.VERSION})),n.d(t,"iteratee",(function(){return i.iteratee})),n.d(t,"restArguments",(function(){return i.restArguments})),n.d(t,"each",(function(){return i.each})),n.d(t,"forEach",(function(){return i.forEach})),n.d(t,"map",(function(){return i.map})),n.d(t,"collect",(function(){return i.collect})),n.d(t,"reduce",(function(){return i.reduce})),n.d(t,"foldl",(function(){return i.foldl})),n.d(t,"inject",(function(){return i.inject})),n.d(t,"reduceRight",(function(){return i.reduceRight})),n.d(t,"foldr",(function(){return i.foldr})),n.d(t,"find",(function(){return i.find})),n.d(t,"detect",(function(){return i.detect})),n.d(t,"filter",(function(){return i.filter})),n.d(t,"select",(function(){return i.select})),n.d(t,"reject",(function(){return i.reject})),n.d(t,"every",(function(){return i.every})),n.d(t,"all",(function(){return i.all})),n.d(t,"some",(function(){return i.some})),n.d(t,"any",(function(){return i.any})),n.d(t,"contains",(function(){return i.contains})),n.d(t,"includes",(function(){return i.includes})),n.d(t,"include",(function(){return i.include})),n.d(t,"invoke",(function(){return i.invoke})),n.d(t,"pluck",(function(){return i.pluck})),n.d(t,"where",(function(){return i.where})),n.d(t,"findWhere",(function(){return i.findWhere})),n.d(t,"max",(function(){return i.max})),n.d(t,"min",(function(){return i.min})),n.d(t,"shuffle",(function(){return i.shuffle})),n.d(t,"sample",(function(){return i.sample})),n.d(t,"sortBy",(function(){return i.sortBy})),n.d(t,"groupBy",(function(){return i.groupBy})),n.d(t,"indexBy",(function(){return i.indexBy})),n.d(t,"countBy",(function(){return i.countBy})),n.d(t,"toArray",(function(){return i.toArray})),n.d(t,"size",(function(){return i.size})),n.d(t,"partition",(function(){return i.partition})),n.d(t,"first",(function(){return i.first})),n.d(t,"head",(function(){return i.head})),n.d(t,"take",(function(){return i.take})),n.d(t,"initial",(function(){return i.initial})),n.d(t,"last",(function(){return i.last})),n.d(t,"rest",(function(){return i.rest})),n.d(t,"tail",(function(){return i.tail})),n.d(t,"drop",(function(){return i.drop})),n.d(t,"compact",(function(){return i.compact})),n.d(t,"flatten",(function(){return i.flatten})),n.d(t,"without",(function(){return i.without})),n.d(t,"uniq",(function(){return i.uniq})),n.d(t,"unique",(function(){return i.unique})),n.d(t,"union",(function(){return i.union})),n.d(t,"intersection",(function(){return i.intersection})),n.d(t,"difference",(function(){return i.difference})),n.d(t,"unzip",(function(){return i.unzip})),n.d(t,"zip",(function(){return i.zip})),n.d(t,"object",(function(){return i.object})),n.d(t,"findIndex",(function(){return i.findIndex})),n.d(t,"findLastIndex",(function(){return i.findLastIndex})),n.d(t,"sortedIndex",(function(){return i.sortedIndex})),n.d(t,"indexOf",(function(){return i.indexOf})),n.d(t,"lastIndexOf",(function(){return i.lastIndexOf})),n.d(t,"range",(function(){return i.range})),n.d(t,"chunk",(function(){return i.chunk})),n.d(t,"bind",(function(){return i.bind})),n.d(t,"partial",(function(){return i.partial})),n.d(t,"bindAll",(function(){return i.bindAll})),n.d(t,"memoize",(function(){return i.memoize})),n.d(t,"delay",(function(){return i.delay})),n.d(t,"defer",(function(){return i.defer})),n.d(t,"throttle",(function(){return i.throttle})),n.d(t,"debounce",(function(){return i.debounce})),n.d(t,"wrap",(function(){return i.wrap})),n.d(t,"negate",(function(){return i.negate})),n.d(t,"compose",(function(){return i.compose})),n.d(t,"after",(function(){return i.after})),n.d(t,"before",(function(){return i.before})),n.d(t,"once",(function(){return i.once})),n.d(t,"keys",(function(){return i.keys})),n.d(t,"allKeys",(function(){return i.allKeys})),n.d(t,"values",(function(){return i.values})),n.d(t,"mapObject",(function(){return i.mapObject})),n.d(t,"pairs",(function(){return i.pairs})),n.d(t,"invert",(function(){return i.invert})),n.d(t,"functions",(function(){return i.functions})),n.d(t,"methods",(function(){return i.methods})),n.d(t,"extend",(function(){return i.extend})),n.d(t,"extendOwn",(function(){return i.extendOwn})),n.d(t,"assign",(function(){return i.assign})),n.d(t,"findKey",(function(){return i.findKey})),n.d(t,"pick",(function(){return i.pick})),n.d(t,"omit",(function(){return i.omit})),n.d(t,"defaults",(function(){return i.defaults})),n.d(t,"create",(function(){return i.create})),n.d(t,"clone",(function(){return i.clone})),n.d(t,"tap",(function(){return i.tap})),n.d(t,"isMatch",(function(){return i.isMatch})),n.d(t,"isEqual",(function(){return i.isEqual})),n.d(t,"isEmpty",(function(){return i.isEmpty})),n.d(t,"isElement",(function(){return i.isElement})),n.d(t,"isArray",(function(){return i.isArray})),n.d(t,"isObject",(function(){return i.isObject})),n.d(t,"isArguments",(function(){return i.isArguments})),n.d(t,"isFunction",(function(){return i.isFunction})),n.d(t,"isString",(function(){return i.isString})),n.d(t,"isNumber",(function(){return i.isNumber})),n.d(t,"isDate",(function(){return i.isDate})),n.d(t,"isRegExp",(function(){return i.isRegExp})),n.d(t,"isError",(function(){return i.isError})),n.d(t,"isSymbol",(function(){return i.isSymbol})),n.d(t,"isMap",(function(){return i.isMap})),n.d(t,"isWeakMap",(function(){return i.isWeakMap})),n.d(t,"isSet",(function(){return i.isSet})),n.d(t,"isWeakSet",(function(){return i.isWeakSet})),n.d(t,"isFinite",(function(){return i.isFinite})),n.d(t,"isNaN",(function(){return i.isNaN})),n.d(t,"isBoolean",(function(){return i.isBoolean})),n.d(t,"isNull",(function(){return i.isNull})),n.d(t,"isUndefined",(function(){return i.isUndefined})),n.d(t,"has",(function(){return i.has})),n.d(t,"identity",(function(){return i.identity})),n.d(t,"constant",(function(){return i.constant})),n.d(t,"noop",(function(){return i.noop})),n.d(t,"property",(function(){return i.property})),n.d(t,"propertyOf",(function(){return i.propertyOf})),n.d(t,"matcher",(function(){return i.matcher})),n.d(t,"matches",(function(){return i.matches})),n.d(t,"times",(function(){return i.times})),n.d(t,"random",(function(){return i.random})),n.d(t,"now",(function(){return i.now})),n.d(t,"escape",(function(){return i.escape})),n.d(t,"unescape",(function(){return i.unescape})),n.d(t,"result",(function(){return i.result})),n.d(t,"uniqueId",(function(){return i.uniqueId})),n.d(t,"templateSettings",(function(){return i.templateSettings})),n.d(t,"template",(function(){return i.template})),n.d(t,"chain",(function(){return i.chain})),n.d(t,"mixin",(function(){return i.mixin}));var i=n(29),r=Object(i.mixin)(i);r._=r;var o=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseGeometry=void 0;var i=n(44),r=n(0),o=function(){i.Base.call(this)};(o.prototype=Object.create(i.Base.prototype)).getGeometryType=function(){console.warn("BaseGeometry.getGeometryType : abstract method invoked!")},o.prototype.clone=function(){console.warn("BaseGeometry.clone : abstract method invoked")},o.prototype.copy=function(e){this._guid=""},o.prototype.addToModelObject=function(e){if(!e.geometries[this.getGuid()]){var t={};t[r.GEOMETRY_TYPES.toString(this.getGeometryType()).toLowerCase()]=this.toObject(),e.geometries[this.getGuid()]=t}},t.BaseGeometry=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Base=void 0;var i=n(56),r=n(45).Autodesk.lookup("SolidDef.paramrange_1_0_0.typeEnum"),o=function(){this._guid=""};o.prototype.setGuid=function(e){this._guid=e},o.prototype.getGuid=function(){return this._guid||(this._guid=(0,i.generateGUID)()),this._guid},o.prototype.refsToStrings=function(e){if(e){for(var t=new Array(e.length),n=0;n<e.length;++n)t[n]=e[n].getGuid();return t}return[]},o.prototype.refToString=function(e){return e?e.getGuid():""},o.prototype.toObject=function(){return console.warn("Base.toObject : abstract method invoked!"),{}},o.prototype.vectorToObject=function(e){return{x:e[0],y:e[1],z:e[2]}},o.prototype.rangeToObject=function(e,t){var n=1,i=0;t&&void 0!==e&&2===e.length&&isFinite(e[0])&&isFinite(e[1])&&(n=e[0],i=e[1]);var o=n<=i?"finite":"infinite";return{low:n,high:i,type:r.values[o]}},o.prototype.addToModelObject=function(e){console.warn("Base.addToModelObject : abstract method invoked!")},t.Base=o},function(e,t,n){"use strict";var i=n(87),r=(i.roots.default||(i.roots.default=new i.Root)).addJSON({Autodesk:{nested:{SolidDef:{nested:{SolidDef_grpc:{methods:{}},point3d_1_0_0:{fields:{x:{type:"double",id:1},y:{type:"double",id:2},z:{type:"double",id:3}}},vector3d_1_0_0:{fields:{x:{type:"double",id:1},y:{type:"double",id:2},z:{type:"double",id:3}}},geometry_1_0_0:{fields:{}},geometry_1_0_0_Type:{oneofs:{geometry:{oneof:["point","bsurface","cone","cylinder","ellipticalcone","ellipticalcylinder","plane","sphere","surface","torus","bcurve","circle","curve","ellipse","line"]}},fields:{point:{type:"point_1_0_0",id:1},bsurface:{type:"bsurface_1_0_0",id:2},cone:{type:"cone_1_0_0",id:3},cylinder:{type:"cylinder_1_0_0",id:4},ellipticalcone:{type:"ellipticalcone_1_0_0",id:5},ellipticalcylinder:{type:"ellipticalcylinder_1_0_0",id:6},plane:{type:"plane_1_0_0",id:7},sphere:{type:"sphere_1_0_0",id:8},surface:{type:"surface_1_0_0",id:9},torus:{type:"torus_1_0_0",id:10},bcurve:{type:"bcurve_1_0_0",id:11},circle:{type:"circle_1_0_0",id:12},curve:{type:"curve_1_0_0",id:13},ellipse:{type:"ellipse_1_0_0",id:14},line:{type:"line_1_0_0",id:15}}},paramrange_1_0_0:{fields:{low:{type:"double",id:1},high:{type:"double",id:2},type:{type:"typeEnum",id:3}},nested:{typeEnum:{values:{infinite:0,finite:1,boundBelow:2,boundAbove:3}}}},point_1_0_0:{fields:{position:{type:"point3d_1_0_0",id:1}}},bsurface_1_0_0:{fields:{uDegree:{type:"uint32",id:1},vDegree:{type:"uint32",id:2},uKnots:{rule:"repeated",type:"double",id:3},vKnots:{rule:"repeated",type:"double",id:4},controlPoints:{rule:"repeated",type:"double",id:5},weights:{rule:"repeated",type:"double",id:6},uRange:{type:"paramrange_1_0_0",id:7},vRange:{type:"paramrange_1_0_0",id:8}}},cone_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},axis:{type:"vector3d_1_0_0",id:2},radius:{type:"vector3d_1_0_0",id:3},angle:{type:"double",id:4},uCoordScale:{type:"double",id:5},uRange:{type:"paramrange_1_0_0",id:6},vRange:{type:"paramrange_1_0_0",id:7}}},cylinder_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},axis:{type:"vector3d_1_0_0",id:2},radius:{type:"vector3d_1_0_0",id:3},uCoordScale:{type:"double",id:4},uRange:{type:"paramrange_1_0_0",id:5},vRange:{type:"paramrange_1_0_0",id:6}}},ellipticalcone_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},axis:{type:"vector3d_1_0_0",id:2},majorRadius:{type:"vector3d_1_0_0",id:3},radiusRatio:{type:"double",id:4},angle:{type:"double",id:5},uCoordScale:{type:"double",id:6},uRange:{type:"paramrange_1_0_0",id:7},vRange:{type:"paramrange_1_0_0",id:8}}},ellipticalcylinder_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},axis:{type:"vector3d_1_0_0",id:2},majorRadius:{type:"vector3d_1_0_0",id:3},radiusRatio:{type:"double",id:4},uCoordScale:{type:"double",id:5},uRange:{type:"paramrange_1_0_0",id:6},vRange:{type:"paramrange_1_0_0",id:7}}},plane_1_0_0:{fields:{origin:{type:"point3d_1_0_0",id:1},normal:{type:"vector3d_1_0_0",id:2},uAxis:{type:"vector3d_1_0_0",id:3},uRange:{type:"paramrange_1_0_0",id:4},vRange:{type:"paramrange_1_0_0",id:5}}},sphere_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},radius:{type:"vector3d_1_0_0",id:2},axis:{type:"vector3d_1_0_0",id:3},uRange:{type:"paramrange_1_0_0",id:4},vRange:{type:"paramrange_1_0_0",id:5}}},surface_1_0_0:{fields:{uRange:{type:"paramrange_1_0_0",id:1},vRange:{type:"paramrange_1_0_0",id:2}}},surface_1_0_0_Type:{oneofs:{surface:{oneof:["bsurface","cone","cylinder","ellipticalcone","ellipticalcylinder","plane","sphere","torus"]}},fields:{bsurface:{type:"bsurface_1_0_0",id:1},cone:{type:"cone_1_0_0",id:2},cylinder:{type:"cylinder_1_0_0",id:3},ellipticalcone:{type:"ellipticalcone_1_0_0",id:4},ellipticalcylinder:{type:"ellipticalcylinder_1_0_0",id:5},plane:{type:"plane_1_0_0",id:6},sphere:{type:"sphere_1_0_0",id:7},torus:{type:"torus_1_0_0",id:8}}},torus_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},axis:{type:"vector3d_1_0_0",id:2},majorRadius:{type:"double",id:3},minorRadius:{type:"double",id:4},coordAxis:{type:"vector3d_1_0_0",id:5},lemon:{type:"bool",id:6},uRange:{type:"paramrange_1_0_0",id:7},vRange:{type:"paramrange_1_0_0",id:8}}},bcurve_1_0_0:{fields:{degree:{type:"uint32",id:1},knots:{rule:"repeated",type:"double",id:2},controlPoints:{rule:"repeated",type:"double",id:3},weights:{rule:"repeated",type:"double",id:4},range:{type:"paramrange_1_0_0",id:5}}},circle_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},normal:{type:"vector3d_1_0_0",id:2},radius:{type:"vector3d_1_0_0",id:3},range:{type:"paramrange_1_0_0",id:4}}},curve_1_0_0:{fields:{range:{type:"paramrange_1_0_0",id:1}}},curve_1_0_0_Type:{oneofs:{curve:{oneof:["bcurve","circle","ellipse","line"]}},fields:{bcurve:{type:"bcurve_1_0_0",id:1},circle:{type:"circle_1_0_0",id:2},ellipse:{type:"ellipse_1_0_0",id:3},line:{type:"line_1_0_0",id:4}}},ellipse_1_0_0:{fields:{center:{type:"point3d_1_0_0",id:1},normal:{type:"vector3d_1_0_0",id:2},majorRadius:{type:"vector3d_1_0_0",id:3},radiusRatio:{type:"double",id:4},range:{type:"paramrange_1_0_0",id:5}}},line_1_0_0:{fields:{position:{type:"point3d_1_0_0",id:1},direction:{type:"vector3d_1_0_0",id:2},range:{type:"paramrange_1_0_0",id:3}}},attribute_1_0_0:{fields:{}},attribute_1_0_0_Type:{oneofs:{attribute:{oneof:["nmiattribute","nmiattributearr","nmiattributestr","textattribute"]}},fields:{nmiattribute:{type:"nmiattribute_1_0_0",id:1},nmiattributearr:{type:"nmiattributearr_1_0_0",id:4},nmiattributestr:{type:"nmiattributestr_1_0_0",id:2},textattribute:{type:"textattribute_1_0_0",id:3}}},body_1_0_0:{fields:{lumps:{rule:"repeated",type:"string",id:1},attributes:{rule:"repeated",type:"string",id:2}}},coedge_1_0_0:{fields:{edge:{type:"string",id:1},partner:{type:"string",id:2},reversed:{type:"bool",id:3},attributes:{rule:"repeated",type:"string",id:4}}},edge_1_0_0:{fields:{vertex0:{type:"string",id:1},vertex1:{type:"string",id:2},precision:{type:"double",id:3},range:{type:"paramrange_1_0_0",id:4},reversed:{type:"bool",id:5},geometry:{type:"string",id:6},attributes:{rule:"repeated",type:"string",id:7}}},face_1_0_0:{fields:{loops:{rule:"repeated",type:"string",id:1},reversed:{type:"bool",id:2},geometry:{type:"string",id:3},attributes:{rule:"repeated",type:"string",id:4}}},loop_1_0_0:{fields:{coedges:{rule:"repeated",type:"string",id:1},attributes:{rule:"repeated",type:"string",id:2}}},lump_1_0_0:{fields:{shells:{rule:"repeated",type:"string",id:1},attributes:{rule:"repeated",type:"string",id:2}}},model_1_0_0:{fields:{geometries:{keyType:"string",type:"geometry_1_0_0_Type",id:1},topologies:{keyType:"string",type:"topology_1_0_0_Type",id:2},attributes:{keyType:"string",type:"attribute_1_0_0_Type",id:3}}},shell_1_0_0:{fields:{faces:{rule:"repeated",type:"string",id:1},attributes:{rule:"repeated",type:"string",id:2}}},topology_1_0_0:{fields:{attributes:{rule:"repeated",type:"string",id:1}}},topology_1_0_0_Type:{oneofs:{topology:{oneof:["body","coedge","edge","face","loop","lump","shell","vertex","wire","wirebody"]}},fields:{body:{type:"body_1_0_0",id:1},coedge:{type:"coedge_1_0_0",id:2},edge:{type:"edge_1_0_0",id:3},face:{type:"face_1_0_0",id:4},loop:{type:"loop_1_0_0",id:5},lump:{type:"lump_1_0_0",id:6},shell:{type:"shell_1_0_0",id:7},vertex:{type:"vertex_1_0_0",id:8},wire:{type:"wire_1_0_0",id:9},wirebody:{type:"wirebody_1_0_0",id:10}}},vertex_1_0_0:{fields:{precision:{type:"double",id:1},geometry:{type:"string",id:2},attributes:{rule:"repeated",type:"string",id:3}}},wire_1_0_0:{fields:{edges:{rule:"repeated",type:"string",id:1},attributes:{rule:"repeated",type:"string",id:2}}},wirebody_1_0_0:{fields:{wires:{rule:"repeated",type:"string",id:1},attributes:{rule:"repeated",type:"string",id:2}}},nmiattribute_1_0_0:{fields:{primaryId:{type:"uint64",id:1},secondaryId:{type:"int64",id:2},approachId:{type:"int64",id:3},operationIds:{rule:"repeated",type:"int64",id:4}}},nmiattributearr_1_0_0:{fields:{tagInfo:{rule:"repeated",type:"nmiattributestr_1_0_0",id:1}}},nmiattributestr_1_0_0:{fields:{primaryId:{type:"string",id:1},secondaryId:{type:"string",id:2},approachId:{type:"string",id:3},operationIds:{rule:"repeated",type:"string",id:4}}},textattribute_1_0_0:{fields:{text:{type:"string",id:1}}},entity:{oneofs:{entity:{oneof:["point3d","vector3d","geometry","paramrange","point","bsurface","cone","cylinder","ellipticalcone","ellipticalcylinder","plane","sphere","surface","torus","bcurve","circle","curve","ellipse","line","attribute","body","coedge","edge","face","loop","lump","model","shell","topology","vertex","wire","wirebody","nmiattribute","nmiattributearr","nmiattributestr","textattribute"]}},fields:{id:{type:"string",id:1},point3d:{type:"point3d_1_0_0",id:2},vector3d:{type:"vector3d_1_0_0",id:3},geometry:{type:"geometry_1_0_0",id:4},paramrange:{type:"paramrange_1_0_0",id:5},point:{type:"point_1_0_0",id:6},bsurface:{type:"bsurface_1_0_0",id:7},cone:{type:"cone_1_0_0",id:8},cylinder:{type:"cylinder_1_0_0",id:9},ellipticalcone:{type:"ellipticalcone_1_0_0",id:10},ellipticalcylinder:{type:"ellipticalcylinder_1_0_0",id:11},plane:{type:"plane_1_0_0",id:12},sphere:{type:"sphere_1_0_0",id:13},surface:{type:"surface_1_0_0",id:14},torus:{type:"torus_1_0_0",id:15},bcurve:{type:"bcurve_1_0_0",id:16},circle:{type:"circle_1_0_0",id:17},curve:{type:"curve_1_0_0",id:18},ellipse:{type:"ellipse_1_0_0",id:19},line:{type:"line_1_0_0",id:20},attribute:{type:"attribute_1_0_0",id:21},body:{type:"body_1_0_0",id:22},coedge:{type:"coedge_1_0_0",id:23},edge:{type:"edge_1_0_0",id:24},face:{type:"face_1_0_0",id:25},loop:{type:"loop_1_0_0",id:26},lump:{type:"lump_1_0_0",id:27},model:{type:"model_1_0_0",id:28},shell:{type:"shell_1_0_0",id:29},topology:{type:"topology_1_0_0",id:30},vertex:{type:"vertex_1_0_0",id:31},wire:{type:"wire_1_0_0",id:32},wirebody:{type:"wirebody_1_0_0",id:33},nmiattribute:{type:"nmiattribute_1_0_0",id:34},nmiattributearr:{type:"nmiattributearr_1_0_0",id:37},nmiattributestr:{type:"nmiattributestr_1_0_0",id:35},textattribute:{type:"textattribute_1_0_0",id:36}}}}}}}});e.exports=r},function(e,t,n){"use strict";e.exports=l;var i,r=n(10),o=r.LongBits,s=r.base64,a=r.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function u(){}function l(){this.len=0,this.head=new c(u,0,0),this.tail=this.head,this.states=null}function h(e,t,n){t[n]=255&e}function d(e,t){this.len=e,this.next=void 0,this.val=t}function p(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function g(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}l.create=r.Buffer?function(){return(l.create=function(){return new i})()}:function(){return new l},l.alloc=function(e){return new r.Array(e)},r.Array!==Array&&(l.alloc=r.pool(l.alloc,r.Array.prototype.subarray)),l.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},d.prototype=Object.create(c.prototype),d.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},l.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new d((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},l.prototype.int32=function(e){return e<0?this._push(p,10,o.fromNumber(e)):this.uint32(e)},l.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},l.prototype.uint64=function(e){var t=o.from(e);return this._push(p,t.length(),t)},l.prototype.int64=l.prototype.uint64,l.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(p,t.length(),t)},l.prototype.bool=function(e){return this._push(h,1,e?1:0)},l.prototype.fixed32=function(e){return this._push(g,4,e>>>0)},l.prototype.sfixed32=l.prototype.fixed32,l.prototype.fixed64=function(e){var t=o.from(e);return this._push(g,4,t.lo)._push(g,4,t.hi)},l.prototype.sfixed64=l.prototype.fixed64,l.prototype.float=function(e){return this._push(r.float.writeFloatLE,4,e)},l.prototype.double=function(e){return this._push(r.float.writeDoubleLE,8,e)};var f=r.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};l.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(h,1,0);if(r.isString(e)){var n=l.alloc(t=s.length(e));s.decode(e,n,0),e=n}return this.uint32(t)._push(f,t,e)},l.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(h,1,0)},l.prototype.fork=function(){return this.states=new function(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}(this),this.head=this.tail=new c(u,0,0),this.len=0,this},l.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(u,0,0),this.len=0),this},l.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},l.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},l._configure=function(e){i=e}},function(e,t,n){"use strict";e.exports=c;var i,r=n(10),o=r.LongBits,s=r.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")};function l(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new o(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}c.create=r.Buffer?function(e){return(c.create=function(e){return r.Buffer.isBuffer(e)?new i(e):u(e)})(e)}:u,c.prototype._slice=r.Array.prototype.subarray||r.Array.prototype.slice,c.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return e}}(),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return h(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|h(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=r.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=r.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},c.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){i=e;var t=r.Long?"toLong":"toNumber";r.merge(c.prototype,{int64:function(){return l.call(this)[t](!1)},uint64:function(){return l.call(this)[t](!0)},sint64:function(){return l.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},function(e,t,n){"use strict";e.exports=s;var i=n(21);((s.prototype=Object.create(i.prototype)).constructor=s).className="OneOf";var r=n(22),o=n(5);function s(e,t,n,r){if(Array.isArray(t)||(n=t,t=void 0),i.call(this,e,n),void 0!==t&&!Array.isArray(t))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=r}function a(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}s.fromJSON=function(e,t){return new s(e,t.oneof,t.options,t.comment)},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},s.prototype.add=function(e){if(!(e instanceof r))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,a(this),this},s.prototype.remove=function(e){if(!(e instanceof r))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},s.prototype.onAdd=function(e){i.prototype.onAdd.call(this,e);for(var t=0;t<this.oneof.length;++t){var n=e.get(this.oneof[t]);n&&!n.partOf&&(n.partOf=this,this.fieldsArray.push(n))}a(this)},s.prototype.onRemove=function(e){for(var t,n=0;n<this.fieldsArray.length;++n)(t=this.fieldsArray[n]).parent&&t.parent.remove(t);i.prototype.onRemove.call(this,e)},s.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,n){o.decorateType(t.constructor).add(new s(n,e)),Object.defineProperty(t,n,{get:o.oneOfGetter(e),set:o.oneOfSetter(e)})}}},function(e,t,n){"use strict";e.exports=r;var i=n(10);function r(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)this[t[n]]=e[t[n]]}r.create=function(e){return this.$type.create(e)},r.encode=function(e,t){return this.$type.encode(e,t)},r.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},r.decode=function(e){return this.$type.decode(e)},r.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},r.verify=function(e){return this.$type.verify(e)},r.fromObject=function(e){return this.$type.fromObject(e)},r.toObject=function(e,t){return this.$type.toObject(e,t)},r.prototype.toJSON=function(){return this.$type.toObject(this,i.toJSONOptions)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TessellationCache=t.CurveTessellator=void 0;var i=n(1),r=n(0),o=n(3),s=n(8),a={getCircularArcRenderPoints:function(e,t,n,i,r){var o=e.getRadius(),s=2*Math.acos((o-n)/o),a=t[1]-t[0],c=Math.ceil(a/s),u=0;for(!1===i&&u++;u<=c;++u){var l=u/c,h=t[0]*(1-l)+t[1]*l;r.push(e.evaluatePosition(h))}return o*(1-Math.cos(a/c*.5))},getAdaptiveRenderPoints:function(e,t,n,o){for(var a=t||.001,c=a*a,u=[],l=[],h=i.Vector3.createFloat64(),d=0,p=function t(n,o,a,p,g){var f=a-n,v=.5*(n+a),y=e.evaluatePosition(v);i.Vector3.scaleAndAdd(h,[0,0,0],o,.5),i.Vector3.scaleAndAdd(h,h,p,.5);var m=i.Vector3.squaredDistance(h,y);if(g>64)s.DebugUtils.warn("Max recursion depth reach in getAdaptiveRenderPoints");else if(f>10*r.PARAMETER_SPACE_TOLERANCE&&m>c)return t(n,o,v,y,g+1),void t(v,y,a,p,g+1);d=Math.max(d,m),u.push(o),l.push(n)},g=o||function(e,t,n){for(var i=new Array(7),r=t,o=(n-t)/6,s=0;s<7;s++){var a=r;s>0&&s<6&&(a+=Math.sin(s)*o*.1),i[s]=a,r+=o}return i}(0,n[0],n[1]),f=0;f<g.length-1;++f){var v=g[f],y=g[f+1],m=e.evaluatePosition(v),_=e.evaluatePosition(y);p(v,m,y,_,0),f===g.length-2&&(u.push(_),l.push(y))}return{positions:u,params:l,tolerance:Math.sqrt(d)}}},c=function(){this._hasDirtyTessellation=!0,this._tessellationCache=void 0,this._trimmedTessellationCache={positions:void 0,offsets:void 0,transitions:[1,-1]}};c.prototype.setDirty=function(e){this._hasDirtyTessellation=e},c.prototype.isDirty=function(){return this._hasDirtyTessellation},c.prototype.reset=function(){this._hasDirtyTessellation=!0,this._tessellationCache=void 0,this._trimmedTessellationCache={positions:void 0,offsets:void 0,transitions:[1,-1]}},c.prototype.setCache=function(e){this._tessellationCache=e,this._hasDirtyTessellation=!1},c.prototype.getCache=function(){return this._tessellationCache},c.prototype.getTolerance=function(){if(this._tessellationCache)return this._tessellationCache.tolerance},c.prototype.getTessellation=function(e,t,n,s){var a=!1;if(!1===this._hasDirtyTessellation&&this._tessellationCache.tolerance>n+i.FLOAT64_TOLERANCE&&(this._hasDirtyTessellation=!0),this._hasDirtyTessellation){this._hasDirtyTessellation=!1;var c=s(n);this._tessellationCache={positions:c.positions,params:c.params,tolerance:c.tolerance},a=c.didRetessellate}var u=[e[0],e[e.length-1]],l=0,h=t.getRangeUnlimited();t.isPeriodicUnlimited()&&(l=(u=(0,o.normalizeParametricRangeToShiftedRange)(u,h))[0]-e[0]);var d=this._trimmedTessellationCache,p=d.transitions[0]-u[0],g=d.transitions[d.transitions.length-1]-u[1],f=p*p+g*g<i.FLOAT64_TOLERANCE;if(f&&e.length>2){f=d.transitions.length===e.length;for(var v=1;f&&v<e.length-1;++v)f=d.transitions[v-1]===e[v-1]+l}if(!f||a){var y;for(d.transitions.length=e.length,y=0;y<e.length;++y)d.transitions[y]=e[y]+l;d.positions=[t.evaluatePosition(e[0])],d.offsets=[0];var m,_,E=1,A=u[0];for(y=1;y<e.length;y++){var x=e[y]+l;for(_=0;_<this._tessellationCache.positions.length;_++)if((m=this._tessellationCache.params[_])>A+r.PARAMETER_SPACE_TOLERANCE){if(m>=x-r.PARAMETER_SPACE_TOLERANCE)break;i.Vector3.sqrDist(d.positions[E-1],this._tessellationCache.positions[_])>r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE&&(d.positions[E++]=i.Vector3.clone(this._tessellationCache.positions[_]))}if(t.isPeriodicUnlimited()&&x>h[1])for(_=1;_<this._tessellationCache.positions.length&&(m=this._tessellationCache.params[_])<x-(h[1]-h[0])-r.PARAMETER_SPACE_TOLERANCE;_++)i.Vector3.sqrDist(d.positions[E-1],this._tessellationCache.positions[_])>r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE&&(d.positions[E++]=i.Vector3.clone(this._tessellationCache.positions[_]));var C=t.evaluatePosition(x);i.Vector3.sqrDist(d.positions[E-1],C)<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE&&E>d.offsets[d.offsets.length-1]+1&&E--,d.positions[E++]=C,d.offsets.push(d.positions.length-1),A=x}}return{positions:d.positions,offsets:d.offsets,tolerance:this._tessellationCache.tolerance}},t.CurveTessellator=a,t.TessellationCache=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cone=void 0;var i=n(1),r=n(4),o=n(0),s=n(12),a=n(6),c=n(7),u=n(14),l=n(2),h=function(){s.Surface.call(this),this._center=i.Vector3.createFloat64(),this._radius=0,this._angle=0,this._uScale=1,this._xAxis=i.Vector3.createFloat64(),this._yAxis=i.Vector3.createFloat64(),this._zAxis=i.Vector3.createFloat64()};(h.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.CONE},h.prototype.clone=function(){var e=new h;return e.copy(this),e},h.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),this._radius=e._radius,this._angle=e._angle,this._uScale=e._uScale,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),i.Vector3.copy(this._zAxis,e._zAxis)},h.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._xAxis,this._zAxis)},h.prototype.set=function(e,t,n,r,s,a){i.Vector3.copy(this._center,e),l.ConsoleUtils.assert(t>o.KERNEL_TOLERANCE),this._radius=t,l.ConsoleUtils.assert(i.Vector3.squaredLength(n)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,n),l.ConsoleUtils.assert(Math.abs(r)<Math.PI/2),this._angle=r,void 0!==s&&i.Vector3.squaredLength(s)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE?(l.ConsoleUtils.assert(i.Vector3.isOrthogonal(n,s,o.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._xAxis,s)):(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._uScale=a||1,l.ConsoleUtils.assert(this._uScale>o.PARAMETER_SPACE_TOLERANCE),this._computeYAxis()},h.prototype.getRadius=function(){return this._radius},h.prototype.setRadius=function(e){l.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._radius=e},h.prototype.getCenter=function(){return this._center},h.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},h.prototype.getAxisDir=function(){return this._zAxis},h.prototype.setAxisDir=function(e){l.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,e),(i.Vector3.squaredLength(this._xAxis)<=o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE||!i.Vector3.isOrthogonal(this._xAxis,this._zAxis,o.KERNEL_ANGULAR_TOLERANCE))&&(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._computeYAxis()},h.prototype.getUvOriginDir=function(){return this._xAxis},h.prototype.setUvOriginDir=function(e){l.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,e),this._computeYAxis()},h.prototype.getUScale=function(){return this._uScale},h.prototype.setUScale=function(e){l.ConsoleUtils.assert(e>o.PARAMETER_SPACE_TOLERANCE),this._uScale=e},h.prototype.getAngle=function(){return this._angle},h.prototype.setAngle=function(e){l.ConsoleUtils.assert(Math.abs(e)<Math.PI/2-o.KERNEL_ANGULAR_TOLERANCE),this._angle=e},h.prototype.isCylinder=function(){return Math.abs(this._angle)<o.KERNEL_ANGULAR_TOLERANCE},h.prototype.getApexParam=function(){return this.isCylinder()?void 0:-this._radius/(this._uScale*Math.sin(this._angle))},h.prototype.getApexPosition=function(){if(!this.isCylinder()){var e=-this._radius/Math.tan(this._angle),t=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(t,t,this._zAxis,e),t}},h.prototype.evaluatePosition=function(e,t){var n=this._radius+e*this._uScale*Math.sin(this._angle),r=n*Math.cos(t),o=n*Math.sin(t),s=e*this._uScale*Math.cos(this._angle),a=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(a,a,this._xAxis,r),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),a},h.prototype.evaluateNormal=function(e,t){var n=Math.sin(this._angle),r=Math.cos(this._angle),o=r*Math.cos(t),s=r*Math.sin(t),a=-n,c=i.Vector3.createFloat64();return i.Vector3.scale(c,this._xAxis,o),i.Vector3.scaleAndAdd(c,c,this._yAxis,s),i.Vector3.scaleAndAdd(c,c,this._zAxis,a),c},h.prototype.evaluateDu=function(e,t){var n=this._uScale*Math.sin(this._angle),r=n*Math.cos(t),o=n*Math.sin(t),s=this._uScale*Math.cos(this._angle),a=i.Vector3.createFloat64();return i.Vector3.scale(a,this._xAxis,r),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),a},h.prototype.evaluateDv=function(e,t){var n=this._radius+e*this._uScale*Math.sin(this._angle),r=-n*Math.sin(t),o=n*Math.cos(t),s=i.Vector3.createFloat64();return i.Vector3.scale(s,this._xAxis,r),i.Vector3.scaleAndAdd(s,s,this._yAxis,o),s},h.prototype.closestParam=function(e){var t=Math.sin(this._angle),n=Math.cos(this._angle),r=i.Vector3.createFloat64();i.Vector3.sub(r,e,this._center);var s=i.Vector3.dot(r,this._xAxis),a=i.Vector3.dot(r,this._yAxis),c=i.Vector3.dot(r,this._zAxis),u=Math.sqrt(s*s+a*a),l=this.getApexParam();if(void 0!==l){var h=l*this._uScale*n;(h>0&&c>h||h<0&&c<h)&&(s=-s,a=-a,u=-u)}return{u:((u-this._radius)*t+c*n)/this._uScale,v:Math.abs(u)>o.KERNEL_TOLERANCE?Math.atan2(a,s):0}},h.prototype.vParamLine=function(e){var t=this._radius+e*this._uScale*Math.sin(this._angle);if(Math.abs(t)>o.KERNEL_TOLERANCE){var n=new u.Circle,r=i.Vector3.clone(this._center),s=e*this._uScale*Math.cos(this._angle);i.Vector3.scaleAndAdd(r,r,this._zAxis,s);var c=i.Vector3.clone(this._xAxis);i.Vector3.scale(c,c,t);var l=i.Vector3.clone(this._zAxis);return i.Vector3.negate(l,l),n.set(r,l,c),n}return new a.Point(this.getApexPosition())},h.prototype.uParamLine=function(e){var t=new c.Line,n=i.Vector3.clone(this._center),r=this._radius*Math.cos(e),o=this._radius*Math.sin(e);return i.Vector3.scaleAndAdd(n,n,this._xAxis,r),i.Vector3.scaleAndAdd(n,n,this._yAxis,o),t.set(n,this.evaluateDu(0,e)),t},h.prototype.getBoundingBox=function(e,t){if(e){var n=e[0],i=e[1],o=this.vParamLine(n).getBoundingBox(t);return o.include(this.vParamLine(i).getBoundingBox(t)),o}return new r.BoundingBox([-1/0,-1/0,-1/0],[1/0,1/0,1/0])},h.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),i.Vector3.transformAsDirectionMatrix44(this._zAxis,this._zAxis,e);var t=i.Vector3.length(this._xAxis);this._radius*=t,this._uScale*=t,i.Vector3.normalize(this._xAxis,this._xAxis),i.Vector3.normalize(this._yAxis,this._yAxis),i.Vector3.normalize(this._zAxis,this._zAxis)},h.prototype.getRangeUnlimitedU=function(){return[-1/0,1/0]},h.prototype.getRangeUnlimitedV=function(){return[-Math.PI,Math.PI]},h.prototype.isPeriodicUnlimitedU=function(){return!1},h.prototype.isPeriodicUnlimitedV=function(){return!0},h.prototype.isClosedUnlimitedU=function(){return!1},h.prototype.isClosedUnlimitedV=function(){return!0},h.prototype.toObject=function(){var e=this.evaluatePosition(0,0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this._center),radius:this.vectorToObject(e),axis:this.vectorToObject(this.getAxisDir()),uCoordScale:this.getUScale(),angle:this.getAngle(),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.Cone=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EllipticalCone=void 0;var i=n(1),r=n(4),o=n(35),s=n(0),a=n(12),c=n(6),u=n(7),l=n(23),h=n(2),d=function(){a.Surface.call(this),this._center=i.Vector3.createFloat64(),this._majorRadius=0,this._minorRadius=0,this._angle=0,this._uScale=1,this._xAxis=i.Vector3.createFloat64(),this._yAxis=i.Vector3.createFloat64(),this._zAxis=i.Vector3.createFloat64()};(d.prototype=Object.create(a.Surface.prototype)).getGeometryType=function(){return s.GEOMETRY_TYPES.ELLIPTICAL_CONE},d.prototype.clone=function(){var e=new d;return e.copy(this),e},d.prototype.copy=function(e){a.Surface.prototype.copy.call(this,e),this._majorRadius=e._majorRadius,this._minorRadius=e._minorRadius,this._angle=e._angle,this._uScale=e._uScale,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),i.Vector3.copy(this._zAxis,e._zAxis)},d.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._xAxis,this._zAxis)},d.prototype.set=function(e,t,n,r,o,a){i.Vector3.copy(this._center,e),this._majorRadius=i.Vector3.length(t),h.ConsoleUtils.assert(this._majorRadius>s.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,t),h.ConsoleUtils.assert(n<=1),this._minorRadius=n*this._majorRadius,h.ConsoleUtils.assert(this._minorRadius>s.KERNEL_TOLERANCE),h.ConsoleUtils.assert(i.Vector3.squaredLength(r)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),h.ConsoleUtils.assert(i.Vector3.isOrthogonal(r,t,s.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._zAxis,r),h.ConsoleUtils.assert(Math.abs(o)<Math.PI/2),this._angle=o,this._uScale=a||1,h.ConsoleUtils.assert(this._uScale>s.PARAMETER_SPACE_TOLERANCE),this._computeYAxis()},d.prototype.getMajorRadius=function(){return this._majorRadius},d.prototype.setMajorRadius=function(e){h.ConsoleUtils.assert(e>s.KERNEL_TOLERANCE),this._majorRadius=e},d.prototype.getMinorRadius=function(){return this._minorRadius},d.prototype.setMinorRadius=function(e){h.ConsoleUtils.assert(e>s.KERNEL_TOLERANCE),this._minorRadius=e},d.prototype.getMajorAxis=function(){return this._xAxis},d.prototype.setMajorAxis=function(e){h.ConsoleUtils.assert(i.Vector3.squaredLength(e)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,e),this._computeYAxis()},d.prototype.getCenter=function(){return this._center},d.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},d.prototype.getAxisDir=function(){return this._zAxis},d.prototype.setAxisDir=function(e){h.ConsoleUtils.assert(i.Vector3.squaredLength(e)>s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,e),this._computeYAxis()},d.prototype.getUScale=function(){return this._uScale},d.prototype.setUScale=function(e){h.ConsoleUtils.assert(e>s.PARAMETER_SPACE_TOLERANCE),this._uScale=e},d.prototype.getAngle=function(){return this._angle},d.prototype.setAngle=function(e){h.ConsoleUtils.assert(Math.abs(e)<Math.PI/2-s.KERNEL_ANGULAR_TOLERANCE),this._angle=e},d.prototype.isCylinder=function(){return Math.abs(this._angle)<s.KERNEL_ANGULAR_TOLERANCE},d.prototype.getApexParam=function(){return this.isCylinder()?void 0:-this._majorRadius/(this._uScale*Math.sin(this._angle))},d.prototype.getApexPosition=function(){if(!this.isCylinder()){var e=-this._majorRadius/Math.tan(this._angle),t=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(t,t,this._zAxis,e),t}},d.prototype.evaluatePosition=function(e,t){var n=1+e*this._uScale*Math.sin(this._angle)/this._majorRadius,r=n*this._majorRadius*Math.cos(t),o=n*this._minorRadius*Math.sin(t),s=e*this._uScale*Math.cos(this._angle),a=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(a,a,this._xAxis,r),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),a},d.prototype.evaluateNormal=function(e,t){var n=Math.cos(this._angle),r=n*this._minorRadius*Math.cos(t),o=n*this._majorRadius*Math.sin(t),s=-Math.sin(this._angle)*this._minorRadius,a=i.Vector3.createFloat64();return i.Vector3.scale(a,this._xAxis,r),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),i.Vector3.normalize(a,a),a},d.prototype.evaluateDu=function(e,t){var n=this._uScale*Math.sin(this._angle)/this._majorRadius,r=n*this._majorRadius*Math.cos(t),o=n*this._minorRadius*Math.sin(t),s=this._uScale*Math.cos(this._angle),a=i.Vector3.createFloat64();return i.Vector3.scale(a,this._xAxis,r),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),a},d.prototype.evaluateDv=function(e,t){var n=1+e*this._uScale*Math.sin(this._angle)/this._majorRadius,r=-n*this._majorRadius*Math.sin(t),o=n*this._minorRadius*Math.cos(t),s=i.Vector3.createFloat64();return i.Vector3.scale(s,this._xAxis,r),i.Vector3.scaleAndAdd(s,s,this._yAxis,o),s},d.prototype.closestParam=function(e){var t,n;if(this.isCylinder()){var r=i.Vector3.createFloat64();i.Vector3.sub(r,e,this._center),t=i.Vector3.dot(r,this._zAxis)/this._uScale,n=this.vParamLine(t).closestToPointParam(e)}else{var a=i.Vector3.createFloat64();i.Vector3.sub(a,e,this.getApexPosition());var c=i.Vector3.dot(a,this._xAxis),u=i.Vector3.dot(a,this._yAxis),l=i.Vector3.dot(a,this._zAxis),h=this._uScale*Math.sin(this._angle),d=h*this._minorRadius/this._majorRadius,p=this._uScale*Math.cos(this._angle),g=this._majorRadius/h,f=function(e,t,n,r,a,c){if(r*r+a*a+c*c<s.KERNEL_TOLERANCE*s.KERNEL_TOLERANCE)return{u:0,v:0};var u=i.FLOAT64_TOLERANCE,l=c*e>=0?1:-1,h=(r*l>=0?.25:.75)*(a*l>=0?1:-1),d=h*Math.PI,p=[(h-.25)*Math.PI,(h+.25)*Math.PI],g=(0,o.newtonRaphson1D)((function(i){var o=Math.sin(i),s=Math.cos(i),u=e*(t*t+n*n)*r,l=t*(e*e+n*n)*a,h=n*(e*e-t*t)*c;return{val:u*o-l*s-h*o*s,deriv:u*s+l*o-h*(s*s-o*o)}}),p,d,u,32),f=e*Math.cos(g),v=t*Math.sin(g);return{u:(f*r+v*a+n*c)/(f*f+v*v+n*n),v:g}}(h,d,p,c,u,l);t=f.u-g,n=f.v}return{u:t,v:n}},d.prototype.vParamLine=function(e){var t=this._majorRadius+e*this._uScale*Math.sin(this._angle);if(Math.abs(t)>s.KERNEL_TOLERANCE){var n=new l.Ellipse,r=i.Vector3.clone(this._center),o=e*this._uScale*Math.cos(this._angle);i.Vector3.scaleAndAdd(r,r,this._zAxis,o);var a=i.Vector3.clone(this._xAxis);i.Vector3.scale(a,a,t);var u=i.Vector3.clone(this._zAxis);return i.Vector3.negate(u,u),n.set(r,u,a,this._minorRadius/this._majorRadius),n}return new c.Point(this.getApexPosition())},d.prototype.uParamLine=function(e){var t=new u.Line,n=i.Vector3.clone(this._center),r=this._majorRadius*Math.cos(e),o=this._minorRadius*Math.sin(e);return i.Vector3.scaleAndAdd(n,n,this._xAxis,r),i.Vector3.scaleAndAdd(n,n,this._yAxis,o),t.set(n,this.evaluateDu(0,e)),t},d.prototype.getBoundingBox=function(e,t){if(e){var n=e[0],i=e[1],o=this.vParamLine(n).getBoundingBox(t);return o.include(this.vParamLine(i).getBoundingBox(t)),o}return new r.BoundingBox([-1/0,-1/0,-1/0],[1/0,1/0,1/0])},d.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),i.Vector3.transformAsDirectionMatrix44(this._zAxis,this._zAxis,e);var t=i.Vector3.length(this._xAxis);this._majorRadius*=t,this._minorRadius*=t,this._uScale*=t,i.Vector3.normalize(this._xAxis,this._xAxis),i.Vector3.normalize(this._yAxis,this._yAxis),i.Vector3.normalize(this._zAxis,this._zAxis)},d.prototype.getRangeUnlimitedU=function(){return[-1/0,1/0]},d.prototype.getRangeUnlimitedV=function(){return[-Math.PI,Math.PI]},d.prototype.isPeriodicUnlimitedU=function(){return!1},d.prototype.isPeriodicUnlimitedV=function(){return!0},d.prototype.isClosedUnlimitedU=function(){return!1},d.prototype.isClosedUnlimitedV=function(){return!0},d.prototype.toObject=function(){var e=this.evaluatePosition(0,0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this._center),majorRadius:this.vectorToObject(e),axis:this.vectorToObject(this.getAxisDir()),uCoordScale:this.getUScale(),radiusRatio:this.getMinorRadius()/this.getMajorRadius(),angle:this.getAngle(),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.EllipticalCone=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BSurface=void 0;var i=n(1),r=n(4),o=n(0),s=n(12),a=n(33),c=n(3),u=n(76),l=n(103),h=n(104),d=n(105),p=n(77),g=n(2),f=function(){s.Surface.call(this),this._uDegree=0,this._vDegree=0,this._uKnots=[],this._vKnots=[],this._controlPoints=[],this._weights=[],this._isClosedU=void 0,this._isClosedV=void 0,this._isPeriodicU=void 0,this._isPeriodicV=void 0,this._patches=void 0};(f.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.BSURFACE},f.prototype.clone=function(){var e=new f;return e.copy(this),e},f.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),this._uDegree=e._uDegree,this._vDegree=e._vDegree,this._uKnots=e._uKnots.slice(0),this._vKnots=e._vKnots.slice(0),this._controlPoints=e._controlPoints.slice(0),this._weights=e._weights.slice(0),this._clearCaches()},f.prototype.set=function(e,t,n,i,r,o){g.ConsoleUtils.assert(e>=1),this._uDegree=e,g.ConsoleUtils.assert(t>=1),this._vDegree=t,g.ConsoleUtils.assert(n.length>=2*(e+1)),this._uKnots=Array.prototype.slice.call(n),g.ConsoleUtils.assert(i.length>=2*(t+1)),this._vKnots=Array.prototype.slice.call(i);var s=n.length-e-1,a=i.length-t-1;g.ConsoleUtils.assert(r.length===3*s*a),this._controlPoints=Array.prototype.slice.call(r),o&&o.length>0?(g.ConsoleUtils.assert(o.length===s*a),this._weights=Array.prototype.slice.call(o)):this._weights=[],this._clearCaches()},f.prototype.getDegreeU=function(){return this._uDegree},f.prototype.getDegreeV=function(){return this._vDegree},f.prototype.setDegreeU=function(e){g.ConsoleUtils.assert(e>=1),this._uDegree=e,this._clearCaches()},f.prototype.setDegreeV=function(e){g.ConsoleUtils.assert(e>=1),this._vDegree=e,this._clearCaches()},f.prototype.getNumKnotsU=function(){return this._uKnots.length},f.prototype.getNumKnotsV=function(){return this._vKnots.length},f.prototype.getKnotsU=function(){return this._uKnots},f.prototype.getKnotsV=function(){return this._vKnots},f.prototype.setKnotsU=function(e){this._uKnots=e,this._clearCaches()},f.prototype.setKnotsV=function(e){this._vKnots=e,this._clearCaches()},f.prototype.getNumControlPointsU=function(){return this._uKnots.length-this._uDegree-1},f.prototype.getNumControlPointsV=function(){return this._vKnots.length-this._vDegree-1},f.prototype.getControlPoints=function(){return this._controlPoints},f.prototype.setControlPoints=function(e){this._controlPoints=e,this._clearCaches()},f.prototype.getWeights=function(){return this._weights},f.prototype.setWeights=function(e){e&&e.length>0?this._weights=e:this._weights=[],this._clearCaches()},f.prototype.isRational=function(){return this._weights.length>0},f.prototype.evaluate=function(e,t,n,i,r){g.ConsoleUtils.assert(n>=0),this.isPeriodicUnlimitedU()&&(e=(0,c.normalizeParameterToShiftedRange)(e,this.getRangeUnlimitedU())),this.isPeriodicUnlimitedV()&&(t=(0,c.normalizeParameterToShiftedRange)(t,this.getRangeUnlimitedV()));var o=(0,u.evaluateBSurfaceDerivs)(e,t,Math.min(n,3),this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights),s={pos:o[0][0]};return n>=1&&(s.du=o[1][0],s.dv=o[0][1]),n>=2&&(s.duu=o[2][0],s.duv=o[1][1],s.dvv=o[0][2]),n>=3&&(s.duuu=o[3][0],s.duuv=o[2][1],s.duvv=o[1][2],s.dvvv=o[0][3]),s},f.prototype.evaluatePosition=function(e,t){return this.isPeriodicUnlimitedU()&&(e=(0,c.normalizeParameterToShiftedRange)(e,this.getRangeUnlimitedU())),this.isPeriodicUnlimitedV()&&(t=(0,c.normalizeParameterToShiftedRange)(t,this.getRangeUnlimitedV())),(0,u.evaluateBSurfacePoint)(e,t,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights)},f.prototype.evaluateNormal=function(e,t){return this.isPeriodicUnlimitedU()&&(e=(0,c.normalizeParameterToShiftedRange)(e,this.getRangeUnlimitedU())),this.isPeriodicUnlimitedV()&&(t=(0,c.normalizeParameterToShiftedRange)(t,this.getRangeUnlimitedV())),s.Surface.prototype.evaluateNormal.call(this,e,t)},f.prototype.evaluateDu=function(e,t){return this.isPeriodicUnlimitedU()&&(e=(0,c.normalizeParameterToShiftedRange)(e,this.getRangeUnlimitedU())),this.isPeriodicUnlimitedV()&&(t=(0,c.normalizeParameterToShiftedRange)(t,this.getRangeUnlimitedV())),(0,u.evaluateBSurfaceDerivs)(e,t,1,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights)[1][0]},f.prototype.evaluateDv=function(e,t){return this.isPeriodicUnlimitedU()&&(e=(0,c.normalizeParameterToShiftedRange)(e,this.getRangeUnlimitedU())),this.isPeriodicUnlimitedV()&&(t=(0,c.normalizeParameterToShiftedRange)(t,this.getRangeUnlimitedV())),(0,u.evaluateBSurfaceDerivs)(e,t,1,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights)[0][1]},f.prototype.insertKnotU=function(e,t){var n=(0,l.insertBSurfaceKnotU)(e,t,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights);this._uKnots=n.uknots,this._controlPoints=n.P,this._weights=n.weights||[],this._clearCaches()},f.prototype.insertKnotV=function(e,t){var n=(0,l.insertBSurfaceKnotV)(e,t,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights);this._vKnots=n.vknots,this._controlPoints=n.P,this._weights=n.weights||[],this._clearCaches()},f.prototype.relaxToPerpendicular=function(e,t,n,r,o,s,a){var c=this;r&&0!==r.length||(r=this.getRangeU()),o&&0!==o.length||(o=this.getRangeV());var u=(0,p.newtonRaphson2D)((function(t){var n=c.evaluate(t[0],t[1],2);i.Vector3.sub(n.pos,n.pos,e);var r=i.Vector3.dot(n.du,n.pos),o=i.Vector3.dot(n.dv,n.pos),s=i.Vector3.dot(n.duu,n.pos)+i.Vector3.dot(n.du,n.du),a=i.Vector3.dot(n.duv,n.pos)+i.Vector3.dot(n.du,n.dv);return{val:[r,o],deriv1:[s,a],deriv2:[a,i.Vector3.dot(n.dvv,n.pos)+i.Vector3.dot(n.dv,n.dv)]}}),[t,n],[r,o]);return{u:u.param[0],v:u.param[1],status:u.status}},f.prototype.closestParam=function(e){for(var t=i.FLOAT64_TOLERANCE,n=[[this.getRangeU(),this.getRangeV()]],r=this.getBezierPatches(),o=(0,d.closestBSurfacePatches)(e,r,n),s=Number.POSITIVE_INFINITY,a={u:void 0,v:void 0},u=0;u<o.length;++u)if(!(o[u].minDistSqr>s))for(var l=o[u].index,h=r[l[0]][l[1]],p=h.getRangeUnlimitedU(),g=h.getRangeUnlimitedV(),f=0;f<n.length;++f){var v=[Math.max(p[0],n[f][0][0]),Math.min(p[1],n[f][0][1])],y=[Math.max(g[0],n[f][1][0]),Math.min(g[1],n[f][1][1])];if(!(v[1]-v[0]<=i.FLOAT64_TOLERANCE||y[1]-y[0]<=i.FLOAT64_TOLERANCE)){var m=(0,d.closestBSurfacePointApprox)(e,h.getDegreeU(),h.getDegreeV(),h.getKnotsU(),h.getKnotsV(),h.getControlPoints(),h.isRational()?h.getWeights():void 0,v,y),_=this.relaxToPerpendicular(e,m.u,m.v,v,y,t,64),E=h.evaluatePosition(_.u,_.v),A=i.Vector3.squaredDistance(E,e);A<s&&(s=A,a.u=_.u,a.v=_.v)}}return this.isPeriodicUnlimitedU()&&(a.u=(0,c.foldNearTo)(a.u,.5*(this.getRangeU()[0]+this.getRangeU()[1]),this.getPeriodUnlimitedU())),this.isPeriodicUnlimitedV()&&(a.v=(0,c.foldNearTo)(a.v,.5*(this.getRangeV()[0]+this.getRangeV()[1]),this.getPeriodUnlimitedV())),a},f.prototype.vParamLine=function(e){var t=(0,l.extractBSurfaceParamLineV)(e,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights),n=t.ctrlPts.length/3;t.weights&&0!==t.weights.length||(t.weights=new Array(n),t.weights.fill(1));var i=new a.BCurve;return i.set(t.ctrlPts,t.weights,this._vDegree,this._vKnots),i},f.prototype.uParamLine=function(e){var t=(0,l.extractBSurfaceParamLineU)(e,this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights),n=t.ctrlPts.length/3;t.weights&&0!==t.weights.length||(t.weights=new Array(n),t.weights.fill(1));var i=new a.BCurve;return i.set(t.ctrlPts,t.weights,this._uDegree,this._uKnots),i},f.prototype.getBoundingBox=function(e,t){for(var n=new r.BoundingBox,o=i.Vector3.createFloat64(),s=0;s<this._controlPoints.length;s+=3)i.Vector3.set(o,this._controlPoints[s],this._controlPoints[s+1],this._controlPoints[s+2]),n.includePoint(o);return n},f.prototype.transform=function(e){for(var t=i.Vector3.createFloat64(),n=0;n<this._controlPoints.length;n+=3)i.Vector3.set(t,this._controlPoints[n],this._controlPoints[n+1],this._controlPoints[n+2]),i.Vector3.transformMatrix44(t,t,e),this._controlPoints[n]=t[0],this._controlPoints[n+1]=t[1],this._controlPoints[n+2]=t[2];this._clearCaches()},f.prototype.getRangeUnlimitedU=function(){return[this._uKnots[0],this._uKnots[this._uKnots.length-1]]},f.prototype.getRangeUnlimitedV=function(){return[this._vKnots[0],this._vKnots[this._vKnots.length-1]]},f.prototype.isPeriodicUnlimitedU=function(){return this._checkClosure(),this._isPeriodicU},f.prototype.isPeriodicUnlimitedV=function(){return this._checkClosure(),this._isPeriodicV},f.prototype.isClosedUnlimitedU=function(){return this._checkClosure(),this._isClosedU},f.prototype.isClosedUnlimitedV=function(){return this._checkClosure(),this._isClosedV},f.prototype._checkClosure=function(){void 0!==this._isClosedU&&void 0!==this._isPeriodicU||(this._isClosedU=this._isPeriodicU=!1),void 0!==this._isClosedV&&void 0!==this._isPeriodicV||(this._isClosedV=this._isPeriodicV=!1)},f.prototype.isSimpleBezier=function(){return this._uKnots.length===2*this._uDegree+2&&this._vKnots.length===2*this._vDegree+2},f.prototype.getBezierPatches=function(){if(this.isSimpleBezier())return this._patches=void 0,[[this]];if(!this._patches){var e=(0,h.decomposeBSurfaceToBezier)(this._uDegree,this._vDegree,this._uKnots,this._vKnots,this._controlPoints,this._weights);this._patches=[];for(var t=0;t<e.U.length;++t){this._patches[t]=[];for(var n=0;n<e.V.length;++n){var i=new f;i.set(this._uDegree,this._vDegree,e.U[t],e.V[n],e.P[t][n],e.w?e.w[t][n]:void 0),this._patches[t][n]=i}}}return this._patches},f.prototype._clearCaches=function(){this._isClosedU=void 0,this._isClosedV=void 0,this._isPeriodicU=void 0,this._isPeriodicV=void 0,this._patches=void 0},f.prototype.toObject=function(){return{uDegree:this._uDegree,vDegree:this._vDegree,uKnots:this._uKnots,vKnots:this._vKnots,controlPoints:this._controlPoints,weights:this._weights,uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.BSurface=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WireBody=void 0;var i=n(9),r=n(0),o=n(4),s=n(19),a=function(){i.BaseTopology.call(this),this._wires=[]};(a.prototype=Object.create(i.BaseTopology.prototype)).getTopologyType=function(){return r.TOPOLOGY_TYPES.WIREBODY},a.prototype.getWires=function(){return this._wires},a.prototype.setWires=function(e){this._wires=new Array(e.length);for(var t=0;t<e.length;++t)this._wires[t]=e[t]},a.prototype.addWire=function(e){this._wires?this._wires.push(e):this._wires=[e],e.setWireBody(this)},a.prototype.addWires=function(e){this._wires||(this._wires=[]);for(var t=0;t<e.length;++t)e[t].setWireBody(this);this._wires=this._wires.concat(e)},a.prototype.removeWire=function(e){var t=this._wires.indexOf(e);return t>-1&&(this._wires.splice(t,1),e.getWireBody()===this&&e.setWireBody(void 0),!0)},a.prototype.getBody=function(){return this},a.prototype.collectFaces=function(e){return e||new Set},a.prototype.collectEdges=function(e){e=e||new Set;for(var t=0;t<this._wires.length;++t)this._wires[t].collectEdges(e);return e},a.prototype.collectVertices=function(e){e=e||new Set;for(var t=0;t<this._wires.length;++t)this._wires[t].collectVertices(e);return e},a.prototype.getBoundingBox=function(){for(var e=new o.BoundingBox,t=0;t<this._wires.length;++t)e.include(this._wires[t].getBoundingBox());return e},a.prototype.transform=function(e){(0,s.transformTopology)(this,e)},a.prototype.toString=function(){return"WireBody"},a.prototype.toObject=function(){return{wires:this.refsToStrings(this._wires),attributes:this.refsToStrings(this._attributes)}},a.prototype.addToModelObject=function(e){this.addAllToModelObject(e,[this._wires,this._attributes])},t.WireBody=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TopologyCloner=void 0;var i=n(16),r=n(20),o=n(27),s=n(13),a=n(15),c=n(26),u=n(25),l=n(24),h=n(41),d=function(){this._edgeMap={},this._vertexMap={},this._coedgeMap={},this._progenitorMap=new h.ProgenitorMap};d.prototype.cloneVertex=function(e){var t=this._vertexMap[e.getGuid()];return t||(t=new i.Vertex(e.getPoint().clone()),this._vertexMap[e.getGuid()]=t,t.setPrecision(e.getPrecision()),this._progenitorMap.addEntry(t,[e])),t},d.prototype.cloneEdge=function(e){var t=this._edgeMap[e.getGuid()];return t||(t=new r.Edge(e.getCurve().clone()),this._edgeMap[e.getGuid()]=t,t.setReversed(e.isReversed()),t.setRange(e.getRange()),t.setStartVertex(this.cloneVertex(e.getStartVertex())),t.setEndVertex(this.cloneVertex(e.getEndVertex())),t.setPrecision(e.getPrecision()),this._progenitorMap.addEntry(t,[e])),t},d.prototype.cloneCoedge=function(e){var t,n,i=new o.Coedge;this._coedgeMap[e.getGuid()]=i,i.setReversed(e.isReversed()),i.setEdge(this.cloneEdge(e.getEdge())),i.getEdge().setCoedge(i);for(var r=e.getPartner();r;){var s=this._coedgeMap[r.getGuid()];s&&(t||(t=s),n=s,e.getEdge().getCoedge()===r&&i.getEdge().setCoedge(s)),(r=r.getPartner())===e&&(r=void 0)}return t&&n&&(i.setPartner(t),n.setPartner(i)),this._progenitorMap.addEntry(i,[e]),i},d.prototype.cloneLoop=function(e){for(var t=new s.Loop,n=e.getCoedges(),i=new Array(n.length),r=0;r<n.length;++r)i[r]=this.cloneCoedge(n[r]);return t.addCoedges(i),this._progenitorMap.addEntry(t,[e]),t},d.prototype.cloneFace=function(e){for(var t=new a.Face,n=e.getLoops(),i=new Array(n.length),r=0;r<n.length;++r)i[r]=this.cloneLoop(n[r]);return t.addLoops(i),t.setSurface(e.getSurface().clone()),t.setReversed(e.isReversed()),this._progenitorMap.addEntry(t,[e]),t},d.prototype.cloneFaces=function(e){for(var t=new Array(e.length),n=0;n<e.length;++n)t[n]=this.cloneFace(e[n]);return t},d.prototype.cloneShell=function(e){var t=new c.Shell;return t.addFaces(this.cloneFaces(e.getFaces())),this._progenitorMap.addEntry(t,[e]),t},d.prototype.cloneLump=function(e){for(var t=new u.Lump,n=e.getShells(),i=0;i<n.length;++i)t.addShell(this.cloneShell(n[i]));return this._progenitorMap.addEntry(t,[e]),t},d.prototype.cloneBody=function(e){for(var t=new l.Body,n=e.getLumps(),i=0;i<n.length;++i)t.addLump(this.cloneLump(n[i]));return this._progenitorMap.addEntry(t,[e]),t},d.prototype.getProgenitorMap=function(){return this._progenitorMap},t.TopologyCloner=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){if(t<1)return"";for(var n="";t>1;)1&t&&(n+=e),t>>=1,e+=e;return n+e},r={isInitialized:!1,rngA:4027999010,rngB:3993266363,rngC:3605298456,rotl32:function(e,t){return(e<<t>>>0|e>>>32-t)>>>0},initialize:function(e,t){return r.isInitialized&&!t?0:(r.isInitialized&&(r.rngA=4027999010,r.rngB=3993266363,r.rngC=3605298456),r.isInitialized=!0,void 0!==e?n=e:(n=(new Date).getTime(),n^=Math.floor(2147483647*Math.random()+1)),r.rngA+=2097151&n,r.rngB+=n>>7&524287,r.rngC+=n>>13,n);var n},genRandUInt32:function(){return r.rngA=~(2911329625*r.rngA),r.rngA=r.rotl32(r.rngA,17),r.rngB=4031235431*r.rngB,r.rngB=r.rotl32(r.rngB,15),r.rngC=3286325185-r.rotl32(r.rngC,19),r.rngA+r.rngB^r.rngC}},o=function(e){for(var t="",n=0;n<4;n++){var r=e[n].toString(16);t+=i("0",8-r.length)+r}return t.substr(0,8)+"-"+t.substr(8,4)+"-"+t.substr(12,4)+"-"+t.substr(16,4)+"-"+t.substr(20,12)},s=function(e,t){var n=t;return void 0===n&&(n=new Uint32Array(4)),n[0]=parseInt("0x"+e.substr(0,8),16),n[1]=parseInt("0x"+e.substr(9,4)+e.substr(14,4),16),n[2]=parseInt("0x"+e.substr(19,4)+e.substr(24,4),16),n[3]=parseInt("0x"+e.substr(28,8),16),n},a=function(e,t){var n=new Uint32Array(t);return n[0]+=2654435769,n[1]+=104395303,n[2]+=452930477,n[3]+=982451653,n[0]+=e[3]<<6,n[1]+=e[0]<<6,n[2]+=e[1]<<6,n[3]+=e[2]<<6,n[0]+=e[2]>>2,n[1]+=e[3]>>2,n[2]+=e[0]>>2,n[3]+=e[1]>>2,n[0]=16777619*(n[0]^e[1])>>>0,n[1]=16777619*(n[1]^e[2])>>>0,n[2]=16777619*(n[2]^e[3])>>>0,n[3]=16777619*(n[3]^e[0])>>>0,n};r.initialize(),t.uint32x4ToGUID=o,t.guidToUint32x4=s,t.generateGUID=function(){var e=new Uint32Array(4);return e[0]=r.genRandUInt32(),e[1]=r.genRandUInt32(),e[2]=r.genRandUInt32(),e[3]=r.genRandUInt32(),o(e)},t.isGUID=function(e){return/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(e)},t.combineGuids=function(e,t){var n=s(e),i=s(t),r=a(n,i);return o(r)},t.hashCombine4xUint32=a},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==("undefined"==typeof window?"undefined":_typeof(window))&&(n=window)}e.exports=n},function(e,t,n){"use strict";e.exports=function(e,t){for(var n=new Array(arguments.length-1),i=0,r=2,o=!0;r<arguments.length;)n[i++]=arguments[r++];return new Promise((function(r,s){n[i]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];r.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,s(e))}}))}},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,n){"use strict";t.Service=n(98)},function(e,t,n){"use strict";e.exports={}},function(e,t,n){"use strict";e.exports=function(e){for(var t,n=o.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),a=e.fieldsArray.slice().sort(o.compareFieldsById),c=0;c<a.length;++c){var u=a[c].resolve(),l=e._fieldsArray.indexOf(u),h=u.resolvedType instanceof i?"int32":u.type,d=r.basic[h];t="m"+o.safeProp(u.name),u.map?(n("if(%s!=null&&m.hasOwnProperty(%j)){",t,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",t)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|r.mapKey[u.keyType],u.keyType),void 0===d?n("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",l,t):n(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,t),n("}")("}")):u.repeated?(n("if(%s!=null&&%s.length){",t,t),u.packed&&void 0!==r.packed[h]?n("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",t)("w.%s(%s[i])",h,t)("w.ldelim()"):(n("for(var i=0;i<%s.length;++i)",t),void 0===d?s(n,u,l,t+"[i]"):n("w.uint32(%i).%s(%s[i])",(u.id<<3|d)>>>0,h,t)),n("}")):(u.optional&&n("if(%s!=null&&m.hasOwnProperty(%j))",t,u.name),void 0===d?s(n,u,l,t):n("w.uint32(%i).%s(%s)",(u.id<<3|d)>>>0,h,t))}return n("return w")};var i=n(11),r=n(31),o=n(5);function s(e,t,n,i){return t.resolvedType.group?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",n,i,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",n,i,(t.id<<3|2)>>>0)}},function(e,t,n){"use strict";e.exports=m;var i=n(30);((m.prototype=Object.create(i.prototype)).constructor=m).className="Type";var r=n(11),o=n(48),s=n(22),a=n(64),c=n(65),u=n(49),l=n(47),h=n(46),d=n(5),p=n(62),g=n(67),f=n(68),v=n(69),y=n(70);function m(e,t){i.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function _(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(m.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var n=this.fields[e[t]],i=n.id;if(this._fieldsById[i])throw Error("duplicate id "+i+" in "+this);this._fieldsById[i]=n}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=m.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,u,!0),this._ctor=e;for(var n=0;n<this.fieldsArray.length;++n)this._fieldsArray[n].resolve();var i={};for(n=0;n<this.oneofsArray.length;++n)i[this._oneofsArray[n].resolve().name]={get:d.oneOfGetter(this._oneofsArray[n].oneof),set:d.oneOfSetter(this._oneofsArray[n].oneof)};n&&Object.defineProperties(e.prototype,i)}}}),m.generateConstructor=function(e){for(var t,n=d.codegen(["p"],e.name),i=0;i<e.fieldsArray.length;++i)(t=e._fieldsArray[i]).map?n("this%s={}",d.safeProp(t.name)):t.repeated&&n("this%s=[]",d.safeProp(t.name));return n("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},m.fromJSON=function(e,t){var n=new m(e,t.options);n.extensions=t.extensions,n.reserved=t.reserved;for(var u=Object.keys(t.fields),l=0;l<u.length;++l)n.add((void 0!==t.fields[u[l]].keyType?a.fromJSON:s.fromJSON)(u[l],t.fields[u[l]]));if(t.oneofs)for(u=Object.keys(t.oneofs),l=0;l<u.length;++l)n.add(o.fromJSON(u[l],t.oneofs[u[l]]));if(t.nested)for(u=Object.keys(t.nested),l=0;l<u.length;++l){var h=t.nested[u[l]];n.add((void 0!==h.id?s.fromJSON:void 0!==h.fields?m.fromJSON:void 0!==h.values?r.fromJSON:void 0!==h.methods?c.fromJSON:i.fromJSON)(u[l],h))}return t.extensions&&t.extensions.length&&(n.extensions=t.extensions),t.reserved&&t.reserved.length&&(n.reserved=t.reserved),t.group&&(n.group=!0),t.comment&&(n.comment=t.comment),n},m.prototype.toJSON=function(e){var t=i.prototype.toJSON.call(this,e),n=!!e&&Boolean(e.keepComments);return d.toObject(["options",t&&t.options||void 0,"oneofs",i.arrayToJSON(this.oneofsArray,e),"fields",i.arrayToJSON(this.fieldsArray.filter((function(e){return!e.declaringField})),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},m.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var n=this.oneofsArray;for(t=0;t<n.length;)n[t++].resolve();return i.prototype.resolveAll.call(this)},m.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},m.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof s&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),_(this)}return e instanceof o?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),_(this)):i.prototype.add.call(this,e)},m.prototype.remove=function(e){if(e instanceof s&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),_(this)}if(e instanceof o){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),_(this)}return i.prototype.remove.call(this,e)},m.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},m.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)},m.prototype.create=function(e){return new this.ctor(e)},m.prototype.setup=function(){for(var e=this.fullName,t=[],n=0;n<this.fieldsArray.length;++n)t.push(this._fieldsArray[n].resolve().resolvedType);this.encode=p(this)({Writer:h,types:t,util:d}),this.decode=g(this)({Reader:l,types:t,util:d}),this.verify=f(this)({types:t,util:d}),this.fromObject=v.fromObject(this)({types:t,util:d}),this.toObject=v.toObject(this)({types:t,util:d});var i=y[e];if(i){var r=Object.create(this);r.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(r),r.toObject=this.toObject,this.toObject=i.toObject.bind(r)}return this},m.prototype.encode=function(e,t){return this.setup().encode(e,t)},m.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},m.prototype.decode=function(e,t){return this.setup().decode(e,t)},m.prototype.decodeDelimited=function(e){return e instanceof l||(e=l.create(e)),this.decode(e,e.uint32())},m.prototype.verify=function(e){return this.setup().verify(e)},m.prototype.fromObject=function(e){return this.setup().fromObject(e)},m.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},m.d=function(e){return function(t){d.decorateType(t,e)}}},function(e,t,n){"use strict";e.exports=s;var i=n(22);((s.prototype=Object.create(i.prototype)).constructor=s).className="MapField";var r=n(31),o=n(5);function s(e,t,n,r,s,a){if(i.call(this,e,t,r,void 0,void 0,s,a),!o.isString(n))throw TypeError("keyType must be a string");this.keyType=n,this.resolvedKeyType=null,this.map=!0}s.fromJSON=function(e,t){return new s(e,t.id,t.keyType,t.type,t.options,t.comment)},s.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return o.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},s.prototype.resolve=function(){if(this.resolved)return this;if(void 0===r.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return i.prototype.resolve.call(this)},s.d=function(e,t,n){return"function"==typeof n?n=o.decorateType(n).name:n&&"object"==_typeof(n)&&(n=o.decorateEnum(n).name),function(i,r){o.decorateType(i.constructor).add(new s(r,e,t,n))}}},function(e,t,n){"use strict";e.exports=a;var i=n(30);((a.prototype=Object.create(i.prototype)).constructor=a).className="Service";var r=n(66),o=n(5),s=n(60);function a(e,t){i.call(this,e,t),this.methods={},this._methodsArray=null}function c(e){return e._methodsArray=null,e}a.fromJSON=function(e,t){var n=new a(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),o=0;o<i.length;++o)n.add(r.fromJSON(i[o],t.methods[i[o]]));return t.nested&&n.addJSON(t.nested),n.comment=t.comment,n},a.prototype.toJSON=function(e){var t=i.prototype.toJSON.call(this,e),n=!!e&&Boolean(e.keepComments);return o.toObject(["options",t&&t.options||void 0,"methods",i.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",n?this.comment:void 0])},Object.defineProperty(a.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=o.toArray(this.methods))}}),a.prototype.get=function(e){return this.methods[e]||i.prototype.get.call(this,e)},a.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return i.prototype.resolve.call(this)},a.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof r?(this.methods[e.name]=e,e.parent=this,c(this)):i.prototype.add.call(this,e)},a.prototype.remove=function(e){if(e instanceof r){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,c(this)}return i.prototype.remove.call(this,e)},a.prototype.create=function(e,t,n){for(var i,r=new s.Service(e,t,n),a=0;a<this.methodsArray.length;++a){var c=o.lcFirst((i=this._methodsArray[a]).resolve().name).replace(/[^$\w_]/g,"");r[c]=o.codegen(["r","c"],o.isReserved(c)?c+"_":c)("return this.rpcCall(m,q,s,r,c)")({m:i,q:i.resolvedRequestType.ctor,s:i.resolvedResponseType.ctor})}return r}},function(e,t,n){"use strict";e.exports=o;var i=n(21);((o.prototype=Object.create(i.prototype)).constructor=o).className="Method";var r=n(5);function o(e,t,n,o,s,a,c,u){if(r.isObject(s)?(c=s,s=a=void 0):r.isObject(a)&&(c=a,a=void 0),void 0!==t&&!r.isString(t))throw TypeError("type must be a string");if(!r.isString(n))throw TypeError("requestType must be a string");if(!r.isString(o))throw TypeError("responseType must be a string");i.call(this,e,c),this.type=t||"rpc",this.requestType=n,this.requestStream=!!s||void 0,this.responseType=o,this.responseStream=!!a||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u}o.fromJSON=function(e,t){return new o(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment)},o.prototype.toJSON=function(e){var t=!!e&&Boolean(e.keepComments);return r.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0])},o.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),i.prototype.resolve.call(this))}},function(e,t,n){"use strict";e.exports=function(e){var t=o.codegen(["r","l"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter((function(e){return e.map})).length?",k":""))("while(r.pos<c){")("var t=r.uint32()");e.group&&t("if((t&7)===4)")("break"),t("switch(t>>>3){");for(var n=0;n<e.fieldsArray.length;++n){var a=e._fieldsArray[n].resolve(),c=a.resolvedType instanceof i?"int32":a.type,u="m"+o.safeProp(a.name);t("case %i:",a.id),a.map?(t("r.skip().pos++")("if(%s===util.emptyObject)",u)("%s={}",u)("k=r.%s()",a.keyType)("r.pos++"),void 0!==r.long[a.keyType]?void 0===r.basic[c]?t('%s[typeof k==="object"?util.longToHash(k):k]=types[%i].decode(r,r.uint32())',u,n):t('%s[typeof k==="object"?util.longToHash(k):k]=r.%s()',u,c):void 0===r.basic[c]?t("%s[k]=types[%i].decode(r,r.uint32())",u,n):t("%s[k]=r.%s()",u,c)):a.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==r.packed[c]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,c)("}else"),void 0===r.basic[c]?t(a.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",u,n):t("%s.push(r.%s())",u,c)):void 0===r.basic[c]?t(a.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",u,n):t("%s=r.%s()",u,c),t("break")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),n=0;n<e._fieldsArray.length;++n){var l=e._fieldsArray[n];l.required&&t("if(!m.hasOwnProperty(%j))",l.name)("throw util.ProtocolError(%j,{instance:m})",s(l))}return t("return m")};var i=n(11),r=n(31),o=n(5);function s(e){return"missing required '"+e.name+"'"}},function(e,t,n){"use strict";e.exports=function(e){var t=r.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),n={};e.oneofsArray.length&&t("var p={}");for(var i=0;i<e.fieldsArray.length;++i){var c=e._fieldsArray[i].resolve(),u="m"+r.safeProp(c.name);if(c.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",u,c.name),c.map)t("if(!util.isObject(%s))",u)("return%j",o(c,"object"))("var k=Object.keys(%s)",u)("for(var i=0;i<k.length;++i){"),a(t,c,"k[i]"),s(t,c,i,u+"[k[i]]")("}");else if(c.repeated)t("if(!Array.isArray(%s))",u)("return%j",o(c,"array"))("for(var i=0;i<%s.length;++i){",u),s(t,c,i,u+"[i]")("}");else{if(c.partOf){var l=r.safeProp(c.partOf.name);1===n[c.partOf.name]&&t("if(p%s===1)",l)("return%j",c.partOf.name+": multiple values"),n[c.partOf.name]=1,t("p%s=1",l)}s(t,c,i,u)}c.optional&&t("}")}return t("return null")};var i=n(11),r=n(5);function o(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function s(e,t,n,r){if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(%s){",r)("default:")("return%j",o(t,"enum value"));for(var s=Object.keys(t.resolvedType.values),a=0;a<s.length;++a)e("case %i:",t.resolvedType.values[s[a]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",n,r)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",r)("return%j",o(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",o(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',r)("return%j",o(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',r)("return%j",o(t,"boolean"));break;case"string":e("if(!util.isString(%s))",r)("return%j",o(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",o(t,"buffer"))}return e}function a(e,t,n){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",n)("return%j",o(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",n)("return%j",o(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",n)("return%j",o(t,"boolean key"))}return e}},function(e,t,n){"use strict";var i=t,r=n(11),o=n(5);function s(e,t,n,i){if(t.resolvedType)if(t.resolvedType instanceof r){e("switch(d%s){",i);for(var o=t.resolvedType.values,s=Object.keys(o),a=0;a<s.length;++a)t.repeated&&o[s[a]]===t.typeDefault&&e("default:"),e("case%j:",s[a])("case %i:",o[s[a]])("m%s=%j",i,o[s[a]])("break");e("}")}else e('if(typeof d%s!=="object")',i)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",i,n,i);else{var c=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",i,i);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",i,i);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",i,i);break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",i,i,c)('else if(typeof d%s==="string")',i)("m%s=parseInt(d%s,10)",i,i)('else if(typeof d%s==="number")',i)("m%s=d%s",i,i)('else if(typeof d%s==="object")',i)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",i,i,i,c?"true":"");break;case"bytes":e('if(typeof d%s==="string")',i)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",i,i,i)("else if(d%s.length)",i)("m%s=d%s",i,i);break;case"string":e("m%s=String(d%s)",i,i);break;case"bool":e("m%s=Boolean(d%s)",i,i)}}return e}function a(e,t,n,i){if(t.resolvedType)t.resolvedType instanceof r?e("d%s=o.enums===String?types[%i].values[m%s]:m%s",i,n,i,i):e("d%s=types[%i].toObject(m%s,o)",i,n,i);else{var o=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",i,i,i,i);break;case"uint64":o=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',i)("d%s=o.longs===String?String(m%s):m%s",i,i,i)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",i,i,i,i,o?"true":"",i);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",i,i,i,i,i);break;default:e("d%s=m%s",i,i)}}return e}i.fromObject=function(e){var t=e.fieldsArray,n=o.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return n("return new this.ctor");n("var m=new this.ctor");for(var i=0;i<t.length;++i){var a=t[i].resolve(),c=o.safeProp(a.name);a.map?(n("if(d%s){",c)('if(typeof d%s!=="object")',c)("throw TypeError(%j)",a.fullName+": object expected")("m%s={}",c)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",c),s(n,a,i,c+"[ks[i]]")("}")("}")):a.repeated?(n("if(d%s){",c)("if(!Array.isArray(d%s))",c)("throw TypeError(%j)",a.fullName+": array expected")("m%s=[]",c)("for(var i=0;i<d%s.length;++i){",c),s(n,a,i,c+"[i]")("}")("}")):(a.resolvedType instanceof r||n("if(d%s!=null){",c),s(n,a,i,c),a.resolvedType instanceof r||n("}"))}return n("return m")},i.toObject=function(e){var t=e.fieldsArray.slice().sort(o.compareFieldsById);if(!t.length)return o.codegen()("return {}");for(var n=o.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],c=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?i:t[u].map?s:c).push(t[u]);if(i.length){for(n("if(o.arrays||o.defaults){"),u=0;u<i.length;++u)n("d%s=[]",o.safeProp(i[u].name));n("}")}if(s.length){for(n("if(o.objects||o.defaults){"),u=0;u<s.length;++u)n("d%s={}",o.safeProp(s[u].name));n("}")}if(c.length){for(n("if(o.defaults){"),u=0;u<c.length;++u){var l=c[u],h=o.safeProp(l.name);if(l.resolvedType instanceof r)n("d%s=o.enums===String?%j:%j",h,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)n("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var d="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";n("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else n("d%s=%j",h,l.typeDefault)}n("}")}var p=!1;for(u=0;u<t.length;++u){l=t[u];var g=e._fieldsArray.indexOf(l);h=o.safeProp(l.name),l.map?(p||(p=!0,n("var ks2")),n("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),a(n,l,g,h+"[ks2[j]]")("}")):l.repeated?(n("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),a(n,l,g,h+"[j]")("}")):(n("if(m%s!=null&&m.hasOwnProperty(%j)){",h,l.name),a(n,l,g,h),l.partOf&&n("if(o.oneofs)")("d%s=%j",o.safeProp(l.partOf.name),l.name)),n("}")}return n("return d")}},function(e,t,n){"use strict";var i=t,r=n(49);i[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=this.lookup(e["@type"]);if(t){var n="."===e["@type"].charAt(0)?e["@type"].substr(1):e["@type"];return this.create({type_url:"/"+n,value:t.encode(t.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){if(t&&t.json&&e.type_url&&e.value){var n=e.type_url.substring(e.type_url.lastIndexOf("/")+1),i=this.lookup(n);i&&(e=i.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof r){var o=e.$type.toObject(e,t);return o["@type"]=e.$type.fullName,o}return this.toObject(e,t)}}},function(e,t,n){"use strict";e.exports=h;var i=n(30);((h.prototype=Object.create(i.prototype)).constructor=h).className="Root";var r,o,s,a=n(22),c=n(11),u=n(48),l=n(5);function h(e){i.call(this,"",e),this.deferred=[],this.files=[]}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested)},h.prototype.resolvePath=l.path.resolve,h.prototype.load=function e(t,n,i){"function"==typeof n&&(i=n,n=void 0);var r=this;if(!i)return l.asPromise(e,r,t,n);var a=i===d;function c(e,t){if(i){var n=i;if(i=null,a)throw e;n(e,t)}}function u(e,t){try{if(l.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),l.isString(t)){o.filename=e;var i,s=o(t,r,n),u=0;if(s.imports)for(;u<s.imports.length;++u)(i=r.resolvePath(e,s.imports[u]))&&h(i);if(s.weakImports)for(u=0;u<s.weakImports.length;++u)(i=r.resolvePath(e,s.weakImports[u]))&&h(i,!0)}else r.setOptions(t.options).addJSON(t.nested)}catch(e){c(e)}a||p||c(null,r)}function h(e,t){var n=e.lastIndexOf("google/protobuf/");if(n>-1){var o=e.substring(n);o in s&&(e=o)}if(!(r.files.indexOf(e)>-1))if(r.files.push(e),e in s)a?u(e,s[e]):(++p,setTimeout((function(){--p,u(e,s[e])})));else if(a){var h;try{h=l.fs.readFileSync(e).toString("utf8")}catch(e){return void(t||c(e))}u(e,h)}else++p,l.fetch(e,(function(n,o){--p,i&&(n?t?p||c(null,r):c(n):u(e,o))}))}var p=0;l.isString(t)&&(t=[t]);for(var g,f=0;f<t.length;++f)(g=r.resolvePath("",t[f]))&&h(g);if(a)return r;p||c(null,r)},h.prototype.loadSync=function(e,t){if(!l.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map((function(e){return"'extend "+e.extend+"' in "+e.parent.fullName})).join(", "));return i.prototype.resolveAll.call(this)};var p=/^[A-Z]/;function g(e,t){var n=t.parent.lookup(t.extend);if(n){var i=new a(t.fullName,t.id,t.type,t.rule,void 0,t.options);return i.declaringField=t,t.extensionField=i,n.add(i),!0}return!1}h.prototype._handleAdd=function(e){if(e instanceof a)void 0===e.extend||e.extensionField||g(0,e)||this.deferred.push(e);else if(e instanceof c)p.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof r)for(var t=0;t<this.deferred.length;)g(0,this.deferred[t])?this.deferred.splice(t,1):++t;for(var n=0;n<e.nestedArray.length;++n)this._handleAdd(e._nestedArray[n]);p.test(e.name)&&(e.parent[e.name]=e)}},h.prototype._handleRemove=function(e){if(e instanceof a){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof c)p.test(e.name)&&delete e.parent[e.name];else if(e instanceof i){for(var n=0;n<e.nestedArray.length;++n)this._handleRemove(e._nestedArray[n]);p.test(e.name)&&delete e.parent[e.name]}},h._configure=function(e,t,n){r=e,o=t,s=n}},function(e,t,n){"use strict";function i(e,t,n,i,r,o){r[0]=o.b=i[0],r[1]=o.a=-t*o.b+i[1];for(var s=2;s<e;s++)r[s]=-(t*o.a+n*o.b)+i[s],o.b=o.a,o.a=r[s]}function r(e,t,n,r,o,s,a,c,u){var l=new Object,h=3;return l.b=l.a=0,i(t,a,c,s,u,l),o.c=l.a,o.d=l.b,Math.abs(o.c)<=100*e*Math.abs(s[t-1])&&Math.abs(o.d)<=100*e*Math.abs(s[t-2])||(o.h=c*r,Math.abs(o.d)>=Math.abs(o.c)?(h=2,o.e=n/o.d,o.f=o.c/o.d,o.g=a*r,o.a3=o.e*(o.g+n)+o.h*(r/o.d),o.a1=-n+o.f*r,o.a7=o.h+(o.f+a)*n):(h=1,o.e=n/o.c,o.f=o.d/o.c,o.g=o.e*a,o.a3=o.e*n+(o.g+o.h/o.c)*r,o.a1=-n*(o.d/o.c)+r,o.a7=o.g*o.d+o.h*o.f+n)),h}function o(e,t,n,i,r,o,s,a,c){var u;if(3!=n)if(u=1==n?r:i,Math.abs(o.a1)>10*e*Math.abs(u))for(o.a7/=o.a1,o.a3/=o.a1,s[0]=c[0],s[1]=-c[0]*o.a7+c[1],l=2;l<t;l++)s[l]=-c[l-1]*o.a7+a[l-2]*o.a3+c[l];else for(s[0]=0,s[1]=-c[0]*o.a7,l=2;l<t;l++)s[l]=-c[l-1]*o.a7+a[l-2]*o.a3;else{s[1]=s[0]=0;for(var l=2;l<t;l++)s[l]=a[l-2]}}function s(e,t,n,i,r,o,s,a,c,u,l,h,d,p,g,f,v){var y,m,_,E,A,x,C,w;t.b=t.a=0,3!=e&&(2!=e?(y=n+d*s+h*u,m=a+(d+p*u)*c):(y=(n+l)*u+h,m=(u+d)*a+p*c),0!=(w=-(C=-((A=(_=-g[f-1]/v[f])*o)+(x=_*_*r))+p*(E=-(g[f-2]+_*v[f-1])/v[f])*i)+m+_*y)&&(t.a=-(d*(x+A)+p*(_*i+E*o))/w+d,t.b=p*(1+C/w)))}function a(e,t,n,i){var r,o,s;i.sr=i.si=i.lr=i.li=0,0!=e?0!=n?(r=t/2,Math.abs(r)<Math.abs(n)?(s=-(s=n>=0?e:-e)+r*(r/Math.abs(n)),o=Math.sqrt(Math.abs(s))*Math.sqrt(Math.abs(n))):(s=-e/r*(n/r)+1,o=Math.sqrt(Math.abs(s))*Math.abs(r)),s>=0?(o=r>=0?-o:o,i.lr=(-r+o)/e,i.sr=0!=i.lr?n/i.lr/e:i.sr):(i.lr=i.sr=-r/e,i.si=Math.abs(o/e),i.li=-i.si)):i.lr=-t/e:i.sr=0!=t?-n/t:i.sr}function c(e,t,n,c,u,l,h,d,p,g,f,v){var y,m,_,E,A,x,C,w,b,M,T,V=new Object,S=0,R=0;n.NZ=0,x=c,w=u;do{if(V.li=V.lr=V.si=V.sr=0,a(1,x,w,V),n.szr=V.sr,n.szi=V.si,n.lzr=V.lr,n.lzi=V.li,Math.abs(Math.abs(n.szr)-Math.abs(n.lzr))>.01*Math.abs(n.lzr))break;for(i(h,x,w,p,l,d),m=Math.abs(-n.szr*d.b+d.a)+Math.abs(n.szi*d.b),M=Math.sqrt(Math.abs(w)),y=2*Math.abs(l[0]),A=-n.szr*d.b,T=1;T<t;T++)y=y*M+Math.abs(l[T]);if(m<=20*(y=(9*(y=y*M+Math.abs(A+d.a))+2*Math.abs(A)-7*(Math.abs(d.a+A)+M*Math.abs(d.b)))*e)){n.NZ=2;break}if(++S>20)break;if(S>=2&&E<=.01&&m>=_&&!R){for(i(h,x-=x*(E=E<e?Math.sqrt(e):Math.sqrt(E)),w+=w*E,p,l,d),T=0;T<5;T++)o(e,t,r(e,t,d.a,d.b,f,v,x,w,g),d.a,d.b,f,v,g,l);R=1,S=0}_=m,o(e,t,r(e,t,d.a,d.b,f,v,x,w,g),d.a,d.b,f,v,g,l),s(r(e,t,d.a,d.b,f,v,x,w,g),d,d.a,f.a1,f.a3,f.a7,d.b,f.c,f.d,f.f,f.g,f.h,x,w,v,t,p),C=d.a,0!=(b=d.b)&&(E=Math.abs((-w+b)/b),x=C,w=b)}while(0!=b)}function u(e,t,n,i,r,o,s,a,c){var u,l,h,d,p,g,f,v,y,m,_,E=i-1;for(t.NZ=_=y=0,f=n.a;;){for(s[0]=g=r[0],m=1;m<o;m++)s[m]=g=g*f+r[m];for(h=Math.abs(g),d=Math.abs(f),u=.5*Math.abs(s[0]),m=1;m<o;m++)u=u*d+Math.abs(s[m]);if(h<=20*e*(2*u-h)){t.NZ=1,t.szr=f,t.szi=0;break}if(++_>10)break;if(_>=2&&Math.abs(v)<=.001*Math.abs(-v+f)&&h>p){y=1,t.a=f;break}for(p=h,c[0]=l=a[0],m=1;m<i;m++)c[m]=l=l*f+a[m];if(Math.abs(l)>10*Math.abs(a[E])*e)for(v=-g/l,a[0]=s[0],m=1;m<i;m++)a[m]=v*c[m-1]+s[m];else for(a[0]=0,m=1;m<i;m++)a[m]=c[m-1];for(l=a[0],m=1;m<i;m++)l=l*f+a[m];f+=v=Math.abs(l)>10*Math.abs(a[E])*e?-g/l:0}return y}function l(e,t,n,a,l,h,d,p,g,f,v){var y,m,_,E,A,x,C,w,b,M,T,V,S,R,L,P,O,D,I,N,k,B,F,j,z,U,G,Y,W=new Object,H=new Object,K=new Array(t),q=new Array(t);for(v.NZ=0,E=_=.25,L=-2*a,A=a,w=O=l,H.h=H.g=H.f=H.e=H.d=H.c=H.a7=H.a3=H.a1=W.b=W.a=0,i(g,L,O,p,f,W),U=r(e,d,y=W.a,m=W.b,H,h,L,O,K),F=0;F<n;F++){if(o(e,d,U,y,m,H,h,K,f),s(U=r(e,d,y,m,H,h,L,O,K),W,y,H.a1,H.a3,H.a7,m,H.c,H.d,H.f,H.g,H.h,L,O,h,d,p),P=W.a,I=D=W.b,M=0!=h[d-1]?-p[d]/h[d-1]:0,T=S=1,0!=F&&3!=U&&(G=(R=(S=0!=I?Math.abs((I-w)/I):S)<C?S*C:1)<E?1:0,(j=(V=(T=0!=M?Math.abs((M-A)/M):T)<x?T*x:1)<_?1:0)||G)){for(k=0;k<d;k++)q[k]=h[k];b=M,z=Y=0,N=1;do{if(B=1,N&&0==(N=0)&&j&&(!G||V<R));else{if(c(e,d,v,P,D,f,g,W,p,K,H,h),y=W.a,m=W.b,v.NZ>0)return;if(Y=1,E*=.25,z||!j)B=0;else for(k=0;k<d;k++)h[k]=q[k]}if(0!=B){if(W.a=b,B=u(e,v,W,d,p,g,f,h,K),b=W.a,v.NZ>0)return;if(z=1,_*=.25,0!=B){P=-(b+b),D=b*b;continue}}for(k=0;k<d;k++)h[k]=q[k]}while(G&&!Y);i(g,L,O,p,f,W),U=r(e,d,y=W.a,m=W.b,H,h,L,O,K)}w=I,A=M,C=S,x=T}}Object.defineProperty(t,"__esModule",{value:!0}),t.getRealPolynomialRoots=function(e){var t={Degree:e.length-1},n=new Array(e.length),i=new Array(e.length);!function(e,t,n,i){var r,o,s,c,u,h,d,p,g,f,v,y,m,_,E,A,x,C,w,b,M,T,V=e.Degree,S=Math.LN2,R=e.Degree+1,L=new Array(R),P=new Array(R),O=new Array(R),D=new Array(R),I=new Object,N=new Object;y=1;do{o=y,m=1+(y/=2)}while(m>1);var k=117549435082229e-52/o,B=Math.cos(1.6406094968746698),F=Math.sin(1.6406094968746698),j=Math.sqrt(.5),z=-j;for(N.NZ=x=0,N.szr=N.szi=N.lzr=N.lzi=0;0==t[V];)n[x]=i[x]=0,V--,x++;for(M=V+1;V>=1;){if(V<=2){V<2?(n[e.Degree-1]=-t[1]/t[0],i[e.Degree-1]=0):(I.li=I.lr=I.si=I.sr=0,a(t[0],t[1],t[2],I),n[e.Degree-2]=I.sr,i[e.Degree-2]=I.si,n[e.Degree-1]=I.lr,i[e.Degree-1]=I.li);break}for(d=0,p=340282346638529e24,U=0;U<M;U++)(f=Math.abs(t[U]))>d&&(d=f),0!=f&&f<p&&(p=f);if(((g=k/p)<=1&&d>=10||g>1&&340282346638529e24/g>=d)&&(g=0==g?117549435082229e-52:g,w=Math.floor(Math.log(g)/S+.5),1!=(u=Math.pow(2,w))))for(U=0;U<M;U++)t[U]*=u;for(var U=0;U<M;U++)P[U]=Math.abs(t[U]);P[V]=-P[V],b=V-1,f=Math.exp((Math.log(-P[V])-Math.log(P[0]))/V),0!=P[b]&&(f=(v=-P[V]/P[b])<f?v:f),v=f;do{for(v=.1*(f=v),h=P[0],U=1;U<M;U++)h=h*v+P[U]}while(h>0);for(c=f;Math.abs(c/f)>.005;){for(s=h=P[0],U=1;U<V;U++)s=f*s+(h=f*h+P[U]);f-=c=(h=f*h+P[V])/s}for(r=f,U=1;U<V;U++)L[U]=(V-U)*t[U]/V;for(L[0]=t[0],y=t[V],m=t[b],T=0==L[b]?1:0,C=0;C<5;C++)if(_=L[b],T){for(U=0;U<b;U++)L[x=b-U]=L[x-1];L[0]=0,T=0==L[b]?1:0}else{for(E=-y/_,U=0;U<b;U++)L[x=b-U]=E*L[x-1]+t[x];L[0]=t[0],T=Math.abs(L[b])<=Math.abs(m)*o*10?1:0}for(U=0;U<V;U++)D[U]=L[U];for(C=1;C<=20;C++){if(A=-F*z+B*j,z=F*j+B*z,l(o,R,20*C,r*(j=A),r,L,V,t,M,O,N),0!=N.NZ){for(n[x=e.Degree-V]=N.szr,i[x]=N.szi,V=(M-=N.NZ)-1,U=0;U<M;U++)t[U]=O[U];1!=N.NZ&&(n[x+1]=N.lzr,i[x+1]=N.lzi);break}for(U=0;U<V;U++)L[U]=D[U]}if(C>20){e.Degree-=V;break}}}(t,e,n,i);for(var r=[],o=e.length-t.Degree-1;o<e.length;o++)Math.abs(i[o])<1e-8&&r.push(n[o]);return r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.relaxBCurveToPerpendicular=t.closestBCurveSegments=t.maxDistanceSqrToHull=t.minDistanceSqrToHull=void 0;var i=n(1),r=n(0),o=n(37),s=n(35),a=function(e,t){var n,o=t.length/3,s=i.Vector3.asFloat64(0,0,0);for(n=0;n<o;++n)s[0]+=t[3*n],s[1]+=t[3*n+1],s[2]+=t[3*n+2];i.Vector3.scale(s,s,1/o),i.Vector3.sub(s,s,e);var a=i.Vector3.squaredLength(s);if(a<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE)return 0;var c=Number.POSITIVE_INFINITY;for(n=0;n<o;++n){var u=s[0]*(t[3*n]-e[0])+s[1]*(t[3*n+1]-e[1])+s[2]*(t[3*n+2]-e[2]);u<c&&(c=u)}return c<=0?0:c*c/a},c=function(e,t){for(var n=t.length/3,i=0,r=0;r<n;++r){var o=t[3*r]-e[0],s=t[3*r+1]-e[1],a=t[3*r+2]-e[2],c=o*o+s*s+a*a;c>i&&(i=c)}return i};t.minDistanceSqrToHull=a,t.maxDistanceSqrToHull=c,t.closestBCurveSegments=function(e,t,n,r){for(var o=Number.POSITIVE_INFINITY,s=[],u=0;u<t.length;++u){var l,h=t[u],d=h.getRangeUnlimited();if(r){l=!1;for(var p=0;p<r.length;++p)if(d[1]>=r[p][0]+i.FLOAT64_TOLERANCE&&d[0]<=r[p][1]-i.FLOAT64_TOLERANCE){l=!0;break}}else l=!0;if(l){var g=n?n[u]:0,f=h.getControlPoints(),v=a(e,f);if((v=Math.max(0,v-g))<=o){var y=c(e,f)+g;s.push({index:u,minDistSqr:v,maxDistSqr:y}),y<o&&(o=y)}}}return(s=s.filter((function(e){return e.minDistSqr<=o}))).sort((function(e,t){var n=e.minDistSqr-t.minDistSqr;return 0===n?e.maxDistSqr-t.maxDistSqr:n})),s},t.relaxBCurveToPerpendicular=function(e,t,n,r,a,c,u,l){var h=u||i.FLOAT64_TOLERANCE,d=l||32,p=t.length/3,g=e.length-p-1;return(0,s.newtonRaphson1D)((function(i){var s=(0,o.evaluateBCurveDerivs)(i,2,g,e,t,n),a=s[0],c=s[1],u=s[2],l=[a[0]-r[0],a[1]-r[1],a[2]-r[2]];return{val:2*(l[0]*c[0]+l[1]*c[1]+l[2]*c[2]),deriv:2*(l[0]*u[0]+l[1]*u[1]+l[2]*u[2]+(c[0]*c[0]+c[1]*c[1]+c[2]*c[2]))}}),c,a,h,d)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sphere=void 0;var i=n(1),r=n(3),o=n(0),s=n(12),a=n(6),c=n(14),u=n(2),l=function(){s.Surface.call(this),this._center=i.Vector3.createFloat64(),this._radius=0,this._xAxis=i.Vector3.createFloat64(),this._yAxis=i.Vector3.createFloat64(),this._zAxis=i.Vector3.createFloat64()};(l.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.SPHERE},l.prototype.clone=function(){var e=new l;return e.copy(this),e},l.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),this._radius=e._radius,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),i.Vector3.copy(this._zAxis,e._zAxis)},l.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._xAxis,this._zAxis)},l.prototype.set=function(e,t,n,r){i.Vector3.copy(this._center,e),u.ConsoleUtils.assert(t>o.KERNEL_TOLERANCE),this._radius=t;var s=void 0===n||i.Vector3.squaredLength(n)<o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE,a=void 0===r||i.Vector3.squaredLength(r)<o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE;s&&a?(i.Vector3.set(this._xAxis,1,0,0),i.Vector3.set(this._zAxis,0,0,1)):s?(i.Vector3.normalize(this._xAxis,r),i.Vector3.computeOrthogonal(this._zAxis,this._xAxis),i.Vector3.normalize(this._zAxis,this._zAxis)):a?(i.Vector3.normalize(this._zAxis,n),i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)):(u.ConsoleUtils.assert(i.Vector3.isOrthogonal(n,r,o.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._xAxis,r),i.Vector3.normalize(this._zAxis,n)),this._computeYAxis()},l.prototype.getRadius=function(){return this._radius},l.prototype.setRadius=function(e){u.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._radius=e},l.prototype.getCenter=function(){return this._center},l.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},l.prototype.getAxisDir=function(){return this._zAxis},l.prototype.setAxisDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,e),(i.Vector3.squaredLength(this._xAxis)<=o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE||!i.Vector3.isOrthogonal(this._xAxis,this._zAxis,o.KERNEL_ANGULAR_TOLERANCE))&&(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._computeYAxis()},l.prototype.getUvOriginDir=function(){return this._xAxis},l.prototype.setUvOriginDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,e),(i.Vector3.squaredLength(this._zAxis)<=o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE||!i.Vector3.isOrthogonal(this._xAxis,this._zAxis,o.KERNEL_ANGULAR_TOLERANCE))&&(i.Vector3.computeOrthogonal(this._zAxis,this._xAxis),i.Vector3.normalize(this._zAxis,this._zAxis)),this._computeYAxis()},l.prototype.evaluatePosition=function(e,t){var n=Math.sin(e),r=Math.cos(e),o=Math.sin(t),s=Math.cos(t),a=this._radius*r*s,c=this._radius*r*o,u=this._radius*n,l=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(l,l,this._xAxis,a),i.Vector3.scaleAndAdd(l,l,this._yAxis,c),i.Vector3.scaleAndAdd(l,l,this._zAxis,u),l},l.prototype.evaluateNormal=function(e,t){var n=Math.sin(e),r=Math.cos(e),o=Math.sin(t),s=r*Math.cos(t),a=r*o,c=n,u=i.Vector3.createFloat64();return i.Vector3.scale(u,this._xAxis,s),i.Vector3.scaleAndAdd(u,u,this._yAxis,a),i.Vector3.scaleAndAdd(u,u,this._zAxis,c),u},l.prototype.evaluateDu=function(e,t){var n=Math.sin(e),r=Math.cos(e),o=Math.sin(t),s=Math.cos(t),a=-this._radius*n*s,c=-this._radius*n*o,u=this._radius*r,l=i.Vector3.createFloat64();return i.Vector3.scale(l,this._xAxis,a),i.Vector3.scaleAndAdd(l,l,this._yAxis,c),i.Vector3.scaleAndAdd(l,l,this._zAxis,u),l},l.prototype.evaluateDv=function(e,t){var n=Math.cos(e),r=Math.sin(t),o=Math.cos(t),s=-this._radius*n*r,a=this._radius*n*o,c=i.Vector3.createFloat64();return i.Vector3.scale(c,this._xAxis,s),i.Vector3.scaleAndAdd(c,c,this._yAxis,a),c},l.prototype.closestParam=function(e){var t=i.Vector3.createFloat64();i.Vector3.sub(t,e,this._center);var n=i.Vector3.length(t);if(n<o.KERNEL_TOLERANCE)return{u:0,v:0};var s=i.Vector3.dot(t,this._xAxis),a=i.Vector3.dot(t,this._yAxis),c=i.Vector3.dot(t,this._zAxis);return{u:Math.asin((0,r.clamp)(c/n,-1,1)),v:Math.atan2(a,s)}},l.prototype.vParamLine=function(e){var t=Math.cos(e),n=Math.sin(e),r=this._radius*t,s=this._radius*n;if(Math.abs(r)>o.KERNEL_TOLERANCE){var u=new c.Circle,l=i.Vector3.clone(this._center);i.Vector3.scaleAndAdd(l,l,this._zAxis,s);var h=i.Vector3.clone(this._xAxis);i.Vector3.scale(h,h,r);var d=i.Vector3.clone(this._zAxis);return i.Vector3.negate(d,d),u.set(l,d,h),u}var p=i.Vector3.clone(this._center);return s=s<0?-this._radius:this._radius,i.Vector3.scaleAndAdd(p,p,this._zAxis,s),new a.Point(p)},l.prototype.uParamLine=function(e){var t=new c.Circle,n=Math.sin(e),r=Math.cos(e),o=this._radius*r,s=this._radius*n,a=i.Vector3.clone(this._xAxis);i.Vector3.scale(a,a,-s),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.normalize(a,a);var u=i.Vector3.clone(this._xAxis);return i.Vector3.scale(u,u,o),i.Vector3.scaleAndAdd(u,u,this._yAxis,s),t.set(this._center,a,u),t},l.prototype.getBoundingBox=function(e,t){e=e||[-Math.PI/2,Math.PI/2],t=t||[-Math.PI,Math.PI];var n=e[0],o=e[1],s=t[0],a=t[1],c=this.vParamLine(n).getBoundingBox(t);c.include(this.vParamLine(o).getBoundingBox(t)),c.include(this.uParamLine(s).getBoundingBox(e)),c.include(this.uParamLine(a).getBoundingBox(e));for(var u=i.Vector3.createFloat64(),l=0;l<3;++l)for(var h=0;h<2;++h){var d=0===h?1:-1,p=Math.atan2(d*this._yAxis[l],d*this._xAxis[l]),g=Math.asin(d*this._zAxis[l]);p=(0,r.adjustParameterToPeriodicRange)(p,t,r.PI2),g>n&&g<o&&p>s&&p<a&&(i.Vector3.set(u,0,0,0),u[l]=d*this._radius,c.includePoint(i.Vector3.add(u,this._center,u)))}return c},l.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),i.Vector3.transformAsDirectionMatrix44(this._zAxis,this._zAxis,e);var t=i.Vector3.length(this._xAxis);this._radius*=t,i.Vector3.normalize(this._xAxis,this._xAxis),i.Vector3.normalize(this._yAxis,this._yAxis),i.Vector3.normalize(this._zAxis,this._zAxis)},l.prototype.getRangeUnlimitedU=function(){return[-Math.PI/2,Math.PI/2]},l.prototype.getRangeUnlimitedV=function(){return[-Math.PI,Math.PI]},l.prototype.isPeriodicUnlimitedU=function(){return!1},l.prototype.isPeriodicUnlimitedV=function(){return!0},l.prototype.isClosedUnlimitedU=function(){return!1},l.prototype.isClosedUnlimitedV=function(){return!0},l.prototype.toObject=function(){var e=this.evaluatePosition(0,0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this.getCenter()),radius:this.vectorToObject(e),axis:this.vectorToObject(this.getAxisDir()),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.Sphere=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Torus=void 0;var i=n(1),r=n(3),o=n(0),s=n(12),a=n(6),c=n(14),u=n(2),l=function(){s.Surface.call(this),this._center=i.Vector3.createFloat64(),this._majorRadius=0,this._minorRadius=0,this._lemon=!1,this._xAxis=i.Vector3.createFloat64(),this._yAxis=i.Vector3.createFloat64(),this._zAxis=i.Vector3.createFloat64()};(l.prototype=Object.create(s.Surface.prototype)).getGeometryType=function(){return o.GEOMETRY_TYPES.TORUS},l.prototype.clone=function(){var e=new l;return e.copy(this),e},l.prototype.copy=function(e){s.Surface.prototype.copy.call(this,e),this._majorRadius=e._majorRadius,this._minorRadius=e._minorRadius,this._lemon=e._lemon,i.Vector3.copy(this._center,e._center),i.Vector3.copy(this._xAxis,e._xAxis),i.Vector3.copy(this._yAxis,e._yAxis),i.Vector3.copy(this._zAxis,e._zAxis)},l.prototype._computeYAxis=function(){i.Vector3.cross(this._yAxis,this._xAxis,this._zAxis)},l.prototype.set=function(e,t,n,r,s,a){i.Vector3.copy(this._center,e),u.ConsoleUtils.assert(t>o.KERNEL_TOLERANCE),this._majorRadius=t,u.ConsoleUtils.assert(n>o.KERNEL_TOLERANCE),this._minorRadius=n,u.ConsoleUtils.assert(i.Vector3.squaredLength(r)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,r),void 0!==s&&i.Vector3.squaredLength(s)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE?(u.ConsoleUtils.assert(i.Vector3.isOrthogonal(r,s,o.KERNEL_ANGULAR_TOLERANCE)),i.Vector3.normalize(this._xAxis,s)):(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._lemon=!0===a,this._computeYAxis()},l.prototype.getMajorRadius=function(){return this._majorRadius},l.prototype.setMajorRadius=function(e){u.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._majorRadius=e},l.prototype.getMinorRadius=function(){return this._minorRadius},l.prototype.setMinorRadius=function(e){u.ConsoleUtils.assert(e>o.KERNEL_TOLERANCE),this._minorRadius=e},l.prototype.getCenter=function(){return this._center},l.prototype.setCenter=function(e){i.Vector3.copy(this._center,e)},l.prototype.getAxisDir=function(){return this._zAxis},l.prototype.setAxisDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._zAxis,e),(i.Vector3.squaredLength(this._xAxis)<=o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE||!i.Vector3.isOrthogonal(this._xAxis,this._zAxis,o.KERNEL_ANGULAR_TOLERANCE))&&(i.Vector3.computeOrthogonal(this._xAxis,this._zAxis),i.Vector3.normalize(this._xAxis,this._xAxis)),this._computeYAxis()},l.prototype.getUvOriginDir=function(){return this._xAxis},l.prototype.setUvOriginDir=function(e){u.ConsoleUtils.assert(i.Vector3.squaredLength(e)>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE),i.Vector3.normalize(this._xAxis,e),this._computeYAxis()},l.prototype.isDoughnut=function(){return this._majorRadius>this._minorRadius+o.KERNEL_TOLERANCE},l.prototype.isVortex=function(){return Math.abs(this._majorRadius-this._minorRadius)<=o.KERNEL_TOLERANCE},l.prototype.isApple=function(){return this._majorRadius<this._minorRadius-o.KERNEL_TOLERANCE&&!this._lemon},l.prototype.isLemon=function(){return this._majorRadius<this._minorRadius-o.KERNEL_TOLERANCE&&this._lemon},l.prototype.setLemon=function(e){this._lemon=e},l.prototype.getSingularUParams=function(){var e,t,n;return this.isDoughnut()?[]:this.isApple()?(e=-this._majorRadius,t=this._minorRadius,[-(n=Math.acos(e/t)),n]):this.isLemon()?(e=this._minorRadius-this._majorRadius,t=this._minorRadius,[-(n=Math.acos(e/t)),n]):[-Math.PI,Math.PI]},l.prototype.evaluatePosition=function(e,t){var n=this._minorRadius*Math.cos(e);this.isLemon()?n-=this._majorRadius:n+=this._majorRadius;var r=n*Math.cos(t),o=n*Math.sin(t),s=this._minorRadius*Math.sin(e),a=i.Vector3.clone(this._center);return i.Vector3.scaleAndAdd(a,a,this._xAxis,r),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),a},l.prototype.evaluateNormal=function(e,t){var n=Math.sin(e),r=Math.cos(e),o=Math.sin(t),s=r*Math.cos(t),a=r*o,c=n,u=i.Vector3.createFloat64();return i.Vector3.scale(u,this._xAxis,s),i.Vector3.scaleAndAdd(u,u,this._yAxis,a),i.Vector3.scaleAndAdd(u,u,this._zAxis,c),u},l.prototype.evaluateDu=function(e,t){var n=-this._minorRadius*Math.sin(e),r=n*Math.cos(t),o=n*Math.sin(t),s=this._minorRadius*Math.cos(e),a=i.Vector3.createFloat64();return i.Vector3.scale(a,this._xAxis,r),i.Vector3.scaleAndAdd(a,a,this._yAxis,o),i.Vector3.scaleAndAdd(a,a,this._zAxis,s),a},l.prototype.evaluateDv=function(e,t){var n=this._minorRadius*Math.cos(e);this.isLemon()?n-=this._majorRadius:n+=this._majorRadius;var r=-n*Math.sin(t),o=n*Math.cos(t),s=i.Vector3.createFloat64();return i.Vector3.scale(s,this._xAxis,r),i.Vector3.scaleAndAdd(s,s,this._yAxis,o),s},l.prototype.closestParam=function(e){var t=i.Vector3.createFloat64();i.Vector3.sub(t,e,this._center);var n=i.Vector3.dot(t,this._xAxis),r=i.Vector3.dot(t,this._yAxis),s=i.Vector3.dot(t,this._zAxis),a=Math.sqrt(n*n+r*r);return this.isLemon()?a+=this._majorRadius:a-=this._majorRadius,{u:s*s+a*a>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE?Math.atan2(s,a):0,v:n*n+r*r>o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE?Math.atan2(r,n):0}},l.prototype.vParamLine=function(e){var t=this._minorRadius*Math.cos(e);this.isLemon()?t-=this._majorRadius:t+=this._majorRadius;var n=this._minorRadius*Math.sin(e);if(Math.abs(t)>o.KERNEL_TOLERANCE){var r=new c.Circle,s=i.Vector3.clone(this._center);i.Vector3.scaleAndAdd(s,s,this._zAxis,n);var u=i.Vector3.clone(this._xAxis);i.Vector3.scale(u,u,t);var l=i.Vector3.clone(this._zAxis);return i.Vector3.negate(l,l),r.set(s,l,u),r}var h=i.Vector3.clone(this._center),d=this.getSingularUParams();return d[0]&&n<0?n=this._minorRadius*Math.sin(d[0]):d[1]&&n>0&&(n=this._minorRadius*Math.sin(d[1])),i.Vector3.scaleAndAdd(h,h,this._zAxis,n),new a.Point(h)},l.prototype.uParamLine=function(e){var t=new c.Circle,n=Math.sin(e),r=Math.cos(e),o=this._majorRadius*r,s=this._majorRadius*n;this.isLemon()&&(o=-o,s=-s);var a=i.Vector3.clone(this._center);i.Vector3.scaleAndAdd(a,a,this._xAxis,o),i.Vector3.scaleAndAdd(a,a,this._yAxis,s);var u=this._minorRadius*r,l=this._minorRadius*n,h=i.Vector3.clone(this._xAxis);i.Vector3.scale(h,h,-l),i.Vector3.scaleAndAdd(h,h,this._yAxis,u),i.Vector3.normalize(h,h);var d=i.Vector3.clone(this._xAxis);return i.Vector3.scale(d,d,u),i.Vector3.scaleAndAdd(d,d,this._yAxis,l),t.set(a,h,d),t},l.prototype.getBoundingBox=function(e,t){e=e||(this.isDoughnut()?[-Math.PI,Math.PI]:this.getSingularUParams()),t=t||[-Math.PI,Math.PI];var n=e[0],o=e[1],s=t[0],a=t[1],c=this.vParamLine(n).getBoundingBox(t);c.include(this.vParamLine(o).getBoundingBox(t)),c.include(this.uParamLine(s).getBoundingBox(e)),c.include(this.uParamLine(a).getBoundingBox(e));for(var u=i.Vector3.createFloat64(),l=i.Vector3.createFloat64(),h=0;h<3;++h)for(var d=0;d<2;++d){var p=0===d?-1:1,g=Math.atan2(p*this._yAxis[h],p*this._xAxis[h]);if((g=(0,r.adjustParameterToPeriodicRange)(g,t,r.PI2))>s&&g<a){var f=this.uParamLine(g);u=f.evaluatePosition(0),i.Vector3.sub(u,u,f.getCenter()),l=f.evaluatePosition(Math.PI/2),i.Vector3.sub(l,l,f.getCenter());var v=(0,r.minMaxCosSinFunc)(u[h],l[h],f.getCenter()[h],e);0===h?c.includeX(v[d]):1===h?c.includeY(v[d]):c.includeZ(v[d])}}return c},l.prototype.transform=function(e){i.Vector3.transformMatrix44(this._center,this._center,e),i.Vector3.transformAsDirectionMatrix44(this._xAxis,this._xAxis,e),i.Vector3.transformAsDirectionMatrix44(this._yAxis,this._yAxis,e),i.Vector3.transformAsDirectionMatrix44(this._zAxis,this._zAxis,e);var t=i.Vector3.length(this._xAxis);this._majorRadius*=t,this._minorRadius*=t,i.Vector3.normalize(this._xAxis,this._xAxis),i.Vector3.normalize(this._yAxis,this._yAxis),i.Vector3.normalize(this._zAxis,this._zAxis)},l.prototype.getRangeUnlimitedU=function(){return this.isDoughnut()?[-Math.PI,Math.PI]:this.getSingularUParams()},l.prototype.getRangeUnlimitedV=function(){return[-Math.PI,Math.PI]},l.prototype.isPeriodicUnlimitedU=function(){return this.isDoughnut()},l.prototype.isPeriodicUnlimitedV=function(){return!0},l.prototype.isClosedUnlimitedU=function(){return this.isDoughnut()||this.isVortex()},l.prototype.isClosedUnlimitedV=function(){return!0},l.prototype.toObject=function(){var e=this.evaluatePosition(0,0);return i.Vector3.sub(e,e,this.getCenter()),{center:this.vectorToObject(this.getCenter()),coordAxis:this.vectorToObject(this.getUvOriginDir()),axis:this.vectorToObject(this.getAxisDir()),majorRadius:this.getMajorRadius(),minorRadius:this.getMinorRadius(),lemon:this.isLemon(),uRange:this.rangeToObject(this.getRangeU(),this.isLimitedU()),vRange:this.rangeToObject(this.getRangeV(),this.isLimitedV())}},t.Torus=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateBSurfaceDerivs=t.evaluateBSurfacePoint=void 0;var i=n(1),r=n(3),o=n(17),s=n(37);t.evaluateBSurfacePoint=function(e,t,n,r,a,c,u,l){return l&&l.length>0?function(e,t,n,r,a,c,u,l){for(var h,d=c.length-r-1,p=(0,o.findKnotSpan)(e,a),g=(0,s.evaluateBasisFunctions)(p,e,n,a),f=(0,o.findKnotSpan)(t,c),v=(0,s.evaluateBasisFunctions)(f,t,r,c),y=p-n,m=i.Vector4.createFloat64(),_=i.Vector4.createFloat64(),E=0;E<=r;E++){i.Vector4.set(_,0,0,0,0),h=f-r+E;for(var A=0;A<=n;A++){var x=(y+A)*d+h,C=g[A]*l[x];_[0]+=C*u[3*x],_[1]+=C*u[3*x+1],_[2]+=C*u[3*x+2],_[3]+=C}m[0]+=v[E]*_[0],m[1]+=v[E]*_[1],m[2]+=v[E]*_[2],m[3]+=v[E]*_[3]}return i.Vector3.createFloat64FromValues(m[0]/m[3],m[1]/m[3],m[2]/m[3])}(e,t,n,r,a,c,u,l):function(e,t,n,r,a,c,u){for(var l,h=c.length-r-1,d=(0,o.findKnotSpan)(e,a),p=(0,s.evaluateBasisFunctions)(d,e,n,a),g=(0,o.findKnotSpan)(t,c),f=(0,s.evaluateBasisFunctions)(g,t,r,c),v=d-n,y=i.Vector3.createFloat64(),m=i.Vector3.createFloat64(),_=0;_<=r;_++){i.Vector3.set(m,0,0,0),l=g-r+_;for(var E=0;E<=n;E++){var A=(v+E)*h+l;m[0]+=p[E]*u[3*A],m[1]+=p[E]*u[3*A+1],m[2]+=p[E]*u[3*A+2]}y[0]+=f[_]*m[0],y[1]+=f[_]*m[1],y[2]+=f[_]*m[2]}return y}(e,t,n,r,a,c,u)},t.evaluateBSurfaceDerivs=function(e,t,n,a,c,u,l,h,d){return function(e,t,n,a,c,u,l,h,d){var p,g,f,v,y,m,_=new Array(n+1),E=new Array(n+1),A=new Array(n+1),x=new Array(n+1);for(p=0;p<=n;p++){for(_[p]=new Array(n+1-p),E[p]=new Array(n+1-p),g=0;g<=n-p;g++)_[p][g]=i.Vector3.createFloat64(),E[p][g]=0;A[p]=new Array(a+1),x[p]=new Array(c+1)}var C=Math.min(n,a),w=(0,o.findKnotSpan)(e,u);(0,s.evaluateBasisDerivatives)(w,e,a,C,u,A);var b=Math.min(n,c),M=(0,o.findKnotSpan)(t,l);(0,s.evaluateBasisDerivatives)(M,t,c,b,l,x);var T=d&&d.length>0,V=l.length-c-1,S=new Array(c+1);for(p=0;p<=C;p++){for(f=0;f<=c;f++)for(S[f]=[0,0,0,0],v=0;v<=a;v++){var R=(w-a+v)*V+(M-c+f),L=A[p][v];T&&(L*=d[R],S[f][3]+=L),S[f][0]+=L*h[3*R],S[f][1]+=L*h[3*R+1],S[f][2]+=L*h[3*R+2]}var P=Math.min(n-p,b);for(g=0;g<=P;g++)for(f=0;f<=c;f++)_[p][g][0]+=x[g][f]*S[f][0],_[p][g][1]+=x[g][f]*S[f][1],_[p][g][2]+=x[g][f]*S[f][2],T&&(E[p][g]+=x[g][f]*S[f][3])}if(T){var O=r.binomialCoefficients,D=i.Vector3.createFloat64();for(p=0;p<=n;p++)for(g=0;g<=n-p;g++){var I=_[p][g];for(m=1;m<=g;m++)i.Vector3.scaleAndAdd(I,I,_[p][g-m],-O[g][m]*E[0][m]);for(y=1;y<=p;y++){for(i.Vector3.scaleAndAdd(I,I,_[p-y][g],-O[p][y]*E[y][0]),i.Vector3.set(D,0,0,0),m=1;m<=g;m++)i.Vector3.scaleAndAdd(D,D,_[p-y][g-m],O[g][m]*E[y][m]);i.Vector3.scaleAndAdd(I,I,D,-O[p][y])}i.Vector3.scale(I,I,1/E[0][0])}}return _}(e,t,n,a,c,u,l,h,d)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.newtonRaphson2D=t.RelaxResult=void 0;var i=n(1),r={};r[r.Success=0]="Success",r[r.OutOfRange=1]="OutOfRange",r[r.DegenerateStep=2]="DegenerateStep",r[r.TooManySteps=3]="TooManySteps",r[r.RootNotFound=4]="RootNotFound",t.RelaxResult=r,t.newtonRaphson2D=function(e,t,n,o,s){o=o||1e-12,s=s||100;var a=[void 0,void 0];n&&2===n.length&&(n[0]&&2===n[0].length&&(a[0]=n[0]),n[1]&&2===n[1].length&&(a[1]=n[1])),a[0]&&(a[0][0],a[0][1]),a[1]&&(a[1][0],a[1][1]);for(var c=[0,0],u=1/0,l=1/0,h=!1,d=i.Matrix22.createFloat64(),p=i.Matrix22.createFloat64(),g=i.Vector2.clone(t),f=r.Success,v=0;v<=s;v++){var y=e(g);if(u=i.Vector2.squaredLength(y.val),g[0],g[1],u<i.FLOAT64_TOLERANCE*i.FLOAT64_TOLERANCE){f=r.Success;break}if(v>0&&Math.max(Math.abs(c[0]),Math.abs(c[1]))<o){u>=l&&(i.Vector2.sub(g,g,c),u=l,y=e(g));var m=10*o*(i.Vector2.len(y.deriv1)+i.Vector2.len(y.deriv2));f=u>m*m?h?r.OutOfRange:r.RootNotFound:r.Success;break}if(v===s){u>=l&&(i.Vector2.sub(g,g,c),u=l),f=r.TooManySteps;break}if(v>0&&u>=l){var _=l/(l+u);_=Math.max(_,.1),i.Vector2.sub(g,g,c),i.Vector2.scale(c,c,_),i.Vector2.add(g,g,c),u=l}else{if(l=u,i.Matrix22.set(d,-y.deriv1[0],-y.deriv1[1],-y.deriv2[0],-y.deriv2[1]),Math.abs(i.Matrix22.determinant(d))<i.FLOAT64_TOLERANCE){f=r.DegenerateStep;break}i.Matrix22.invert(p,d),i.Vector2.transformMatrix22(c,y.val,p),c[0],c[1],i.Vector2.add(g,g,c),h=!1;for(var E=0;E<3;E++){var A=E>=2,x=E%2;if(a[x]){var C=0;if(g[x]<a[x][0]?(C=g[x]-a[x][0],g[x]=a[x][0]):g[x]>a[x][1]&&(C=g[x]-a[x][1],g[x]=a[x][1]),0!==C){g[x];var w=c[x];if(c[x]-=C,A);else{var b=1-x;if(g[b]-=c[b],Math.abs(c[x])>o){var M=c[x]/w;c[b]*=M}else{h=!0;var T=0===b?y.deriv1:y.deriv2;c[b]=-i.Vector2.dot(y.val,T)/Math.max(i.Vector2.dot(T,T),i.FLOAT64_TOLERANCE)}g[b]+=c[b],c[0],c[1]}}}}}}return r[f],g[0],g[1],{param:g,status:f}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOrderedFacesOnVertex=function(e){var t=e.getEdges(),n=new i(e),r=[];return t.forEach((function(t){for(var i=t.getCoedges(),o=0;o<i.length;++o)if(i[o].getStartVertex()===e){var s=n.marchFan(i[o]);s.faces.length>0&&r.push(s);break}})),r};var i=function(){function e(t){_classCallCheck(this,e),this._vertex=t,this._visitedCoeds=new Set,this._unvisitedCoeds=new Set,this._faces=[],this._type="unset"}return _createClass(e,[{key:"addVisitedCoedge",value:function(e){this._visitedCoeds.add(e),this._unvisitedCoeds.delete(e)}},{key:"getNextFace",value:function(e){var t=e.getFace();t&&this._faces.push(t),this.addVisitedCoedge(e)}},{key:"getPrevFace",value:function(e){var t=e.getFace();t&&this._faces.unshift(t),this.addVisitedCoedge(e)}},{key:"collectUnvisitedCoeds",value:function(e){var t=this;e.getEdge().getCoedges().forEach((function(e){t._visitedCoeds.has(e)||e.getStartVertex()!==t._vertex||t._unvisitedCoeds.add(e)}))}},{key:"nextFace",value:function(e){var t=e.getPartner();if(t){if(!this._visitedCoeds.has(t)){if(t.getPartner()!==e&&(this._type="unordered",this.collectUnvisitedCoeds(e)),t.getEndVertex()!==this._vertex)return this._type="unordered",void this.collectUnvisitedCoeds(t);this.addVisitedCoedge(t);var n=t.getNext();if(!this._visitedCoeds.has(n))return this.getNextFace(n),n;"unset"===this._type&&(this._type="cycle")}}else"unset"===this._type&&(this._type="chain")}},{key:"prevFace",value:function(e){var t=e.getPrevious();if(!this._visitedCoeds.has(t)){var n=t.getPartner();return n&&!this._visitedCoeds.has(n)?(n.getPartner()!==t&&(this._type="unordered",this.collectUnvisitedCoeds(t)),n.getStartVertex()!==this._vertex?(this._type="unordered",void this.collectUnvisitedCoeds(n.getNext())):(this.addVisitedCoedge(t),this.getPrevFace(n),n)):void 0}}},{key:"collectFanFaces",value:function(e){if(!this._visitedCoeds.has(e)){var t=e;this.getNextFace(t);for(var n=t;n;)n=this.nextFace(n);for(n=t;n;)n=this.prevFace(n)}}},{key:"marchFan",value:function(e){for(this._faces=[],this._type="unset",this.collectFanFaces(e);this._unvisitedCoeds.size>0;){var t=this._unvisitedCoeds.values();this.collectFanFaces(t.next().value)}return{faces:this._faces,type:this._type}}}]),e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Attribute=void 0;var i=n(44),r={"autodesk.brep:nmiattributestr-1.0.0":"nmiattributestr","autodesk.brep:nmiattributearr-1.0.0":"nmiattributearr","autodesk.brep:textattribute-1.0.0":"textattribute"},o=function(e,t){i.Base.call(this),this._topologies=[],this.typeid=e,this.values=t||{}};(o.prototype=Object.create(i.Base.prototype)).getValues=function(){return this.values},o.prototype.getTypeid=function(){return this.typeid},o.prototype.getTopologies=function(){return this._topologies},o.prototype.addTopology=function(e){this._topologies?this._topologies.push(e):this._topologies=[e]},o.prototype.removeTopology=function(e){var t=this._topologies.indexOf(e);return t>-1&&(this._topologies.splice(t,1),!0)},o.prototype.toObject=function(){return this.values},o.prototype.addToModelObject=function(e){if(!e.attributes[this.getGuid()]){var t=r[this.typeid];if(t){var n={};n[t]=this.toObject(),e.attributes[this.getGuid()]=n}else console.warn("Attribute.addToModelObject : Unknown attribute type for proto object!")}},t.Attribute=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SketchRegionSolver=void 0;var i=n(1),r=n(3),o=n(0),s=n(18),a=n(7),c=n(14),u=n(33),l=n(23),h=n(6),d=n(13),p=n(27),g=n(81),f=n(82),v=n(56),y=n(36),m=n(55),_=n(41),E=n(112),A=n(113),x=n(2),C=n(8),w=function(e){return e&&e.__esModule?e:{default:e}}(n(42)),b=function(){this.SIDE={LEFT:0,RIGHT:1},this._sketch=void 0,this._intersectionVertices=[],this._edgeSegments=[],this._cells=[],this._faces=[],this._workspace={edgeIntersections:[],edgeOverlapRegions:[],segmentBlackList:[],edges:[],edgeIDs:[],sweepLineIntersections:void 0,sweepLineRegions:void 0,currentVertex:void 0,nextVertex:void 0,edgesPerCell:void 0},this._sketchRegionTopologies={},this._planeGeometry=new s.Plane,this._planeGeometry.set([0,0,0],[0,0,1],[1,0,0]),this._sketchSummary={},this._internalToFinalMap=null,this._finalFaces=[],this._progenitorMap=null};b.prototype.compute=function(e){this._sketchEdges=e,this._initializeWorkspace(),this._findIntersections(),this._addGraphEdges(),this._mergeCoincidentSegments(),this._sortEdgesAroundVertex(),this._assignAdjacentEdges(),this._sweepRegions(),this._assignleftmostEdges(),this._removeGrazingIntersectionVertices(),this._updateVertexGuidLists(),this._removeTemporaryVertices(),this._assignLoops(),this._updateSketchRegionTopology(),this._clearWorkspace(),this._prepareResult()},b.prototype._initializeWorkspace=function(){var e=this._workspace;e.edges={};for(var t=0;t<this._sketchEdges.length;++t)e.edges[this._sketchEdges[t].getGuid()]=this._sketchEdges[t];for(e.edgeIDs=Object.getOwnPropertyNames(e.edges).sort(),e.edgeIntersections={},e.edgeOverlapRegions={},e.segmentBlackList={},t=0;t<e.edgeIDs.length;t++)e.edgeIntersections[e.edgeIDs[t]]=[],e.edgeOverlapRegions[e.edgeIDs[t]]=[],e.segmentBlackList[e.edgeIDs[t]]=[];e.sweepLineIntersections=void 0,e.sweepLineRegions=void 0,e.edgesPerCell=[],this._faces=[]},b.prototype._clearWorkspace=function(){this._workspace={edgeIntersections:[],edgeOverlapRegions:[],segmentBlackList:[],edges:[],edgeIDs:[],sweepLineIntersections:void 0,sweepLineRegions:void 0,currentVertex:void 0,nextVertex:void 0,sweepLinePosition:void 0,edgesPerCell:[]}},b.prototype._findIntersections=function(){for(var e=this._workspace,t=0;t<e.edgeIDs.length;t++){for(var n=e.edges[e.edgeIDs[t]],s=t;s<e.edgeIDs.length;s++){var a=e.edges[e.edgeIDs[s]];if(s>t||n.getCurveType()===o.GEOMETRY_TYPES.BCURVE)for(var c=(0,g.computeCurveCurveIntersections)(n,a,!0,!1,o.KERNEL_TOLERANCE),u=0;u<c.length;u++){var l=c[u];if(l.rangeInfo)e.edgeIntersections[e.edgeIDs[t]].push(w.default.extend(l.rangeInfo[0],{temporary:!1})),e.edgeIntersections[e.edgeIDs[t]].push(w.default.extend(l.rangeInfo[1],{temporary:!1})),e.edgeIntersections[e.edgeIDs[s]].push(w.default.extend(l.rangeByInfo[0],{temporary:!1})),e.edgeIntersections[e.edgeIDs[s]].push(w.default.extend(l.rangeByInfo[1],{temporary:!1})),e.edgeOverlapRegions[e.edgeIDs[t]].push({overlapRange:(0,r.convertToOtherPeriodicRange)([l.rangeInfo[0].param,l.rangeInfo[1].param],n.getRange(),n.getCurve().getPeriod(),o.KERNEL_TOLERANCE),otherEdge:e.edgeIDs[s],otherRange:(0,r.convertToOtherPeriodicRange)([l.rangeByInfo[0].param,l.rangeByInfo[1].param],a.getRange(),a.getCurve().getPeriod(),o.KERNEL_TOLERANCE)}),e.edgeOverlapRegions[e.edgeIDs[s]].push({overlapRange:(0,r.convertToOtherPeriodicRange)([l.rangeByInfo[0].param,l.rangeByInfo[1].param],a.getRange(),a.getCurve().getPeriod(),o.KERNEL_TOLERANCE),otherEdge:e.edgeIDs[t],otherRange:(0,r.convertToOtherPeriodicRange)([l.rangeInfo[0].param,l.rangeInfo[1].param],n.getRange(),n.getCurve().getPeriod(),o.KERNEL_TOLERANCE)});else{if(l.cutInfo.param<n.t0()||l.cutInfo.param>n.t1()){C.DebugUtils.warn("Intersection outside the bounds of the edge, ignoring");continue}e.edgeIntersections[e.edgeIDs[t]].push(w.default.defaults(l.cutInfo,{temporary:!1,virtualIntersection:!1})),e.edgeIntersections[e.edgeIDs[s]].push(w.default.defaults(l.cutByInfo,{temporary:!1,virtualIntersection:!1}))}}}var h=n.getStartVertex(),d=n.getEndVertex(),p=n.t0();h&&void 0!==w.default.findWhere(e.edgeIntersections[e.edgeIDs[t]],{param:p,atVertex:h})||e.edgeIntersections[e.edgeIDs[t]].push({param:p,atVertex:h,temporary:!1,virtualIntersection:void 0});var f=n.t1();d&&void 0!==w.default.findWhere(e.edgeIntersections[e.edgeIDs[t]],{param:f,atVertex:d})||e.edgeIntersections[e.edgeIDs[t]].push({param:f,atVertex:d,temporary:!1,virtualIntersection:void 0}),this._makeEdgeXMonotone(n,e.edgeIntersections[e.edgeIDs[t]])}var v=[];for(t=0;t<e.edgeIDs.length;t++)for(s=0;s<e.edgeIntersections[e.edgeIDs[t]].length;s++)v.push({position:e.edges[e.edgeIDs[t]].evaluatePosition(e.edgeIntersections[e.edgeIDs[t]][s].param),virtualIntersection:e.edgeIntersections[e.edgeIDs[t]][s].virtualIntersection});for(t=0;t<e.edgeIDs.length;t++){var y=e.edges[e.edgeIDs[t]];for(s=0;s<v.length;s++){var m=v[s];if(y.getBoundingBox().isPointInsideWithTolerance(m.position,o.KERNEL_TOLERANCE)){var _=y.closestToPointParam(m.position);i.Vector3.distance(m.position,y.evaluatePosition(_))<o.KERNEL_TOLERANCE&&_>y.t0()+o.PARAMETER_SPACE_TOLERANCE&&_<y.t1()-o.PARAMETER_SPACE_TOLERANCE&&e.edgeIntersections[e.edgeIDs[t]].push({param:_,atVertex:null,temporary:!0,virtualIntersection:m.virtualIntersection})}}}},b.prototype._addGraphEdges=function(){var e=this._workspace;this._intersectionVertices=[],this._edgeSegments=[];for(var t=function(t,n){var i=e.segmentBlackList[t],s=e.edges[t].getCurve(),a=s.getPeriod(),c=e.edges[t].isReversed()?-1:1,u=o.KERNEL_TOLERANCE/s.tangentLength(c*n[0]),l=o.KERNEL_TOLERANCE/s.tangentLength(c*n[1]);if(e.edges[t].getCurve().isPeriodic()){for(var h=0;h<i.length;h++)if((0,r.periodicDifference)(i[h].range[0],n[0],a)<u&&(0,r.periodicDifference)(i[h].range[1],n[1],a)<l)return i[h].edge}else for(h=0;h<i.length;h++)if(Math.abs(i[h].range[0]-n[0])<u&&Math.abs(i[h].range[1]-n[1])<l)return i[h].edge},n=0;n<e.edgeIDs.length;n++){var s=e.edges[e.edgeIDs[n]],a=1,c=this._createGUIDfromEdgeAndLocalID(s,a);e.edgeIntersections[e.edgeIDs[n]]=e.edgeIntersections[e.edgeIDs[n]].sort((function(e,t){return e.param-t.param}));for(var u=e.edgeIntersections[e.edgeIDs[n]],l=void 0,h=0;h<u.length;h++){var d=s.evaluatePosition(u[h].param),p=this._findVertexIndex(d);void 0===p?(p=this._intersectionVertices.length,this._intersectionVertices.push({position:d,adjacentEdges:[],vertices:[],index:p,guidList:[],mergedPositions:[],topologyVertex:void 0,temporary:u[h].temporary,virtualIntersection:u[h].virtualIntersection})):(this._intersectionVertices[p].temporary=this._intersectionVertices[p].temporary&&u[h].temporary,void 0!==u[h].virtualIntersection&&(void 0===this._intersectionVertices[p].virtualIntersection?this._intersectionVertices[p].virtualIntersection=u[h].virtualIntersection:this._intersectionVertices[p].virtualIntersection=this._intersectionVertices[p].virtualIntersection&&u[h].virtualIntersection),this._intersectionVertices[p].mergedPositions.push(d));var g=this._intersectionVertices[p];if(u[h].atVertex&&-1===g.vertices.indexOf(u[h].atVertex)&&g.vertices.push(u[h].atVertex),h>0&&l!==p){c=this._createGUIDfromEdgeAndLocalID(s,a),a++;var f=[u[h-1].param,u[h].param],v=t(s.getGuid(),f);if(void 0===v){var y={originalEdge:s,parameterRange:f,startVertex:this._intersectionVertices[l],endVertex:this._intersectionVertices[p],coincidentRanges:[],adjacent:[{prevEdge:void 0,nextEdge:void 0,face:void 0},{prevEdge:void 0,nextEdge:void 0,face:void 0}],index:this._edgeSegments.length,localGuid:c,topologyEdge:void 0};this._edgeSegments.push(y),this._intersectionVertices[l].adjacentEdges.push(y),this._intersectionVertices[p].adjacentEdges.push(y);for(var m=0;m<e.edgeOverlapRegions[e.edgeIDs[n]].length;m++){var _=e.edgeOverlapRegions[e.edgeIDs[n]][m],E=f,A=o.KERNEL_TOLERANCE;if(s.getCurve().isPeriodic()&&(s.getCurveType()===o.GEOMETRY_TYPES.CIRCLE&&(A/=s.getCurve().getRadius()),E=(0,r.convertToOtherPeriodicRange)(E,s.getRange(),s.getCurve().getPeriod(),A)),E[0]>=_.overlapRange[0]-o.KERNEL_TOLERANCE&&E[1]<=_.overlapRange[1]+o.KERNEL_TOLERANCE){var x=_.otherEdge,C=[e.edges[x].getCurve().closestToPointParam(y.startVertex.position),e.edges[x].getCurve().closestToPointParam(y.endVertex.position)];if(e.edges[x].getCurve().isPeriodic()){var w=y.originalEdge.getCurve().evaluateDt(y.parameterRange[0]),b=e.edges[x].getCurve().evaluateDt(C[0]);for(i.Vector3.dot(w,b)<0&&(M=C[0],C[0]=C[1],C[1]=M);C[1]<C[0];)C[1]+=e.edges[x].getCurve().getPeriod()}else if(C[0]>C[1]){var M=C[0];C[0]=C[1],C[1]=M}e.segmentBlackList[_.otherEdge].push({range:C,edge:y})}}}else{var T,V=i.Vector3.distance(v.startVertex.position,s.evaluatePosition(f[0]))>i.Vector3.distance(v.startVertex.position,s.evaluatePosition(f[1]));if(v.coincidentRanges.push({originalEdge:s,parameterRange:f,localGuid:c,flipped:V}),0===g.adjacentEdges.length&&((T=i.Vector3.distance(d,v.startVertex.position)<i.Vector3.distance(d,v.endVertex.position)?v.startVertex:v.endVertex).mergedPositions.push(d),d=T.position,p=T.index,u[h].atVertex&&-1===T.vertices.indexOf(u[h].atVertex)&&T.vertices.push(u[h].atVertex),this._intersectionVertices.pop()),v.startVertex.index!==l&&v.endVertex.index!==l){var S=v.startVertex.index===p?v.endVertex:v.startVertex,R=this._intersectionVertices[l];for(m=0;m<R.adjacentEdges.length;m++){var L=R.adjacentEdges[m];L.startVertex===R&&(L.startVertex=S),L.endVertex===R&&(L.endVertex=S),S.adjacentEdges.push(L)}for(S.mergedPositions.push(R.position),m=0;m<R.mergedPositions.length;m++)S.mergedPositions.push(R.mergedPositions[m]);for(u[h].atVertex&&-1===S.vertices.indexOf(u[h].atVertex)&&S.vertices.push(u[h].atVertex),this._intersectionVertices.splice(l,1),m=l;m<this._intersectionVertices.length;m++)this._intersectionVertices[m].index=m}}}l=p}}},b.prototype._mergeCoincidentSegments=function(){for(var e,t={},n=0;n<this._intersectionVertices.length;n++){for(var i=this._intersectionVertices[n],r={},s=0;s<i.adjacentEdges.length;s++){var a=(e=i.adjacentEdges[s]).startVertex===i?e.endVertex:e.startVertex;t[String(i.index)+"_"+String(a.index)]||(r[String(a.index)]=r[String(a.index)]||[],r[String(a.index)].push(e))}var c=w.default.keys(r);for(s=0;s<c.length;s++)if(t[c[s]+"_"+String(i.index)]=!0,r[c[s]].length>1)for(var u=r[c[s]],l=0;l<u.length;l++){for(var h=[],d=l+1;d<u.length;d++)(0,f.curvesAreCoincident)(u[l].originalEdge.getCurve(),u[d].originalEdge.getCurve(),u[l].parameterRange,u[d].parameterRange,o.KERNEL_TOLERANCE)&&(h.push(u[d]),u.splice(d,1),d--);for(d=0;d<h.length;d++){var p=h[d];u[l].coincidentRanges.push({originalEdge:p.originalEdge,parameterRange:p.parameterRange,localGuid:p.localGuid,flipped:p.startVertex!==u[l].startVertex}),p.startVertex.adjacentEdges.splice(p.startVertex.adjacentEdges.indexOf(p),1),p.endVertex.adjacentEdges.splice(p.endVertex.adjacentEdges.indexOf(p),1);var g=this._edgeSegments.indexOf(p);this._edgeSegments.splice(g,1);for(var v=g;v<this._edgeSegments.length;v++)this._edgeSegments[v].index=v}}}},b.prototype._sortEdgesAroundVertex=function(){for(var e=0;e<this._intersectionVertices.length;e++){for(var t=this._intersectionVertices[e],n=[],s=0;s<t.adjacentEdges.length;s++){var a=this._computeAngleAndPositionForEdge(s,t);n.push({index:s,originalAngle:a.angle,angle:a.angle,position:a.position,derivative:void 0})}for(var c=0,u=!1;!u;){u=!0;var l=-Math.PI+c;for(s=0;s<n.length;s++)if((0,r.angleDifference)(l,n[s].angle)<1e-5){u=!1;break}if(u)break;c+=2e-5}for(s=0;s<t.adjacentEdges.length;s++)n[s].angle=(0,r.normalizeParameterToShiftedRange)(n[s].angle-c,[-Math.PI,Math.PI]);var h=this;n=n.sort((function(e,n){if((0,r.angleDifference)(e.angle,n.angle)>1e-5)return e.angle-n.angle;var s=t.adjacentEdges[e.index],a=t.adjacentEdges[n.index],c=s.startVertex===t?s.parameterRange[0]:s.parameterRange[1],u=a.startVertex===t?a.parameterRange[0]:a.parameterRange[1],l=s.originalEdge.evaluatePosition(c),d=a.originalEdge.evaluatePosition(u),p=i.Vector3.distance(l,d),g=i.Vector3.createFloat64(),f=i.Vector3.createFloat64(),v=s.originalEdge.evaluateCurvature(c,g),y=a.originalEdge.evaluateCurvature(u,f);if(0===v&&0===y)return e.angle-n.angle;if(0===v||0===y){var m=1/Math.max(v,y);p+=1.5*Math.sqrt(Math.pow(m,2)-Math.pow(m-p,2))+o.KERNEL_TOLERANCE}else{var _=1/v,E=1/y;if(_<E){var A=_;_=E,E=A}i.Vector3.dot(g,f)<0?p+=-Math.sqrt(-.25*Math.pow(p,4)+Math.pow(p,3)*_-p*p*_*_-(p*p-2*p*_)*E*E+(p*p*p-3*p*p*_+2*p*_*_)*E)/(p-_-E)*1.5:p+=Math.sqrt(-.25*Math.pow(p,4)-Math.pow(p,3)*_-p*p*_*_-(p*p+2*p*_)*E*E+(p*p*p+3*p*p*_+2*p*_*_)*E)/(p+_-E)*1.5}var x=Math.min(i.Vector3.distance(s.endVertex.position,s.startVertex.position),i.Vector3.distance(a.endVertex.position,a.startVertex.position));p=Math.max(o.KERNEL_TOLERANCE,p),p=Math.min(.9*x,p);var C=!1;do{var w=h._computeEdgeDirectionAtVertex(e,t,p),b=h._computeEdgeDirectionAtVertex(n,t,p);C=(0,r.angleDifference)(w,b)>1e-8,p*=5}while(!C&&p<x);var M=w-b;return M>Math.PI?M-=r.PI2:M<-Math.PI&&(M+=r.PI2),M})),t.adjacentEdges=w.default.map(n,(function(e){return t.adjacentEdges[e.index]}))}},b.prototype._assignAdjacentEdges=function(){for(var e=0;e<this._edgeSegments.length;e++){var t=this._edgeSegments[e];this._assignAdjacentEdgesToSegment(t)}},b.prototype._assignAdjacentEdgesToSegment=function(e){var t=e.startVertex.adjacentEdges,n=t.indexOf(e);x.ConsoleUtils.assert(-1!==n,"Error in topology");for(var i=0,o=e.endVertex.adjacentEdges;i<o.length&&o[i]!==e;)i++;x.ConsoleUtils.assert(i<o.length,"Error in topology"),e.adjacent[this.SIDE.LEFT].nextEdge=o[(0,r.modulus)(i-1,o.length)],e.adjacent[this.SIDE.LEFT].prevEdge=t[(0,r.modulus)(n+1,t.length)],e.adjacent[this.SIDE.RIGHT].nextEdge=o[(0,r.modulus)(i+1,o.length)],e.adjacent[this.SIDE.RIGHT].prevEdge=t[(0,r.modulus)(n-1,t.length)]},b.prototype._sweepRegions=function(){var e=this._workspace,t=w.default.clone(this._intersectionVertices).sort((function(e,t){if(Math.abs(e.position[0]-t.position[0])<1e-9){for(var n=0;n<e.adjacentEdges.length;n++)for(var r=0;r<t.adjacentEdges.length;r++)if(e.adjacentEdges[n].originalEdge===t.adjacentEdges[r].originalEdge){var s=e.adjacentEdges[n],a=t.adjacentEdges[r],c=s.startVertex===e?s.parameterRange[0]:s.parameterRange[1],u=a.startVertex===t?a.parameterRange[0]:a.parameterRange[1],l=!0,h=i.Vector3.createFloat64();i.Vector3.normalize(h,s.originalEdge.evaluateDt(c));var d=i.Vector3.createFloat64();if(i.Vector3.normalize(d,a.originalEdge.evaluateDt(u)),Math.sign(h[0])!==Math.sign(d[0]))continue;if(Math.abs(h[0])>o.KERNEL_TOLERANCE&&Math.abs(d[0])>o.KERNEL_TOLERANCE)l=h[0]>0;else{if(Math.abs(e.position[1]-t.position[1])<o.KERNEL_TOLERANCE)continue;l=h[1]>0}return(c-u)*(l?1:-1)}return e.position[1]-t.position[1]}return e.position[0]-t.position[0]}));this._cells=[];var n={index:-1,loops:[],loopOrientations:[],dangling:[],leftmostVertex:void 0};e.sweepLineIntersections=[-1/0,1/0],e.sweepLineRegions=e.sweepLineRegions=[n];for(var r=[],s=0;s<t.length;s++){e.sweepLineRegions.length!==e.sweepLineIntersections.length-1&&console.error("Error during sweep computation");var a=t[s],c=w.default.clone(a.adjacentEdges),u=void 0;if(r[a.index]){for(var l=r[a.index],h=[],d=0;d<e.sweepLineIntersections.length-1;d++)w.default.contains(l,e.sweepLineIntersections[d])&&(void 0===u&&(u=d-1),w.default.contains(l,e.sweepLineIntersections[d+1])&&h.push(d));for(d=0;d<l.length;d++){for(var p=l[d],g=0;g<e.sweepLineIntersections.length;g++)e.sweepLineIntersections[g]===p&&e.sweepLineIntersections.splice(g,1);for(g=0;g<c.length;g++)c[g]===p&&c.splice(g,1)}for(d=h.length-1;d>=0;d--)e.sweepLineRegions.splice(h[d],1)}else u=this._findVertexOnSweepLine(a),e.sweepLineRegions.splice(u+1,0,e.sweepLineRegions[u]);if(c.length>0){var f=u+1;for(d=0;d<c.length;d++){var v=c[d];e.sweepLineIntersections.splice(f,0,v);var y=v.startVertex===a?v.endVertex:v.startVertex;if(void 0===r[y.index]&&(r[y.index]=[]),r[y.index].push(v),d>0){var m={index:this._cells.length,loops:[],loopOrientations:[],dangling:[],leftmostVertex:a};this._cells.push(m),e.sweepLineRegions.splice(f-1,0,m)}f++}for(f=u,d=0;d<c.length;d++){var _=(v=c[d]).startVertex!==a;v.adjacent[_?this.SIDE.RIGHT:this.SIDE.LEFT].face=e.sweepLineRegions[f+1],v.adjacent[_?this.SIDE.LEFT:this.SIDE.RIGHT].face=e.sweepLineRegions[f],f++}}else if(e.sweepLineRegions[u]!==e.sweepLineRegions[u+1]){var E=e.sweepLineRegions[u+1],A=e.sweepLineRegions[u];for(A===n?(A=E,E=n,e.sweepLineRegions.splice(u,1)):(void 0!==A.leftmostVertex&&(void 0===E.leftmostVertex||E.leftmostVertex.position[0]>A.leftmostVertex.position[0])&&(E.leftmostVertex=A.leftmostVertex),e.sweepLineRegions.splice(u+1,1)),d=0;d<this._edgeSegments.length;d++)this._edgeSegments[d].adjacent[this.SIDE.LEFT].face===A&&(this._edgeSegments[d].adjacent[this.SIDE.LEFT].face=E),this._edgeSegments[d].adjacent[this.SIDE.RIGHT].face===A&&(this._edgeSegments[d].adjacent[this.SIDE.RIGHT].face=E);for(d=0;d<e.sweepLineRegions.length;d++)e.sweepLineRegions[d]===A&&(e.sweepLineRegions[d]=E);this._cells[A.index]=void 0}else e.sweepLineRegions.splice(u+1,1)}for(s=0;s<this._cells.length;s++)void 0===this._cells[s]&&(this._cells.splice(s,1),s--);for(s=0;s<this._cells.length;s++)this._cells[s].index=s},b.prototype._assignleftmostEdges=function(){for(var e=this,t=0;t<this._cells.length;t++){var n=this._cells[t],i=n.leftmostVertex,r=w.default.filter(i.adjacentEdges,(function(t){var i=t.adjacent[e.SIDE.LEFT].face,r=t.adjacent[e.SIDE.RIGHT].face;return(i===n||r===n)&&i!==r}));if(x.ConsoleUtils.assert(r.length>=2,"In each loop there should be at least two adjacent edges"),r.length>2)for(var o=0;o<r.length;o++){var s=r[o].adjacent[e.SIDE.LEFT].face===n?e.SIDE.LEFT:e.SIDE.RIGHT,a=r[o].adjacent[s],c=r[o].startVertex===i?a.prevEdge:a.nextEdge;if(w.default.contains(r,c)){r=[r[o],c];break}}var u=r[0];u.loopsCurveAligned=!!(u.startVertex===i^r[0].adjacent[e.SIDE.RIGHT].face===n),n.leftmostEdge=u,n.leftmostVertex=void 0}},b.prototype._removeGrazingIntersectionVertices=function(){for(var e={},t=0,n=this._intersectionVertices.slice();n.length>0;){var i=n.pop();if(2===i.adjacentEdges.length&&(1===i.adjacentEdges[0].coincidentRanges.length||1===i.adjacentEdges[1].coincidentRanges.length)&&i.virtualIntersection){var o,s,a=1===i.adjacentEdges[0].coincidentRanges.length&&1===i.adjacentEdges[1].coincidentRanges.length,c=i.adjacentEdges.slice();if(a){if(o=[c[0].originalEdge,c[0].coincidentRanges[0].originalEdge],s=[c[1].originalEdge,c[1].coincidentRanges[0].originalEdge],!(o[0]===s[0]&&o[1]===s[1]||o[0]===s[1]&&o[1]===s[0]))continue;e[c[0].originalEdge.getGuid()]=!0,e[c[0].coincidentRanges[0].originalEdge.getGuid()]=!0,e[c[1].originalEdge.getGuid()]=!0,e[c[1].coincidentRanges[0].originalEdge]=!0;var u=[c[0].startVertex===i?c[0].endVertex:c[0].startVertex,i,c[1].startVertex===i?c[1].endVertex:c[1].startVertex]}else{var l;c[0].coincidentRanges.length>0?(l=0,o=[c[0].originalEdge,c[0].coincidentRanges[0].originalEdge]):(l=1,o=[c[1].originalEdge,c[1].coincidentRanges[0].originalEdge]),e[o[0].getGuid()]=!0,e[o[1].getGuid()]=!0,u=[c[l].startVertex===i?c[l].endVertex:c[l].startVertex,i],c=[c[l]]}var h=void 0,d=void 0;if(u[0].vertices.length>0?(h=u[0],d=a?[u[1],u[2]]:[u[1]]):a&&u[2].vertices.length>0?(h=u[2],d=[u[0],u[1]]):(h=u[1],d=a?[u[0],u[2]]:[u[0]]),d[0].vertices.length>0||d[1]&&(d[1].vertices.length>0||d[0]===d[1]))continue;for(var p=!0,g=w.default.without(d,i),f=0;f<g.length;f++){var v=g[f].adjacentEdges;if((v=w.default.difference(v,c)).length>2){p=!1;break}for(var y=0;y<v.length;y++)if(v[y].coincidentRanges.length>0||v[y].originalEdge!==o[0]&&v[y].originalEdge!==o[1]){p=!1;break}}if(!p)continue;for(f=0;f<g.length;f++){var m=g[f],_=w.default.intersection(c,m.adjacentEdges)[0],E=i!==h&&a?w.default.without(c,_)[0]:_,A=w.default.without(m.adjacentEdges,_);for(m.adjacentEdges[1]===_&&(A=A.reverse()),y=0;y<A.length;y++){var x=A[y],C=E.startVertex===h?0:1,b=void 0;if(E.originalEdge===x.originalEdge)b=E.parameterRange[C];else{var M=E.coincidentRanges[0].flipped?1-C:C;b=E.coincidentRanges[0].parameterRange[M]}x.startVertex===m?(x.startVertex=h,x.parameterRange[0]=b):(x.endVertex=h,x.parameterRange[1]=b);for(var T=0;T<x.adjacent.length;T++){var V=x.adjacent[T].face;V.leftmostEdge!==_&&V.leftmostEdge!==E||(x.loopsCurveAligned=V.leftmostEdge.loopsCurveAligned,V.leftmostEdge=x),(V.leftmostVertex===d[0]||void 0!==d[1]&&V.leftmostVertex===d[1])&&(V.leftmostVertex=h)}}var S=h.adjacentEdges.indexOf(E);Array.prototype.splice.apply(h.adjacentEdges,[S,1].concat(A));var R=h.adjacentEdges.length,L=[(0,r.modulus)(S-1,R),S,S+1,(S+2)%R];for(y=0;y<L.length;y++){var P=h.adjacentEdges[L[y]];this._assignAdjacentEdgesToSegment(P)}}this._intersectionVertices=w.default.difference(this._intersectionVertices,d),n=w.default.difference(n,d),this._edgeSegments=w.default.difference(this._edgeSegments,c),t++}}if(t>0){for(var O=0;O<this._intersectionVertices.length;O++)this._intersectionVertices[O].index=O;for(O=0;O<this._edgeSegments.length;O++)this._edgeSegments[O].index=O}var D=w.default.keys(e);for(O=0;O<D.length;O++){var I=D[O],N=[];for(f=0;f<this._edgeSegments.length;f++)for((k=this._edgeSegments[f]).originalEdge.getGuid()===I&&N.push([k,k.parameterRange[0]]),y=0;y<k.coincidentRanges.length;y++)k.coincidentRanges[y].originalEdge.getGuid()===I&&N.push([k,k.coincidentRanges[y].parameterRange[0]]);for(N.sort((function(e,t){return e[1]-t[1]})),f=0;f<N.length;f++){var k;for((k=N[f][0]).originalEdge.getGuid()===I&&(k.localGuid=this._createGUIDfromEdgeAndLocalID(k.originalEdge,f+1)),y=0;y<k.coincidentRanges.length;y++)k.coincidentRanges[y].originalEdge.getGuid()===I&&(k.coincidentRanges[y].localGuid=this._createGUIDfromEdgeAndLocalID(k.coincidentRanges[y].originalEdge,f+1))}}},b.prototype._removeTemporaryVertices=function(){for(var e=0,t=0;t<this._intersectionVertices.length;t++){var n=this._intersectionVertices[t];if(n.temporary&&2===n.adjacentEdges.length&&n.adjacentEdges[0].originalEdge===n.adjacentEdges[1].originalEdge&&n.adjacentEdges[0]!==n.adjacentEdges[1]){var i,r;n.adjacentEdges[0].endVertex===n?(i=n.adjacentEdges[0],r=n.adjacentEdges[1]):(i=n.adjacentEdges[1],r=n.adjacentEdges[0]),x.ConsoleUtils.assert(i.adjacent[this.SIDE.LEFT].face===r.adjacent[this.SIDE.LEFT].face),x.ConsoleUtils.assert(i.adjacent[this.SIDE.RIGHT].face===r.adjacent[this.SIDE.RIGHT].face);var s=i.parameterRange[1]-r.parameterRange[0],a=(i.originalEdge.isReversed()?-1:1)*i.parameterRange[0],c=o.KERNEL_TOLERANCE/i.originalEdge.getCurve().tangentLength(a);if(i.originalEdge.getCurve().isPeriodic()&&Math.abs(s-i.originalEdge.getCurve().getPeriod())<c)i.parameterRange[1]=r.parameterRange[1]+s;else{if(Math.abs(s)>c)continue;i.parameterRange[1]=r.parameterRange[1]}i.endVertex=r.endVertex,i.adjacent[this.SIDE.LEFT].nextEdge=r.adjacent[this.SIDE.LEFT].nextEdge,i.adjacent[this.SIDE.RIGHT].nextEdge=r.adjacent[this.SIDE.RIGHT].nextEdge,i.adjacent[this.SIDE.LEFT].prevEdge===r&&(i.adjacent[this.SIDE.LEFT].prevEdge=i),i.adjacent[this.SIDE.RIGHT].prevEdge===r&&(i.adjacent[this.SIDE.RIGHT].prevEdge=i);var u=i.adjacent[this.SIDE.LEFT].nextEdge;u.adjacent[this.SIDE.LEFT].prevEdge===r&&(u.adjacent[this.SIDE.LEFT].prevEdge=i),u.adjacent[this.SIDE.LEFT].nextEdge===r&&(u.adjacent[this.SIDE.LEFT].nextEdge=i),u.adjacent[this.SIDE.RIGHT].prevEdge===r&&(u.adjacent[this.SIDE.RIGHT].prevEdge=i),u.adjacent[this.SIDE.RIGHT].nextEdge===r&&(u.adjacent[this.SIDE.RIGHT].nextEdge=i);var l=i.adjacent[this.SIDE.RIGHT].nextEdge;l.adjacent[this.SIDE.LEFT].prevEdge===r&&(l.adjacent[this.SIDE.LEFT].prevEdge=i),l.adjacent[this.SIDE.LEFT].nextEdge===r&&(l.adjacent[this.SIDE.LEFT].nextEdge=i),l.adjacent[this.SIDE.RIGHT].prevEdge===r&&(l.adjacent[this.SIDE.RIGHT].prevEdge=i),l.adjacent[this.SIDE.RIGHT].nextEdge===r&&(l.adjacent[this.SIDE.RIGHT].nextEdge=i),r.adjacent[this.SIDE.LEFT].face.leftmostEdge===r&&(r.adjacent[this.SIDE.LEFT].face.leftmostEdge=i),r.adjacent[this.SIDE.RIGHT].face.leftmostEdge===r&&(r.adjacent[this.SIDE.RIGHT].face.leftmostEdge=i),void 0===i.loopsCurveAligned&&(i.loopsCurveAligned=r.loopsCurveAligned),(0,v.hashCombine4xUint32)(i.localGuid,r.localGuid,i.localGuid);var h=i.endVertex.adjacentEdges.indexOf(r);i.endVertex.adjacentEdges[h]=i,this._intersectionVertices.splice(t,1),this._edgeSegments.splice(r.index-e,1),t--,e++}else this._intersectionVertices[t].index-=e}for(t=0;t<this._edgeSegments.length;t++)this._edgeSegments[t].index=t},b.prototype._updateVertexGuidLists=function(){for(var e=0;e<this._intersectionVertices.length;e++){var t=this._intersectionVertices[e];if(t.vertices.length>0)for(var n=0;n<t.vertices.length;n++)t.guidList.push((0,v.guidToUint32x4)(t.vertices[n].getGuid()));else{var i={};for(n=0;n<t.adjacentEdges.length;n++){var r=t.adjacentEdges[n];if(!i[r.index]){i[r.index]=!0,t.guidList.push(r.localGuid);for(var o=0;o<r.coincidentRanges.length;o++)t.guidList.push(r.coincidentRanges[o].localGuid)}}}}},b.prototype._assignLoops=function(){var e=this._workspace;e.edgesPerCell=[];for(var t=0;t<this._cells.length;t++)e.edgesPerCell[t]=[];for(t=0;t<this._edgeSegments.length;t++){var n=this._edgeSegments[t],i=n.adjacent[this.SIDE.LEFT].face.index;i>=0&&e.edgesPerCell[i].push(n);var r=n.adjacent[this.SIDE.RIGHT].face.index;r>=0&&i!==r&&e.edgesPerCell[r].push(n)}var o=[];for(t=0;t<this._cells.length;t++){var s=[];o[t]=s;for(var a=this._followLoopFromEdge(this._cells[t].leftmostEdge,this._cells[t],!1,!0),c=0;c<a.loop.length;c++)s[a.loop[c].index]=!0;this._cells[t].loops.push(a.loop),this._cells[t].loopOrientations.push(a.orientations)}for(t=0;t<this._cells.length;t++){s=o[t];for(var u=0;u<e.edgesPerCell[t].length;u++){var l=e.edgesPerCell[t][u];if(l.adjacent[this.SIDE.LEFT].face!==l.adjacent[this.SIDE.RIGHT].face){if(!0!==s[l.index]){for(a=this._followLoopFromEdge(l,this._cells[t],!0,!1),c=0;c<a.loop.length;c++)s[a.loop[c].index]=!0;this._cells[t].loops.push(a.loop),this._cells[t].loopOrientations.push(a.orientations)}}else this._cells[t].dangling.push(l)}}},b.prototype._updateSketchRegionTopology=function(){for(var e=this._workspace,t=w.default.keys(this._sketchRegionTopologies),n=0;n<t.length;n++){var i=t[n];this._sketchRegionTopologies[i].updated=!1,"FaceID"===this._sketchRegionTopologies[i].topology.tuid&&this._sketchRegionTopologies[i].topology.removeAllEdges()}var r={},s={};for(n=0;n<this._intersectionVertices.length;n++){var a=this._addOrFindTopologySubcomponent("VertexID",o.GEOMETRY_TYPES.POINT,this._intersectionVertices[n].guidList,s);a.setPoint(new h.Point(this._intersectionVertices[n].position)),a.setAssociatedEntities(w.default.clone(this._intersectionVertices[n].vertices));for(var c=0;c<this._intersectionVertices[n].vertices.length;++c){var u=this._intersectionVertices[n].vertices[c].getGuid();x.ConsoleUtils.assert(!r[u],"vertex should only map to one topology vertex"),r[u]=a}this._intersectionVertices[n].topologyVertex=a}for(n=0;n<this._edgeSegments.length;n++){var l=this._edgeSegments[n],g=[l.localGuid];for(c=0;c<l.coincidentRanges.length;c++)g.push(l.coincidentRanges[c].localGuid);(b=this._addOrFindTopologySubcomponent("EdgeID",l.originalEdge.getCurveType(),g,s)).setToEdgeSegment(l.originalEdge,l.parameterRange),b.setStartVertex(l.startVertex.topologyVertex),b.setEndVertex(l.endVertex.topologyVertex);var f=[{edge:l.originalEdge,range:w.default.clone(l.parameterRange),flipped:!1}];for(c=0;c<l.coincidentRanges.length;c++)f.push({edge:l.coincidentRanges[c].originalEdge,range:w.default.clone(l.coincidentRanges[c].parameterRange),flipped:l.coincidentRanges[c].flipped});b.setAssociatedEdges(f),l.topologyEdge=b}for(n=0;n<this._cells.length;n++){var y=this._cells[n];for(g=[],c=0;c<e.edgesPerCell[n].length;c++)g.push((0,v.guidToUint32x4)(e.edgesPerCell[n][c].topologyEdge.getGuid()));var m=this._addOrFindTopologySubcomponent("FaceID",o.GEOMETRY_TYPES.PLANE,g,s);m.setSurface(this._planeGeometry);var _=[];for(c=0;c<y.loops.length;c++){var E=new d.Loop;E.setFace(m),_.push(E);for(var A=[],C=0;C<y.loops[c].length;C++){var b=y.loops[c][C].topologyEdge,M=new p.Coedge;M.setLoop(E),A.push(M),M.setEdge(b),M.setReversed(!y.loopOrientations[c][C]),b.getCoedge()?b.getCoedge().getPartner()||(b.getCoedge().setPartner(M),M.setPartner(b.getCoedge())):b.setCoedge(M),y.loops[c][C].topologyEdge.setIsDangling(!1)}E.setCoedges(A)}for(m.setLoops(_),this._faces.push(m),c=0;c<y.dangling.length;c++)m.addDanglingEdge(y.dangling[c].topologyEdge),y.dangling[c].topologyEdge.setIsDangling(!0)}for(n=0;n<t.length;n++)this._sketchRegionTopologies[t[n]].updated||delete this._sketchRegionTopologies[t[n]]},b.prototype._followLoopFromEdge=function(e,t,n,i){var r=[],o=[],s=e,a=[],c=e.adjacent[this.SIDE.LEFT].face===t?this.SIDE.LEFT:this.SIDE.RIGHT,u=!!(s.loopsCurveAligned^c!==this.SIDE.LEFT),l=u?e.startVertex:e.endVertex;do{if(s.adjacent[c].face!==t){console.error("REGION: Adjacent edge face does not match cell! FIXME!");break}if(a[s.index]){console.error("REGION: Malformed edges; walking edge lead us to despair");break}a[s.index]=!0,r.push(s),o.push(u);do{u?(l=s.endVertex,s=s.adjacent[c].nextEdge):(l=s.startVertex,s=s.adjacent[c].prevEdge),s.startVertex===s.endVertex?c=s.adjacent[this.SIDE.LEFT].face===t?this.SIDE.LEFT:this.SIDE.RIGHT:(c=s.startVertex===l?this.SIDE.LEFT:this.SIDE.RIGHT,s.adjacent[this.SIDE.LEFT].face===s.adjacent[this.SIDE.RIGHT].face&&(c=1-c,l=s.startVertex===l?s.endVertex:s.startVertex)),u=c===this.SIDE.LEFT}while(s.adjacent[this.SIDE.LEFT].face===s.adjacent[this.SIDE.RIGHT].face);i&&void 0===s.loopsCurveAligned&&(s.loopsCurveAligned=!!(u^c!==this.SIDE.LEFT))}while(s!==e);return{loop:r,orientations:o}},b.prototype._addNewRegionTopology=function(e){switch(e.tuid){case"VertexID":var t=new E.RegionTopologyVertex(new h.Point);return t.setGuid(e.guid),t;case"EdgeID":var n=void 0;switch(e.minortype){case o.GEOMETRY_TYPES.LINE:n=new a.Line;break;case o.GEOMETRY_TYPES.CIRCLE:n=new c.Circle;break;case o.GEOMETRY_TYPES.ELLIPSE:n=new l.Ellipse;break;case o.GEOMETRY_TYPES.BCURVE:n=new u.BCurve;break;default:console.error("Unhandled curve type")}var i=new E.RegionTopologyEdge(n);return i.setGuid(e.guid),i;case"FaceID":n=void 0,e.minortype===o.GEOMETRY_TYPES.PLANE?n=new s.Plane:console.error("Unhandled surface type");var r=new E.RegionTopologyFace(n);return r.setGuid(e.guid),r;default:console.error("Unhandled topology type")}},b.prototype._addOrFindTopologySubcomponent=function(e,t,n,i){var r=this._createNameFromGuidList(e,t,n,i);if(this._sketchRegionTopologies[r]){var o=this._sketchRegionTopologies[r];return o.updated=!0,o.topology}var s=this._addNewRegionTopology({tuid:e,minortype:t,guid:r});return this._sketchRegionTopologies[r]={topology:s,updated:!0},s};var M={VertexID:[1168004130,3764602020,2270554856,1368826480],EdgeID:[2942887333,1472546498,2159971906,413489693],FaceID:[2166479754,2329626594,2838556660,1584616933]},T={};T[o.GEOMETRY_TYPES.POINT]=[2299429810,2248164535,3202574069,2684287321],T[o.GEOMETRY_TYPES.LINE]=[910992607,3428993096,3010390753,2966835859],T[o.GEOMETRY_TYPES.CIRCLE]=[2229232555,842549819,2526558959,4217038233],T[o.GEOMETRY_TYPES.PLANE]=[2122299449,3667741317,2812958731,939246365],T[o.GEOMETRY_TYPES.BCURVE]=[420548527,2703575863,2792852189,2595995847],T[o.GEOMETRY_TYPES.ELLIPSE]=[902753991,1129557208,9277753211,1913737389];var V=function(e,t){var n=2166136261;return t&&(n=16777619*(n^t)>>>0),16777619*(((n=16777619*(((n=16777619*(((n=16777619*((n^255&e)>>>0)>>>0)^e>>8&255)>>>0)>>>0)^e>>16&255)>>>0)>>>0)^e>>24&255)>>>0)>>>0},S=function(){var e=new Uint32Array(4);return function(t){return e[0]=t,e[1]=16777619,e[2]=t,e[3]=t,(0,v.hashCombine4xUint32)(e,e)}}(),R=function(e,t){for(var n=0;n<e.length;n++)e[n]=(e[n]^t[n])>>>0};b.prototype._createNameFromGuidList=function(e,t,n,i){var r=w.default.clone(M[e]),o=T[t];x.ConsoleUtils.assert(r&&o,"Unsupported tuid or minortype!"),R(r,o);for(var s=0;s<n.length;s++)R(r,n[s]);var a=(0,v.uint32x4ToGUID)(r);if(i[a]){var c=++i[a];return(n=w.default.clone(n)).push(S(V(c))),this._createNameFromGuidList(e,t,n,i)}return i[a]=1,a},b.prototype._createGUIDfromEdgeAndLocalID=function(e,t){var n=(0,v.guidToUint32x4)(e.getGuid()),i=S(V(t));return(0,v.hashCombine4xUint32)(n,i)},b.prototype._findVertexIndex=function(e){for(var t=0;t<this._intersectionVertices.length;t++){if(i.Vector3.distance(this._intersectionVertices[t].position,e)<o.KERNEL_TOLERANCE)return t;for(var n=0;n<this._intersectionVertices[t].mergedPositions.length;n++)if(i.Vector3.distance(this._intersectionVertices[t].mergedPositions[n],e)<o.KERNEL_TOLERANCE)return t}},b.prototype._findVertexOnSweepLine=function(e){for(var t=this._workspace,n=0,i=t.sweepLineIntersections.length-1;i>=n;){if(n+1>=i)return n;var r=Math.floor((n+i)/2);this._isVertexAboveEdgeSegment(t.sweepLineIntersections[r],e)?n=r:i=r}console.error("Error in binary search function!")},b.prototype._isVertexAboveEdgeSegment=function(e,t){if(e===-1/0)return!0;if(e===1/0)return!1;var n=e.originalEdge;switch(n.getCurveType()){case o.GEOMETRY_TYPES.LINE:var r=n.getStartVertex().getPosition(),s=i.Vector3.createFloat64();i.Vector3.subtract(s,n.getEndVertex().getPosition(),r);var a=i.Vector3.createFloat64();return i.Vector3.subtract(a,t.position,r),(s[0]<0||0===s[0]&&s[1]<0)&&i.Vector3.negate(s,s),a[1]*s[0]-a[0]*s[1]>0;case o.GEOMETRY_TYPES.CIRCLE:var c=t.position[0]-n.getCurve().getCenter()[0],u=.5*(e.parameterRange[0]+e.parameterRange[1]),l=n.getCurve().evaluateDtt(u)[1]>0?-1:1;return Math.abs(c)>n.getCurve().getRadius()?n.getCurve().getCenter()[1]<t.position[1]:n.getCurve().getCenter()[1]+l*Math.sqrt(n.getCurve().getRadius()*n.getCurve().getRadius()-c*c)<t.position[1];default:return this.getYvalueForX(e,t.position[0])<t.position[1]}},b.prototype._makeEdgeXMonotone=function(e,t){var n=e.getCurve(),s=[];switch(e.getCurveType()){case o.GEOMETRY_TYPES.LINE:break;case o.GEOMETRY_TYPES.CIRCLE:var a=n.evaluatePosition(0);i.Vector3.subtract(a,a,n.getCenter());var c=n.getNormal()[2]>0?-1:1;s[0]=c*Math.atan2(a[1],a[0]),s[1]=s[0]-Math.PI;break;case o.GEOMETRY_TYPES.ELLIPSE:var u=n.getMajorAxis()[0]*n.getMajorRadius(),l=n.getMinorAxis()[0]*n.getMinorRadius();s[0]=Math.atan2(l,u),s[1]=s[0]-Math.PI;break;case o.GEOMETRY_TYPES.BCURVE:s=y.SplineCurveHelper.extremalParams(n,0);break;default:console.warn("Unsupported edge type in sketch region op")}for(var h=0;h<s.length;h++){var d=s[h];e.isReversed()&&(d=-d),n.isPeriodicUnlimited()&&(d=(0,r.adjustParameterToPeriodicRange)(d,e.getRange(),n.getPeriodUnlimited())),d>=e.t0()&&d<=e.t1()&&(t.push({param:d,atVertex:null,temporary:!0}),C.DebugUtils.level("region3D")>0&&C.DebugUtils.drawPoint3D(e.evaluatePosition(d),{color:16711935,label:"x monotonic"}))}},b.prototype.plotSegments=function(e,t){var n=this._workspace;Debug.hold("on"),Debug.clearFigure(),Debug.delayUpdates(!0);for(var r=0;r<this._intersectionVertices.length;r++){var o=Debug.plotColorForIndex(this._intersectionVertices[r].adjacentEdges.length);if("sweepLineState"===e&&(o="k",this._intersectionVertices[r]===n.currentVertex&&(o="g"),this._intersectionVertices[r]===n.nextVertex&&(o="b")),Debug.plot([this._intersectionVertices[r].position],o+"o"),"orderColored"===e)for(var s=this._intersectionVertices[r],a=[],c=0;c<s.adjacentEdges.length;c++){o=Debug.plotColorForIndex(c);var u=s.adjacentEdges[c],l=w.default.clone(u.parameterRange);u.startVertex!==s||a[u.index]?l[0]=.5*(l[0]+l[1]):l[1]=.5*(l[0]+l[1]),a[u.index]=!0;var h=u.originalEdge.tessellate(l).positions;Debug.plot(h,o+"-")}}if("orderColored"!==e)for(r=0;r<this._edgeSegments.length;r++){if(u=this._edgeSegments[r],"coincidenceCount"===e){var d=u.coincidentRanges.length+1;o=Debug.plotColorForIndex(d)}else o=Debug.plotColorForIndex(r);if("sweepLineState"===e&&(o=n.sweepLineIntersections.indexOf(u)>-1?"r":"k"),t&&t.highlightLoop&&(o=w.default.contains(t.highlightLoop,u)?"R":"k"),h=u.originalEdge.tessellate(u.parameterRange).positions,"regions"===e){var p=[],g=[];for(c=0;c<h.length;c++){if(c<h.length-1){var f=i.Vector3.createFloat64();i.Vector3.subtract(f,h[c+1],h[c])}else f=i.Vector3.createFloat64(),i.Vector3.subtract(f,h[c],h[c-1]);i.Vector3.normalize(f,f),i.Vector3.scale(f,f,.05),i.Vector3.cross(f,[0,0,1],f);var v=i.Vector3.clone(h[c]);p.push(i.Vector3.add(v,v,f));var y=i.Vector3.clone(h[c]);g.push(i.Vector3.subtract(y,y,f))}var m=u.adjacent[this.SIDE.LEFT].face.index;o=Debug.plotColorForIndex(m),Debug.plot(p,o+"-");var _=u.adjacent[this.SIDE.RIGHT].face.index;o=Debug.plotColorForIndex(_),Debug.plot(g,o+"-")}else Debug.plot(h,o+"-")}if("sweepLineState"===e&&n.sweepLinePosition){var E=n.sweepLinePosition,A=void 0;for(r=0;r<n.sweepLineIntersections.length;r++){var x,C=n.sweepLineIntersections[r];void 0!==(x=C===1/0?5:C===-1/0?-5:this.getYvalueForX(C,E))&&(Debug.plot([E],[x],"y."),void 0!==A&&(o=Debug.plotColorForIndex(n.sweepLineRegions[r-1].index),Debug.plot([E,E],[A,x],o+"-")),A=x)}}if(t&&t.showOrientation){h=[];var b=[],M=[];for(r=0;r<this._edgeSegments.length;r++){var T=!(void 0===(u=this._edgeSegments[r]).loopsCurveAligned||!0===u.loopsCurveAligned),V=T?.05:.95,S=u.parameterRange[0]*(1-V)+u.parameterRange[1]*V,R=u.originalEdge.evaluatePosition(S);h.push(R);var L=t.arrowSize||.1,P=T?-L:L;if(u.adjacent[this.SIDE.LEFT].face.index>=0){var O=u.originalEdge.evaluateDt(S);i.Vector3.normalize(O,O);var D=[R[0]-L*O[1],R[1]+L*O[0]];b.push(D),M.push([P*O[0],P*O[1]])}if(u.adjacent[this.SIDE.RIGHT].face.index>=0){var I=u.parameterRange[0]*V+u.parameterRange[1]*(1-V),N=u.originalEdge.evaluatePosition(I),k=u.originalEdge.evaluateDt(I);i.Vector3.normalize(k,k);var B=[N[0]+L*k[1],N[1]-L*k[0]];b.push(B),M.push([-P*k[0],-P*k[1]])}}Debug.plot(h,"k."),Debug.quiver(b,M,"g","c")}Debug.delayUpdates(!1),Debug.equalAxis()},b.prototype.plotEdgeSegment=function(e,t){Debug.plotEdgeList([e.originalEdge],!1,t+"-",{ranges:[e.parameterRange]})},b.prototype.plotEdgesAroundVertex=function(e,t){Debug.plot([e.position],"gx");for(var n=0;n<e.adjacentEdges.length;n++){var i,r=e.adjacentEdges[n];console.log(n),i=r.startVertex===e?[r.parameterRange[0],r.parameterRange[0]+t/r.originalEdge.getCurve().tangentLength(r.parameterRange[0])]:[r.parameterRange[1]-t/r.originalEdge.getCurve().tangentLength(r.parameterRange[0]),r.parameterRange[1]],Debug.plotEdgeList([r.originalEdge],!1,"-"+Debug.plotColorForIndex(n),{ranges:[i],showOrientation:!1,resolution:1e4})}},b.prototype.getYvalueForX=function(e,t){var n=e.parameterRange[0],i=e.parameterRange[1],r=e.originalEdge.evaluatePosition(n),s=e.originalEdge.evaluatePosition(i),a=r[0],c=s[0];if(a>c){var u=n;n=i,i=u,u=a,a=c,c=u,u=r,r=s,s=u}if(t<=a+o.KERNEL_TOLERANCE||t>=c-o.KERNEL_TOLERANCE)return Math.abs(t-a)<=o.KERNEL_TOLERANCE?r[1]:Math.abs(t-c)<=o.KERNEL_TOLERANCE?s[1]:void console.warn("Failure in getYvalueForX, in_x oustide segment range, returning undefined");for(;c>=a;){if(a+o.KERNEL_TOLERANCE>=c)return h[1];var l=(n+i)/2,h=e.originalEdge.evaluatePosition(l);if(Math.abs(n-i)<=o.PARAMETER_SPACE_TOLERANCE)return x.ConsoleUtils.assert(!1,"Could not converge to a solution for getYvalueForX"),h[1];h[0]<t?(a=h[0],n=l):(c=h[0],i=l)}console.warn("Failure in getYvalueForX, returning undefined")},b.prototype._computeAngleAndPositionForEdge=function(e,t,n){var r=t.adjacentEdges[e],o=r.startVertex===t,s=r.parameterRange[o?0:1];if(void 0===n||!((s+=(o?1:-1)*n)<r.parameterRange[0]||s>r.parameterRange[1])){var a=i.Vector3.createFloat64();return i.Vector3.normalize(a,r.originalEdge.evaluateDt(s)),o||i.Vector3.negate(a,a),{angle:Math.atan2(a[1],a[0]),position:r.originalEdge.evaluatePosition(s)}}},b.prototype._computeEdgeDirectionAtVertex=function(e,t,n){var r=t.adjacentEdges[e.index],o=r.startVertex===t,s=r.parameterRange[o?0:1],a=s+(o?1:-1)*n/i.Vector3.length(r.originalEdge.evaluateDt(s)),c=r.originalEdge.evaluatePosition(a),u=i.Vector3.subtract(c,c,t.position);return Math.atan2(u[1],u[0])},b.prototype._prepareResult=function(){var e=new m.TopologyCloner;this._finalFaces=e.cloneFaces(this._faces),this._internalToFinalMap=e.getProgenitorMap(),this._progenitorMap=new _.ProgenitorMap;for(var t=e.getProgenitorMap().getAllNewTopology(),n=0;n<t.length;n++){var i=t[n],r=e.getProgenitorMap().getProgenitors(i)[0],s=void 0;i.getTopologyType()===o.TOPOLOGY_TYPES.FACE?(s=new Set,r.collectEdges().forEach((function(e){e.getAssociatedEntities().forEach((function(e){s.add(e)}))})),s=Array.from(s)):(i.getTopologyType()===o.TOPOLOGY_TYPES.EDGE||i.getTopologyType()===o.TOPOLOGY_TYPES.VERTEX)&&(s=r.getAssociatedEntities()),s&&this._progenitorMap.addEntry(i,s)}this._sketchSummary={regionFaces:[],regionEdges:[],regionVertices:[],sketchEdges:{}};for(var a=w.default.keys(this._sketchRegionTopologies),c=0;c<a.length;c++){var u=this._sketchRegionTopologies[a[c]].topology;u instanceof E.RegionTopologyFace?this._sketchSummary.regionFaces.push(u):u instanceof E.RegionTopologyEdge?this._sketchSummary.regionEdges.push(u):u instanceof E.RegionTopologyVertex?this._sketchSummary.regionVertices.push(u):x.ConsoleUtils.assert(!1)}for(var l=0;l<this._sketchEdges.length;l++){var h=this._sketchEdges[l];this._sketchSummary.sketchEdges[h.getGuid()]=h}},b.prototype.getFaces=function(){return this._finalFaces},b.prototype.getRegionTopologyFaces=function(){return this._faces},b.prototype.getProgenitorMap=function(){return this._progenitorMap},b.prototype.createFaceRecipe=function(e){var t=this._finalFaces.indexOf(e);if(t<0)return"";var n=this._faces[t],i=(0,A.createRecipeFromRegionFace)(n,this._sketchSummary);return(0,A.serializeRegionFaceRecipe)(i)},b.prototype.matchFaceRecipe=function(e){for(var t=(0,A.deserializeRegionFaceRecipe)(e),n=(0,A.matchRegionFaceRecipe)(t,this._sketchSummary),i=[],r=0;r<n.regions.length;r++){var o=this._faces.indexOf(n.regions[r]);x.ConsoleUtils.assert(o>=0),i.push(this._finalFaces[o])}return i},b.prototype.createEdgeRecipe=function(e){var t=this._internalToFinalMap.getProgenitors(e);if(!t||1!==t.length)return"";var n=(0,A.createRecipeFromRegionEdge)(t[0],this._sketchSummary);return(0,A.serializeRegionEdgeRecipe)(n)},b.prototype.matchEdgeRecipe=function(e){for(var t=(0,A.deserializeRegionEdgeRecipe)(e),n=(0,A.matchRegionEdgeRecipe)(t,this._sketchSummary),i=[],r=0;r<n.edges.length;r++){var o=this._internalToFinalMap.getDescendants(n.edges[r]);x.ConsoleUtils.assert(1===o.length),i.push(o[0])}return i},t.SketchRegionSolver=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.computeCurveCurveIntersections=void 0;var i=n(1),r=n(0),o=n(6),s=n(7),a=n(20),c=n(16),u=n(72),l=n(36),h=n(3),d=n(110),p=r.KERNEL_TOLERANCE,g=function(e,t,n,r){var o=t,s=e.getRange();if(e.getCurve().isPeriodicUnlimited()&&(o<s[0]-i.FLOAT64_TOLERANCE||o>s[1]+i.FLOAT64_TOLERANCE)){var a=e.getCurve().getPeriodUnlimited();o=(0,h.foldNearTo)(o,.5*(s[0]+s[1]),a)}var c=Math.abs(o-s[0])<Math.abs(o-s[1])?0:1,u=i.Vector3.length(e.evaluateDt(o));return Math.abs(o-s[c])*u<n?{param:s[c],atVertex:e.getVertex(c)}:o>=s[0]&&o<=s[1]?{param:o,atVertex:void 0}:!e.isClosed()&&r.distanceToPoint(e.getVertex(c).getPosition())<n?{param:s[c],atVertex:e.getVertex(c)}:void 0},f=function(e,t,n,r,o){var s=g(e,t,o,n);if(s){if(s.atVertex){var a=n.getRange();e===n&&(a=[r-.1*(u=Math.abs(a[1]-a[0])),r+.1*u]);var c=n.closestToPointParam(s.atVertex.getPosition(),a);i.Vector3.distance(n.evaluatePosition(c),s.atVertex.getPosition())<o&&(r=c)}var u,l=g(n,r,o,e);if(l&&(l.atVertex&&(a=e.getRange(),e===n&&(a=[t-.1*(u=Math.abs(a[1]-a[0])),t+.1*u]),c=e.closestToPointParam(l.atVertex.getPosition(),a),i.Vector3.distance(e.evaluatePosition(c),l.atVertex.getPosition())<o&&(s=g(e,t=c,o,n))),s))return{cutInfo:s,cutByInfo:l}}},v=function(e,t,n){var i=[t-e.getRange()[0],t-e.getRange()[1]];if(i[0]>=n&&i[1]<=-n)return{param:t,atVertex:void 0};var r=Math.abs(i[0])<Math.abs(i[1])?0:1;return Math.abs(i[r])<n?{param:e.getRange()[r],atVertex:e.getVertex(r)}:void 0},y=function(e,t,n,o,s,a,c){var u=e.getCurve().getPeriodUnlimited(),l=t.getCurve().getPeriodUnlimited(),d=[n[0],n[2]],p=[o[0],o[2]],f=[s/i.Vector3.length(e.evaluateDt(d[0])),s/i.Vector3.length(e.evaluateDt(d[1]))],v=[s/i.Vector3.length(t.evaluateDt(p[0])),s/i.Vector3.length(t.evaluateDt(p[1]))];if(((0,h.isParameterWithinPeriodicRange)(d[0],e.getRange(),u,f[0])||(0,h.isParameterWithinPeriodicRange)(d[1],e.getRange(),u,f[1]))&&((0,h.isParameterWithinPeriodicRange)(p[0],t.getRange(),l,v[0])||(0,h.isParameterWithinPeriodicRange)(p[1],t.getRange(),l,v[1]))){for(var y=0;y<2;y++){d[y]=(0,h.adjustParameterToPeriodicRange)(d[y],e.getRange(),u,!1,!0),p[y]=(0,h.adjustParameterToPeriodicRange)(p[y],t.getRange(),l,!1,!0);var m=(0,h.periodicDifference)(d[y],e.getRange()[0],u)<3e-15||(0,h.periodicDifference)(d[y],e.getRange()[1],u)<3e-15,_=(0,h.periodicDifference)(p[y],t.getRange()[0],l)<3e-15||(0,h.periodicDifference)(p[y],t.getRange()[1],l)<3e-15;if(d[y]-e.getRange()[0]<f[y]&&(d[y]=e.getRange()[0],m=!0),e.getRange()[1]-d[y]<f[y]&&(d[y]=e.getRange()[1],m=!0),p[y]-t.getRange()[0]<v[y]&&(p[y]=t.getRange()[0],_=!0),t.getRange()[1]-p[y]<v[y]&&(p[y]=t.getRange()[1],_=!0),m){var E=t.closestToPointParam(e.evaluatePosition(d[y]));p[y]=(0,h.adjustParameterToPeriodicRange)(E,t.getRange(),l,!1,!0)}if(_){var A=e.closestToPointParam(t.evaluatePosition(p[y]));d[y]=(0,h.adjustParameterToPeriodicRange)(A,e.getRange(),u,!1,!0),((0,h.periodicDifference)(d[y],e.getRange()[0],u)<3e-15||(0,h.periodicDifference)(d[y],e.getRange()[1],u)<3e-15)&&(E=t.closestToPointParam(e.evaluatePosition(d[y])),p[y]=(0,h.adjustParameterToPeriodicRange)(E,t.getRange(),l,!1,!0))}}var x,C;if((0,h.periodicDifference)(d[0],d[1],u)<Math.min(f[0],f[1])&&(0,h.periodicDifference)(p[0],p[1],l)<Math.min(v[0],v[1]))x=g(e,.5*(d[0]+d[1]),s,e),C=g(t,.5*(p[0]+p[1]),s,t);else for(x=g(e,n[1],s,e),C=g(t,o[1],s,t),y=0;y<2;y++)if(!((0,h.periodicDifference)(d[y],x.param,u)<f[y]&&(0,h.periodicDifference)(p[y],C.param,l)<v[y])){var w,b,M=g(e,d[y],s,e),T=g(t,p[y],s,t);if(isFinite(u)){var V=(0,h.getShortestParametricRange)(M.param,x.param,u);w=(0,h.periodicDifference)(x.param,V[0],u)<=r.KERNEL_ANGULAR_TOLERANCE}else w=M.param>x.param;isFinite(l)?(V=(0,h.getShortestParametricRange)(T.param,C.param,l),b=(0,h.periodicDifference)(C.param,V[0],l)<=r.KERNEL_ANGULAR_TOLERANCE):b=T.param>C.param,a.push({rangeInfo:w?[x,M]:[M,x],rangeByInfo:b?[C,T]:[T,C]})}c&&c.push({firstParam:x.param,secondParam:C.param})}},m=function(e,t,n,r){var o=e.getRange(),s=e.evaluatePosition(0),a=e.evaluateDt(0),c=i.Vector2.length(a),u=t.getRange(),l=t.evaluatePosition(0),d=t.evaluateDt(0),p=i.Vector2.length(d),g=[a[1]/c,-a[0]/c],y=t.evaluatePosition(u[0]);i.Vector2.subtract(y,y,s);var m=i.Vector2.dot(y,g),_=t.evaluatePosition(u[1]);i.Vector2.subtract(_,_,s);var E=i.Vector2.dot(_,g);if(Math.abs(m)<=r&&Math.abs(E)<=r){var A=i.Vector2.dot(y,a)/(c*c),x=i.Vector2.dot(_,a)/(c*c),C=[Math.min(A,x),Math.max(A,x)],w=r/c,b=r/p;if(C[1]<o[0]-w||C[0]>o[1]+w)return[];var M=[Math.max(o[0],C[0]),Math.min(o[1],C[1])];if(M[1]-M[0]<w){var T=.5*(M[0]+M[1]),V=Math.abs(x-A)>i.FLOAT64_TOLERANCE?u[0]+(u[1]-u[0])*(T-A)/(x-A):.5*(u[0]+u[1]);return[{cutInfo:v(e,T,w),cutByInfo:v(t,V,b)}]}if(!n)return[];var S=u[0]+(u[1]-u[0])*(M[0]-A)/(x-A),R=u[0]+(u[1]-u[0])*(M[1]-A)/(x-A);return[{rangeInfo:[v(e,M[0],w),v(e,M[1],w)],rangeByInfo:[v(t,Math.min(S,R),b),v(t,Math.max(S,R),b)]}]}if(m>r&&E>r||m<-r&&E<-r)return[];var L=[[a[0],-d[0],l[0]-s[0]],[a[1],-d[1],l[1]-s[1]]],P=(0,h.solveTwoEquationsTwoVariables)(L);if(P){var O=f(e,P[0],t,P[1],r);if(O)return[O]}return[]},_=function(e,t,n){var r,o=t.getCenter(),s=e.closestToPointParam(o,[]),a=e.evaluatePosition(s),c=i.Vector3.squaredDistance(a,o),u=[],l=t.getRadius(),h=l-Math.sqrt(c);if(h<-n);else if(h<n)r=t.closestToPointParam(a,[]),u.push({lineParam:s,circleParam:r});else for(var d=Math.sqrt(l*l-c)/i.Vector3.length(e.evaluateDt(0)),p=0;p<2;++p){var g=s+(0===p?-1:1)*d,f=e.evaluatePosition(g);r=t.closestToPointParam(f,[]),u.push({lineParam:g,circleParam:r})}return u},E=function(e,t,n,i,r,o){var s=[n[0]+t*i[0]-e*i[1],n[1]+t*i[1]+e*i[0],0];return{firstParam:r.closestToPointParam(s,[0,2*Math.PI]),secondParam:o.closestToPointParam(s,[0,2*Math.PI])}},A=function(e,t){t||(t=r.KERNEL_TOLERANCE);for(var n=[],i=!1,o=[],s=[],a=0;a<e.length;++a)e[a].hasOwnProperty("rangeInfo")?(!1===i?(o=e[a].rangeInfo,s=e[a].rangeByInfo):Math.abs(o[1].param-e[a].rangeInfo[0].param)<t&&Math.abs(s[1].param-e[a].rangeByInfo[0].param)<t?(o[1]=e[a].rangeInfo[1],s[1]=e[a].rangeByInfo[1]):(n.push({rangeInfo:o,rangeByInfo:s}),o=e[a].rangeInfo,s=e[a].rangeByInfo),i=!0):e[a].hasOwnProperty("cutInfo")?(i&&n.push({rangeInfo:o,rangeByInfo:s}),n.push(e[a]),i=!1):console.warn("unknown segment type in intersection code");return i&&n.push({rangeInfo:o,rangeByInfo:s}),n},x=function(e,t,n,r,o){var s=n.getControlPoints(),a=n.getKnotVector(),c=e.getBoundingBox(),u=[];if(!n.getBoundingBox([a[0],a[a.length-1]]).intersectsWithTolerance(c,o))return u;var d=new Float64Array(s.length),p=s.length/3-1,m=i.Vector2.createFloat64FromValues(e.getStartVertex().getPosition()[0],e.getStartVertex().getPosition()[1]),_=i.Vector3.createFloat64();i.Vector3.sub(_,e.getEndVertex().getPosition(),e.getStartVertex().getPosition()),i.Vector3.normalize(_,_);for(var E=i.Vector2.createFloat64FromValues(_[0],_[1]),A=i.Vector2.createFloat64(),x=!0,C=0;C<=p;++C)A[0]=s[3*C+0],A[1]=s[3*C+1],d[3*C+0]=C/p,d[3*C+1]=(0,h.signedDistanceTo2DLine)(m,E,A),Math.abs(d[3*C+1])>o&&(x=!1),d[3*C+2]=0;if(x)return r?u=function(e,t,n,r,o){var s=r.length/3-1,a=i.Vector3.createFloat64FromValues(r[0],r[1],r[2]),c=e.closestToPointParam(a),u=i.Vector3.createFloat64FromValues(r[3*s+0],r[3*s+1],r[3*s+2]),l=e.closestToPointParam(u),h=[v(e,c,n),v(e,l,n)];if(h[0].param>h[1].param){var d=h[0];h[0]=h[1],h[1]=d}var p=o[0],f=o[o.length-1];if(t.isReversed()){var y=p;p=-f,f=-y}var m=[g(t,p,n,e),g(t,f,n,e)];return h[0]&&h[1]&&m[0]&&m[1]?[{rangeInfo:h,rangeByInfo:m}]:(console.warn("Error in intersection computation."),[])}(e,t,o,s,a):[];var w=new Float64Array(3),b=[];return function(e,t,n,i,r,o,s,a,c){var u,l=[],h=i.length/3-1;3===o?(s[0]>s[1]&&(u=s[0],s[0]=s[1],s[1]=u),s[1]>s[2]&&(u=s[1],s[1]=s[2],s[2]=u),s[0]>s[1]&&(u=s[0],s[0]=s[1],s[1]=u)):2===o&&s[0]>s[1]&&(u=s[0],s[0]=s[1],s[1]=u);var d=[!1,!1,!1],p=r[r.length-1]-r[0],v=t.getCurve().tangentLength(r[0])*p;Math.abs(i[1])<n&&(0===o||s[0]>n/v)&&(o++,s[2]=s[1],s[1]=s[0],s[0]=0,d[0]=!0);var m=t.getCurve().tangentLength(r[r.length-1])*p;Math.abs(i[3*h+1])<n&&(0===o||1-s[o-1]>n/m)&&(s[o]=1,d[o]=!0,o++);for(var _=e.isReversed()?-1:1,E=t.isReversed()?-1:1,A=0,x=0;x<o+1;++x){var C=!1;if(x!==o){var w=s[x];s[x]=r[0]+(r[r.length-1]-r[0])*s[x];var b=t.getCurve().evaluatePosition(s[x]),M=e.getCurve().closestToPointParam(b,[]),T=f(e,M*_,t,s[x]*E,n);T&&(T.cutInfo.virtualIntersection=d[x],T.cutByInfo.virtualIntersection=d[x],l.push(T))}else w=r[r.length-1],C=Math.abs(i[3*h+1])>n;if(0===x&&w>0&&Math.abs(i[0])>n&&(C=!0),c){var V=void 0;if(a.length>0&&a[0][0]>=A&&a[0][0]<=w&&(V=a[0]),a.length>1&&a[1][0]>=A&&a[1][0]<=w&&(V=a[1]),void 0!==V&&Math.abs(V[1])<n&&!C){var S=[r[0]+(r[r.length-1]-r[0])*A,r[0]+(r[r.length-1]-r[0])*w],R=[e.getCurve().closestToPointParam(t.getCurve().evaluatePosition(S[0]),[]),e.getCurve().closestToPointParam(t.getCurve().evaluatePosition(S[1]),[])];if(Math.abs(R[0]-R[1])>n){var L=[g(e,R[0]*_,n,t),g(e,R[1]*_,n,t)],P=[g(t,S[0]*E,n,e),g(t,S[1]*E,n,e)];if(L[0]&&L[1]&&P[0]&&P[1]){var O=r[0]+(r[r.length-1]-r[0])*V[0];O!==S[0]&&O!==S[1]||(O=.5*(S[0]+S[1]));var D=e.getCurve().closestToPointParam(t.getCurve().evaluatePosition(O),[]);y(e,t,[R[0]*_,D*_,R[1]*_],[S[0]*E,O*E,S[1]*E],n,l);var I={cutInfo:g(e,D*_,n,e),cutByInfo:g(t,O*E,n,e)};I.cutInfo.virtualIntersection=!0,I.cutByInfo.virtualIntersection=!0,l.push(I)}}}}A=w}return l}(e,t,o,d,a,l.SplineCurveHelper.intersect_xAxis_NonRationalCubicBSpline_XYPlanar3D([0,0,0],d,w,b),w,b,r)},C=function(e,t,n,i){var r=e.getBoundingBox(),o=[];if(!t.getBoundingBox().intersectsWithTolerance(r,i))return o;for(var s=t.getCurve().getBezierSegments(),a=s.length,c=0;c<a;c++)for(var u=x(e,t,s[c],n,i),l=0;l<u.length;++l)o.push(u[l]);return A(o)},w=function(e,t,n,r,o){var a=n.getControlPoints(),c=n.getKnotVector(),l=e.getBoundingBox(),d=[];if(!n.getBoundingBox([c[0],c[c.length-1]]).intersectsWithTolerance(l,o))return d;for(var v=!0,y=i.Vector2.createFloat64(),m=i.Vector2.createFloat64(),E=i.Vector2.createFloat64(),A=0;A<a.length/3-2&&v;++A)y[0]=a[3*A+0],y[1]=a[3*A+1],m[0]=a[3*A+3],m[1]=a[3*A+4],E[0]=a[3*A+6],E[1]=a[3*A+7],v=Math.abs((0,h.orient2D)(y,m,E))<p;if(v){var x=new s.Line,C=i.Vector3.createFloat64FromValues(a[0],a[1],a[2]),w=i.Vector3.createFloat64FromValues(a[a.length-3],a[a.length-2],a[a.length-1]);x.setFromEndpoints(C,w);var b=i.Vector3.distance(w,C),M=_(x,e.getCurve(),o);for(A=0;A<M.length;++A)if(M[A].lineParam>=0&&M[A].lineParam<=b){M[A].lineParam=t.getCurve().closestToPointParam(x.evaluatePosition(M[A].lineParam),[]);var T=g(e,M[A].circleParam*(e.isReversed()?-1:1),o,t),V=g(t,M[A].lineParam*(t.isReversed()?-1:1),o,e);V&&T&&d.push({cutInfo:T,cutByInfo:V})}return d}var S=i.Vector2.createFloat64(),R=i.Vector2.createFloat64(),L=i.Vector2.createFloat64(),P=i.Vector2.createFloat64();S[0]=-a[0]+3*a[3]-3*a[6]+a[9],S[1]=-a[1]+3*a[4]-3*a[7]+a[10],R[0]=3*a[0]-6*a[3]+3*a[6],R[1]=3*a[1]-6*a[4]+3*a[7],L[0]=-3*a[0]+3*a[3],L[1]=-3*a[1]+3*a[4],P[0]=a[0],P[1]=a[1];var O=e.getCurve().getCenter(),D=e.getCurve().getRadius()*e.getCurve().getRadius(),I=D,N=new Float64Array(7);N[0]=I*S[0]*S[0]+D*S[1]*S[1],N[1]=2*I*S[0]*R[0]+2*R[1]*D*S[1],N[2]=2*L[0]*I*S[0]+R[1]*R[1]*D+I*R[0]*R[0]+2*L[1]*D*S[1],N[3]=-2*O[1]*D*S[1]+2*R[1]*L[1]*D+2*L[0]*I*R[0]-2*I*S[0]*O[0]+2*I*S[0]*P[0]+2*P[1]*D*S[1],N[4]=-2*I*O[0]*R[0]+L[1]*L[1]*D-2*O[1]*R[1]*D+2*I*P[0]*R[0]+L[0]*L[0]*I+2*P[1]*R[1]*D,N[5]=-2*O[1]*L[1]*D-2*L[0]*I*O[0]+2*L[0]*I*P[0]+2*P[1]*L[1]*D,N[6]=I*O[0]*O[0]-2*P[1]*O[1]*D-I*D+O[1]*O[1]*D+P[1]*P[1]*D-2*I*O[0]*P[0]+I*P[0]*P[0];var k=(0,u.getRealPolynomialRoots)(N);for(A=0;A<k.length;++A)if(k[A]>=0&&k[A]<=1){k[A]=c[0]+(c[c.length-1]-c[0])*k[A];var B=t.getCurve().evaluatePosition(k[A]),F=e.getCurve().closestToPointParam(B,[]),j=f(e,F*(e.isReversed()?-1:1),t,k[A]*(t.isReversed()?-1:1),o);j&&d.push(j)}return d},b=function(e,t,n,i,r){var o=e.getBoundingBox(),s=[];if(!t.getBoundingBox().intersectsWithTolerance(o,r))return s;var a=0;e.isClosed()&&i&&(a=1);for(var c=t.getCurve().getBezierSegments(),u=c.length,l=0;l<u;l++)for(var h=w(e,t,c[l],0,r),d=0;d<h.length;++d)for(var p=-a;p<=a;++p)s.push({cutInfo:{atVertex:h[d].cutInfo.atVertex,param:h[d].cutInfo.param+p*Math.PI*2},cutByInfo:h[d].cutByInfo});return A(s)},M=function(e,t,n,l,d,v,y){var _=n.getControlPoints(),E=n.getKnotVector(),A=l.getControlPoints(),C=l.getKnotVector(),w=n.getBoundingBox([E[0],E[E.length-1]]),b=l.getBoundingBox([C[0],C[C.length-1]]),M=e===t,T=!1,V=!1;M&&Math.abs(_[_.length-3]-A[0])<v&&Math.abs(_[A.length-2]-A[1])<v&&Math.abs(_[A.length-1]-A[2])<v&&(T=!0),M&&Math.abs(_[0]-A[_.length-3])<v&&Math.abs(_[1]-A[A.length-2])<v&&Math.abs(_[2]-A[A.length-1])<v&&(V=!0);var S=[];if(!w.intersectsWithTolerance(b,v))return S;var R=!0,L=!0,P=i.Vector2.createFloat64(),O=i.Vector2.createFloat64(),D=i.Vector2.createFloat64();for(Oe=0;Oe<_.length/3-2&&R;++Oe)P[0]=_[3*Oe+0],P[1]=_[3*Oe+1],O[0]=_[3*Oe+3],O[1]=_[3*Oe+4],D[0]=_[3*Oe+6],D[1]=_[3*Oe+7],R=Math.abs((0,h.orient2D)(P,O,D))<p;for(Oe=0;Oe<A.length/3-2&&L;++Oe)P[0]=A[3*Oe+0],P[1]=A[3*Oe+1],O[0]=A[3*Oe+3],O[1]=A[3*Oe+4],D[0]=A[3*Oe+6],D[1]=A[3*Oe+7],L=Math.abs((0,h.orient2D)(P,O,D))<p;if(R||L)return function(e,t,n,u,l,h,d,p,v){var y=l.getControlPoints(),_=h.getControlPoints(),E=[];if(e&&!t||!e&&t){var A,C,w=new s.Line;e?(A=i.Vector3.createFloat64FromValues(y[0],y[1],y[2]),C=i.Vector3.createFloat64FromValues(y[y.length-3],y[y.length-2],y[y.length-1])):(A=i.Vector3.createFloat64FromValues(_[0],_[1],_[2]),C=i.Vector3.createFloat64FromValues(_[_.length-3],_[_.length-2],_[_.length-1])),w.setFromEndpoints(A,C);var b=new a.Edge(w),M=i.Vector3.distance(C,A);b.setRange([0,M]);var T=new o.Point;T.setPosition(A[0],A[1],A[2]);var V=new o.Point;V.setPosition(C[0],C[1],C[2]);var S,R=new c.Vertex(T),L=new c.Vertex(V);b.setStartVertex(R),b.setEndVertex(L),ee=e?x(b,u,h,d,p):x(b,n,l,d,p);for(var P=0;P<ee.length;++P)if(ee[P].hasOwnProperty("cutInfo")&&ee[P].hasOwnProperty("cutByInfo")){if(ee[P].cutInfo.param>=0&&ee[P].cutInfo.param<=M&&(e?(ee[P].cutInfo.param=n.closestToPointParam(w.evaluatePosition(ee[P].cutInfo.param)),S=f(n,ee[P].cutInfo.param,u,ee[P].cutByInfo.param,p)):(ee[P].cutInfo.param=u.closestToPointParam(w.evaluatePosition(ee[P].cutInfo.param)),S=f(n,ee[P].cutByInfo.param,u,ee[P].cutInfo.param,p)),S))if(v){var O=S.cutInfo.param,D=S.cutByInfo.param;(I=Math.abs(O-D)*i.Vector3.length(n.evaluateDt(O)))>r.KERNEL_TOLERANCE&&!ee[P].cutInfo.virtualIntersection&&E.push(S)}else E.push(S)}else if(ee[P].hasOwnProperty("rangeInfo")&&ee[P].hasOwnProperty("rangeByInfo")&&ee[P].rangeInfo[0].param>=0&&ee[P].rangeInfo[0].param<=M&&ee[P].rangeInfo[1].param>=0&&ee[P].rangeInfo[1].param<=M)if(e?(ee[P].rangeInfo[0].param=n.closestToPointParam(w.evaluatePosition(ee[P].rangeInfo[0].param)),ee[P].rangeInfo[1].param=n.closestToPointParam(w.evaluatePosition(ee[P].rangeInfo[1].param))):(ee[P].rangeInfo[0].param=u.closestToPointParam(w.evaluatePosition(ee[P].rangeInfo[0].param)),ee[P].rangeInfo[1].param=u.closestToPointParam(w.evaluatePosition(ee[P].rangeInfo[1].param))),e?(te=[g(n,ee[P].rangeInfo[0].param,p,u),g(n,ee[P].rangeInfo[1].param,p,u)],ne=[g(u,ee[P].rangeByInfo[0].param,p,n),g(u,ee[P].rangeByInfo[1].param,p,n)]):(te=[g(n,ee[P].rangeByInfo[0].param,p,u),g(n,ee[P].rangeByInfo[1].param,p,u)],ne=[g(u,ee[P].rangeInfo[0].param,p,n),g(u,ee[P].rangeInfo[1].param,p,n)]),te[0]&&te[1]&&ne[0]&&ne[1]){var I=Math.abs(te[1].param-ne[0].param)*i.Vector3.length(n.evaluateDt(te[1]));(!v||v&&I>r.KERNEL_TOLERANCE)&&E.push({rangeInfo:te,rangeByInfo:ne})}else console.warn("Error in intersection computation.")}else{var N=new s.Line,k=new s.Line,B=i.Vector3.createFloat64FromValues(y[0],y[1],y[2]),F=i.Vector3.createFloat64FromValues(y[y.length-3],y[y.length-2],y[y.length-1]),j=i.Vector3.createFloat64FromValues(_[0],_[1],_[2]),z=i.Vector3.createFloat64FromValues(_[_.length-3],_[_.length-2],_[_.length-1]);N.setFromEndpoints(B,F),k.setFromEndpoints(j,z);var U=new a.Edge(N),G=i.Vector3.distance(F,B),Y=new a.Edge(k),W=i.Vector3.distance(z,j);U.setRange([0,G]),Y.setRange([0,W]);var H=new o.Point;H.setPosition(B[0],B[1],B[2]);var K=new o.Point;K.setPosition(F[0],F[1],F[2]);var q=new o.Point;q.setPosition(j[0],j[1],j[2]);var Q=new o.Point;Q.setPosition(z[0],z[1],z[2]);var Z=new c.Vertex(H),J=new c.Vertex(K),X=new c.Vertex(q),$=new c.Vertex(Q);U.setStartVertex(Z),U.setEndVertex(J),Y.setStartVertex(X),Y.setEndVertex($);var ee=m(U,Y,d,p);for(P=0;P<ee.length;++P)if(ee[P].hasOwnProperty("cutInfo")&&ee[P].hasOwnProperty("cutByInfo"))ee[P].cutInfo.param>=0&&ee[P].cutInfo.param<=G&&ee[P].cutByInfo.param>=0&&ee[P].cutByInfo.param<=W&&(ee[P].cutInfo.param=n.closestToPointParam(N.evaluatePosition(ee[P].cutInfo.param)),ee[P].cutByInfo.param=u.closestToPointParam(k.evaluatePosition(ee[P].cutByInfo.param)),S=f(n,ee[P].cutInfo.param,u,ee[P].cutByInfo.param,p))&&(O=S.cutInfo.param,D=S.cutByInfo.param,I=Math.abs(O-D)*i.Vector3.length(n.evaluateDt(O)),(!v||v&&I>r.KERNEL_TOLERANCE)&&E.push(S));else if(ee[P].hasOwnProperty("rangeInfo")&&ee[P].hasOwnProperty("rangeByInfo")&&ee[P].rangeInfo[0].param>=0&&ee[P].rangeInfo[0].param<=G&&ee[P].rangeInfo[1].param>=0&&ee[P].rangeInfo[1].param<=G&&ee[P].rangeByInfo[0].param>=0&&ee[P].rangeByInfo[0].param<=W&&ee[P].rangeByInfo[1].param>=0&&ee[P].rangeByInfo[1].param<=W){ee[P].rangeInfo[0].param=n.closestToPointParam(N.evaluatePosition(ee[P].rangeInfo[0].param)),ee[P].rangeInfo[1].param=n.closestToPointParam(N.evaluatePosition(ee[P].rangeInfo[1].param)),ee[P].rangeByInfo[0].param=u.closestToPointParam(k.evaluatePosition(ee[P].rangeByInfo[0].param)),ee[P].rangeByInfo[1].param=u.closestToPointParam(k.evaluatePosition(ee[P].rangeByInfo[1].param));var te=[g(n,ee[P].rangeInfo[0].param,p,u),g(n,ee[P].rangeInfo[1].param,p,u)],ne=[g(u,ee[P].rangeByInfo[0].param,p,n),g(u,ee[P].rangeByInfo[1].param,p,n)];te[0]&&te[1]&&ne[0]&&ne[1]?(I=Math.abs(te[1].param-ne[0].param)*i.Vector3.length(n.evaluateDt(te[1])),(!v||v&&I>r.KERNEL_TOLERANCE)&&E.push({rangeInfo:te,rangeByInfo:ne})):console.warn("Error in intersection computation.")}}return E}(R,L,e,t,n,l,d,v,y);var I=-_[0]+3*_[3]-3*_[6]+_[9],N=3*_[0]-6*_[3]+3*_[6],k=-3*_[0]+3*_[3],B=_[0],F=-_[1]+3*_[4]-3*_[7]+_[10],j=3*_[1]-6*_[4]+3*_[7],z=-3*_[1]+3*_[4],U=_[1],G=B*B,Y=k*k,W=N*N,H=I*I,K=B*B*B,q=k*k*k,Q=N*N*N,Z=I*I*I,J=U*U,X=z*z,$=j*j,ee=F*F,te=U*U*U,ne=z*z*z,ie=j*j*j,re=F*F*F,oe=-A[0]+3*A[3]-3*A[6]+A[9],se=3*A[0]-6*A[3]+3*A[6],ae=-3*A[0]+3*A[3],ce=A[0],ue=-A[1]+3*A[4]-3*A[7]+A[10],le=3*A[1]-6*A[4]+3*A[7],he=-3*A[1]+3*A[4],de=A[1],pe=ce*ce,ge=ce*ce*ce,fe=de*de,ve=de*de*de,ye=ae*ae,me=ae*ae*ae,_e=he*he,Ee=he*he*he,Ae=se*se,xe=se*se*se,Ce=le*le,we=le*le*le,be=oe*oe,Me=ue*ue,Te=new Float64Array(10),Ve=I*ue-F*oe;Te[0]=Ve*Ve*Ve,Te[1]=3*(I*le-F*se)*Ve*Ve,Te[2]=3*(I*ue-F*oe)*(H*he*ue+H*Ce-I*F*ae*ue-2*I*F*se*le-I*F*oe*he+ee*ae*oe+ee*Ae),Te[3]=3*B*H*F*Me-6*B*I*ee*oe*ue+3*B*re*be-3*k*N*I*F*Me+3*k*N*ee*oe*ue+2*k*H*j*Me-k*I*j*F*oe*ue-k*j*ee*be+Q*F*Me-W*I*j*Me-2*W*j*F*oe*ue+N*H*z*Me+N*I*z*F*oe*ue+2*N*I*$*oe*ue-2*N*z*ee*be+N*$*F*be-3*Z*U*Me+3*Z*de*Me+6*Z*he*le*ue+Z*we+6*H*U*F*oe*ue-3*H*z*j*oe*ue-3*H*F*ce*Me-6*H*F*ae*le*ue-6*H*F*se*he*ue-3*H*F*se*Ce-6*H*F*oe*de*ue-6*H*F*oe*he*le-3*I*U*ee*be+3*I*z*j*F*be-I*ie*be+6*I*ee*ce*oe*ue+6*I*ee*ae*se*ue+6*I*ee*ae*oe*le+3*I*ee*Ae*le+6*I*ee*se*oe*he+3*I*ee*be*de-3*re*ce*be-6*re*ae*se*oe-re*xe,Te[4]=6*B*H*F*le*ue-6*B*I*ee*se*ue-6*B*I*ee*oe*le+6*B*re*se*oe-6*k*N*I*F*le*ue+3*k*N*ee*se*ue+3*k*N*ee*oe*le+4*k*H*j*le*ue-k*I*j*F*se*ue-k*I*j*F*oe*le-2*k*j*ee*se*oe+2*Q*F*le*ue-2*W*I*j*le*ue-2*W*j*F*se*ue-2*W*j*F*oe*le+2*N*H*z*le*ue+N*I*z*F*se*ue+N*I*z*F*oe*le+2*N*I*$*se*ue+2*N*I*$*oe*le-4*N*z*ee*se*oe+2*N*$*F*se*oe-6*Z*U*le*ue+6*Z*de*le*ue+3*Z*_e*ue+3*Z*he*Ce+6*H*U*F*se*ue+6*H*U*F*oe*le-3*H*z*j*se*ue-3*H*z*j*oe*le-6*H*F*ce*le*ue-6*H*F*ae*he*ue-3*H*F*ae*Ce-6*H*F*se*de*ue-6*H*F*se*he*le-6*H*F*oe*de*le-3*H*F*oe*_e-6*I*U*ee*se*oe+6*I*z*j*F*se*oe-2*I*ie*se*oe+6*I*ee*ce*se*ue+6*I*ee*ce*oe*le+3*I*ee*ye*ue+6*I*ee*ae*se*le+6*I*ee*ae*oe*he+3*I*ee*Ae*he+6*I*ee*se*oe*de-6*re*ce*se*oe-3*re*ye*oe-3*re*ae*Ae,Te[5]=6*B*H*F*he*ue+3*B*H*F*Ce-6*B*I*ee*ae*ue-6*B*I*ee*se*le-6*B*I*ee*oe*he+6*B*re*ae*oe+3*B*re*Ae-6*k*N*I*F*he*ue-3*k*N*I*F*Ce+3*k*N*ee*ae*ue+3*k*N*ee*se*le+3*k*N*ee*oe*he+4*k*H*j*he*ue+2*k*H*j*Ce-k*I*j*F*ae*ue-k*I*j*F*se*le-k*I*j*F*oe*he-2*k*j*ee*ae*oe-k*j*ee*Ae+2*Q*F*he*ue+Q*F*Ce-2*W*I*j*he*ue-W*I*j*Ce-2*W*j*F*ae*ue-2*W*j*F*se*le-2*W*j*F*oe*he+2*N*H*z*he*ue+N*H*z*Ce+N*I*z*F*ae*ue+N*I*z*F*se*le+N*I*z*F*oe*he+2*N*I*$*ae*ue+2*N*I*$*se*le+2*N*I*$*oe*he-4*N*z*ee*ae*oe-2*N*z*ee*Ae+2*N*$*F*ae*oe+N*$*F*Ae-6*Z*U*he*ue-3*Z*U*Ce+6*Z*de*he*ue+3*Z*de*Ce+3*Z*_e*le+6*H*U*F*ae*ue+6*H*U*F*se*le+6*H*U*F*oe*he-3*H*z*j*ae*ue-3*H*z*j*se*le-3*H*z*j*oe*he-6*H*F*ce*he*ue-3*H*F*ce*Ce-6*H*F*ae*de*ue-6*H*F*ae*he*le-6*H*F*se*de*le-3*H*F*se*_e-6*H*F*oe*de*he-6*I*U*ee*ae*oe-3*I*U*ee*Ae+6*I*z*j*F*ae*oe+3*I*z*j*F*Ae-2*I*ie*ae*oe-I*ie*Ae+6*I*ee*ce*ae*ue+6*I*ee*ce*se*le+6*I*ee*ce*oe*he+3*I*ee*ye*le+6*I*ee*ae*se*he+6*I*ee*ae*oe*de+3*I*ee*Ae*de-6*re*ce*ae*oe-3*re*ce*Ae-3*re*ye*se,Te[6]=3*G*I*ee*ue-3*G*re*oe-3*B*k*N*ee*ue+B*k*I*j*F*ue+2*B*k*j*ee*oe+2*B*W*j*F*ue-B*N*I*z*F*ue-2*B*N*I*$*ue+4*B*N*z*ee*oe-2*B*N*$*F*oe-6*B*H*U*F*ue+3*B*H*z*j*ue+6*B*H*F*de*ue+6*B*H*F*he*le+6*B*I*U*ee*oe-6*B*I*z*j*F*oe+2*B*I*ie*oe-6*B*I*ee*ce*ue-6*B*I*ee*ae*le-6*B*I*ee*se*he-6*B*I*ee*oe*de+6*B*re*ce*oe+6*B*re*ae*se+q*ee*ue-Y*N*j*F*ue-2*Y*I*z*F*ue+Y*I*$*ue-Y*z*ee*oe+k*W*z*F*ue+6*k*N*I*U*F*ue-k*N*I*z*j*ue-6*k*N*I*F*de*ue-6*k*N*I*F*he*le-3*k*N*U*ee*oe+k*N*z*j*F*oe+3*k*N*ee*ce*ue+3*k*N*ee*ae*le+3*k*N*ee*se*he+3*k*N*ee*oe*de-4*k*H*U*j*ue+k*H*X*ue+4*k*H*j*de*ue+4*k*H*j*he*le+k*I*U*j*F*oe+2*k*I*X*F*oe-k*I*z*$*oe-k*I*j*F*ce*ue-k*I*j*F*ae*le-k*I*j*F*se*he-k*I*j*F*oe*de-2*k*j*ee*ce*oe-2*k*j*ee*ae*se-2*Q*U*F*ue+2*Q*F*de*ue+2*Q*F*he*le+2*W*I*U*j*ue-2*W*I*j*de*ue-2*W*I*j*he*le+2*W*U*j*F*oe-W*X*F*oe-2*W*j*F*ce*ue-2*W*j*F*ae*le-2*W*j*F*se*he-2*W*j*F*oe*de-2*N*H*U*z*ue+2*N*H*z*de*ue+2*N*H*z*he*le-N*I*U*z*F*oe-2*N*I*U*$*oe+N*I*X*j*oe+N*I*z*F*ce*ue+N*I*z*F*ae*le+N*I*z*F*se*he+N*I*z*F*oe*de+2*N*I*$*ce*ue+2*N*I*$*ae*le+2*N*I*$*se*he+2*N*I*$*oe*de-4*N*z*ee*ce*oe-4*N*z*ee*ae*se+2*N*$*F*ce*oe+2*N*$*F*ae*se+3*Z*J*ue-6*Z*U*de*ue-6*Z*U*he*le+3*Z*fe*ue+6*Z*de*he*le+Z*Ee-3*H*J*F*oe+3*H*U*z*j*oe+6*H*U*F*ce*ue+6*H*U*F*ae*le+6*H*U*F*se*he+6*H*U*F*oe*de-H*ne*oe-3*H*z*j*ce*ue-3*H*z*j*ae*le-3*H*z*j*se*he-3*H*z*j*oe*de-6*H*F*ce*de*ue-6*H*F*ce*he*le-6*H*F*ae*de*le-3*H*F*ae*_e-6*H*F*se*de*he-3*H*F*oe*fe-6*I*U*ee*ce*oe-6*I*U*ee*ae*se+6*I*z*j*F*ce*oe+6*I*z*j*F*ae*se-2*I*ie*ce*oe-2*I*ie*ae*se+3*I*ee*pe*ue+6*I*ee*ce*ae*le+6*I*ee*ce*se*he+6*I*ee*ce*oe*de+3*I*ee*ye*he+6*I*ee*ae*se*de-3*re*pe*oe-6*re*ce*ae*se-re*me,Te[7]=3*G*I*ee*le-3*G*re*se-3*B*k*N*ee*le+B*k*I*j*F*le+2*B*k*j*ee*se+2*B*W*j*F*le-B*N*I*z*F*le-2*B*N*I*$*le+4*B*N*z*ee*se-2*B*N*$*F*se-6*B*H*U*F*le+3*B*H*z*j*le+6*B*H*F*de*le+3*B*H*F*_e+6*B*I*U*ee*se-6*B*I*z*j*F*se+2*B*I*ie*se-6*B*I*ee*ce*le-6*B*I*ee*ae*he-6*B*I*ee*se*de+6*B*re*ce*se+3*B*re*ye+q*ee*le-Y*N*j*F*le-2*Y*I*z*F*le+Y*I*$*le-Y*z*ee*se+k*W*z*F*le+6*k*N*I*U*F*le-k*N*I*z*j*le-6*k*N*I*F*de*le-3*k*N*I*F*_e-3*k*N*U*ee*se+k*N*z*j*F*se+3*k*N*ee*ce*le+3*k*N*ee*ae*he+3*k*N*ee*se*de-4*k*H*U*j*le+k*H*X*le+4*k*H*j*de*le+2*k*H*j*_e+k*I*U*j*F*se+2*k*I*X*F*se-k*I*z*$*se-k*I*j*F*ce*le-k*I*j*F*ae*he-k*I*j*F*se*de-2*k*j*ee*ce*se-k*j*ee*ye-2*Q*U*F*le+2*Q*F*de*le+Q*F*_e+2*W*I*U*j*le-2*W*I*j*de*le-W*I*j*_e+2*W*U*j*F*se-W*X*F*se-2*W*j*F*ce*le-2*W*j*F*ae*he-2*W*j*F*se*de-2*N*H*U*z*le+2*N*H*z*de*le+N*H*z*_e-N*I*U*z*F*se-2*N*I*U*$*se+N*I*X*j*se+N*I*z*F*ce*le+N*I*z*F*ae*he+N*I*z*F*se*de+2*N*I*$*ce*le+2*N*I*$*ae*he+2*N*I*$*se*de-4*N*z*ee*ce*se-2*N*z*ee*ye+2*N*$*F*ce*se+N*$*F*ye+3*Z*J*le-6*Z*U*de*le-3*Z*U*_e+3*Z*fe*le+3*Z*de*_e-3*H*J*F*se+3*H*U*z*j*se+6*H*U*F*ce*le+6*H*U*F*ae*he+6*H*U*F*se*de-H*ne*se-3*H*z*j*ce*le-3*H*z*j*ae*he-3*H*z*j*se*de-6*H*F*ce*de*le-3*H*F*ce*_e-6*H*F*ae*de*he-3*H*F*se*fe-6*I*U*ee*ce*se-3*I*U*ee*ye+6*I*z*j*F*ce*se+3*I*z*j*F*ye-2*I*ie*ce*se-I*ie*ye+3*I*ee*pe*le+6*I*ee*ce*ae*he+6*I*ee*ce*se*de+3*I*ee*ye*de-3*re*pe*se-3*re*ce*ye,Te[8]=3*G*I*ee*he-3*G*re*ae-3*B*k*N*ee*he+B*k*I*j*F*he+2*B*k*j*ee*ae+2*B*W*j*F*he-B*N*I*z*F*he-2*B*N*I*$*he+4*B*N*z*ee*ae-2*B*N*$*F*ae-6*B*H*U*F*he+3*B*H*z*j*he+6*B*H*F*de*he+6*B*I*U*ee*ae-6*B*I*z*j*F*ae+2*B*I*ie*ae-6*B*I*ee*ce*he-6*B*I*ee*ae*de+6*B*re*ce*ae+q*ee*he-Y*N*j*F*he-2*Y*I*z*F*he+Y*I*$*he-Y*z*ee*ae+k*W*z*F*he+6*k*N*I*U*F*he-k*N*I*z*j*he-6*k*N*I*F*de*he-3*k*N*U*ee*ae+k*N*z*j*F*ae+3*k*N*ee*ce*he+3*k*N*ee*ae*de-4*k*H*U*j*he+k*H*X*he+4*k*H*j*de*he+k*I*U*j*F*ae+2*k*I*X*F*ae-k*I*z*$*ae-k*I*j*F*ce*he-k*I*j*F*ae*de-2*k*j*ee*ce*ae-2*Q*U*F*he+2*Q*F*de*he+2*W*I*U*j*he-2*W*I*j*de*he+2*W*U*j*F*ae-W*X*F*ae-2*W*j*F*ce*he-2*W*j*F*ae*de-2*N*H*U*z*he+2*N*H*z*de*he-N*I*U*z*F*ae-2*N*I*U*$*ae+N*I*X*j*ae+N*I*z*F*ce*he+N*I*z*F*ae*de+2*N*I*$*ce*he+2*N*I*$*ae*de-4*N*z*ee*ce*ae+2*N*$*F*ce*ae+3*Z*J*he-6*Z*U*de*he+3*Z*fe*he-3*H*J*F*ae+3*H*U*z*j*ae+6*H*U*F*ce*he+6*H*U*F*ae*de-H*ne*ae-3*H*z*j*ce*he-3*H*z*j*ae*de-6*H*F*ce*de*he-3*H*F*ae*fe-6*I*U*ee*ce*ae+6*I*z*j*F*ce*ae-2*I*ie*ce*ae+3*I*ee*pe*he+6*I*ee*ce*ae*de-3*re*pe*ae,Te[9]=K*re-G*k*j*ee-2*G*N*z*ee+G*N*$*F-3*G*I*U*ee+3*G*I*z*j*F-G*I*ie+3*G*I*ee*de-3*G*re*ce+B*Y*z*ee+3*B*k*N*U*ee-B*k*N*z*j*F-3*B*k*N*ee*de-B*k*I*U*j*F-2*B*k*I*X*F+B*k*I*z*$+B*k*I*j*F*de+2*B*k*j*ee*ce-2*B*W*U*j*F+B*W*X*F+2*B*W*j*F*de+B*N*I*U*z*F+2*B*N*I*U*$-B*N*I*X*j-B*N*I*z*F*de-2*B*N*I*$*de+4*B*N*z*ee*ce-2*B*N*$*F*ce+3*B*H*J*F-3*B*H*U*z*j-6*B*H*U*F*de+B*H*ne+3*B*H*z*j*de+3*B*H*F*fe+6*B*I*U*ee*ce-6*B*I*z*j*F*ce+2*B*I*ie*ce-6*B*I*ee*ce*de+3*B*re*pe-q*U*ee+q*ee*de+Y*N*U*j*F-Y*N*j*F*de+2*Y*I*U*z*F-Y*I*U*$-2*Y*I*z*F*de+Y*I*$*de-Y*z*ee*ce-k*W*U*z*F+k*W*z*F*de-3*k*N*I*J*F+k*N*I*U*z*j+6*k*N*I*U*F*de-k*N*I*z*j*de-3*k*N*I*F*fe-3*k*N*U*ee*ce+k*N*z*j*F*ce+3*k*N*ee*ce*de+2*k*H*J*j-k*H*U*X-4*k*H*U*j*de+k*H*X*de+2*k*H*j*fe+k*I*U*j*F*ce+2*k*I*X*F*ce-k*I*z*$*ce-k*I*j*F*ce*de-k*j*ee*pe+Q*J*F-2*Q*U*F*de+Q*F*fe-W*I*J*j+2*W*I*U*j*de-W*I*j*fe+2*W*U*j*F*ce-W*X*F*ce-2*W*j*F*ce*de+N*H*J*z-2*N*H*U*z*de+N*H*z*fe-N*I*U*z*F*ce-2*N*I*U*$*ce+N*I*X*j*ce+N*I*z*F*ce*de+2*N*I*$*ce*de-2*N*z*ee*pe+N*$*F*pe-Z*te+3*Z*J*de-3*Z*U*fe+Z*ve-3*H*J*F*ce+3*H*U*z*j*ce+6*H*U*F*ce*de-H*ne*ce-3*H*z*j*ce*de-3*H*F*ce*fe-3*I*U*ee*pe+3*I*z*j*F*pe-I*ie*pe+3*I*ee*pe*de-re*ge;var Se=(0,u.getRealPolynomialRoots)(Te),Re=l.getApproxParameterSpaceTolerance(),Le=-Re,Pe=1+Re;T&&(Le=Re),V&&(Pe=1-Re);for(var Oe=0;Oe<Se.length;++Oe)if(Se[Oe]>=Le&&Se[Oe]<=Pe){Se[Oe]<0?Se[Oe]=0:Se[Oe]>1&&(Se[Oe]=1),Se[Oe]=C[0]+(C[C.length-1]-C[0])*Se[Oe];var De=t.getCurve().evaluatePosition(Se[Oe]);if(w.isPointInsideWithTolerance(De)){var Ie=n.closestToPointParam(De,[]);if(Ie>=E[0]&&Ie<=E[E.length-1]){var Ne=e.getCurve().evaluatePosition(Ie);if(i.Vector3.squaredDistance(Ne,De)<=v*v){var ke=f(e,Ie*(e.isReversed()?-1:1),t,Se[Oe]*(t.isReversed()?-1:1),v);ke&&S.push(ke)}}}}return S},T=function(e,t,n,r){var o=[],a=t.getControlPoints(),c=e.isReversed()?-1:1,u=new s.Line,h=i.Vector3.createFloat64FromValues(a[0],a[1],a[2]),d=i.Vector3.createFloat64FromValues(a[a.length-3],a[a.length-2],a[a.length-1]);u.setFromEndpoints(h,d);var p=i.Vector3.distance(d,h),g=i.Vector3.createFloat64FromValues(a[3],a[4],a[5]),v=i.Vector3.createFloat64FromValues(a[6],a[7],a[8]);if(u.closestToPointParam(g,[])>0&&u.closestToPointParam(g,[])<p&&u.closestToPointParam(v,[])>0&&u.closestToPointParam(v,[])<p)return o;var y,m=-a[0]+3*a[3]-3*a[6]+a[9],_=-a[1]+3*a[4]-3*a[7]+a[10],E=3*a[0]-6*a[3]+3*a[6],A=3*a[1]-6*a[4]+3*a[7],x=-3*a[0]+3*a[3],C=-3*a[1]+3*a[4],w=E/m,b=x/m,M=A/_,T=C/_;if(Math.abs(w-M)<r||Math.abs(T-b)<r)return o;var V=new Float64Array(4);if(Math.abs(m)<r&&Math.abs(_)<r)return o;Math.abs(m)<r?(y=-x/E,w=M,b=T):y=Math.abs(_)<r?-C/A:(T-b)/(w-M),V[0]=(-y*y*y-w*y*y-b*y)/2,V[1]=(3*y*y+2*y*w+2*b)/2,V[2]=-1.5*y,V[3]=1;var S,R=new Float64Array(3);if(3!==l.SplineCurveHelper.solve_cubic_uniqueRoots(V,R))return o;if(R[1]<R[0]&&(S=R[0],R[0]=R[1],R[1]=S),R[2]<R[0]&&(S=R[0],R[0]=R[2],R[2]=S),R[2]<R[1]&&(S=R[1],R[1]=R[2],R[2]=S),R[0]>=0&&R[0]<=1&&R[2]>=0&&R[2]<=1){var L=t.getKnotVector();R[0]=L[0]+(L[L.length-1]-L[0])*R[0],R[2]=L[0]+(L[L.length-1]-L[0])*R[2];var P=f(e,R[0]*c,e,R[2]*c,r);P&&o.push(P)}return o};t.computeCurveCurveIntersections=function(e,t,n,o,s){s=void 0===s?r.KERNEL_TOLERANCE:s;var a=e.getCurveType(),c=a===r.GEOMETRY_TYPES.CIRCLE,u=a===r.GEOMETRY_TYPES.LINE,l=a===r.GEOMETRY_TYPES.BCURVE&&!e.getCurve().isRational()&&3===e.getCurve().getDegree(),p=t.getCurveType(),v=p===r.GEOMETRY_TYPES.CIRCLE,x=p===r.GEOMETRY_TYPES.LINE,w=p===r.GEOMETRY_TYPES.BCURVE&&!t.getCurve().isRational()&&3===t.getCurve().getDegree();return u&&v?function(e,t,n){for(var i=_(e.getCurve(),t.getCurve(),n),r=[],o=0;o<i.length;++o){var s=(e.isReversed()?-1:1)*i[o].lineParam,a=(t.isReversed()?-1:1)*i[o].circleParam,c=f(e,s,t,a,n);c&&r.push(c)}return r}(e,t,s):c&&x?function(e,t,n,i){var r=_(t.getCurve(),e.getCurve(),i),o=[],s=0;e.isClosed()&&n&&(s=1);for(var a=0;a<r.length;++a){var c=(e.isReversed()?-1:1)*r[a].circleParam,u=(t.isReversed()?-1:1)*r[a].lineParam,l=f(e,c,t,u,i);if(l)for(var h=-s;h<=s;++h)o.push({cutInfo:{atVertex:l.cutInfo.atVertex,param:l.cutInfo.param+h*Math.PI*2},cutByInfo:l.cutByInfo})}return o}(e,t,o,s):u&&x?m(e,t,n,s):c&&v?function(e,t,n,r,o){var s=[],a=e.getCurve().getCenter(),c=e.getCurve().getRadius(),u=t.getCurve().getCenter(),l=t.getCurve().getRadius(),d=2*Math.PI,p=i.Vector3.createFloat64();i.Vector3.sub(p,u,a);var v=i.Vector3.length(p),m=Math.abs(c-l);if(v<m-o)return s;if(v+m<o){var _=o/c;if(e.getRange()[1]-e.getRange()[0]>d-_&&t.getRange()[1]-t.getRange()[0]>d-_)return s.push({rangeInfo:[g(e,e.getRange()[0],o,t),g(e,e.getRange()[1],o,t)],rangeByInfo:[g(t,t.getRange()[0],o,e),g(t,t.getRange()[1],o,e)]}),s;var A=[],x=e.closestToPointParam(t.evaluatePosition(0),[0,d]),C=i.Vector3.dot(e.evaluateDt(x),t.evaluateDt(0))<0,w=e.getRange(),b=t.getRange();b=C?[x-b[1],x-b[0]]:[x+b[0],x+b[1]];var M=(0,h.foldAbove)(b[0],w[0],d)-b[0];if((b=[b[0]+M,b[1]+M])[0]<w[1]+_&&A.push([Math.min(b[0],w[1]),Math.min(w[1],b[1])]),b[1]>w[0]+d-_&&A.push([w[0],Math.max(w[0],Math.min(w[1],b[1]-d))]),w[1]-w[0]>d-_||b[1]-b[0]>d-_)for(var T=A.length-1;T>=0&&1!==A.length;--T)A[T][1]-A[T][0]<_&&A.splice(T,1);for(T=0;T<A.length;++T){var V=A[T],S=C?[x-V[1],x-V[0]]:[V[0]-x,V[1]-x],R=(0,h.foldAbove)(S[0],t.getRange()[0],d)-S[0];if(S=[S[0]+R,S[1]+R],V[1]-V[0]<_){var L=.5*(V[0]+V[1]),P=.5*(S[0]+S[1]),O=g(e,L,o,t),D=g(t,P,o,e);O&&D&&s.push({cutInfo:O,cutByInfo:D})}else{var I=[g(e,V[0],o,t),g(e,V[1],o,t)],N=[g(t,S[0],o,e),g(t,S[1],o,e)];I[0]&&I[1]&&N[0]&&N[1]&&s.push({rangeInfo:I,rangeByInfo:N})}}return s}var k=(c*c-l*l+v*v)/(2*v),B=c*c-k*k,F=c-Math.abs(k),j=[],z=[];if(F<-o);else{var U=Math.sqrt(Math.max(0,B));if(i.Vector3.scale(p,p,1/v),U<2*o)j.push(E(0,k,a,p,e,t)),z.push(!1);else if(F<o)if(z.push(!1),n){z[z.length-1]=!0;var G=E(0,k,a,p,e,t),Y=[E(U,k,a,p,e,t),E(-U,k,a,p,e,t)];y(e,t,[Y[0].firstParam,G.firstParam,Y[1].firstParam],[Y[0].secondParam,G.secondParam,Y[1].secondParam],o,s,j)}else j.push(E(0,k,a,p,e,t));else j.push(E(U,k,a,p,e,t)),j.push(E(-U,k,a,p,e,t))}var W=0;for(e.isClosed()&&r&&(W=1),T=0;T<j.length;++T){var H=f(e,j[T].firstParam,t,j[T].secondParam,o);if(H)for(var K=-W;K<=W;++K)s.push({cutInfo:{atVertex:H.cutInfo.atVertex,param:H.cutInfo.param+K*Math.PI*2},cutByInfo:H.cutByInfo}),z[T]&&(s[s.length-1].cutInfo.virtualIntersection=!0,s[s.length-1].cutByInfo.virtualIntersection=!0)}return s}(e,t,n,o,s):u&&w?C(e,t,n,s):l&&x?function(e,t,n,i,r){var o=C(t,e,n,r),s=[],a=0,c=0;i&&e.getCurve().isPeriodicUnlimited()&&(a=1,c=e.getCurve().getPeriodUnlimited());for(var u=0;u<o.length;++u)if(o[u].hasOwnProperty("cutInfo")&&o[u].hasOwnProperty("cutByInfo"))for(var l=-a;l<=a;++l)s.push({cutInfo:{atVertex:o[u].cutByInfo.atVertex,param:o[u].cutByInfo.param+l*c},cutByInfo:o[u].cutInfo});else o[u].hasOwnProperty("rangeInfo")&&o[u].hasOwnProperty("rangeByInfo")&&s.push({rangeInfo:o[u].rangeByInfo,rangeByInfo:o[u].rangeInfo});return s}(e,t,n,o,s):c&&w?b(e,t,0,o,s):l&&v?function(e,t,n,i,r){var o=b(t,e,0,!1,r),s=[],a=0,c=0;i&&e.getCurve().isPeriodicUnlimited()&&(a=1,c=e.getCurve().getPeriodUnlimited());for(var u=0;u<o.length;++u)if(o[u].hasOwnProperty("cutInfo")&&o[u].hasOwnProperty("cutByInfo"))for(var l=-a;l<=a;++l)s.push({cutInfo:{atVertex:o[u].cutByInfo.atVertex,param:o[u].cutByInfo.param+l*c},cutByInfo:o[u].cutInfo});else o[u].hasOwnProperty("rangeInfo")&&o[u].hasOwnProperty("rangeByInfo")&&s.push({rangeInfo:o[u].rangeByInfo,rangeByInfo:o[u].rangeInfo});return s}(e,t,0,o,s):l&&w?function(e,t,n,i,r){var o=e===t,s=e.getBoundingBox(),a=t.getBoundingBox(),c=[];if(!s.intersectsWithTolerance(a,r))return c;var u,l,h,d,p=e.getCurve().getBezierSegments(),g=p.length,f=t.getCurve().getBezierSegments(),v=f.length,y=[],m=0,_=0,E=0;for(i&&e.getCurve().isPeriodic()&&e.isClosed()&&(_=1,E=e.getCurve().getPeriod()),u=0;u<g;u++)for(o&&(m=u+1),l=m;l<v;l++){var x=o&&l===u+1;for(y=M(e,t,p[u],f[l],n,r,x),h=0;h<y.length;++h)for(d=-_;d<=_;++d)y[h].cutInfo&&c.push({cutInfo:{atVertex:y[h].cutInfo.atVertex,param:y[h].cutInfo.param+d*E},cutByInfo:y[h].cutByInfo}),y[h].rangeInfo&&c.push(y[h])}if(o)for(u=0;u<g;++u)for(y=T(e,p[u],0,r),h=0;h<y.length;++h)for(d=-_;d<=_;++d)y[h].cutInfo&&c.push({cutInfo:{atVertex:y[h].cutInfo.atVertex,param:y[h].cutInfo.param+d*E},cutByInfo:y[h].cutByInfo}),y[h].rangeInfo&&c.push(y[h]);return A(c)}(e,t,n,o,s):function(e,t,n,i,o){var s=e.getBoundingBox(),a=t.getBoundingBox(),c=[];if(!s.intersectsWithTolerance(a,o))return c;var u=e.isReversed(),l=t.isReversed(),h=e.getRange();u&&(h=[-h[1],-h[0]]);var p=t.getRange();l&&(p=[-p[1],-p[0]]),c=new d.CCI(e.getCurve(),h,t.getCurve(),p,r.KERNEL_TOLERANCE).intersect();for(var g=0;g<c.length;++g)u&&(c[g].cutInfo?c[g].cutInfo.param*=-1:c[g].rangeInfo&&(c[g].rangeInfo=[c[g].rangeInfo[1],c[g].rangeInfo[0]],c[g].rangeInfo[0].param*=-1,c[g].rangeInfo[1].param*=-1)),l&&(c[g].cutByInfo?c[g].cutByInfo.param*=-1:c[g].rangeByInfo&&(c[g].rangeByInfo[0].param*=-1,c[g].rangeByInfo[1].param*=-1));return c}(e,t,0,0,s)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.edgesAreCoincident=t.curvesAreCoincident=void 0;var i=n(1),r=n(0),o=n(2),s=n(8);function a(e,t,n,r,o){var s=e.evaluatePosition(t),a=n.closestToPointParam(s,r),c=n.evaluatePosition(a);return i.Vector3.squaredDistance(s,c)<o*o}function c(e,t,n,r,o,s){var c=[0,0,0];if(i.Vector3.isParallel(e,t.getNormal()))return!0;i.Vector3.add(c,t.getCenter(),e);var u=t.closestToPointParam(c,r);if(u>r[0]&&u<r[1]&&!a(t,u,n,o,s))return!1;i.Vector3.sub(c,t.getCenter(),e);var l=t.closestToPointParam(c,r);return!(l>r[0]&&l<r[1]&&!a(t,l,n,o,s))}function u(e,t,n,i,r){if(!a(e,.5*(n[0]+n[1]),t,i,r))return!1;var o=t.closestToPointParam(e.getCenter(),i);return!(o>i[0]&&o<i[1]&&!a(t,o,e,n,r))}var l=function(e,t,n,l,h){n?0===n.length&&(n=e.getRangeUnlimited()):n=e.getRange(),l?0===l.length&&(l=t.getRangeUnlimited()):l=t.getRange(),h||(h=r.KERNEL_TOLERANCE);var d=e.getGeometryType(),p=t.getGeometryType();if(!(isFinite(n[0])&&isFinite(n[1])&&isFinite(l[0])&&isFinite(l[1]))){var g=n[0]===Number.NEGATIVE_INFINITY&&n[1]===Number.POSITIVE_INFINITY,f=l[0]===Number.NEGATIVE_INFINITY&&l[1]===Number.POSITIVE_INFINITY;return!(!g||!f)&&(o.ConsoleUtils.assert(d===r.GEOMETRY_TYPES.LINE&&p===r.GEOMETRY_TYPES.LINE),function(e,t,n){if(e===t)return!0;if(!a(e,0,t,[],n)||!a(t,0,e,[],n))return!1;var r=e.evaluateDt(0);i.Vector3.normalize(r,r);var o=t.evaluateDt(0);return i.Vector3.normalize(o,o),i.Vector3.dot(r,o)<0&&i.Vector3.negate(o,o),i.Vector3.equals(r,o,i.FLOAT64_TOLERANCE)}(e,t,h))}return e===t&&Math.abs(n[0]-l[0])<i.FLOAT64_TOLERANCE&&Math.abs(n[1]-l[1])<i.FLOAT64_TOLERANCE||!!(a(e,n[0],t,l,h)&&a(e,n[1],t,l,h)&&a(t,l[0],e,n,h)&&a(t,l[1],e,n,h))&&(d===r.GEOMETRY_TYPES.LINE&&p===r.GEOMETRY_TYPES.LINE||(d===r.GEOMETRY_TYPES.CIRCLE&&p===r.GEOMETRY_TYPES.CIRCLE?function(e,t,n,r,o){var s=.5*(n[0]+n[1]),u=.5*(r[0]+r[1]);if(!a(e,s,t,r,o)||!a(t,u,e,n,o))return!1;var l=i.Vector3.sub([0,0,0],t.getCenter(),e.getCenter());if(i.Vector3.squaredLength(l)>i.FLOAT64_TOLERANCE*i.FLOAT64_TOLERANCE){if(i.Vector3.normalize(l,l),!c(l,e,t,n,r,o))return!1;if(!c(l,t,e,r,n,o))return!1}if(i.Vector3.dot(e.getNormal(),t.getNormal())<0?i.Vector3.add(l,e.getNormal(),t.getNormal()):i.Vector3.sub(l,e.getNormal(),t.getNormal()),i.Vector3.squaredLength(l)>i.FLOAT64_TOLERANCE*i.FLOAT64_TOLERANCE){if(i.Vector3.normalize(l,l),!c(l,e,t,n,r,o))return!1;if(!c(l,t,e,r,n,o))return!1}if(n[1]-n[0]<2*Math.PI-i.FLOAT64_TOLERANCE){var h=e.evaluatePosition(s+Math.PI),d=t.closestToPointParam(h,r);if(d>r[0]&&d<r[1]&&!a(t,d,e,n,o))return!1}if(r[1]-r[0]<2*Math.PI-i.FLOAT64_TOLERANCE){var p=t.evaluatePosition(u+Math.PI),g=e.closestToPointParam(p,n);if(g>n[0]&&g<n[1]&&!a(e,g,t,r,o))return!1}return!0}(e,t,n,l,h):d===r.GEOMETRY_TYPES.CIRCLE&&p===r.GEOMETRY_TYPES.LINE?u(e,t,n,l,h):d===r.GEOMETRY_TYPES.LINE&&p===r.GEOMETRY_TYPES.CIRCLE?u(t,e,l,n,h):function(e,t,n,r,o){for(var a=[n[0],n[1]],c=[e.evaluatePosition(n[0]),e.evaluatePosition(n[1])],u=0;u<100;++u){var l=.5*(a[0]+a[1]),h=e.evaluatePosition(l),d=t.closestToPointParam(h,r),p=t.evaluatePosition(d),g=i.Vector3.sub([0,0,0],p,h);if(i.Vector3.squaredLength(g)>o*o)return!1;if(i.Vector3.distance(c[0],h)+i.Vector3.distance(h,c[1])<o)return!0;var f=e.evaluateDt(l);i.Vector3.dot(f,g)<0?(a[0]=l,c[0]=h):(a[1]=l,c[1]=h)}return s.DebugUtils.warn("Binary search in coincidence check exceeded maximum iterations"),!0}(e,t,n,l,h)))};t.curvesAreCoincident=l,t.edgesAreCoincident=function(e,t){if(e===t)return!0;var n=Math.max(r.KERNEL_TOLERANCE,e.getPrecision(),t.getPrecision()),o=e.getCurve(),s=t.getCurve();if(!o||!s){if(o||s)return!1;var a=e.getStartVertex(),c=t.getStartVertex();n=Math.max(n,a.getPrecision(),c.getPrecision());var u=a.getPosition(),h=c.getPosition();return i.Vector3.squaredDistance(u,h)<n*n}var d=e.getRange();e.isReversed()&&(d=[-d[1],-d[0]]);var p=t.getRange();return t.isReversed()&&(p=[-p[1],-p[0]]),l(o,s,d,p,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extrudeFace=void 0;var i=n(1),r=n(0),o=n(2),s=n(18),a=n(38),c=n(39),u=n(53),l=n(13),h=n(15),d=n(26),p=n(25),g=n(24),f=n(55),v=n(19),y=n(28);function m(e,t,n){var o=i.Vector3.length(n),s=i.Vector3.dot(e.getAxisDir(),n)>0?[0,o]:[-o,0];e.limitRangeU(s),t[1]-t[0]<2*Math.PI-r.PARAMETER_SPACE_TOLERANCE&&e.limitRangeV(t)}var _=function(e,t){var n=e.getEdge().getCurve(),o=e.getRange(),l=!0;e.isReversed()!==e.getEdge().isReversed()&&(o=[-o[1],-o[0]],l=!1);var h,d=l?e.t0():e.t1(),p=e.evaluateDt(d);if(i.Vector3.cross(p,p,t),i.Vector3.normalize(p,p),i.Vector3.negate(p,p),n.getGeometryType()===r.GEOMETRY_TYPES.LINE)h=function(e,t,n){var r=new s.Plane,o=e.evaluateDt(0),a=i.Vector3.createFloat64();i.Vector3.normalize(a,n);var c=i.Vector3.createFloat64();i.Vector3.cross(c,a,o),r.set(e.evaluatePosition(0),c,a);var u=i.Vector3.length(n),l=i.Vector3.dot(a,n)>0?[0,u]:[-u,0];return r.limitRangeV(t),r.limitRangeU(l),r}(n,o,t);else if(n.getGeometryType()===r.GEOMETRY_TYPES.CIRCLE)h=function(e,t,n){var r=e.evaluatePosition(0);i.Vector3.subtract(r,r,e.getCenter());var o=i.Vector3.createFloat64();i.Vector3.negate(o,e.getNormal());var s=new a.Cylinder;return s.set(e.getCenter(),e.getRadius(),o,r,1),m(s,t,n),s}(n,o,t);else if(n.getGeometryType()===r.GEOMETRY_TYPES.ELLIPSE)h=function(e,t,n){var r=e.evaluatePosition(0);i.Vector3.subtract(r,r,e.getCenter());var o=i.Vector3.createFloat64();i.Vector3.negate(o,e.getNormal());var s=new c.EllipticalCylinder;return s.set(e.getCenter(),r,e.getMinorRadius()/e.getMajorRadius(),o,1),m(s,t,n),s}(n,o,t);else{if(n.getGeometryType()!==r.GEOMETRY_TYPES.BCURVE)throw new Error("createSideFaceRuledSurface: Curve type not supported.");h=function(e,t,n){for(var i=new u.BSurface,r=e.getDegree(),o=e.getKnotVector().slice(0),s=e.getControlPoints().slice(0),a=(s=s.concat(s)).length/2;a<s.length;a+=3)s[a]+=n[0],s[a+1]+=n[1],s[a+2]+=n[2];var c=void 0;return e.isRational()&&(c=(c=e.getWeights().slice(0)).concat(c)),i.set(1,r,[0,0,1,1],o,s,c),i.limitRangeU([0,1]),i.limitRangeV(t),i}(n,o,t)}var g=h.evaluateNormal(0,o[0]);return{surface:h,isReversed:i.Vector3.dot(g,p)<0}};t.extrudeFace=function(e,t){o.ConsoleUtils.assert(e.getSurfaceType()===r.GEOMETRY_TYPES.PLANE);var n=e.evaluateNormal(0,0);i.Vector3.scale(n,n,t);var s=(new f.TopologyCloner).cloneFace(e),a=i.Matrix44.fromTranslation(i.Matrix44.createFloat64(),n);(0,v.transformTopology)(s,a),t>0?(0,v.reverseFace)(e):(0,v.reverseFace)(s);var c=function(e,t,n){for(var i=[],r=e.getLoops(),o=t.getLoops(),s=0;s<r.length;++s)for(var a=r[s].getCoedges(),c=o[s].getCoedges(),u=new Array(a.length),d=0;d<a.length;++d){var p=new Array(4),g=a[d],f=c[a.length-1-d],v=g.getStartVertex(),m=g.getEndVertex(),E=f.getStartVertex(),A=f.getEndVertex();p[0]=(0,y.createCoedgeOnEdge)(g.getEdge()),0===d&&(u[d]=(0,y.createLineEdgeBetweenVertices)(v,A)),p[1]=(0,y.createCoedgeOnEdge)(u[d]),p[2]=(0,y.createCoedgeOnEdge)(f.getEdge()),d!==a.length-1&&(u[d+1]=(0,y.createLineEdgeBetweenVertices)(E,m)),p[3]=(0,y.createCoedgeOnEdge)(u[(d+1)%a.length]);var x=new l.Loop;x.addCoedges(p);var C=_(g,n),w=new h.Face(C.surface);w.setReversed(C.isReversed),w.addLoop(x),i.push(w)}return i}(e,s,n),u=e.getShell();u||(u=new d.Shell).addFace(e),o.ConsoleUtils.assert(1===u.getFaces().length),u.addFaces(c),u.addFace(s);var m=u.getLump();m||(m=new p.Lump).addShell(u);var E=m.getBody();return E||(E=new g.Body).addLump(m),E}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundedRegionFaces=t.getRegionEdges=t.mergeSketchRegions=void 0;var i=n(0),r=n(19),o=n(80),s=function(e,t){var n=e.getProgenitorMap(),r=new Set;return t.forEach((function(e){n.getDescendants(e).forEach((function(e){e.getTopologyType()===i.TOPOLOGY_TYPES.EDGE&&r.add(e)}))})),Array.from(r)},a=function(e,t){var n=[];return(0,r.findConnectedFaces)(e,{allowVertexConnections:!1,barrierEdges:t}).forEach((function(e){(function(e,t){e=new Set(e),t=new Set(t);var n=new Set;e.forEach((function(e){e.collectEdges(n)})),n=Array.from(n);for(var i=0;i<n.length;i++){var r=n[i];if(!t.has(r)){var o=r.getCoedges();if(o.length<2)return!1;for(var s=0;s<o.length;s++)if(!e.has(o[s].getFace()))return!1}}return!0})(e,t)&&(n=n.concat(e))})),n},c=function(e,t){for(var n=0;n<e.length;n++)if(t.indexOf(e[n])<0)return!1;return!0};t.mergeSketchRegions=function(e){var t,n,i=[];e.forEach((function(e){i=i.concat(e.getEdges())}));var u=new o.SketchRegionSolver;u.compute(i);var l=u.getFaces(),h=[],d=[];for(t=0;t<e.length;t++){var p=s(u,e[t].getEdges());if(0!==p.length){var g=a(l,p);0!==g.length&&(d.push(p),h.push(g))}}for(var f=[],v=new Set(l),y=!0;h.length>0;){var m=[];for(t=0;t<h.length;t++){var _=!1;for(n=0;n<h.length;n++)if(t!==n&&c(h[t],h[n])){_=!0;break}m.push(_)}var E=new Set;for(t=h.length-1;t>=0;t--)m[t]?h[t].forEach((function(e){E.add(e),v.delete(e)})):(h.splice(t,1),d.splice(t,1));y&&(f=f.concat(Array.from(v))),v=E,y=!y}return(0,r.mergeConnectedFaces)(f)},t.getRegionEdges=s,t.getBoundedRegionFaces=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.propertyToRange=t.GeometrySetters=void 0;var i=n(1),r=function(e,t,n){var i=t[n];e[0]=i.x,e[1]=i.y,e[2]=i.z},o=function(e,t){var n=e[t],i=n.type;return"infinite"===i||0===i?[]:[n.low,n.high]},s=function(e,t){var n=o(e,"uRange");t.unlimitRangeU(),n.length>0&&t.limitRangeU(n);var i=o(e,"vRange");t.unlimitRangeV(),i.length>0&&t.limitRangeV(i)},a=function(e,t){var n=o(e,"range");t.unlimitRange(),n.length>0&&t.limitRange(n)},c={setBCurveFromProperty:function(e,t){var n,i,r=t.degree,o=t.knots,s=t.controlPoints,c=t.weights,u=s.length/3;if(0===c.length)for(i=new Array(u),n=0;n<u;++n)i[n]=1;else i=c;e.set(s,i,r,o),a(t,e)},setBSurfaceFromProperty:function(e,t){var n,i,r=t.uDegree,o=t.vDegree,a=t.uKnots,c=t.vKnots,u=t.controlPoints,l=t.weights;if(0===l.length){var h=u.length/3;for(i=new Array(h),n=0;n<h;++n)i[n]=1}else i=l;e.set(r,o,a,c,u,i),s(t,e)},setCircleFromProperty:function(e,t){var n=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),s=i.Vector3.createFloat64();r(n,t,"center"),r(o,t,"normal"),r(s,t,"radius"),e.set(n,o,s),a(t,e)},setConeFromProperty:function(e,t){var n=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();r(n,t,"center"),r(o,t,"axis"),r(a,t,"radius");var c=i.Vector3.length(a);i.Vector3.normalize(a,a);var u=t.angle,l=t.uCoordScale;e.set(n,c,o,u,a,l),s(t,e)},setCylinderFromProperty:function(e,t){var n=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();r(n,t,"center"),r(o,t,"axis"),r(a,t,"radius");var c=i.Vector3.length(a);i.Vector3.normalize(a,a);var u=t.uCoordScale;e.set(n,c,o,a,u),s(t,e)},setEllipseFromProperty:function(e,t){var n=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),s=i.Vector3.createFloat64();r(n,t,"center"),r(o,t,"normal"),r(s,t,"majorRadius");var c=t.radiusRatio;e.set(n,o,s,c),a(t,e)},setEllipticalConeFromProperty:function(e,t){var n=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();r(n,t,"center"),r(o,t,"axis"),r(a,t,"majorRadius");var c=t.angle,u=t.radiusRatio,l=t.uCoordScale;e.set(n,a,u,o,c,l),s(t,e)},setEllipticalCylinderFromProperty:function(e,t){var n=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();r(n,t,"center"),r(o,t,"axis"),r(a,t,"majorRadius");var c=t.radiusRatio,u=t.uCoordScale;e.set(n,a,c,o,u),s(t,e)},setLineFromProperty:function(e,t){var n=i.Vector3.createFloat64(),o=i.Vector3.createFloat64();r(n,t,"position"),r(o,t,"direction"),e.set(n,o),a(t,e)},setPlaneFromProperty:function(e,t){var n=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();r(n,t,"origin"),r(o,t,"normal"),r(a,t,"uAxis"),e.set(n,o,a),s(t,e)},setPointFromProperty:function(e,t){e.setPosition(t.position.x,t.position.y,t.position.z)},setSphereFromProperty:function(e,t){var n=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();r(n,t,"center"),r(o,t,"radius"),r(a,t,"axis");var c=i.Vector3.length(o);i.Vector3.normalize(o,o),e.set(n,c,a,o),s(t,e)},setTorusFromProperty:function(e,t){var n=i.Vector3.createFloat64(),o=i.Vector3.createFloat64(),a=i.Vector3.createFloat64();r(n,t,"center"),r(o,t,"axis"),r(a,t,"coordAxis");var c=t.majorRadius,u=t.minorRadius,l=t.lemon;e.set(n,c,u,o,a,l),s(t,e)},setHapCurveFromProperty:function(e,t){for(var n=t.spans,i=new Array(n.length),r=0;r<n.length;++r)i[r]={},i[r].polyOrder=n[r].polyOrder,i[r].lowParam=n[r].lowParam,i[r].highParam=n[r].highParam,i[r].coefs=n[r].coefs.slice(0);var o={};o.spans=i;var s=t.periodic;void 0===s&&(s=!1),o.periodic=s,o.closed=s,e.setHapDefinition(o),a(t,e)},setCurveRangeFromProperty:a,setSurfaceRangeFromProperty:s};t.GeometrySetters=c,t.propertyToRange=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getBoundedRegionFaces=t.getRegionEdges=t.mergeConnectedFaces=t.getOrderedFacesOnVertex=t.saveToProtoMessage=t.saveToProtoBinary=t.SolidDefSaver=t.SolidDefLoader=t.Path2D=t.DebugUtils=t.svgFromWire=t.transformTopology=t.TopologyStitcher=t.TopologyCloner=t.extrudeFace=t.createEdgeFromCurve=t.createFaceFromPolyline=t.createShellsFromFaces=t.createPolyhedron=t.createLineEdgeBetweenVertices=t.createLineEdge=t.createCylinder=t.createCone=t.createBlock=t.computeCurveCurveIntersections=t.SketchRegionSolver=t.facetPlanarFace=t.checkValidity=t.BoundingBox=t.Attribute=t.Wire=t.WireBody=t.Vertex=t.Edge=t.Coedge=t.Loop=t.Face=t.Shell=t.Lump=t.Body=t.BSurface=t.Torus=t.EllipticalCone=t.Cone=t.Sphere=t.EllipticalCylinder=t.Cylinder=t.Plane=t.BCurve=t.Ellipse=t.Circle=t.Line=t.Point=t.TOPOLOGY_TYPES=t.GEOMETRY_TYPES=t.KERNEL_TOLERANCE=void 0;var i=n(0),r=n(4),o=n(6),s=n(7),a=n(14),c=n(23),u=n(33),l=n(18),h=n(38),d=n(39),p=n(74),g=n(51),f=n(52),v=n(75),y=n(53),m=n(24),_=n(25),E=n(26),A=n(15),x=n(13),C=n(27),w=n(20),b=n(16),M=n(54),T=n(40),V=n(79),S=n(106),R=n(107),L=n(80),P=n(81),O=n(115),D=n(116),I=n(117),N=n(28),k=n(83),B=n(55),F=n(118),j=n(19),z=n(121),U=n(8),G=n(122),Y=n(123),W=n(126),H=n(84),K=n(78);t.KERNEL_TOLERANCE=i.KERNEL_TOLERANCE,t.GEOMETRY_TYPES=i.GEOMETRY_TYPES,t.TOPOLOGY_TYPES=i.TOPOLOGY_TYPES,t.Point=o.Point,t.Line=s.Line,t.Circle=a.Circle,t.Ellipse=c.Ellipse,t.BCurve=u.BCurve,t.Plane=l.Plane,t.Cylinder=h.Cylinder,t.EllipticalCylinder=d.EllipticalCylinder,t.Sphere=p.Sphere,t.Cone=g.Cone,t.EllipticalCone=f.EllipticalCone,t.Torus=v.Torus,t.BSurface=y.BSurface,t.Body=m.Body,t.Lump=_.Lump,t.Shell=E.Shell,t.Face=A.Face,t.Loop=x.Loop,t.Coedge=C.Coedge,t.Edge=w.Edge,t.Vertex=b.Vertex,t.WireBody=M.WireBody,t.Wire=T.Wire,t.Attribute=V.Attribute,t.BoundingBox=r.BoundingBox,t.checkValidity=S.checkValidity,t.facetPlanarFace=R.facetPlanarFace,t.SketchRegionSolver=L.SketchRegionSolver,t.computeCurveCurveIntersections=P.computeCurveCurveIntersections,t.createBlock=O.createBlock,t.createCone=D.createCone,t.createCylinder=D.createCylinder,t.createLineEdge=N.createLineEdge,t.createLineEdgeBetweenVertices=N.createLineEdgeBetweenVertices,t.createPolyhedron=I.createPolyhedron,t.createShellsFromFaces=N.createShellsFromFaces,t.createFaceFromPolyline=N.createFaceFromPolyline,t.createEdgeFromCurve=N.createEdgeFromCurve,t.extrudeFace=k.extrudeFace,t.TopologyCloner=B.TopologyCloner,t.TopologyStitcher=F.TopologyStitcher,t.transformTopology=j.transformTopology,t.svgFromWire=z.svgFromWire,t.DebugUtils=U.DebugUtils,t.Path2D=G.Path2D,t.SolidDefLoader=Y.SolidDefLoader,t.SolidDefSaver=W.SolidDefSaver,t.saveToProtoBinary=W.saveToProtoBinary,t.saveToProtoMessage=W.saveToProtoMessage,t.getOrderedFacesOnVertex=K.getOrderedFacesOnVertex,t.mergeConnectedFaces=j.mergeConnectedFaces,t.getRegionEdges=H.getRegionEdges,t.getBoundedRegionFaces=H.getBoundedRegionFaces},function(e,t,n){"use strict";e.exports=n(88)},function(e,t,n){"use strict";var i=e.exports=n(89);i.build="light",i.load=function(e,t,n){return"function"==typeof t?(n=t,t=new i.Root):t||(t=new i.Root),t.load(e,n)},i.loadSync=function(e,t){return t||(t=new i.Root),t.loadSync(e)},i.encoder=n(62),i.decoder=n(67),i.verifier=n(68),i.converter=n(69),i.ReflectionObject=n(21),i.Namespace=n(30),i.Root=n(71),i.Enum=n(11),i.Type=n(63),i.Field=n(22),i.OneOf=n(48),i.MapField=n(64),i.Service=n(65),i.Method=n(66),i.Message=n(49),i.wrappers=n(70),i.types=n(31),i.util=n(5),i.ReflectionObject._configure(i.Root),i.Namespace._configure(i.Type,i.Service,i.Enum),i.Root._configure(i.Type),i.Field._configure(i.Type)},function(e,t,n){"use strict";var i=t;function r(){i.Reader._configure(i.BufferReader),i.util._configure()}i.build="minimal",i.Writer=n(46),i.BufferWriter=n(96),i.Reader=n(47),i.BufferReader=n(97),i.util=n(10),i.rpc=n(60),i.roots=n(61),i.configure=r,i.Writer._configure(i.BufferWriter),r()},function(e,t,n){"use strict";var i=t;i.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var r=new Array(64),o=new Array(123),s=0;s<64;)o[r[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;i.encode=function(e,t,n){for(var i,o=null,s=[],a=0,c=0;t<n;){var u=e[t++];switch(c){case 0:s[a++]=r[u>>2],i=(3&u)<<4,c=1;break;case 1:s[a++]=r[i|u>>4],i=(15&u)<<2,c=2;break;case 2:s[a++]=r[i|u>>6],s[a++]=r[63&u],c=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return c&&(s[a++]=r[i],s[a++]=61,1===c&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))},i.decode=function(e,t,n){for(var i,r=n,s=0,a=0;a<e.length;){var c=e.charCodeAt(a++);if(61===c&&s>1)break;if(void 0===(c=o[c]))throw Error("invalid encoding");switch(s){case 0:i=c,s=1;break;case 1:t[n++]=i<<2|(48&c)>>4,i=c,s=2;break;case 2:t[n++]=(15&i)<<4|(60&c)>>2,i=c,s=3;break;case 3:t[n++]=(3&i)<<6|c,s=0}}if(1===s)throw Error("invalid encoding");return n-r},i.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,n){"use strict";function i(){this._listeners={}}e.exports=i,i.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},i.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this},i.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this}},function(e,t,n){"use strict";function i(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),i=128===n[3];function r(e,i,r){t[0]=e,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3]}function o(e,i,r){t[0]=e,i[r]=n[3],i[r+1]=n[2],i[r+2]=n[1],i[r+3]=n[0]}function s(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],t[0]}function a(e,i){return n[3]=e[i],n[2]=e[i+1],n[1]=e[i+2],n[0]=e[i+3],t[0]}e.writeFloatLE=i?r:o,e.writeFloatBE=i?o:r,e.readFloatLE=i?s:a,e.readFloatBE=i?a:s}():function(){function t(e,t,n,i){var r=t<0?1:0;if(r&&(t=-t),0===t)e(1/t>0?0:2147483648,n,i);else if(isNaN(t))e(2143289344,n,i);else if(t>34028234663852886e22)e((r<<31|2139095040)>>>0,n,i);else if(t<11754943508222875e-54)e((r<<31|Math.round(t/1401298464324817e-60))>>>0,n,i);else{var o=Math.floor(Math.log(t)/Math.LN2);e((r<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,i)}}function n(e,t,n){var i=e(t,n),r=2*(i>>31)+1,o=i>>>23&255,s=8388607&i;return 255===o?s?NaN:r*(1/0):0===o?1401298464324817e-60*r*s:r*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=t.bind(null,r),e.writeFloatBE=t.bind(null,o),e.readFloatLE=n.bind(null,s),e.readFloatBE=n.bind(null,a)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),i=128===n[7];function r(e,i,r){t[0]=e,i[r]=n[0],i[r+1]=n[1],i[r+2]=n[2],i[r+3]=n[3],i[r+4]=n[4],i[r+5]=n[5],i[r+6]=n[6],i[r+7]=n[7]}function o(e,i,r){t[0]=e,i[r]=n[7],i[r+1]=n[6],i[r+2]=n[5],i[r+3]=n[4],i[r+4]=n[3],i[r+5]=n[2],i[r+6]=n[1],i[r+7]=n[0]}function s(e,i){return n[0]=e[i],n[1]=e[i+1],n[2]=e[i+2],n[3]=e[i+3],n[4]=e[i+4],n[5]=e[i+5],n[6]=e[i+6],n[7]=e[i+7],t[0]}function a(e,i){return n[7]=e[i],n[6]=e[i+1],n[5]=e[i+2],n[4]=e[i+3],n[3]=e[i+4],n[2]=e[i+5],n[1]=e[i+6],n[0]=e[i+7],t[0]}e.writeDoubleLE=i?r:o,e.writeDoubleBE=i?o:r,e.readDoubleLE=i?s:a,e.readDoubleBE=i?a:s}():function(){function t(e,t,n,i,r,o){var s=i<0?1:0;if(s&&(i=-i),0===i)e(0,r,o+t),e(1/i>0?0:2147483648,r,o+n);else if(isNaN(i))e(0,r,o+t),e(2146959360,r,o+n);else if(i>17976931348623157e292)e(0,r,o+t),e((s<<31|2146435072)>>>0,r,o+n);else{var a;if(i<22250738585072014e-324)e((a=i/5e-324)>>>0,r,o+t),e((s<<31|a/4294967296)>>>0,r,o+n);else{var c=Math.floor(Math.log(i)/Math.LN2);1024===c&&(c=1023),e(4503599627370496*(a=i*Math.pow(2,-c))>>>0,r,o+t),e((s<<31|c+1023<<20|1048576*a&1048575)>>>0,r,o+n)}}}function n(e,t,n,i,r){var o=e(i,r+t),s=e(i,r+n),a=2*(s>>31)+1,c=s>>>20&2047,u=4294967296*(1048575&s)+o;return 2047===c?u?NaN:a*(1/0):0===c?5e-324*a*u:a*Math.pow(2,c-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,r,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=n.bind(null,s,0,4),e.readDoubleBE=n.bind(null,a,4,0)}(),e}function r(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function o(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=i(i)},function(e,t,n){"use strict";var i=t;i.length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)(n=e.charCodeAt(i))<128?t+=1:n<2048?t+=2:55296==(64512&n)&&56320==(64512&e.charCodeAt(i+1))?(++i,t+=4):t+=3;return t},i.read=function(e,t,n){if(n-t<1)return"";for(var i,r=null,o=[],s=0;t<n;)(i=e[t++])<128?o[s++]=i:i>191&&i<224?o[s++]=(31&i)<<6|63&e[t++]:i>239&&i<365?(i=((7&i)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(i>>10),o[s++]=56320+(1023&i)):o[s++]=(15&i)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,o)),s=0);return r?(s&&r.push(String.fromCharCode.apply(String,o.slice(0,s))),r.join("")):String.fromCharCode.apply(String,o.slice(0,s))},i.write=function(e,t,n){for(var i,r,o=n,s=0;s<e.length;++s)(i=e.charCodeAt(s))<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&56320==(64512&(r=e.charCodeAt(s+1)))?(i=65536+((1023&i)<<10)+(1023&r),++s,t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128);return n-o}},function(e,t,n){"use strict";e.exports=function(e,t,n){var i=n||8192,r=i>>>1,o=null,s=i;return function(n){if(n<1||n>r)return e(n);s+n>i&&(o=e(i),s=0);var a=t.call(o,s,s+=n);return 7&s&&(s=1+(7|s)),a}}},function(e,t,n){"use strict";e.exports=r;var i=n(10);function r(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=r.zero=new r(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var s=r.zeroHash="\0\0\0\0\0\0\0\0";r.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new r(n,i)},r.from=function(e){if("number"==typeof e)return r.fromNumber(e);if(i.isString(e)){if(!i.Long)return r.fromNumber(parseInt(e,10));e=i.Long.fromString(e)}return e.low||e.high?new r(e.low>>>0,e.high>>>0):o},r.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},r.prototype.toLong=function(e){return i.Long?new i.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;r.fromHash=function(e){return e===s?o:new r((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},r.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},r.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},r.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},r.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},function(e,t,n){"use strict";e.exports=s;var i=n(46);(s.prototype=Object.create(i.prototype)).constructor=s;var r=n(10),o=r.Buffer;function s(){i.call(this)}s.alloc=function(e){return(s.alloc=r._Buffer_allocUnsafe)(e)};var a=o&&o.prototype instanceof Uint8Array&&"set"===o.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]};function c(e,t,n){e.length<40?r.utf8.write(e,t,n):t.utf8Write(e,n)}s.prototype.bytes=function(e){r.isString(e)&&(e=r._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(a,t,e),this},s.prototype.string=function(e){var t=o.byteLength(e);return this.uint32(t),t&&this._push(c,t,e),this}},function(e,t,n){"use strict";e.exports=o;var i=n(47);(o.prototype=Object.create(i.prototype)).constructor=o;var r=n(10);function o(e){i.call(this,e)}r.Buffer&&(o.prototype._slice=r.Buffer.prototype.slice),o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))}},function(e,t,n){"use strict";e.exports=r;var i=n(10);function r(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");i.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(r.prototype=Object.create(i.EventEmitter.prototype)).constructor=r,r.prototype.rpcCall=function e(t,n,r,o,s){if(!o)throw TypeError("request must be specified");var a=this;if(!s)return i.asPromise(e,a,t,n,r,o);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,n){if(e)return a.emit("error",e,t),s(e);if(null!==n){if(!(n instanceof r))try{n=r[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),s(e)}return a.emit("data",n,t),s(null,n)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},r.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,n){"use strict";function i(e,t){"string"==typeof e&&(t=e,e=void 0);var n=[];function r(e){if("string"!=typeof e){var t=o();if(i.verbose&&console.log("codegen: "+t),t="return "+t,e){for(var s=Object.keys(e),a=new Array(s.length+1),c=new Array(s.length),u=0;u<s.length;)a[u]=s[u],c[u]=e[s[u++]];return a[u]=t,Function.apply(null,a).apply(null,c)}return Function(t)()}for(var l=new Array(arguments.length-1),h=0;h<l.length;)l[h]=arguments[++h];if(h=0,e=e.replace(/%([%dfijs])/g,(function(e,t){var n=l[h++];switch(t){case"d":case"f":return String(Number(n));case"i":return String(Math.floor(n));case"j":return JSON.stringify(n);case"s":return String(n)}return"%"})),h!==l.length)throw Error("parameter count mismatch");return n.push(e),r}function o(i){return"function "+(i||t||"")+"("+(e&&e.join(",")||"")+"){\n  "+n.join("\n  ")+"\n}"}return r.toString=o,r}e.exports=i,i.verbose=!1},function(e,t,n){"use strict";e.exports=o;var i=n(58),r=n(59)("fs");function o(e,t,n){return"function"==typeof t?(n=t,t={}):t||(t={}),n?!t.xhr&&r&&r.readFile?r.readFile(e,(function(i,r){return i&&"undefined"!=typeof XMLHttpRequest?o.xhr(e,t,n):i?n(i):n(null,t.binary?r:r.toString("utf8"))})):o.xhr(e,t,n):i(o,this,e,t)}o.xhr=function(e,t,n){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState){if(0!==i.status&&200!==i.status)return n(Error("status "+i.status));if(t.binary){var e=i.response;if(!e){e=[];for(var r=0;r<i.responseText.length;++r)e.push(255&i.responseText.charCodeAt(r))}return n(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return n(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}},function(e,t,n){"use strict";var i=t,r=i.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},o=i.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),n=r(e),i="";n&&(i=t.shift()+"/");for(var o=0;o<t.length;)".."===t[o]?o>0&&".."!==t[o-1]?t.splice(--o,2):n?t.splice(o,1):++o:"."===t[o]?t.splice(o,1):++o;return i+t.join("/")};i.resolve=function(e,t,n){return n||(t=o(t)),r(t)?t:(n||(e=o(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?o(e+"/"+t):t)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decomposeBCurveFlags=t.decomposeBCurveToBezier=t.decomposeBCurveControlPoints=void 0;var i=n(17),r=n(2),o=function(e,t,n){r.ConsoleUtils.assert(t.length%n==0);var i,o,s,a=e.length-t.length/n-1;r.ConsoleUtils.assert(a>0);var c=e.length-1,u=a,l=a+1,h=0,d=[],p=[];for(p[h]=new Array((a+1)*n),i=0;i<=a;++i)for(s=0;s<n;++s)p[h][i*n+s]=t[i*n+s];for(;l<c;){for(var g=1;l<c&&e[l+1]===e[l];)++l,++g;var f=l===c;if(f||(p[h+1]=new Array((a+1)*n)),g<a){var v=e[l]-e[u];for(o=a;o>g;--o)d[o-g-1]=v/(e[u+o]-e[u]);var y=a-g;for(o=1;o<=y;++o){for(var m=y-o,_=g+o,E=a;E>=_;--E){var A=d[E-_];for(s=0;s<n;++s)p[h][E*n+s]=p[h][E*n+s]*A+p[h][(E-1)*n+s]*(1-A)}if(!f)for(s=0;s<n;++s)p[h+1][m*n+s]=p[h][a*n+s]}}if(f)break;for(++h,i=a-g;i<=a;++i)for(s=0;s<n;++s)p[h][i*n+s]=t[(l-a+i)*n+s];u=l,++l}return p};t.decomposeBCurveControlPoints=o,t.decomposeBCurveToBezier=function(e,t,n){var s,a=n&&n.length>0;r.ConsoleUtils.assert(t.length>0&&t.length%3==0),r.ConsoleUtils.assert(!a||t.length===3*n.length);var c,u,l=e.length-t.length/3-1;if(r.ConsoleUtils.assert(l>0),a){var h=(0,i.controlPointsToHomogeneous)(t,n);for(c=o(e,h,4),u=[],s=0;s<c.length;++s){var d=(0,i.controlPointsFromHomogeneous)(c[s]);c[s]=d.P,u[s]=d.w}}else c=o(e,t,3),u=void 0;var p=(0,i.getUniqueKnots)(e);r.ConsoleUtils.assert(p.length===c.length+1);var g=new Array(p.length-1);for(s=0;s<g.length;++s)g[s]=new Array(2*l+2),g[s].fill(p[s],0,l+1),g[s].fill(p[s+1],l+1);return{U:g,P:c,w:u}},t.decomposeBCurveFlags=function(e,t){var n,i=e.length-t.length-1,r=new Array(t.length);r.fill(!1);var o=i-1;for(n=0;n<t.length;++n)if(t[n]){var s=Math.max(n-o,0),a=Math.min(n+o,r.length-1);r.fill(!0,s,a+1)}var c=[],u=e.length-1,l=i+1,h=0;for(c[h]=!1,n=0;n<=i;++n)r[n]&&(c[h]=!0);for(;l<u;){for(var d=1;l<u&&e[l+1]===e[l];)++l,++d;if(l===u)break;for(c[++h]=!1,n=i-d;n<=i;++n)r[l-i+n]&&(c[h]=!0);++l}return c}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractBSurfaceParamLineV=t.extractBSurfaceParamLineU=t.insertBSurfaceKnotV=t.insertBSurfaceKnotU=void 0;var i=n(1),r=n(17),o=n(0),s=function(e,t,n,r,o,s,a){var c,u,l=new Array(r);for(u=0;u<r;++u){l[u]=new Array(o-u-n);var h=t-o+u+1;for(c=0;c<o-u-n;++c)l[u][c]=(e-s[h+c])/(s[c+t+1]-s[h+c])}for(var d=a.length,p=new Array(d),g=new Array(o-n+1),f=0;f<d;++f){for(p[f]=new Array(o-n+r-1),c=0;c<=o-n;++c)g[c]=i.Vector4.clone(a[f][c]);for(u=0;u<r;++u){for(c=0;c<o-u-n;++c)i.Vector4.lerp(g[c],g[c],g[c+1],l[u][c]);p[f][u]=i.Vector4.clone(g[0]),p[f][o+r-n-u-2]=i.Vector4.clone(g[o-u-n-1])}for(c=r;c<o-n-1;c++)p[f][c]=i.Vector4.clone(g[c-r+1])}return p};t.insertBSurfaceKnotU=function(e,t,n,a,c,u,l,h){t=Math.min(t,n);var d=h&&h.length>0,p=(0,r.findKnotSpanAndMultiplicity)(e,c);e=p.knot;var g=p.span,f=p.multiplicity,v=t-f;if(e<c[0]+o.PARAMETER_SPACE_TOLERANCE||e>c[c.length-1]-o.PARAMETER_SPACE_TOLERANCE||f>=t)return{uknots:c.slice(),P:l.slice(),weights:d?h.slice():void 0};var y,m,_=c.length-n-1,E=u.length-a-1,A=new Array(E),x=g-n,C=g-f;for(m=0;m<E;++m)for(A[m]=new Array(C-x+1),y=x;y<=C;++y){var w=y*E+m,b=d?h[w]:1;A[m][y-x]=i.Vector4.createFloat64FromValues(b*l[3*w],b*l[3*w+1],b*l[3*w+2],b)}var M=s(e,g,f,v,n,c,A),T=c.slice(0,g+1);for(y=0;y<v;++y)T.push(e);T=T.concat(c.slice(g+1));var V,S=new Array(3*(_+v)*E),R=new Array((_+v)*E);for(m=0;m<E;++m){for(y=0;y<=x;++y)w=V=y*E+m,S[3*V]=l[3*w],S[3*V+1]=l[3*w+1],S[3*V+2]=l[3*w+2],R[V]=h[w];for(y=0;y<M[m].length;++y){V=(y+x+1)*E+m;var L=M[m][y];S[3*V]=L[0]/L[3],S[3*V+1]=L[1]/L[3],S[3*V+2]=L[2]/L[3],R[V]=L[3]}for(y=C;y<_;++y)w=y*E+m,S[3*(V=(y+v)*E+m)]=l[3*w],S[3*V+1]=l[3*w+1],S[3*V+2]=l[3*w+2],R[V]=h[w]}return{uknots:T,P:S,weights:d?R:void 0}},t.insertBSurfaceKnotV=function(e,t,n,a,c,u,l,h){t=Math.min(t,a);var d=h&&h.length>0,p=(0,r.findKnotSpanAndMultiplicity)(e,u);e=p.knot;var g=p.span,f=p.multiplicity,v=t-f;if(e<u[0]+o.PARAMETER_SPACE_TOLERANCE||e>u[u.length-1]-o.PARAMETER_SPACE_TOLERANCE||f>=t)return{vknots:u.slice(),P:l.slice(),weights:d?h.slice():void 0};var y,m,_=c.length-n-1,E=u.length-a-1,A=new Array(_),x=g-a,C=g-f;for(y=0;y<_;++y)for(A[y]=new Array(C-x+1),m=x;m<=C;++m){var w=y*E+m,b=d?h[w]:1;A[y][m-x]=i.Vector4.createFloat64FromValues(b*l[3*w],b*l[3*w+1],b*l[3*w+2],b)}var M=s(e,g,f,v,a,u,A),T=u.slice(0,g+1);for(m=0;m<v;++m)T.push(e);T=T.concat(u.slice(g+1));var V,S=new Array(3*_*(E+v)),R=new Array(_*(E+v));for(y=0;y<_;++y){for(m=0;m<=x;++m)w=y*E+m,S[3*(V=y*(E+v)+m)]=l[3*w],S[3*V+1]=l[3*w+1],S[3*V+2]=l[3*w+2],R[V]=h[w];for(m=0;m<M[y].length;++m){V=y*(E+v)+(m+x+1);var L=M[y][m];S[3*V]=L[0]/L[3],S[3*V+1]=L[1]/L[3],S[3*V+2]=L[2]/L[3],R[V]=L[3]}for(m=C;m<E;++m)w=y*E+m,S[3*(V=y*(E+v)+(m+v))]=l[3*w],S[3*V+1]=l[3*w+1],S[3*V+2]=l[3*w+2],R[V]=h[w]}return{vknots:T,P:S,weights:d?R:void 0}},t.extractBSurfaceParamLineU=function(e,t,n,o,a,c,u){var l=u&&u.length>0,h=(0,r.findKnotSpanAndMultiplicity)(e,a);e=h.knot;var d,p,g,f=h.span,v=e===a[a.length-1],y=v?n+1:h.multiplicity,m=n-y,_=o.length-t-1,E=a.length-n-1,A=new Array(3*_),x=new Array(_);if(y>=n)for(p=v?E-1:f-n,d=0;d<_;++d)g=d*E+p,A[3*d]=c[3*g],A[3*d+1]=c[3*g+1],A[3*d+2]=c[3*g+2],x[d]=l?u[g]:1;else{var C=new Array(_),w=f-n,b=f-y;for(d=0;d<_;++d)for(C[d]=new Array(b-w+1),p=w;p<=b;++p){g=d*E+p;var M=l?u[g]:1;C[d][p-w]=i.Vector4.createFloat64FromValues(M*c[3*g],M*c[3*g+1],M*c[3*g+2],M)}var T=s(e,f,y,m,n,a,C);for(p=m-1,d=0;d<_;++d){var V=T[d][p];A[3*d]=V[0]/V[3],A[3*d+1]=V[1]/V[3],A[3*d+2]=V[2]/V[3],x[d]=V[3]}}return{ctrlPts:A,weights:l?x:void 0}},t.extractBSurfaceParamLineV=function(e,t,n,o,a,c,u){var l=u&&u.length>0,h=(0,r.findKnotSpanAndMultiplicity)(e,o);e=h.knot;var d,p,g,f=h.span,v=e===o[o.length-1],y=v?t+1:h.multiplicity,m=t-y,_=o.length-t-1,E=a.length-n-1,A=new Array(3*E),x=new Array(E);if(y>=t)for(d=v?_-1:f-t,p=0;p<E;++p)g=d*E+p,A[3*p]=c[3*g],A[3*p+1]=c[3*g+1],A[3*p+2]=c[3*g+2],x[p]=l?u[g]:1;else{var C=new Array(E),w=f-t,b=f-y;for(p=0;p<E;++p)for(C[p]=new Array(b-w+1),d=w;d<=b;++d){g=d*E+p;var M=l?u[g]:1;C[p][d-w]=i.Vector4.createFloat64FromValues(M*c[3*g],M*c[3*g+1],M*c[3*g+2],M)}var T=s(e,f,y,m,t,o,C);for(d=m-1,p=0;p<E;++p){var V=T[p][d];A[3*p]=V[0]/V[3],A[3*p+1]=V[1]/V[3],A[3*p+2]=V[2]/V[3],x[p]=V[3]}}return{ctrlPts:A,weights:l?x:void 0}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decomposeBSurfaceToBezier=t.decomposeBSurfaceControlPoints=t.decomposeBSurfaceControlPointsV=t.decomposeBSurfaceControlPointsU=void 0;var i=n(17),r=n(2),o=function(e,t,n,i){r.ConsoleUtils.assert(n.length%i==0);var o=t.length-e-1;r.ConsoleUtils.assert(n.length/i%o==0);var s,a,c,u,l=n.length/(i*o),h=e+1,d=l,p=t.length-1,g=e,f=e+1,v=0,y=[],m=[];for(m[v]=new Array(h*d*i),s=0;s<=e;++s)for(c=0;c<l;++c)for(u=0;u<i;++u)m[v][(s*d+c)*i+u]=n[(s*l+c)*i+u];for(;f<p;){for(var _=1;f<p&&t[f+1]===t[f];)++f,++_;var E=f===p;if(E||(m[v+1]=new Array(h*d*i)),_<e){var A=t[f]-t[g];for(a=e;a>_;--a)y[a-_-1]=A/(t[g+a]-t[g]);var x=e-_;for(a=1;a<=x;++a){for(var C=x-a,w=_+a,b=e;b>=w;--b){var M=y[b-w];for(c=0;c<l;++c)for(u=0;u<i;++u)m[v][(b*d+c)*i+u]=m[v][(b*d+c)*i+u]*M+m[v][((b-1)*d+c)*i+u]*(1-M)}if(!E)for(c=0;c<l;++c)for(u=0;u<i;++u)m[v+1][(C*d+c)*i+u]=m[v][(e*d+c)*i+u]}}if(E)break;for(++v,s=e-_;s<=e;++s)for(c=0;c<l;++c)for(u=0;u<i;++u)m[v][(s*d+c)*i+u]=n[((f-e+s)*l+c)*i+u];g=f,++f}return m},s=function(e,t,n,i){r.ConsoleUtils.assert(n.length%i==0);var o=t.length-e-1;r.ConsoleUtils.assert(n.length/i%o==0);var s,a,c,u,l=n.length/(i*o),h=l,d=e+1,p=t.length-1,g=e,f=e+1,v=0,y=[],m=[];for(m[v]=new Array(h*d*i),s=0;s<=e;++s)for(c=0;c<l;++c)for(u=0;u<i;++u)m[v][(s+c*d)*i+u]=n[(s+c*o)*i+u];for(;f<p;){for(var _=1;f<p&&t[f+1]===t[f];)++f,++_;var E=f===p;if(E||(m[v+1]=new Array(h*d*i)),_<e){var A=t[f]-t[g];for(a=e;a>_;--a)y[a-_-1]=A/(t[g+a]-t[g]);var x=e-_;for(a=1;a<=x;++a){for(var C=x-a,w=_+a,b=e;b>=w;--b){var M=y[b-w];for(c=0;c<l;++c)for(u=0;u<i;++u)m[v][(b+c*d)*i+u]=m[v][(b+c*d)*i+u]*M+m[v][(b-1+c*d)*i+u]*(1-M)}if(!E)for(c=0;c<l;++c)for(u=0;u<i;++u)m[v+1][(C+c*d)*i+u]=m[v][(e+c*d)*i+u]}}if(E)break;for(++v,s=e-_;s<=e;++s)for(c=0;c<l;++c)for(u=0;u<i;++u)m[v][(s+c*d)*i+u]=n[(f-e+s+c*o)*i+u];g=f,++f}return m},a=function(e,t,n,i,a,c){r.ConsoleUtils.assert(a.length%c==0),r.ConsoleUtils.assert(a.length/c==(n.length-e-1)*(i.length-t-1));var u,l=n.length>2*e+2,h=i.length>2*t+2;if(!l&&!h)return[[a.slice()]];u=l?o(e,n,a,c):[a];for(var d=0;d<u.length;++d)u[d]=h?s(t,i,u[d],c):[u[d]];return u};t.decomposeBSurfaceControlPointsU=o,t.decomposeBSurfaceControlPointsV=s,t.decomposeBSurfaceControlPoints=a,t.decomposeBSurfaceToBezier=function(e,t,n,o,s,c){var u,l,h,d,p=c&&c.length>0;if(r.ConsoleUtils.assert(s.length>0&&s.length%3==0),r.ConsoleUtils.assert(!p||s.length===3*c.length),p){var g=(0,i.controlPointsToHomogeneous)(s,c);for(h=a(e,t,n,o,g,4),d=[],u=0;u<h.length;++u)for(d[u]=[],l=0;l<h[u].length;++l){var f=(0,i.controlPointsFromHomogeneous)(h[u][l]);h[u][l]=f.P,d[u][l]=f.w}}else h=a(e,t,n,o,s,3),d=void 0;var v=(0,i.getUniqueKnots)(n);r.ConsoleUtils.assert(v.length===h.length+1);var y=new Array(v.length-1);for(u=0;u<y.length;++u)y[u]=new Array(2*e+2),y[u].fill(v[u],0,e+1),y[u].fill(v[u+1],e+1);var m=(0,i.getUniqueKnots)(o);r.ConsoleUtils.assert(m.length===h[0].length+1);var _=new Array(m.length-1);for(u=0;u<_.length;++u)_[u]=new Array(2*t+2),_[u].fill(m[u],0,t+1),_[u].fill(m[u+1],t+1);return{U:y,V:_,P:h,w:d}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.closestBSurfacePointApprox=t.closestBSurfacePatches=void 0;var i=n(1),r=n(3),o=n(73),s=n(76);t.closestBSurfacePatches=function(e,t,n){for(var r=Number.POSITIVE_INFINITY,s=[],a=0;a<t.length;++a)for(var c=0;c<t[a].length;++c){var u,l=t[a][c],h=l.getRangeUnlimitedU(),d=l.getRangeUnlimitedV();if(n){u=!1;for(var p=0;p<n.length;++p)if(h[1]>=n[p][0][0]+i.FLOAT64_TOLERANCE&&h[0]<=n[p][0][1]-i.FLOAT64_TOLERANCE&&d[1]>=n[p][1][0]+i.FLOAT64_TOLERANCE&&d[0]<=n[p][1][1]-i.FLOAT64_TOLERANCE){u=!0;break}}else u=!0;if(u){var g=l.getControlPoints(),f=(0,o.minDistanceSqrToHull)(e,g,!0);if(f<=r){var v=(0,o.maxDistanceSqrToHull)(e,g);s.push({index:[a,c],minDistSqr:f,maxDistSqr:v}),v<r&&(r=v)}}}return(s=s.filter((function(e){return e.minDistSqr<=r}))).sort((function(e,t){var n=e.minDistSqr-t.minDistSqr;return 0===n?e.maxDistSqr-t.maxDistSqr:n})),s},t.closestBSurfacePointApprox=function(e,t,n,o,a,c,u,l,h){var d=t>1?2*t:1,p=n>1?2*n:1,g=(l[1]-l[0])/(o[o.length-1]-o[0]),f=(h[1]-h[0])/(a[a.length-1]-a[0]);d=Math.max(1,Math.round(d*g)),p=Math.max(1,Math.round(p*f));for(var v=(l[1]-l[0])/d,y=(h[1]-h[0])/p,m=Number.POSITIVE_INFINITY,_={u:void 0,v:void 0},E=void 0,A=i.Vector3.createFloat64(),x=0;x<=p;++x){for(var C=h[0]+x*y,w=[],b=0;b<=d;++b){var M,T,V=l[0]+b*v;w[b]=(0,s.evaluateBSurfacePoint)(V,C,t,n,o,a,c,u),b>0&&x>0&&(M=(0,r.closestPointToTriangle)(e,E[b-1],E[b],w[b-1],A),(T=i.Vector3.squaredDistance(e,A))<m&&(m=T,_.u=V+v*(M.coordA-1),_.v=C+y*(M.coordB-1)),M=(0,r.closestPointToTriangle)(e,w[b],w[b-1],E[b],A),(T=i.Vector3.squaredDistance(e,A))<m&&(m=T,_.u=V-v*M.coordA,_.v=C-y*M.coordB))}E=w}return _}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkValidity=void 0;var i=n(1),r=n(0),o=n(32),s=n(6),a=n(12),c=n(19);function u(e){var t=[],n=e.getGuid();return n&&"string"==typeof n||t.push({error:"BaseTopology has invalid GUID",source:[e]}),t}function l(e){var t=u(e),n=0,i=0,o=0,s=e.getLumps();if(s.length>0){for(var a=new Set,c=0;c<s.length;++c){var l=s[c];a.add(l),l&&l.getTopologyType()===r.TOPOLOGY_TYPES.LUMP?l.getBody()!==e&&t.push({error:"Body is not the parent of child Lump",source:[e,l]}):t.push({error:"Body has invalid element in Lump array",source:[e,l]}),n+=l.collectFaces().size,i+=l.collectEdges().size,o+=l.collectVertices().size}a.size!==s.length&&t.push({error:"Body has non-unique Lumps",source:[e]})}return n!==e.collectFaces().size&&t.push({error:"Body has Lumps which share Faces",source:[e]}),i!==e.collectEdges().size&&t.push({error:"Body has Lumps which share Edges",source:[e]}),o!==e.collectVertices().size&&t.push({error:"Body has Lumps which share Vertices",source:[e]}),t}function h(e){var t=u(e),n=e.getBody();n&&n.getTopologyType()!==r.TOPOLOGY_TYPES.BODY&&t.push({error:"Lump has invalid parent Body",source:[e]});var i=0,o=0,s=0,a=e.getShells();if(a.length>0){for(var c=new Set,l=0;l<a.length;++l){var h=a[l];c.add(h),h&&h.getTopologyType()===r.TOPOLOGY_TYPES.SHELL?h.getLump()!==e&&t.push({error:"Lump is not the parent of child Shell",source:[e,h]}):t.push({error:"Lump has invalid element in Shell array",source:[e,h]}),i+=h.collectFaces().size,o+=h.collectEdges().size,s+=h.collectVertices().size}c.size!==a.length&&t.push({error:"Lump has non-unique Shells",source:[e]})}else t.push({error:"Lump has no Shells",source:[e]});return i!==e.collectFaces().size&&t.push({error:"Lump has Shells which share Faces",source:[e]}),o!==e.collectEdges().size&&t.push({error:"Lump has Shells which share Edges",source:[e]}),s!==e.collectVertices().size&&t.push({error:"Lump has Shells which share Vertices",source:[e]}),t}function d(e){var t=u(e),n=e.getLump();n&&n.getTopologyType()!==r.TOPOLOGY_TYPES.LUMP&&t.push({error:"Shell has invalid parent Lump",source:[e]});var i=e.getFaces();if(i.length>0){for(var o=new Set,s=0;s<i.length;++s){var a=i[s];o.add(a),a&&a.getTopologyType()===r.TOPOLOGY_TYPES.FACE?a.getShell()!==e&&t.push({error:"Shell is not the parent of child Face",source:[e,a]}):t.push({error:"Shell has invalid element in Face array",source:[e,a]})}o.size!==i.length&&t.push({error:"Shell has non-unique Faces",source:[e]})}else t.push({error:"Shell has no Faces",source:[e]});1!==(0,c.findConnectedFaces)(e.getFaces()).length&&t.push({error:"Shell is disconnected",source:[e]});var l=e.collectVertices(),h=e.collectEdges(),d=new Set,p=new Set;return l.forEach((function(e){e.collectEdges(d),e.collectFaces(p)})),d.size!==h.size&&t.push({error:"Shell has rogue edges",source:[e]}),l.size>0&&p.size!==e.getFaces().length&&t.push({error:"Shell has rogue faces",source:[e]}),t}function p(e){var t=u(e),n=e.getShell();n&&n.getTopologyType()!==r.TOPOLOGY_TYPES.SHELL&&t.push({error:"Face has invalid parent Shell",source:[e]});var i=0,o=0,s=e.getLoops(),c=e.getSurface();if(s.length>0){for(var l=new Set,h=0;h<s.length;++h){var d=s[h];l.add(d),d&&d.getTopologyType()===r.TOPOLOGY_TYPES.LOOP?d.getFace()!==e&&t.push({error:"Face is not the parent of child Loop",source:[e,d]}):t.push({error:"Face has invalid element in Loop array",source:[e,d]}),i+=d.collectEdges().size,o+=d.collectVertices().size}l.size!==s.length&&t.push({error:"Face has non-unique Loops",source:[e]})}else{var p=c.getGeometryType()===r.GEOMETRY_TYPES.SPHERE,g=c.getGeometryType()===r.GEOMETRY_TYPES.TORUS&&c.isDoughnut();p||g||t.push({error:"Face has no Loops",source:[e]})}return i!==e.collectEdges().size&&t.push({error:"Face has Loops which share Edges",source:[e]}),o!==e.collectVertices().size&&t.push({error:"Face has Loops which share Vertices",source:[e]}),c?c instanceof a.Surface||t.push({error:"Face has invalid Surface geometry",source:[e,c]}):t.push({error:"Face has no Surface geometry",source:[e]}),t}function g(e){var t=u(e),n=e.getFace();n&&n.getTopologyType()!==r.TOPOLOGY_TYPES.FACE&&t.push({error:"Loop has invalid parent Face",source:[e]});var i=e.getCoedges();if(i.length>0){for(var o=new Set,s=0;s<i.length;++s){var a=i[s];if(o.add(a),a&&a.getTopologyType()===r.TOPOLOGY_TYPES.COEDGE){a.getLoop()!==e&&t.push({error:"Loop is not the parent of child Coedge",source:[e,a]});var c=i[(s+1)%i.length];a.getEndVertex()!==c.getStartVertex()&&t.push({error:"Loop has disconnected Coedges",source:[e,a,c]})}else t.push({error:"Loop has invalid element in Coedge array",source:[e,a]})}o.size!==i.length&&t.push({error:"Loop has non-unique Coedges",source:[e]})}else t.push({error:"Loop has no Coedges",source:[e]});return t}function f(e){var t=u(e),n=e.getLoop();n&&n.getTopologyType()!==r.TOPOLOGY_TYPES.LOOP&&t.push({error:"Coedge has invalid parent Loop",source:[e]});var i=e.getBody(),o=new Set,s=e;do{if(o.has(s)){t.push({error:"Coedge partner list does not form a loop",source:[e]});break}if(o.add(s),!s.getPartner()){s!==e&&t.push({error:"Coedge has no partner",source:[e,s]});break}if((s=s.getPartner()).getTopologyType()!==r.TOPOLOGY_TYPES.COEDGE){t.push({error:"Coedge has invalid entry in partner list",source:[e,s]});break}s.getEdge()!==e.getEdge()&&t.push({error:"Coedge partner refers to a different Edge",source:[e,s]}),s.getBody()!==i&&t.push({error:"Coedge partner is part of a different Body",source:[e,s]})}while(s!==e);var a=e.getEdge();return a?a.getTopologyType()!==r.TOPOLOGY_TYPES.EDGE?t.push({error:"Coedge has invalid Edge",source:[e,a]}):(s=a.getCoedge())&&o.has(s)||t.push({error:"Coedge partner list does not include parent of Edge",source:[e,a]}):t.push({error:"Coedge has no Edge",source:[e]}),t}function v(e){var t=u(e),n=e.getCoedge(),s=e.getWire();s&&n?t.push({error:"Edge has too many parents, both Wire and Coedge",source:[e]}):s?s.getTopologyType()!==r.TOPOLOGY_TYPES.WIRE&&t.push({error:"Edge has invalid parent Wire",source:[e]}):n&&n.getTopologyType()!==r.TOPOLOGY_TYPES.COEDGE&&t.push({error:"Edge has invalid parent Coedge",source:[e]});for(var a=e.getVertices(),c=0;c<a.length;++c){var l=a[c];l&&l.getTopologyType()===r.TOPOLOGY_TYPES.VERTEX?l.isAdjacentEdge(e)||t.push({error:"Edge is not adjacent to own Vertex",source:[e,l]}):t.push({error:"Edge has invalid Vertex",source:[e,l]})}var h=e.getCurve();return h?h instanceof o.Curve?t=t.concat(function(e,t){var n=[],o=e.isReversed(),s=e.getRange();if(void 0===s||2!==s.length||void 0===s[0]||void 0===s[1]||s[1]<s[0])return n.push({error:"Edge range is not defined",source:[e,s]}),n;var a=e.getStartVertex(),c=o?-e.t0():e.t0(),u=t.evaluatePosition(c),l=Math.max(r.KERNEL_TOLERANCE,a.getPrecision());i.Vector3.equals(a.getPosition(),u,l)||n.push({error:"Edge start position not consistent with Vertex",source:[e,a,u]});var h=e.getEndVertex(),d=o?-e.t1():e.t1(),p=t.evaluatePosition(d),g=Math.max(r.KERNEL_TOLERANCE,h.getPrecision());return i.Vector3.equals(h.getPosition(),p,g)||n.push({error:"Edge end position not consistent with Vertex",source:[e,h,p]}),e.isClosed()?(a!==h&&n.push({error:"Edge is closed but has different start and end Vertices",source:[e]}),i.Vector3.equals(u,p,r.KERNEL_TOLERANCE)||n.push({error:"Edge is closed but has different start and end positions",source:[e,u,p]}),t.isClosed()||n.push({error:"Edge is closed but its curve is not",source:[e]})):(a===h&&n.push({error:"Edge is open but has same start and end Vertices",source:[e]}),i.Vector3.equals(u,p,r.KERNEL_TOLERANCE)&&n.push({error:"Edge is open but has same start and end positions",source:[e,u,p]})),t.isPeriodic()?Math.abs(d-c)>t.getPeriod()+r.PARAMETER_SPACE_TOLERANCE&&n.push({error:"Edge parameter range is longer than curve period",source:[e]}):((c+r.PARAMETER_SPACE_TOLERANCE<t.getRange()[0]||c-r.PARAMETER_SPACE_TOLERANCE>t.getRange()[1])&&n.push({error:"Edge start parameter is outside of curve range",source:[e]}),(d+r.PARAMETER_SPACE_TOLERANCE<t.getRange()[0]||d-r.PARAMETER_SPACE_TOLERANCE>t.getRange()[1])&&n.push({error:"Edge end parameter is outside of curve range",source:[e]})),n}(e,h)):t.push({error:"Edge has invalid Curve geometry",source:[e,h]}):t=t.concat(function(e){if(e.getWire())return[{error:"Degenerate Edge is part of a Wire",source:[e]}];if(e.getStartVertex()!==e.getEndVertex())return[{error:"Degenerate Edge has different start and end vertices",source:[e]}];var t=Array.from(e.collectFaces());if(0===t.length)return[];if(1!==t.length)return[{error:"Degenerate Edge is part of multiple Faces",source:[e]}];var n=e.getStartVertex().getPosition(),o=t[0].getSurface(),s=o.getGeometryType();if(s===r.GEOMETRY_TYPES.PLANE||s===r.GEOMETRY_TYPES.CYLINDER||s===r.GEOMETRY_TYPES.ELLIPTICAL_CYLINDER||s===r.GEOMETRY_TYPES.SPHERE)return[{error:"Degenerate Edge is on a surface with no singularities",source:[e,o]}];if(s===r.GEOMETRY_TYPES.CONE||s===r.GEOMETRY_TYPES.ELLIPTICAL_CONE){if(!(l=o.getApexPosition()))return[{error:"Degenerate Edge is on a surface with no singularities",source:[e,o]}];if(!i.Vector3.equals(n,l,r.KERNEL_TOLERANCE))return[{error:"Degenerate Edge is not at a surface singularity",source:[e,o]}]}else{if(s!==r.GEOMETRY_TYPES.TORUS)return[{error:"Degenerate Edge is not on an analytic surface",source:[e]}];for(var a=!1,c=o.getSingularUParams(),u=0;u<c.length;++u){var l=o.evaluatePosition(c[u],0);i.Vector3.equals(n,l,r.KERNEL_TOLERANCE)&&(a=!0)}if(!a)return[{error:"Degenerate Edge is not at a surface singularity",source:[e,o]}]}return[]}(e)),t}function y(e){var t=u(e),n=e.getEdges();if(n.length>0)for(var i=e.getBody(),o=0;o<n.length;++o){var a=n[o];a&&a.getTopologyType()===r.TOPOLOGY_TYPES.EDGE?a.getStartVertex()!==e&&a.getEndVertex()!==e?t.push({error:"Vertex is not an end-point of adjacent Edge",source:[e,a]}):a.getBody()!==i&&t.push({error:"Vertex has adjacent Edge from a different body",source:[e,a]}):t.push({error:"Vertex has invalid entry in Edge list",source:[e,a]})}else t.push({error:"Vertex has no adjacent Edges",source:[e]});var c=e.getPoint();return c?c instanceof s.Point||t.push({error:"Vertex has invalid Point geometry",source:[e,c]}):t.push({error:"Vertex has no Point geometry",source:[e]}),t}function m(e){var t=u(e),n=0,i=0,o=e.getWires();if(o.length>0){for(var s=new Set,a=0;a<o.length;++a){var c=o[a];s.add(c),c&&c.getTopologyType()===r.TOPOLOGY_TYPES.WIRE?c.getWireBody()!==e&&t.push({error:"WireBody is not the parent of child Wire",source:[e,c]}):t.push({error:"WireBody has invalid element in Wire array",source:[e,c]}),n+=c.collectEdges().size,i+=c.collectVertices().size}s.size!==o.length&&t.push({error:"WireBody has non-unique Wires",source:[e]})}else t.push({error:"WireBody has no Wires",source:[e]});return n!==e.collectEdges().size&&t.push({error:"WireBody has Wires which share Edges",source:[e]}),i!==e.collectVertices().size&&t.push({error:"WireBody has Wires which share Vertices",source:[e]}),t}function _(e){var t=u(e),n=e.getWireBody();n&&n.getTopologyType()!==r.TOPOLOGY_TYPES.WIREBODY&&t.push({error:"Wire has invalid parent WireBody",source:[e]});var i=e.getEdges();if(i.length>0){for(var o=new Set,s=0;s<i.length;++s){var a=i[s];o.add(a),a&&a.getTopologyType()===r.TOPOLOGY_TYPES.EDGE?a.getWire()!==e&&t.push({error:"Wire is not the parent of child Edge",source:[e,a]}):t.push({error:"Wire has invalid element in Edge array",source:[e,a]})}o.size!==i.length&&t.push({error:"Wire has non-unique Edges",source:[e]});var l=(0,c.findConnectedEdges)(i);1!==l.length?t.push({error:"Wire is not a connected set of Edges",source:[e]}):l[0].length!==i.length&&t.push({error:"Wire is connected to other unknown Edges",source:[e]})}else t.push({error:"Wire has no Edges",source:[e]});return t}t.checkValidity=function(e){for(var t,n,i,o=[],s=[e],a=new Set,c=new Map;s.length>0;){a.clear();var u=new Set;for(t=0;t<s.length;++t){switch((n=s[t]).getTopologyType()){case r.TOPOLOGY_TYPES.BODY:o=o.concat(l(n)),n.getLumps().forEach((function(e){a.add(e)}));break;case r.TOPOLOGY_TYPES.LUMP:o=o.concat(h(n)),n.getShells().forEach((function(e){a.add(e)}));break;case r.TOPOLOGY_TYPES.SHELL:o=o.concat(d(n)),n.getFaces().forEach((function(e){a.add(e)}));break;case r.TOPOLOGY_TYPES.FACE:o=o.concat(p(n)),n.getLoops().forEach((function(e){a.add(e)})),n.getSurface()&&u.add(n.getSurface());break;case r.TOPOLOGY_TYPES.LOOP:o=o.concat(g(n)),n.getCoedges().forEach((function(e){a.add(e)}));break;case r.TOPOLOGY_TYPES.COEDGE:o=o.concat(f(n)),a.add(n.getEdge());break;case r.TOPOLOGY_TYPES.EDGE:o=o.concat(v(n)),n.getVertices().forEach((function(e){e&&a.add(e)})),n.getCurve()&&u.add(n.getCurve());break;case r.TOPOLOGY_TYPES.VERTEX:o=o.concat(y(n)),n.getPoint()&&u.add(n.getPoint());break;case r.TOPOLOGY_TYPES.WIREBODY:o=o.concat(m(n)),n.getWires().forEach((function(e){a.add(e)}));break;case r.TOPOLOGY_TYPES.WIRE:o=o.concat(_(n)),n.getEdges().forEach((function(e){a.add(e)}))}i=n.getGuid(),c.has(i)?o.push({error:"Objects have clashing GUIDs",source:[n,c.get(i)]}):c.set(i,n)}for(u=Array.from(u),t=0;t<u.length;++t)i=(n=u[t]).getGuid(),c.has(i)?o.push({error:"Objects have clashing GUIDs",source:[n,c.get(i)]}):c.set(i,n);s=Array.from(a)}return o}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.facetPlanarFace=void 0;var i=n(1),r=n(0),o=n(108),s=n(3),a=n(109),c=function(e){return e&&e.__esModule?e:{default:e}}(n(42)),u=n(8),l=1e-8,h=r.KERNEL_TOLERANCE,d=function(e,t,n){var r,o=e[(0,s.modulus)(t-1,e.length)],a=e[(0,s.modulus)(t+1,e.length)],c=e[t],u=c[0]-o[0],l=c[1]-o[1],d=a[0]-c[0],p=a[1]-c[1],g=Math.sqrt(u*u+l*l),f=Math.sqrt(d*d+p*p);u*d+l*p<-.95*g*f?(u*=-1,l*=-1):n?(r=u,u=-l,l=r,r=d,d=-p,p=r):(r=u,u=l,l=-r,r=d,d=p,p=-r);var v=.5*(u/g+d/f),y=.5*(l/g+p/f),m=Math.sqrt(v*v+y*y);e[t]=i.Vector3.clone(c),e[t][0]+=h*v/m,e[t][1]+=h*y/m},p=function(e){return String(e[0])+String(e[1])},g=function(e){for(var t=!1,n={},i=0;i<e.length;i++){var r=p(e[i]);void 0===n[r]?n[r]=[]:t=!0,n[r].push(i)}return{table:n,foundSelfIntersection:t}},f=function(e){var t=g(e);if(t.foundSelfIntersection){for(var n=(0,o.isLoopCCW)(e),i=[],r=0;r<e.length-1;r++)i[r]=!1;var a=[];for(r=0;r<e.length-1;r++)if(!i[r]){var c=[],u=r;i[u]=!0,c.push(e[u]);var l=p(c[0]),h=e[(0,s.modulus)(u+1,e.length)],f=p(h),v=[];for(t.table[l].length>1&&v.push(0);f!==l;){if(c.push(h),c.length>e.length)throw new Error("splitHole failure");var y=t.table[f];if(1===y.length)u++;else{v.push(c.length-1);for(var m=[],_=0;_<y.length;_++)y[_]!==u&&m.push(y[_]);var E=Math.atan2(e[u+1][1]-e[u][1],e[u+1][0]-e[u][0]);E=(0,s.normalizeParameterToShiftedRange)(E-Math.PI,[-Math.PI,Math.PI]);var A=-1,x=0;for(_=0;_<m.length;_++){var C=Math.atan2(e[(0,s.modulus)(m[_]+1,e.length)][1]-e[m[_]][1],e[(0,s.modulus)(m[_]+1,e.length)][0]-e[m[_]][0]);C<E&&n?C+=s.PI2:C>E&&!n&&(C-=s.PI2);var w=Math.abs(C-E);w>x&&(x=w,A=m[_])}u=A}h=e[(0,s.modulus)(u+1,e.length)],f=p(h),i[u]=!0}for(_=0;_<v.length;_++)d(c,v[_],n);a.push(c)}return a}return[e]},v=function(e,t){for(var n=[],i=0;i<e.length;i++){n[i]={index:void 0,loop:void 0};for(var r=e[i],o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++)if(s[a][0]===r[0]&&s[a][1]===r[1]){n[i].index=a,n[i].loop=s;break}}return n};function y(e,t){var n,i=!1,r=t.length,o=r-1;for(n=0;n<r;n+=2)t[n][1]>e[1]!=t[o][1]>e[1]&&e[0]<(t[o][0]-t[n][0])*(e[1]-t[n][1])/(t[o][1]-t[n][1])+t[n][0]&&(i=!i),o=n;return i}function m(e,t,n){for(var r,s,a=v(e,[t].concat(n)),c=[],h=[],d=void 0,p=void 0,g=0;g<4;++g)a[g]&&void 0!==a[g].index&&(d?p||a[g].loop===d||(p=a[g].loop):d=a[g].loop,a[g].loop===d?(r=d,s=c):(r=p,s=h),(w=[a[g].index-1,a[g].index])[0]<0&&(w[0]=r.length-1),s.push(w),s.push([a[g].index,(a[g].index+1)%r.length]));p||(p=d,h=c);var f,m,_=void 0,E=d,A=c;for(g=0;g<3;++g){for(f=0;f<c.length;++f){for(m=0;m<h.length&&(c===h&&m>=f||!(_=(0,o.intersectSegments)(d[c[f][0]],d[c[f][1]],p[h[m][0]],p[h[m][1]],0))||!_.intersection);++m);if(_&&_.intersection)break}if(_&&_.intersection||d===p)break;0===g?(d=p,c=h):1===g&&(d=E,c=A,p=E,h=A)}if(void 0!==_&&_.intersection){var x=i.Vector3.subtract(i.Vector3.createFloat64(),d[c[f][1]],d[c[f][0]]);i.Vector3.scale(x,x,_.solutions[0]);var C=i.Vector3.add(x,x,d[c[f][0]]);if(c[f][0]>c[f][1]){var w=c[f][1];c[f][1]=c[f][0],c[f][0]=w}if(0===c[f][0]&&1!==c[f][1]&&(c[f][0]=c[f][1],c[f][1]=0),h[m][0]>h[m][1]&&0!==h[m][1]&&(w=h[m][1],h[m][1]=h[m][0],h[m][0]=w),0===h[m][0]&&1!==h[m][1]&&(h[m][0]=h[m][1],h[m][1]=0),d===p){if(d.length<4)return void console.error("REGION: Failed to fix loop tessellation! [loop too short]");console.log("REGION: Fixing self-intersection");var b=new Array(4);c[f][0]<h[m][0]?(b[0]=c[f][0],b[1]=c[f][1],b[2]=h[m][0],b[3]=h[m][1]):(b[0]=h[m][0],b[1]=h[m][1],b[2]=c[f][0],b[3]=c[f][1]);var M=[];for(g=0;g<=b[0];++g)M.push(d[g]);var T=i.Vector3.subtract(i.Vector3.createFloat64(),d[b[0]],d[b[1]]);i.Vector3.normalize(T,T),i.Vector3.scale(T,T,l);var V=i.Vector3.add(i.Vector3.createFloat64(),C,T);for(M.push(V),g=b[2];g>=b[1];--g)M.push(d[g]);var S=i.Vector3.subtract(i.Vector3.createFloat64(),C,T);if(M.push(S),b[3]>b[2])for(g=b[3];g<d.length;++g)M.push(d[g]);for(d.length=M.length,g=0;g<M.length;++g)d[g]=M[g]}else{console.log("REGION: Fixing loop-loop intersection");var R=d,L=p,P=h[m][0],O=h[m][1],D=c[f][0],I=c[f][1];(t===L||L.length>R.length&&t!==R)&&(R=p,L=d,P=c[f][0],O=c[f][1],D=h[m][0],I=h[m][1]);var N=1;t!==L&&t!==R&&(N=-1);var k=1;y(L[O],R)&&(k=-1,w=P,P=O,O=w),i.Vector3.subtract(L[O],L[P],L[O]),i.Vector3.normalize(L[O],L[O]),i.Vector3.scale(L[O],L[O],N*l),i.Vector3.add(L[O],C,L[O]);var B,F,j=O;do{(O+=k)<0?O=L.length-1:O%=L.length}while(O!==P&&!y(L[O],R));(P=O-k)<0&&(P=L.length-1),I=D;do{B=R[I],F=R[I=++I%R.length],_=(0,o.intersectSegments)(B,F,L[P],L[O],0)}while(D!==I&&!_.intersection);_.intersection&&(i.Vector3.scale(x,i.Vector3.subtract(x,F,B),_.solutions[0]),i.Vector3.add(C,x,B),i.Vector3.subtract(L[P],L[O],L[P]),i.Vector3.normalize(L[P],L[P]),i.Vector3.scale(L[P],L[P],N*l),i.Vector3.add(L[P],C,L[P])),Math.min(Math.abs(j-P),Math.abs(j-P-L.length))>1&&console.warn("REGION: Remove loop segment! FIXME!")}}else u.DebugUtils.warn("REGION: Failed to fix loop tessellation! [no intersected segments]")}var _=function(e,t){var n=e;for(n<0?n+=t.length:n%=t.length;t[n]!==n;)n=t[n];return n},E=function(e,t,n,r){return i.Vector3.distance(n[e],n[t])<1e-6?(r[0]=e,r[1]=e,1):0},A=function(e,t,n,r,o){var s=new Array(2);if(s[0]=r[e],s[1]=r[n],i.Vector3.length(i.Vector3.subtract(i.Vector3.createFloat64(),s[0],s[1]))<1e-6)return o[0]=e,o[1]=e,o[2]=e,2;var a=(s[0][0]-s[1][0])*(r[t][1]-s[1][1])-(s[0][1]-s[1][1])*(r[t][0]-s[1][0]);return a>-l*l&&a<l*l?(o[0]=e,o[1]=e,o[2]=n,1):0},x=function(e,t,n,i,r,s){return(0,o.intersectSegments)(r[e],r[t],r[n],r[i]).intersection?(s[0]=e,s[1]=t,s[2]=t,s[3]=i,1):(s[0]=-1,0)},C=function(e){if(e.length<4)return e;for(var t,n,i,r,o=e.length,s=new Int32Array(o),a=0;a<o;++a)s[a]=a;var c,u=new Array(3),l=new Array(3);for(l[0]=0,l[1]=0,l[2]=0,a=0;a<o;++a)t=_(a,s),n=_(a+1,s),(c=E(t,n,e,u))&&(++l[0],s[t]=u[0],s[n]=u[1],t=_(a+=c,s),n=_(a+1,s)),i=_(a+2,s),(c=A(t,n,i,e,u))&&(++l[1],s[t]=u[0],s[n]=u[1],s[i]=u[2],t=_(a+=c,s),n=_(a+1,s),i=_(a+2,s)),r=_(a+3,s),(c=x(t,n,i,r,e,u))&&(++l[2],s[t]=u[0],s[n]=u[1],s[i]=u[2],s[r]=u[3],a+=c);var h=[];for(a=0;a<e.length;++a)s[a]===a&&h.push(e[a]);return h},w=function(e,t,n){for(var i=v(e,[t].concat(n)),r=0;r<i.length;r++)d(i[r].loop,i[r].index,(0,o.isLoopCCW)(i[r].loop))},b=function(e,t){var n=!1;!function(e){var t=g(e);if(t.foundSelfIntersection)for(var n=(0,o.isLoopCCW)(e),i=c.default.keys(t.table),r=0;r<i.length;r++)if(t.table[i[r]].length>1)for(var s=t.table[i[r]],a=0;a<s.length;a++)d(e,s[a],n)}(e);for(var i=[],r=0;r<t.length;r++)i.push.apply(i,f(t[r]));var s=C(e),l=[];for(r=0;r<i.length;r++)l.push(C(i[r]));var h=8;do{n=!0;var p=(0,c.default)(s).map((function(e){return new a.poly2tri.Point(e[0],e[1])})),v=new a.poly2tri.SweepContext(p);for(r=0;r<l.length;r++){var y=(0,c.default)(l[r]).map((function(e){return new a.poly2tri.Point(e[0],e[1])}));v.addHole(y)}try{v.triangulate()}catch(e){if("poly2tri Intersecting Constraints"===e.message.substr(0,33))n=!1,m(e.points,s,l);else if("poly2tri EdgeEvent: Collinear not supported"===e.message.substr(0,43))n=!1,w(e.points,s,l);else{if(!e.points)throw e;n=!1,m(e.points,s,l)}}}while(!n&&h-- >0);return h<=0&&u.DebugUtils.warn("Computation of region tessellation failed, due to too many intersections."),v};t.facetPlanarFace=function(e,t){var n=e.getSurface(),r=(0,s.getPlaneTransforms)(n),a=new o.LoopCalculator(e,r.threeSpaceToUV).getRank0Loops();if(1!==a.length)throw new Error("Each region should have exactly one top-loop");var c=a[0],u=(0,o.tessellateLoop)(c._loop,t);if(r.threeSpaceToUV)for(var l=0;l<u.length;l++)i.Vector3.transformMatrix44(u[l],u[l],r.threeSpaceToUV);for(var h=[],d=c.getImmediatelyInsideLoops(),p=0;p<d.length;p++){var g=(0,o.tessellateLoop)(d[p]._loop,t);if(h.push(g),r.threeSpaceToUV)for(l=0;l<g.length;l++)i.Vector3.transformMatrix44(g[l],g[l],r.threeSpaceToUV)}var f=b(u,h),v=f.getTriangles(),y=new Uint32Array(3*v.length),m=new Float32Array(3*f.pointCount()),_=i.Vector3.createFloat64();for(l=0;l<f.pointCount();l++){var E=f.getPoint(l);i.Vector3.set(_,E.x,E.y,0),r.uvToThreeSpace&&i.Vector3.transformMatrix44(_,_,r.uvToThreeSpace),m[3*l]=_[0],m[3*l+1]=_[1],m[3*l+2]=_[2],E.index=l}for(l=0;l<v.length;l++){var A=v[l].getPoints();for(e.isReversed()&&A.reverse(),p=0;p<A.length;p++){var x=A[p];y[3*l+p]=x.index}}return{indexBuffer:y,vertexBuffer:m}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoopCalculator=t.intersectSegments=t.isLoopCCW=t.tessellateLoop=void 0;var i=n(1),r=n(0),o=n(3),s=function(e,t){this._loop=e,this._enclosureRank=0,this._isOuterLoop=!1,this._insideLoops=[],this._isOpen=!1,this._coedges=this._loop.getCoedges();for(var n=0;n<this._coedges.length;++n)this._coedges[n].generateUVCurve(t)};s.prototype.addInsideLoop=function(e){this._insideLoops.push(e)},s.prototype.uvAngleSubtended=function(e){if(!this.isClosedLoop())throw new Error("uvAngleSubtended cannot work with open loops");for(var t=0,n=0;n<this._coedges.length;n++)t+=this._coedges[n].uvAngleSubtended(e);return t},s.prototype.getArbitraryPointOnLoop=function(){if(1===this._coedges.length){var e=this._coedges[0].t0();return this._coedges[0].evaluatePosition(e)}var t=this._coedges[0].getStartVertex();if(t)return t.getPosition()},s.prototype.isInside=function(e){var t=this.getArbitraryPointOnLoop(),n=Math.abs(e.uvAngleSubtended(t)),i=Math.floor(n/(2*Math.PI)),o=n-2*i*Math.PI;return!!(Math.abs(o)<r.KERNEL_TOLERANCE&&i||Math.abs(o-2*Math.PI)<r.KERNEL_TOLERANCE)},s.prototype.getEnclosureRank=function(){return this._enclosureRank},s.prototype.resetEnclosureRank=function(){this._enclosureRank=0},s.prototype.decreaseEnclosureRank=function(){this._enclosureRank--},s.prototype.setIsOuterLoop=function(e){this._isOuterLoop=e},s.prototype.isOuterLoop=function(){return this._isOuterLoop},s.prototype.isClosedLoop=function(){return!this._isOpen},s.prototype.addInsideLoop=function(e){this._insideLoops.push(e)},s.prototype.getImmediatelyInsideLoops=function(){for(var e=[],t=0;t<this._insideLoops.length;t++)this._insideLoops[t].getEnclosureRank()===this._enclosureRank-1&&e.push(this._insideLoops[t]);return e};var a=function(e,t){this._face=e,this._loops=[];for(var n=0;n<this._face.getLoops().length;++n)this._loops.push(new s(this._face.getLoops()[n],t));this._calcSenses()};a.prototype._calcSenses=function(){for(var e=this._loops.length,t=0;t<e;t++)this._loops[t].resetEnclosureRank();for(t=0;t<e;t++)if(this._loops[t].isClosedLoop())for(var n=0;n<e;n++)this._loops[n].isClosedLoop()&&t!==n&&this._loops[t].isInside(this._loops[n])&&!this._loops[n].isInside(this._loops[t])&&(this._loops[t].decreaseEnclosureRank(),this._loops[n].addInsideLoop(this._loops[t]));for(t=0;t<e;t++){var i=0-this._loops[t].getEnclosureRank();this._loops[t].setIsOuterLoop(i%2==0)}},a.prototype.getRank0Loops=function(){var e=[];return this._loops.forEach((function(t){0===t.getEnclosureRank()&&e.push(t)})),e},t.tessellateLoop=function(e,t){for(var n=[],r=0,o=e.getCoedges().length;r<o;++r){var s=e.getCoedges()[r],a=s.getEdge(),c=a.tessellate(void 0,t).positions;c=c.slice(1,c.length-1),(c=[i.Vector3.clone(a.getStartVertex().getPosition())].concat(c)).push(i.Vector3.clone(a.getEndVertex().getPosition())),s.isReversed()&&c.reverse(),n=n.concat(c.slice(0,c.length-1))}return n},t.isLoopCCW=function(e){for(var t=0,n=0;n<e.length;n++){var i=(n+1)%e.length;t+=e[n][0]*e[i][1]-e[n][1]*e[i][0]}return t>0},t.intersectSegments=function(e,t,n,r,s){var a=[[t[0]-e[0],-(r[0]-n[0]),n[0]-e[0]],[t[1]-e[1],-(r[1]-n[1]),n[1]-e[1]]],c=(0,o.solveTwoEquationsTwoVariables)(a);if(void 0===c)return!1;var u=i.Vector3.distance(e,t),l=i.Vector3.distance(n,r);return{intersection:-s<c[0]*u&&(c[0]-1)*u<s&&-s<c[1]*l&&(c[1]-1)*l<s,solutions:c}},t.LoopCalculator=a},function(e,t,n){"use strict";var i,r;if(Object.defineProperty(t,"__esModule",{value:!0}),void 0===o)var o={},s={exports:{}};!function(a){"object"==_typeof(o)?s.exports=a():void 0===(r="function"==typeof(i=a)?i.call(t,n,t,e):i)||(e.exports=r)}((function(){return function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};t[s][0].call(c.exports,(function(e){return r(t[s][1][e]||e)}),c,c.exports,e,t,n,i)}return n[s].exports}for(var o=!1,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){t.exports={version:"1.3.5"}},{}],2:[function(e,t,n){var i=function(e,t){this.head_=e,this.tail_=t,this.search_node_=e};i.prototype.head=function(){return this.head_},i.prototype.setHead=function(e){this.head_=e},i.prototype.tail=function(){return this.tail_},i.prototype.setTail=function(e){this.tail_=e},i.prototype.search=function(){return this.search_node_},i.prototype.setSearch=function(e){this.search_node_=e},i.prototype.findSearchNode=function(){return this.search_node_},i.prototype.locateNode=function(e){var t=this.search_node_;if(e<t.value){for(;t=t.prev;)if(e>=t.value)return this.search_node_=t,t}else for(;t=t.next;)if(e<t.value)return this.search_node_=t.prev,t.prev;return null},i.prototype.locatePoint=function(e){var t=e.x,n=this.findSearchNode(t),i=n.point.x;if(t===i){if(e!==n.point)if(e===n.prev.point)n=n.prev;else{if(e!==n.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");n=n.next}}else if(t<i)for(;(n=n.prev)&&e!==n.point;);else for(;(n=n.next)&&e!==n.point;);return n&&(this.search_node_=n),n},t.exports=i,t.exports.Node=function(e,t){this.point=e,this.triangle=t||null,this.next=null,this.prev=null,this.value=e.x}},{}],3:[function(e,t,n){t.exports=function(e,t){if(!e)throw new Error(t||"Assert Failed")}},{}],4:[function(e,t,n){var i=e("./xy"),r=function(e,t){this.x=+e||0,this.y=+t||0,this._p2t_edge_list=null};r.prototype.toString=function(){return i.toStringBase(this)},r.prototype.toJSON=function(){return{x:this.x,y:this.y}},r.prototype.clone=function(){return new r(this.x,this.y)},r.prototype.set_zero=function(){return this.x=0,this.y=0,this},r.prototype.set=function(e,t){return this.x=+e||0,this.y=+t||0,this},r.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},r.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this},r.prototype.sub=function(e){return this.x-=e.x,this.y-=e.y,this},r.prototype.mul=function(e){return this.x*=e,this.y*=e,this},r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},r.prototype.normalize=function(){var e=this.length();return this.x/=e,this.y/=e,e},r.prototype.equals=function(e){return this.x===e.x&&this.y===e.y},r.negate=function(e){return new r(-e.x,-e.y)},r.add=function(e,t){return new r(e.x+t.x,e.y+t.y)},r.sub=function(e,t){return new r(e.x-t.x,e.y-t.y)},r.mul=function(e,t){return new r(e*t.x,e*t.y)},r.cross=function(e,t){return"number"==typeof e?"number"==typeof t?e*t:new r(-e*t.y,e*t.x):"number"==typeof t?new r(t*e.y,-t*e.x):e.x*t.y-e.y*t.x},r.toString=i.toString,r.compare=i.compare,r.cmp=i.compare,r.equals=i.equals,r.dot=function(e,t){return e.x*t.x+e.y*t.y},t.exports=r},{"./xy":11}],5:[function(e,t,n){var i=e("./xy"),r=function(e,t){this.name="PointError",this.points=t=t||[],this.message=e||"Invalid Points!";for(var n=0;n<t.length;n++)this.message+=" "+i.toString(t[n])};(r.prototype=new Error).constructor=r,t.exports=r},{"./xy":11}],6:[function(e,t,n){(function(t){var i=t.poly2tri;n.noConflict=function(){return t.poly2tri=i,n},n.VERSION=e("../dist/version.json").version,n.PointError=e("./pointerror"),n.Point=e("./point"),n.Triangle=e("./triangle"),n.SweepContext=e("./sweepcontext");var r=e("./sweep");n.triangulate=r.triangulate,n.sweep={Triangulate:r.triangulate}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(e,t,n){var i=e("./assert"),r=e("./pointerror"),o=e("./triangle"),s=e("./advancingfront").Node,a=e("./utils"),c=a.EPSILON,u=a.Orientation,l=a.orient2d,h=a.inScanArea,d=a.isAngleObtuse;function p(e,t){var n=e.locateNode(t),r=function(e,t,n){var i=new o(t,n.point,n.next.point);i.markNeighbor(n.triangle),e.addToMap(i);var r=new s(t);return r.next=n.next,r.prev=n,n.next.prev=r,n.next=r,m(e,i)||e.mapTriangleToNodes(i),r}(e,t,n);return t.x<=n.point.x+c&&y(e,n),function(e,t){for(var n=t.next;n.next&&!d(n.point,n.next.point,n.prev.point);)y(e,n),n=n.next;for(n=t.prev;n.prev&&!d(n.point,n.next.point,n.prev.point);)y(e,n),n=n.prev;t.next&&t.next.next&&function(e){var t=e.point.x-e.next.next.point.x,n=e.point.y-e.next.next.point.y;return i(n>=0,"unordered y"),t>=0||Math.abs(t)<n}(t)&&function(e,t){for(l(t.point,t.next.point,t.next.next.point)===u.CCW?e.basin.left_node=t.next.next:e.basin.left_node=t.next,e.basin.bottom_node=e.basin.left_node;e.basin.bottom_node.next&&e.basin.bottom_node.point.y>=e.basin.bottom_node.next.point.y;)e.basin.bottom_node=e.basin.bottom_node.next;if(e.basin.bottom_node!==e.basin.left_node){for(e.basin.right_node=e.basin.bottom_node;e.basin.right_node.next&&e.basin.right_node.point.y<e.basin.right_node.next.point.y;)e.basin.right_node=e.basin.right_node.next;e.basin.right_node!==e.basin.bottom_node&&(e.basin.width=e.basin.right_node.point.x-e.basin.left_node.point.x,e.basin.left_highest=e.basin.left_node.point.y>e.basin.right_node.point.y,function e(t,n){if(!function(e,t){var n;return n=e.basin.left_highest?e.basin.left_node.point.y-t.point.y:e.basin.right_node.point.y-t.point.y,e.basin.width>n}(t,n)&&(y(t,n),n.prev!==t.basin.left_node||n.next!==t.basin.right_node)){if(n.prev===t.basin.left_node){if(l(n.point,n.next.point,n.next.next.point)===u.CW)return;n=n.next}else if(n.next===t.basin.right_node){if(l(n.point,n.prev.point,n.prev.prev.point)===u.CCW)return;n=n.prev}else n=n.prev.point.y<n.next.point.y?n.prev:n.next;e(t,n)}}(e,e.basin.bottom_node))}}(e,t)}(e,r),r}function g(e,t,n){e.edge_event.constrained_edge=t,e.edge_event.right=t.p.x>t.q.x,v(n.triangle,t.p,t.q)||(function(e,t,n){e.edge_event.right?function(e,t,n){for(;n.next.point.x<t.p.x;)l(t.q,n.next.point,t.p)===u.CCW?A(e,t,n):n=n.next}(e,t,n):function(e,t,n){for(;n.prev.point.x>t.p.x;)l(t.q,n.prev.point,t.p)===u.CW?C(e,t,n):n=n.prev}(e,t,n)}(e,t,n),f(e,t.p,t.q,n.triangle,t.q))}function f(e,t,n,i,o){if(!v(i,t,n)){var s=i.pointCCW(o),a=l(n,s,t);if(a===u.COLLINEAR)throw new r("poly2tri EdgeEvent: Collinear not supported!",[n,s,t]);var c=i.pointCW(o),h=l(n,c,t);if(h===u.COLLINEAR)throw new r("poly2tri EdgeEvent: Collinear not supported!",[n,c,t]);a===h?f(e,t,n,i=a===u.CW?i.neighborCCW(o):i.neighborCW(o),o):b(e,t,n,i,o)}}function v(e,t,n){var i=e.edgeIndex(t,n);if(-1!==i){e.markConstrainedEdgeByIndex(i);var r=e.getNeighbor(i);return r&&r.markConstrainedEdgeByPoints(t,n),!0}return!1}function y(e,t){var n=new o(t.prev.point,t.point,t.next.point);n.markNeighbor(t.prev.triangle),n.markNeighbor(t.triangle),e.addToMap(n),t.prev.next=t.next,t.next.prev=t.prev,m(e,n)||e.mapTriangleToNodes(n)}function m(e,t){for(var n=0;n<3;++n)if(!t.delaunay_edge[n]){var i=t.getNeighbor(n);if(i){var r=t.getPoint(n),o=i.oppositePoint(t,r),s=i.index(o);if(i.constrained_edge[s]||i.delaunay_edge[s]){t.constrained_edge[n]=i.constrained_edge[s];continue}if(_(r,t.pointCCW(r),t.pointCW(r),o)){t.delaunay_edge[n]=!0,i.delaunay_edge[s]=!0,E(t,r,i,o);var a=!m(e,t);return a&&e.mapTriangleToNodes(t),(a=!m(e,i))&&e.mapTriangleToNodes(i),t.delaunay_edge[n]=!1,i.delaunay_edge[s]=!1,!0}}}return!1}function _(e,t,n,i){var r=e.x-i.x,o=e.y-i.y,s=t.x-i.x,a=t.y-i.y,c=r*a-s*o;if(c<=0)return!1;var u=n.x-i.x,l=n.y-i.y,h=u*o-r*l;return!(h<=0)&&(r*r+o*o)*(s*l-u*a)+(s*s+a*a)*h+(u*u+l*l)*c>0}function E(e,t,n,i){var r,o,s,a,c,u,l,h,d,p,g,f;r=e.neighborCCW(t),o=e.neighborCW(t),s=n.neighborCCW(i),a=n.neighborCW(i),c=e.getConstrainedEdgeCCW(t),u=e.getConstrainedEdgeCW(t),l=n.getConstrainedEdgeCCW(i),h=n.getConstrainedEdgeCW(i),d=e.getDelaunayEdgeCCW(t),p=e.getDelaunayEdgeCW(t),g=n.getDelaunayEdgeCCW(i),f=n.getDelaunayEdgeCW(i),e.legalize(t,i),n.legalize(i,t),n.setDelaunayEdgeCCW(t,d),e.setDelaunayEdgeCW(t,p),e.setDelaunayEdgeCCW(i,g),n.setDelaunayEdgeCW(i,f),n.setConstrainedEdgeCCW(t,c),e.setConstrainedEdgeCW(t,u),e.setConstrainedEdgeCCW(i,l),n.setConstrainedEdgeCW(i,h),e.clearNeighbors(),n.clearNeighbors(),r&&n.markNeighbor(r),o&&e.markNeighbor(o),s&&e.markNeighbor(s),a&&n.markNeighbor(a),e.markNeighbor(n)}function A(e,t,n){n.point.x<t.p.x&&(l(n.point,n.next.point,n.next.next.point)===u.CCW?x(e,t,n):(function e(t,n,i){l(i.next.point,i.next.next.point,i.next.next.next.point)===u.CCW?x(t,n,i.next):l(n.q,i.next.next.point,n.p)===u.CCW&&e(t,n,i.next)}(e,t,n),A(e,t,n)))}function x(e,t,n){y(e,n.next),n.next.point!==t.p&&l(t.q,n.next.point,t.p)===u.CCW&&l(n.point,n.next.point,n.next.next.point)===u.CCW&&x(e,t,n)}function C(e,t,n){n.point.x>t.p.x&&(l(n.point,n.prev.point,n.prev.prev.point)===u.CW?w(e,t,n):(function e(t,n,i){l(i.prev.point,i.prev.prev.point,i.prev.prev.prev.point)===u.CW?w(t,n,i.prev):l(n.q,i.prev.prev.point,n.p)===u.CW&&e(t,n,i.prev)}(e,t,n),C(e,t,n)))}function w(e,t,n){y(e,n.prev),n.prev.point!==t.p&&l(t.q,n.prev.point,t.p)===u.CW&&l(n.point,n.prev.point,n.prev.prev.point)===u.CW&&w(e,t,n)}function b(e,t,n,o,s){var a=o.neighborAcross(s);i(a,"FLIP failed due to missing triangle!");var c=a.oppositePoint(o,s);if(o.getConstrainedEdgeAcross(s)){var d=o.index(s);throw new r("poly2tri Intersecting Constraints",[s,c,o.getPoint((d+1)%3),o.getPoint((d+2)%3)])}h(s,o.pointCCW(s),o.pointCW(s),c)?(E(o,s,a,c),e.mapTriangleToNodes(o),e.mapTriangleToNodes(a),s===n&&c===t?n===e.edge_event.constrained_edge.q&&t===e.edge_event.constrained_edge.p&&(o.markConstrainedEdgeByPoints(t,n),a.markConstrainedEdgeByPoints(t,n),m(e,o),m(e,a)):b(e,t,n,o=function(e,t,n,i,r,o){var s;return t===u.CCW?(s=i.edgeIndex(r,o),i.delaunay_edge[s]=!0,m(e,i),i.clearDelaunayEdges(),n):(s=n.edgeIndex(r,o),n.delaunay_edge[s]=!0,m(e,n),n.clearDelaunayEdges(),i)}(e,l(n,c,t),o,a,s,c),s)):(function e(t,n,r,o,s,a){var c=s.neighborAcross(a);i(c,"FLIP failed due to missing triangle");var u=c.oppositePoint(s,a);h(r,o.pointCCW(r),o.pointCW(r),u)?b(t,r,u,c,u):e(t,n,r,o,c,M(n,r,c,u))}(e,t,n,o,a,M(t,n,a,c)),f(e,t,n,o,s))}function M(e,t,n,i){var o=l(t,i,e);if(o===u.CW)return n.pointCCW(i);if(o===u.CCW)return n.pointCW(i);throw new r("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[t,i,e])}n.triangulate=function(e){e.initTriangulation(),e.createAdvancingFront(),function(e){var t,n=e.pointCount();for(t=1;t<n;++t)for(var i=e.getPoint(t),r=p(e,i),o=i._p2t_edge_list,s=0;o&&s<o.length;++s)g(e,o[s],r)}(e),function(e){for(var t=e.front().head().next.triangle,n=e.front().head().next.point;!t.getConstrainedEdgeCW(n);)t=t.neighborCCW(n);e.meshClean(t)}(e)}},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(e,t,n){var i=e("./pointerror"),r=e("./point"),o=e("./triangle"),s=e("./sweep"),a=e("./advancingfront"),c=a.Node,u=function(e,t){if(this.p=e,this.q=t,e.y>t.y)this.q=e,this.p=t;else if(e.y===t.y)if(e.x>t.x)this.q=e,this.p=t;else if(e.x===t.x)throw new i("poly2tri Invalid Edge constructor: repeated points!",[e]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},l=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};l.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var h=function(e,t){t=t||{},this.triangles_=[],this.map_=[],this.points_=t.cloneArrays?e.slice(0):e,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new l,this.edge_event=new function(){this.constrained_edge=null,this.right=!1},this.initEdges(this.points_)};h.prototype.addHole=function(e){this.initEdges(e);var t,n=e.length;for(t=0;t<n;t++)this.points_.push(e[t]);return this},h.prototype.AddHole=h.prototype.addHole,h.prototype.addHoles=function(e){var t,n=e.length;for(t=0;t<n;t++)this.initEdges(e[t]);return this.points_=this.points_.concat.apply(this.points_,e),this},h.prototype.addPoint=function(e){return this.points_.push(e),this},h.prototype.AddPoint=h.prototype.addPoint,h.prototype.addPoints=function(e){return this.points_=this.points_.concat(e),this},h.prototype.triangulate=function(){return s.triangulate(this),this},h.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},h.prototype.getTriangles=function(){return this.triangles_},h.prototype.GetTriangles=h.prototype.getTriangles,h.prototype.front=function(){return this.front_},h.prototype.pointCount=function(){return this.points_.length},h.prototype.head=function(){return this.head_},h.prototype.setHead=function(e){this.head_=e},h.prototype.tail=function(){return this.tail_},h.prototype.setTail=function(e){this.tail_=e},h.prototype.getMap=function(){return this.map_},h.prototype.initTriangulation=function(){var e,t=this.points_[0].x,n=this.points_[0].x,i=this.points_[0].y,o=this.points_[0].y,s=this.points_.length;for(e=1;e<s;e++){var a=this.points_[e];a.x>t&&(t=a.x),a.x<n&&(n=a.x),a.y>i&&(i=a.y),a.y<o&&(o=a.y)}this.pmin_=new r(n,o),this.pmax_=new r(t,i);var c=.3*(t-n),u=.3*(i-o);this.head_=new r(t+c,o-u),this.tail_=new r(n-c,o-u),this.points_.sort(r.compare)},h.prototype.initEdges=function(e,t){var n,i=e.length,r=t?e.length-1:e.length;for(n=0;n<r;++n)this.edge_list.push(new u(e[n],e[(n+1)%i]))},h.prototype.getPoint=function(e){return this.points_[e]},h.prototype.addToMap=function(e){this.map_.push(e)},h.prototype.locateNode=function(e){return this.front_.locateNode(e.x)},h.prototype.createAdvancingFront=function(){var e,t,n,i=new o(this.points_[0],this.tail_,this.head_);this.map_.push(i),e=new c(i.getPoint(1),i),t=new c(i.getPoint(0),i),n=new c(i.getPoint(2)),this.front_=new a(e,n),e.next=t,t.next=n,t.prev=e,n.prev=t},h.prototype.removeNode=function(e){},h.prototype.mapTriangleToNodes=function(e){for(var t=0;t<3;++t)if(!e.getNeighbor(t)){var n=this.front_.locatePoint(e.pointCW(e.getPoint(t)));n&&(n.triangle=e)}},h.prototype.removeFromMap=function(e){var t,n=this.map_,i=n.length;for(t=0;t<i;t++)if(n[t]===e){n.splice(t,1);break}},h.prototype.meshClean=function(e){for(var t,n,i=[e];t=i.pop();)if(!t.isInterior())for(t.setInterior(!0),this.triangles_.push(t),n=0;n<3;n++)t.constrained_edge[n]||i.push(t.getNeighbor(n))},t.exports=h},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(e,t,n){var i=function(e,t,n){this.points_=[e,t,n],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},r=e("./xy").toString;i.prototype.toString=function(){return"["+r(this.points_[0])+r(this.points_[1])+r(this.points_[2])+"]"},i.prototype.getPoint=function(e){return this.points_[e]},i.prototype.GetPoint=i.prototype.getPoint,i.prototype.getPoints=function(){return this.points_},i.prototype.getNeighbor=function(e){return this.neighbors_[e]},i.prototype.containsPoint=function(e){var t=this.points_;return e===t[0]||e===t[1]||e===t[2]},i.prototype.containsEdge=function(e){return this.containsPoint(e.p)&&this.containsPoint(e.q)},i.prototype.containsPoints=function(e,t){return this.containsPoint(e)&&this.containsPoint(t)},i.prototype.isInterior=function(){return this.interior_},i.prototype.setInterior=function(e){return this.interior_=e,this},i.prototype.markNeighborPointers=function(e,t,n){var i=this.points_;if(e===i[2]&&t===i[1]||e===i[1]&&t===i[2])this.neighbors_[0]=n;else if(e===i[0]&&t===i[2]||e===i[2]&&t===i[0])this.neighbors_[1]=n;else{if(!(e===i[0]&&t===i[1]||e===i[1]&&t===i[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=n}},i.prototype.markNeighbor=function(e){var t=this.points_;e.containsPoints(t[1],t[2])?(this.neighbors_[0]=e,e.markNeighborPointers(t[1],t[2],this)):e.containsPoints(t[0],t[2])?(this.neighbors_[1]=e,e.markNeighborPointers(t[0],t[2],this)):e.containsPoints(t[0],t[1])&&(this.neighbors_[2]=e,e.markNeighborPointers(t[0],t[1],this))},i.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},i.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},i.prototype.pointCW=function(e){var t=this.points_;return e===t[0]?t[2]:e===t[1]?t[0]:e===t[2]?t[1]:null},i.prototype.pointCCW=function(e){var t=this.points_;return e===t[0]?t[1]:e===t[1]?t[2]:e===t[2]?t[0]:null},i.prototype.neighborCW=function(e){return e===this.points_[0]?this.neighbors_[1]:e===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},i.prototype.neighborCCW=function(e){return e===this.points_[0]?this.neighbors_[2]:e===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},i.prototype.getConstrainedEdgeCW=function(e){return e===this.points_[0]?this.constrained_edge[1]:e===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},i.prototype.getConstrainedEdgeCCW=function(e){return e===this.points_[0]?this.constrained_edge[2]:e===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},i.prototype.getConstrainedEdgeAcross=function(e){return e===this.points_[0]?this.constrained_edge[0]:e===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},i.prototype.setConstrainedEdgeCW=function(e,t){e===this.points_[0]?this.constrained_edge[1]=t:e===this.points_[1]?this.constrained_edge[2]=t:this.constrained_edge[0]=t},i.prototype.setConstrainedEdgeCCW=function(e,t){e===this.points_[0]?this.constrained_edge[2]=t:e===this.points_[1]?this.constrained_edge[0]=t:this.constrained_edge[1]=t},i.prototype.getDelaunayEdgeCW=function(e){return e===this.points_[0]?this.delaunay_edge[1]:e===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},i.prototype.getDelaunayEdgeCCW=function(e){return e===this.points_[0]?this.delaunay_edge[2]:e===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},i.prototype.setDelaunayEdgeCW=function(e,t){e===this.points_[0]?this.delaunay_edge[1]=t:e===this.points_[1]?this.delaunay_edge[2]=t:this.delaunay_edge[0]=t},i.prototype.setDelaunayEdgeCCW=function(e,t){e===this.points_[0]?this.delaunay_edge[2]=t:e===this.points_[1]?this.delaunay_edge[0]=t:this.delaunay_edge[1]=t},i.prototype.neighborAcross=function(e){return e===this.points_[0]?this.neighbors_[0]:e===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},i.prototype.oppositePoint=function(e,t){var n=e.pointCW(t);return this.pointCW(n)},i.prototype.legalize=function(e,t){var n=this.points_;if(e===n[0])n[1]=n[0],n[0]=n[2],n[2]=t;else if(e===n[1])n[2]=n[1],n[1]=n[0],n[0]=t;else{if(e!==n[2])throw new Error("poly2tri Invalid Triangle.legalize() call");n[0]=n[2],n[2]=n[1],n[1]=t}},i.prototype.index=function(e){var t=this.points_;if(e===t[0])return 0;if(e===t[1])return 1;if(e===t[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},i.prototype.edgeIndex=function(e,t){var n=this.points_;if(e===n[0]){if(t===n[1])return 2;if(t===n[2])return 1}else if(e===n[1]){if(t===n[2])return 0;if(t===n[0])return 2}else if(e===n[2]){if(t===n[0])return 1;if(t===n[1])return 0}return-1},i.prototype.markConstrainedEdgeByIndex=function(e){this.constrained_edge[e]=!0},i.prototype.markConstrainedEdgeByEdge=function(e){this.markConstrainedEdgeByPoints(e.p,e.q)},i.prototype.markConstrainedEdgeByPoints=function(e,t){var n=this.points_;t===n[0]&&e===n[1]||t===n[1]&&e===n[0]?this.constrained_edge[2]=!0:t===n[0]&&e===n[2]||t===n[2]&&e===n[0]?this.constrained_edge[1]=!0:(t===n[1]&&e===n[2]||t===n[2]&&e===n[1])&&(this.constrained_edge[0]=!0)},t.exports=i},{"./xy":11}],10:[function(e,t,n){var i=1e-16;n.EPSILON=i;var r={CW:1,CCW:-1,COLLINEAR:0};n.Orientation=r,n.orient2d=function(e,t,n){var o=(e.x-n.x)*(t.y-n.y)-(e.y-n.y)*(t.x-n.x);return o>-i&&o<i?r.COLLINEAR:o>0?r.CCW:r.CW},n.inScanArea=function(e,t,n,r){return!((e.x-t.x)*(r.y-t.y)-(r.x-t.x)*(e.y-t.y)>=-i||(e.x-n.x)*(r.y-n.y)-(r.x-n.x)*(e.y-n.y)<=i)},n.isAngleObtuse=function(e,t,n){var i=t.x-e.x,r=t.y-e.y;return i*(n.x-e.x)+r*(n.y-e.y)<0}},{}],11:[function(e,t,n){function i(e){return"("+e.x+";"+e.y+")"}t.exports={toString:function(e){var t=e.toString();return"[object Object]"===t?i(e):t},toStringBase:i,compare:function(e,t){return e.y===t.y?e.x-t.x:e.y-t.y},equals:function(e,t){return e.x===t.x&&e.y===t.y}}},{}]},{},[6])(6)}));var a=s.exports;t.poly2tri=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CCI=void 0;var i=n(1),r=n(111),o=n(77),s=function(e,t,n,i,o){this._cu1=e,this._range1=t,this._cu2=n,this._range2=i,this._epsilon=o,this._tree=new r.SubCurveTree(e,t,n,i,o)};s.prototype.intersect=function(){var e=[];this._tree.build();for(var t=0;t<this._tree._overlaps.length;++t){var n=this._tree._overlaps[t][0],i=this._tree._overlaps[t][1];e=e.concat(this._solve(n._range,i._range))}return this._merge(e),e},s.prototype._distanceSquared=function(e,t){var n=this._cu1.evaluatePosition(e),r=this._cu2.evaluatePosition(t);return i.Vector3.squaredDistance(n,r)},s.prototype._solve=function(e,t){var n=[],i=[.5*(e[0]+e[1]),.5*(t[0]+t[1])],r=this._relaxNR(i,[e,t]),s=r===o.RelaxResult.Success;if(r===o.RelaxResult.OutOfRange){var a=i[0]<e[0]+1e-12||i[0]>e[1]-1e-12,c=i[1]<t[0]+1e-12||i[1]>t[1]-1e-12;(a||c)&&this._distanceSquared(i[0],i[1])<this._epsilon*this._epsilon&&(s=!0)}return s&&n.push(new function(e,t){this.cutInfo=e,this.cutByInfo=t}({param:i[0],atVertex:void 0},{param:i[1],atVertex:void 0})),n},s.prototype._relaxNR=function(e,t){var n=this,r=(0,o.newtonRaphson2D)((function(e){var t=n._cu1.evaluatePosition(e[0]),r=n._cu2.evaluatePosition(e[1]),o=[t[0]-r[0],t[1]-r[1]],s=n._cu1.evaluateDt(e[0]),a=n._cu2.evaluateDt(e[1]);return i.Vector3.negate(a,a),{val:o,deriv1:s,deriv2:a}}),e,t);return e[0]=r.param[0],e[1]=r.param[1],r.status},s.prototype._merge=function(e){e.sort((function(e,t){return e.cutInfo.param-t.cutInfo.param}));for(var t=0;t<e.length;t++)if(e[t])for(var n=e[t].cutInfo.param,i=e[t].cutByInfo.param,r=t+1;r<e.length;r++)if(e[r]){var o=e[r].cutInfo.param,s=e[r].cutByInfo.param;if(o>n+1e-11)break;if(Math.abs(s-i)<=1e-11){e[t]=void 0;break}}for(t=0;t<e.length;t++)e[t]||(e.splice(t,1),t--)},t.CCI=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SubCurveTree=void 0;var i=100*n(0).KERNEL_TOLERANCE,r=Math.PI/180*10,o=function(e,t,n){void 0===n&&(n=0),this._cu=e,this._range=t,this._bx=e.getBoundingBox(t).clone(),this._simple=void 0,this._split_param=void 0,this._children=[],this._depth=n};o.prototype.isSimple=function(){if(void 0===this._simple){this._simple=!1;var e=[this._range[0]+1e-8,this._range[1]-1e-8];if(this._split_param=this._cu.suggestSplittingParam(e),void 0===this._split_param){this._split_param=.5*(this._range[0]+this._range[1]);var t=this._cu.getTangentCone(this._range);(t.isDegenerate()||t.angle<r)&&(this._simple=!0)}}return this._simple},o.prototype.canDivide=function(){return!(this._depth>=10||this._range[1]-this._range[0]<2e-8||Math.max(this._bx.getWidth(0),this._bx.getWidth(1),this._bx.getWidth(2))<i)},o.prototype.divide=function(){if(0===this._children.length){var e=[this._range[0],this._split_param],t=[this._split_param,this._range[1]];this._children=[new o(this._cu,e,this._depth+1),new o(this._cu,t,this._depth+1)]}},o.prototype.fullSubdivision=function(){if(!this.isSimple()&&this.canDivide()){this.divide();for(var e=0;e<this._children.length;++e)this._children[e].fullSubdivision()}},o.prototype.toString=function(){if(this._children.length>0){for(var e="",t=0;t<this._children.length;++t)e+=this._children[t];return e}return"t=["+this._range[0]+" "+this._range[1]+"] "+this._bx+"\n"};var s=function(e,t,n,i,r){this._cu1_root_node=new o(e,t),this._cu2_root_node=new o(n,i),this._epsilon=r,this._overlaps=[]};s.prototype.process=function(e,t){if(e._bx.intersectsWithTolerance(t._bx,this._epsilon)){var n=e.canDivide(),i=t.canDivide(),r=e.isSimple()||!n,o=t.isSimple()||!i;if(r&&o)this._overlaps.push([e,t]);else if(n&&i){e.divide(),t.divide();for(var s=0;s<e._children.length;++s)for(var a=0;a<t._children.length;++a)this.process(e._children[s],t._children[a])}else if(n)for(e.divide(),s=0;s<e._children.length;++s)this.process(e._children[s],t);else if(i)for(t.divide(),s=0;s<t._children.length;++s)this.process(e,t._children[s])}},s.prototype.build=function(){this.process(this._cu1_root_node,this._cu2_root_node)},t.SubCurveTree=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RegionTopologyFace=t.RegionTopologyEdge=t.RegionTopologyVertex=void 0;var i=n(1),r=n(16),o=n(20),s=n(15),a=n(0),c=n(2),u=function(e){return e&&e.__esModule?e:{default:e}}(n(42)),l=function(e){r.Vertex.call(this,e),this._associatedVertices=[]};(l.prototype=Object.create(r.Vertex.prototype)).setAssociatedEntities=function(e){this._associatedVertices=u.default.clone(e)},l.prototype.getAssociatedEntities=function(){return this._associatedVertices};var h=function(e){o.Edge.call(this,e),this._sourceEdge=void 0,this._associatedEdges=[],this._isDangling=!1};(h.prototype=Object.create(o.Edge.prototype)).setAssociatedEdges=function(e){this._associatedEdges=e},h.prototype.getAssociatedEntities=function(){return u.default.map(this._associatedEdges,(function(e){return e.edge}))},h.prototype.getAssociatedEdgeInfo=function(){return this._associatedEdges},h.prototype.setToEdgeSegment=function(e,t){this._sourceEdge=e,this._curve=e.getCurve(),this._reversed=e.isReversed(),this.setRange(t)},h.prototype.setIsDangling=function(e){this._isDangling=e},h.prototype.isDangling=function(){return this._isDangling},h.prototype.getSourceEdge=function(){return this._sourceEdge};var d=function(e){s.Face.call(this,e),this._danglingEdges=[]};(d.prototype=Object.create(s.Face.prototype)).addDanglingEdge=function(e){this._danglingEdges.push(e)},d.prototype.isPointInsideFace=function(e){for(var t=0,n=0;n<this.getLoops().length;++n)for(var i=this.getLoops()[n],r=0;r<i.getCoedges().length;++r){var o=i.getCoedges()[r];o.getEdge().isDangling()||(t+=o.uvAngleSubtended(e))}t=Math.abs(t);var s=Math.floor(t/(2*Math.PI)),c=t-2*s*Math.PI;return!!(Math.abs(c)<a.PARAMETER_SPACE_TOLERANCE&&s||Math.abs(c-2*Math.PI)<a.PARAMETER_SPACE_TOLERANCE)},d.prototype.getRepresentativePoint=function(){var e,t,n=i.Vector3.createFloat64(),r=this.getBoundingBox(),o=(r.max[0]-r.min[0])/33,s=(r.max[1]-r.min[1])/33;for(e=1;e<32;++e)for(t=1;t<32;++t)if(n[0]=r.min[0]+o*e,n[1]=r.min[1]+s*t,this.isPointInsideFace(n))return n;return c.ConsoleUtils.assert(!1),r.getCenter()},d.prototype.getDanglingEdges=function(){return this._danglingEdges},t.RegionTopologyVertex=l,t.RegionTopologyEdge=h,t.RegionTopologyFace=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.matchRegionEdgeRecipe=t.deserializeRegionEdgeRecipe=t.serializeRegionEdgeRecipe=t.createRecipeFromRegionEdge=t.matchRegionFaceRecipe=t.deserializeRegionFaceRecipe=t.serializeRegionFaceRecipe=t.createRecipeFromRegionFace=void 0;var i=n(1),r=n(3),o=n(0),s=n(114),a=n(2),c=n(8),u=function(e){return e&&e.__esModule?e:{default:e}}(n(42)),l=function(e,t){var n=u.default.filter(t.regionVertices,(function(t){return u.default.contains(t.getAssociatedEntities(),e.getStartVertex())}));a.ConsoleUtils.assert(1===n.length),n=n[0];var i=[],r=[],o=new Set,s=n,c=void 0;if(s)do{i.push(s);var l=u.default.filter(s.getEdges(),(function(t){return t!==c&&u.default.contains(t.getAssociatedEntities(),e)&&!o.has(t)}));if(0===l.length){a.ConsoleUtils.assert(!e.isClosed()),a.ConsoleUtils.assert(u.default.contains(s.getAssociatedEntities(),e.getEndVertex()));break}var h=void 0;if(l.length>1){l.sort((function(e,t){return e.t0()-t.t0()}));for(var d=0;d<l.length;d++)if(l[d].getStartVertex()===s){h=l[d];break}a.ConsoleUtils.assert(h)}else h=l[0];s=h.getOtherVertex(s),a.ConsoleUtils.assert(s),c=h,o.add(c),r.push(c)}while(s!==n);return{edges:r,vertices:i}},h=function(e,t,n){var r=[],s=u.default.filter(t,(function(t){return t!==e}));if(0===s.length);else for(var a=n.vertices,c=0;c<a.length;c++){for(var l=a[c],h=!1,d=l.getEdges(),p=0;p<d.length;p++)if(u.default.intersection(s,d[p].getAssociatedEntities()).length>0){h=!0;break}h&&r.push({vertex:l,indexInTopology:c})}if(e.isClosed()&&2===r.length&&1===s.length){var g=!1;if(s[0].getCurveType()===o.GEOMETRY_TYPES.LINE){var f=s[0],v=f.closestToPointParam(r[0].vertex.getPosition());g=f.closestToPointParam(r[1].vertex.getPosition())<v}else if(e.getCurveType()===o.GEOMETRY_TYPES.CIRCLE&&s[0].getCurveType()===o.GEOMETRY_TYPES.CIRCLE){var y=e.getCurve().getCenter(),m=i.Vector3.sub([0,0,0],s[0].getCurve().getCenter(),y);if(i.Vector3.length(m)>0){i.Vector3.normalize(m,m);var _=i.Vector3.sub([0,0,0],r[0].vertex.getPosition(),y),E=i.Vector3.sub([0,0,0],r[1].vertex.getPosition(),y),A=_.x*m.y-_.y*m.x,x=E.x*m.y-E.y*m.x;A>0&&x<0&&(g=!0)}}if(g){var C=r[1];r[1]=r[0],r[0]=C}}return r},d=function(e,t,n,i,r){var o,a={};a[e.getGuid()]={dist:0,prev:null,prevEdge:null,vertex:e,guid:e.getGuid()};var c=new s.BinaryHeap((function(e){return e.dist}),(function(e){return e.guid}));for(c.push(a[e.getGuid()]);0!==c.size();){var l=c.pop();if(l===t)break;o=l.vertex.getEdges();for(var h=0;h<o.length;h++){var d=o[h].getOtherVertex(l.vertex);if(d&&!i[o[h].getGuid()]&&(!n[d.getGuid()]||d===t)){for(var p=o[h].getEndVertex()===d,g=!1,f=o[h].getAssociatedEntities(),v=0;v<r.length;v++)if(u.default.contains(f,r[v].edge)&&r[v].orientation===p){g=!0;break}var y=a[l.guid].dist;g||(y+=1),void 0===a[d.getGuid()]?(a[d.getGuid()]={dist:y,prev:l,prevEdge:o[h],vertex:d,guid:d.getGuid()},c.push(a[d.getGuid()])):a[d.getGuid()].dist>y&&(a[d.getGuid()].dist=y,a[d.getGuid()].prev=l,a[d.getGuid()].prevEdge=o[h],c.updated(a[d.getGuid()]))}}}var m=a[t.getGuid()];if(m){o=[];for(var _=[],E=m,A=t;E.prevEdge;){var x=E.prevEdge;o.push(x),E=E.prev,_.push(x.getEndVertex()===A),A=x.getOtherVertex(A)}return{dist:m.dist,edges:o.reverse(),orientations:_.reverse(),startVertex:e,endVertex:t}}return{dist:1/0,edges:[]}},p=function(e,t,n,i,o,s,a){for(var c=e[o],l={},h=0;h<c.length;h++)null!==c[h].endVertex&&(l[c[h].endVertex.getGuid()]?l[c[h].endVertex.getGuid()].incomingEdges.push({edge:c[h].edge,orientation:c[h].edgeOriented}):l[c[h].endVertex.getGuid()]={edgeIndex:h,edgeInfo:c[h],vertex:c[h].endVertex,incomingEdges:[{edge:c[h].edge,orientation:c[h].edgeOriented}]});if(u.default.values(l).length>0){var p=s.vertices,g=s.edges,f=u.default.keys(l),v={dist:1/0},y=i;do{y=(0,r.modulus)(y-1,e.length);for(var m=u.default.keys(a[y]),_=0;_<m.length;_++){var E=a[y][m[_]].vertex;if(E)for(var A=0;A<f.length;A++){var x=l[f[A]].vertex,C=a[y][m[_]].outgoingEdges.concat(l[f[A]].incomingEdges),w=d(E,x,p,g,C);w.dist<v.dist&&((v=w).startIndex=y)}}}while(y!==t&&v.dist===1/0);if(v.dist<1/0){var b=a[v.startIndex][v.startVertex.getGuid()],M=a[o][v.endVertex.getGuid()],T=b.cost+v.dist;(!M||T<M.cost||o===t&&v.endVertex.getGuid()===n.getGuid()&&null===M.previousGuid)&&(a[o][v.endVertex.getGuid()]={previousGuid:v.startVertex.getGuid(),edgeSegment:null,indexRange:[],cost:b.cost+v.dist,vertex:v.endVertex,previousIndex:v.startIndex,connectionEdges:v.edges,connectionOrientation:v.orientations,outgoingEdges:[]})}}},g=function(e,t,n,i,o){var s=[],a=e[t][n].endVertex;s[t]={},s[t][a.getGuid()]={previousGuid:null,edgeSegment:null,previousIndex:null,cost:0,vertex:a,outgoingEdges:[]};var c=t;do{var l=(0,r.modulus)(c+1,e.length),h=e[l];s[l]=s[l]||{};for(var d=u.default.keys(s[c]),g=0,f=0;f<d.length;f++)for(var v=d[f],y=0;y<h.length;y++)if(h[y].startVertices[v]){s[c][v].outgoingEdges.push({edge:h[y].edge,orientation:h[y].edgeOriented});var m=h[y].endVertex;if(null!==m){var _=s[c][v].cost;h[y].edge.isClosed()||h[y].endVertexTopologyIndex>h[y].startVertices[v].vertexIndex!==h[y].edgeOriented&&(_+=1),(!s[l][m.getGuid()]||s[l][m.getGuid()].cost>_||l===t&&m.getGuid()===a.getGuid()&&null===s[l][m.getGuid()].previousGuid)&&(s[l][m.getGuid()]={previousGuid:v,edgeSegment:h[y],indexRange:[h[y].startVertices[v].vertexIndex,h[y].endVertexTopologyIndex],cost:_,vertex:m,previousIndex:c,outgoingEdges:[]},g++)}else _=s[c][v].cost,(!s[l][v]||s[l][v].cost>_)&&(s[l][v]={previousGuid:v,edgeSegment:h[y],indexRange:[],cost:_,previousIndex:c,outgoingEdges:[]})}0===g&&p(e,t,a,c,l,i,s),c=l}while(c!==t);null!==s[t][a.getGuid()].previousGuid&&s[t][a.getGuid()].cost<o.cost&&(o.cost=s[t][a.getGuid()].cost,o.state=s,o.startGuid=a.getGuid())},f=function(e,t){for(var n=function(e,t){var n={},i={},o={},s=t;do{var a=(0,r.modulus)(s+1,e.length),c=e[s],u=e[a],l=o;o={};for(var h=0;h<u.length;h++){var d=u[h].topologyAlongEdge.vertices,p=u[h].topologyAlongEdge.edges;u[h].startVertices={};var g=void 0,f=void 0,v=c.length;void 0!==l[u[h].edge.getGuid()]&&v++;for(var y=0;y<v;y++){var m=void 0;if(y===c.length)m=l[u[h].edge.getGuid()];else{if(!c[y].endVertex)continue;m=c[y].endVertex.getGuid()}for(var _=void 0,E=0;E<d.length;E++)if(d[E].getGuid()===m){_=E;break}void 0!==_&&(u[h].startVertices[m]={vertex:d[_],vertexIndex:_},null!==u[h].endVertex&&(u[h].edgeOriented?(g=void 0!==g?Math.min(g,_):_,f=void 0!==f?Math.max(f,u[h].endVertexTopologyIndex):u[h].endVertexTopologyIndex):(g=void 0!==g?Math.max(g,_):_,f=void 0!==f?Math.min(f,u[h].endVertexTopologyIndex):u[h].endVertexTopologyIndex)),void 0===o[u[h].edge.getGuid()]&&(o[u[h].edge.getGuid()]=m))}if(void 0!==g&&void 0!==f){if(g!==f){var A;A=u[h].edge.isClosed()?u[h].edgeOriented?1:-1:g<f?1:-1;var x=g;do{if(n[d[x].getGuid()]=d[x],A>0)x!==f&&(i[p[x].getGuid()]=p[x]);else{var C=(0,r.modulus)(x-1,p.length);i[p[C].getGuid()]=p[C]}x=(0,r.modulus)(x+A,d.length)}while(x!==f)}n[d[f].getGuid()]=d[f]}}s=a}while(s!==t);return{vertices:n,edges:i}}(e,t),i={cost:1/0,state:void 0,startGuid:void 0},o=0;o<e[t].length;o++)null!==e[t][o].endVertex&&g(e,t,o,n,i);if(i.cost===1/0)return{edges:void 0,edgeOrientedFlags:void 0,score:1/0};var s=function(e,t){var n=[],i=e.startGuid,o=t;do{n.push(e.state[o][i]);var s=e.state[o][i].previousIndex;i=e.state[o][i].previousGuid,o=s}while(o!==t);n=n.reverse();var a=[],c=[];for(o=0;o<n.length;o++)if(0!==n[o].indexRange.length){var u,l,h,d,p=n[o].edgeSegment.topologyAlongEdge;n[o].indexRange[0]<n[o].indexRange[1]?(u=n[o].indexRange[0],l=n[o].indexRange[1],n[o].edgeSegment.edge.isClosed()&&!n[o].edgeSegment.edgeOriented?(h=-1,u=(0,r.modulus)(n[o].indexRange[0]-1,p.edges.length),l=(0,r.modulus)(n[o].indexRange[1]-1,p.edges.length),d=!1):(h=1,u=(0,r.modulus)(n[o].indexRange[0],p.edges.length),l=(0,r.modulus)(n[o].indexRange[1],p.edges.length),d=!0)):n[o].edgeSegment.edge.isClosed()&&n[o].edgeSegment.edgeOriented?(h=1,u=(0,r.modulus)(n[o].indexRange[0],p.edges.length),l=(0,r.modulus)(n[o].indexRange[1],p.edges.length),d=!0):(h=-1,u=(0,r.modulus)(n[o].indexRange[0]-1,p.edges.length),l=(0,r.modulus)(n[o].indexRange[1]-1,p.edges.length),d=!1);var g=u;do{a.push(p.edges[g]),c.push(d),g=(0,r.modulus)(g+h,p.edges.length)}while(g!==l)}else if(n[o].connectionEdges)for(g=0;g<n[o].connectionEdges.length;g++)a.push(n[o].connectionEdges[g]),c.push(n[o].connectionOrientation[g]);return{topologyEdges:a,edgeOrientedFlags:c}}(i,t);return{edges:s.topologyEdges,edgeOrientedFlags:s.edgeOrientedFlags,score:i.cost}},v=function(e,t){var n,i=function(e,t){for(var n=[],i=0;i<e.length;i++){for(var r=e[i],o=[],s=0;s<r.length;s++){var a=r[s],c=t.sketchEdges[a.edgeRef];c&&o.push({edgeRef:a.edgeRef,edgeOriented:a.edgeOriented,intersectionNumber:a.intersectionNumber,totalIntersections:a.totalIntersections,edge:c,topologyAlongEdge:l(c,t),endVertex:null,endVertexTopologyIndex:null})}n.push(o)}return n}(e,t);if(c.DebugUtils.level("region_match")>=2){var r=u.default.pluck(u.default.flatten(i),"edge");for(n=0;n<r.length;n++)c.DebugUtils.drawEdge3D(r[n],{color:0,render:!1});c.DebugUtils.render()}if(function(e){for(var t=0;t<e.length;t++)for(var n=u.default.pluck(e[(t+1)%e.length],"edge"),i=0;i<e[t].length;i++){var r=e[t][i],o=h(r.edge,n,r.topologyAlongEdge);if(0===r.totalIntersections)r.endVertex=null;else if(o.length===r.totalIntersections){var s=o[r.intersectionNumber];r.endVertexTopologyIndex=s.indexInTopology,r.endVertex=s.vertex}else 0===o.length||c.DebugUtils.warn("Region matching problem! Intersection counts do not match"),r.endVertex=null}}(i),c.DebugUtils.level("region_match")>=2){var o=u.default.pluck(u.default.flatten(i),"endVertex");for(n=0;n<o.length;n++)null!==o[n]&&c.DebugUtils.drawVertex3D(o[n],{color:65280,render:!1});c.DebugUtils.render()}var s=function(e){for(var t=1/0,n=void 0,i=0;i<e.length;i++){var r=e[i];if(0!==r.length){for(var o=0,s=0;s<r.length;s++)null!==r[s].endVertex&&o++;var a=r.length-o;if(0===a)return i;o>0&&a<t&&(t=a,n=i)}}return n}(i);if(void 0===s){for(var a=0;a<i[0].length;a++){var d=i[0][a].edge;if(d.isClosed()&&u.default.all(i,(function(e){for(var t=0;t<e.length;t++)if(e[t].edge===d)return!0;return!1}))){var p=i[0][a].topologyAlongEdge.edges,g=new Array(p.length);for(n=0;n<g.length;n++)g[n]=i[0][a].edgeOriented;return i[0][a].edgeOriented||p.reverse(),c.DebugUtils.level("region_match")>=2&&c.DebugUtils.drawEdge3D(d,{color:16711680}),{edges:p,edgeOrientedFlags:g,matchStatus:2}}}return{edges:void 0,edgeOrientedFlags:void 0,matchStatus:0}}var v,y=f(i,s);if(c.DebugUtils.level("region_match")>=2&&void 0!==y.edges){for(n=0;n<y.edges.length;n++)c.DebugUtils.drawEdge3D(y.edges[n],{color:16711680,render:!1});c.DebugUtils.render()}return v=0===y.score?2:y.score===1/0?0:1,{edges:y.edges,edgeOrientedFlags:y.edgeOrientedFlags,matchStatus:v}},y=function(e,t){if(!e||!e.edges)return new Set;for(var n=new Set,i=0;i<e.edges.length;i++){var r=e.edgeOrientedFlags[i]===t,o=e.edges[i].getCoedges();a.ConsoleUtils.assert(o.length>=1&&o.length<=2);for(var s=void 0,c=0;c<o.length;c++)if(o[c].isReversed()===r){s=o[c].getFace();break}s&&!n.has(s)&&n.add(s)}var u=new Set(e.edges);return n.forEach((function(e){for(var t=Array.from(e.collectEdges()),i=0;i<t.length;i++){var r=t[i];if(!u.has(r)){var o=void 0,s=r.getFaces();a.ConsoleUtils.assert(s.length>=1&&s.length<=2),1===s.length?a.ConsoleUtils.assert(s[0]===e):2===s.length&&(a.ConsoleUtils.assert(s[0]===e||s[1]===e),o=s[0]===e?s[1]:s[0]),o&&!n.has(o)&&n.add(o)}}})),n};t.createRecipeFromRegionFace=function(e,t){for(var n=[],i=e.getLoops(),r=0;r<i.length;r++){for(var o=i[r].getCoedges(),s=[],a=0;a<o.length;a++){for(var c=o[a],d=c.getEdge().getAssociatedEdgeInfo(),p=c.getEndVertex(),g=o[(a+1)%o.length].getEdge().getAssociatedEdgeInfo(),f=u.default.pluck(g,"edge"),v=[],y=0;y<d.length;y++){for(var m=l(d[y].edge,t),_=h(d[y].edge,f,m),E=0,A=0;A<_.length;A++)if(_[A].vertex===p){E=A;break}var x={edgeRef:d[y].edge.getGuid(),edgeOriented:!(c.isReversed()^d[y].flipped),intersectionNumber:E,totalIntersections:_.length,edge:d[y].edge};v.push(x)}s.push(v)}n.push(s)}return n},t.serializeRegionFaceRecipe=function(e){for(var t=[],n=0;n<e.length;n++){for(var i=[],r=e[n],o=0;o<r.length;o++){for(var s=[],a=r[o],c=0;c<a.length;c++){var u=a[c];s.push(u.edgeRef+"_"+(u.edgeOriented?"t":"f")+"_"+u.intersectionNumber+"_"+u.totalIntersections)}i.push(s.join(";"))}t.push(i.join("+"))}return t.join("/")},t.deserializeRegionFaceRecipe=function(e){for(var t=e.split("/"),n=0;n<t.length;n++){t[n]=t[n].split("+");for(var i=t[n],r=0;r<i.length;r++){i[r]=i[r].split(";");for(var o=i[r],s=0;s<o.length;s++){var a=o[s].split("_");o[s]={edgeRef:a[0],edgeOriented:"t"===a[1],intersectionNumber:parseInt(a[2],10),totalIntersections:parseInt(a[3],10)}}}}return t},t.matchRegionFaceRecipe=function(e,t){var n,i,r,o=2,s=[];for(n=0;n<e.length;n++){var a=v(e[n],t);if(0===a.matchStatus&&0===n)return{regions:[],matchStatus:0};2!==a.matchStatus&&(o=1),s.push(a)}if(c.DebugUtils.level("region_match")>0){for(c.DebugUtils.clearView(),r=u.default.values(t.sketchEdges),n=0;n<r.length;n++)c.DebugUtils.drawEdge3D(r[n],{color:0,render:!1});for(n=0;n<s.length;n++)for(i=0;i<s[n].edges.length;i++){var l=0===n?65280:16711680;c.DebugUtils.drawEdge3D(s[n].edges[i],{color:l,render:!1})}c.DebugUtils.render()}var h=y(s[0],!1);for(i=1;i<s.length;i++)y(s[i],!0).forEach((function(e){h.delete(e)}));if(h=Array.from(h),c.DebugUtils.level("region_match")>0){for(n=0;n<h.length;n++)for(r=Array.from(h[n].collectEdges()),i=0;i<r.length;i++)c.DebugUtils.drawEdge3D(r[i],{color:13684736,render:!1});c.DebugUtils.render()}return{regions:h,matchStatus:o}},t.createRecipeFromRegionEdge=function(e,t){var n,i,r={startEdgeRefs:[],endEdgeRefs:[],edgeRef:[],edgeOriented:[],intersectionNumberStart:[],totalIntersectionsStart:[],intersectionNumberEnd:[],totalIntersectionsEnd:[]},o=e.getStartVertex(),s=[];o.getOtherEdges(e).forEach((function(e){var t=u.default.pluck(e.getAssociatedEdgeInfo(),"edge");for(n=0;n<t.length;n++)s.indexOf(t[n])<0&&(s.push(t[n]),r.startEdgeRefs.push(t[n].getGuid()))}));var a=e.getEndVertex(),c=[];a.getOtherEdges(e).forEach((function(e){var t=u.default.pluck(e.getAssociatedEdgeInfo(),"edge");for(n=0;n<t.length;n++)c.indexOf(t[n])<0&&(c.push(t[n]),r.endEdgeRefs.push(t[n].getGuid()))}));var d=e.getAssociatedEdgeInfo(),p=u.default.pluck(d,"edge");for(n=0;n<d.length;n++){var g=p[n],f=!d[n].flipped,v=l(g,t),y=u.default.unique(s.concat(p)),m=h(g,y,v),_=0;for(i=0;i<m.length;i++)if(m[i].vertex===o){_=i;break}var E=u.default.unique(c.concat(p)),A=h(g,E,v),x=0;for(i=0;i<A.length;i++)if(A[i].vertex===a){x=i;break}r.edgeRef.push(g.getGuid()),r.edgeOriented.push(f),r.intersectionNumberStart.push(_),r.totalIntersectionsStart.push(m.length),r.intersectionNumberEnd.push(x),r.totalIntersectionsEnd.push(A.length)}return r},t.serializeRegionEdgeRecipe=function(e){var t={edge:e.edgeRef,orient:e.edgeOriented,start:e.startEdgeRefs,end:e.endEdgeRefs,sIdx:e.intersectionNumberStart,sNum:e.totalIntersectionsStart,eIdx:e.intersectionNumberEnd,eNum:e.totalIntersectionsEnd};return JSON.stringify(t)},t.deserializeRegionEdgeRecipe=function(e){var t=JSON.parse(e);return{edgeRef:t.edge,edgeOriented:t.orient,startEdgeRefs:t.start,endEdgeRefs:t.end,intersectionNumberStart:t.sIdx,totalIntersectionsStart:t.sNum,intersectionNumberEnd:t.eIdx,totalIntersectionsEnd:t.eNum}},t.matchRegionEdgeRecipe=function(e,t){var n=[],i=0,r=[];e.startEdgeRefs.forEach((function(e){var n=t.sketchEdges[e];n&&r.push(n)}));var o=[];e.endEdgeRefs.forEach((function(e){var n=t.sketchEdges[e];n&&o.push(n)})),e.edgeRef.forEach((function(e){var n=t.sketchEdges[e];n&&r.indexOf(n)<0&&r.push(n),n&&o.indexOf(n)<0&&o.push(n)}));for(var s=0;s<e.edgeRef.length;s++){var a=t.sketchEdges[e.edgeRef[s]];if(a){var u=l(a,t),d=void 0,p=void 0,g=h(a,r,u);if(0===e.totalIntersectionsStart[s])d=u.vertices[0],p=0;else if(g.length===e.totalIntersectionsStart[s]){var f=g[e.intersectionNumberStart[s]];d=f.vertex,p=f.indexInTopology}var v=void 0,y=void 0,m=h(a,o,u);if(0===e.totalIntersectionsEnd[s])v=u.vertices[0],y=u.vertices.length;else if(m.length===e.totalIntersectionsEnd[s]){var _=m[e.intersectionNumberEnd[s]];v=_.vertex,0===(y=_.indexInTopology)&&a.isClosed()&&(y=u.vertices.length)}if(!e.edgeOriented[s]){var E=d;d=v,v=E,E=p,p=y,y=E}if(d&&v){if(!(p>=y)){n=u.edges.slice(p,y),i=2;break}c.DebugUtils.warn("Edge recipe match should find start vertex before end vertex")}}}return{edges:n,matchStatus:i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){this.content=[],this.scoreFunction=e,this.lookupFunction=t,this.lookupFunction&&(this.nodeDict={})};i.prototype={push:function(e){this.content.push(e),this.lookupFunction&&(this.nodeDict[this.lookupFunction(e)]=this.content.length-1),this.bubbleUp(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.lookupFunction&&(this.nodeDict[this.lookupFunction(t)]=0),this.sinkDown(0)),this.lookupFunction&&delete this.nodeDict[this.lookupFunction(e)],e},peek:function(){return this.content[0]},getNodeIndex:function(e){if(this.lookupFunction)return this.nodeDict[this.lookupFunction(e)];for(var t=this.content.length,n=0;n<t;n++)if(this.content[n]===e)return n;throw new Error("Node not found.")},updated:function(e){var t=this.getNodeIndex(e),n=this.scoreFunction(e),i=Math.floor((t+1)/2)-1,r=this.content[i];if(t>0&&n<this.scoreFunction(r))this.bubbleUp(t);else{var o=2*(t+1),s=o-1,a=this.content[s],c=this.content[o];(a&&n>this.scoreFunction(a)||c&&n>this.scoreFunction(c))&&this.sinkDown(t)}},remove:function(e){var t=this.content.length,n=this.getNodeIndex(e),i=this.content.pop();n!==t-1&&(this.content[n]=i,this.scoreFunction(i)<this.scoreFunction(e)?this.bubbleUp(n):this.sinkDown(n))},size:function(){return this.content.length},bubbleUp:function(e){for(var t=this.content[e];e>0;){var n=Math.floor((e+1)/2)-1,i=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(i)))break;this.content[n]=t,this.content[e]=i,this.lookupFunction&&(this.nodeDict[this.lookupFunction(t)]=n,this.nodeDict[this.lookupFunction(i)]=e),e=n}},sinkDown:function(e){for(var t=this.content.length,n=this.content[e],i=this.scoreFunction(n);;){var r=2*(e+1),o=r-1,s=null;if(o<t){var a=this.content[o],c=this.scoreFunction(a);c<i&&(s=o)}if(r<t){var u=this.content[r];this.scoreFunction(u)<(null===s?i:c)&&(s=r)}if(null===s)break;this.content[e]=this.content[s],this.content[s]=n,this.lookupFunction&&(this.nodeDict[this.lookupFunction(this.content[e])]=e,this.nodeDict[this.lookupFunction(this.content[s])]=s),e=s}}},t.BinaryHeap=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createBlock=void 0;var i=n(28),r=n(83),o=n(0),s=n(2);t.createBlock=function(e,t){var n=[Math.min(e[0],t[0]),Math.min(e[1],t[1]),Math.min(e[2],t[2])],a=[Math.max(e[0],t[0]),Math.max(e[1],t[1]),Math.max(e[2],t[2])];s.ConsoleUtils.assert(a[0]-n[0]>o.KERNEL_TOLERANCE,"block is degenerate in x axis"),s.ConsoleUtils.assert(a[1]-n[1]>o.KERNEL_TOLERANCE,"block is degenerate in y axis"),s.ConsoleUtils.assert(a[2]-n[2]>o.KERNEL_TOLERANCE,"block is degenerate in z axis");var c=[[n[0],n[1],n[2]],[a[0],n[1],n[2]],[a[0],a[1],n[2]],[n[0],a[1],n[2]]],u=(0,i.createFaceFromPolyline)(c),l=a[2]-n[2];return(0,r.extrudeFace)(u,l)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createCylinder=t.createCone=void 0;var i=n(1),r=n(28),o=n(0),s=n(18),a=n(51),c=n(38),u=n(39),l=n(52),h=n(13),d=n(15),p=n(26),g=n(25),f=n(24),v=n(2),y=function(e,t,n,y,m,_){var E=e,A=t,x=Math.abs(n),C=void 0===_typeof(y)?x:Math.abs(y);if(x<o.KERNEL_TOLERANCE){E=t,A=e;var w=x;x=C,C=w}v.ConsoleUtils.assert(x>o.KERNEL_TOLERANCE);var b=i.Vector3.createFloat64();i.Vector3.subtract(b,A,E);var M=i.Vector3.length(b);v.ConsoleUtils.assert(M>o.KERNEL_TOLERANCE),i.Vector3.scale(b,b,1/M);var T=C-x,V=Math.abs(T)>o.KERNEL_TOLERANCE,S=0;V&&(S=Math.atan2(T,M));var R,L=i.Vector3.createFloat64();_&&i.Vector3.subtract(L,_,i.Vector3.scale(L,b,i.Vector3.dot(_,b))),(!_||i.Vector3.squaredLength(L)<o.KERNEL_TOLERANCE*o.KERNEL_TOLERANCE)&&i.Vector3.computeOrthogonal(L,b),i.Vector3.normalize(L,L),i.Vector3.scale(L,L,x);var P=m||1;v.ConsoleUtils.assert(P>0&&P<=1);var O=Math.max(x,C);Math.abs(O*(1-P))<o.KERNEL_TOLERANCE?V?(R=new a.Cone).set(E,x,b,S,L,1):(R=new c.Cylinder).set(E,x,b,L,1):V?(R=new l.EllipticalCone).set(E,L,P,b,S,1):(R=new u.EllipticalCylinder).set(E,L,P,b,1);var D=[0,M/Math.cos(S)];R.limitRangeU(D);var I=(0,r.makeConeOrCylinderVParamLoop)(R,D[0]),N=(0,r.makeConeOrCylinderVParamLoop)(R,D[1]);I.getCoedges()[0].setReversed(!0);var k=[];k[0]=new d.Face,k[0].setSurface(R),k[0].addLoops([I,N]);var B=I.getCoedges()[0].getEdge();if(B.getCurve()){var F=new h.Loop;F.addCoedge((0,r.createCoedgeOnEdge)(B)),(U=new d.Face).addLoop(F);var j=new s.Plane;j.set(E,b),U.setSurface(j),U.setReversed(!0),k.push(U),v.ConsoleUtils.assert(F.getCoedges()[0].uvAngleSubtended(E)<-o.KERNEL_TOLERANCE)}var z=N.getCoedges()[0].getEdge();if(z.getCurve()){var U,G=new h.Loop;G.addCoedge((0,r.createCoedgeOnEdge)(z)),(U=new d.Face).addLoop(G);var Y=new s.Plane;Y.set(A,b),U.setSurface(Y),k.push(U),v.ConsoleUtils.assert(G.getCoedges()[0].uvAngleSubtended(A)<-o.KERNEL_TOLERANCE)}var W=new p.Shell;W.addFaces(k);var H=new g.Lump;H.addShell(W);var K=new f.Body;return K.addLump(H),K};t.createCone=y,t.createCylinder=function(e,t,n,i,r){return y(e,t,n,n,i,r)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPolyhedron=void 0;var i=n(24),r=n(25),o=n(15),s=n(13),a=n(16),c=n(18),u=n(6),l=n(28),h=n(3),d=n(2),p=n(8);function g(e,t){var n,i=e.getCommonEdges(t);d.ConsoleUtils.assert(i.length<=1),n=0===i.length?(0,l.createLineEdgeBetweenVertices)(e,t):i[0];var r=(0,l.createCoedgeOnEdge)(n);return d.ConsoleUtils.assert(r.getStartVertex()===e),d.ConsoleUtils.assert(r.getEndVertex()===t),r}function f(e,t){var n,i=[];for(n=0;n<t.length;++n)i[n]=e[t[n]];var r=(0,h.definePlaneThroughPoints)(i);if(r){var o=new c.Plane;return o.set(r.origin,r.normal,r.uAxis),o.limitRangeU(r.uRange),o.limitRangeV(r.vRange),o}p.DebugUtils.warn("Face is degenerate")}t.createPolyhedron=function(e,t){var n,c=[];for(n=0;n<e.length;++n){var h=new a.Vertex(new u.Point(e[n]));c.push(h)}var p=[];for(n=0;n<t.length;++n){var v=t[n];d.ConsoleUtils.assert(v.length>=3);for(var y=new s.Loop,m=[],_=0;_<v.length;++_){var E=v[_],A=v[(_+1)%v.length];d.ConsoleUtils.assert(E>=0&&E<e.length),d.ConsoleUtils.assert(A>=0&&A<e.length);var x=g(c[E],c[A]);m.push(x)}y.addCoedges(m);var C=f(e,v),w=new o.Face(C);w.addLoop(y),p.push(w)}var b=(0,l.createShellsFromFaces)(p),M=[];for(n=0;n<b.length;++n)M[n]=new r.Lump,M[n].addShell(b[n]);var T=new i.Body;return T.addLumps(M),T}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TopologyStitcher=void 0;var i=n(1),r=n(119),o=n(41),s=n(2),a=function(){this._shellSet=new Set,this._lumpSet=new Set,this._bodySet=new Set,this._wireSet=new Set,this._progenitorMap=new o.ProgenitorMap};a.prototype.initMerge=function(){this._shellSet.clear(),this._lumpSet.clear(),this._bodySet.clear(),this._wireSet.clear()},a.prototype.getEdgeOwnerToMerge=function(e){var t=e.getWire();if(t)this._wireSet.add(t);else{var n=function(e){var t=e.getCoedge();if(t){var n=t.getFace();if(n)return n.getShell()}}(e);n&&this._shellSet.add(n)}},a.prototype.getVertexOwnerToMerge=function(e){var t=e.getEdges();t.length>0&&this.getEdgeOwnerToMerge(t[0])},a.prototype.stitchVertices=function(e,t){var n;this.initMerge();var i=void 0;for(n=0;n<e.length;++n)if(!t||!t.has(e[n])){i=e[n];break}s.ConsoleUtils.assert(i);var r=[];for(n=0;n<e.length;++n)if(this.getVertexOwnerToMerge(e[n]),e[n]!==i){for(var o=e[n],a=o.getEdges().slice(0),c=0;c<a.length;++c){var u=a[c];u.getStartVertex()===o&&u.setStartVertex(i),u.getEndVertex()===o&&u.setEndVertex(i)}s.ConsoleUtils.assert(0===o.getEdges().length),t&&t.has(o)||r.push(o)}r.length>0&&this._progenitorMap.addEntry(i,r),this.mergeTopology()},a.prototype.stitchEdges=function(e,t){var n,r=e[0];for(n=0;n<e.length;++n)if(!t||!t.has(e[n])){r=e[n];break}var o=[],s=[];for(n=0;n<e.length;++n){var a=e[n],c=!1;if(a.getStartVertex()!==r.getStartVertex()&&a.getStartVertex()===r.getEndVertex()){var u=a.evaluateDt(a.t0()),l=r.evaluateDt(r.t1());i.Vector3.dot(u,l)<0&&(c=!0)}for(var h=a.getCoedge();h;)o.push(h),c&&h.setReversed(!h.isReversed()),(h=h.getPartner())===a.getCoedge()&&(h=void 0);a!==r&&(a.setStartVertex(null),a.setEndVertex(null),s.push(a))}for(this.initMerge(),n=0;n<o.length;++n){var d=o[n];this.getEdgeOwnerToMerge(d.getEdge()),d.setEdge(r);var p=(n+1)%o.length;d.setPartner(o[p])}this.mergeTopology(),this._progenitorMap.addEntry(r,s)},a.prototype.mergeTopology=function(){if(this._shellSet.size>1&&this.mergeShells(),this._wireSet.size>1)throw new Error("Merging wires in TopologyStitcher is not yet supported.")},a.prototype.mergeShells=function(){var e=new o.ProgenitorMap;if(this._shellSet.size>1){var t=Array.from(this._shellSet),n=t[0],i=n.getLump();i&&this._lumpSet.add(i);for(var r=1;r<t.length;++r){var s=t[r];n.addFaces(s.getFaces()),s.setFaces([]),(i=s.getLump())&&(i.removeShell(s),this._lumpSet.add(i))}e.addEntry(n,t.slice(1))}if(this._lumpSet.size>1){var a=Array.from(this._lumpSet),c=a[0],u=c.getBody();for(u&&this._bodySet.add(u),r=1;r<a.length;++r){var l=a[r];c.addShells(l.getShells()),l.setShells([]),(u=l.getBody())&&(u.removeLump(l),this._bodySet.add(u))}e.addEntry(c,a.slice(1))}if(this._bodySet.size>1){var h=Array.from(this._bodySet),d=h[0];for(r=1;r<h.length;++r){for(var p=h[r],g=p.getLumps().slice(0),f=0;f<g.length;++f)g[f].getShells().length>0&&d.addLump(g[f]);p.setLumps([])}e.addEntry(d,h.slice(1))}e.size()>0&&(this._progenitorMap=e.collapseMaps(this._progenitorMap,{keepIntermediates:!0,keepAllDescendants:!0}))},a.prototype.getProgenitorMap=function(){return this._progenitorMap},a.prototype.stitchTwoEdgeSets=function(e,t){var n=new r.MatchFinder;n.setEdges(e,t),n.compute();for(var i=n.getVertexMatches(),o=n.getEdgeMatches(),s=n.getNewVertices(),a=new Set(n.getEdgeProgenitors().getAllNewTopology()),c=0;c<i.length;++c)this.stitchVertices(i[c],s);for(c=0;c<o.length;++c)this.stitchEdges(o[c],a);this._progenitorMap=this._progenitorMap.collapseMaps(n.getEdgeProgenitors(),{keepIntermediates:!1,keepAllDescendants:!0})},a.prototype.stitchTwoTopology=function(e,t){s.ConsoleUtils.assert("function"==typeof e.collectEdges),s.ConsoleUtils.assert("function"==typeof t.collectEdges);var n=e.collectEdges(),i=t.collectEdges();this.stitchTwoEdgeSets(n,i)},a.prototype.stitchEdgeSet=function(e){this.stitchTwoEdgeSets(e,e)},t.TopologyStitcher=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MatchFinder=void 0;var i=n(1),r=n(0),o=n(120),s=n(82),a=n(41),c=n(2),u=function(){this._edges1=[],this._edges2=[],this._verts1=[],this._verts2=[],this._vertexMatchMap=new Map,this._edgeMatchMap=new Map,this._sameEdgeLists=!1,this._newVertices=new Set,this._edgeProgenitors=new a.ProgenitorMap};u.prototype.addMergeToMap=function(e,t,n){var i=n.get(e),r=n.get(t);if(i&&!r)i.push(t),n.set(t,i);else if(!i&&r)r.push(e),n.set(e,r);else if(i||r){if(i&&r&&i!==r)for(var o=0;o<r.length;++o)i.push(r[o]),n.set(r[o],i)}else{var s=[e,t];n.set(e,s),n.set(t,s)}},u.prototype.addVertexMerge=function(e,t){this.addMergeToMap(e,t,this._vertexMatchMap)},u.prototype.addEdgeMerge=function(e,t){this.addMergeToMap(e,t,this._edgeMatchMap)},u.prototype.verticesMatch=function(e,t){var n=Math.max(e.getPrecision(),t.getPrecision(),r.KERNEL_TOLERANCE);return i.Vector3.squaredDistance(e.getPosition(),t.getPosition())<n*n},u.prototype.findEdgeSplitParam=function(e,t){var n=e.getStartVertex();if(n!==t){var o=e.getEndVertex();if(o!==t){var s=this._vertexMatchMap.get(n);if(!s||-1===s.indexOf(t)){var a=this._vertexMatchMap.get(o);if(!a||-1===a.indexOf(t)){var c=t.getPosition(),u=Math.max(t.getPrecision(),r.KERNEL_TOLERANCE),l=e.closestToPointParam(c);if(void 0!==l){var h=e.evaluatePosition(l);if(!(i.Vector3.squaredDistance(c,h)>u*u))return{param:l,position:h}}}}}}},u.prototype.matchVertices=function(){for(var e=new Set,t=0;t<this._edges1.length;++t)this._edges1[t].collectVertices(e);this._verts1=Array.from(e);var n=new Set;for(t=0;t<this._edges2.length;++t)this._edges2[t].collectVertices(n);this._verts2=Array.from(n);var i=this;e.forEach((function(e){n.forEach((function(t){e!==t&&i.verticesMatch(e,t)&&i.addVertexMerge(e,t)}))}))},u.prototype.findVertexOnEdgeSplits=function(e,t){for(var n=t.length,i=0;i<n;++i){for(var r=t[i],o=[],s=0;s<e.length;++s){var a=e[s],c=this.findEdgeSplitParam(r,a);c&&o.push({vertex:a,param:c.param,position:c.position})}if(o.length>0){var u=this.splitEdgeAtParams(r,o);if(u.length>0){t[i]=u[0];for(var l=1;l<u.length;++l)t.push(u[l])}}}},u.prototype.doEdgeSplits=function(){this.findVertexOnEdgeSplits(this._verts1,this._edges2),this._sameEdgeLists||this.findVertexOnEdgeSplits(this._verts2,this._edges1)},u.prototype.splitEdgeAtParams=function(e,t){t.sort((function(e,t){return e.param-t.param}));for(var n=[],s=e,a=0;a<t.length;++a){var c=t[a].vertex,u=t[a].param,l=t[a].position,h=s.getStartVertex().getPosition();if(i.Vector3.squaredDistance(l,h)<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE)this.addVertexMerge(c,s.getStartVertex());else{0===n.length&&(s=(0,o.replaceEdge)(s),n.push(s),this._edgeProgenitors.addEntry(s,[e]));var d=(0,o.splitEdge)(s,u,l);n.push(d),this._edgeProgenitors.addEntry(d,[e]);var p=d.getStartVertex();this.addVertexMerge(c,p),this._newVertices.add(p),s=d}}return n},u.prototype.edgesMatch=function(e,t){return(0,s.edgesAreCoincident)(e,t)},u.prototype.matchEdges=function(){for(var e=0;e<this._edges1.length;++e)for(var t=this._edges1[e],n=t.getStartVertex(),i=t.getEndVertex(),r=0;r<this._edges2.length;++r){var o=this._edges2[r],s=o.getStartVertex(),a=o.getEndVertex();if(!(this._sameEdgeLists&&r<=e)&&t!==o){var c,u=n===s||n===a;if(!u){var l=this._vertexMatchMap.get(n);l&&(u=l===this._vertexMatchMap.get(s)||l===this._vertexMatchMap.get(a))}if(u&&!(c=i===s||i===a)){var h=this._vertexMatchMap.get(i);h&&(c=h===this._vertexMatchMap.get(s)||h===this._vertexMatchMap.get(a))}u&&c&&this.edgesMatch(t,o)&&this.addEdgeMerge(t,o)}}},u.prototype.setEdges=function(e,t){e instanceof Set?this._edges1=Array.from(e):e instanceof Array&&(this._edges1=e),t&&t!==e?t instanceof Set?this._edges2=Array.from(t):t instanceof Array&&(this._edges2=t):this._edges2=this._edges1,this._sameEdgeLists=this._edges1===this._edges2,c.ConsoleUtils.assert(this._edges1&&this._edges2)},u.prototype.compute=function(){this.matchVertices(),this.doEdgeSplits(),this.matchEdges()},u.prototype.getVertexMatches=function(){var e=new Set;return this._vertexMatchMap.forEach((function(t,n){e.add(t)})),Array.from(e)},u.prototype.getEdgeMatches=function(){var e=new Set;return this._edgeMatchMap.forEach((function(t,n){e.add(t)})),Array.from(e)},u.prototype.getNewVertices=function(){return this._newVertices},u.prototype.getEdgeProgenitors=function(){return this._edgeProgenitors},t.MatchFinder=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.replaceEdge=t.splitEdge=void 0;var i=n(16),r=n(20),o=n(27),s=n(6),a=function(e,t){var n=new o.Coedge;n.setEdge(t),e.getEdge().getCoedge()===e&&t.setCoedge(n),n.setReversed(e.isReversed()),n.setLoop(e.getLoop());var i=e.getLoop().getCoedges(),r=i.indexOf(e);return n.isReversed()?i.splice(r,0,n):i.splice((r+1)%i.length,0,n),n};t.splitEdge=function(e,t,n){var o=new i.Vertex(new s.Point(n)),c=[e.getRange()[0],e.getRange()[1]],u=e.getEndVertex();e.setRange([c[0],t]),e.setEndVertex(o);var l=new r.Edge;l.setCurve(e.getCurve()),l.setReversed(e.isReversed()),l.setRange([t,c[1]]),l.setStartVertex(o),l.setEndVertex(u),l.setPrecision(e.getPrecision()),l.setWire(e.getWire());for(var h=[],d=e.getCoedge();d;)h.push(a(d,l)),(d=d.getPartner())===e.getCoedge()&&(d=void 0);for(var p=0;p<h.length;++p){var g=(p+1)%h.length;h[p].setPartner(h[g])}if(l.getWire()){var f=l.getWire().getEdges().slice(),v=f.indexOf(e);f.splice(v+1,0,l),l.getWire().setEdges(f)}return l},t.replaceEdge=function(e){var t=new r.Edge;t.setCurve(e.getCurve()),t.setReversed(e.isReversed()),t.setRange([e.getRange()[0],e.getRange()[1]]),t.setStartVertex(e.getStartVertex()),t.setEndVertex(e.getEndVertex()),t.setPrecision(e.getPrecision()),t.setCoedge(e.getCoedge()),t.setWire(e.getWire()),e.setStartVertex(null),e.setEndVertex(null),e.setCoedge(void 0),e.setWire(void 0);for(var n=t.getCoedge();n;)n.setEdge(t),(n=n.getPartner())===t.getCoedge()&&(n=void 0);if(t.getWire()){var i=t.getWire().getEdges().slice();i[i.indexOf(e)]=t,t.getWire().setEdges(i)}return t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.svgFromWire=void 0;var i=n(0),r=n(2);t.svgFromWire=function(e){e.getTopologyType()===i.TOPOLOGY_TYPES.WIREBODY&&console.warn("svgFromWire: Pass a wire, not a wire body."),r.ConsoleUtils.assert(e.getTopologyType()===i.TOPOLOGY_TYPES.WIRE,"Input topology is not a Wire");var t=e.getOrderedEdges();if(0===t.edges.length)return"";for(var n=t.start,o=n.getPosition(),s="M "+o[0]+" "+o[1],a=0;a<t.edges.length;++a){var c=t.edges[a];o=(n=n===c.getStartVertex()?c.getEndVertex():c.getStartVertex()).getPosition();var u=c.getCurve();if(u)if(u.getGeometryType()===i.GEOMETRY_TYPES.LINE)s+=" L "+o[0]+" "+o[1];else if(u.getGeometryType()!==i.GEOMETRY_TYPES.BCURVE||3!==u.getDegree()||u.isRational())console.warn("Unhandled curve type in svgFromWire");else{for(var l=[],h=u.getBezierSegments(),d=0;d<h.length;d++){var p=h[d];if(p)for(var g=p.getControlPoints(),f=0;f<g.length;f+=3)l.push([g[f],g[f+1]])}n===c.getStartVertex()!==c.isReversed()&&l.reverse(),r.ConsoleUtils.assert(l.length===4*h.length,"Unexpected number of control points");for(var v=0;v<h.length;++v)s+=" C "+l[4*v+1][0]+" "+l[4*v+1][1]+" "+l[4*v+2][0]+" "+l[4*v+2][1]+" ",v===h.length-1?s+=o[0]+" "+o[1]:s+=l[4*v+3][0]+" "+l[4*v+3][1]}}return s}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Path2D=void 0;var i=n(1),r=n(0),o=n(54),s=n(40),a=n(33),c=n(14),u=n(23),l=n(7),h=n(28),d=n(84),p=n(2),g=n(8),f={assert:function(e,t){if(!e)throw{message:t||"assertion failed"}},assert_arg:function(e,t,n,i){var r="Invalid argument '"+t+"': "+n+"\nUsage: "+i;this.assert(e,r)},assert_number:function(e,t,n){this.assert_arg("number"==typeof e,t,"should be a number",n)},assert_boolean:function(e,t,n){this.assert_arg("boolean"==typeof e,t,"should be a boolean",n)},assert_string:function(e,t,n){this.assert_arg("string"==typeof e,t,"should be a string",n)}},v=function(){this._wireBody=new o.WireBody,this._curves=[],this._xy=[0,0],this._mergeBCurves=!0,this._healPath=!1,this._tangentTol=r.KERNEL_ANGULAR_TOLERANCE};function y(e,t,n){var r=3*(t-1),o=[e[r],e[r+1],e[r+2]],s=3*n,a=[e[s],e[s+1],e[s+2]],c=i.Vector3.sub([0,0,0],a,o);i.Vector3.scale(c,c,-.1);for(var u=1;u<=n-t;++u){var l=i.Vector3.scaleAndAdd([0,0,0],a,c,u);e[s-3*u]=l[0],e[s-3*u+1]=l[1],e[s-3*u+2]=l[2]}}function m(e,t,n){var r=3*t,o=[e[r],e[r+1],e[r+2]],s=3*(n+1),a=[e[s],e[s+1],e[s+2]],c=i.Vector3.sub([0,0,0],a,o);i.Vector3.scale(c,c,.1);for(var u=1;u<=n-t;++u){var l=i.Vector3.scaleAndAdd([0,0,0],o,c,u);e[r+3*u]=l[0],e[r+3*u+1]=l[1],e[r+3*u+2]=l[2]}}function _(e,t){for(var n,r,o,s=[],a=e.getControlPoints(),c=[a[0],a[1],a[2]],u=a.length/3,l=1;l<u;++l){n=[a[3*l],a[3*l+1],a[3*l+2]];var h=l===u-1;i.Vector3.squaredDistance(c,n)<t?(void 0===r&&(r=l-1),o=l):h=!0,h&&void 0!==r&&void 0!==o&&(s.push([r,o]),h=!1,r=void 0,o=void 0),c=n}return s}function E(e,t){var n=_(e,t);if(1===n.length&&n[0][1]-n[0][0]==1){var i=n[0];0===i[0]?e.addControlPointOnCurve(e.evaluatePosition(.1)):i[1]===e.getNumControlPoints()-1?e.addControlPointOnCurve(e.evaluatePosition(.9)):(e.addControlPointOnCurve(e.evaluatePosition(.45)),e.addControlPointOnCurve(e.evaluatePosition(.55)))}return n.length>0}function A(e,t){for(var n=_(e,t),i=0;i<n.length;++i){var r=n[i],o=e.getControlPoints().slice();r[0]>0?y(o,r[0],r[1]):r[1]<o.length/3-1?m(o,r[0],r[1]):g.DebugUtils.warn("Degenerate BCurve!"),e.setControlPoints(o)}}function x(e,t){var n=e.getControlPoints(),r=[n[0],n[1],n[2]],o=[n[3],n[4],n[5]],s=i.Vector3.distance(r,o);n[3]=r[0]+t[0]*s,n[4]=r[1]+t[1]*s,n[5]=r[2]+t[2]*s,e.setControlPoints(n)}function C(e,t){var n=e.getControlPoints(),r=e.getControlPoints().length,o=[n[r-6],n[r-5],n[r-4]],s=[n[r-3],n[r-2],n[r-1]],a=i.Vector3.distance(o,s);n[r-6]=s[0]-t[0]*a,n[r-5]=s[1]-t[1]*a,n[r-4]=s[2]-t[2]*a,e.setControlPoints(n)}function w(e){var t=new a.BCurve,n=e.getRange(),r=e.evaluatePosition(n[0]),o=e.evaluatePosition(n[1]),s=i.Vector3.lerp([0,0,0],r,o,1/3),c=i.Vector3.lerp([0,0,0],r,o,2/3),u=[r[0],r[1],0,s[0],s[1],0,c[0],c[1],0,o[0],o[1],0];return t.set(u,[1,1,1,1],3,[0,0,0,0,1,1,1,1]),t}function b(e,t){for(var n,r=e.getRange(),o=e.evaluatePosition(r[0]),s=e.evaluatePosition(r[1]),a=i.Vector3.distance(o,s),c=0,u=t.getControlPoints(),l=[u[0],u[1],u[2]],h=u.length/3,d=1;d<h;++d)n=[u[3*d],u[3*d+1],u[3*d+2]],c+=i.Vector3.distance(l,n),l=n;return a<c}function M(e,t){var n=e.getControlPoints().concat(t.getControlPoints().slice(3)),r=e.getWeights().concat(t.getWeights().slice(1)),o=e.getKnotVector().slice(0,-1),s=e.evaluateDt(e.getRange()[1]),a=t.evaluateDt(t.getRange()[0]),c=Math.sqrt(i.Vector3.squaredLength(a)/i.Vector3.squaredLength(s)),u=o[o.length-1]-t.getKnotVector()[0]*c,l=t.getKnotVector().slice(t.getDegree()+1);return l=l.map((function(e){return e*c+u})),o=o.concat(l),e.set(n,r,3,o),e}function T(e,t,n,o,s){var a=i.Vector2.subtract([],s,e),u=i.Vector2.length(a);if(!(u<r.KERNEL_TOLERANCE)){u>2*t&&(t=u/2);var l=i.Vector2.scaleAndAdd([],e,a,.5);if(u<2*t-i.FLOAT64_TOLERANCE){var h=Math.sqrt(t*t-u*u/4);!0===o!=(!1===n)&&(h=-h);var d=i.Vector2.normalize([],[-a[1],a[0]]);i.Vector2.scaleAndAdd(l,l,d,h)}var p=[0,0,o?1:-1],g=new c.Circle;g.set([l[0],l[1],0],p,[t,0,0]);var f=g.closestToPointParam([e[0],e[1],0]),v=g.closestToPointParam([s[0],s[1],0]);return v<=f&&(v+=2*Math.PI),g.limitRange([f,v]),g}}function V(e,t){var n=e.slice(1);n=n.replace(/([^e])-/g,"$1 -");for(var i=0;i<2;++i)n=n.replace(/\.[0-9]*\./g,(function(e){return e.slice(0,-1)+" ."}));for(var r=n.split(/[,\s]/),o=[],s=0;s<r.length;++s)if(r[s].length>0){var a=Number(r[s]);t(!isNaN(a),"could not parse command"),o.push(a)}return o}v.prototype.numWires=function(){var e=this._wireBody.getWires().length;return this._curves.length>0&&(e+=1),e},v.prototype.numClosed=function(){for(var e=0,t=0;t<this._wireBody.getWires().length;++t)this._wireBody.getWires()[t].isClosed()&&(e+=1);return this._areCurvesClosed()&&(e+=1),e},v.prototype._fixCoincidentControlPoints=function(){for(var e=r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE,t=0;t<this._curves.length;++t){var n=this._curves[t];n.getGeometryType()===r.GEOMETRY_TYPES.BCURVE&&3===n.getDegree()&&4===n.getNumControlPoints()&&!1===n.isRational()&&E(n,e)&&A(n,e)}},v.prototype._snapBCurvesTangent=function(){for(var e=0;e<this._curves.length;++e){var t=(e+1)%this._curves.length;if(0===t&&!this._areCurvesClosed())break;var n=this._curves[e],o=this._curves[t],s=n.evaluateDt(n.getRange()[1]),a=o.evaluateDt(o.getRange()[0]);i.Vector3.isParallel(s,a,1,this._tangentTol)&&(n.getGeometryType()!==r.GEOMETRY_TYPES.BCURVE&&o.getGeometryType()===r.GEOMETRY_TYPES.BCURVE?(i.Vector3.normalize(s,s),x(o,s)):n.getGeometryType()===r.GEOMETRY_TYPES.BCURVE&&o.getGeometryType()!==r.GEOMETRY_TYPES.BCURVE&&(i.Vector3.normalize(a,a),C(n,a)))}},v.prototype._areCurvesClosed=function(){if(0===this._curves.length)return!1;var e=this._curves[this._curves.length-1],t=this._curves[0];return i.Vector3.squaredDistance(e.evaluatePosition(e.getRange()[1]),t.evaluatePosition(t.getRange()[0]))<r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE},v.prototype._mergeShortLinesWithBCurves=function(){for(var e=!1,t=0;t<this._curves.length;++t){var n=(t+1)%this._curves.length;if(0===n&&!this._areCurvesClosed())break;var o=this._curves[t],s=this._curves[n],a=o.evaluateDt(o.getRange()[1]),c=s.evaluateDt(s.getRange()[0]);i.Vector3.isParallel(a,c,1,r.KERNEL_ANGULAR_TOLERANCE)&&(o.getGeometryType()===r.GEOMETRY_TYPES.LINE&&s.getGeometryType()===r.GEOMETRY_TYPES.BCURVE&&b(o,s)?(this._curves.splice(t,1,M(w(o),s)),this._curves.splice(n,1),t-=1,e=!0):o.getGeometryType()===r.GEOMETRY_TYPES.BCURVE&&s.getGeometryType()===r.GEOMETRY_TYPES.LINE&&b(s,o)&&(this._curves.splice(t,1,M(o,w(s))),this._curves.splice(n,1),t-=1,e=!0))}return e},v.prototype._mergeAdjacentBCurves=function(){for(var e=0;e<this._curves.length;++e){var t=(e+1)%this._curves.length;if(0===t&&!this._areCurvesClosed())break;var n=this._curves[e],o=this._curves[t],s=n.evaluateDt(n.getRange()[1]),a=o.evaluateDt(o.getRange()[0]);i.Vector3.isParallel(s,a,1,this._tangentTol)&&n.getGeometryType()===r.GEOMETRY_TYPES.BCURVE&&o.getGeometryType()===r.GEOMETRY_TYPES.BCURVE&&(i.Vector3.squaredLength(s)<i.Vector3.squaredLength(a)?(i.Vector3.normalize(s,s),x(o,s)):(i.Vector3.normalize(a,a),C(n,a)),n!==o&&(M(n,o),this._curves.splice(t,1),e-=1))}},v.prototype.setMergeBCurves=function(e){this._mergeBCurves=e},v.prototype.setHealForASM=function(e,t){this._healPath=e,this._tangentTol=void 0!==t?t:.01745240643728351},v.prototype._addWire=function(){if(0!==this._curves.length){this._healPath&&(this._fixCoincidentControlPoints(),this._snapBCurvesTangent()),(this._mergeBCurves||this._healPath)&&this._mergeAdjacentBCurves(),this._healPath&&this._mergeShortLinesWithBCurves()&&this._mergeAdjacentBCurves();var e=(0,h.createWiresFromEdges)((0,h.createEdgesFromCurves)(this._curves));p.ConsoleUtils.assert(1===e.length),this._wireBody.addWire(e[0]),this._curves=[]}},v.prototype._discardIfOpen=function(){if(0!==this._curves.length){var e=this._curves[0].evaluatePosition(this._curves[0].getRange()[0]),t=[this._xy[0],this._xy[1],0];i.Vector3.squaredDistance(e,t)>=r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE&&(this._curves=[])}},v.prototype.moveTo=function(e,t){var n="Path2D.moveTo(x, y)";return f.assert_number(e,"x",n),f.assert_number(t,"y",n),this._addWire(),this._xy[0]=e,this._xy[1]=t,this},v.prototype.lineTo=function(e,t){var n="Path2D.lineTo(x, y)";f.assert_number(e,"x",n),f.assert_number(t,"y",n);var i=e-this._xy[0],o=t-this._xy[1];if(i*i+o*o>r.KERNEL_TOLERANCE*r.KERNEL_TOLERANCE){var s=new l.Line;s.set([this._xy[0],this._xy[1],0],[i,o,0]),s.limitRange([0,1]),this._curves.push(s)}return this._xy[0]=e,this._xy[1]=t,this},v.prototype.quadraticCurveTo=function(e,t,n,i){var r="Path2D.quadraticCurveTo(cpx, cpy, x, y)";f.assert_number(e,"cpx",r),f.assert_number(t,"cpy",r),f.assert_number(n,"x",r),f.assert_number(i,"y",r);var o=new a.BCurve,s=1/3*this._xy[0]+2/3*e,c=1/3*this._xy[1]+2/3*t,u=1/3*n+2/3*e,l=1/3*i+2/3*t,h=[this._xy[0],this._xy[1],0,s,c,0,u,l,0,n,i,0];return o.set(h,[1,1,1,1],3,[0,0,0,0,1,1,1,1]),this._curves.push(o),this._xy[0]=n,this._xy[1]=i,this},v.prototype.bezierCurveTo=function(e,t,n,i,r,o){var s="Path2D.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y)";f.assert_number(e,"cp1x",s),f.assert_number(t,"cp1y",s),f.assert_number(n,"cp2x",s),f.assert_number(i,"cp2y",s),f.assert_number(r,"x",s),f.assert_number(o,"y",s);var c=new a.BCurve,u=[this._xy[0],this._xy[1],0,e,t,0,n,i,0,r,o,0];return c.set(u,[1,1,1,1],3,[0,0,0,0,1,1,1,1]),this._curves.push(c),this._xy[0]=r,this._xy[1]=o,this},v.prototype.circleArcTo=function(e,t,n,i,r){var o="Path2D.circleArcTo(radius, longest, anticlockwise, x, y)";f.assert_number(e,"radius",o),f.assert_arg(e>0,"radius","must be positive",o),f.assert_boolean(t,"longest",o),f.assert_boolean(n,"anticlockwise",o),f.assert_number(i,"x",o),f.assert_number(r,"y",o);var s=T(this._xy,e,t,n,[i,r]);return s&&(this._curves.push(s),this._xy[0]=i,this._xy[1]=r),this},v.prototype.ellipseArcTo=function(e,t,n,r,o,s,a){var c="Path2D.ellipseArcTo(xRadius, yRadius, rotation, longest, anticlockwise, x, y)";if(f.assert_number(e,"xRadius",c),f.assert_arg(e>0,"xRadius","must be positive",c),f.assert_number(t,"yRadius",c),f.assert_arg(t>0,"yRadius","must be positive",c),f.assert_number(n,"rotation",c),f.assert_boolean(r,"longest",c),f.assert_boolean(o,"anticlockwise",c),f.assert_number(s,"x",c),f.assert_number(a,"y",c),e<t){var l=e;e=t,t=l,n+=Math.PI/2}var h=Math.cos(n),d=Math.sin(n),p=e/t,g=i.Matrix22.multiply([],[1,0,0,p],[h,-d,d,h]),v=T(i.Vector2.transformMatrix22([],this._xy,g),e,r,o,i.Vector2.transformMatrix22([],[s,a],g));if(v){var y=[v.getCenter()[0],v.getCenter()[1]];i.Matrix22.invert(g,g),i.Vector2.transformMatrix22(y,y,g),y[2]=0;var m=v.getRadius(),_=[m*h,m*d,0],E=new u.Ellipse;E.set(y,v.getNormal(),_,1/p),E.limitRange(v.getRange()),this._curves.push(E),this._xy[0]=s,this._xy[1]=a}return this},v.prototype.closePath=function(){if(this._curves.length>0){var e=this._curves[0],t=e.evaluatePosition(e.getRange()[0]);this.lineTo(t[0],t[1]),this._addWire()}return this},v.prototype.addCircle=function(e,t,n){var i="Path2D.addCircle(x, y, radius)";f.assert_number(e,"x",i),f.assert_number(t,"y",i),f.assert_number(n,"radius",i),f.assert_arg(n>0,"radius","must be positive",i),this._addWire();var r=new c.Circle;return r.set([e,t,0],[0,0,1],[n,0,0]),this._curves.push(r),this._addWire(),this},v.prototype.addEllipse=function(e,t,n,i,r){r=void 0===r?0:r;var o="Path2D.addEllipse(x, y, xRadius, yRadius, rotation)";if(f.assert_number(e,"x",o),f.assert_number(t,"y",o),f.assert_number(n,"xRadius",o),f.assert_arg(n>0,"xRadius","must be positive",o),f.assert_number(i,"yRadius",o),f.assert_arg(i>0,"yRadius","must be positive",o),f.assert_number(r,"rotation",o),this._addWire(),n<i){var s=n;n=i,i=s,r+=Math.PI/2}var a=new u.Ellipse,c=Math.cos(r),l=Math.sin(r),h=i/n;return a.set([e,t,0],[0,0,1],[n*c,n*l,0],h),this._curves.push(a),this._addWire(),this},v.prototype.addSVGPath=function(e,t){t=void 0!==t&&t;var n="Path2D.addSVGPath(pathString, [includeOpen])";f.assert_string(e,"pathString",n),f.assert_boolean(t,"includeOpen",n),this._addWire(),this._xy[0]=0,this._xy[1]=0;var i=function(e){for(var t=[];e.length>0;){var n=e.slice(1).search(/[MmZzLlHhVvCcSsQqTtAa]/)+1;n<=0&&(n=e.length);var i=e.slice(0,n).trim();i.length>0&&t.push(i),e=e.slice(n).trim()}return t}(e);f.assert_arg(i.length>0,"pathString","cannot be empty string",n);for(var o=[this._xy[0],this._xy[1]],s=[this._xy[0],this._xy[1]],a=0;a<i.length;++a){var c,u,l,h,d,p,g,v=function(e,t){f.assert_arg(e,"pathString",t+' "'+i[a]+'"',n)},y=i[a].charAt(0).toUpperCase(),m=y!==i[a].charAt(0),_=V(i[a],v),E=m?this._xy:[0,0];switch(y){case"M":for(v(_.length>=2,"insufficient arguments in command"),v(_.length%2==0,"command requires pairs of x,y arguments"),t||this._discardIfOpen(),this.moveTo(_[0]+E[0],_[1]+E[1]),g=2;g<_.length;g+=2)this.lineTo(_[g]+E[0],_[g+1]+E[1]);break;case"Z":v(0===_.length,"command should not have arguments"),this.closePath();break;case"L":for(v(_.length>=2,"insufficient arguments in command"),v(_.length%2==0,"command requires pairs of x,y arguments"),g=0;g<_.length;g+=2)this.lineTo(_[g]+E[0],_[g+1]+E[1]);break;case"H":for(v(_.length>=1,"insufficient arguments in command"),g=0;g<_.length;g+=1)this.lineTo(_[g]+E[0],this._xy[1]);break;case"V":for(v(_.length>=1,"insufficient arguments in command"),g=0;g<_.length;g+=1)this.lineTo(this._xy[0],_[g]+E[1]);break;case"C":for(v(_.length>=6,"insufficient arguments in command"),v(_.length%6==0,"command requires sets of 6 arguments"),g=0;g<_.length;g+=6)c=_[g]+E[0],u=_[g+1]+E[1],l=_[g+2]+E[0],h=_[g+3]+E[1],d=_[g+4]+E[0],p=_[g+5]+E[1],this.bezierCurveTo(c,u,l,h,d,p),s[0]=l,s[1]=h;break;case"S":for(v(_.length>=4,"insufficient arguments in command"),v(_.length%4==0,"command requires sets of 4 arguments"),g=0;g<_.length;g+=4)c=2*this._xy[0]-s[0],u=2*this._xy[1]-s[1],l=_[g]+E[0],h=_[g+1]+E[1],d=_[g+2]+E[0],p=_[g+3]+E[1],this.bezierCurveTo(c,u,l,h,d,p),s[0]=l,s[1]=h;break;case"Q":for(v(_.length>=4,"insufficient arguments in command"),v(_.length%4==0,"command requires sets of 4 arguments"),g=0;g<_.length;g+=4)c=_[g]+E[0],u=_[g+1]+E[1],l=_[g+2]+E[0],h=_[g+3]+E[1],this.quadraticCurveTo(c,u,l,h),o[0]=c,o[1]=u;break;case"T":for(v(_.length>=2,"insufficient arguments in command"),v(_.length%2==0,"command requires pairs of arguments"),g=0;g<_.length;g+=2)c=2*this._xy[0]-o[0],u=2*this._xy[1]-o[1],l=_[g]+E[0],h=_[g+1]+E[1],this.quadraticCurveTo(c,u,l,h),o[0]=c,o[1]=u;break;case"A":for(v(_.length>=7,"insufficient arguments in command"),v(_.length%7==0,"command requires sets of 7 arguments"),g=0;g<_.length;g+=7){var A=Math.abs(_[g]),x=Math.abs(_[g+1]),C=_[g+2]*Math.PI/180,w=0!==_[g+3],b=0!==_[g+4],M=_[g+5]+E[0],T=_[g+6]+E[1];A<r.KERNEL_TOLERANCE||x<r.KERNEL_TOLERANCE?this.lineTo(M,T):this.ellipseArcTo(A,x,C,w,b,M,T)}break;default:v(!1,"unrecognised command")}"Q"!==y&&"T"!==y&&(o=[this._xy[0],this._xy[1]]),"C"!==y&&"S"!==y&&(s=[this._xy[0],this._xy[1]])}return t||this._discardIfOpen(),this._addWire(),this},v.prototype.getWireBody=function(){return this._addWire(),this._wireBody},v.prototype.computeRegionizedWireBody=function(){this.getWireBody();for(var e=new o.WireBody,t=(0,d.mergeSketchRegions)(this._wireBody.getWires()),n=0;n<t.length;++n)for(var i=t[n].getLoops(),r=0;r<i.length;++r){var a=i[r],c=new s.Wire;c.addEdges(Array.from(a.collectEdges())),e.addWire(c)}return e},v.prototype.reset=function(){this._wireBody=new o.WireBody,this._curves=[],this._xy=[0,0]},t.Path2D=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SolidDefLoader=t.getTopologyRank=void 0;var i=n(6),r=n(7),o=n(14),s=n(23),a=n(33),c=n(18),u=n(38),l=n(39),h=n(74),d=n(51),p=n(52),g=n(75),f=n(53),v=n(24),y=n(25),m=n(26),_=n(15),E=n(13),A=n(27),x=n(20),C=n(16),w=n(54),b=n(40),M=n(79),T=n(0),V=n(85),S=n(124),R=n(125),L=n(45),P=function(){var e={};return e[T.TOPOLOGY_TYPES.BODY]=10,e[T.TOPOLOGY_TYPES.WIREBODY]=9,e[T.TOPOLOGY_TYPES.LUMP]=8,e[T.TOPOLOGY_TYPES.SHELL]=7,e[T.TOPOLOGY_TYPES.FACE]=6,e[T.TOPOLOGY_TYPES.WIRE]=5,e[T.TOPOLOGY_TYPES.LOOP]=4,e[T.TOPOLOGY_TYPES.COEDGE]=3,e[T.TOPOLOGY_TYPES.EDGE]=2,e[T.TOPOLOGY_TYPES.VERTEX]=1,function(t){var n=void 0;return"function"==typeof t.getTopologyType&&(n=e[t.getTopologyType()]),n||0}}(),O=function(){this._runTimeMap=new Map,this._typeidToFuncMap={},this.addLoader("body",S.TopologySetters.setBodyData,v.Body),this.addLoader("wirebody",S.TopologySetters.setWireBodyData,w.WireBody),this.addLoader("wire",S.TopologySetters.setWireData,b.Wire),this.addLoader("lump",S.TopologySetters.setLumpData,y.Lump),this.addLoader("shell",S.TopologySetters.setShellData,m.Shell),this.addLoader("face",S.TopologySetters.setFaceData,_.Face),this.addLoader("loop",S.TopologySetters.setLoopData,E.Loop),this.addLoader("coedge",S.TopologySetters.setCoedgeData,A.Coedge),this.addLoader("edge",S.TopologySetters.setEdgeData,x.Edge),this.addLoader("vertex",S.TopologySetters.setVertexData,C.Vertex),this.addLoader("point",V.GeometrySetters.setPointFromProperty,i.Point),this.addLoader("line",V.GeometrySetters.setLineFromProperty,r.Line),this.addLoader("circle",V.GeometrySetters.setCircleFromProperty,o.Circle),this.addLoader("ellipse",V.GeometrySetters.setEllipseFromProperty,s.Ellipse),this.addLoader("bcurve",V.GeometrySetters.setBCurveFromProperty,a.BCurve),this.addLoader("plane",V.GeometrySetters.setPlaneFromProperty,c.Plane),this.addLoader("sphere",V.GeometrySetters.setSphereFromProperty,h.Sphere),this.addLoader("torus",V.GeometrySetters.setTorusFromProperty,g.Torus),this.addLoader("cylinder",V.GeometrySetters.setCylinderFromProperty,u.Cylinder),this.addLoader("cone",V.GeometrySetters.setConeFromProperty,d.Cone),this.addLoader("ellipticalcylinder",V.GeometrySetters.setEllipticalCylinderFromProperty,l.EllipticalCylinder),this.addLoader("ellipticalcone",V.GeometrySetters.setEllipticalConeFromProperty,p.EllipticalCone),this.addLoader("bsurface",V.GeometrySetters.setBSurfaceFromProperty,f.BSurface),this.addLoader("nmiattributestr",R.AttributeSetters.setNMIAttributeStr,M.Attribute),this.addLoader("nmiattributearr",R.AttributeSetters.setNMIAttributeArr,M.Attribute),this.addLoader("textattribute",R.AttributeSetters.setTextAttribute,M.Attribute)};O.prototype.addLoader=function(e,t,n){this._typeidToFuncMap[e]=[t,n]},O.prototype._reset=function(){this._runTimeMap.clear()},O.prototype.getDataSettingFunction=function(e){var t=this._typeidToFuncMap[e];if(t)return t[0]},O.prototype.createRunTimeObject=function(e){var t=this.getTypeContructor(e);if(t)return new t},O.prototype.getTypeContructor=function(e){var t=this._typeidToFuncMap[e];if(t&&2===t.length)return t[1]},O.prototype.setObjectProperties=function(e,t,n){var i=this.getDataSettingFunction(e,n),r=this;"function"==typeof i&&i(t,n,(function(e){if(e){var t=e;return t?r._runTimeMap.get(t):void 0}}))},O.prototype.makeGeometryObjectsProto=function(e){var t=this;Object.keys(e).forEach((function(n){var i=e[n],r=i[i.geometry],o=t.createRunTimeObject(i.geometry);o&&(t._runTimeMap.set(n,o),t.setObjectProperties(i.geometry,o,r),o.setGuid(n))}))},O.prototype.makeGeometryObject=function(e){var t=e.getTypeid(),n=this.createRunTimeObject(t);return n?this.setObjectProperties(t,n,e):console.error("No constructor"),n},O.prototype.makeTopologyObject=function(e){var t=e.getTypeid(),n=this.createRunTimeObject(t);return n||console.error("No constructor"),n},O.prototype.makeAttributeObjectsProto=function(e){var t=this;Object.keys(e).forEach((function(n){var i=e[n],r=i[i.attribute],o=new M.Attribute;t._runTimeMap.set(n,o),t.setObjectProperties(i.attribute,o,r),o.setGuid(n)}))},O.prototype.makeTopologyObjectsProto=function(e){var t=this,n=[];Object.keys(e).forEach((function(i){var r=e[i],o=r[r.topology],s=t.createRunTimeObject(r.topology);s&&(t._runTimeMap.set(i,s),n.push({type:r.topology,obj:s,prop:o}),s.setGuid(i))}));for(var i=0;i<n.length;++i)this.setObjectProperties(n[i].type,n[i].obj,n[i].prop)},O.prototype._collectGeometries=function(e){this._runTimeMap.forEach((function(t){void 0!==t.getGeometryType&&e.set(t.getGuid(),t)}))},O.prototype._collectTopologies=function(e){this._runTimeMap.forEach((function(t){void 0!==t.getTopologyType&&e.set(t.getGuid(),t)}))},O.prototype.loadModelPSet=function(e,t,n){var i=e.get("geometries");if(i){var r=e.get("attributes"),o=e.get("topologies");if(o)return this.makeGeometryObjects(i),r&&this.makeAttributeObjects(r),this.makeTopologyObjects(o),this.getHighestObject(t,n)}},O.prototype.getHighestObject=function(e,t){var n=void 0,i=0;return this._runTimeMap.forEach((function(e){if(10!==i){var t=P(e);t>i&&t>0&&(i=t,n=e)}})),e&&this._collectGeometries(e),t&&this._collectTopologies(t),this._reset(),n},O.prototype.loadModelProtoMessage=function(e,t,n){var i=e.geometries;if(i){var r=e.attributes,o=e.topologies;return o?(this.makeGeometryObjectsProto(i),r&&this.makeAttributeObjectsProto(r),this.makeTopologyObjectsProto(o),this.getHighestObject(t,n)):void 0}},O.prototype.loadProtoBinary=function(e,t,n){var i=e;i instanceof ArrayBuffer&&(i=new Uint8Array(i));var r=L.Autodesk.lookupType("SolidDef.model_1_0_0").decode(i);return this.loadModelProtoMessage(r,t,n)},t.getTopologyRank=P,t.SolidDefLoader=O},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TopologySetters=void 0;var i=n(85),r={},o=function(e,t,n){var i=t.attributes;if(i){e.removeAllAttributes();for(var r=0;r<i.length;++r){var o=n(i[r]);e.addAttribute(o)}}};r.setBodyData=function(e,t,n){for(var i=t.lumps,r=new Array(i.length),s=0;s<i.length;++s){var a=i[s];r[s]=n(a),r[s].setBody(e)}e.setLumps(r),o(e,t,n)},r.setLumpData=function(e,t,n){for(var i=t.shells,r=new Array(i.length),s=0;s<i.length;++s){var a=i[s];r[s]=n(a),r[s].setLump(e)}e.setShells(r),o(e,t,n)},r.setShellData=function(e,t,n){for(var i=t.faces,r=new Array(i.length),s=0;s<i.length;++s){var a=i[s];r[s]=n(a),r[s].setShell(e)}e.setFaces(r),o(e,t,n)},r.setFaceData=function(e,t,n){for(var i=t.loops,r=new Array(i.length),s=0;s<i.length;++s){var a=i[s];r[s]=n(a),r[s].setFace(e)}e.setLoops(r),e.setReversed(t.reversed),e.setSurface(n(t.geometry)),o(e,t,n)},r.setLoopData=function(e,t,n){for(var i=t.coedges,r=new Array(i.length),s=0;s<i.length;++s){var a=i[s];r[s]=n(a),r[s].setLoop(e)}e.setCoedges(r),o(e,t,n)},r.setCoedgeData=function(e,t,n){e.setEdge(n(t.edge)),e.setReversed(t.reversed),e.setPartner(n(t.partner)),e.getEdge()&&!e.getEdge().getCoedge()&&e.getEdge().setCoedge(e),o(e,t,n)},r.setEdgeData=function(e,t,n){e.setVertex(0,n(t.vertex0)),e.setVertex(1,n(t.vertex1));var r=(0,i.propertyToRange)(t,"range");e.sett0(r[0]),e.sett1(r[1]),e.setReversed(t.reversed),e.setPrecision(t.precision),e.setCurve(n(t.geometry)),o(e,t,n)},r.setVertexData=function(e,t,n){e.setPrecision(t.precision),e.setPoint(n(t.geometry)),o(e,t,n)},r.setWireBodyData=function(e,t,n){for(var i=t.wires,r=new Array(i.length),s=0;s<i.length;++s){var a=i[s];r[s]=n(a),r[s].setWireBody(e)}e.setWires(r),o(e,t,n)},r.setWireData=function(e,t,n){for(var i=t.edges,r=new Array(i.length),s=0;s<i.length;++s){var a=i[s];r[s]=n(a),r[s].setWire(e)}e.setEdges(r),o(e,t,n)},t.TopologySetters=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={setNMIAttributeStr:function(e,t){e.typeid="autodesk.brep:nmiattributestr-1.0.0",e.values={primaryId:t.primaryId,secondaryId:t.secondaryId,approachId:t.approachId,operationIds:t.operationIds}},setNMIAttributeArr:function(e,t){e.typeid="autodesk.brep:nmiattributearr-1.0.0";for(var n=t.tagInfo,i=new Array(n.length),r=0;r<n.length;++r){var o=n[r];i[r]={primaryId:o.primaryId,secondaryId:o.secondaryId,approachId:o.approachId,operationIds:o.operationIds}}e.values={tagInfo:i}},setTextAttribute:function(e,t){e.typeid="autodesk.brep:textattribute-1.0.0",e.values={text:t.text}}};t.AttributeSetters=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.saveToProtoBinary=t.saveToProtoMessage=t.SolidDefSaver=void 0;var i=n(45),r=function(){};r.prototype.setVersion=function(e){console.warn("SolidDefSaver.prototype.setVersion is deprecated,")};var o=function(e){var t=i.Autodesk.lookupType("SolidDef.model_1_0_0"),n={topologies:{},geometries:{},attributes:{}};return e.addToModelObject(n),t.create(n)};t.SolidDefSaver=r,t.saveToProtoMessage=o,t.saveToProtoBinary=function(e){var t=i.Autodesk.lookupType("SolidDef.model_1_0_0"),n=o(e);return t.encode(n).finish()}}])},"object"==(void 0===exports?"undefined":_typeof(exports))&&"object"==(void 0===module?"undefined":_typeof(module))?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==(void 0===exports?"undefined":_typeof(exports))?exports["solid-definition"]=t():e.SolidDefinition=t()},35867:()=>{!function(){try{return new MouseEvent("test")}catch(e){}var e=function(e,t){t=t||{bubbles:!1,cancelable:!1};var n=document.createEvent("MouseEvent");return n.initMouseEvent(e,t.bubbles,t.cancelable,window,0,t.screenX||0,t.screenY||0,t.clientX||0,t.clientY||0,t.ctrlKey||!1,t.altKey||!1,t.shiftKey||!1,t.metaKey||!1,t.button||0,t.relatedTarget||null),n};e.prototype=Event.prototype,window.MouseEvent=e}()},93379:e=>{"use strict";var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var o={},s=[],a=0;a<e.length;a++){var c=e[a],u=i.base?c[0]+i.base:c[0],l=o[u]||0,h="".concat(u," ").concat(l);o[u]=l+1;var d=n(h),p={css:c[1],media:c[2],sourceMap:c[3]};-1!==d?(t[d].references++,t[d].updater(p)):t.push({identifier:h,updater:r(p,i),references:1}),s.push(h)}return s}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var o=i(e=e||[],r=r||{});return function(e){e=e||[];for(var s=0;s<o.length;s++){var a=n(o[s]);t[a].references--}for(var c=i(e,r),u=0;u<o.length;u++){var l=n(o[u]);0===t[l].references&&(t[l].updater(),t.splice(l,1))}o=c}}},90569:e=>{"use strict";var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},19216:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t),t}},3565:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},7795:e=>{"use strict";e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i=n.css,r=n.media,o=n.sourceMap;r?e.setAttribute("media",r):e.removeAttribute("media"),o&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleTagTransform(i,e)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},44589:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},88502:e=>{"use strict";e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+DQo8c3ZnIHdpZHRoPSIxN3B4IiBoZWlnaHQ9IjEwcHgiIHZpZXdCb3g9IjAgMCAxNyAxMCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4NCiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDQ2LjIgKDQ0NDk2KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4NCiAgICA8dGl0bGU+R3JvdXAgMjU8L3RpdGxlPg0KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPg0KICAgIDxkZWZzPjwvZGVmcz4NCiAgICA8ZyBpZD0iU2VsZWN0LSIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+DQogICAgICAgIDxnIGlkPSJNb2RlbF9Ccm93c2VyX2hvdmVyIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjYzLjAwMDAwMCwgLTE5NS4wMDAwMDApIj4NCiAgICAgICAgICAgIDxnIGlkPSJHcm91cC0yNiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjUzLjAwMDAwMCwgNzQuMDAwMDAwKSI+DQogICAgICAgICAgICAgICAgPGcgaWQ9Ikdyb3VwLTE2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLjAwMDAwMCwgMzYuMDAwMDAwKSI+DQogICAgICAgICAgICAgICAgICAgIDxnIGlkPSJHcm91cC0yNSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDcyLjAwMDAwMCkiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPGcgaWQ9Im1hcmt1cC1kaXNwbGF5LW9uIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iR3JvdXAtMjIiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZyBpZD0iZ3VpZGUiIG9wYWNpdHk9IjAiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDE4LjAwMDAwMCwgMTguMDAwMDAwKSBzY2FsZSgxLCAtMSkgdHJhbnNsYXRlKC0xOC4wMDAwMDAsIC0xOC4wMDAwMDApICIgZmlsbD0iI0ZGOTg5OCI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLTQiIHg9IjAiIHk9IjAiIHdpZHRoPSIzNiIgaGVpZ2h0PSIzNiI+PC9yZWN0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2c+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxnIGlkPSJzaG93LW1hcmtlcnMtaWNvbiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMTAuMDAwMDAwLCAxMy4wMDAwMDApIiBmaWxsLXJ1bGU9Im5vbnplcm8iIGZpbGw9IiNGRkZGRkYiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGcgaWQ9IkxheWVyXzEiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMi40NzQsMC44MjM0NjMwNTcgQzEzLjQwOTk4ODMsMS4yMTU3ODg4NiAxNC4yODMzMDE4LDEuNzQzNDE1NzQgMTUuMDY2LDIuMzg5NDYzMDYgQzE1Ljc3NjcxMTYsMy4wMjUzOTQ1MSAxNi4zNzg2NTM3LDMuNzczMjYxOTMgMTYuODQ4LDQuNjAzNDYzMDYgQzE2LjQ5NzQ1OTEsNS41MTE5MjQ3NyAxNS45NjQ0OTk5LDYuMzM4OTMwNDMgMTUuMjgyLDcuMDMzNDYzMDYgQzE0LjUzNjE5MjEsNy43MzAyNjE3MSAxMy42NzgxNDUsOC4yOTYyMDc2OSAxMi43NDQsOC43MDc0NjMwNiBDMTEuMzYxMDM2NSw5LjI5MzUzOTU4IDkuODcxOTM1NjEsOS41ODc2ODI5NyA4LjM3LDkuNTcxNDYzMDYgQzYuODk2MjcwMjEsOS42NTA4OTU4OCA1LjQyMjc0OTI5LDkuNDExNDQ4NzMgNC4wNSw4Ljg2OTQ2MzA2IEMzLjExMzAyOTI4LDguNDg3MzIwMTcgMi4yNTMxMTg1Niw3LjkzODQ0MDk5IDEuNTEyLDcuMjQ5NDYzMDYgQzAuODQyNjYxOTQ4LDYuNTM0MTYwMTUgMC4zMjc5NTI0MTksNS42ODg1NjU5MiAwLDQuNzY1NDYzMDYgQzAuNDU1MjQyNjA0LDMuODYyMzEzMjkgMS4wNTc0NTAzMSwzLjA0MTEyMDk2IDEuNzgyLDIuMzM1NDYzMDYgQzIuNTUyMzY1MDQsMS42NTgzODQzOSAzLjQyNzgxNDI3LDEuMTExMjI4NjIgNC4zNzQsMC43MTU0NjMwNTcgQzUuNjUzNTg1NzEsMC4xNzgzNTEzOTYgNy4wMzgyOTI4MywtMC4wNjE2NjQ1MDQ1IDguNDI0LDAuMDEzNDYzMDU3MyBDOS44MTM2NzUzNCwwLjAxOTA0NzQ5MjggMTEuMTg5MDc0OSwwLjI5NDEyNzQwNiAxMi40NzQsMC44MjM0NjMwNTcgWiBNOC41MzIsOC4wNTk0NjMwNiBDOC45NjAxMDIyOSw4LjA1NTI5NTM2IDkuMzgyODA0ODMsNy45NjM0MDM1IDkuNzc0LDcuNzg5NDYzMDYgQzEwLjE1NjgyNjIsNy42MjE1NjcyNCAxMC41MDQ4MjQyLDcuMzgzNDYzMyAxMC44LDcuMDg3NDYzMDYgQzExLjQwOTE4MDYsNi40NzA2MDIwNyAxMS43NDA2NzExLDUuNjMyMTI1ODggMTEuNzE4LDQuNzY1NDYzMDYgQzExLjcyNjA1ODMsMy45MTc0MTMzNSAxMS4zOTU2NjU0LDMuMTAxMTQ4NDMgMTAuOCwyLjQ5NzQ2MzA2IEMxMC41MDQ4MjQyLDIuMjAxNDYyODIgMTAuMTU2ODI2MiwxLjk2MzM1ODg3IDkuNzc0LDEuNzk1NDYzMDYgQzguOTYzMjAwODEsMS40NTAzMjYwNyA4LjA0Njc5OTE5LDEuNDUwMzI2MDcgNy4yMzYsMS43OTU0NjMwNiBDNi44NTMxNzM4NCwxLjk2MzM1ODg3IDYuNTA1MTc1NzYsMi4yMDE0NjI4MiA2LjIxLDIuNDk3NDYzMDYgQzUuNjAwODE5NDUsMy4xMTQzMjQwNSA1LjI2OTMyODg2LDMuOTUyODAwMjQgNS4yOTIsNC44MTk0NjMwNiBDNS4yOTc2Njg2Nyw1LjI0NzM5NTM2IDUuMzg5NDk1NjMsNS42Njk3OTkzOSA1LjU2Miw2LjA2MTQ2MzA2IEM1LjcyNzU3OTMsNi40NDU1NzAxMyA1Ljk2NTk2NjY2LDYuNzkzOTgyNDQgNi4yNjQsNy4wODc0NjMwNiBDNi41NTgzNDMzMyw3LjM4NDQ2MzMxIDYuOTA2NTQzMzEsNy42MjI3MDU0IDcuMjksNy43ODk0NjMwNiBDNy42ODExOTUxNyw3Ljk2MzQwMzUgOC4xMDM4OTc3MSw4LjA1NTI5NTM2IDguNTMyLDguMDU5NDYzMDYgTDguNTMyLDguMDU5NDYzMDYgWiBNMTAuNDIyLDQuNzY1NDYzMDYgQzEwLjQxNjM1ODgsNC41MjI4NzM5MiAxMC4zNjEyMzI0LDQuMjgzOTkyNjggMTAuMjYsNC4wNjM0NjMwNiBDMTAuMTcyMzE3OCwzLjg0MzUzNDU2IDEwLjA0NDA5MzQsMy42NDIwMzg5NiA5Ljg4MiwzLjQ2OTQ2MzA2IEM5LjcxMTEwOTY4LDMuMzA1MjEyNSA5LjUwOTE2ODc2LDMuMTc2NzA0NjUgOS4yODgsMy4wOTE0NjMwNiBMOC41ODYsMi45Mjk0NjMwNiBMNy44ODQsMy4wOTE0NjMwNiBDNy40NDYzNTgyNiwzLjI3NzM3MzU0IDcuMDk3OTEwNDgsMy42MjU4MjEzMSA2LjkxMiw0LjA2MzQ2MzA2IEM2LjcxMDc1NzY2LDQuNTI4NjMwNTEgNi43MTA3NTc2Niw1LjA1NjI5NTYxIDYuOTEyLDUuNTIxNDYzMDYgQzcuMDg0OTYzNjIsNS45NDkzMjI1NiA3LjQxMjcxNDA0LDYuMjk2MzUyNDMgNy44Myw2LjQ5MzQ2MzA2IEw4LjUzMiw2LjY1NTQ2MzA2IEw5LjIzNCw2LjQ5MzQ2MzA2IEM5LjQ1NDUzMTUzLDYuNDA2OTYzMjEgOS42NTYyMzk3Miw2LjI3ODYwMzQ1IDkuODI4LDYuMTE1NDYzMDYgQzkuOTg5MTA0MjEsNS45NDIxMjA5IDEwLjExNzIwNDgsNS43NDA4MjAwMiAxMC4yMDYsNS41MjE0NjMwNiBDMTAuMzE0Njc2MSw1LjI4NDM1NTU3IDEwLjM2OTk3NzYsNS4wMjYyODIwNCAxMC4zNjgsNC43NjU0NjMwNiBMMTAuNDIyLDQuNzY1NDYzMDYgWiIgaWQ9IlNoYXBlIj48L3BhdGg+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2c+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZz4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2c+DQogICAgICAgICAgICAgICAgICAgICAgICA8L2c+DQogICAgICAgICAgICAgICAgICAgIDwvZz4NCiAgICAgICAgICAgICAgICA8L2c+DQogICAgICAgICAgICA8L2c+DQogICAgICAgIDwvZz4NCiAgICA8L2c+DQo8L3N2Zz4="},20026:e=>{"use strict";e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+DQo8c3ZnIHdpZHRoPSIxNnB4IiBoZWlnaHQ9IjE1cHgiIHZpZXdCb3g9IjAgMCAxNiAxNSIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4NCiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDQ2ICg0NDQyMykgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+DQogICAgPHRpdGxlPm1hcmt1cF9kaXNwbGF5X3R1cm5fb2ZmPC90aXRsZT4NCiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4NCiAgICA8ZGVmcz48L2RlZnM+DQogICAgPGcgaWQ9IlBhZ2UtNiIgc3Ryb2tlPSJub25lIiBzdHJva2Utd2lkdGg9IjEiIGZpbGw9Im5vbmUiIGZpbGwtcnVsZT0iZXZlbm9kZCI+DQogICAgICAgIDxnIGlkPSJDYW1lcmEtSW50ZXJhY3Rpb25zLS0tSG92ZXItQ29weSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTEwNTcuMDAwMDAwLCAtMTIzLjAwMDAwMCkiIGZpbGw9IiNGNEY0RjQiPg0KICAgICAgICAgICAgPGcgaWQ9Ikdyb3VwLTE5IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4MTAuMDAwMDAwLCAxMTIuMDAwMDAwKSI+DQogICAgICAgICAgICAgICAgPGcgaWQ9Im1hcmt1cC1kaXNwbGF5LW9mZiIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMjM5LjAwMDAwMCwgMy4wMDAwMDApIj4NCiAgICAgICAgICAgICAgICAgICAgPGcgaWQ9Im1hcmt1cF9kaXNwbGF5X3R1cm5fb2ZmIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSg4LjAwMDAwMCwgOC4wMDAwMDApIj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNC4zMjIsMC41OTQgQzE0LjA1OCwwLjMzIDEzLjY2MiwwLjMzIDEzLjM5OCwwLjU5NCBMMTAuMzYyLDMuNjMgQzkuNTcsMy40MzIgOC43NzgsMy4yMzQgNy45MiwzLjIzNCBDNC4zNTYsMy4yMzQgMS4zMiw1LjQxMiAwLDguMDUyIEwwLDguMDUyIEMwLjU5NCw5LjI0IDEuNTg0LDEwLjM2MiAyLjc3MiwxMS4yMiBMMC40NjIsMTMuNTMgQzAuMTk4LDEzLjc5NCAwLjE5OCwxNC4xOSAwLjQ2MiwxNC40NTQgQzAuNzI2LDE0LjcxOCAxLjEyMiwxNC43MTggMS4zODYsMTQuNDU0IEwxNC4zMjIsMS41MTggQzE0LjU4NiwxLjI1NCAxNC41ODYsMC44NTggMTQuMzIyLDAuNTk0IEwxNC4zMjIsMC41OTQgWiBNNC43NTIsOC4wNTIgQzQuNzUyLDYuMjcgNi4yMDQsNC44ODQgNy45Miw0Ljg4NCBDOC4yNSw0Ljg4NCA4LjY0Niw0Ljk1IDguOTEsNS4wODIgTDguMDUyLDUuOTQgTDcuODU0LDUuOTQgQzYuNjY2LDUuOTQgNS42NzYsNi45MyA1LjY3Niw4LjExOCBMNS42NzYsOC4zMTYgTDQuODE4LDkuMTc0IEM0LjgxOCw4Ljc3OCA0Ljc1Miw4LjM4MiA0Ljc1Miw4LjA1MiBMNC43NTIsOC4wNTIgWiBNNy45MiwxMC4yMyBDOS4xMDgsMTAuMjMgMTAuMDk4LDkuMjQgMTAuMDk4LDguMDUyIEMxMC4wOTgsNy44NTQgMTAuMDMyLDcuNjU2IDkuOTY2LDcuMzkyIEw3LjI2LDEwLjA5OCBDNy41MjQsMTAuMTY0IDcuNzIyLDEwLjIzIDcuOTIsMTAuMjMgTDcuOTIsMTAuMjMgWiBNMTUuODQsOC4wNTIgQzE1LjE4LDYuNzMyIDE0LjA1OCw1LjU0NCAxMi43MzgsNC42ODYgTDEwLjc1OCw2LjY2NiBDMTAuOTU2LDcuMDYyIDExLjA4OCw3LjU5IDExLjA4OCw4LjA1MiBDMTEuMDg4LDkuODM0IDkuNjM2LDExLjIyIDcuOTIsMTEuMjIgQzcuMzkyLDExLjIyIDYuOTMsMTEuMDg4IDYuNTM0LDEwLjg5IEw1LjA4MiwxMi4zNDIgQzUuOTQsMTIuNjcyIDYuOTMsMTIuODcgNy45MiwxMi44NyBDMTEuNDg0LDEyLjg3IDE0LjUyLDEwLjY5MiAxNS44NCw4LjA1MiBMMTUuODQsOC4wNTIgWiIgaWQ9IlNoYXBlIj48L3BhdGg+DQogICAgICAgICAgICAgICAgICAgIDwvZz4NCiAgICAgICAgICAgICAgICA8L2c+DQogICAgICAgICAgICA8L2c+DQogICAgICAgIDwvZz4NCiAgICA8L2c+DQo8L3N2Zz4="},31194:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScyNCcgaGVpZ2h0PScyNCcgdmlld0JveD0nMCAwIDggOCc+PHBhdGggZmlsbD0nIzZiNzg3ZicgZD0nTTMuMDkgMGMtLjA2IDAtLjEuMDQtLjEzLjA5bC0yLjk0IDYuODFjLS4wMi4wNS0uMDMuMTMtLjAzLjE5di44MWMwIC4wNS4wNC4wOS4wOS4wOWg2LjgxYy4wNSAwIC4wOS0uMDQuMDktLjA5di0uODFjMC0uMDUtLjAxLS4xNC0uMDMtLjE5bC0yLjk0LTYuODFjLS4wMi0uMDUtLjA3LS4wOS0uMTMtLjA5aC0uODF6bS0uMDkgM2gxdjJoLTF2LTJ6bTAgM2gxdjFoLTF2LTF6JyAvPjwvc3ZnPg=="}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.m=__webpack_modules__,__webpack_require__.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return __webpack_require__.d(t,{a:t}),t},__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.b=document.baseURI||self.location.href;var __webpack_exports__=__webpack_require__(4031);Autodesk.Extensions.AEC=__webpack_exports__})();
//# sourceMappingURL=AEC.min.js.map